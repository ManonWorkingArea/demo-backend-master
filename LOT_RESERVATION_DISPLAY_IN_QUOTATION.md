# ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Quotation Form)

## üìã ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Ñ (lot_reservations) ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á" ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏£‡∏≤‡∏ö‡∏ß‡πà‡∏≤ lot ‡πÑ‡∏´‡∏ô‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á ‡∏à‡∏≠‡∏á‡πÑ‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£ ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

## üéØ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å

### 1. ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
- **‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô** (Partially Reserved)
  - ‡πÅ‡∏™‡∏î‡∏á badge ‡∏™‡∏µ‡∏™‡πâ‡∏°: "‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á X ‡∏°."
  - ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏à‡∏≠‡∏á
  - ‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ

- **‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î** (Fully Reserved)
  - ‡πÅ‡∏™‡∏î‡∏á badge ‡∏™‡∏µ‡πÅ‡∏î‡∏á: "‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î"
  - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ = 0
  - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ (disabled)

### 2. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
‡πÅ‡∏ï‡πà‡∏•‡∏∞ lot ‡πÅ‡∏™‡∏î‡∏á:
- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á
- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (‡∏ó‡∏±‡πâ‡∏á‡∏°‡πâ‡∏ß‡∏ô / ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏°‡∏ï‡∏£)
- ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á
- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞ / ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß)

### 3. ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ï‡πá‡∏≠‡∏Ñ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ
```javascript
Available Meters = Remaining Meters - Reserved Meters (DB) - Additional Reservations
```

## üõ†Ô∏è Implementation Details

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
`/src/extensions/modules/erp/modules/sales/components/quotation/shared/QuotationForm.vue`

### 1. State Management

```javascript
const lotReservations = ref({}) // Map: lot_id -> reservation data

// Structure:
{
  "lot_id_1": {
    total_reserved_meters: 50.5,
    reservations: [
      {
        id: "res_1",
        reference_type: "quotation",
        reference_code: "SQX20250001",
        reserved_meters: 30,
        status: "not_paid",
        is_full_roll: false,
        expiry_date: "2025-11-17T00:00:00Z"
      },
      // ...more reservations
    ]
  }
}
```

### 2. Core Functions

#### `loadLotReservations()`
‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å InventoryService

```javascript
const loadLotReservations = async () => {
  const reservations = await core.inventory.getReservations({
    status: ['not_paid', 'paid']
  })
  
  // Map by lot_id
  const reservationMap = {}
  for (const reservation of reservations) {
    const lotId = reservation.lot_id
    if (!reservationMap[lotId]) {
      reservationMap[lotId] = {
        total_reserved_meters: 0,
        reservations: []
      }
    }
    reservationMap[lotId].total_reserved_meters += reservation.reserved_meters
    reservationMap[lotId].reservations.push(reservation)
  }
  
  lotReservations.value = reservationMap
}
```

#### `getAvailableMeters(lot)`
‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

```javascript
const getAvailableMeters = (lot) => {
  const remaining = lot.remaining_meters
  const reserved = lot.reserved_meters || 0
  const additionalReserved = lotReservations.value[lot.id]?.total_reserved_meters || 0
  
  return Math.max(0, remaining - reserved - additionalReserved)
}
```

#### `isLotFullyReserved(lot)`
‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ lot ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

```javascript
const isLotFullyReserved = (lot) => {
  return getAvailableMeters(lot) <= 0
}
```

#### `getLotReservationStatus(lot)`
‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á

```javascript
const getLotReservationStatus = (lot) => {
  const reservation = lotReservations.value[lot.id]
  if (!reservation) return null
  
  const available = getAvailableMeters(lot)
  const remaining = lot.remaining_meters
  
  if (available <= 0) {
    return {
      type: 'fully_reserved',
      label: '‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î',
      color: 'red',
      reservations: reservation.reservations
    }
  } else if (available < remaining) {
    return {
      type: 'partially_reserved',
      label: `‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á ${reservation.total_reserved_meters.toFixed(2)} ‡∏°.`,
      color: 'orange',
      reservations: reservation.reservations
    }
  }
  
  return null
}
```

### 3. UI Components

#### Lot Card with Reservation Status

```vue
<div 
  v-for="lot in item.lots" 
  :key="lot.id"
  class="bg-gray-50 rounded p-2 text-xs border"
  :class="{
    'border-gray-200 hover:border-blue-300 cursor-pointer': getAvailableMeters(lot) > 0,
    'border-red-300 bg-red-50 opacity-75 cursor-not-allowed': getAvailableMeters(lot) <= 0
  }"
  @click.stop="getAvailableMeters(lot) > 0 ? selectProductWithLot(item, lot) : null"
>
  <!-- Header -->
  <div class="flex items-center justify-between mb-1">
    <span class="font-mono font-semibold">{{ lot.full_lot_code }}</span>
    
    <div class="flex items-center gap-2">
      <!-- Reservation Badge -->
      <span 
        v-if="getLotReservationStatus(lot)"
        :class="{
          'bg-red-100 text-red-700': getLotReservationStatus(lot).type === 'fully_reserved',
          'bg-orange-100 text-orange-700': getLotReservationStatus(lot).type === 'partially_reserved'
        }"
        class="px-2 py-0.5 rounded-full text-xs font-semibold"
      >
        <i class="fas fa-lock"></i>
        {{ getLotReservationStatus(lot).label }}
      </span>
      
      <!-- Available Meters -->
      <span 
        :class="{
          'text-green-600': getAvailableMeters(lot) > 0,
          'text-red-600': getAvailableMeters(lot) <= 0
        }"
        class="font-semibold"
      >
        {{ getAvailableMeters(lot).toFixed(2) }} ‡∏°.
      </span>
    </div>
  </div>
  
  <!-- Basic Info -->
  <div class="grid grid-cols-2 gap-1 text-gray-600">
    <span>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: {{ lot.remaining_meters }} ‡∏°.</span>
    <span>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: {{ lot.weight_kg }} ‡∏Å‡∏Å.</span>
  </div>
  
  <!-- Reservation Details -->
  <div v-if="getLotReservationStatus(lot)" class="mt-2 pt-2 border-t">
    <div class="text-xs text-gray-700 font-semibold mb-1">
      <i class="fas fa-info-circle"></i>
      ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:
    </div>
    <div class="space-y-1">
      <div 
        v-for="reservation in getLotReservationStatus(lot).reservations.slice(0, 2)" 
        :key="reservation.id"
        class="text-xs pl-3"
      >
        <i class="fas fa-caret-right text-gray-400"></i>
        <span class="font-semibold">{{ reservation.reserved_meters.toFixed(2) }} ‡∏°.</span>
        <span v-if="reservation.is_full_roll" class="text-purple-600">(‡∏ó‡∏±‡πâ‡∏á‡∏°‡πâ‡∏ß‡∏ô)</span>
        - {{ reservation.reference_code }}
        <span 
          :class="{
            'text-orange-600': reservation.status === 'not_paid',
            'text-green-600': reservation.status === 'paid'
          }"
          class="font-semibold"
        >
          ({{ reservation.status === 'not_paid' ? '‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞' : '‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß' }})
        </span>
      </div>
      <div 
        v-if="getLotReservationStatus(lot).reservations.length > 2" 
        class="text-xs text-gray-500 pl-3"
      >
        ... ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å {{ getLotReservationStatus(lot).reservations.length - 2 }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      </div>
    </div>
  </div>
  
  <!-- Not Available Notice -->
  <div v-if="getAvailableMeters(lot) <= 0" class="mt-2 pt-2 border-t border-red-200">
    <div class="flex items-center text-red-700 font-semibold">
      <i class="fas fa-ban mr-2"></i>
      <span>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ (‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß)</span>
    </div>
  </div>
</div>
```

## üìä UI States

### State 1: ‡∏ß‡πà‡∏≤‡∏á (No Reservation)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ LOT-251108-7738        50.00 ‡∏°.    ‚îÇ
‚îÇ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 50 ‡∏°.    ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: 10 ‡∏Å‡∏Å. ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß, ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ
```

### State 2: ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô (Partially Reserved)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ LOT-251108-7738                     ‚îÇ
‚îÇ [üîí ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á 20 ‡∏°.] 30.00 ‡∏°.         ‚îÇ
‚îÇ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 50 ‡∏°.    ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: 10 ‡∏Å‡∏Å. ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ ‚ÑπÔ∏è ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:                          ‚îÇ
‚îÇ   ‚ñ∏ 20.00 ‡∏°. - SQX20250001 (‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏™‡∏µ‡∏™‡πâ‡∏°, ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ
```

### State 3: ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î (Fully Reserved)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ LOT-251108-7738                     ‚îÇ
‚îÇ [üîí ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î] 0.00 ‡∏°.             ‚îÇ
‚îÇ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 50 ‡∏°.    ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: 10 ‡∏Å‡∏Å. ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ ‚ÑπÔ∏è ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:                          ‚îÇ
‚îÇ   ‚ñ∏ 30.00 ‡∏°. - SQX20250001 (‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞)‚îÇ
‚îÇ   ‚ñ∏ 20.00 ‡∏°. (‡∏ó‡∏±‡πâ‡∏á‡∏°‡πâ‡∏ß‡∏ô) - SQX20250002 (‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß)‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
‚îÇ üö´ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ (‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏™‡∏µ‡πÅ‡∏î‡∏á, ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
```

## üîÑ Data Flow

```
1. User clicks "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á"
   ‚Üì
2. showProductModal() triggered
   ‚Üì
3. Load products (if not loaded)
   ‚Üì
4. Load lot tracking data for textile products
   ‚Üì
5. loadLotReservations() - Fetch all reservations
   ‚Üì
6. Map reservations by lot_id
   ‚Üì
7. Display modal with reservation info
   ‚Üì
8. User expands lot list
   ‚Üì
9. For each lot:
   - Calculate getAvailableMeters()
   - Determine getLotReservationStatus()
   - Apply UI state (colors, disabled, etc.)
   ‚Üì
10. User selects available lot
    ‚Üì
11. If available > 0: Open lot method modal
    If available <= 0: Do nothing (disabled)
```

## üé® Color Scheme

| ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡∏™‡∏µ Badge | ‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° | Cursor |
|-------|----------|-----------|--------|
| ‡∏ß‡πà‡∏≤‡∏á | - | ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß | pointer |
| ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô | ‡∏™‡πâ‡∏° | ‡∏™‡πâ‡∏°/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß | pointer |
| ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î | ‡πÅ‡∏î‡∏á | ‡πÅ‡∏î‡∏á | not-allowed |

## üìù Example Scenarios

### Scenario 1: Lot ‡∏°‡∏µ 50 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á 20 ‡πÄ‡∏°‡∏ï‡∏£ (‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞)
- **‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•**: Badge "‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á 20 ‡∏°." ‡∏™‡∏µ‡∏™‡πâ‡∏°, ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 30 ‡∏°.
- **‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô**: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 30 ‡πÄ‡∏°‡∏ï‡∏£
- **‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î**: ‡πÅ‡∏™‡∏î‡∏á 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á SQX20250001 (‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞)

### Scenario 2: Lot ‡∏°‡∏µ 50 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î (30 + 20 = 50)
- **‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•**: Badge "‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î" ‡∏™‡∏µ‡πÅ‡∏î‡∏á, ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 0 ‡∏°.
- **‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô**: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (disabled)
- **‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î**: ‡πÅ‡∏™‡∏î‡∏á 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å + ‡∏ô‡∏±‡∏ö‡∏£‡∏ß‡∏°)

### Scenario 3: Lot ‡∏°‡∏µ 50 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á 50 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏ó‡∏±‡πâ‡∏á‡∏°‡πâ‡∏ß‡∏ô (‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß)
- **‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•**: Badge "‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î" ‡∏™‡∏µ‡πÅ‡∏î‡∏á, ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 0 ‡∏°.
- **‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô**: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
- **‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î**: ‡πÅ‡∏™‡∏î‡∏á "50.00 ‡∏°. (‡∏ó‡∏±‡πâ‡∏á‡∏°‡πâ‡∏ß‡∏ô) - SQX20250001 (‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß)"

## üîß Testing Checklist

### 1. ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- [ ] ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• lot_reservations ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- [ ] Map reservation ‡∏Å‡∏±‡∏ö lot_id ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- [ ] ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì total_reserved_meters ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

### 2. ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
- [ ] Lot ‡∏ß‡πà‡∏≤‡∏á ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß ‡πÑ‡∏°‡πà‡∏°‡∏µ badge
- [ ] Lot ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô ‡πÅ‡∏™‡∏î‡∏á badge ‡∏™‡∏µ‡∏™‡πâ‡∏° + ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡∏ï‡∏£
- [ ] Lot ‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏™‡∏î‡∏á badge ‡∏™‡∏µ‡πÅ‡∏î‡∏á + disabled

### 3. ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
- [ ] getAvailableMeters() ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- [ ] ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö reserved_meters ‡∏à‡∏≤‡∏Å DB + lotReservations
- [ ] ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö (Math.max(0, ...))

### 4. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
- [ ] ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
- [ ] ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (... ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å X ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
- [ ] ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞/‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß) ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- [ ] ‡πÅ‡∏™‡∏î‡∏á (‡∏ó‡∏±‡πâ‡∏á‡∏°‡πâ‡∏ß‡∏ô) ‡πÄ‡∏°‡∏∑‡πà‡∏≠ is_full_roll = true

### 5. Interaction
- [ ] ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å lot ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏ï‡πá‡∏≠‡∏Ñ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏î‡πâ
- [ ] ‡∏Ñ‡∏•‡∏¥‡∏Å lot ‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
- [ ] ‡πÄ‡∏õ‡∏¥‡∏î lot method modal ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

## üöÄ Performance Considerations

1. **Lazy Loading**: ‡πÇ‡∏´‡∏•‡∏î reservations ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
2. **Caching**: ‡πÄ‡∏Å‡πá‡∏ö lotReservations ‡πÉ‡∏ô ref ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ã‡πâ‡∏≥
3. **Computed Values**: ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô getAvailableMeters() ‡πÅ‡∏ó‡∏ô computed ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô
4. **Limited Display**: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î space

## üìå Notes

- ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á **‡∏ó‡∏±‡πâ‡∏á‡∏°‡πâ‡∏ß‡∏ô** ‡πÅ‡∏•‡∏∞ **‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏°‡∏ï‡∏£**
- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á: `not_paid` (7 ‡∏ß‡∏±‡∏ô) ‡πÅ‡∏•‡∏∞ `paid` (‡∏ñ‡∏≤‡∏ß‡∏£)
- reserved_meters ‡πÉ‡∏ô textile_lot_tracking ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì available_meters ‡πÅ‡∏ö‡∏ö real-time ‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏´‡∏•‡πà‡∏á

## üîó Related Files

- `QuotationForm.vue` - Main component
- `InventoryService.js` - getReservations(), getLotTracking()
- `SalesService.js` - createInvoiceFromQuotation() (trigger reservation)
- `QUOTATION_INVOICE_STOCK_RESERVATION.md` - Overall system documentation
