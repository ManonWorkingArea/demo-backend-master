"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[1296],{21296:function(e,t,i){i.r(t),i.d(t,{default:function(){return ie}});var n=i(20641);function r(e,t,i,r,a,o){const s=(0,n.g2)("Edit");return this.login?((0,n.uX)(),(0,n.Wv)(s,{key:0})):(0,n.Q3)("",!0)}var a=i(52968),o=i(75220),s=i(90033);const c={class:"video-container"},d={class:"block"},l={ref:"webcamVideo",autoplay:"",muted:""},u={class:"block"},h={ref:"screenVideo",autoplay:"",muted:""},f=["disabled"],m=["disabled"],p={id:"status_info"};function v(e,t,i,r,a,o){return(0,n.uX)(),(0,n.CE)("div",null,[t[6]||(t[6]=(0,n.Lk)("h1",null,"Streaming Desk",-1)),(0,n.Lk)("div",c,[(0,n.Lk)("div",d,[t[4]||(t[4]=(0,n.Lk)("h2",null,"Webcam",-1)),(0,n.Lk)("video",l,null,512),(0,n.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.startWebcam&&r.startWebcam(...e))},"Open Webcam")]),(0,n.Lk)("div",u,[t[5]||(t[5]=(0,n.Lk)("h2",null,"Screen Capture",-1)),(0,n.Lk)("video",h,null,512),(0,n.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.startScreenCapture&&r.startScreenCapture(...e))},"Share Screen")])]),(0,n.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.startStreamingWithAdaptor&&r.startStreamingWithAdaptor(...e)),disabled:!r.webcamStream},"Start Streaming",8,f),(0,n.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.stopStreamingWithAdaptor&&r.stopStreamingWithAdaptor(...e)),disabled:!r.webRTCAdaptor},"Stop Streaming",8,m),(0,n.Lk)("div",p,"Status: "+(0,s.v_)(r.streamingStatus),1)])}var g=i(50953);(function(e,t){window.log=t()})(0,(function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function r(e,t){var i=e[t];if("function"===typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(n){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&i?a:void 0!==console[n]?r(console,n):void 0!==console.log?r(console,"log"):e)}function s(t,i){for(var r=0;r<n.length;r++){var a=n[r];this[a]=r<t?e:this.methodFactory(a,t,i)}this.log=this.debug}function c(e,i,n){return function(){typeof console!==t&&(s.call(this,i,n),this[e].apply(this,arguments))}}function d(e,t,i){return o(e)||c.apply(this,arguments)}function l(e,i,r){var a,o=this;i=null==i?"WARN":i;var c="loglevel";function l(e){var i=(n[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=i)}catch(r){}try{window.document.cookie=encodeURIComponent(c)+"="+i+";"}catch(r){}}}function u(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(r){}if(typeof e===t)try{var i=window.document.cookie,n=i.indexOf(encodeURIComponent(c)+"=");-1!==n&&(e=/^([^;]+)/.exec(i.slice(n))[1])}catch(r){}return void 0===o.levels[e]&&(e=void 0),e}}function h(){if(typeof window!==t&&c){try{return void window.localStorage.removeItem(c)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}"string"===typeof e?c+=":"+e:"symbol"===typeof e&&(c=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=r||d,o.getLevel=function(){return a},o.setLevel=function(i,n){if("string"===typeof i&&void 0!==o.levels[i.toUpperCase()]&&(i=o.levels[i.toUpperCase()]),!("number"===typeof i&&i>=0&&i<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+i;if(a=i,!1!==n&&l(i),s.call(o,i,e),typeof console===t&&i<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){i=e,u()||o.setLevel(e,!1)},o.resetLevel=function(){o.setLevel(i,!1),h()},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var f=u();null==f&&(f=i),o.setLevel(f,!1)}var u=new l,h={};u.getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new l(e,u.getLevel(),u.methodFactory)),t};var f=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=f),u},u.getLoggers=function(){return h},u["default"]=u,u}));window.log;var b=window.log;class y{constructor(e,t){this.context=e,this.instant=0,this.mic=null,this.volumeMeterNode=null,this.url=t}connectToSource(e,t,i){return this.context.audioWorklet.addModule(this.url).then((()=>{this.mic=this.context.createMediaStreamSource(e),this.volumeMeterNode=new AudioWorkletNode(this.context,"volume-meter"),this.volumeMeterNode.port.onmessage=e=>{"debug"==e.data.type?b.debug(e.data.message):(this.instant=e.data,t(this.instant.toFixed(2)),b.debug("Audio level: "+this.instant.toFixed(2)))},this.mic.connect(this.volumeMeterNode)})).catch((e=>{throw void 0!==i&&i(e),b.error("Error in soundmeter: "+e),b.error("You may need to define the url of the volume-meter-processor.js"),e}))}stop(){null!=this.volumeMeterNode&&(this.volumeMeterNode.port.postMessage("stop"),this.volumeMeterNode.disconnect(),this.volumeMeterNode.port.close(),this.volumeMeterNode=null),null!=this.mic&&(this.mic.disconnect(),this.mic=null)}}window.log;String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var i=this.toString();("number"!==typeof t||!isFinite(t)||Math.floor(t)!==t||t>i.length)&&(t=i.length),t-=e.length;var n=i.lastIndexOf(e,t);return-1!==n&&n===t});window.log;function S(){var e=navigator.userAgent||navigator.vendor||window.opera;return/android/i.test(e)}var w=window.log;class k{constructor(e){for(var t in this.bandwidth=1200,this.debug=!1,this.camera_location="top",this.camera_margin=15,this.camera_percent=15,this.mediaConstraints={video:!0,audio:!0},this.getSender=e.getSender,this.publishStreamId=null,this.localStream=null,this.publishMode="camera",this.callback=(e,t)=>{w.debug("Callback info: "+e+" object: "+typeof t!==void 0?JSON.stringify(t):0)},this.callbackError=e=>{w.error(e)},this.volumeMeterUrl="volume-meter-processor.js",e.userParameters)e.userParameters.hasOwnProperty(t)&&(this[t]=e.userParameters[t]);e.callback&&(this.callback=e.callback),e.callbackError&&(this.callbackError=e.callbackError),this.currentVolume=null,this.previousAudioTrack=null,this.silentAudioTrack=null,this.desktopStream=null,this.smallVideoTrack=null,this.blackVideoTrack=null,this.audioContext=new AudioContext,this.oscillator=null,this.primaryAudioTrackGainNode=null,this.secondaryAudioTrackGainNode=null,this.localStreamSoundMeter=null,this.levelCallback=null,this.blackFrameTimer=null,this.desktopCameraCanvasDrawerTimer=null,this.mutedAudioStream=null,this.isMuted=!1,this.meterRefresh=null,this.cameraEnabled=!0,this.replacementStream=null,this.localVideo=this.localVideoElement||document.getElementById(this.localVideoId),this.dummyCanvas=document.createElement("canvas"),this.mediaConstraints?"camera"==this.mediaConstraints.video?this.publishMode="camera":"screen"==this.mediaConstraints.video?this.publishMode="screen":"screen+camera"==this.mediaConstraints.video&&(this.publishMode="screen+camera"):this.mediaConstraints={video:!0,audio:!0},this.checkBrowserScreenShareSupported()}initLocalStream(){if(this.checkWebRTCPermissions(),"undefined"!=typeof this.mediaConstraints.video&&0!=this.mediaConstraints.video)return this.openStream(this.mediaConstraints);if("undefined"!=typeof this.mediaConstraints.audio&&0!=this.mediaConstraints.audio){var e={audio:this.mediaConstraints.audio};return this.navigatorUserMedia(e,(e=>this.gotStream(e)),!0)}return w.debug("no media requested, just return an empty stream"),Promise.resolve(null)}checkWebRTCPermissions(){return"WebSocket"in window?"undefined"==typeof navigator.mediaDevices?(w.debug("Cannot open camera and mic because of unsecure context. Please Install SSL(https)"),void this.callbackError("UnsecureContext")):void("undefined"!=typeof navigator.mediaDevices&&void 0!=navigator.mediaDevices&&null!=navigator.mediaDevices||this.callbackError("getUserMediaIsNotAllowed")):(w.debug("WebSocket not supported."),void this.callbackError("WebSocketNotSupported"))}getDevices(){return navigator.mediaDevices.enumerateDevices().then((e=>{var t=new Array,i=!1,n=!1;return e.forEach((e=>{"audioinput"!=e.kind&&"videoinput"!=e.kind||(t.push(e),"audioinput"==e.kind&&(i=!0),"videoinput"==e.kind&&(n=!0))})),this.callback("available_devices",t),0==i&&null==this.localStream&&(w.debug("Audio input not found"),w.debug("Retrying to get user media without audio"),this.inputDeviceNotFoundLimit<2?0!=n?(this.openStream({video:!0,audio:!1}),this.inputDeviceNotFoundLimit++):(w.debug("Video input not found"),alert("There is no video or audio input")):alert("No input device found, publish is not possible")),t})).catch((e=>{throw w.error("Cannot get devices -> error name: "+e.name+": "+e.message),e}))}trackDeviceChange(){navigator.mediaDevices.ondevicechange=()=>{this.getDevices()}}setDesktopwithCameraSource(e,t,i){return this.desktopStream=e,this.navigatorUserMedia({video:!0,audio:!1},(n=>{this.smallVideoTrack=n.getVideoTracks()[0];var r=document.createElement("canvas"),a=r.getContext("2d"),o=document.createElement("video");o.srcObject=e,o.play();var s=document.createElement("video");s.srcObject=n,s.play();var c,d=r.captureStream(15);null!=i&&(e.getVideoTracks()[0].onended=function(e){i(e)}),c=null==this.localStream?this.gotStream(d):this.updateVideoTrack(d,t,onended,null),c.then((()=>{this.desktopCameraCanvasDrawerTimer=setInterval((()=>{r.width=o.videoWidth,r.height=o.videoHeight,a.drawImage(o,0,0,r.width,r.height);var e,t=o.videoWidth*(this.camera_percent/100),i=s.videoHeight/s.videoWidth*t,n=r.width-t-this.camera_margin;e="top"==this.camera_location?this.camera_margin:r.height-i-this.camera_margin,a.drawImage(s,n,e,t,i)}),66)}))}),!0)}prepareStreamTracks(e,t,i,n){var r=i.getAudioTracks();if(r.length>0&&"camera"==this.publishMode&&(r[0].stop(),i.removeTrack(r[0])),"undefined"!=t&&0!=t){var a={audio:t};return this.navigatorUserMedia(a).then((a=>{a=this.setGainNodeStream(a);var o=t=>{this.callback("screen_share_stopped"),this.setVideoCameraSource(n,e,null,!0)};return"screen"==this.publishMode?this.updateVideoTrack(i,n,o,!0).then((()=>(r.length>0&&(a=this.mixAudioStreams(i,a)),this.updateAudioTrack(a,n,null)))):"screen+camera"==this.publishMode?(r.length>0&&(a=this.mixAudioStreams(i,a)),this.updateAudioTrack(a,n,null).then((()=>this.setDesktopwithCameraSource(i,n,o)))):(0!=t&&void 0!=t&&i.addTrack(a.getAudioTracks()[0]),i.getVideoTracks().length>0?this.updateVideoTrack(i,n,null,null).then((()=>this.updateAudioTrack(i,n,null).then((()=>this.gotStream(i))))):i.getAudioTracks().length>0?this.updateAudioTrack(i,n,null).then((()=>this.gotStream(i))):this.gotStream(i))})).catch((e=>{throw"NotFoundError"==e.name?this.getDevices():this.callbackError(e.name,e.message),e}))}return this.gotStream(i)}navigatorUserMedia(e,t,i){if("dummy"==e.video||"dummy"==e.audio){var n=new MediaStream;return"dummy"==e.audio&&n.addTrack(this.getSilentAudioTrack()),"dummy"==e.video&&n.addTrack(this.getBlackVideoTrack()),new Promise(((e,t)=>{e(n)}))}return navigator.mediaDevices.getUserMedia(e).then((e=>("undefined"==typeof t&&null==t||t(e),e))).catch((e=>{throw 1==i?"NotFoundError"==e.name?this.getDevices():this.callbackError(e.name,e.message):w.warn(e),e}))}navigatorDisplayMedia(e,t){return navigator.mediaDevices.getDisplayMedia(e).then((e=>("undefined"!=typeof t&&t(e),e))).catch((e=>{if("NotAllowedError"===e.name)if(w.debug("Permission denied error"),this.callbackError("ScreenSharePermissionDenied"),null==this.localStream){var t={video:!0,audio:!0};this.openStream(t)}else this.switchVideoCameraCapture(streamId)}))}getMedia(e,t){var i=!1;return"undefined"!=typeof e.audio&&0!=e.audio&&(i=e.audio),null!=this.desktopCameraCanvasDrawerTimer&&(clearInterval(this.desktopCameraCanvasDrawerTimer),this.desktopCameraCanvasDrawerTimer=null),"screen+camera"==this.publishMode||"screen"==this.publishMode?this.navigatorDisplayMedia(e).then((n=>(this.smallVideoTrack&&this.smallVideoTrack.stop(),this.prepareStreamTracks(e,i,n,t)))):this.navigatorUserMedia(e).then((n=>(this.smallVideoTrack&&this.smallVideoTrack.stop(),this.prepareStreamTracks(e,i,n,t)))).catch((e=>{"NotFoundError"==e.name?this.getDevices():this.callbackError(e.name,e.message)}))}openStream(e,t){return this.mediaConstraints=e,this.getMedia(e,t).then((()=>{"dummy"!=this.mediaConstraints.video&&void 0!=this.mediaConstraints.video&&(this.stopBlackVideoTrack(),this.clearBlackVideoTrackTimer()),"dummy"!=this.mediaConstraints.audio&&void 0!=this.mediaConstraints.audio&&this.stopSilentAudioTrack()}))}closeStream(){this.localStream&&(this.localStream.getVideoTracks().forEach((function(e){e.onended=null,e.stop()})),this.localStream.getAudioTracks().forEach((function(e){e.onended=null,e.stop()}))),this.videoTrack&&this.videoTrack.stop(),this.audioTrack&&this.audioTrack.stop(),this.smallVideoTrack&&this.smallVideoTrack.stop(),this.previousAudioTrack&&this.previousAudioTrack.stop()}checkBrowserScreenShareSupported(){("undefined"!=typeof navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia||navigator.getDisplayMedia)&&this.callback("browser_screen_share_supported")}enableSecondStreamInMixedAudio(e){null!=this.secondaryAudioTrackGainNode&&(this.secondaryAudioTrackGainNode.gain.value=e?1:0)}gotStream(e){return this.localStream=e,this.localVideo&&(this.localVideo.srcObject=e),this.getDevices(),this.trackDeviceChange(),new Promise(((e,t)=>{e()}))}changeLocalVideo(e){this.localVideo=e,this.localStream&&(this.localVideo.srcObject=this.localStream)}enableAudioLevelWhenMuted(){return new Promise(((e,t)=>{navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then((i=>{this.mutedAudioStream=i,this.mutedSoundMeter=new y(this.audioContext,this.volumeMeterUrl),this.mutedSoundMeter.connectToSource(this.mutedAudioStream,(e=>{e>.1&&this.callback("speaking_but_muted")}),(i=>{i&&t(i),this.meterRefresh=setInterval((()=>{this.mutedSoundMeter.instant.toFixed(2)>.1&&this.callback("speaking_but_muted")}),200),e(null)}))})).catch((function(e){w.debug("Can't get the soundlevel on mute"),t(e)}))}))}disableAudioLevelWhenMuted(){null!=this.meterRefresh&&(clearInterval(this.meterRefresh),this.meterRefresh=null),null!=this.mutedSoundMeter&&(this.mutedSoundMeter.stop(),this.mutedSoundMeter=null),null!=this.mutedAudioStream&&this.mutedAudioStream.getTracks().forEach((function(e){e.stop()}))}mixAudioStreams(e,t){var i=new MediaStream;e.getVideoTracks().forEach((function(e){i.addTrack(e)}));var n=this.audioContext.createMediaStreamDestination();if(e.getAudioTracks().length>0){this.primaryAudioTrackGainNode=this.audioContext.createGain(),this.primaryAudioTrackGainNode.gain.value=1;var r=this.audioContext.createMediaStreamSource(e);r.connect(this.primaryAudioTrackGainNode).connect(n)}else w.debug("Origin stream does not have audio track");if(t.getAudioTracks().length>0){this.secondaryAudioTrackGainNode=this.audioContext.createGain(),this.secondaryAudioTrackGainNode.gain.value=1;var a=this.audioContext.createMediaStreamSource(t);a.connect(this.secondaryAudioTrackGainNode).connect(n)}else w.debug("Second stream does not have audio track");return n.stream.getAudioTracks().forEach((function(e){i.addTrack(e),w.debug("audio destination add track")})),i}setGainNodeStream(e){if(0!=this.mediaConstraints.audio&&"undefined"!=typeof this.mediaConstraints.audio){var t=e.getVideoTracks(),i=e.getAudioTracks();this.audioContext=new AudioContext;var n=this.audioContext.createMediaStreamSource(e),r=this.audioContext.createMediaStreamDestination();this.primaryAudioTrackGainNode=this.audioContext.createGain(),n.connect(this.primaryAudioTrackGainNode),this.primaryAudioTrackGainNode.connect(r),null==this.currentVolume?this.primaryAudioTrackGainNode.gain.value=1:this.primaryAudioTrackGainNode.gain.value=this.currentVolume;var a=r.stream;for(var o of t)a.addTrack(o);for(var s of i)a.addTrack(s);return null!==this.previousAudioTrack&&this.previousAudioTrack.stop(),this.previousAudioTrack=a.getAudioTracks()[1],a}return e}switchDesktopCapture(e){return this.publishMode="screen","undefined"!=typeof this.mediaConstraints.video&&0!=this.mediaConstraints.video&&(this.mediaConstraints.video=!0),this.getMedia(this.mediaConstraints,e)}switchDesktopCaptureWithCamera(e){return"undefined"!=typeof this.mediaConstraints.video&&0!=this.mediaConstraints.video&&(this.mediaConstraints.video=!0),this.publishMode="screen+camera",this.getMedia(this.mediaConstraints,e)}updateLocalAudioStream(e,t){var i=e.getAudioTracks()[0];if(null!=this.localStream&&null!=this.localStream.getAudioTracks()[0]){var n=this.localStream.getAudioTracks()[0];n!=i&&(this.localStream.removeTrack(n),n.stop(),this.localStream.addTrack(i))}else null!=this.localStream?this.localStream.addTrack(i):this.localStream=e;null!=this.localVideo&&(this.localVideo.srcObject=this.localStream),null!=t&&(e.getAudioTracks()[0].onended=function(e){t(e)}),this.isMuted?this.muteLocalMic():this.unmuteLocalMic(),null!=this.localStreamSoundMeter&&this.enableAudioLevelForLocalStream(this.levelCallback)}updateLocalVideoStream(e,t,i){i&&null!=this.desktopStream&&this.desktopStream.getVideoTracks()[0].stop();var n=e.getVideoTracks()[0];if(null!=this.localStream&&null!=this.localStream.getVideoTracks()[0]){var r=this.localStream.getVideoTracks()[0];r!=n&&(this.localStream.removeTrack(r),r.stop(),this.localStream.addTrack(n))}else null!=this.localStream?this.localStream.addTrack(n):this.localStream=e;this.localVideo&&(this.localVideo.srcObject=this.localStream),null!=t&&(e.getVideoTracks()[0].onended=function(e){t(e)})}switchAudioInputSource(e,t){var i=this.localStream.getAudioTracks()[0];if(i&&S()&&i.stop(),"undefined"==typeof i&&w.warn("There is no audio track in local stream"),"undefined"!=typeof t){!0!==this.mediaConstraints.audio?this.mediaConstraints.audio.deviceId=t:this.mediaConstraints.audio={deviceId:t};var n={video:!1,audio:{deviceId:t}};return this.setAudioInputSource(e,n,null,t)}return new Promise(((e,t)=>{t("There is no device id for audio input source")}))}setAudioInputSource(e,t,i){return this.navigatorUserMedia(t,(n=>(n=this.setGainNodeStream(n),this.updateAudioTrack(n,e,t,i))),!0)}checkAndStopLocalVideoTrackOnAndroid(){if(this.localStream&&this.localStream.getVideoTracks().length>0&&S()){var e=this.localStream.getVideoTracks()[0];e.stop()}null!==this.localStream&&0!==this.localStream.getVideoTracks().length||w.warn("There is no video track in local stream")}switchVideoCameraCapture(e,t,i){return this.checkAndStopLocalVideoTrackOnAndroid(),this.publishMode="camera",navigator.mediaDevices.enumerateDevices().then((n=>{for(var r=0;r<n.length;r++)if("videoinput"==n[r].kind&&n[r].deviceId==t){!0!==this.mediaConstraints.video?this.mediaConstraints.video.deviceId={exact:t}:this.mediaConstraints.video={deviceId:{exact:t}};break}return w.debug("Given deviceId = "+t+" - Media constraints video property = "+this.mediaConstraints.video),this.setVideoCameraSource(e,this.mediaConstraints,i,!0,t)}))}setVideoCameraSource(e,t,i,n){return this.navigatorUserMedia(t,(r=>(n&&this.secondaryAudioTrackGainNode&&r.getAudioTracks().length>0&&(this.secondaryAudioTrackGainNode=null,r=this.setGainNodeStream(r),this.updateAudioTrack(r,e,t,i)),this.cameraEnabled?this.updateVideoTrack(r,e,i,n):this.turnOffLocalCamera())),!0)}switchVideoCameraFacingMode(e,t){this.checkAndStopLocalVideoTrackOnAndroid(),void 0!==this.mediaConstraints.video&&void 0!==this.mediaConstraints.video.deviceId&&delete this.mediaConstraints.video.deviceId;var i={facingMode:t};return this.mediaConstraints.video=Object.assign({},this.mediaConstraints.video,i),this.publishMode="camera",w.debug("Media constraints video property = "+this.mediaConstraints.video),this.setVideoCameraSource(e,{video:this.mediaConstraints.video},null,!0)}updateAudioTrack(e,t,i){var n=this.getSender(t,"audio");return n?n.replaceTrack(e.getAudioTracks()[0]).then((t=>{this.updateLocalAudioStream(e,i)})).catch((function(e){throw w.debug(e.name),e})):(this.updateLocalAudioStream(e,i),new Promise(((e,t)=>{e()})))}updateVideoTrack(e,t,i,n){var r=this.getSender(t,"video");return r?r.replaceTrack(e.getVideoTracks()[0]).then((t=>{this.updateLocalVideoStream(e,i,n)})).catch((e=>{w.debug(e.name)})):(this.updateLocalVideoStream(e,i,n),new Promise(((e,t)=>{e()})))}getBlackVideoTrack(){return this.dummyCanvas.getContext("2d").fillRect(0,0,320,240),this.replacementStream=this.dummyCanvas.captureStream(),null==this.blackFrameTimer&&(this.blackFrameTimer=setInterval((()=>{this.getBlackVideoTrack()}),3e3)),this.blackVideoTrack=this.replacementStream.getVideoTracks()[0],this.blackVideoTrack}getSilentAudioTrack(){this.stopSilentAudioTrack(),this.oscillator=this.audioContext.createOscillator();var e=this.oscillator.connect(this.audioContext.createMediaStreamDestination());return this.oscillator.start(),this.silentAudioTrack=e.stream.getAudioTracks()[0],this.silentAudioTrack}stopSilentAudioTrack(){null!=this.oscillator&&(this.oscillator.stop(),this.oscillator.disconnect(),this.oscillator=null),null!=this.silentAudioTrack&&(this.silentAudioTrack.stop(),this.silentAudioTrack=null)}turnOffLocalCamera(e){var t;return this.getBlackVideoTrack(),null!=this.localStream?(t=null!=e||"undefined"!=typeof e?e:this.publishStreamId,this.cameraEnabled=!1,this.updateVideoTrack(this.replacementStream,t,null,!0)):new Promise(((e,t)=>{this.callbackError("NoActiveConnection"),t("NoActiveStream")}))}clearBlackVideoTrackTimer(){null!=this.blackFrameTimer&&(clearInterval(this.blackFrameTimer),this.blackFrameTimer=null)}stopBlackVideoTrack(){null!=this.blackVideoTrack&&(this.blackVideoTrack.stop(),this.blackVideoTrack=null)}turnOnLocalCamera(e){return this.clearBlackVideoTrackTimer(),this.stopBlackVideoTrack(),null==this.localStream?this.navigatorUserMedia(this.mediaConstraints,(e=>{this.gotStream(e)}),!1):this.navigatorUserMedia(this.mediaConstraints,(t=>{var i;i=null!=e||"undefined"!=typeof e?e:this.publishStreamId,this.cameraEnabled=!0,this.updateVideoTrack(t,i,null,!0)}),!1)}muteLocalMic(){this.isMuted=!0,null!=this.localStream?this.localStream.getAudioTracks().forEach((e=>e.enabled=!1)):this.callbackError("NoActiveConnection")}unmuteLocalMic(){this.isMuted=!1,null!=this.localStream?this.localStream.getAudioTracks().forEach((e=>e.enabled=!0)):this.callbackError("NoActiveConnection")}getVideoSender(e){var t=null;return"undefined"!==typeof adapter&&null!==adapter&&("chrome"===adapter.browserDetails.browser||"firefox"===adapter.browserDetails.browser||"safari"===adapter.browserDetails.browser&&adapter.browserDetails.version>=64)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&(t=this.getSender(e,"video")),t}changeBandwidth(e,t){var i="",n=this.getVideoSender(t);if(null!=n){var r=n.getParameters();return r.encodings||(r.encodings=[{}]),"unlimited"===e?delete r.encodings[0].maxBitrate:r.encodings[0].maxBitrate=1e3*e,n.setParameters(r)}return i="Video sender not found to change bandwidth. Streaming may not be active",Promise.reject(i)}setVolumeLevel(e){this.currentVolume=e,null!=this.primaryAudioTrackGainNode&&(this.primaryAudioTrackGainNode.gain.value=e),null!=this.secondaryAudioTrackGainNode&&(this.secondaryAudioTrackGainNode.gain.value=e)}enableAudioLevelForLocalStream(e){return this.levelCallback=e,this.disableAudioLevelForLocalStream(),this.localStreamSoundMeter=new y(this.audioContext,this.volumeMeterUrl),"running"!==this.audioContext.state?this.audioContext.resume().then((()=>this.localStreamSoundMeter.connectToSource(this.localStream,e))):this.localStreamSoundMeter.connectToSource(this.localStream,e)}disableAudioLevelForLocalStream(){null!=this.localStreamSoundMeter&&(this.localStreamSoundMeter.stop(),this.localStreamSoundMeter=null)}applyConstraints(e){var t={};void 0===e.audio&&void 0===e.video?(t.video=e,this.mediaConstraints.video=Object.assign({},this.mediaConstraints.video,t.video)):void 0!==e.video&&(t.video=e.video,this.mediaConstraints.video=Object.assign({},this.mediaConstraints.video,t.video)),void 0!==e.audio&&(t.audio=e.audio,this.mediaConstraints.audio=Object.assign({},this.mediaConstraints.audio,t.audio));var i=null;if(void 0!==t.video)if(this.localStream&&this.localStream.getVideoTracks().length>0){var n=this.localStream.getVideoTracks()[0];i=n.applyConstraints(this.mediaConstraints.video)}else i=new Promise(((e,t)=>{t("There is no video track to apply constraints")}));return void 0!==t.audio&&(i=this.setAudioInputSource(this.publishStreamId,{audio:this.mediaConstraints.audio},null)),null!=this.localStreamSoundMeter&&this.enableAudioLevelForLocalStream(this.levelCallback),i}}function C(e,t,i,n,r,a,o){try{var s=e[a](o),c=s.value}catch(d){return void i(d)}s.done?t(c):Promise.resolve(c).then(n,r)}function A(e){return function(){var t=this,i=arguments;return new Promise((function(n,r){var a=e.apply(t,i);function o(e){C(a,n,r,o,s,"next",e)}function s(e){C(a,n,r,o,s,"throw",e)}o(void 0)}))}}function T(e,t,i){return t=P(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function E(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function P(e){var t=E(e,"string");return"symbol"===typeof t?t:String(t)}function I(e,t){var i=L(e,t,"get");return M(e,i)}function R(e,t,i){var n=L(e,t,"set");return O(e,n,i),i}function L(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function M(e,t){return t.get?t.get.call(e):t.value}function O(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function D(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}function x(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function N(e,t,i){x(e,t),t.set(e,i)}function F(e,t){x(e,t),t.add(e)}class _{constructor(e){this.streamId=e,this.totalBytesReceivedCount=0,this.totalBytesSent=0,this.videoPacketsLost=0,this.fractionLost=0,this.startTime=0,this.lastFramesEncoded=0,this.totalFramesEncodedCount=0,this.lastBytesReceived=0,this.lastBytesSent=0,this.totalVideoPacketsSent=0,this.videoPacketsSent=0,this.videoPacketsReceived=0,this.totalAudioPacketsSent=0,this.audioPacketsSent=0,this.audioPacketsReceived=0,this.currentTimestamp=0,this.lastTime=0,this.timerId=0,this.firstByteSentCount=0,this.firstBytesReceivedCount=0,this.audioLevel=-1,this.qualityLimitationReason="",this.resWidth=0,this.resHeight=0,this.srcFps=0,this.frameWidth=0,this.frameHeight=0,this.videoRoundTripTime=0,this.videoJitter=0,this.audioRoundTripTime=0,this.audioJitter=0,this.audioPacketsLost=0,this.framesReceived=0,this.framesDropped=0,this.framesDecoded=0,this.audioJitterAverageDelay=0,this.videoJitterAverageDelay=0,this.availableOutgoingBitrate=1/0,this.inboundRtpList=[],this.currentRoundTripTime=0}get averageOutgoingBitrate(){return Math.floor(8*(this.totalBytesSentCount-this.firstByteSentCount)/(this.currentTimestamp-this.startTime))}get currentFPS(){return((this.totalFramesEncodedCount-this.lastFramesEncoded)/(this.currentTimestamp-this.lastTime)*1e3).toFixed(1)}get averageIncomingBitrate(){return Math.floor(8*(this.totalBytesReceivedCount-this.firstBytesReceivedCount)/(this.currentTimestamp-this.startTime))}get currentOutgoingBitrate(){return Math.floor(8*(this.totalBytesSentCount-this.lastBytesSent)/(this.currentTimestamp-this.lastTime))}get currentIncomingBitrate(){return Math.floor(8*(this.totalBytesReceivedCount-this.lastBytesReceived)/(this.currentTimestamp-this.lastTime))}set currentTime(e){this.lastTime=this.currentTimestamp,this.currentTimestamp=e,0==this.startTime&&(this.startTime=e-1)}set totalBytesReceived(e){this.lastBytesReceived=this.totalBytesReceivedCount,this.totalBytesReceivedCount=e,0==this.firstBytesReceivedCount&&(this.firstBytesReceivedCount=e)}set totalBytesSent(e){this.lastBytesSent=this.totalBytesSentCount,this.totalBytesSentCount=e,0==this.firstByteSentCount&&(this.firstByteSentCount=e)}set totalFramesEncoded(e){this.lastFramesEncoded=this.totalFramesEncodedCount,this.totalFramesEncodedCount=e,0==this.lastFramesEncoded&&(this.lastFramesEncoded=e)}}var j=window.log;class V{constructor(e){for(var t in this.debug=!1,e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.initWebSocketConnection(),addEventListener("offline",(e=>{this.connected=!1,this.connecting=!1,j.info("Network status has changed to offline. Resetting flags to reconnect faster")}))}initWebSocketConnection(e){this.connecting=!0,this.connected=!1,this.pingTimerId=-1;var t=new URL(this.websocket_url);["origin","edge"].includes(t.searchParams.get("target"))||(t.searchParams.set("target",this.webrtcadaptor.isPlayMode?"edge":"origin"),this.websocket_url=t.toString()),this.wsConn=new WebSocket(this.websocket_url),this.wsConn.onopen=()=>{j.debug("websocket connected"),this.pingTimerId=setInterval((()=>{this.sendPing()}),3e3),this.connected=!0,this.connecting=!1,this.callback("initialized"),"undefined"!=typeof e&&e()},this.wsConn.onmessage=e=>{var t=JSON.parse(e.data);"start"==t.command?(this.debug&&j.debug("received start command"),this.webrtcadaptor.startPublishing(t.streamId)):"takeCandidate"==t.command?(this.debug&&(j.debug("received ice candidate for stream id "+t.streamId),j.debug(t.candidate)),this.webrtcadaptor.takeCandidate(t.streamId,t.label,t.candidate)):"takeConfiguration"==t.command?(this.debug&&j.debug("received remote description type for stream id: "+t.streamId+" type: "+t.type),this.webrtcadaptor.takeConfiguration(t.streamId,t.sdp,t.type,t.idMapping)):"stop"==t.command?(this.debug&&j.debug("Stop command received"),this.webrtcadaptor.closePeerConnection(t.streamId)):"error"==t.command?this.callbackError(t.definition,t):"notification"==t.command?this.callback(t.definition,t):"streamInformation"==t.command||"roomInformation"==t.command?this.callback(t.command,t):"pong"==t.command?this.callback(t.command):"trackList"==t.command?this.callback(t.command,t):"connectWithNewId"==t.command?(this.multiPeerStreamId=t.streamId,this.join(t.streamId)):"peerMessageCommand"==t.command&&this.callback(t.command,t)},this.wsConn.onerror=e=>{this.connecting=!1,this.connected=!1,j.info(" error occured: "+JSON.stringify(e)),this.clearPingTimer(),this.callbackError("WebSocketNotConnected",e)},this.wsConn.onclose=e=>{this.connecting=!1,this.connected=!1,this.debug&&j.debug("connection closed."),this.clearPingTimer(),this.callback("closed",e)}}clearPingTimer(){-1!=this.pingTimerId&&(this.debug&&j.debug("Clearing ping message timer"),clearInterval(this.pingTimerId),this.pingTimerId=-1)}sendPing(){var e={command:"ping"};this.wsConn.send(JSON.stringify(e))}close(){this.wsConn.close()}send(e){if(0!=this.connecting||0!=this.connected)try{this.wsConn.send(e),this.debug&&j.debug("sent message:"+e)}catch(t){j.warn("Make sure you call methods after you receive initialized callback. Cannot send message:"+e+" Error is "+t)}else this.initWebSocketConnection((()=>{this.send(e)}))}isConnected(){return this.connected}isConnecting(){return this.connecting}}var B=window.log;class U{constructor(e){this.size=e,this.received=0,this.data=new ArrayBuffer(e)}}class W{static register(e){W.pluginInitMethods.push(e)}constructor(e){for(var t in this.peerconnection_config={iceServers:[{urls:"stun:stun1.l.google.com:19302"}],sdpSemantics:"unified-plan"},this.sdp_constraints={OfferToReceiveAudio:!1,OfferToReceiveVideo:!1},this.remotePeerConnection=new Array,this.remotePeerConnectionStats=new Array,this.remoteDescriptionSet=new Array,this.iceCandidateList=new Array,this.roomName=null,this.playStreamId=new Array,this.isMultiPeer=!1,this.multiPeerStreamId=null,this.webSocketAdaptor=null,this.isPlayMode=!1,this.debug=!1,this.publishStreamId=null,this.idMapping=new Array,this.onlyDataChannel=!1,this.dataChannelEnabled=!0,this.receivingMessages=new Map,this.candidateTypes=["udp","tcp"],this.callback=null,this.callbackError=null,this.reconnectIfRequiredFlag=!0,this.websocket_url=null,this.websocketURL=null,this.initializeComponents=!0,this.degradationPreference="maintain-resolution",e)e.hasOwnProperty(t)&&(this[t]=e[t]);if(null==this.websocketURL&&(this.websocketURL=this.websocket_url),null==this.websocketURL)throw new Error("WebSocket URL is not defined. It's mandatory");this.remoteVideo=this.remoteVideoElement||document.getElementById(this.remoteVideoId),this.soundMeters=new Array,this.soundLevelList=new Array,this.eventListeners=new Array,this.errorEventListeners=new Array,this.publishToken=null,this.publishSubscriberId=null,this.publishSubscriberCode=null,this.publishStreamName=null,this.publishMainTrack=null,this.publishMetaData=null,this.publishRole=null,this.playToken=null,this.playRoomId=null,this.playEnableTracks=null,this.playSubscriberId=null,this.playSubscriberCode=null,this.playMetaData=null,this.playRole=null,this.lastReconnectiontionTrialTime=0,this.pendingTryAgainTimerId=-1,this.mediaManager=new k({userParameters:e,webRTCAdaptor:this,callback:(e,t)=>{this.notifyEventListeners(e,t)},callbackError:(e,t)=>{this.notifyErrorEventListeners(e,t)},getSender:(e,t)=>this.getSender(e,t)}),this.initializeComponents&&this.initialize()}initPlugins(){W.pluginInitMethods.forEach((e=>{e(this)}))}addEventListener(e){this.eventListeners.push(e)}addErrorEventListener(e){this.errorEventListeners.push(e)}notifyEventListeners(e,t){this.eventListeners.forEach((i=>{i(e,t)})),null!=this.callback&&this.callback(e,t)}notifyErrorEventListeners(e,t){this.errorEventListeners.forEach((i=>{i(e,t)})),null!=this.callbackError&&this.callbackError(e,t)}initialize(){return this.isPlayMode||this.onlyDataChannel||null!=this.mediaManager.localStream?new Promise(((e,t)=>{this.initPlugins(),this.checkWebSocketConnection(),e("Wait 'initialized' callback from websocket")})):this.mediaManager.initLocalStream().then((()=>(this.initPlugins(),this.checkWebSocketConnection(),new Promise(((e,t)=>{e("Wait 'initialized' callback from websocket")}))))).catch((e=>{throw B.warn(e),e}))}publish(e,t,i,n,r,a,o,s){if(this.publishStreamId=e,this.mediaManager.publishStreamId=e,this.publishToken=t,this.publishSubscriberId=i,this.publishSubscriberCode=n,this.publishStreamName=r,this.publishMainTrack=a,this.publishMetaData=o,this.publishRole=s,this.onlyDataChannel)this.sendPublishCommand(e,t,i,n,r,a,o,s,!1,!1);else if(null==this.mediaManager.localStream)this.mediaManager.initLocalStream().then((()=>{var c=!1,d=!1;null!=this.mediaManager.localStream&&(c=this.mediaManager.localStream.getVideoTracks().length>0,d=this.mediaManager.localStream.getAudioTracks().length>0),this.sendPublishCommand(e,t,i,n,r,a,o,s,c,d)})).catch((e=>{throw B.warn(e),e}));else{var c=this.mediaManager.localStream.getVideoTracks().length>0,d=this.mediaManager.localStream.getAudioTracks().length>0;this.sendPublishCommand(e,t,i,n,r,a,o,s,c,d)}this.initPeerConnection(e,"publish"),this.reconnectIfRequired(3e3,!1)}sendPublishCommand(e,t,i,n,r,a,o,s,c,d){var l={command:"publish",streamId:e,token:t,subscriberId:void 0!==typeof i&&null!=i?i:"",subscriberCode:void 0!==typeof n&&null!=n?n:"",streamName:void 0!==typeof r&&null!=r?r:"",mainTrack:void 0!==typeof a&&null!=a?a:"",video:c,audio:d,metaData:void 0!==typeof o&&null!=o?o:"",role:void 0!==typeof s&&null!=s?s:""};this.webSocketAdaptor.send(JSON.stringify(l))}joinRoom(e,t,i,n,r,a){this.roomName=e;var o={command:"joinRoom",room:e,mainTrack:e,streamId:t,mode:i,streamName:n,role:r,metadata:a};this.webSocketAdaptor.send(JSON.stringify(o))}play(e,t,i,n,r,a,o,s){this.playStreamId.push(e),this.playToken=t,this.playRoomId=i,this.playEnableTracks=n,this.playSubscriberId=r,this.playSubscriberCode=a,this.playMetaData=o,this.playRole=s;var c={command:"play",streamId:e,token:void 0!==typeof t&&null!=t?t:"",room:void 0!==typeof i&&null!=i?i:"",trackList:void 0!==typeof n&&null!=n?n:[],subscriberId:void 0!==typeof r&&null!=r?r:"",subscriberCode:void 0!==typeof a&&null!=r?a:"",viewerInfo:void 0!==typeof o&&null!=o?o:"",role:void 0!==typeof s&&null!=s?s:"",userPublishId:void 0!==typeof this.publishStreamId&&null!=this.publishStreamId?this.publishStreamId:""};this.webSocketAdaptor.send(JSON.stringify(c)),this.initPeerConnection(e,"play"),this.reconnectIfRequired(3e3,!1)}reconnectIfRequired(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.reconnectIfRequiredFlag&&(e<=0&&(e=500,clearTimeout(this.pendingTryAgainTimerId),this.pendingTryAgainTimerId=-1),-1==this.pendingTryAgainTimerId&&(this.pendingTryAgainTimerId=setTimeout((()=>{this.pendingTryAgainTimerId=-1,this.tryAgain(t)}),e)))}tryAgain(e){var t=this,i=Date.now(),n=i-this.lastReconnectiontionTrialTime;if(n<3e3&&0==e)return B.debug("Reconnection request received after "+n+" ms. It should be at least 3000ms. It will try again after 1000ms"),void this.reconnectIfRequired(1e3,e);this.lastReconnectiontionTrialTime=i,null==this.remotePeerConnection[this.publishStreamId]||!e&&-1!==["checking","connected","completed"].indexOf(this.iceConnectionState(this.publishStreamId))||(this.notifyEventListeners("reconnection_attempt_for_publisher",this.publishStreamId),this.stop(this.publishStreamId),setTimeout((()=>{B.log("Trying publish again for stream: "+this.publishStreamId),this.publish(this.publishStreamId,this.publishToken,this.publishSubscriberId,this.publishSubscriberCode,this.publishStreamName,this.publishMainTrack,this.publishMetaData,this.publishRole)}),500));var r=function(){var i=t.playStreamId[a];null==t.remotePeerConnection[i]||!e&&-1!==["checking","connected","completed"].indexOf(t.iceConnectionState(i))||(t.notifyEventListeners("reconnection_attempt_for_player",i),B.log("It will try to play again for stream: "+i+" because it is not stopped on purpose"),t.stop(i),setTimeout((()=>{B.log("Trying play again for stream: "+i),t.play(i,t.playToken,t.playRoomId,t.playEnableTracks,t.playSubscriberId,t.playSubscriberCode,t.playMetaData,t.playRole)}),500))};for(var a in this.playStreamId)r()}stop(e){if(this.closePeerConnection(e),null!=this.webSocketAdaptor&&this.webSocketAdaptor.isConnected()){var t={command:"stop",streamId:e};this.webSocketAdaptor.send(JSON.stringify(t))}}join(e){var t={command:"join",streamId:e,multiPeer:this.isMultiPeer&&null==this.multiPeerStreamId,mode:this.isPlayMode?"play":"both"};this.webSocketAdaptor.send(JSON.stringify(t))}onTrack(e,t){if(B.debug("onTrack for stream"),null!=this.remoteVideo)this.remoteVideo.srcObject!==e.streams[0]&&(this.remoteVideo.srcObject=e.streams[0],B.debug("Received remote stream"));else{var i={stream:e.streams[0],track:e.track,streamId:t,trackId:this.idMapping[t][e.transceiver.mid]};this.notifyEventListeners("newTrackAvailable",i),this.notifyEventListeners("newStreamAvailable",i)}}leaveFromRoom(e,t){for(var i in this.remotePeerConnection)this.closePeerConnection(i);this.roomName=e;var n={command:"leaveFromRoom",room:e,mainTrack:e,streamId:t};B.debug("leave request is sent for "+e),this.webSocketAdaptor.send(JSON.stringify(n))}leave(e){var t={command:"leave",streamId:this.isMultiPeer&&null!=this.multiPeerStreamId?this.multiPeerStreamId:e};this.webSocketAdaptor.send(JSON.stringify(t)),this.closePeerConnection(e),this.multiPeerStreamId=null}getStreamInfo(e){var t={command:"getStreamInfo",streamId:e};this.webSocketAdaptor.send(JSON.stringify(t))}requestVideoTrackAssignments(e){var t={command:"getVideoTrackAssignmentsCommand",streamId:e};this.webSocketAdaptor.send(JSON.stringify(t))}getBroadcastObject(e){var t={command:"getBroadcastObject",streamId:e};this.webSocketAdaptor.send(JSON.stringify(t))}updateStreamMetaData(e,t){var i={command:"updateStreamMetaData",streamId:e,metaData:t};this.webSocketAdaptor.send(JSON.stringify(i))}getRoomInfo(e,t){var i={command:"getRoomInfo",streamId:t,room:e};this.webSocketAdaptor.send(JSON.stringify(i))}getSubtracks(e,t,i,n){var r={command:"getSubtracks",streamId:e,role:t,offset:i,size:n};this.webSocketAdaptor.send(JSON.stringify(r))}getSubtrackCount(e,t,i){var n={command:"getSubtracksCount",streamId:e,role:t,status:i};this.webSocketAdaptor.send(JSON.stringify(n))}enableTrack(e,t,i){var n={command:"enableTrack",streamId:e,trackId:t,enabled:i};this.webSocketAdaptor.send(JSON.stringify(n))}getTracks(e,t){this.playStreamId.push(e);var i={command:"getTrackList",streamId:e,token:t};this.webSocketAdaptor.send(JSON.stringify(i))}iceCandidateReceived(e,t){if(e.candidate){var i=!1;if(""==e.candidate.candidate?i=!0:"undefined"==typeof e.candidate.protocol?this.candidateTypes.forEach((t=>{e.candidate.candidate.toLowerCase().includes(t)&&(i=!0)})):i=this.candidateTypes.includes(e.candidate.protocol.toLowerCase()),i){var n={command:"takeCandidate",streamId:t,label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate};this.debug&&(B.debug("sending ice candiate for stream Id "+t),B.debug(JSON.stringify(e.candidate))),this.webSocketAdaptor.send(JSON.stringify(n))}else B.debug("Candidate's protocol(full sdp: "+e.candidate.candidate+") is not supported. Supported protocols: "+this.candidateTypes),""!=e.candidate.candidate&&this.notifyErrorEventListeners("protocol_not_supported","Support protocols: "+this.candidateTypes.toString()+" candidate: "+e.candidate.candidate)}else B.debug("No event.candidate in the iceCandidate event")}sanitizeHTML(e){return e.includes("script")?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}initDataChannel(e,t){t.onerror=i=>{B.debug("Data Channel Error:",i);var n={streamId:e,error:i};B.debug("channel status: ",t.readyState),"closed"!=t.readyState&&this.notifyErrorEventListeners("data_channel_error",n)},t.onmessage=t=>{var i={streamId:e,data:t.data},n=i.data;if("string"===typeof n||n instanceof String)i.data=this.sanitizeHTML(i.data),this.notifyEventListeners("data_received",i);else{var r=n.length||n.size||n.byteLength,a=new Int32Array(n,0,1),o=a[0],s=this.receivingMessages[o];if(void 0==s){a=new Int32Array(n,0,2);var c=a[1];return s=new U(c),this.receivingMessages[o]=s,void(r>8&&B.debug("something went wrong in msg receiving"))}var d=n.slice(4,r),l=new Uint8Array(s.data);l.set(new Uint8Array(d),s.received,r-4),s.received+=r-4,s.size==s.received&&(i.data=s.data,this.notifyEventListeners("data_received",i))}},t.onopen=()=>{this.remotePeerConnection[e].dataChannel=t,B.debug("Data channel is opened"),this.notifyEventListeners("data_channel_opened",e)},t.onclose=()=>{B.debug("Data channel is closed"),this.notifyEventListeners("data_channel_closed",e)}}initPeerConnection(e,t){if(null==this.remotePeerConnection[e]){var i=e;if(B.debug("stream id in init peer connection: "+e+" close stream id: "+i),this.remotePeerConnection[e]=new RTCPeerConnection(this.peerconnection_config),this.remoteDescriptionSet[e]=!1,this.iceCandidateList[e]=new Array,this.playStreamId.includes(e)||null!=this.mediaManager.localStream&&this.mediaManager.localStream.getTracks().forEach((t=>{var i=this.remotePeerConnection[e].addTrack(t,this.mediaManager.localStream);if("video"==t.kind){var n=i.getParameters();n.degradationPreference=this.degradationPreference,i.setParameters(n).then((()=>{B.info("Degradation Preference is set to "+this.degradationPreference)})).catch((e=>{B.warn("Degradation Preference cannot be set to "+this.degradationPreference)}))}})),this.remotePeerConnection[e].onicecandidate=e=>{this.iceCandidateReceived(e,i)},this.remotePeerConnection[e].ontrack=e=>{this.onTrack(e,i)},this.remotePeerConnection[e].onnegotiationneeded=e=>{B.debug("onnegotiationneeded")},this.dataChannelEnabled)if("publish"==t){var n={ordered:!0};if(this.remotePeerConnection[e].createDataChannel){var r=this.remotePeerConnection[e].createDataChannel(e,n);this.initDataChannel(e,r)}else B.warn("CreateDataChannel is not supported")}else if("play"==t)this.remotePeerConnection[e].ondatachannel=t=>{this.initDataChannel(e,t.channel)};else{var a={ordered:!0};if(this.remotePeerConnection[e].createDataChannel){var o=this.remotePeerConnection[e].createDataChannel(e,a);this.initDataChannel(e,o),this.remotePeerConnection[e].ondatachannel=t=>{this.initDataChannel(e,t.channel)}}else B.warn("CreateDataChannel is not supported")}this.remotePeerConnection[e].oniceconnectionstatechange=t=>{var i={state:this.remotePeerConnection[e].iceConnectionState,streamId:e};this.oniceconnectionstatechangeCallback(i)}}return this.remotePeerConnection[e]}oniceconnectionstatechangeCallback(e){B.debug("ice connection state is "+e.state+" for streamId: "+e.streamId),"failed"!=e.state&&"disconnected"!=e.state&&"closed"!=e.state||(B.debug("ice connection state is failed, disconnected or closed for streamId: "+e.streamId+" it will try to reconnect immediately"),this.reconnectIfRequired(0,!1)),this.notifyEventListeners("ice_connection_state_changed",e),this.isPlayMode||this.playStreamId.includes(e.streamId)||null!=this.remotePeerConnection[e.streamId]&&"connected"==this.remotePeerConnection[e.streamId].iceConnectionState&&this.mediaManager.changeBandwidth(this.mediaManager.bandwidth,e.streamId).then((()=>{B.debug("Bandwidth is changed to "+this.mediaManager.bandwidth)})).catch((e=>B.warn(e)))}closePeerConnection(e){var t=this.remotePeerConnection[e];if(null!=t){this.remotePeerConnection[e]=null,delete this.remotePeerConnection[e],null!=t.dataChannel&&t.dataChannel.close(),"closed"!=t.signalingState&&t.close();var i=this.playStreamId.indexOf(e);-1!=i&&this.playStreamId.splice(i,1)}null!=this.remotePeerConnectionStats[e]&&(clearInterval(this.remotePeerConnectionStats[e].timerId),delete this.remotePeerConnectionStats[e]),null!=this.soundMeters[e]&&delete this.soundMeters[e]}signallingState(e){return null!=this.remotePeerConnection[e]?this.remotePeerConnection[e].signalingState:null}iceConnectionState(e){return null!=this.remotePeerConnection[e]?this.remotePeerConnection[e].iceConnectionState:null}gotDescription(e,t){this.remotePeerConnection[t].setLocalDescription(e).then((i=>{B.debug("Set local description successfully for stream Id "+t);var n={command:"takeConfiguration",streamId:t,type:e.type,sdp:e.sdp};B.debug("setLocalDescription:"+e.sdp),this.webSocketAdaptor.send(JSON.stringify(n))})).catch((e=>{B.error("Cannot set local description. Error is: "+e)}))}takeConfiguration(e,t,i,n){var r=e,a=i,o=t,s="offer"==a,c="publish";s&&(c="play"),this.idMapping[r]=n,this.initPeerConnection(r,c),B.debug("setRemoteDescription:"+o),this.remotePeerConnection[r].setRemoteDescription(new RTCSessionDescription({sdp:o,type:a})).then((e=>{this.debug&&(B.debug("set remote description is succesfull with response: "+e+" for stream : "+r+" and type: "+a),B.debug(o)),this.remoteDescriptionSet[r]=!0;var t=this.iceCandidateList[r].length;B.debug("Ice candidate list size to be added: "+t);for(var i=0;i<t;i++)this.addIceCandidate(r,this.iceCandidateList[r][i]);this.iceCandidateList[r]=[],s&&(B.debug("try to create answer for stream id: "+r),this.remotePeerConnection[r].createAnswer(this.sdp_constraints).then((e=>{B.debug("created answer for stream id: "+r),e.sdp=e.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1"),this.gotDescription(e,r)})).catch((e=>{B.error("create answer error :"+e)})))})).catch((e=>{this.debug&&B.error("set remote description is failed with error: "+e),(e.toString().indexOf("InvalidAccessError")>-1||e.toString().indexOf("setRemoteDescription")>-1)&&this.notifyErrorEventListeners("notSetRemoteDescription")}))}takeCandidate(e,t,i){var n=e,r=t,a=i,o=new RTCIceCandidate({sdpMLineIndex:r,candidate:a}),s="peer";this.initPeerConnection(n,s),B.debug("takeCandidate:"+a),1==this.remoteDescriptionSet[n]?this.addIceCandidate(n,o):(B.debug("Ice candidate is added to list because remote description is not set yet"),this.iceCandidateList[n].push(o))}addIceCandidate(e,t){var i=!1;""==t.candidate?i=!0:"undefined"==typeof t.protocol?this.candidateTypes.forEach((e=>{t.candidate.toLowerCase().includes(e)&&(i=!0)})):i=this.candidateTypes.includes(t.protocol.toLowerCase()),i?this.remotePeerConnection[e].addIceCandidate(t).then((t=>{this.debug&&B.debug("Candidate is added for stream "+e)})).catch((i=>{B.error("ice candiate cannot be added for stream id: "+e+" error is: "+i),B.error(t)})):this.debug&&B.debug("Candidate's protocol("+t.protocol+") is not supported.Candidate: "+t.candidate+" Supported protocols:"+this.candidateTypes)}startPublishing(e){var t=e,i=this.initPeerConnection(t,"publish");i.createOffer(this.sdp_constraints).then((e=>{this.gotDescription(e,t)})).catch((e=>{B.error("create offer error for stream id: "+t+" error: "+e)}))}toggleVideo(e,t,i){var n={command:"toggleVideo",streamId:e,trackId:t,enabled:i};this.webSocketAdaptor.send(JSON.stringify(n))}toggleAudio(e,t,i){var n={command:"toggleAudio",streamId:e,trackId:t,enabled:i};this.webSocketAdaptor.send(JSON.stringify(n))}getStats(e){return B.debug("peerstatsgetstats = "+this.remotePeerConnectionStats[e]),new Promise(((t,i)=>{this.remotePeerConnection[e].getStats(null).then((i=>{var n=this.parseStats(i,e);this.notifyEventListeners("updated_stats",n),t(n)})).catch((e=>{t(!1)}))}))}parseStats(e,t){var i=-1,n=-1,r=-1,a=-1,o=-1,s=-1,c=-1,d=-1,l=-1,u="",h=-1,f=-1,m=-1,p=-1,v=-1,g=-1,b=-1,y=-1,S=-1,w=-1,k=-1,C=-1,A=-1,T=-1,E=-1,P=1/0,I=-1,R=-1,L=-1,M=[];return e.forEach((e=>{if("inbound-rtp"==e.type&&"undefined"!=typeof e.kind){var t={};t.trackIdentifier=e.trackIdentifier,i+=e.bytesReceived,"audio"==e.kind?(r=e.packetsLost,w=e.jitter,R=e.packetsReceived,t.audioPacketsLost=e.packetsLost):"video"==e.kind&&(n=e.packetsLost,t.videoPacketsLost=e.packetsLost,t.framesDropped=e.framesDropped,t.framesDecoded=e.framesDecoded,t.framesPerSecond=e.framesPerSecond,y=e.jitter,L=e.packetsReceived),t.bytesReceived=e.bytesReceived,t.jitterBufferDelay=e.jitterBufferDelay,t.lastPacketReceivedTimestamp=e.lastPacketReceivedTimestamp,a+=e.fractionLost,t.fractionLost=e.fractionLost,o=e.timestamp,t.currentTime=e.timestamp,"undefined"!=typeof e.frameWidth&&(v=e.frameWidth,t.frameWidth=e.frameWidth),"undefined"!=typeof e.frameHeight&&(g=e.frameHeight,t.frameHeight=e.frameHeight),"undefined"!=typeof e.framesDecoded&&(k=e.framesDecoded,t.framesDecoded=e.framesDecoded),"undefined"!=typeof e.framesDropped&&(C=e.framesDropped,t.framesDropped=e.framesDropped),"undefined"!=typeof e.framesReceived&&(A=e.framesReceived,t.framesReceived=e.framesReceived),M.push(t)}else"outbound-rtp"==e.type?("audio"==e.kind?d=e.packetsSent:"video"==e.kind&&(c=e.packetsSent,v=e.frameWidth,g=e.frameHeight),s+=e.bytesSent,o=e.timestamp,u=e.qualityLimitationReason,null!=e.framesEncoded&&(h+=e.framesEncoded)):"track"==e.type&&"undefined"!=typeof e.kind&&"audio"==e.kind?("undefined"!=typeof e.audioLevel&&(l=e.audioLevel),"undefined"!=typeof e.jitterBufferDelay&&"undefined"!=typeof e.jitterBufferEmittedCount&&(T=e.jitterBufferDelay/e.jitterBufferEmittedCount)):"track"==e.type&&"undefined"!=typeof e.kind&&"video"==e.kind?("undefined"!=typeof e.frameWidth&&(v=e.frameWidth),"undefined"!=typeof e.frameHeight&&(g=e.frameHeight),"undefined"!=typeof e.framesDecoded&&(k=e.framesDecoded),"undefined"!=typeof e.framesDropped&&(C=e.framesDropped),"undefined"!=typeof e.framesReceived&&(A=e.framesReceived),"undefined"!=typeof e.jitterBufferDelay&&"undefined"!=typeof e.jitterBufferEmittedCount&&(E=e.jitterBufferDelay/e.jitterBufferEmittedCount)):"remote-inbound-rtp"==e.type&&"undefined"!=typeof e.kind?("undefined"!=typeof e.packetsLost&&("video"==e.kind?n=e.packetsLost:"audio"==e.kind&&(r=e.packetsLost)),"undefined"!=typeof e.roundTripTime&&("video"==e.kind?b=e.roundTripTime:"audio"==e.kind&&(S=e.roundTripTime)),"undefined"!=typeof e.jitter&&("video"==e.kind?y=e.jitter:"audio"==e.kind&&(w=e.jitter))):"media-source"==e.type?"video"==e.kind&&(f=e.width,m=e.height,p=e.framesPerSecond):"candidate-pair"==e.type&&"succeeded"==e.state&&void 0!=e.availableOutgoingBitrate&&(P=e.availableOutgoingBitrate/1e3,I=e.currentRoundTripTime)})),"undefined"!=typeof this.remotePeerConnectionStats[t]&&null!=this.remotePeerConnectionStats[t]||(this.remotePeerConnectionStats[t]=new _(t)),this.remotePeerConnectionStats[t].totalBytesReceived=i,this.remotePeerConnectionStats[t].videoPacketsLost=n,this.remotePeerConnectionStats[t].audioPacketsLost=r,this.remotePeerConnectionStats[t].fractionLost=a,this.remotePeerConnectionStats[t].currentTime=o,this.remotePeerConnectionStats[t].totalBytesSent=s,this.remotePeerConnectionStats[t].totalVideoPacketsSent=c,this.remotePeerConnectionStats[t].totalAudioPacketsSent=d,this.remotePeerConnectionStats[t].videoPacketsSent=c,this.remotePeerConnectionStats[t].audioPacketsSent=d,this.remotePeerConnectionStats[t].audioLevel=l,this.remotePeerConnectionStats[t].qualityLimitationReason=u,this.remotePeerConnectionStats[t].totalFramesEncoded=h,this.remotePeerConnectionStats[t].resWidth=f,this.remotePeerConnectionStats[t].resHeight=m,this.remotePeerConnectionStats[t].srcFps=p,this.remotePeerConnectionStats[t].frameWidth=v,this.remotePeerConnectionStats[t].frameHeight=g,this.remotePeerConnectionStats[t].videoRoundTripTime=b,this.remotePeerConnectionStats[t].videoJitter=y,this.remotePeerConnectionStats[t].audioRoundTripTime=S,this.remotePeerConnectionStats[t].audioJitter=w,this.remotePeerConnectionStats[t].framesDecoded=k,this.remotePeerConnectionStats[t].framesDropped=C,this.remotePeerConnectionStats[t].framesReceived=A,this.remotePeerConnectionStats[t].videoJitterAverageDelay=E,this.remotePeerConnectionStats[t].audioJitterAverageDelay=T,this.remotePeerConnectionStats[t].availableOutgoingBitrate=P,this.remotePeerConnectionStats[t].inboundRtpList=M,this.remotePeerConnectionStats[t].currentRoundTripTime=I,this.remotePeerConnectionStats[t].audioPacketsReceived=R,this.remotePeerConnectionStats[t].videoPacketsReceived=L,this.remotePeerConnectionStats[t]}enableStats(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;null==this.remotePeerConnectionStats[e]&&(this.remotePeerConnectionStats[e]=new _(e),this.remotePeerConnectionStats[e].timerId=setInterval((()=>{this.getStats(e)}),t))}disableStats(e){null==this.remotePeerConnectionStats[e]&&"undefined"==typeof this.remotePeerConnectionStats[e]||(clearInterval(this.remotePeerConnectionStats[e].timerId),delete this.remotePeerConnectionStats[e])}checkWebSocketConnection(){(null==this.webSocketAdaptor||0==this.webSocketAdaptor.isConnected()&&0==this.webSocketAdaptor.isConnecting())&&(B.debug("websocket url : "+this.websocketURL),this.webSocketAdaptor=new V({websocket_url:this.websocketURL,webrtcadaptor:this,callback:(e,t)=>{this.websocketCallback(e,t)},callbackError:(e,t)=>{this.notifyErrorEventListeners(e,t)},debug:this.debug}))}websocketCallback(e,t){"closed"!=e&&"server_will_stop"!=e||(B.info("Critical response from server:"+e+". It will reconnect immediately if there is an active connection"),"server_will_stop"==e&&this.webSocketAdaptor.close(),this.reconnectIfRequired(0,!0)),this.notifyEventListeners(e,t)}closeWebSocket(){for(var e in this.remotePeerConnection)this.closePeerConnection(e);this.remotePeerConnection=new Array,this.webSocketAdaptor.close()}peerMessage(e,t,i){var n={command:"peerMessageCommand",streamId:e,definition:t,data:i};this.webSocketAdaptor.send(JSON.stringify(n))}forceStreamQuality(e,t){var i={command:"forceStreamQuality",streamId:e,streamHeight:t};this.webSocketAdaptor.send(JSON.stringify(i))}sendData(e,t){var i=16e3;if(void 0!==this.remotePeerConnection[e]){var n=this.remotePeerConnection[e].dataChannel;if(void 0===n||null===n||"undefined"===typeof n)return void B.warn("dataChannel is null or undefined");if("open"!==n.readyState)return void B.warn("dataChannel.readyState is not open: "+n.readyState);var r=t.length||t.size||t.byteLength,a=0;if("string"===typeof t||t instanceof String)n.send(t);else{var o=Math.floor(999999*Math.random()),s=new Int32Array(2);s[0]=o,s[1]=r,n.send(s);a=0;while(a<r){var c=Math.min(r-a,i),d=new Uint8Array(c+4),l=new Int32Array(1);l[0]=o,d.set(new Uint8Array(l.buffer,0,4),0);var u=t.slice(a,a+c);d.set(new Uint8Array(u),4),a+=c,n.send(d)}}}else B.warn("Send data is called for undefined peer connection with stream id: "+e)}enableAudioLevel(e,t){var i=new y(this.mediaManager.audioContext);i.connectToSource(e,(()=>{}),(function(e){e?alert(e):B.debug("Added sound meter for stream: "+t+" = "+i.instant.toFixed(2))})),this.soundMeters[t]=i}getSoundLevelList(e){for(var t=0;t<e.length;t++)this.soundLevelList[e[t]]=this.soundMeters[e[t]].instant.toFixed(2);this.notifyEventListeners("gotSoundList",this.soundLevelList)}getSender(e,t){var i=null;return null!=this.remotePeerConnection[e]&&(i=this.remotePeerConnection[e].getSenders().find((function(e){return e.track.kind==t}))),i}assignVideoTrack(e,t,i){var n={command:"assignVideoTrackCommand",streamId:t,videoTrackId:e,enabled:i};this.webSocketAdaptor.send(JSON.stringify(n))}updateVideoTrackAssignments(e,t,i){var n={streamId:e,command:"updateVideoTrackAssignmentsCommand",offset:t,size:i};this.webSocketAdaptor.send(JSON.stringify(n))}setMaxVideoTrackCount(e,t){var i={streamId:e,command:"setMaxVideoTrackCountCommand",maxTrackCount:t};this.webSocketAdaptor.send(JSON.stringify(i))}updateAudioLevel(e,t){var i={streamId:e,eventType:"UPDATE_AUDIO_LEVEL",audioLevel:t};this.sendData(e,JSON.stringify(i))}getDebugInfo(e){var t={streamId:e,command:"getDebugInfo"};this.webSocketAdaptor.send(JSON.stringify(t))}registerPushNotificationToken(e,t,i,n){var r={command:"registerPushNotificationToken",subscriberId:e,token:t,pnsRegistrationToken:i,pnsType:n};this.webSocketAdaptor.send(JSON.stringify(r))}sendPushNotification(e,t,i,n){if("object"!==typeof i)throw B.error("Push Notification Content is not JSON format"),new Error("Push Notification Content is not JSON format");if(!Array.isArray(n))throw B.error("subscriberIdsToNotify is not an array. Please put the subscriber ids to notify in an array such as [user1], [user1, user2]"),new Error("subscriberIdsToNotify is not an array. Please put the subscriber ids to notify in an array such as [user1], [user1, user2]");var r={command:"sendPushNotification",subscriberId:e,token:t,pushNotificationContent:i,subscriberIdsToNotify:n};this.webSocketAdaptor.send(JSON.stringify(r))}sendPushNotificationToTopic(e,t,i,n){if("object"!==typeof i)throw B.error("Push Notification Content is not JSON format"),new Error("Push Notification Content is not JSON format");var r={command:"sendPushNotification",subscriberId:e,token:t,pushNotificationContent:i,topic:n};this.webSocketAdaptor.send(JSON.stringify(r))}turnOffLocalCamera(e){return this.mediaManager.turnOffLocalCamera(e)}turnOnLocalCamera(e){return this.mediaManager.turnOnLocalCamera(e)}muteLocalMic(){this.mediaManager.muteLocalMic()}unmuteLocalMic(){this.mediaManager.unmuteLocalMic()}switchDesktopCapture(e){return this.mediaManager.switchDesktopCapture(e)}switchVideoCameraCapture(e,t,i){return this.mediaManager.switchVideoCameraCapture(e,t,i)}updateVideoTrack(e,t,i,n){return this.mediaManager.updateVideoTrack(e,t,i,n)}updateAudioTrack(e,t,i){return this.mediaManager.updateAudioTrack(e,t,i)}switchVideoCameraFacingMode(e,t){return this.mediaManager.switchVideoCameraFacingMode(e,t)}switchDesktopCaptureWithCamera(e){return this.mediaManager.switchDesktopCaptureWithCamera(e)}switchAudioInputSource(e,t){return this.mediaManager.switchAudioInputSource(e,t)}setVolumeLevel(e){this.mediaManager.setVolumeLevel(e)}enableAudioLevelForLocalStream(e,t){return this.mediaManager.enableAudioLevelForLocalStream(e)}disableAudioLevelForLocalStream(){this.mediaManager.disableAudioLevelForLocalStream()}applyConstraints(e){return this.mediaManager.applyConstraints(e)}changeBandwidth(e,t){this.mediaManager.changeBandwidth(e,t)}enableAudioLevelWhenMuted(){return this.mediaManager.enableAudioLevelWhenMuted()}disableAudioLevelWhenMuted(){this.mediaManager.disableAudioLevelWhenMuted()}getVideoSender(e){return this.mediaManager.getVideoSender(e)}openStream(e,t){return this.mediaManager.openStream(e,t)}closeStream(){return this.mediaManager.closeStream()}}T(W,"pluginInitMethods",new Array);var G="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};(function(){var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){return e==Array.prototype||e==Object.prototype||(e[t]=i.value),e};function n(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof G&&G];for(var t=0;t<e.length;++t){var i=e[t];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")}var r=n(this);function a(e,t){if(t)e:{var n=r;e=e.split(".");for(var a=0;a<e.length-1;a++){var o=e[a];if(!(o in n))break e;n=n[o]}e=e[e.length-1],a=n[e],t=t(a),t!=a&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}function o(e){return e={next:e},e[Symbol.iterator]=function(){return this},e}function s(e){var i="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return i?i.call(e):{next:t(e)}}function c(e){if(!(e instanceof Array)){e=s(e);for(var t,i=[];!(t=e.next()).done;)i.push(t.value);e=i}return e}a("Symbol",(function(e){function t(e){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new n(r+(e||"")+"_"+a++,e)}function n(e,t){this.h=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;n.prototype.toString=function(){return this.h};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",a=0;return t})),a("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),a=0;a<n.length;a++){var s=r[n[a]];"function"===typeof s&&"function"!=typeof s.prototype[e]&&i(s.prototype,e,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return e}));var d="function"==typeof Object.assign?Object.assign:function(e,t){for(var i=1;i<arguments.length;i++){var n=arguments[i];if(n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};a("Object.assign",(function(e){return e||d}));var l,u="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)l=Object.setPrototypeOf;else{var h;e:{var f={a:!0},m={};try{m.__proto__=f,h=m.a;break e}catch(xi){}h=!1}l=h?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var p=l;function v(e,t){if(e.prototype=u(t.prototype),e.prototype.constructor=e,p)p(e,t);else for(var i in t)if("prototype"!=i)if(Object.defineProperties){var n=Object.getOwnPropertyDescriptor(t,i);n&&Object.defineProperty(e,i,n)}else e[i]=t[i];e.za=t.prototype}function g(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function b(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function y(e,t){e.l={ma:t,na:!0},e.h=e.s||e.v}function S(e,t,i){return e.h=i,{value:t}}function w(e){this.h=new g,this.i=e}function k(e,t){b(e.h);var i=e.h.j;return i?C(e,"return"in i?i["return"]:function(e){return{value:e,done:!0}},t,e.h.return):(e.h.return(t),A(e))}function C(e,t,i,n){try{var r=t.call(e.h.j,i);if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");if(!r.done)return e.h.m=!1,r;var a=r.value}catch(o){return e.h.j=null,y(e.h,o),A(e)}return e.h.j=null,n.call(e.h,a),A(e)}function A(e){for(;e.h.h;)try{var t=e.i(e.h);if(t)return e.h.m=!1,{value:t.value,done:!1}}catch(i){e.h.i=void 0,y(e.h,i)}if(e.h.m=!1,e.h.l){if(t=e.h.l,e.h.l=null,t.na)throw t.ma;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function T(e){this.next=function(t){return b(e.h),e.h.j?t=C(e,e.h.j.next,t,e.h.u):(e.h.u(t),t=A(e)),t},this.throw=function(t){return b(e.h),e.h.j?t=C(e,e.h.j["throw"],t,e.h.u):(y(e.h,t),t=A(e)),t},this.return=function(t){return k(e,t)},this[Symbol.iterator]=function(){return this}}function E(e){function t(t){return e.next(t)}function i(t){return e.throw(t)}return new Promise((function(n,r){function a(e){e.done?n(e.value):Promise.resolve(e.value).then(t,i).then(a,r)}a(e.next())}))}function P(e){return E(new T(new w(e)))}function I(e,t){e instanceof String&&(e+="");var i=0,n=!1,r={next:function(){if(!n&&i<e.length){var r=i++;return{value:t(r,e[r]),done:!1}}return n=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}function R(e){return e||Array.prototype.fill}g.prototype.u=function(e){this.i=e},g.prototype.return=function(e){this.l={return:e},this.h=this.v},a("Promise",(function(e){function t(e){this.i=0,this.j=void 0,this.h=[],this.u=!1;var t=this.l();try{e(t.resolve,t.reject)}catch(i){t.reject(i)}}function i(){this.h=null}function n(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;i.prototype.i=function(e){if(null==this.h){this.h=[];var t=this;this.j((function(){t.m()}))}this.h.push(e)};var a=r.setTimeout;i.prototype.j=function(e){a(e,0)},i.prototype.m=function(){for(;this.h&&this.h.length;){var e=this.h;this.h=[];for(var t=0;t<e.length;++t){var i=e[t];e[t]=null;try{i()}catch(n){this.l(n)}}}this.h=null},i.prototype.l=function(e){this.j((function(){throw e}))},t.prototype.l=function(){function e(e){return function(n){i||(i=!0,e.call(t,n))}}var t=this,i=!1;return{resolve:e(this.I),reject:e(this.m)}},t.prototype.I=function(e){if(e===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.L(e);else{e:switch(typeof e){case"object":var i=null!=e;break e;case"function":i=!0;break e;default:i=!1}i?this.F(e):this.s(e)}},t.prototype.F=function(e){var t=void 0;try{t=e.then}catch(i){return void this.m(i)}"function"==typeof t?this.M(t,e):this.s(e)},t.prototype.m=function(e){this.v(2,e)},t.prototype.s=function(e){this.v(1,e)},t.prototype.v=function(e,t){if(0!=this.i)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.i);this.i=e,this.j=t,2===this.i&&this.K(),this.H()},t.prototype.K=function(){var e=this;a((function(){if(e.D()){var t=r.console;"undefined"!==typeof t&&t.error(e.j)}}),1)},t.prototype.D=function(){if(this.u)return!1;var e=r.CustomEvent,t=r.Event,i=r.dispatchEvent;return"undefined"===typeof i||("function"===typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"===typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=r.document.createEvent("CustomEvent"),e.initCustomEvent("unhandledrejection",!1,!0,e)),e.promise=this,e.reason=this.j,i(e))},t.prototype.H=function(){if(null!=this.h){for(var e=0;e<this.h.length;++e)o.i(this.h[e]);this.h=null}};var o=new i;return t.prototype.L=function(e){var t=this.l();e.T(t.resolve,t.reject)},t.prototype.M=function(e,t){var i=this.l();try{e.call(t,i.resolve,i.reject)}catch(n){i.reject(n)}},t.prototype.then=function(e,i){function n(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(i){a(i)}}:t}var r,a,o=new t((function(e,t){r=e,a=t}));return this.T(n(e,r),n(i,a)),o},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.T=function(e,t){function i(){switch(n.i){case 1:e(n.j);break;case 2:t(n.j);break;default:throw Error("Unexpected state: "+n.i)}}var n=this;null==this.h?o.i(i):this.h.push(i),this.u=!0},t.resolve=n,t.reject=function(e){return new t((function(t,i){i(e)}))},t.race=function(e){return new t((function(t,i){for(var r=s(e),a=r.next();!a.done;a=r.next())n(a.value).T(t,i)}))},t.all=function(e){var i=s(e),r=i.next();return r.done?n([]):new t((function(e,t){function a(t){return function(i){o[t]=i,s--,0==s&&e(o)}}var o=[],s=0;do{o.push(void 0),s++,n(r.value).T(a(o.length-1),t),r=i.next()}while(!r.done)}))},t})),a("Array.prototype.keys",(function(e){return e||function(){return I(this,(function(e){return e}))}})),a("Array.prototype.fill",(function(e){return e||function(e,t,i){var n=this.length||0;for(0>t&&(t=Math.max(0,n+t)),(null==i||i>n)&&(i=n),i=Number(i),0>i&&(i=Math.max(0,n+i)),t=Number(t||0);t<i;t++)this[t]=e;return this}})),a("Int8Array.prototype.fill",R),a("Uint8Array.prototype.fill",R),a("Uint8ClampedArray.prototype.fill",R),a("Int16Array.prototype.fill",R),a("Uint16Array.prototype.fill",R),a("Int32Array.prototype.fill",R),a("Uint32Array.prototype.fill",R),a("Float32Array.prototype.fill",R),a("Float64Array.prototype.fill",R),a("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}})),a("Array.prototype.includes",(function(e){return e||function(e,t){var i=this;i instanceof String&&(i=String(i));var n=i.length;for(t=t||0,0>t&&(t=Math.max(t+n,0));t<n;t++){var r=i[t];if(r===e||Object.is(r,e))return!0}return!1}})),a("String.prototype.includes",(function(e){return e||function(e,t){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(e,t||0)}}));var L=this||self;function M(e,t){e=e.split(".");var i,n=L;e[0]in n||"undefined"==typeof n.execScript||n.execScript("var "+e[0]);for(;e.length&&(i=e.shift());)e.length||void 0===t?n=n[i]&&n[i]!==Object.prototype[i]?n[i]:n[i]={}:n[i]=t}function O(e){var t;return(t=L.navigator)&&(t=t.userAgent)||(t=""),-1!=t.indexOf(e)}var D=Array.prototype.map?function(e,t){return Array.prototype.map.call(e,t,void 0)}:function(e,t){for(var i=e.length,n=Array(i),r="string"===typeof e?e.split(""):e,a=0;a<i;a++)a in r&&(n[a]=t.call(void 0,r[a],a,e));return n},x={},N=null;function F(e){var t=e.length,i=3*t/4;i%3?i=Math.floor(i):-1!="=.".indexOf(e[t-1])&&(i=-1!="=.".indexOf(e[t-2])?i-2:i-1);var n=new Uint8Array(i),r=0;return _(e,(function(e){n[r++]=e})),r!==i?n.subarray(0,r):n}function _(e,t){function i(t){for(;n<e.length;){var i=e.charAt(n++),r=N[i];if(null!=r)return r;if(!/^[\s\xa0]*$/.test(i))throw Error("Unknown base64 encoding at char: "+i)}return t}j();for(var n=0;;){var r=i(-1),a=i(0),o=i(64),s=i(64);if(64===s&&-1===r)break;t(r<<2|a>>4),64!=o&&(t(a<<4&240|o>>2),64!=s&&t(o<<6&192|s))}}function j(){if(!N){N={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],i=0;5>i;i++){var n=e.concat(t[i].split(""));x[i]=n;for(var r=0;r<n.length;r++){var a=n[r];void 0===N[a]&&(N[a]=r)}}}}var V="undefined"!==typeof Uint8Array,B=!(O("Trident")||O("MSIE"))&&"function"===typeof L.btoa;function U(e){if(!B){var t;void 0===t&&(t=0),j(),t=x[t];for(var i=Array(Math.floor(e.length/3)),n=t[64]||"",r=0,a=0;r<e.length-2;r+=3){var o=e[r],s=e[r+1],c=e[r+2],d=t[o>>2];o=t[(3&o)<<4|s>>4],s=t[(15&s)<<2|c>>6],c=t[63&c],i[a++]=d+o+s+c}switch(d=0,c=n,e.length-r){case 2:d=e[r+1],c=t[(15&d)<<2]||n;case 1:e=e[r],i[a]=t[e>>2]+t[(3&e)<<4|d>>4]+c+n}return i.join("")}for(t="";10240<e.length;)t+=String.fromCharCode.apply(null,e.subarray(0,10240)),e=e.subarray(10240);return t+=String.fromCharCode.apply(null,e),btoa(t)}var W,J=RegExp("[-_.]","g");function z(e){switch(e){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function H(e){if(!B)return F(e);J.test(e)&&(e=e.replace(J,z)),e=atob(e);for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}function K(){return W||(W=new Uint8Array(0))}var q={},X="function"===typeof Uint8Array.prototype.slice,Y=0,Z=0;function Q(e){var t=0>e;e=Math.abs(e);var i=e>>>0;e=Math.floor((e-i)/4294967296),t&&(i=s(te(i,e)),t=i.next().value,e=i.next().value,i=t),Y=i>>>0,Z=e>>>0}var $,ee="function"===typeof BigInt;function te(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}function ie(e,t){this.i=e>>>0,this.h=t>>>0}function ne(e){if(!e)return $||($=new ie(0,0));if(!/^-?\d+$/.test(e))return null;if(16>e.length)Q(Number(e));else if(ee)e=BigInt(e),Y=Number(e&BigInt(4294967295))>>>0,Z=Number(e>>BigInt(32)&BigInt(4294967295));else{var t=+("-"===e[0]);Z=Y=0;for(var i=e.length,n=t,r=(i-t)%6+t;r<=i;n=r,r+=6)n=Number(e.slice(n,r)),Z*=1e6,Y=1e6*Y+n,4294967296<=Y&&(Z+=Y/4294967296|0,Y%=4294967296);t&&(t=s(te(Y,Z)),e=t.next().value,t=t.next().value,Y=e,Z=t)}return new ie(Y,Z)}function re(e,t){return Error("Invalid wire type: "+e+" (at position "+t+")")}function ae(){return Error("Failed to read varint, encoding is invalid.")}function oe(e,t){return Error("Tried to read past the end of the data "+t+" > "+e)}function se(){throw Error("Invalid UTF8")}function ce(e,t){return t=String.fromCharCode.apply(null,t),null==e?t:e+t}var de,le,ue,he=void 0,fe="undefined"!==typeof TextDecoder,me="undefined"!==typeof TextEncoder;function pe(e){if(e!==q)throw Error("illegal external caller")}function ve(e,t){if(pe(t),this.V=e,null!=e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}function ge(){return ue||(ue=new ve(null,q))}function be(e){pe(q);var t=e.V;return t=null==t||V&&null!=t&&t instanceof Uint8Array?t:"string"===typeof t?H(t):null,null==t?t:e.V=t}function ye(e){if("string"===typeof e)return{buffer:H(e),C:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),C:!1};if(e.constructor===Uint8Array)return{buffer:e,C:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),C:!1};if(e.constructor===ve)return{buffer:be(e)||K(),C:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Se(e,t){this.i=null,this.m=!1,this.h=this.j=this.l=0,we(this,e,t)}function we(e,t,i){i=void 0===i?{}:i,e.S=void 0!==i.S&&i.S,t&&(t=ye(t),e.i=t.buffer,e.m=t.C,e.l=0,e.j=e.i.length,e.h=e.l)}function ke(e,t){if(e.h=t,t>e.j)throw oe(e.j,t)}function Ce(e){var t=e.i,i=e.h,n=t[i++],r=127&n;if(128&n&&(n=t[i++],r|=(127&n)<<7,128&n&&(n=t[i++],r|=(127&n)<<14,128&n&&(n=t[i++],r|=(127&n)<<21,128&n&&(n=t[i++],r|=n<<28,128&n&&128&t[i++]&&128&t[i++]&&128&t[i++]&&128&t[i++]&&128&t[i++])))))throw ae();return ke(e,i),r}function Ae(e,t){if(0>t)throw Error("Tried to read a negative byte length: "+t);var i=e.h,n=i+t;if(n>e.j)throw oe(t,e.j-i);return e.h=n,i}Se.prototype.reset=function(){this.h=this.l};var Te=[];function Ee(){this.h=[]}function Pe(e,t,i){for(;0<i||127<t;)e.h.push(127&t|128),t=(t>>>7|i<<25)>>>0,i>>>=7;e.h.push(t)}function Ie(e,t){for(;127<t;)e.h.push(127&t|128),t>>>=7;e.h.push(t)}function Re(e,t){if(Te.length){var i=Te.pop();we(i,e,t),e=i}else e=new Se(e,t);this.h=e,this.j=this.h.h,this.i=this.l=-1,this.setOptions(t)}function Le(e){var t=e.h;if(t.h==t.j)return!1;e.j=e.h.h;var i=Ce(e.h)>>>0;if(t=i>>>3,i&=7,!(0<=i&&5>=i))throw re(i,e.j);if(1>t)throw Error("Invalid field number: "+t+" (at position "+e.j+")");return e.l=t,e.i=i,!0}function Me(e){switch(e.i){case 0:if(0!=e.i)Me(e);else e:{e=e.h;for(var t=e.h,i=t+10,n=e.i;t<i;)if(0===(128&n[t++])){ke(e,t);break e}throw ae()}break;case 1:e=e.h,ke(e,e.h+8);break;case 2:2!=e.i?Me(e):(t=Ce(e.h)>>>0,e=e.h,ke(e,e.h+t));break;case 5:e=e.h,ke(e,e.h+4);break;case 3:t=e.l;do{if(!Le(e))throw Error("Unmatched start-group tag: stream EOF");if(4==e.i){if(e.l!=t)throw Error("Unmatched end-group tag");break}Me(e)}while(1);break;default:throw re(e.i,e.j)}}Ee.prototype.length=function(){return this.h.length},Ee.prototype.end=function(){var e=this.h;return this.h=[],e},Re.prototype.setOptions=function(e){e=void 0===e?{}:e,this.ca=void 0!==e.ca&&e.ca},Re.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};var Oe=[];function De(){this.j=[],this.i=0,this.h=new Ee}function xe(e,t){0!==t.length&&(e.j.push(t),e.i+=t.length)}function Ne(e,t){if(t=t.R){xe(e,e.h.end());for(var i=0;i<t.length;i++)xe(e,be(t[i])||K())}}var Fe="function"===typeof Symbol&&"symbol"===typeof Symbol()?Symbol():void 0;function _e(e,t){return Fe?e[Fe]|=t:void 0!==e.A?e.A|=t:(Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}}),t)}function je(e,t){Fe?e[Fe]&&(e[Fe]&=~t):void 0!==e.A&&(e.A&=~t)}function Ve(e){var t;return t=Fe?e[Fe]:e.A,null==t?0:t}function Be(e,t){Fe?e[Fe]=t:void 0!==e.A?e.A=t:Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}})}function Ue(e){return _e(e,1),e}function We(e,t){Be(t,-51&e)}function Ge(e,t){Be(t,-41&e|18)}var Je={};function ze(e){return null!==e&&"object"===typeof e&&!Array.isArray(e)&&e.constructor===Object}var He,Ke,qe=[];function Xe(e){if(2&Ve(e.o))throw Error("Cannot mutate an immutable Message")}function Ye(e){var t=e.length;(t=t?e[t-1]:void 0)&&ze(t)?t.g=1:(t={},e.push((t.g=1,t)))}function Ze(e){var t=e.i+e.G;return e.B||(e.B=e.o[t]={})}function Qe(e,t){return-1===t?null:t>=e.i?e.B?e.B[t]:void 0:e.o[t+e.G]}function $e(e,t,i,n){Xe(e),et(e,t,i,n)}function et(e,t,i,n){e.j&&(e.j=void 0),t>=e.i||n?Ze(e)[t]=i:(e.o[t+e.G]=i,(e=e.B)&&t in e&&delete e[t])}function tt(e,t,i,n){var r=Qe(e,t);Array.isArray(r)||(r=He);var a=Ve(r);if(1&a||Ue(r),n)2&a||_e(r,2),1&i||Object.freeze(r);else{n=!(2&i);var o=2&a;1&i||!o?n&&16&a&&!o&&je(r,16):(r=Ue(Array.prototype.slice.call(r)),et(e,t,r))}return r}function it(e,t){var i=Qe(e,t),n=null==i?i:"number"===typeof i||"NaN"===i||"Infinity"===i||"-Infinity"===i?Number(i):void 0;return null!=n&&n!==i&&et(e,t,n),n}function nt(e,t,i,n,r){e.h||(e.h={});var a=e.h[i],o=tt(e,i,3,r);if(!a){var s=o;a=[];var c=!!(16&Ve(e.o));o=!!(2&Ve(s));var d=s;!r&&o&&(s=Array.prototype.slice.call(s));for(var l=o,u=0;u<s.length;u++){var h=s[u],f=t,m=!1;if(m=void 0!==m&&m,h=Array.isArray(h)?new f(h):m?new f:void 0,void 0!==h){f=h.o;var p=m=Ve(f);o&&(p|=2),c&&(p|=16),p!=m&&Be(f,p),f=p,l=l||!!(2&f),a.push(h)}}return e.h[i]=a,c=Ve(s),t=33|c,t=l?-9&t:8|t,c!=t&&(l=s,Object.isFrozen(l)&&(l=Array.prototype.slice.call(l)),Be(l,t),s=l),d!==s&&et(e,i,s),(r||n&&o)&&_e(a,2),n&&Object.freeze(a),a}return r||(r=Object.isFrozen(a),n&&!r?Object.freeze(a):!n&&r&&(a=Array.prototype.slice.call(a),e.h[i]=a)),a}function rt(e,t,i){var n=!!(2&Ve(e.o));if(t=nt(e,t,i,n,n),e=tt(e,i,3,n),!(n||8&Ve(e))){for(n=0;n<t.length;n++){if(i=t[n],2&Ve(i.o)){var r=gt(i,!1);r.j=i}else r=i;i!==r&&(t[n]=r,e[n]=r.o)}_e(e,8)}return t}function at(e,t,i){if(null!=i&&"number"!==typeof i)throw Error("Value of float/double field must be a number|null|undefined, found "+typeof i+": "+i);$e(e,t,i)}function ot(e,t,i,n,r){Xe(e);var a=nt(e,i,t,!1,!1);return i=null!=n?n:new i,e=tt(e,t,2,!1),void 0!=r?(a.splice(r,0,i),e.splice(r,0,i.o)):(a.push(i),e.push(i.o)),i.C()&&je(e,8),i}function st(e,t){return null==e?t:e}function ct(e,t,i){return i=void 0===i?0:i,st(it(e,t),i)}function dt(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"object":if(e)if(Array.isArray(e)){if(0!==(128&Ve(e)))return e=Array.prototype.slice.call(e),Ye(e),e}else{if(V&&null!=e&&e instanceof Uint8Array)return U(e);if(e instanceof ve){var t=e.V;return null==t?"":"string"===typeof t?t:e.V=U(t)}}}return e}function lt(e,t,i,n){if(null!=e){if(Array.isArray(e))e=ut(e,t,i,void 0!==n);else if(ze(e)){var r,a={};for(r in e)a[r]=lt(e[r],t,i,n);e=a}else e=t(e,n);return e}}function ut(e,t,i,n){var r=Ve(e);n=n?!!(16&r):void 0,e=Array.prototype.slice.call(e);for(var a=0;a<e.length;a++)e[a]=lt(e[a],t,i,n);return i(r,e),e}function ht(e){return e.ja===Je?e.toJSON():dt(e)}function ft(e,t){128&e&&Ye(t)}function mt(e,t,i){if(i=void 0===i?Ge:i,null!=e){if(V&&e instanceof Uint8Array)return e.length?new ve(new Uint8Array(e),q):ge();if(Array.isArray(e)){var n=Ve(e);return 2&n?e:!t||32&n||!(16&n||0===n)?(e=ut(e,mt,4&n?Ge:i,!0),t=Ve(e),4&t&&2&t&&Object.freeze(e),e):(Be(e,2|n),e)}return e.ja===Je?vt(e):e}}function pt(e,t,i,n,r,a,o){if(e=e.h&&e.h[i]){if(n=Ve(e),2&n?n=e:(a=D(e,vt),Ge(n,a),Object.freeze(a),n=a),Xe(t),o=null==n?He:Ue([]),null!=n){for(a=!!n.length,e=0;e<n.length;e++){var s=n[e];a=a&&!(2&Ve(s.o)),o[e]=s.o}a=1|(a?8:0),e=Ve(o),(e&a)!==a&&(Object.isFrozen(o)&&(o=Array.prototype.slice.call(o)),Be(o,e|a)),t.h||(t.h={}),t.h[i]=n}else t.h&&(t.h[i]=void 0);et(t,i,o,r)}else $e(t,i,mt(n,a,o),r)}function vt(e){return 2&Ve(e.o)||(e=gt(e,!0),_e(e.o,2)),e}function gt(e,t){var i=e.o,n=[];_e(n,16);var r=e.constructor.h;if(r&&n.push(r),r=e.B,r){n.length=i.length,n.fill(void 0,n.length,i.length);var a={};n[n.length-1]=a}0!==(128&Ve(i))&&Ye(n),t=t||e.C()?Ge:We,a=e.constructor,Ke=n,n=new a(n),Ke=void 0,e.R&&(n.R=e.R.slice()),a=!!(16&Ve(i));for(var o=r?i.length-1:i.length,s=0;s<o;s++)pt(e,n,s-e.G,i[s],!1,a,t);if(r)for(var c in r)pt(e,n,+c,r[c],!0,a,t);return n}function bt(e,t,i){null==e&&(e=Ke),Ke=void 0;var n,r=this.constructor.i||0,a=0<r,o=this.constructor.h,s=!1;if(null==e){e=o?[o]:[];var c=48,d=!0;a&&(r=0,c|=128),Be(e,c)}else{if(!Array.isArray(e))throw Error();if(o&&o!==e[0])throw Error();var l=c=_e(e,0);if((d=0!==(16&l))&&((s=0!==(32&l))||(l|=32)),a){if(128&l)r=0;else if(0<e.length){var u=e[e.length-1];if(ze(u)&&"g"in u){r=0,l|=128,delete u.g;var h,f=!0;for(h in u){f=!1;break}f&&e.pop()}}}else if(128&l)throw Error();c!==l&&Be(e,l)}if(this.G=(o?0:-1)-r,this.h=void 0,this.o=e,o=this.o.length,r=o-1,o&&(o=this.o[r],ze(o))?(this.B=o,this.i=r-this.G):void 0!==t&&-1<t?(this.i=Math.max(t,r+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE,!a&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(i)for(t=d&&!s&&!0,a=this.i,d=0;d<i.length;d++)s=i[d],s<a?(s+=this.G,(r=e[s])?yt(r,t):e[s]=He):(n||(n=Ze(this)),(r=n[s])?yt(r,t):n[s]=He)}function yt(e,t){if(Array.isArray(e)){var i=Ve(e),n=1;!t||2&i||(n|=16),(i&n)!==n&&Be(e,i|n)}}function St(e,t,i){if(i){var n,r={};for(n in i){var a=i[n],o=a.ra;o||(r.J=a.xa||a.oa.W,a.ia?(r.aa=Rt(a.ia),o=function(e){return function(t,i,n){return e.J(t,i,n,e.aa)}}(r)):a.ka?(r.Z=Lt(a.da.P,a.ka),o=function(e){return function(t,i,n){return e.J(t,i,n,e.Z)}}(r)):o=r.J,a.ra=o),o(t,e,a.da),r={J:r.J,aa:r.aa,Z:r.Z}}}Ne(t,e)}Be(qe,23),He=Object.freeze(qe),bt.prototype.toJSON=function(){return ut(this.o,ht,ft)},bt.prototype.C=function(){return!!(2&Ve(this.o))},bt.prototype.ja=Je,bt.prototype.toString=function(){return this.o.toString()};var wt=Symbol();function kt(e,t,i){return e[wt]||(e[wt]=function(e,n){return t(e,n,i)})}function Ct(e){var t=e[wt];if(!t){var i=Wt(e);t=function(e,t){return Gt(e,t,i)},e[wt]=t}return t}function At(e){var t=e.ia;return t?Ct(t):(t=e.wa)?kt(e.da.P,t,e.ka):void 0}function Tt(e){var t=At(e),i=e.da,n=e.oa.U;return t?function(e,r){return n(e,r,i,t)}:function(e,t){return n(e,t,i)}}function Et(e,t){var i=e[t];return"function"==typeof i&&0===i.length&&(i=i(),e[t]=i),Array.isArray(i)&&(_t in i||Mt in i||0<i.length&&"function"==typeof i[0])?i:void 0}function Pt(e,t,i,n,r,a){t.P=e[0];var o=1;if(e.length>o&&"number"!==typeof e[o]){var s=e[o++];i(t,s)}for(;o<e.length;){i=e[o++];for(var c=o+1;c<e.length&&"number"!==typeof e[c];)c++;switch(s=e[o++],c-=o,c){case 0:n(t,i,s);break;case 1:(c=Et(e,o))?(o++,r(t,i,s,c)):n(t,i,s,e[o++]);break;case 2:c=o++,c=Et(e,c),r(t,i,s,c,e[o++]);break;case 3:a(t,i,s,e[o++],e[o++],e[o++]);break;case 4:a(t,i,s,e[o++],e[o++],e[o++],e[o++]);break;default:throw Error("unexpected number of binary field arguments: "+c)}}return t}var It=Symbol();function Rt(e){var t=e[It];if(!t){var i=Ft(e);t=function(e,t){return Jt(e,t,i)},e[It]=t}return t}function Lt(e,t){var i=e[It];return i||(i=function(e,i){return St(e,i,t)},e[It]=i),i}var Mt=Symbol();function Ot(e,t){e.push(t)}function Dt(e,t,i){e.push(t,i.W)}function xt(e,t,i,n){var r=Rt(n),a=Ft(n).P,o=i.W;e.push(t,(function(e,t,i){return o(e,t,i,a,r)}))}function Nt(e,t,i,n,r,a){var o=Lt(n,a),s=i.W;e.push(t,(function(e,t,i){return s(e,t,i,n,o)}))}function Ft(e){var t=e[Mt];return t||(t=Pt(e,e[Mt]=[],Ot,Dt,xt,Nt),_t in e&&Mt in e&&(e.length=0),t)}var _t=Symbol();function jt(e,t){e[0]=t}function Vt(e,t,i,n){var r=i.U;e[t]=n?function(e,t,i){return r(e,t,i,n)}:r}function Bt(e,t,i,n,r){var a=i.U,o=Ct(n),s=Wt(n).P;e[t]=function(e,t,i){return a(e,t,i,s,o,r)}}function Ut(e,t,i,n,r,a,o){var s=i.U,c=kt(n,r,a);e[t]=function(e,t,i){return s(e,t,i,n,c,o)}}function Wt(e){var t=e[_t];return t||(t=Pt(e,e[_t]={},jt,Vt,Bt,Ut),_t in e&&Mt in e&&(e.length=0),t)}function Gt(e,t,i){for(;Le(t)&&4!=t.i;){var n=t.l,r=i[n];if(!r){var a=i[0];a&&(a=a[n])&&(r=i[n]=Tt(a))}if(!r||!r(t,e,n)){r=t,n=e,a=r.j,Me(r);var o=r;if(!o.ca){if(r=o.h.h-a,o.h.h=a,o=o.h,0==r)r=ge();else{if(a=Ae(o,r),o.S&&o.m)r=o.i.subarray(a,a+r);else{o=o.i;var s=a;r=a+r,r=s===r?K():X?o.slice(s,r):new Uint8Array(o.subarray(s,r))}r=0==r.length?ge():new ve(r,q)}(a=n.R)?a.push(r):n.R=[r]}}}return e}function Jt(e,t,i){for(var n=i.length,r=1==n%2,a=r?1:0;a<n;a+=2)(0,i[a+1])(t,e,i[a]);St(e,t,r?i[0]:void 0)}function zt(e,t){return{U:e,W:t}}var Ht=zt((function(e,t,i){if(5!==e.i)return!1;e=e.h;var n=e.i,r=e.h,a=n[r],o=n[r+1],s=n[r+2];return n=n[r+3],ke(e,e.h+4),o=(a|o<<8|s<<16|n<<24)>>>0,e=2*(o>>31)+1,a=o>>>23&255,o&=8388607,$e(t,i,255==a?o?NaN:1/0*e:0==a?e*Math.pow(2,-149)*o:e*Math.pow(2,a-150)*(o+Math.pow(2,23))),!0}),(function(e,t,i){if(t=it(t,i),null!=t){Ie(e.h,8*i+5),e=e.h;var n=+t;0===n?0<1/n?Y=Z=0:(Z=0,Y=2147483648):isNaN(n)?(Z=0,Y=2147483647):(n=(i=0>n?-2147483648:0)?-n:n,34028234663852886e22<n?(Z=0,Y=(2139095040|i)>>>0):11754943508222875e-54>n?(n=Math.round(n/Math.pow(2,-149)),Z=0,Y=(i|n)>>>0):(t=Math.floor(Math.log(n)/Math.LN2),n*=Math.pow(2,-t),n=Math.round(8388608*n),16777216<=n&&++t,Z=0,Y=(i|t+127<<23|8388607&n)>>>0)),i=Y,e.h.push(i>>>0&255),e.h.push(i>>>8&255),e.h.push(i>>>16&255),e.h.push(i>>>24&255)}})),Kt=zt((function(e,t,i){if(0!==e.i)return!1;var n=e.h,r=0,a=e=0,o=n.i,s=n.h;do{var c=o[s++];r|=(127&c)<<a,a+=7}while(32>a&&128&c);for(32<a&&(e|=(127&c)>>4),a=3;32>a&&128&c;a+=7)c=o[s++],e|=(127&c)<<a;if(ke(n,s),!(128>c))throw ae();return n=r>>>0,c=e>>>0,(e=2147483648&c)&&(n=1+~n>>>0,c=~c>>>0,0==n&&(c=c+1>>>0)),n=4294967296*c+(n>>>0),$e(t,i,e?-n:n),!0}),(function(e,t,i){t=Qe(t,i),null!=t&&("string"===typeof t&&ne(t),null!=t&&(Ie(e.h,8*i),"number"===typeof t?(e=e.h,Q(t),Pe(e,Y,Z)):(i=ne(t),Pe(e.h,i.i,i.h))))})),qt=zt((function(e,t,i){return 0===e.i&&($e(t,i,Ce(e.h)),!0)}),(function(e,t,i){if(t=Qe(t,i),null!=t&&null!=t)if(Ie(e.h,8*i),e=e.h,i=t,0<=i)Ie(e,i);else{for(t=0;9>t;t++)e.h.push(127&i|128),i>>=7;e.h.push(1)}})),Xt=zt((function(e,t,i){if(2!==e.i)return!1;var n=Ce(e.h)>>>0;e=e.h;var r=Ae(e,n);if(e=e.i,fe){var a,o=e;(a=de)||(a=de=new TextDecoder("utf-8",{fatal:!0})),e=r+n,o=0===r&&e===o.length?o:o.subarray(r,e);try{var s=a.decode(o)}catch(u){if(void 0===he){try{a.decode(new Uint8Array([128]))}catch(h){}try{a.decode(new Uint8Array([97])),he=!0}catch(h){he=!1}}throw!he&&(de=void 0),u}}else{s=r,n=s+n,r=[];for(var c,d,l=null;s<n;)c=e[s++],128>c?r.push(c):224>c?s>=n?se():(d=e[s++],194>c||128!==(192&d)?(s--,se()):r.push((31&c)<<6|63&d)):240>c?s>=n-1?se():(d=e[s++],128!==(192&d)||224===c&&160>d||237===c&&160<=d||128!==(192&(o=e[s++]))?(s--,se()):r.push((15&c)<<12|(63&d)<<6|63&o)):244>=c?s>=n-2?se():(d=e[s++],128!==(192&d)||0!==d-144+(c<<28)>>30||128!==(192&(o=e[s++]))||128!==(192&(a=e[s++]))?(s--,se()):(c=(7&c)<<18|(63&d)<<12|(63&o)<<6|63&a,c-=65536,r.push(55296+(c>>10&1023),56320+(1023&c)))):se(),8192<=r.length&&(l=ce(l,r),r.length=0);s=ce(l,r)}return $e(t,i,s),!0}),(function(e,t,i){if(t=Qe(t,i),null!=t){var n=!1;if(n=void 0!==n&&n,me){if(n&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(t))throw Error("Found an unpaired surrogate");t=(le||(le=new TextEncoder)).encode(t)}else{for(var r=0,a=new Uint8Array(3*t.length),o=0;o<t.length;o++){var s=t.charCodeAt(o);if(128>s)a[r++]=s;else{if(2048>s)a[r++]=s>>6|192;else{if(55296<=s&&57343>=s){if(56319>=s&&o<t.length){var c=t.charCodeAt(++o);if(56320<=c&&57343>=c){s=1024*(s-55296)+c-56320+65536,a[r++]=s>>18|240,a[r++]=s>>12&63|128,a[r++]=s>>6&63|128,a[r++]=63&s|128;continue}o--}if(n)throw Error("Found an unpaired surrogate");s=65533}a[r++]=s>>12|224,a[r++]=s>>6&63|128}a[r++]=63&s|128}}t=r===a.length?a:a.subarray(0,r)}Ie(e.h,8*i+2),Ie(e.h,t.length),xe(e,e.h.end()),xe(e,t)}})),Yt=zt((function(e,t,i,n,r){if(2!==e.i)return!1;t=ot(t,i,n),i=e.h.j,n=Ce(e.h)>>>0;var a=e.h.h+n,o=a-i;if(0>=o&&(e.h.j=a,r(t,e,void 0,void 0,void 0),o=a-e.h.h),o)throw Error("Message parsing ended unexpectedly. Expected to read "+n+" bytes, instead read "+(n-o)+" bytes, either the data ended unexpectedly or the message misreported its own length");return e.h.h=a,e.h.j=i,!0}),(function(e,t,i,n,r){if(t=rt(t,n,i),null!=t)for(n=0;n<t.length;n++){var a=e;Ie(a.h,8*i+2);var o=a.h.end();xe(a,o),o.push(a.i),a=o,r(t[n],e),o=e;var s=a.pop();for(s=o.i+o.h.length()-s;127<s;)a.push(127&s|128),s>>>=7,o.i++;a.push(s),o.i++}}));function Zt(e){return function(t,i){e:{if(Oe.length){var n=Oe.pop();n.setOptions(i),we(n.h,t,i),t=n}else t=new Re(t,i);try{var r=Wt(e),a=Gt(new r.P,t,r);break e}finally{r=t.h,r.i=null,r.m=!1,r.l=0,r.j=0,r.h=0,r.S=!1,t.l=-1,t.i=-1,100>Oe.length&&Oe.push(t)}a=void 0}return a}}function Qt(e){return function(){var t=new De;Jt(this,t,Ft(e)),xe(t,t.h.end());for(var i=new Uint8Array(t.i),n=t.j,r=n.length,a=0,o=0;o<r;o++){var s=n[o];i.set(s,a),a+=s.length}return t.j=[i],i}}function $t(e){bt.call(this,e)}v($t,bt);var ei=[$t,1,qt,2,Ht,3,Xt,4,Xt];function ti(e){bt.call(this,e,-1,ii)}$t.prototype.l=Qt(ei),v(ti,bt),ti.prototype.addClassification=function(e,t){return ot(this,1,$t,e,t),this};var ii=[1],ni=Zt([ti,1,Yt,ei]);function ri(e){bt.call(this,e)}v(ri,bt);var ai=[ri,1,Ht,2,Ht,3,Ht,4,Ht,5,Ht];function oi(e){bt.call(this,e,-1,si)}ri.prototype.l=Qt(ai),v(oi,bt);var si=[1],ci=Zt([oi,1,Yt,ai]);function di(e){bt.call(this,e)}v(di,bt);var li=[di,1,Ht,2,Ht,3,Ht,4,Ht,5,Ht,6,Kt],ui=Zt(li);function hi(e,t,i){if(i=e.createShader(0===i?e.VERTEX_SHADER:e.FRAGMENT_SHADER),e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+e.getShaderInfoLog(i));return i}function fi(e){return rt(e,$t,1).map((function(e){var t=Qe(e,1);return{index:null==t?0:t,qa:ct(e,2),label:null!=Qe(e,3)?st(Qe(e,3),""):void 0,displayName:null!=Qe(e,4)?st(Qe(e,4),""):void 0}}))}function mi(e){return{x:ct(e,1),y:ct(e,2),z:ct(e,3),visibility:null!=it(e,4)?ct(e,4):void 0}}function pi(e,t){this.i=e,this.h=t,this.m=0}function vi(e,t,i){return gi(e,t),"function"===typeof e.h.canvas.transferToImageBitmap?Promise.resolve(e.h.canvas.transferToImageBitmap()):i?Promise.resolve(e.h.canvas):"function"===typeof createImageBitmap?createImageBitmap(e.h.canvas):(void 0===e.j&&(e.j=document.createElement("canvas")),new Promise((function(t){e.j.height=e.h.canvas.height,e.j.width=e.h.canvas.width,e.j.getContext("2d",{}).drawImage(e.h.canvas,0,0,e.h.canvas.width,e.h.canvas.height),t(e.j)})))}function gi(e,t){var i=e.h;if(void 0===e.s){var n=hi(i,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),r=hi(i,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),a=i.createProgram();if(i.attachShader(a,n),i.attachShader(a,r),i.linkProgram(a),!i.getProgramParameter(a,i.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+i.getProgramInfoLog(a));n=e.s=a,i.useProgram(n),r=i.getUniformLocation(n,"sampler0"),e.l={O:i.getAttribLocation(n,"aVertex"),N:i.getAttribLocation(n,"aTex"),ya:r},e.v=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,e.v),i.enableVertexAttribArray(e.l.O),i.vertexAttribPointer(e.l.O,2,i.FLOAT,!1,0,0),i.bufferData(i.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null),e.u=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,e.u),i.enableVertexAttribArray(e.l.N),i.vertexAttribPointer(e.l.N,2,i.FLOAT,!1,0,0),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null),i.uniform1i(r,0)}n=e.l,i.useProgram(e.s),i.canvas.width=t.width,i.canvas.height=t.height,i.viewport(0,0,t.width,t.height),i.activeTexture(i.TEXTURE0),e.i.bindTexture2d(t.glName),i.enableVertexAttribArray(n.O),i.bindBuffer(i.ARRAY_BUFFER,e.v),i.vertexAttribPointer(n.O,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(n.N),i.bindBuffer(i.ARRAY_BUFFER,e.u),i.vertexAttribPointer(n.N,2,i.FLOAT,!1,0,0),i.bindFramebuffer(i.DRAW_FRAMEBUFFER?i.DRAW_FRAMEBUFFER:i.FRAMEBUFFER,null),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.colorMask(!0,!0,!0,!0),i.drawArrays(i.TRIANGLE_FAN,0,4),i.disableVertexAttribArray(n.O),i.disableVertexAttribArray(n.N),i.bindBuffer(i.ARRAY_BUFFER,null),e.i.bindTexture2d(0)}function bi(e){this.h=e}di.prototype.l=Qt(li);var yi=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Si(e,t){return t+e}function wi(e,t){window[e]=t}function ki(e){var t=document.createElement("script");return t.setAttribute("src",e),t.setAttribute("crossorigin","anonymous"),new Promise((function(e){t.addEventListener("load",(function(){e()}),!1),t.addEventListener("error",(function(){e()}),!1),document.body.appendChild(t)}))}function Ci(){return P((function(e){switch(e.h){case 1:return e.s=2,S(e,WebAssembly.instantiate(yi),4);case 4:e.h=3,e.s=0;break;case 2:return e.s=0,e.l=null,e.return(!1);case 3:return e.return(!0)}}))}function Ai(e){if(this.h=e,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=e&&e.locateFile||Si,"object"===typeof window)var t=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"===typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");t=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.ha=t,e.options){t=s(Object.keys(e.options));for(var i=t.next();!i.done;i=t.next()){i=i.value;var n=e.options[i].default;void 0!==n&&(this.l[i]="function"===typeof n?n():n)}}}function Ti(e){var t,i,n,r,a,o,s,d,l,u,h;return P((function(f){switch(f.h){case 1:return e.ga?(t=void 0===e.h.files?[]:"function"===typeof e.h.files?e.h.files(e.l):e.h.files,S(f,Ci(),2)):f.return();case 2:if(i=f.i,"object"===typeof window)return wi("createMediapipeSolutionsWasm",{locateFile:e.locateFile}),wi("createMediapipeSolutionsPackedAssets",{locateFile:e.locateFile}),o=t.filter((function(e){return void 0!==e.data})),s=t.filter((function(e){return void 0===e.data})),d=Promise.all(o.map((function(t){var i=Ii(e,t.url);if(void 0!==t.path){var n=t.path;i=i.then((function(t){return e.overrideFile(n,t),Promise.resolve(t)}))}return i}))),l=Promise.all(s.map((function(t){return void 0===t.simd||t.simd&&i||!t.simd&&!i?ki(e.locateFile(t.url,e.ha)):Promise.resolve()}))).then((function(){var t,i,n;return P((function(r){if(1==r.h)return t=window.createMediapipeSolutionsWasm,i=window.createMediapipeSolutionsPackedAssets,n=e,S(r,t(i),2);n.i=r.i,r.h=0}))})),u=function(){return P((function(t){return e.h.graph&&e.h.graph.url?t=S(t,Ii(e,e.h.graph.url),0):(t.h=0,t=void 0),t}))}(),S(f,Promise.all([l,d,u]),7);if("function"!==typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return n=t.filter((function(e){return void 0===e.simd||e.simd&&i||!e.simd&&!i})).map((function(t){return e.locateFile(t.url,e.ha)})),importScripts.apply(null,c(n)),r=e,S(f,createMediapipeSolutionsWasm(Module),6);case 6:r.i=f.i,e.m=new OffscreenCanvas(1,1),e.i.canvas=e.m,a=e.i.GL.createContext(e.m,{antialias:!1,alpha:!1,va:"undefined"!==typeof WebGL2RenderingContext?2:1}),e.i.GL.makeContextCurrent(a),f.h=4;break;case 7:if(e.m=document.createElement("canvas"),h=e.m.getContext("webgl2",{}),!h&&(h=e.m.getContext("webgl",{}),!h))return alert("Failed to create WebGL canvas context when passing video frame."),f.return();e.K=h,e.i.canvas=e.m,e.i.createContext(e.m,!0,!0,{});case 4:e.j=new e.i.SolutionWasm,e.ga=!1,f.h=0}}))}function Ei(e){var t,i,n,r,a,o,c,d;return P((function(l){if(1==l.h)return e.h.graph&&e.h.graph.url&&e.fa===e.h.graph.url?l.return():(e.u=!0,e.h.graph&&e.h.graph.url?(e.fa=e.h.graph.url,S(l,Ii(e,e.h.graph.url),3)):void(l.h=2));for(2!=l.h&&(t=l.i,e.j.loadGraph(t)),i=s(Object.keys(e.D)),n=i.next();!n.done;n=i.next())r=n.value,e.j.overrideFile(r,e.D[r]);if(e.D={},e.h.listeners)for(a=s(e.h.listeners),o=a.next();!o.done;o=a.next())c=o.value,Mi(e,c);d=e.l,e.l={},e.setOptions(d),l.h=0}))}function Pi(e){var t,i,n,r,a,o,c;return P((function(d){switch(d.h){case 1:if(!e.u)return d.return();if(!e.F){d.h=2;break}t=s(e.F),i=t.next();case 3:if(i.done){d.h=5;break}return n=i.value,S(d,n(),4);case 4:i=t.next(),d.h=3;break;case 5:e.F=void 0;case 2:if(e.H){for(r=new e.i.GraphOptionChangeRequestList,a=s(e.H),o=a.next();!o.done;o=a.next())c=o.value,r.push_back(c);e.j.changeOptions(r),r.delete(),e.H=void 0}e.u=!1,d.h=0}}))}function Ii(e,t){var i,n;return P((function(r){return t in e.L?r.return(e.L[t]):(i=e.locateFile(t,""),n=fetch(i).then((function(e){return e.arrayBuffer()})),e.L[t]=n,r.return(n))}))}function Ri(e,t,i){var n,r,a,o,c,d,l,u,h,f,m,p,v,g;return P((function(b){switch(b.h){case 1:if(!i)return b.return(t);for(n={},r=0,a=s(Object.keys(i)),o=a.next();!o.done;o=a.next())c=o.value,d=i[c],"string"!==typeof d&&"texture"===d.type&&void 0!==t[d.stream]&&++r;1<r&&(e.M=!1),l=s(Object.keys(i)),o=l.next();case 2:if(o.done){b.h=4;break}if(u=o.value,h=i[u],"string"===typeof h)return v=n,g=u,S(b,Li(e,u,t[h]),14);if(f=t[h.stream],"detection_list"===h.type){if(f){for(var y=f.getRectList(),w=f.getLandmarksList(),k=f.getClassificationsList(),C=[],A=0;A<y.size();++A){var T=ui(y.get(A)),E=ct(T,1),P=ct(T,2),I=ct(T,3),R=ct(T,4),L=ct(T,5,0),M=void 0;M=void 0===M?0:M,T={la:{sa:E,ta:P,height:I,width:R,rotation:L,pa:st(Qe(T,6),M)},ea:rt(ci(w.get(A)),ri,1).map(mi),ba:fi(ni(k.get(A)))},C.push(T)}y=C}else y=[];n[u]=y,b.h=7;break}if("proto_list"===h.type){if(f){for(y=Array(f.size()),w=0;w<f.size();w++)y[w]=f.get(w);f.delete()}else y=[];n[u]=y,b.h=7;break}if(void 0===f){b.h=3;break}if("float_list"===h.type){n[u]=f,b.h=7;break}if("proto"===h.type){n[u]=f,b.h=7;break}if("texture"!==h.type)throw Error("Unknown output config type: '"+h.type+"'");return m=e.v[u],m||(m=new pi(e.i,e.K),e.v[u]=m),S(b,vi(m,f,e.M),13);case 13:p=b.i,n[u]=p;case 7:h.transform&&n[u]&&(n[u]=h.transform(n[u])),b.h=3;break;case 14:v[g]=b.i;case 3:o=l.next(),b.h=2;break;case 4:return b.return(n)}}))}function Li(e,t,i){var n;return P((function(r){return"number"===typeof i||i instanceof Uint8Array||i instanceof e.i.Uint8BlobList?r.return(i):i instanceof e.i.Texture2dDataOut?(n=e.v[t],n||(n=new pi(e.i,e.K),e.v[t]=n),r.return(vi(n,i,e.M))):r.return(void 0)}))}function Mi(e,t){for(var i=t.name||"$",n=[].concat(c(t.wants)),r=new e.i.StringList,a=s(t.wants),o=a.next();!o.done;o=a.next())r.push_back(o.value);a=e.i.PacketListener.implement({onResults:function(r){for(var a={},o=0;o<t.wants.length;++o)a[n[o]]=r.get(o);var s=e.listeners[i];s&&(e.I=Ri(e,a,t.outs).then((function(i){i=s(i);for(var r=0;r<t.wants.length;++r){var o=a[n[r]];"object"===typeof o&&o.hasOwnProperty&&o.hasOwnProperty("delete")&&o.delete()}i&&(e.I=i)})))}}),e.j.attachMultiListener(r,a),r.delete()}function Oi(e){switch(void 0===e&&(e=0),e){case 1:return"selfie_segmentation_landscape.tflite";default:return"selfie_segmentation.tflite"}}function Di(e){var t=this;e=e||{},this.h=new Ai({locateFile:e.locateFile,files:function(e){return[{simd:!0,url:"selfie_segmentation_solution_simd_wasm_bin.js"},{simd:!1,url:"selfie_segmentation_solution_wasm_bin.js"},{data:!0,url:Oi(e.modelSelection)}]},graph:{url:"selfie_segmentation.binarypb"},listeners:[{wants:["segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"object"===typeof window&&void 0!==window.navigator&&("iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelSelection:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelSelection",fieldName:"int_value"},onChange:function(e){var i,n,r;return P((function(a){return 1==a.h?(i=Oi(e),n="third_party/mediapipe/modules/selfie_segmentation/"+i,S(a,Ii(t.h,i),2)):(r=a.i,t.h.overrideFile(n,r),a.return(!0))}))}}}})}e=Ai.prototype,e.close=function(){return this.j&&this.j.delete(),Promise.resolve()},e.reset=function(){var e=this;return P((function(t){e.j&&(e.j.reset(),e.s={},e.v={}),t.h=0}))},e.setOptions=function(e,t){var i=this;if(t=t||this.h.options){for(var n=[],r=[],a={},o=s(Object.keys(e)),c=o.next();!c.done;a={X:a.X,Y:a.Y},c=o.next())if(c=c.value,!(c in this.l)||this.l[c]!==e[c]){this.l[c]=e[c];var d=t[c];void 0!==d&&(d.onChange&&(a.X=d.onChange,a.Y=e[c],n.push(function(e){return function(){var t;return P((function(n){if(1==n.h)return S(n,e.X(e.Y),2);t=n.i,!0===t&&(i.u=!0),n.h=0}))}}(a))),d.graphOptionXref&&(c=Object.assign({},{calculatorName:"",calculatorIndex:0},d.graphOptionXref,{valueNumber:1===d.type?e[c]:0,valueBoolean:0===d.type&&e[c],valueString:2===d.type?e[c]:""}),r.push(c)))}0===n.length&&0===r.length||(this.u=!0,this.H=(void 0===this.H?[]:this.H).concat(r),this.F=(void 0===this.F?[]:this.F).concat(n))}},e.initialize=function(){var e=this;return P((function(t){return 1==t.h?S(t,Ti(e),2):3!=t.h?S(t,Ei(e),3):S(t,Pi(e),0)}))},e.overrideFile=function(e,t){this.j?this.j.overrideFile(e,t):this.D[e]=t},e.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},e.send=function(e,t){var i,n,r,a,o,c,d,l,u,h=this;return P((function(f){switch(f.h){case 1:return h.h.inputs?(i=1e3*(void 0===t||null===t?performance.now():t),S(f,h.I,2)):f.return();case 2:return S(f,h.initialize(),3);case 3:for(n=new h.i.PacketDataList,r=s(Object.keys(e)),a=r.next();!a.done;a=r.next())if(o=a.value,c=h.h.inputs[o]){e:{var m=e[o];switch(c.type){case"video":var p=h.s[c.stream];if(p||(p=new pi(h.i,h.K),h.s[c.stream]=p),0===p.m&&(p.m=p.i.createTexture()),"undefined"!==typeof HTMLVideoElement&&m instanceof HTMLVideoElement)var v=m.videoWidth,g=m.videoHeight;else"undefined"!==typeof HTMLImageElement&&m instanceof HTMLImageElement?(v=m.naturalWidth,g=m.naturalHeight):(v=m.width,g=m.height);g={glName:p.m,width:v,height:g},v=p.h,v.canvas.width=g.width,v.canvas.height=g.height,v.activeTexture(v.TEXTURE0),p.i.bindTexture2d(p.m),v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,m),p.i.bindTexture2d(0),p=g;break e;case"detections":for(p=h.s[c.stream],p||(p=new bi(h.i),h.s[c.stream]=p),p.data||(p.data=new p.h.DetectionListData),p.data.reset(m.length),g=0;g<m.length;++g){v=m[g];var b=p.data,y=b.setBoundingBox,w=g,k=v.la,C=new di;if(at(C,1,k.sa),at(C,2,k.ta),at(C,3,k.height),at(C,4,k.width),at(C,5,k.rotation),$e(C,6,k.pa),k=C.l(),y.call(b,w,k),v.ea)for(b=0;b<v.ea.length;++b){C=v.ea[b],y=p.data,w=y.addNormalizedLandmark,k=g,C=Object.assign({},C,{visibility:C.visibility?C.visibility:0});var A=new ri;at(A,1,C.x),at(A,2,C.y),at(A,3,C.z),C.visibility&&at(A,4,C.visibility),C=A.l(),w.call(y,k,C)}if(v.ba)for(b=0;b<v.ba.length;++b)y=p.data,w=y.addClassification,k=g,C=v.ba[b],A=new $t,at(A,2,C.qa),C.index&&$e(A,1,C.index),C.label&&$e(A,3,C.label),C.displayName&&$e(A,4,C.displayName),C=A.l(),w.call(y,k,C)}p=p.data;break e;default:p={}}}switch(d=p,l=c.stream,c.type){case"video":n.pushTexture2d(Object.assign({},d,{stream:l,timestamp:i}));break;case"detections":u=d,u.stream=l,u.timestamp=i,n.pushDetectionList(u);break;default:throw Error("Unknown input config type: '"+c.type+"'")}}return h.j.send(n),S(f,h.I,4);case 4:n.delete(),f.h=0}}))},e.onResults=function(e,t){this.listeners[t||"$"]=e},M("Solution",Ai),M("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"}),e=Di.prototype,e.close=function(){return this.h.close(),Promise.resolve()},e.onResults=function(e){this.h.onResults(e)},e.initialize=function(){var e=this;return P((function(t){return S(t,e.h.initialize(),0)}))},e.reset=function(){this.h.reset()},e.send=function(e){var t=this;return P((function(i){return S(i,t.h.send(e),0)}))},e.setOptions=function(e){this.h.setOptions(e)},M("SelfieSegmentation",Di),M("VERSION","0.1.1675465747")}).call(G);var J=window.log,z=new WeakMap,H=new WeakSet;class K{constructor(e){F(this,H),N(this,z,{writable:!0,value:null}),this.webRTCAdaptor=e,this.selfieSegmentation=null,this.effectCanvas=null,this.ctx=null,this.rawLocalVideo=document.createElement("video"),this.deepAR=null,this.backgroundBlurRange=3,this.edgeBlurRange=4,this.effectName=K.NO_EFFECT,this.startTime=0,this.statTimerId=-1,this.renderedFrameCount=0,this.lastRenderedFrameCount=0,this.effectCanvasFPS=0,this.videoCallbackPeriodMs=0,this.initializeSelfieSegmentation(),this.isInitialized=!0}init(e){var t=this;return A((function*(){yield t.setRawLocalVideo(e);var i=e.getVideoTracks()[0].getSettings();return t.effectCanvasFPS=i.frameRate,t.videoCallbackPeriodMs=1e3/t.effectCanvasFPS,t.effectCanvas=t.createEffectCanvas(i.width,i.height),t.ctx=t.effectCanvas.getContext("2d"),t.canvasStream&&(t.canvasStream.getTracks().forEach((e=>e.stop())),t.canvasStream=null),t.canvasStream=t.effectCanvas.captureStream(t.effectCanvasFPS),new Promise(((e,i)=>{e(t.canvasStream)}))}))()}setRawLocalVideo(e){return this.rawLocalVideo.srcObject=e,this.rawLocalVideo.muted=!0,this.rawLocalVideo.autoplay=!0,this.rawLocalVideo.play()}createEffectCanvas(e,t){var i=document.createElement("canvas");return i.id="effectCanvas",i.width=e,i.height=t,i}initializeSelfieSegmentation(){this.selfieSegmentation=new SelfieSegmentation({locateFile:e=>K.LOCATE_FILE_URL+"/"+e}),this.selfieSegmentation.setOptions({selfieMode:!1,modelSelection:1}),this.selfieSegmentation.onResults((e=>{this.onResults(e)}))}set virtualBackgroundImage(e){R(this,z,e)}startFpsCalculation(){this.statTimerId=setInterval((()=>{var e=(new Date).getTime(),t=(e-this.startTime)/1e3;this.startTime=e;var i=(this.renderedFrameCount-this.lastRenderedFrameCount)/t;this.renderedFrameCount=this.lastRenderedFrameCount,J.warn("Fps: "+i+"fps")}),1e3)}stopFpsCalculation(){-1!==this.statTimerId&&(clearInterval(this.statTimerId),this.statTimerId=-1)}processFrame(){var e=this;return A((function*(){yield e.selfieSegmentation.send({image:e.rawLocalVideo}),e.effectName!==K.NO_EFFECT&&setTimeout((()=>{e.processFrame()}),e.videoCallbackPeriodMs)}))()}setBlurEffectRange(e,t){this.backgroundBlurRange=e,this.edgeBlurRange=t}enableEffect(e,t,i){var n=this;return A((function*(){if(n.isInitialized){switch(e){case K.DEEPAR:case K.VIRTUAL_BACKGROUND:case K.BLUR_BACKGROUND:case K.NO_EFFECT:n.stopFpsCalculation(),yield D(n,H,q).call(n);break;default:return void J.warn("Unknown effect name please use the constants VideoEffect.VIRTUAL_BACKGROUND,VideoEffect.BLUR_BACKGROUND or VideoEffect.NO_EFFECT ")}var r=n.effectName;if(n.effectName=e,r===K.DEEPAR&&e!==K.DEEPAR&&(n.deepAR.shutdown(),n.deepAR=null),e===K.VIRTUAL_BACKGROUND||e===K.BLUR_BACKGROUND)return r===K.NO_EFFECT||r===K.DEEPAR?(K.DEBUG&&n.startFpsCalculation(),navigator.mediaDevices.getUserMedia({video:n.webRTCAdaptor.mediaConstraints.video,audio:!0}).then((e=>n.init(e).then((e=>n.webRTCAdaptor.updateVideoTrack(e,n.webRTCAdaptor.publishStreamId,null,!0).then((()=>{setTimeout((()=>{n.processFrame()}),n.videoCallbackPeriodMs)})))).catch((e=>{throw J.error(e),e}))))):new Promise(((e,t)=>{e()}));if(e!==K.DEEPAR){if(r===K.DEEPAR){var a=yield navigator.mediaDevices.getUserMedia({video:n.webRTCAdaptor.mediaConstraints.video,audio:!0});yield n.setRawLocalVideo(a)}return new Promise(((e,t)=>{n.stopFpsCalculation(),D(n,H,q).call(n),e()}))}if(void 0!==t&&null!==t&&""!==t&&void 0!==i&&null!==i&&""!==i)if(r!==K.DEEPAR){r!==K.BLUR_BACKGROUND&&r!==K.VIRTUAL_BACKGROUND||(n.stopFpsCalculation(),yield D(n,H,q).call(n));var o=n.createEffectCanvas(500,500),s=new DeepAR({licenseKey:t,canvas:o,deeparWasmPath:K.DEEP_AR_FOLDER_ROOT_URL+"/wasm/deepar.wasm",callbacks:{onInitialize:function(){s.startVideo(!0)}}});n.deepAR=s,n.deepAR.callbacks.onVideoStarted=()=>{n.canvasStream=o.captureStream(30),n.webRTCAdaptor.updateVideoTrack(n.canvasStream,n.webRTCAdaptor.publishStreamId,null,!0),n.deepAR.switchEffect(0,"slot",K.DEEP_AR_EFFECTS_URL+i+K.DEEP_AR_EXTENSION)},n.deepAR.downloadFaceTrackingModel(K.DEEP_AR_FOLDER_ROOT_URL+"/models/face/models-68-extreme.bin"),n.deepAR.setVideoElement(n.rawLocalVideo,!0)}else n.deepAR.switchEffect(0,"slot",K.DEEP_AR_EFFECTS_URL+i+K.DEEP_AR_EXTENSION);else J.error("DeepAR API key or DeepAR Model is not set!")}else J.error("VideoEffect is not initialized!")}))()}drawSegmentationMask(e){this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height)}onResults(e){this.renderedFrameCount++,this.effectName==K.BLUR_BACKGROUND?this.drawBlurBackground(e.image,e.segmentationMask,this.backgroundBlurRange):this.effectName==K.VIRTUAL_BACKGROUND?this.drawVirtualBackground(e.image,e.segmentationMask,I(this,z)):this.drawImageDirectly(e.image)}drawImageDirectly(e){this.ctx.save(),this.ctx.globalCompositeOperation="source-over",this.ctx.filter="none",this.ctx.drawImage(e,0,0,e.width,e.height),this.ctx.restore()}drawVirtualBackground(e,t,i){this.ctx.save(),this.ctx.filter="none",this.ctx.clearRect(0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.drawImage(t,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="source-out",this.ctx.drawImage(i,0,0,i.naturalWidth,i.naturalHeight,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="destination-atop",this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.restore()}drawBlurBackground(e,t,i){this.ctx.clearRect(0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="copy",this.ctx.filter="none",this.ctx.filter="blur("+this.edgeBlurRange+"px)",this.drawSegmentationMask(t),this.ctx.globalCompositeOperation="source-in",this.ctx.filter="none",this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.globalCompositeOperation="destination-over",this.ctx.filter="blur("+i+"px)",this.ctx.drawImage(e,0,0,this.effectCanvas.width,this.effectCanvas.height),this.ctx.restore()}}function q(){return this.rawLocalVideo.pause(),null!=this.canvasStream&&this.canvasStream.getVideoTracks().forEach((e=>e.stop())),this.webRTCAdaptor.switchVideoCameraCapture(this.webRTCAdaptor.publishStreamId)}T(K,"DEEPAR","deepar"),T(K,"VIRTUAL_BACKGROUND","virtual-background"),T(K,"BLUR_BACKGROUND","blur-background"),T(K,"NO_EFFECT","no-effect"),T(K,"deepARModelList",["flower_face","Ping_Pong"]),T(K,"DEBUG",!1),T(K,"LOCATE_FILE_URL","https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"),T(K,"DEEP_AR_FOLDER_ROOT_URL","https://cdn.jsdelivr.net/npm/deepar@4.0.3"),T(K,"DEEP_AR_EFFECTS_URL","../js/external/deepar-effects/"),T(K,"DEEP_AR_EXTENSION",".deepar"),W.register((e=>{var t=new K(e);Object.defineProperty(e,"setBlurEffectRange",{value:function(e,i){t.setBlurEffectRange(e,i)}}),Object.defineProperty(e,"enableEffect",{value:function(e,i,n){return t.enableEffect(e,i,n)}}),Object.defineProperty(e,"setBackgroundImage",{value:function(e){t.virtualBackgroundImage=e}})}));var X={setup(){const e=(0,g.KR)(null),t=(0,g.KR)(null),i=(0,g.KR)(null),r=(0,g.KR)(null),a=(0,g.KR)(null),o=(0,g.KR)("Offline"),s=(0,g.KR)(null),c=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:!0});e.value.srcObject=t,i.value=t}catch(t){console.error("Error starting webcam:",t)}},d=async()=>{try{const e=await navigator.mediaDevices.getDisplayMedia({video:!0});t.value.srcObject=e,r.value=e}catch(e){console.error("Error starting screen capture:",e)}},l=()=>{try{s.value="stream"+parseInt(999999*Math.random()),o.value="Connecting...",a.value.publish(s.value)}catch(e){console.error("Error starting streaming with WebRTC Adaptor:",e)}},u=()=>{a.value&&(a.value.stop(s.value),o.value="Stopping...")};return(0,n.sV)((()=>{a.value=new W({websocket_url:"wss://ams-22851.antmedia.cloud:5443/RTCLIVE/websocket",localVideoElement:t.value,callback:e=>{console.log("callback info: "+e),"publish_started"===e?(console.log("publish started"),o.value="Broadcasting - Stream Id: "+s.value):"publish_finished"===e&&(console.log("publish finished"),o.value="Offline")}})})),{webcamVideo:e,screenVideo:t,webcamStream:i,screenCaptureStream:r,webRTCAdaptor:a,streamingStatus:o,streamId:s,startWebcam:c,startScreenCapture:d,startStreamingWithAdaptor:l,stopStreamingWithAdaptor:u}}},Y=i(64621);const Z=(0,Y.A)(X,[["render",v],["__scopeId","data-v-3ff22ada"]]);var Q=Z,$=i(40475),ee={name:"Lesson Streaming",components:{Edit:Q},data(){return{login:$.A.get("session","login")}},methods:{},setup(){const e=(0,o.lq)(),t=e.meta.title;(0,a.K7)(t)}};const te=(0,Y.A)(ee,[["render",r]]);var ie=te}}]);
//# sourceMappingURL=1296.1ff2b71b.js.map