{"version":3,"file":"js/1560.b2871754.js","mappings":"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","sources":["webpack://node-backend/./src/extensions/modules/system/user/view/Reset.vue","webpack://node-backend/./src/extensions/modules/system/user/component/frontend/Reset.vue","webpack://node-backend/./src/extensions/modules/system/user/component/frontend/Reset.vue?4b24","webpack://node-backend/./src/extensions/modules/system/user/view/Reset.vue?70e6","webpack://node-backend/./src/plugins/email/emailTemplate.js","webpack://node-backend/./src/plugins/sendEmail.js"],"sourcesContent":["<template>\n    <component :is=\"componentName\" />\n    </template>\n    \n    <script>\n    import { useTitle } from 'vue-page-title';\n    import { useRoute } from 'vue-router';\n    import storageManager from '@/plugins/storage';\n    import Frontend from '../component/frontend/Reset.vue';\n    \n    export default {\n    name: 'Lesson Detail',\n    components: {\n        Frontend,\n    },\n    data() {\n        return {\n            session: storageManager.get('session')\n        };\n    },\n    setup() {\n        const route = useRoute();\n        const routeName = route.meta.title;\n        useTitle(routeName);\n    },\n    computed: {\n        componentName() {\n            return 'Frontend';\n        }\n    }\n    };\n    </script>\n        ","<script>\nimport storageManager from '@/plugins/storage';\nimport { sendEmail } from '@/plugins/sendEmail';\nimport CryptoJS from 'crypto-js';\n\nexport default {\n\tname: 'Login',\n\tcomponents: {\n\t},\n  props: {\n    showModal: {\n      type: Boolean,\n      default: false\n    }\n  },\n\tdata() {\n\t\treturn {\n            config: storageManager.get('configs'),\n            session: storageManager.get('session','user'),\n            password: '',\n            confirmPassword: '',\n            errorStage: false,\n            errorMessage: '',\n            buttonText:'เปลี่ยนรหัสผ่าน'\n\t\t}\n\t},\n    created() {\n        if (!this.session || !this.session.req_reset) {\n            this.$router.push('/user/login');\n        }\n    },\n\tmethods: {\n        logout() {\n          this.$swal({\n              toast: true,\n              position: 'bottom-end',\n              showConfirmButton: false,\n              timer: 500,\n              icon: 'success',\n              title: 'แจ้งเตือน',\n              text: 'ออกจากระบบเรียบร้อยแล้ว',\n          }).then(() => \n          {\n            storageManager.delete('session');\n            window.location.href = \"/\"\n          });\n        },\n        async changePassword() {\n            try {\n                this.activeBlock    = true;\n                this.errorStage     = false;\n                const newPassword = this.password;\n                const confirmPassword = this.confirmPassword;\n\n                if (newPassword !== confirmPassword) {\n                    this.activeBlock    = false;\n                    this.errorStage = true;\n                    this.errorMessage = \"รหัสผ่านไม่ตรงกัน\";\n                    this.buttonText = \"เปลี่ยนรหัสผ่าน\";\n                    return;\n                }\n\n                const salt = CryptoJS.lib.WordArray.random(16);\n                const hash = CryptoJS.SHA256(newPassword + salt).toString();\n\n                const resAPI = await fetch(`https://gateway.cloudrestfulapi.com/api/user/${this.session._id}`, {\n                    method: 'PUT',\n                    headers: { 'Content-Type': 'application/json','client-token-key':this.config.key },\n                    body: JSON.stringify({\n                        data: {\n                        password: hash,\n                        salt: salt.toString(),\n                        req_reset: false\n                        }\n                    })\n                });\n\n                const getLogin  = await resAPI.json();\n                console.log(getLogin);\n                const emailData = {\n                    email: this.session.email,\n                    name: this.session.firstname + '' + this.session.lastname\n                };\n                await sendEmail(emailData,'change-password');\n                this.$swal({\n                    icon: 'success',\n                    title: 'การเปลี่ยนรหัสผ่านใหม่เรียบร้อยแล้ว',\n                    text: 'ระบบได้ทำการเปลี่ยนรหัสผ่านใหม่เรียบร้อยแล้ว กรุณาเข้าสู่ระบบด้วยรหัสผ่านใหม่อีกครั้ง',\n                    showCancelButton: false,\n                    confirmButtonText: 'ตกลง',\n                }).then(() => {\n                    storageManager.delete('session')\n                    this.$router.push(\"/user/login\");\n                });\n                this.activeBlock  = false;\n            } catch (error) {\n                console.log(error);\n                this.buttonText = \"เปลี่ยนรหัสผ่าน\";\n                this.buttonDisabled = false;\n            }\n        },\n\t},\n};\n</script>\n\n<template>\n  <div class=\"bg-gray-50\">\n\n    <div class=\"flex min-h-full flex-col justify-center py-12 sm:px-6 lg:px-8\">\n      <div class=\"sm:mx-auto sm:w-full sm:max-w-lg\">\n        <img class=\"mx-auto h-24 w-auto\" :src=\"this.config.siteLogo\" alt=\"Your Company\" v-if=\"!this.showModal\">\n        <h2 class=\"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900\">เปลี่ยนรหัสผ่าน FTI Academy</h2>\n        <p class=\"mt-2 text-center text-sm text-gray-600\">\n          หรือ\n          <router-link :to=\"'/student/register'\" class=\"font-medium text-indigo-600 hover:text-indigo-500\">\n          ลงทะเบียนผู้อบรมใหม่\n          </router-link>\n        </p>\n      </div>\n  \n      <div class=\"mt-8 sm:mx-auto sm:w-full sm:max-w-md relative\" :data-content=\"'กำลังติดต่อฐานข้อมูล กรุณารอสักครู่.....'\" :class=\"[(activeBlock?'isblock' : 'isunblock')]\">\n        <div class=\"bg-white px-4 py-8 shadow sm:rounded-lg sm:px-10\">\n          <form class=\"space-y-6\" @submit.prevent=\"changePassword\">\n\n            <div>\n                <label for=\"new-password\" class=\"block text-md font-semibold leading-6 text-gray-900\">รหัสผ่านใหม่</label>\n                <div class=\"mt-2\">\n                <input v-model=\"password\" id=\"new-password\" name=\"new-password\" type=\"password\" autocomplete=\"new-password\" required=\"\" class=\"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\">\n                </div>\n            </div>\n\n            <div>\n                <label for=\"confirm-password\" class=\"block text-md font-semibold leading-6 text-gray-900\">ยืนยันรหัสผ่านใหม่</label>\n                <div class=\"mt-2\">\n                <input v-model=\"confirmPassword\" id=\"confirm-password\" name=\"confirm-password\" type=\"password\" autocomplete=\"new-password\" required=\"\" class=\"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\">\n                </div>\n            </div>\n  \n            <div>\n              <div v-if=\"errorStage\" class=\"col-span-2\">\n                <div class=\"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5\">\n                  <div class=\"font-semibold pt-3 pb-3\">เกิดข้อผิดพลาด</div>\n                  <div class=\"w-full\">{{ errorMessage }}</div>\n                </div>\n              </div>\n              <button\n              type=\"submit\"\n              :disabled=\"buttonDisabled\"\n              class=\"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\"\n            >\n              {{ buttonText }}\n            </button>\n\n            <button\n            @click=\"logout()\"\n              class=\"flex w-full justify-center rounded-md bg-gray-300 text-md font-semibold text-gray-700 shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600 mt-4 py-2\"\n            >\n             ออกจากระบบ\n            </button>\n            \n            </div>\n          </form>\n  \n        </div>\n      </div>\n    </div>\n  \n    </div>\n</template>","import { render } from \"./Reset.vue?vue&type=template&id=6453f67b\"\nimport script from \"./Reset.vue?vue&type=script&lang=js\"\nexport * from \"./Reset.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./Reset.vue?vue&type=template&id=633af7ba\"\nimport script from \"./Reset.vue?vue&type=script&lang=js\"\nexport * from \"./Reset.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","export const emailTemplate = `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Email Template</title>\n  <style>\n    /* Add your custom CSS styles here */\n    /* For example: */\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n      text-align: center;\n    }\n    body {\n      font-family: Arial, sans-serif;\n      line-height: 1.5;\n      background-color: #f2f2f2;\n      color: #ffffff;\n    }\n    .container {\n      max-width: 600px;\n      margin: 0px auto;\n      padding: 20px;\n      background-color: #ffffff;\n      border-radius: 5px;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n    }\n    .header img {\n      max-width: 150px;\n      height: auto;\n    }\n    .content {\n      padding: 20px;\n      border-top: 1px solid #e6e6e6;\n      border-bottom: 1px solid #e6e6e6;\n    }\n    .heading {\n      font-size: 18px;\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: center;\n    }\n    .text {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .container p {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .text p {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .footer {\n      text-align: center;\n      margin-top: 20px;\n      color: #888888;\n      font-size: 14px;\n    }\n    .footer a {\n      color: #888888;\n      text-decoration: none;\n      transition: color 0.3s ease;\n    }\n    .footer a:hover {\n      color: #ffffff;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\" style=\"margin-top:20px;\">\n    <div class=\"header\">\n      <img src=\"https://vue-project.sgp1.digitaloceanspaces.com/Logo/color-logopng.png\" alt=\"Logo\">\n    </div>\n    <div class=\"content\">\n      <h2 class=\"heading\">{{ subject }}</h2>\n      <p class=\"text\">{{ content }}</p>\n    </div>\n    <div class=\"footer\">\n      &copy; ${new Date().getFullYear()} {{ provider }}. All rights reserved.</a>\n    </div>\n  </div>\n</body>\n</html>\n`;\n","import storageManager from '@/plugins/storage';\nimport { emailTemplate } from './email/emailTemplate.js';\nimport CryptoJS from 'crypto-js';\n\nimport requestClient from '@/plugins/requestClient';\nconst Request = new requestClient(false);\n\nconst endpoint = 'https://gateway.cloudrestfulapi.com/email/send'; // Updated endpoint\nconst session = storageManager.get('session');\nconst configs = storageManager.get('configs');\n\nexport async function sendEmail(data, templateType = '') {\n  \n  let email_provider;\n\n  if (session.interface === 'frontend') {\n    ({ email_provider } = configs);\n  } else {\n    ({ email_provider } = session.current);\n  }\n\n  const { name, email, subject, body } = data;\n\n  try {\n    let emailBody;\n    let emailSubject;\n\n    if (templateType === 'welcome') {\n      ({ emailBody, emailSubject } = getWelcomeTemplate(data));\n    } else if (templateType === 'reset-password') {\n      ({ emailBody, emailSubject } = await getResetPasswordTemplate(data));\n    } else if (templateType === 'change-password') {\n      ({ emailBody, emailSubject } = await getChangePasswordTemplate(data));\n    } else if (templateType === 'new-template') { \n      ({ emailBody, emailSubject } = getNewTemplate(data));\n    } else {\n      emailBody = body;\n      emailSubject = subject;\n    }\n\n    emailBody = emailTemplate.replace('{{ content }}', emailBody).replace('{{ subject }}', emailSubject).replace('{{ provider }}', email_provider);\n\n    const emailData = await recordEmailData(name, email, emailSubject, emailBody);\n\n    const response = await Request.POST(endpoint, {\n      subject: emailSubject,\n      text: emailBody,\n      html: emailBody ,\n      fromEmail: \"noreply@fti.academy\",\n      fromName: \"Academy Customer Support\",\n      toEmail: email,\n      toName: name,\n    }, configs.key);\n\n    if (response.status === 200) { // Check the response status code\n      const responseData = response.data;\n      console.log(responseData.message);\n      await updateEmailStatus(emailData._id, 'confirm');\n      return responseData;\n    } else {\n      console.log('Failed to send email');\n      const errorMessage = 'Failed to send email';\n      await updateEmailStatus(emailData._id, 'fail', errorMessage);\n      return errorMessage;\n    }\n  } catch (error) {\n    console.error('Error sending email:', error);\n    return error.message;\n  }\n}\n\nasync function recordEmailData(name, email, subject, body) {\n  try {\n    const payload = {\n      data: {\n        name: name,\n        email: email,\n        subject: subject,\n        body: body,\n        status: 'submit'\n      },\n      options: {\n        fieldType: [],\n        uniqueFields: []\n      }\n    };\n\n    const { status, data } = await Request.POST('message/', payload, configs.key);\n\n    if (status === 200) {\n      console.log('Email data recorded successfully');\n      return data;\n    } else {\n      return 'Failed to record email data';\n    }\n  } catch (error) {\n    console.error('Error recording email data:', error);\n    return error.message;\n  }\n}\n\nasync function updateEmailStatus(id, status, error = '') {\n  try {\n    const payload = {\n      data: {\n        status: status,\n        error: error\n      }\n    };\n\n    const { status: responseStatus } = await Request.PUT(`message/${id}`, payload, configs.key);\n\n    if (responseStatus === 200) {\n      console.log('Email status updated successfully');\n    } else {\n      return 'Failed to update email status';\n    }\n  } catch (error) {\n    console.error('Error updating email status:', error);\n    return error.message;\n  }\n}\n\nfunction getNewTemplate(data) {\n  const emailBody = `Hello ${data.name},\\n\\nThis is your custom email body.\\n\\nYour custom data: ${data.content}`;\n  const emailSubject = 'Custom Email';\n  return { emailBody, emailSubject };\n}\n\nfunction getWelcomeTemplate() {\n  const emailBody = 'Welcome to our website!';\n  const emailSubject = 'Welcome Email';\n  return { emailBody, emailSubject };\n}\n\nfunction getChangePasswordTemplate() {\n  const emailBody = `\n  <p>สวัสดีค่ะ,</p>\n  <p>ขอแจ้งให้ทราบว่าบัญชีของคุณได้รับการเปลี่ยนแปลงรหัสผ่านเรียบร้อยแล้วค่ะ</p>\n  <p>หากคุณไม่ได้ดำเนินการเปลี่ยนรหัสผ่านนี้ กรุณาติดต่อทีมงานเพื่อรายงานให้ทราบค่ะ</p></br></br>\n  <p>ขอบคุณค่ะ</p>\n  `;\n  const emailSubject = 'แจ้งเตือน: บัญชีของคุณได้รับการเปลี่ยนรหัสผ่าน';\n  return { emailBody, emailSubject };\n}\n\nasync function getResetPasswordTemplate(data) {\n  try {\n    const payload = {\n      method: 'find',\n      args: [\n        {\n          $and: [\n            { email: data.email }\n          ]\n        }\n      ]\n    };\n\n    const { data: loginData } = await Request.POST('user/query', payload, configs.key);\n\n    if (loginData.length > 0) {\n      const newPassword = generatePassword(6);\n      const salt = CryptoJS.lib.WordArray.random(16);\n      const hash = CryptoJS.SHA256(newPassword + salt).toString();\n      \n      try {\n        const updatePayload = {\n          data: {\n            password: hash,\n            salt: salt.toString(),\n            req_reset: true\n          }\n        };\n\n        const { status } = await Request.PUT(`user/${loginData[0]._id}`, updatePayload, configs.key);\n    \n        if (status === 200) {\n          console.log('Email status updated successfully');\n        } else {\n          return 'Failed to update email status';\n        }\n      } catch (error) {\n        console.error('Error updating email status:', error);\n        return error.message;\n      }\n\n      const emailSubject = 'แจ้งเตือน: รีเซ็ตรหัสผ่าน';\n      const emailBody = `\n        <p>สวัสดีค่ะ,</p>\n        <p>ขอแจ้งให้ทราบว่าบัญชีของคุณได้รับการเปลี่ยนแปลงรหัสผ่านเรียบร้อยแล้วค่ะ</p>\n        <p>รหัสผ่านใหม่ของคุณคือ: <strong>${newPassword}</strong></p>\n        <p>โปรดจำรหัสผ่านใหม่นี้ไว้เพื่อเข้าสู่ระบบในครั้งถัดไปค่ะ</p>\n        <p>หากคุณไม่ได้ดำเนินการเปลี่ยนรหัสผ่านนี้ กรุณาติดต่อทีมงานเพื่อรายงานให้ทราบค่ะ</p></br></br>\n        <p>ขอบคุณค่ะ</p>\n      `;\n      return { emailBody, emailSubject };\n    } else {\n      console.log(\"No User\");\n      return 'User not found';\n    }\n  } catch (error) {\n    console.error('Error retrieving user information:', error);\n    return error.message;\n  }\n}\n\nfunction generatePassword(length) {\n  const characters = '0123456789';\n  let password = '';\n  for (let i = 0; i < length; i++) {\n    const randomIndex = Math.floor(Math.random() * characters.length);\n    password += characters[randomIndex];\n  }\n  return password;\n}\n"],"names":["_createBlock","_resolveDynamicComponent","$options","componentName","class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","showModal","_createCommentVNode","src","config","siteLogo","alt","_hoisted_4","_hoisted_5","_createTextVNode","_createVNode","_component_router_link","to","default","_withCtx","_cache","_","_normalizeClass","_ctx","activeBlock","_hoisted_6","onSubmit","_withModifiers","args","changePassword","for","_hoisted_7","$event","$data","password","id","name","type","autocomplete","required","_hoisted_8","confirmPassword","errorStage","_hoisted_9","_hoisted_10","_hoisted_11","_toDisplayString","errorMessage","disabled","buttonDisabled","buttonText","_hoisted_12","onClick","logout","components","props","Boolean","data","storageManager","get","session","created","this","req_reset","$router","push","methods","$swal","toast","position","showConfirmButton","timer","icon","title","text","then","delete","window","location","href","newPassword","salt","CryptoJS","WordArray","random","hash","toString","resAPI","fetch","_id","method","headers","body","JSON","stringify","getLogin","json","console","log","emailData","email","firstname","lastname","sendEmail","showCancelButton","confirmButtonText","error","__exports__","Frontend","setup","route","useRoute","routeName","meta","useTitle","computed","render","emailTemplate","Date","getFullYear","Request","requestClient","endpoint","configs","async","templateType","email_provider","interface","current","subject","emailBody","emailSubject","getWelcomeTemplate","getResetPasswordTemplate","getChangePasswordTemplate","getNewTemplate","replace","recordEmailData","response","POST","html","fromEmail","fromName","toEmail","toName","status","responseData","message","updateEmailStatus","payload","options","fieldType","uniqueFields","responseStatus","PUT","content","$and","loginData","length","generatePassword","updatePayload","characters","i","randomIndex","Math","floor"],"sourceRoot":""}