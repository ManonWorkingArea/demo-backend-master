"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[1944],{21944:function(e,t,n){n.r(t),n.d(t,{default:function(){return A}});var o=n(20641);function a(e,t,n,a,s,i){return(0,o.uX)(),(0,o.Wv)((0,o.$y)(i.componentName))}var s=n(52968),i=n(75220),r=n(40475),l=n(90033),c=n(53751);const d={class:"bg-gray-50"},m={class:"flex min-h-full flex-col justify-center py-12 sm:px-6 lg:px-8"},u={class:"sm:mx-auto sm:w-full sm:max-w-lg"},p=["src"],g={class:"mt-2 text-center text-sm text-gray-600"},f={class:"bg-white px-4 py-8 shadow sm:rounded-lg sm:px-10"},b={class:"mt-2"},h={key:0,class:"col-span-2"},x={class:"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5"},y={class:"w-full"},v=["disabled"];function w(e,t,n,a,s,i){const r=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",d,[(0,o.Lk)("div",m,[(0,o.Lk)("div",u,[this.showModal?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("img",{key:0,class:"mx-auto h-24 w-auto",src:this.config.siteLogo,alt:"Your Company"},null,8,p)),t[4]||(t[4]=(0,o.Lk)("h2",{class:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900"},"ลืมรหัสผ่าน FTI Academy",-1)),(0,o.Lk)("p",g,[t[3]||(t[3]=(0,o.eW)(" หรือ ")),(0,o.bF)(r,{to:"/student/register",class:"font-medium text-indigo-600 hover:text-indigo-500"},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)(" ลงทะเบียนผู้อบรมใหม่ ")]))),_:1})])]),(0,o.Lk)("div",{class:(0,l.C4)(["mt-8 sm:mx-auto sm:w-full sm:max-w-md relative",[e.activeBlock?"isblock":"isunblock"]]),"data-content":"กำลังติดต่อฐานข้อมูล กรุณารอสักครู่....."},[(0,o.Lk)("div",f,[(0,o.Lk)("form",{class:"space-y-6",onSubmit:t[1]||(t[1]=(0,c.D$)(((...e)=>i.resetPassword&&i.resetPassword(...e)),["prevent"]))},[(0,o.Lk)("div",null,[t[5]||(t[5]=(0,o.Lk)("label",{for:"email",class:"block text-md font-semibold leading-6 text-gray-900"},"อีเมล์ที่ลงทะเบียน",-1)),(0,o.Lk)("div",b,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.email=e),id:"email",name:"email",type:"email",autocomplete:"email",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[c.Jo,s.email]])])]),(0,o.Lk)("div",null,[s.errorStage?((0,o.uX)(),(0,o.CE)("div",h,[(0,o.Lk)("div",x,[t[6]||(t[6]=(0,o.Lk)("div",{class:"font-semibold pt-3 pb-3"},"เกิดข้อผิดพลาด",-1)),(0,o.Lk)("div",y,(0,l.v_)(s.errorMessage),1)])])):(0,o.Q3)("",!0),(0,o.Lk)("button",{type:"submit",disabled:e.buttonDisabled,class:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},(0,l.v_)(s.buttonText),9,v)])],32)])],2)])])}n(44114);var k=n(25747),S={name:"Login",components:{},props:{showModal:{type:Boolean,default:!1}},data(){return{config:r.A.get("configs"),email:"",password:"",errorStage:!1,errorMessage:"",buttonText:"ส่งข้อมูลเพื่อขอรับรหัสผ่านใหม่"}},methods:{async resetPassword(){try{this.activeBlock=!0,this.errorStage=!1,this.buttonText="กำลังดำเนินการ...";const e=await fetch("https://gateway.cloudrestfulapi.com/api/user/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{email:this.email}]}]})}),t=await e.json();console.log(t);const n=t.length>0?t[0]:null;if(!t||0===t.length)return this.errorStage=!0,this.errorMessage="ไม่พบอีเมล์นี้ในระบบ กรุณาตรวจสอบหรือติดต่อทีมงาน",this.activeBlock=!1,this.buttonText="ส่งข้อมูลเพื่อขอรับรหัสผ่านใหม่",void(this.buttonDisabled=!1);{const e={email:n.email,name:n.firstname+""+n.lastname};await(0,k.Z)(e,"reset-password"),this.$swal({icon:"success",title:"การรีเซ็ตรหัสผ่านใหม่เรียบร้อยแล้ว",text:"ระบบได้ทำการรีเซ็ตและจัดส่งรหัสผ่านใหม่ให้ทางอีเมล์แล้ว กรุณาตรวจสอบอีเมล์และเข้าสู่ระบบด้วยวรหัสผ่านใหม่ เมื่อเข้าสู่ระบบครั้งแรก กรุณาเปลี่ยนรหัสผ่านใหม่อีกครั้งเพื่อความปลอดภัย",showCancelButton:!1,confirmButtonText:"ตกลง"}).then((()=>{this.$router.push("/student/login")}))}this.activeBlock=!1}catch(e){console.log(e),this.buttonText="ส่งข้อมูลเพื่อขอรับรหัสผ่านใหม่",this.buttonDisabled=!1}}}},L=n(64621);const T=(0,L.A)(S,[["render",w]]);var j=T,E={name:"Lesson Detail",components:{Frontend:j},data(){return{session:r.A.get("session")}},setup(){const e=(0,i.lq)(),t=e.meta.title;(0,s.K7)(t)},computed:{componentName(){return"Frontend"}}};const B=(0,L.A)(E,[["render",a]]);var A=B},25747:function(e,t,n){n.d(t,{Z:function(){return u}});var o=n(40475);const a=`\n<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Email Template</title>\n  <style>\n    /* Add your custom CSS styles here */\n    /* For example: */\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n      text-align: center;\n    }\n    body {\n      font-family: Arial, sans-serif;\n      line-height: 1.5;\n      background-color: #f2f2f2;\n      color: #ffffff;\n    }\n    .container {\n      max-width: 600px;\n      margin: 0px auto;\n      padding: 20px;\n      background-color: #ffffff;\n      border-radius: 5px;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n    }\n    .header img {\n      max-width: 150px;\n      height: auto;\n    }\n    .content {\n      padding: 20px;\n      border-top: 1px solid #e6e6e6;\n      border-bottom: 1px solid #e6e6e6;\n    }\n    .heading {\n      font-size: 18px;\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: center;\n    }\n    .text {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .container p {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .text p {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .footer {\n      text-align: center;\n      margin-top: 20px;\n      color: #888888;\n      font-size: 14px;\n    }\n    .footer a {\n      color: #888888;\n      text-decoration: none;\n      transition: color 0.3s ease;\n    }\n    .footer a:hover {\n      color: #ffffff;\n    }\n  </style>\n</head>\n<body>\n  <div class="container" style="margin-top:20px;">\n    <div class="header">\n      <img src="https://vue-project.sgp1.digitaloceanspaces.com/Logo/color-logopng.png" alt="Logo">\n    </div>\n    <div class="content">\n      <h2 class="heading">{{ subject }}</h2>\n      <p class="text">{{ content }}</p>\n    </div>\n    <div class="footer">\n      &copy; ${(new Date).getFullYear()} {{ provider }}. All rights reserved.</a>\n    </div>\n  </div>\n</body>\n</html>\n`;var s=n(21396),i=n.n(s),r=n(40471);const l=new r.A(!1),c="https://gateway.cloudrestfulapi.com/email/send",d=o.A.get("session"),m=o.A.get("configs");async function u(e,t=""){let n;"frontend"===d.interface?({email_provider:n}=m):({email_provider:n}=d.current);const{name:o,email:s,subject:i,body:r}=e;try{let d,u;"welcome"===t?({emailBody:d,emailSubject:u}=b(e)):"reset-password"===t?({emailBody:d,emailSubject:u}=await x(e)):"change-password"===t?({emailBody:d,emailSubject:u}=await h(e)):"new-template"===t?({emailBody:d,emailSubject:u}=f(e)):(d=r,u=i),d=a.replace("{{ content }}",d).replace("{{ subject }}",u).replace("{{ provider }}",n);const y=await p(o,s,u,d),v=await l.POST(c,{subject:u,text:d,html:d,fromEmail:"noreply@fti.academy",fromName:"Academy Customer Support",toEmail:s,toName:o},m.key);if(200===v.status){const e=v.data;return console.log(e.message),await g(y._id,"confirm"),e}{console.log("Failed to send email");const e="Failed to send email";return await g(y._id,"fail",e),e}}catch(u){return console.error("Error sending email:",u),u.message}}async function p(e,t,n,o){try{const a={data:{name:e,email:t,subject:n,body:o,status:"submit"},options:{fieldType:[],uniqueFields:[]}},{status:s,data:i}=await l.POST("message/",a,m.key);return 200===s?(console.log("Email data recorded successfully"),i):"Failed to record email data"}catch(a){return console.error("Error recording email data:",a),a.message}}async function g(e,t,n=""){try{const o={data:{status:t,error:n}},{status:a}=await l.PUT(`message/${e}`,o,m.key);if(200!==a)return"Failed to update email status";console.log("Email status updated successfully")}catch(n){return console.error("Error updating email status:",n),n.message}}function f(e){const t=`Hello ${e.name},\n\nThis is your custom email body.\n\nYour custom data: ${e.content}`,n="Custom Email";return{emailBody:t,emailSubject:n}}function b(){const e="Welcome to our website!",t="Welcome Email";return{emailBody:e,emailSubject:t}}function h(){const e="\n  <p>สวัสดีค่ะ,</p>\n  <p>ขอแจ้งให้ทราบว่าบัญชีของคุณได้รับการเปลี่ยนแปลงรหัสผ่านเรียบร้อยแล้วค่ะ</p>\n  <p>หากคุณไม่ได้ดำเนินการเปลี่ยนรหัสผ่านนี้ กรุณาติดต่อทีมงานเพื่อรายงานให้ทราบค่ะ</p></br></br>\n  <p>ขอบคุณค่ะ</p>\n  ",t="แจ้งเตือน: บัญชีของคุณได้รับการเปลี่ยนรหัสผ่าน";return{emailBody:e,emailSubject:t}}async function x(e){try{const n={method:"find",args:[{$and:[{email:e.email}]}]},{data:o}=await l.POST("user/query",n,m.key);if(o.length>0){const e=y(6),n=i().lib.WordArray.random(16),a=i().SHA256(e+n).toString();try{const e={data:{password:a,salt:n.toString(),req_reset:!0}},{status:t}=await l.PUT(`user/${o[0]._id}`,e,m.key);if(200!==t)return"Failed to update email status";console.log("Email status updated successfully")}catch(t){return console.error("Error updating email status:",t),t.message}const s="แจ้งเตือน: รีเซ็ตรหัสผ่าน",r=`\n        <p>สวัสดีค่ะ,</p>\n        <p>ขอแจ้งให้ทราบว่าบัญชีของคุณได้รับการเปลี่ยนแปลงรหัสผ่านเรียบร้อยแล้วค่ะ</p>\n        <p>รหัสผ่านใหม่ของคุณคือ: <strong>${e}</strong></p>\n        <p>โปรดจำรหัสผ่านใหม่นี้ไว้เพื่อเข้าสู่ระบบในครั้งถัดไปค่ะ</p>\n        <p>หากคุณไม่ได้ดำเนินการเปลี่ยนรหัสผ่านนี้ กรุณาติดต่อทีมงานเพื่อรายงานให้ทราบค่ะ</p></br></br>\n        <p>ขอบคุณค่ะ</p>\n      `;return{emailBody:r,emailSubject:s}}return console.log("No User"),"User not found"}catch(t){return console.error("Error retrieving user information:",t),t.message}}function y(e){const t="0123456789";let n="";for(let o=0;o<e;o++){const e=Math.floor(Math.random()*t.length);n+=t[e]}return n}}}]);
//# sourceMappingURL=1944.d77b2e37.js.map