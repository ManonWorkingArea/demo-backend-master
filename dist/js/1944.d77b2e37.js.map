{"version":3,"file":"js/1944.d77b2e37.js","mappings":"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","sources":["webpack://node-backend/./src/extensions/modules/elearning/student/view/Forgot.vue","webpack://node-backend/./src/extensions/modules/elearning/student/component/frontend/Forgot.vue","webpack://node-backend/./src/extensions/modules/elearning/student/component/frontend/Forgot.vue?4200","webpack://node-backend/./src/extensions/modules/elearning/student/view/Forgot.vue?2c43","webpack://node-backend/./src/plugins/email/emailTemplate.js","webpack://node-backend/./src/plugins/sendEmail.js"],"sourcesContent":["<template>\n    <component :is=\"componentName\" />\n    </template>\n    \n    <script>\n    import { useTitle } from 'vue-page-title';\n    import { useRoute } from 'vue-router';\n    import storageManager from '@/plugins/storage';\n    import Frontend from '../component/frontend/Forgot.vue';\n    \n    export default {\n    name: 'Lesson Detail',\n    components: {\n        Frontend,\n    },\n    data() {\n        return {\n            session: storageManager.get('session')\n        };\n    },\n    setup() {\n        const route = useRoute();\n        const routeName = route.meta.title;\n        useTitle(routeName);\n    },\n    computed: {\n        componentName() {\n            return 'Frontend';\n        }\n    }\n    };\n    </script>\n        ","<script>\nimport storageManager from '@/plugins/storage';\nimport { sendEmail } from '@/plugins/sendEmail';\nexport default {\n\tname: 'Login',\n\tcomponents: {\n\t},\n  props: {\n    showModal: {\n      type: Boolean,\n      default: false\n    }\n  },\n\tdata() {\n\t\treturn {\n      config: storageManager.get('configs'),\n      email: '',\n      password: '',\n      errorStage: false,\n      errorMessage: '',\n      buttonText:'ส่งข้อมูลเพื่อขอรับรหัสผ่านใหม่'\n\t\t}\n\t},\n\tmethods: {\n    async resetPassword() {\n      try {\n        \n          this.activeBlock    = true;\n          this.errorStage     = false;\n          this.buttonText     = \"กำลังดำเนินการ...\";\n          const resAPILogin   = await fetch(\"https://gateway.cloudrestfulapi.com/api/user/query\", {\n              method: 'POST',\n              headers: {'Content-Type': 'application/json','client-token-key':this.configs.key},\n              body: JSON.stringify({\n                method: 'find',\n                args: [\n                  {\n                    $and: [\n                      { email: this.email }\n                    ]\n                  }\n                ]\n              })\n          });\n          \n          const getLogin  = await resAPILogin.json();\n\n          console.log(getLogin);\n          const loginData = getLogin.length > 0 ? getLogin[0] : null;\n\n          if (!getLogin || getLogin.length === 0) {\n            this.errorStage = true;\n            this.errorMessage = \"ไม่พบอีเมล์นี้ในระบบ กรุณาตรวจสอบหรือติดต่อทีมงาน\";\n            this.activeBlock = false;\n            this.buttonText = \"ส่งข้อมูลเพื่อขอรับรหัสผ่านใหม่\";\n            this.buttonDisabled = false;\n            return;\n          } else {\n            // Send Email\n            const emailData = {\n              email: loginData.email, // Use the email from the retrieved loginData\n              name: loginData.firstname + '' + loginData.lastname, // Use the name from the retrieved loginData\n            };\n            await sendEmail(emailData,'reset-password');\n\n            this.$swal({\n                icon: 'success',\n                title: 'การรีเซ็ตรหัสผ่านใหม่เรียบร้อยแล้ว',\n                text: 'ระบบได้ทำการรีเซ็ตและจัดส่งรหัสผ่านใหม่ให้ทางอีเมล์แล้ว กรุณาตรวจสอบอีเมล์และเข้าสู่ระบบด้วยวรหัสผ่านใหม่ เมื่อเข้าสู่ระบบครั้งแรก กรุณาเปลี่ยนรหัสผ่านใหม่อีกครั้งเพื่อความปลอดภัย',\n                showCancelButton: false,\n                confirmButtonText: 'ตกลง',\n              }).then(() => {\n                this.$router.push(\"/student/login\");\n              });\n          }\n          this.activeBlock  = false;\n      } catch (error) {\n        console.log(error)\n        this.buttonText = \"ส่งข้อมูลเพื่อขอรับรหัสผ่านใหม่\";\n        this.buttonDisabled = false;\n      }\n    }\n\t},\n};\n</script>\n\n<template>\n  <div class=\"bg-gray-50\">\n    \n    <div class=\"flex min-h-full flex-col justify-center py-12 sm:px-6 lg:px-8\">\n      <div class=\"sm:mx-auto sm:w-full sm:max-w-lg\">\n        <img class=\"mx-auto h-24 w-auto\" :src=\"this.config.siteLogo\" alt=\"Your Company\" v-if=\"!this.showModal\">\n        <h2 class=\"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900\">ลืมรหัสผ่าน FTI Academy</h2>\n        <p class=\"mt-2 text-center text-sm text-gray-600\">\n          หรือ\n          <router-link :to=\"'/student/register'\" class=\"font-medium text-indigo-600 hover:text-indigo-500\">\n          ลงทะเบียนผู้อบรมใหม่\n          </router-link>\n        </p>\n      </div>\n  \n      <div class=\"mt-8 sm:mx-auto sm:w-full sm:max-w-md relative\" :data-content=\"'กำลังติดต่อฐานข้อมูล กรุณารอสักครู่.....'\" :class=\"[(activeBlock?'isblock' : 'isunblock')]\">\n        <div class=\"bg-white px-4 py-8 shadow sm:rounded-lg sm:px-10\">\n          <form class=\"space-y-6\" @submit.prevent=\"resetPassword\">\n            <div>\n              <label for=\"email\" class=\"block text-md font-semibold leading-6 text-gray-900\">อีเมล์ที่ลงทะเบียน</label>\n              <div class=\"mt-2\">\n                <input v-model=\"email\" id=\"email\" name=\"email\" type=\"email\" autocomplete=\"email\" required=\"\" class=\"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\">\n              </div>\n            </div>\n  \n            <div>\n              <div v-if=\"errorStage\" class=\"col-span-2\">\n                <div class=\"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5\">\n                  <div class=\"font-semibold pt-3 pb-3\">เกิดข้อผิดพลาด</div>\n                  <div class=\"w-full\">{{ errorMessage }}</div>\n                </div>\n              </div>\n              <button\n              type=\"submit\"\n              :disabled=\"buttonDisabled\"\n              class=\"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\"\n            >\n              {{ buttonText }}\n            </button>\n            </div>\n          </form>\n  \n        </div>\n      </div>\n    </div>\n  \n    </div>\n</template>","import { render } from \"./Forgot.vue?vue&type=template&id=292749c4\"\nimport script from \"./Forgot.vue?vue&type=script&lang=js\"\nexport * from \"./Forgot.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./Forgot.vue?vue&type=template&id=117ebdad\"\nimport script from \"./Forgot.vue?vue&type=script&lang=js\"\nexport * from \"./Forgot.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","export const emailTemplate = `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Email Template</title>\n  <style>\n    /* Add your custom CSS styles here */\n    /* For example: */\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n      text-align: center;\n    }\n    body {\n      font-family: Arial, sans-serif;\n      line-height: 1.5;\n      background-color: #f2f2f2;\n      color: #ffffff;\n    }\n    .container {\n      max-width: 600px;\n      margin: 0px auto;\n      padding: 20px;\n      background-color: #ffffff;\n      border-radius: 5px;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n    }\n    .header img {\n      max-width: 150px;\n      height: auto;\n    }\n    .content {\n      padding: 20px;\n      border-top: 1px solid #e6e6e6;\n      border-bottom: 1px solid #e6e6e6;\n    }\n    .heading {\n      font-size: 18px;\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: center;\n    }\n    .text {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .container p {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .text p {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .footer {\n      text-align: center;\n      margin-top: 20px;\n      color: #888888;\n      font-size: 14px;\n    }\n    .footer a {\n      color: #888888;\n      text-decoration: none;\n      transition: color 0.3s ease;\n    }\n    .footer a:hover {\n      color: #ffffff;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\" style=\"margin-top:20px;\">\n    <div class=\"header\">\n      <img src=\"https://vue-project.sgp1.digitaloceanspaces.com/Logo/color-logopng.png\" alt=\"Logo\">\n    </div>\n    <div class=\"content\">\n      <h2 class=\"heading\">{{ subject }}</h2>\n      <p class=\"text\">{{ content }}</p>\n    </div>\n    <div class=\"footer\">\n      &copy; ${new Date().getFullYear()} {{ provider }}. All rights reserved.</a>\n    </div>\n  </div>\n</body>\n</html>\n`;\n","import storageManager from '@/plugins/storage';\nimport { emailTemplate } from './email/emailTemplate.js';\nimport CryptoJS from 'crypto-js';\n\nimport requestClient from '@/plugins/requestClient';\nconst Request = new requestClient(false);\n\nconst endpoint = 'https://gateway.cloudrestfulapi.com/email/send'; // Updated endpoint\nconst session = storageManager.get('session');\nconst configs = storageManager.get('configs');\n\nexport async function sendEmail(data, templateType = '') {\n  \n  let email_provider;\n\n  if (session.interface === 'frontend') {\n    ({ email_provider } = configs);\n  } else {\n    ({ email_provider } = session.current);\n  }\n\n  const { name, email, subject, body } = data;\n\n  try {\n    let emailBody;\n    let emailSubject;\n\n    if (templateType === 'welcome') {\n      ({ emailBody, emailSubject } = getWelcomeTemplate(data));\n    } else if (templateType === 'reset-password') {\n      ({ emailBody, emailSubject } = await getResetPasswordTemplate(data));\n    } else if (templateType === 'change-password') {\n      ({ emailBody, emailSubject } = await getChangePasswordTemplate(data));\n    } else if (templateType === 'new-template') { \n      ({ emailBody, emailSubject } = getNewTemplate(data));\n    } else {\n      emailBody = body;\n      emailSubject = subject;\n    }\n\n    emailBody = emailTemplate.replace('{{ content }}', emailBody).replace('{{ subject }}', emailSubject).replace('{{ provider }}', email_provider);\n\n    const emailData = await recordEmailData(name, email, emailSubject, emailBody);\n\n    const response = await Request.POST(endpoint, {\n      subject: emailSubject,\n      text: emailBody,\n      html: emailBody ,\n      fromEmail: \"noreply@fti.academy\",\n      fromName: \"Academy Customer Support\",\n      toEmail: email,\n      toName: name,\n    }, configs.key);\n\n    if (response.status === 200) { // Check the response status code\n      const responseData = response.data;\n      console.log(responseData.message);\n      await updateEmailStatus(emailData._id, 'confirm');\n      return responseData;\n    } else {\n      console.log('Failed to send email');\n      const errorMessage = 'Failed to send email';\n      await updateEmailStatus(emailData._id, 'fail', errorMessage);\n      return errorMessage;\n    }\n  } catch (error) {\n    console.error('Error sending email:', error);\n    return error.message;\n  }\n}\n\nasync function recordEmailData(name, email, subject, body) {\n  try {\n    const payload = {\n      data: {\n        name: name,\n        email: email,\n        subject: subject,\n        body: body,\n        status: 'submit'\n      },\n      options: {\n        fieldType: [],\n        uniqueFields: []\n      }\n    };\n\n    const { status, data } = await Request.POST('message/', payload, configs.key);\n\n    if (status === 200) {\n      console.log('Email data recorded successfully');\n      return data;\n    } else {\n      return 'Failed to record email data';\n    }\n  } catch (error) {\n    console.error('Error recording email data:', error);\n    return error.message;\n  }\n}\n\nasync function updateEmailStatus(id, status, error = '') {\n  try {\n    const payload = {\n      data: {\n        status: status,\n        error: error\n      }\n    };\n\n    const { status: responseStatus } = await Request.PUT(`message/${id}`, payload, configs.key);\n\n    if (responseStatus === 200) {\n      console.log('Email status updated successfully');\n    } else {\n      return 'Failed to update email status';\n    }\n  } catch (error) {\n    console.error('Error updating email status:', error);\n    return error.message;\n  }\n}\n\nfunction getNewTemplate(data) {\n  const emailBody = `Hello ${data.name},\\n\\nThis is your custom email body.\\n\\nYour custom data: ${data.content}`;\n  const emailSubject = 'Custom Email';\n  return { emailBody, emailSubject };\n}\n\nfunction getWelcomeTemplate() {\n  const emailBody = 'Welcome to our website!';\n  const emailSubject = 'Welcome Email';\n  return { emailBody, emailSubject };\n}\n\nfunction getChangePasswordTemplate() {\n  const emailBody = `\n  <p>สวัสดีค่ะ,</p>\n  <p>ขอแจ้งให้ทราบว่าบัญชีของคุณได้รับการเปลี่ยนแปลงรหัสผ่านเรียบร้อยแล้วค่ะ</p>\n  <p>หากคุณไม่ได้ดำเนินการเปลี่ยนรหัสผ่านนี้ กรุณาติดต่อทีมงานเพื่อรายงานให้ทราบค่ะ</p></br></br>\n  <p>ขอบคุณค่ะ</p>\n  `;\n  const emailSubject = 'แจ้งเตือน: บัญชีของคุณได้รับการเปลี่ยนรหัสผ่าน';\n  return { emailBody, emailSubject };\n}\n\nasync function getResetPasswordTemplate(data) {\n  try {\n    const payload = {\n      method: 'find',\n      args: [\n        {\n          $and: [\n            { email: data.email }\n          ]\n        }\n      ]\n    };\n\n    const { data: loginData } = await Request.POST('user/query', payload, configs.key);\n\n    if (loginData.length > 0) {\n      const newPassword = generatePassword(6);\n      const salt = CryptoJS.lib.WordArray.random(16);\n      const hash = CryptoJS.SHA256(newPassword + salt).toString();\n      \n      try {\n        const updatePayload = {\n          data: {\n            password: hash,\n            salt: salt.toString(),\n            req_reset: true\n          }\n        };\n\n        const { status } = await Request.PUT(`user/${loginData[0]._id}`, updatePayload, configs.key);\n    \n        if (status === 200) {\n          console.log('Email status updated successfully');\n        } else {\n          return 'Failed to update email status';\n        }\n      } catch (error) {\n        console.error('Error updating email status:', error);\n        return error.message;\n      }\n\n      const emailSubject = 'แจ้งเตือน: รีเซ็ตรหัสผ่าน';\n      const emailBody = `\n        <p>สวัสดีค่ะ,</p>\n        <p>ขอแจ้งให้ทราบว่าบัญชีของคุณได้รับการเปลี่ยนแปลงรหัสผ่านเรียบร้อยแล้วค่ะ</p>\n        <p>รหัสผ่านใหม่ของคุณคือ: <strong>${newPassword}</strong></p>\n        <p>โปรดจำรหัสผ่านใหม่นี้ไว้เพื่อเข้าสู่ระบบในครั้งถัดไปค่ะ</p>\n        <p>หากคุณไม่ได้ดำเนินการเปลี่ยนรหัสผ่านนี้ กรุณาติดต่อทีมงานเพื่อรายงานให้ทราบค่ะ</p></br></br>\n        <p>ขอบคุณค่ะ</p>\n      `;\n      return { emailBody, emailSubject };\n    } else {\n      console.log(\"No User\");\n      return 'User not found';\n    }\n  } catch (error) {\n    console.error('Error retrieving user information:', error);\n    return error.message;\n  }\n}\n\nfunction generatePassword(length) {\n  const characters = '0123456789';\n  let password = '';\n  for (let i = 0; i < length; i++) {\n    const randomIndex = Math.floor(Math.random() * characters.length);\n    password += characters[randomIndex];\n  }\n  return password;\n}\n"],"names":["_createBlock","_resolveDynamicComponent","$options","componentName","class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","showModal","_createCommentVNode","src","config","siteLogo","alt","_hoisted_4","_hoisted_5","_createTextVNode","_createVNode","_component_router_link","to","default","_withCtx","_cache","_","_normalizeClass","_ctx","activeBlock","_hoisted_6","onSubmit","_withModifiers","args","resetPassword","for","_hoisted_7","$event","$data","email","id","name","type","autocomplete","required","errorStage","_hoisted_8","_hoisted_9","_hoisted_10","_toDisplayString","errorMessage","disabled","buttonDisabled","buttonText","_hoisted_11","components","props","Boolean","data","storageManager","get","password","methods","this","resAPILogin","fetch","method","headers","configs","body","JSON","stringify","$and","getLogin","json","console","log","loginData","length","emailData","firstname","lastname","sendEmail","$swal","icon","title","text","showCancelButton","confirmButtonText","then","$router","push","error","__exports__","Frontend","session","setup","route","useRoute","routeName","meta","useTitle","computed","render","emailTemplate","Date","getFullYear","Request","requestClient","endpoint","async","templateType","email_provider","interface","current","subject","emailBody","emailSubject","getWelcomeTemplate","getResetPasswordTemplate","getChangePasswordTemplate","getNewTemplate","replace","recordEmailData","response","POST","html","fromEmail","fromName","toEmail","toName","status","responseData","message","updateEmailStatus","_id","payload","options","fieldType","uniqueFields","responseStatus","PUT","content","newPassword","generatePassword","salt","CryptoJS","WordArray","random","hash","toString","updatePayload","req_reset","characters","i","randomIndex","Math","floor"],"sourceRoot":""}