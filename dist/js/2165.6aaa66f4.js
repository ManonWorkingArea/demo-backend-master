"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[2165],{22165:function(e,t,s){s.r(t),s.d(t,{default:function(){return qo}});var a=s(20641);const i={class:"w-full h-full"};function n(e,t,s,n,l,o){const r=(0,a.g2)("PackageManagement",!0);return(0,a.uX)(),(0,a.CE)("div",i,[(0,a.bF)(r,{collectionId:o.collectionId},null,8,["collectionId"])])}var l=s(90033);const o={class:"package-management min-h-screen bg-gray-50"},r={class:"bg-white shadow-sm"},c={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},d={class:"flex justify-between items-center py-6"},g={class:"flex space-x-3"},u=["disabled"],m={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},p={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},y={class:"lg:col-span-2 space-y-8"},k={class:"bg-white rounded-lg shadow p-6"},b={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},h={class:"mt-1 text-sm text-gray-900"},f={class:"mt-1 text-sm text-gray-900"},x={class:"mt-1 text-sm text-gray-900"},v={class:"space-y-8"},L={class:"bg-white rounded-lg shadow p-6"},w={class:"space-y-3"},C={class:"bg-white rounded-lg shadow p-6"},D={class:"space-y-3"},P={key:0,class:"text-sm text-gray-500 text-center py-4"},_={class:"min-w-0 flex-1"},S={class:"text-gray-900"},E={class:"text-gray-500"},F={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},M={class:"relative top-4 mx-auto p-5 border w-11/12 md:w-5/6 lg:w-4/5 shadow-lg rounded-md bg-white max-h-screen overflow-y-auto"},I={class:"flex items-center justify-between pb-4 border-b"},X={class:"mt-4"},B={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},T={class:"relative top-4 mx-auto p-5 border w-11/12 md:w-5/6 lg:w-4/5 shadow-lg rounded-md bg-white max-h-screen overflow-y-auto"},A={class:"flex items-center justify-between pb-4 border-b"},j={class:"mt-4"};function V(e,t,s,i,n,V){const U=(0,a.g2)("font-awesome-icon"),Q=(0,a.g2)("PackageSubscriptionManager"),R=(0,a.g2)("PackageLimitMonitor"),H=(0,a.g2)("PackageAssignmentModal"),O=(0,a.g2)("PackageBillingHistory"),$=(0,a.g2)("AdvancedPackageConfig");return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("div",r,[(0,a.Lk)("div",c,[(0,a.Lk)("div",d,[t[12]||(t[12]=(0,a.Lk)("div",null,[(0,a.Lk)("h1",{class:"text-2xl font-bold text-gray-900"},"Package Management"),(0,a.Lk)("p",{class:"mt-1 text-sm text-gray-500"},"จัดการ Package และ Subscription สำหรับ Collection")],-1)),(0,a.Lk)("div",g,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>V.refreshData&&V.refreshData(...e)),disabled:n.loading,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[(0,a.bF)(U,{icon:["fas","sync-alt"],class:(0,l.C4)(["mr-2 h-4 w-4",{"animate-spin":n.loading}])},null,8,["class"]),t[11]||(t[11]=(0,a.eW)(" รีเฟรช "))],8,u)])])])]),(0,a.Lk)("div",m,[(0,a.Lk)("div",p,[(0,a.Lk)("div",y,[(0,a.Lk)("div",k,[t[17]||(t[17]=(0,a.Lk)("h2",{class:"text-lg font-medium text-gray-900 mb-4"},"ข้อมูล Collection",-1)),n.collection?((0,a.uX)(),(0,a.CE)("div",b,[(0,a.Lk)("div",null,[t[13]||(t[13]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700"},"ชื่อ Collection",-1)),(0,a.Lk)("p",h,(0,l.v_)(n.collection.siteName||"N/A"),1)]),(0,a.Lk)("div",null,[t[14]||(t[14]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700"},"ประเภท",-1)),(0,a.Lk)("p",f,(0,l.v_)(n.collection.siteType||"N/A"),1)]),(0,a.Lk)("div",null,[t[15]||(t[15]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700"},"สถานะ",-1)),(0,a.Lk)("span",{class:(0,l.C4)(V.getStatusClass(n.collection.status))},(0,l.v_)(n.collection.status?"เปิดใช้งาน":"ปิดใช้งาน"),3)]),(0,a.Lk)("div",null,[t[16]||(t[16]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700"},"วันที่สร้าง",-1)),(0,a.Lk)("p",x,(0,l.v_)(V.formatDate(n.collection.created_at)),1)])])):(0,a.Q3)("",!0)]),n.collection?((0,a.uX)(),(0,a.Wv)(Q,{key:0,collection:n.collection,hostkey:n.hostkey,onRefresh:V.refreshData},null,8,["collection","hostkey","onRefresh"])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",v,[n.collection&&n.usage?((0,a.uX)(),(0,a.Wv)(R,{key:0,collection:n.collection,usage:n.usage,onUpgradePackage:t[1]||(t[1]=e=>n.showUpgradeModal=!0),onViewPackages:t[2]||(t[2]=e=>n.showPackageSelection=!0),onRefreshUsage:V.refreshUsageData},null,8,["collection","usage","onRefreshUsage"])):(0,a.Q3)("",!0),(0,a.Lk)("div",L,[t[21]||(t[21]=(0,a.Lk)("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"การจัดการ",-1)),(0,a.Lk)("div",w,[(0,a.Lk)("button",{onClick:t[3]||(t[3]=e=>n.showBillingHistory=!0),class:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[(0,a.bF)(U,{icon:["fas","receipt"],class:"mr-2 h-4 w-4"}),t[18]||(t[18]=(0,a.eW)(" ดูประวัติการเรียกเก็บเงิน "))]),(0,a.Lk)("button",{onClick:t[4]||(t[4]=e=>n.showAdvancedConfig=!0),class:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[(0,a.bF)(U,{icon:["fas","cog"],class:"mr-2 h-4 w-4"}),t[19]||(t[19]=(0,a.eW)(" ตั้งค่าขั้นสูง "))]),(0,a.Lk)("button",{onClick:t[5]||(t[5]=e=>n.showPackageAssignment=!0),class:"w-full flex items-center justify-center px-4 py-2 bg-indigo-600 text-white rounded-md shadow-sm text-sm font-medium hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[(0,a.bF)(U,{icon:["fas","plus"],class:"mr-2 h-4 w-4"}),t[20]||(t[20]=(0,a.eW)(" กำหนด Package ใหม่ "))])])]),(0,a.Lk)("div",C,[t[23]||(t[23]=(0,a.Lk)("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"กิจกรรมล่าสุด",-1)),(0,a.Lk)("div",D,[0===n.recentActivities.length?((0,a.uX)(),(0,a.CE)("div",P," ไม่มีกิจกรรมล่าสุด ")):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.recentActivities,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"flex items-start space-x-3 text-sm"},[t[22]||(t[22]=(0,a.Lk)("div",{class:"flex-shrink-0"},[(0,a.Lk)("div",{class:"w-2 h-2 bg-indigo-500 rounded-full mt-2"})],-1)),(0,a.Lk)("div",_,[(0,a.Lk)("p",S,(0,l.v_)(e.message),1),(0,a.Lk)("p",E,(0,l.v_)(V.formatDate(e.created_at)),1)])])))),128))])])])])]),(0,a.bF)(H,{isOpen:n.showPackageAssignment,collection:n.collection,hostkey:n.hostkey,onClose:t[6]||(t[6]=e=>n.showPackageAssignment=!1),onAssigned:V.handlePackageAssigned},null,8,["isOpen","collection","hostkey","onAssigned"]),n.showBillingHistory?((0,a.uX)(),(0,a.CE)("div",F,[(0,a.Lk)("div",M,[(0,a.Lk)("div",I,[t[24]||(t[24]=(0,a.Lk)("h3",{class:"text-lg font-medium text-gray-900"},"ประวัติการเรียกเก็บเงิน",-1)),(0,a.Lk)("button",{onClick:t[7]||(t[7]=e=>n.showBillingHistory=!1),class:"text-gray-400 hover:text-gray-600"},[(0,a.bF)(U,{icon:["fas","times"],class:"h-6 w-6"})])]),(0,a.Lk)("div",X,[(0,a.bF)(O,{collection:n.collection,hostkey:n.hostkey,onClose:t[8]||(t[8]=e=>n.showBillingHistory=!1)},null,8,["collection","hostkey"])])])])):(0,a.Q3)("",!0),n.showAdvancedConfig?((0,a.uX)(),(0,a.CE)("div",B,[(0,a.Lk)("div",T,[(0,a.Lk)("div",A,[t[25]||(t[25]=(0,a.Lk)("h3",{class:"text-lg font-medium text-gray-900"},"การตั้งค่าขั้นสูง",-1)),(0,a.Lk)("button",{onClick:t[9]||(t[9]=e=>n.showAdvancedConfig=!1),class:"text-gray-400 hover:text-gray-600"},[(0,a.bF)(U,{icon:["fas","times"],class:"h-6 w-6"})])]),(0,a.Lk)("div",j,[(0,a.bF)($,{collection:n.collection,hostkey:n.hostkey,onClose:t[10]||(t[10]=e=>n.showAdvancedConfig=!1),onConfigured:V.handleAdvancedConfigured},null,8,["collection","hostkey","onConfigured"])])])])):(0,a.Q3)("",!0)])}const U={class:"bg-white shadow rounded-lg p-6"},Q={class:"flex items-center justify-between mb-6"},R={key:0,class:"space-y-6"},H={class:"p-4 bg-gradient-to-r from-indigo-50 to-blue-50 rounded-lg border border-indigo-200"},O={class:"flex items-center justify-between"},$={class:"flex items-center"},G={class:"flex-shrink-0"},q={class:"ml-4"},N={class:"text-lg font-semibold text-indigo-900"},W={class:"text-sm text-indigo-700"},Y={class:"text-right"},J={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},K={class:"space-y-4"},z={class:"space-y-3"},Z={class:"flex justify-between"},ee={class:"text-sm font-medium text-gray-900"},te={class:"flex justify-between"},se={class:"text-sm font-medium text-gray-900"},ae={class:"flex justify-between"},ie={class:"text-sm font-medium text-gray-900"},ne={class:"flex justify-between"},le={class:"text-sm font-medium text-gray-900"},oe={class:"flex justify-between"},re={class:"text-sm font-medium text-gray-900"},ce={key:0,class:"flex justify-between"},de={class:"text-sm font-medium text-green-600"},ge={class:"space-y-4"},ue={class:"space-y-3"},me={class:"flex justify-between text-sm mb-1"},pe={class:"font-medium"},ye={class:"w-full bg-gray-200 rounded-full h-2"},ke={class:"flex justify-between text-sm mb-1"},be={class:"font-medium"},he={class:"w-full bg-gray-200 rounded-full h-2"},fe={class:"flex justify-between text-sm mb-1"},xe={class:"font-medium"},ve={class:"w-full bg-gray-200 rounded-full h-2"},Le={class:"flex items-center"},we={class:"flex space-x-3"},Ce={key:1,class:"text-center py-12"},De={key:3,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Pe={class:"relative top-10 mx-auto p-5 border w-11/12 md:w-5/6 lg:w-4/5 shadow-lg rounded-md bg-white max-h-screen overflow-y-auto"};function _e(e,t,s,i,n,o){const r=(0,a.g2)("font-awesome-icon"),c=(0,a.g2)("PackageAssignmentModal"),d=(0,a.g2)("PackageBillingHistory"),g=(0,a.g2)("AdvancedPackageConfig");return(0,a.uX)(),(0,a.CE)("div",U,[(0,a.Lk)("div",Q,[t[11]||(t[11]=(0,a.Lk)("h3",{class:"text-lg font-medium text-gray-900"},"Package Subscription",-1)),n.currentSubscription?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[0]||(t[0]=e=>n.showAssignmentModal=!0),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700"},[(0,a.bF)(r,{icon:["fas","gift"],class:"mr-2"}),t[10]||(t[10]=(0,a.eW)(" กำหนด Package "))]))]),n.currentSubscription?((0,a.uX)(),(0,a.CE)("div",R,[(0,a.Lk)("div",H,[(0,a.Lk)("div",O,[(0,a.Lk)("div",$,[(0,a.Lk)("div",G,[(0,a.bF)(r,{icon:["fas","gift"],class:"w-8 h-8 text-indigo-600"})]),(0,a.Lk)("div",q,[(0,a.Lk)("h4",N,(0,l.v_)(n.currentPackage?.name),1),(0,a.Lk)("p",W,(0,l.v_)(n.currentPackage?.description),1)])]),(0,a.Lk)("div",Y,[(0,a.Lk)("span",{class:(0,l.C4)(["inline-flex px-3 py-1 rounded-full text-sm font-medium",o.getStatusClass(n.currentSubscription.status)])},(0,l.v_)(o.getStatusText(n.currentSubscription.status)),3)])])]),(0,a.Lk)("div",J,[(0,a.Lk)("div",K,[t[18]||(t[18]=(0,a.Lk)("h5",{class:"text-sm font-medium text-gray-900"},"ข้อมูลการเรียกเก็บเงิน",-1)),(0,a.Lk)("div",z,[(0,a.Lk)("div",Z,[t[12]||(t[12]=(0,a.Lk)("span",{class:"text-sm text-gray-600"},"รูปแบบการชำระเงิน:",-1)),(0,a.Lk)("span",ee,(0,l.v_)(o.getBillingCycleLabel()),1)]),(0,a.Lk)("div",te,[t[13]||(t[13]=(0,a.Lk)("span",{class:"text-sm text-gray-600"},"จำนวนเงิน:",-1)),(0,a.Lk)("span",se,"฿"+(0,l.v_)(n.currentSubscription.amount?.toLocaleString()),1)]),(0,a.Lk)("div",ae,[t[14]||(t[14]=(0,a.Lk)("span",{class:"text-sm text-gray-600"},"วันที่เริ่มต้น:",-1)),(0,a.Lk)("span",ie,(0,l.v_)(o.formatDate(n.currentSubscription.startDate)),1)]),(0,a.Lk)("div",ne,[t[15]||(t[15]=(0,a.Lk)("span",{class:"text-sm text-gray-600"},"วันที่สิ้นสุด:",-1)),(0,a.Lk)("span",le,(0,l.v_)(o.formatDate(n.currentSubscription.endDate)),1)]),(0,a.Lk)("div",oe,[t[16]||(t[16]=(0,a.Lk)("span",{class:"text-sm text-gray-600"},"ต่ออายุอัตโนมัติ:",-1)),(0,a.Lk)("span",re,(0,l.v_)(n.currentSubscription.autoRenewal?"เปิดใช้งาน":"ปิดใช้งาน"),1)]),n.currentSubscription.trialDays>0?((0,a.uX)(),(0,a.CE)("div",ce,[t[17]||(t[17]=(0,a.Lk)("span",{class:"text-sm text-gray-600"},"ระยะเวลาทดลองใช้:",-1)),(0,a.Lk)("span",de,(0,l.v_)(n.currentSubscription.trialDays)+" วัน",1)])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",ge,[t[22]||(t[22]=(0,a.Lk)("h5",{class:"text-sm font-medium text-gray-900"},"การใช้งาน",-1)),(0,a.Lk)("div",ue,[(0,a.Lk)("div",null,[(0,a.Lk)("div",me,[t[19]||(t[19]=(0,a.Lk)("span",{class:"text-gray-600"},"Assets",-1)),(0,a.Lk)("span",pe,(0,l.v_)(n.usage.assets)+"/"+(0,l.v_)(n.currentPackage?.limits.maxAssets||"∞"),1)]),(0,a.Lk)("div",ye,[(0,a.Lk)("div",{class:"bg-indigo-600 h-2 rounded-full",style:(0,l.Tr)({width:o.getUsagePercentage("assets")+"%"})},null,4)])]),(0,a.Lk)("div",null,[(0,a.Lk)("div",ke,[t[20]||(t[20]=(0,a.Lk)("span",{class:"text-gray-600"},"Users",-1)),(0,a.Lk)("span",be,(0,l.v_)(n.usage.users)+"/"+(0,l.v_)(n.currentPackage?.limits.maxUsers||"∞"),1)]),(0,a.Lk)("div",he,[(0,a.Lk)("div",{class:"bg-indigo-600 h-2 rounded-full",style:(0,l.Tr)({width:o.getUsagePercentage("users")+"%"})},null,4)])]),(0,a.Lk)("div",null,[(0,a.Lk)("div",fe,[t[21]||(t[21]=(0,a.Lk)("span",{class:"text-gray-600"},"Storage",-1)),(0,a.Lk)("span",xe,(0,l.v_)(n.usage.storageGB?.toFixed(2))+"GB/"+(0,l.v_)(n.currentPackage?.limits.storageGB||"∞")+"GB",1)]),(0,a.Lk)("div",ve,[(0,a.Lk)("div",{class:"bg-indigo-600 h-2 rounded-full",style:(0,l.Tr)({width:o.getUsagePercentage("storage")+"%"})},null,4)])])])])]),null!==o.daysRemaining?((0,a.uX)(),(0,a.CE)("div",{key:0,class:(0,l.C4)(["p-4 rounded-lg",[o.daysRemaining<=7?"bg-red-50 border border-red-200":o.daysRemaining<=30?"bg-yellow-50 border border-yellow-200":"bg-green-50 border border-green-200"]])},[(0,a.Lk)("div",Le,[(0,a.bF)(r,{icon:["fas",o.daysRemaining<=7?"exclamation-triangle":"calendar-alt"],class:(0,l.C4)(["w-5 h-5 mr-3",o.daysRemaining<=7?"text-red-500":o.daysRemaining<=30?"text-yellow-500":"text-green-500"])},null,8,["icon","class"]),(0,a.Lk)("div",null,[(0,a.Lk)("p",{class:(0,l.C4)(["text-sm font-medium",[o.daysRemaining<=7?"text-red-800":o.daysRemaining<=30?"text-yellow-800":"text-green-800"]])},(0,l.v_)(o.getExpiryText),3),(0,a.Lk)("p",{class:(0,l.C4)(["text-sm",[o.daysRemaining<=7?"text-red-700":o.daysRemaining<=30?"text-yellow-700":"text-green-700"]])},(0,l.v_)(n.currentSubscription.autoRenewal?"จะต่ออายุอัตโนมัติ":"ไม่มีการต่ออายุอัตโนมัติ"),3)])])],2)):(0,a.Q3)("",!0),(0,a.Lk)("div",we,[(0,a.Lk)("button",{onClick:t[1]||(t[1]=e=>n.showUpgradeModal=!0),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700"},[(0,a.bF)(r,{icon:["fas","arrow-up"],class:"mr-2"}),t[23]||(t[23]=(0,a.eW)(" อัปเกรด Package "))]),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>o.toggleAutoRenewal&&o.toggleAutoRenewal(...e)),class:(0,l.C4)(["inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm",n.currentSubscription.autoRenewal?"text-red-700 bg-red-100 hover:bg-red-200":"text-green-700 bg-green-100 hover:bg-green-200"])},[(0,a.bF)(r,{icon:["fas",n.currentSubscription.autoRenewal?"pause":"play"],class:"mr-2"},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(n.currentSubscription.autoRenewal?"ปิดการต่ออายุอัตโนมัติ":"เปิดการต่ออายุอัตโนมัติ"),1)],2),(0,a.Lk)("button",{onClick:t[3]||(t[3]=e=>n.showBillingHistory=!0),class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[(0,a.bF)(r,{icon:["fas","receipt"],class:"mr-2"}),t[24]||(t[24]=(0,a.eW)(" ประวัติการเรียกเก็บเงิน "))]),(0,a.Lk)("button",{onClick:t[4]||(t[4]=e=>n.showAdvancedConfig=!0),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-purple-600 hover:bg-purple-700"},[(0,a.bF)(r,{icon:["fas","cogs"],class:"mr-2"}),t[25]||(t[25]=(0,a.eW)(" การกำหนดค่าขั้นสูง "))]),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>o.cancelSubscription&&o.cancelSubscription(...e)),class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50"},[(0,a.bF)(r,{icon:["fas","times"],class:"mr-2"}),t[26]||(t[26]=(0,a.eW)(" ยกเลิก Package "))])])])):((0,a.uX)(),(0,a.CE)("div",Ce,[(0,a.bF)(r,{icon:["fas","gift"],class:"w-16 h-16 text-gray-400 mb-4"}),t[28]||(t[28]=(0,a.Lk)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"ยังไม่มี Package",-1)),t[29]||(t[29]=(0,a.Lk)("p",{class:"text-gray-600 mb-6"},"กำหนด Package เพื่อใช้งานฟีเจอร์เพิ่มเติมและขยายขีดจำกัด",-1)),(0,a.Lk)("button",{onClick:t[6]||(t[6]=e=>n.showAssignmentModal=!0),class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700"},[(0,a.bF)(r,{icon:["fas","gift"],class:"mr-2"}),t[27]||(t[27]=(0,a.eW)(" เลือก Package "))])])),(0,a.bF)(c,{isOpen:n.showAssignmentModal,collection:s.collection,hostkey:s.hostkey,onClose:t[7]||(t[7]=e=>n.showAssignmentModal=!1),onAssigned:o.handlePackageAssigned},null,8,["isOpen","collection","hostkey","onAssigned"]),n.showBillingHistory?((0,a.uX)(),(0,a.Wv)(d,{key:2,collection:s.collection,hostkey:s.hostkey,onClose:t[8]||(t[8]=e=>n.showBillingHistory=!1)},null,8,["collection","hostkey"])):(0,a.Q3)("",!0),n.showAdvancedConfig?((0,a.uX)(),(0,a.CE)("div",De,[(0,a.Lk)("div",Pe,[(0,a.bF)(g,{collection:s.collection,hostkey:s.hostkey,onClose:t[9]||(t[9]=e=>n.showAdvancedConfig=!1),onConfigured:o.handleAdvancedConfigured},null,8,["collection","hostkey","onConfigured"])])])):(0,a.Q3)("",!0)])}s(98992),s(72577);var Se=s(53751);const Ee={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Fe={class:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white"},Me={class:"mt-3"},Ie={class:"flex items-center justify-between pb-4 border-b"},Xe={key:0,class:"mt-4 rounded-md bg-red-50 p-4"},Be={class:"flex"},Te={class:"text-sm text-red-700"},Ae={key:1,class:"mt-4 rounded-md bg-green-50 p-4"},je={class:"flex"},Ve={key:2,class:"mt-6 p-4 bg-gray-50 rounded-lg"},Ue={class:"flex items-center"},Qe={class:"flex-shrink-0 h-10 w-10"},Re=["src"],He={class:"ml-4"},Oe={class:"text-sm font-medium text-gray-900"},$e={class:"text-sm text-gray-500"},Ge={class:"mt-6"},qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ne=["onClick"],We={class:"flex items-center justify-between mb-3"},Ye={class:"text-lg font-semibold text-gray-900"},Je={class:"flex items-center"},Ke=["checked","onChange"],ze={class:"text-sm text-gray-600 mb-3"},Ze={class:"space-y-2"},et={class:"flex items-center"},tt={class:"text-sm font-medium text-gray-900"},st={key:0,class:"ml-2 text-xs text-green-600 bg-green-100 px-2 py-1 rounded"},at={class:"text-sm font-semibold text-indigo-600"},it={class:"mt-3 grid grid-cols-2 gap-2 text-xs"},nt={class:"flex items-center"},lt={class:"flex items-center"},ot={class:"flex items-center"},rt={class:"flex items-center"},ct={key:3,class:"mt-6 p-4 border rounded-lg bg-gray-50"},dt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},gt=["value"],ut={key:0},mt={class:"md:col-span-2"},pt={class:"inline-flex items-center"},yt={key:0,class:"md:col-span-2"},kt={class:"inline-flex items-center"},bt={class:"mt-4 p-3 bg-indigo-50 rounded-lg"},ht={class:"space-y-1 text-sm"},ft={class:"flex justify-between"},xt={class:"text-indigo-700"},vt={class:"font-medium text-indigo-900"},Lt={key:0,class:"flex justify-between"},wt={class:"font-medium text-green-600"},Ct={key:1,class:"flex justify-between"},Dt={class:"font-medium text-indigo-900"},Pt={class:"border-t border-indigo-200 pt-1 flex justify-between font-semibold"},_t={class:"text-indigo-900"},St={class:"mt-6 flex justify-end space-x-3"},Et=["disabled"],Ft={key:0},Mt={key:1};function It(e,t,s,i,n,o){const r=(0,a.g2)("font-awesome-icon"),c=(0,a.g2)("FlexibleDateTimePicker");return s.isOpen?((0,a.uX)(),(0,a.CE)("div",Ee,[(0,a.Lk)("div",Fe,[(0,a.Lk)("div",Me,[(0,a.Lk)("div",Ie,[t[9]||(t[9]=(0,a.Lk)("h3",{class:"text-lg font-medium text-gray-900"}," กำหนด Package สำหรับ Collection ",-1)),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>o.closeModal&&o.closeModal(...e)),class:"text-gray-400 hover:text-gray-600"},[(0,a.bF)(r,{icon:["fas","times"],class:"w-6 h-6"})])]),n.error?((0,a.uX)(),(0,a.CE)("div",Xe,[(0,a.Lk)("div",Be,[(0,a.bF)(r,{icon:["fas","exclamation-circle"],class:"h-5 w-5 text-red-400 mr-3"}),(0,a.Lk)("div",null,[t[10]||(t[10]=(0,a.Lk)("h3",{class:"text-sm font-medium text-red-800"},"เกิดข้อผิดพลาด",-1)),(0,a.Lk)("p",Te,(0,l.v_)(n.error),1)])])])):(0,a.Q3)("",!0),n.success?((0,a.uX)(),(0,a.CE)("div",Ae,[(0,a.Lk)("div",je,[(0,a.bF)(r,{icon:["fas","check-circle"],class:"h-5 w-5 text-green-400 mr-3"}),t[11]||(t[11]=(0,a.Lk)("div",null,[(0,a.Lk)("h3",{class:"text-sm font-medium text-green-800"},"สำเร็จ"),(0,a.Lk)("p",{class:"text-sm text-green-700"},"กำหนด Package เรียบร้อยแล้ว")],-1))])])):(0,a.Q3)("",!0),s.collection?((0,a.uX)(),(0,a.CE)("div",Ve,[t[12]||(t[12]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Collection",-1)),(0,a.Lk)("div",Ue,[(0,a.Lk)("div",Qe,[(0,a.Lk)("img",{src:s.collection.siteLogo||"https://via.placeholder.com/40",class:"h-10 w-10 rounded-full object-cover",alt:""},null,8,Re)]),(0,a.Lk)("div",He,[(0,a.Lk)("p",Oe,(0,l.v_)(s.collection.siteName),1),(0,a.Lk)("p",$e,(0,l.v_)(s.collection.hostname),1)])])])):(0,a.Q3)("",!0),(0,a.Lk)("div",Ge,[t[13]||(t[13]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"เลือก Package",-1)),(0,a.Lk)("div",qe,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.availablePackages,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e._id,onClick:t=>n.selectedPackage=e,class:(0,l.C4)(["relative p-4 border-2 rounded-lg cursor-pointer transition-all",n.selectedPackage&&n.selectedPackage._id===e._id?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"])},[(0,a.Lk)("div",We,[(0,a.Lk)("h3",Ye,(0,l.v_)(e.name),1),(0,a.Lk)("div",Je,[(0,a.Lk)("input",{type:"radio",checked:n.selectedPackage&&n.selectedPackage._id===e._id,onChange:t=>n.selectedPackage=e,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,40,Ke)])]),(0,a.Lk)("p",ze,(0,l.v_)(e.description),1),(0,a.Lk)("div",Ze,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.pricing?.billingCycles||[],(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.type,class:"flex items-center justify-between p-2 bg-white rounded border"},[(0,a.Lk)("div",et,[(0,a.Lk)("span",tt,(0,l.v_)(e.label),1),e.discount>0?((0,a.uX)(),(0,a.CE)("span",st," ลด "+(0,l.v_)(e.discount)+"% ",1)):(0,a.Q3)("",!0)]),(0,a.Lk)("span",at," ฿"+(0,l.v_)(e.price.toLocaleString()),1)])))),128))]),(0,a.Lk)("div",it,[(0,a.Lk)("div",nt,[(0,a.bF)(r,{icon:["fas","database"],class:"text-indigo-600 mr-1"}),(0,a.Lk)("span",null,(0,l.v_)(e.limits.maxAssets)+" Assets",1)]),(0,a.Lk)("div",lt,[(0,a.bF)(r,{icon:["fas","users"],class:"text-indigo-600 mr-1"}),(0,a.Lk)("span",null,(0,l.v_)(e.limits.maxUsers)+" Users",1)]),(0,a.Lk)("div",ot,[(0,a.bF)(r,{icon:["fas","hdd"],class:"text-indigo-600 mr-1"}),(0,a.Lk)("span",null,(0,l.v_)(e.limits.storageGB)+" GB",1)]),(0,a.Lk)("div",rt,[(0,a.bF)(r,{icon:["fas","tachometer-alt"],class:"text-indigo-600 mr-1"}),(0,a.Lk)("span",null,(0,l.v_)(e.limits.bandwidth)+" GB/mo",1)])])],10,Ne)))),128))])]),n.selectedPackage?((0,a.uX)(),(0,a.CE)("div",ct,[t[22]||(t[22]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-4"},"การตั้งค่า Package",-1)),(0,a.Lk)("div",dt,[(0,a.Lk)("div",null,[t[14]||(t[14]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"รูปแบบการชำระเงิน",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.assignmentConfig.billingCycle=e),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.selectedPackage?.pricing?.billingCycles||[],(e=>((0,a.uX)(),(0,a.CE)("option",{key:e.type,value:e.type},[(0,a.eW)((0,l.v_)(e.label)+" - ฿"+(0,l.v_)(e.price.toLocaleString())+" ",1),e.discount>0?((0,a.uX)(),(0,a.CE)("span",ut,"(ลด "+(0,l.v_)(e.discount)+"%)",1)):(0,a.Q3)("",!0)],8,gt)))),128))],512),[[Se.u1,n.assignmentConfig.billingCycle]])]),(0,a.Lk)("div",null,[(0,a.bF)(c,{modelValue:n.assignmentConfig.startDate,"onUpdate:modelValue":t[2]||(t[2]=e=>n.assignmentConfig.startDate=e),label:"วันที่เริ่มต้น",placeholder:"เลือกวันที่เริ่มต้นใช้งาน Package","min-date":o.today,"show-quick-dates":!0,"business-days-only":!0,"custom-validation":o.validateStartDate,required:""},null,8,["modelValue","min-date","custom-validation"])]),(0,a.Lk)("div",mt,[(0,a.Lk)("label",pt,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>n.assignmentConfig.autoRenewal=e),type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[Se.lH,n.assignmentConfig.autoRenewal]]),t[15]||(t[15]=(0,a.Lk)("span",{class:"ml-2 text-sm text-gray-700"},"ต่ออายุอัตโนมัติ",-1))])]),n.assignmentConfig.autoRenewal?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",yt,[(0,a.bF)(c,{modelValue:n.assignmentConfig.customEndDate,"onUpdate:modelValue":t[4]||(t[4]=e=>n.assignmentConfig.customEndDate=e),label:"วันที่สิ้นสุด (ถ้าไม่ต่ออายุอัตโนมัติ)",placeholder:"เลือกวันที่สิ้นสุด Package","min-date":n.assignmentConfig.startDate,"show-quick-dates":!0,"custom-validation":o.validateEndDate,required:""},null,8,["modelValue","min-date","custom-validation"])])),(0,a.Lk)("div",null,[t[16]||(t[16]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ระยะเวลาทดลองใช้ (วัน)",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>n.assignmentConfig.trialDays=e),type:"number",min:"0",max:"365",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[Se.Jo,n.assignmentConfig.trialDays]])]),(0,a.Lk)("div",null,[(0,a.Lk)("label",kt,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>n.assignmentConfig.proration=e),type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[Se.lH,n.assignmentConfig.proration]]),t[17]||(t[17]=(0,a.Lk)("span",{class:"ml-2 text-sm text-gray-700"},"คิดค่าใช้จ่ายตามสัดส่วน",-1))])])]),(0,a.Lk)("div",bt,[t[21]||(t[21]=(0,a.Lk)("h5",{class:"text-sm font-medium text-indigo-900 mb-2"},"สรุปค่าใช้จ่าย",-1)),(0,a.Lk)("div",ht,[(0,a.Lk)("div",ft,[(0,a.Lk)("span",xt,(0,l.v_)(o.selectedBillingCycle?.label)+":",1),(0,a.Lk)("span",vt,"฿"+(0,l.v_)(o.selectedBillingCycle?.price.toLocaleString()),1)]),n.assignmentConfig.trialDays>0?((0,a.uX)(),(0,a.CE)("div",Lt,[t[18]||(t[18]=(0,a.Lk)("span",{class:"text-indigo-700"},"ระยะเวลาทดลองใช้:",-1)),(0,a.Lk)("span",wt,(0,l.v_)(n.assignmentConfig.trialDays)+" วัน (ฟรี)",1)])):(0,a.Q3)("",!0),o.prorationAmount?((0,a.uX)(),(0,a.CE)("div",Ct,[t[19]||(t[19]=(0,a.Lk)("span",{class:"text-indigo-700"},"คิดตามสัดส่วน:",-1)),(0,a.Lk)("span",Dt,"฿"+(0,l.v_)(o.prorationAmount.toLocaleString()),1)])):(0,a.Q3)("",!0),(0,a.Lk)("div",Pt,[t[20]||(t[20]=(0,a.Lk)("span",{class:"text-indigo-900"},"รวมทั้งสิ้น:",-1)),(0,a.Lk)("span",_t,"฿"+(0,l.v_)(o.totalAmount.toLocaleString()),1)])])])])):(0,a.Q3)("",!0),(0,a.Lk)("div",St,[(0,a.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>o.closeModal&&o.closeModal(...e)),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"}," ยกเลิก "),(0,a.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>o.assignPackage&&o.assignPackage(...e)),disabled:!n.selectedPackage||n.loading,class:"px-4 py-2 border border-transparent rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-300"},[n.loading?((0,a.uX)(),(0,a.CE)("span",Ft,"กำลังดำเนินการ...")):((0,a.uX)(),(0,a.CE)("span",Mt,"กำหนด Package"))],8,Et)])])])])):(0,a.Q3)("",!0)}s(81454);const Xt={class:"flexible-datetime-picker"},Bt={key:0,class:"block text-sm font-medium text-gray-700 mb-2"},Tt={key:0,class:"text-red-500"},At={class:"relative"},jt=["placeholder","disabled","readonly"],Vt={class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},Ut={key:1,class:"mt-1 text-sm text-red-600"},Qt={class:"flex items-center justify-between mb-4 pb-2 border-b border-gray-200"},Rt={class:"text-sm font-medium text-gray-900"},Ht={key:0,class:"mb-4"},Ot={class:"grid grid-cols-2 gap-2"},$t=["onClick"],Gt={class:"grid grid-cols-3 gap-3 mb-4"},qt=["value"],Nt=["value"],Wt=["value"],Yt={key:1,class:"grid grid-cols-2 gap-3 mb-4"},Jt=["value"],Kt=["value"],zt={key:2,class:"mb-4"},Zt={class:"flex items-center"},es={key:3,class:"mb-4 p-2 bg-yellow-50 border border-yellow-200 rounded-md"},ts={class:"text-xs text-yellow-700"},ss={class:"flex justify-between space-x-2"},as={class:"flex space-x-2"};function is(e,t,s,i,n,o){const r=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)("div",Xt,[s.label?((0,a.uX)(),(0,a.CE)("label",Bt,[(0,a.eW)((0,l.v_)(s.label)+" ",1),s.required?((0,a.uX)(),(0,a.CE)("span",Tt,"*")):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),(0,a.Lk)("div",At,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.displayValue=e),placeholder:s.placeholder,disabled:s.disabled,readonly:s.readonly,onClick:t[1]||(t[1]=(...e)=>o.openPicker&&o.openPicker(...e)),onFocus:t[2]||(t[2]=(...e)=>o.openPicker&&o.openPicker(...e)),class:(0,l.C4)(["block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm cursor-pointer",{"bg-gray-50 cursor-not-allowed":s.disabled,"border-red-300 focus:border-red-500 focus:ring-red-500":o.hasError}])},null,42,jt),[[Se.Jo,o.displayValue]]),(0,a.Lk)("div",Vt,[(0,a.bF)(r,{icon:["fas","calendar-alt"],class:"h-5 w-5 text-gray-400"})])]),o.hasError?((0,a.uX)(),(0,a.CE)("p",Ut,(0,l.v_)(o.errorMessage),1)):(0,a.Q3)("",!0),n.showPicker?((0,a.uX)(),(0,a.CE)("div",{key:2,class:"absolute z-50 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-4",style:(0,l.Tr)(n.panelStyle)},[(0,a.Lk)("div",Qt,[(0,a.Lk)("h4",Rt,(0,l.v_)(s.pickerTitle),1),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>o.closePicker&&o.closePicker(...e)),class:"text-gray-400 hover:text-gray-600"},[(0,a.bF)(r,{icon:["fas","times"],class:"h-4 w-4"})])]),s.showQuickDates?((0,a.uX)(),(0,a.CE)("div",Ht,[t[16]||(t[16]=(0,a.Lk)("p",{class:"text-xs font-medium text-gray-700 mb-2"},"วันที่ทั่วไป",-1)),(0,a.Lk)("div",Ot,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.quickDateOptions,(e=>((0,a.uX)(),(0,a.CE)("button",{key:e.key,onClick:t=>o.selectQuickDate(e),class:"px-3 py-2 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors"},(0,l.v_)(e.label),9,$t)))),128))])])):(0,a.Q3)("",!0),(0,a.Lk)("div",Gt,[(0,a.Lk)("div",null,[t[17]||(t[17]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ปี",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.selectedYear=e),onChange:t[5]||(t[5]=(...e)=>o.updateCalendar&&o.updateCalendar(...e)),class:"block w-full text-sm border-gray-300 rounded-md focus:border-indigo-500 focus:ring-indigo-500"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.yearOptions,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,l.v_)(e+543),9,qt)))),128))],544),[[Se.u1,n.selectedYear]])]),(0,a.Lk)("div",null,[t[18]||(t[18]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"เดือน",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>n.selectedMonth=e),onChange:t[7]||(t[7]=(...e)=>o.updateCalendar&&o.updateCalendar(...e)),class:"block w-full text-sm border-gray-300 rounded-md focus:border-indigo-500 focus:ring-indigo-500"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.monthNames,((e,t)=>((0,a.uX)(),(0,a.CE)("option",{key:t,value:t+1},(0,l.v_)(e),9,Nt)))),128))],544),[[Se.u1,n.selectedMonth]])]),(0,a.Lk)("div",null,[t[19]||(t[19]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"วัน",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>n.selectedDay=e),class:"block w-full text-sm border-gray-300 rounded-md focus:border-indigo-500 focus:ring-indigo-500"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.daysInMonth,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,l.v_)(e),9,Wt)))),128))],512),[[Se.u1,n.selectedDay]])])]),s.includeTime?((0,a.uX)(),(0,a.CE)("div",Yt,[(0,a.Lk)("div",null,[t[20]||(t[20]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ชั่วโมง",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>n.selectedHour=e),class:"block w-full text-sm border-gray-300 rounded-md focus:border-indigo-500 focus:ring-indigo-500"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.hourOptions,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,l.v_)(e.toString().padStart(2,"0")),9,Jt)))),128))],512),[[Se.u1,n.selectedHour]])]),(0,a.Lk)("div",null,[t[21]||(t[21]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"นาที",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>n.selectedMinute=e),class:"block w-full text-sm border-gray-300 rounded-md focus:border-indigo-500 focus:ring-indigo-500"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.minuteOptions,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,l.v_)(e.toString().padStart(2,"0")),9,Kt)))),128))],512),[[Se.u1,n.selectedMinute]])])])):(0,a.Q3)("",!0),s.businessDaysOnly?((0,a.uX)(),(0,a.CE)("div",zt,[(0,a.Lk)("label",Zt,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>n.skipWeekends=e),type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[Se.lH,n.skipWeekends]]),t[22]||(t[22]=(0,a.Lk)("span",{class:"ml-2 text-sm text-gray-700"},"ข้ามวันเสาร์-อาทิตย์",-1))])])):(0,a.Q3)("",!0),s.customValidation&&o.validationMessage?((0,a.uX)(),(0,a.CE)("div",es,[(0,a.Lk)("p",ts,(0,l.v_)(o.validationMessage),1)])):(0,a.Q3)("",!0),(0,a.Lk)("div",ss,[(0,a.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>o.clearDate&&o.clearDate(...e)),class:"px-3 py-2 text-sm text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors"}," ล้างค่า "),(0,a.Lk)("div",as,[(0,a.Lk)("button",{onClick:t[13]||(t[13]=(...e)=>o.setToday&&o.setToday(...e)),class:"px-3 py-2 text-sm text-indigo-600 bg-indigo-50 hover:bg-indigo-100 rounded-md transition-colors"}," วันนี้ "),(0,a.Lk)("button",{onClick:t[14]||(t[14]=(...e)=>o.confirmSelection&&o.confirmSelection(...e)),class:"px-3 py-2 text-sm text-white bg-indigo-600 hover:bg-indigo-700 rounded-md transition-colors"}," ยืนยัน ")])])],4)):(0,a.Q3)("",!0),n.showPicker?((0,a.uX)(),(0,a.CE)("div",{key:3,onClick:t[15]||(t[15]=(...e)=>o.closePicker&&o.closePicker(...e)),class:"fixed inset-0 z-40"})):(0,a.Q3)("",!0)])}s(44114);var ns={name:"FlexibleDateTimePicker",props:{modelValue:{type:[String,Date],default:null},label:{type:String,default:""},placeholder:{type:String,default:"เลือกวันที่"},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},includeTime:{type:Boolean,default:!1},businessDaysOnly:{type:Boolean,default:!1},minDate:{type:[String,Date],default:null},maxDate:{type:[String,Date],default:null},showQuickDates:{type:Boolean,default:!0},customValidation:{type:Function,default:null},format:{type:String,default:"DD/MM/YYYY"},timeFormat:{type:String,default:"HH:mm"},pickerTitle:{type:String,default:"เลือกวันที่"}},emits:["update:modelValue","change","focus","blur"],data(){return{showPicker:!1,selectedYear:(new Date).getFullYear(),selectedMonth:(new Date).getMonth()+1,selectedDay:(new Date).getDate(),selectedHour:(new Date).getHours(),selectedMinute:(new Date).getMinutes(),skipWeekends:!1,panelStyle:{minWidth:"320px",maxWidth:"400px"},monthNames:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],quickDateOptions:[{key:"today",label:"วันนี้",days:0},{key:"tomorrow",label:"พรุ่งนี้",days:1},{key:"week",label:"สัปดาห์หน้า",days:7},{key:"month",label:"เดือนหน้า",days:30},{key:"quarter",label:"3 เดือน",days:90},{key:"year",label:"ปีหน้า",days:365}]}},computed:{displayValue(){if(!this.modelValue)return"";const e=new Date(this.modelValue);if(isNaN(e.getTime()))return"";let t=this.formatDate(e,this.format);return this.includeTime&&(t+=" "+this.formatTime(e,this.timeFormat)),t},yearOptions(){const e=(new Date).getFullYear(),t=[];for(let s=e-10;s<=e+10;s++)t.push(s);return t},hourOptions(){return Array.from({length:24},((e,t)=>t))},minuteOptions(){return Array.from({length:60},((e,t)=>t))},daysInMonth(){const e=new Date(this.selectedYear,this.selectedMonth,0).getDate();return Array.from({length:e},((e,t)=>t+1))},hasError(){return null!==this.validationMessage},errorMessage(){return this.validationMessage},validationMessage(){if(!this.customValidation)return null;const e=this.getCurrentDate();return this.customValidation(e)}},methods:{openPicker(){this.disabled||this.readonly||(this.initializeFromValue(),this.showPicker=!0,this.$emit("focus"))},closePicker(){this.showPicker=!1,this.$emit("blur")},initializeFromValue(){if(this.modelValue){const e=new Date(this.modelValue);isNaN(e.getTime())||(this.selectedYear=e.getFullYear(),this.selectedMonth=e.getMonth()+1,this.selectedDay=e.getDate(),this.selectedHour=e.getHours(),this.selectedMinute=e.getMinutes())}},updateCalendar(){const e=new Date(this.selectedYear,this.selectedMonth,0).getDate();this.selectedDay>e&&(this.selectedDay=e)},selectQuickDate(e){const t=new Date;t.setDate(t.getDate()+e.days),this.selectedYear=t.getFullYear(),this.selectedMonth=t.getMonth()+1,this.selectedDay=t.getDate(),this.includeTime&&(this.selectedHour=t.getHours(),this.selectedMinute=t.getMinutes())},setToday(){const e=new Date;this.selectedYear=e.getFullYear(),this.selectedMonth=e.getMonth()+1,this.selectedDay=e.getDate(),this.includeTime&&(this.selectedHour=e.getHours(),this.selectedMinute=e.getMinutes())},clearDate(){this.$emit("update:modelValue",null),this.$emit("change",null),this.closePicker()},confirmSelection(){const e=this.getCurrentDate();if(this.businessDaysOnly&&this.skipWeekends){const t=e.getDay();if(0===t||6===t)return void alert("ไม่สามารถเลือกวันเสาร์หรือวันอาทิตย์ได้")}if(this.minDate){const t=new Date(this.minDate);if(e<t)return void alert("วันที่ที่เลือกต้องไม่น้อยกว่าวันที่ขั้นต่ำ")}if(this.maxDate){const t=new Date(this.maxDate);if(e>t)return void alert("วันที่ที่เลือกต้องไม่มากกว่าวันที่สูงสุด")}if(this.customValidation){const t=this.customValidation(e);if(t)return void alert(t)}const t=e.toISOString();this.$emit("update:modelValue",t),this.$emit("change",t),this.closePicker()},getCurrentDate(){return new Date(this.selectedYear,this.selectedMonth-1,this.selectedDay,this.includeTime?this.selectedHour:0,this.includeTime?this.selectedMinute:0)},formatDate(e,t){const s=e.getDate().toString().padStart(2,"0"),a=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getFullYear(),n=i+543;return t.replace("DD",s).replace("MM",a).replace("YYYY",n).replace("YY",n.toString().slice(-2))},formatTime(e,t){const s=e.getHours().toString().padStart(2,"0"),a=e.getMinutes().toString().padStart(2,"0");return t.replace("HH",s).replace("mm",a)}},watch:{modelValue:{handler(){this.initializeFromValue()},immediate:!0}}},ls=s(64621);const os=(0,ls.A)(ns,[["render",is],["__scopeId","data-v-a6ab28ee"]]);var rs=os,cs={name:"PackageAssignmentModal",components:{FlexibleDateTimePicker:rs},props:{isOpen:{type:Boolean,default:!1},collection:{type:Object,default:null},hostkey:{type:String,required:!0}},emits:["close","assigned"],data(){return{availablePackages:[],selectedPackage:null,assignmentConfig:{billingCycle:"monthly",startDate:this.today,autoRenewal:!0,customEndDate:null,trialDays:0,proration:!1},loading:!1,error:null,success:!1}},watch:{isOpen(e){e&&this.loadPackages()},selectedPackage(e){e?.pricing?.billingCycles?.length>0&&(this.assignmentConfig.billingCycle=e.pricing.billingCycles[0].type)}},computed:{today(){return(new Date).toISOString().split("T")[0]},selectedBillingCycle(){return this.selectedPackage?.pricing?.billingCycles?this.selectedPackage.pricing.billingCycles.find((e=>e.type===this.assignmentConfig.billingCycle)):null},prorationAmount(){if(!this.assignmentConfig.proration||!this.selectedBillingCycle)return 0;const e=new Date(this.assignmentConfig.startDate),t=new Date(e.getFullYear(),e.getMonth()+1,0),s=Math.ceil((t-e)/864e5),a=t.getDate();return Math.round(this.selectedBillingCycle.price/a*s)},totalAmount(){return this.selectedBillingCycle?this.assignmentConfig.trialDays>0?0:this.assignmentConfig.proration?this.prorationAmount:this.selectedBillingCycle.price:0}},methods:{validateStartDate(e){if(!e)return"กรุณาเลือกวันที่เริ่มต้น";const t=new Date;if(t.setHours(0,0,0,0),e<t)return"วันที่เริ่มต้นต้องไม่น้อยกว่าวันนี้";const s=e.getDay();return 0===s||6===s?"แนะนำให้เลือกวันจันทร์-ศุกร์ สำหรับการเริ่มต้นใช้งาน":null},validateEndDate(e){if(!e)return"กรุณาเลือกวันที่สิ้นสุด";if(!this.assignmentConfig.startDate)return"กรุณาเลือกวันที่เริ่มต้นก่อน";const t=new Date(this.assignmentConfig.startDate);if(e<=t)return"วันที่สิ้นสุดต้องมากกว่าวันที่เริ่มต้น";const s=Math.ceil((e-t)/864e5);return s<7?"ระยะเวลาใช้งานต้องไม่น้อยกว่า 7 วัน":null},async loadPackages(){try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/package/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{status:!0}]})});if(e.ok){const t=await e.json();this.availablePackages=t.map((e=>({...e,pricing:e.pricing||{billingCycles:[{type:"monthly",label:"รายเดือน",price:e.price||0,duration:30,discount:0}]}})))}}catch(e){console.error("Error loading packages:",e),this.error="ไม่สามารถโหลดรายการ Package ได้"}},async assignPackage(){try{if(this.loading=!0,this.error=null,!this.selectedPackage)return void(this.error="กรุณาเลือก Package");if(!this.assignmentConfig.startDate)return void(this.error="กรุณาระบุวันที่เริ่มต้น");let e;if(this.assignmentConfig.autoRenewal){const t=new Date(this.assignmentConfig.startDate);e=new Date(t);const s=this.selectedBillingCycle?.duration||30;e.setDate(e.getDate()+s)}else{if(!this.assignmentConfig.customEndDate)return void(this.error="กรุณาระบุวันที่สิ้นสุดหรือเปิดใช้งานต่ออายุอัตโนมัติ");e=new Date(this.assignmentConfig.customEndDate)}const t={collectionId:this.collection._id,packageId:this.selectedPackage._id,billingCycle:this.assignmentConfig.billingCycle,startDate:this.assignmentConfig.startDate,endDate:e.toISOString().split("T")[0],autoRenewal:this.assignmentConfig.autoRenewal,trialDays:this.assignmentConfig.trialDays,proration:this.assignmentConfig.proration,amount:this.totalAmount,status:this.assignmentConfig.trialDays>0?"trial":"active",createdAt:new Date},s=await fetch("https://gateway.cloudrestfulapi.com/api/package-assignment",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({data:t})});if(s.ok)await this.updateCollectionPackage(),this.success=!0,setTimeout((()=>{this.$emit("assigned",{package:this.selectedPackage,assignment:t}),this.closeModal()}),1500);else{const e=await s.json();this.error=e.message||"เกิดข้อผิดพลาดในการกำหนด Package"}}catch(e){console.error("Error assigning package:",e),this.error="เกิดข้อผิดพลาดในการเชื่อมต่อกับเซิร์ฟเวอร์"}finally{this.loading=!1}},async updateCollectionPackage(){try{await fetch(`https://gateway.cloudrestfulapi.com/api/hostname/${this.collection._id}`,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({data:{packageId:this.selectedPackage._id,packageAssignedAt:new Date}})})}catch(e){console.error("Error updating collection package:",e)}},closeModal(){this.selectedPackage=null,this.error=null,this.success=!1,this.assignmentConfig={billingCycle:"monthly",startDate:this.today,autoRenewal:!0,customEndDate:null,trialDays:0,proration:!1},this.$emit("close")}},async mounted(){this.isOpen&&await this.loadPackages()}};const ds=(0,ls.A)(cs,[["render",It],["__scopeId","data-v-13601f52"]]);var gs=ds;const us={class:"package-billing-history"},ms={class:"flex items-center justify-between mb-6"},ps={class:"flex space-x-3"},ys={key:0,class:"mb-6 p-4 bg-gray-50 rounded-lg border"},ks={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},bs=["value"],hs={key:0,class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4"},fs={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},xs={class:"bg-white overflow-hidden shadow rounded-lg"},vs={class:"p-5"},Ls={class:"flex items-center"},ws={class:"flex-shrink-0"},Cs={class:"ml-5 w-0 flex-1"},Ds={class:"text-lg font-medium text-gray-900"},Ps={class:"bg-white overflow-hidden shadow rounded-lg"},_s={class:"p-5"},Ss={class:"flex items-center"},Es={class:"flex-shrink-0"},Fs={class:"ml-5 w-0 flex-1"},Ms={class:"text-lg font-medium text-gray-900"},Is={class:"bg-white overflow-hidden shadow rounded-lg"},Xs={class:"p-5"},Bs={class:"flex items-center"},Ts={class:"flex-shrink-0"},As={class:"ml-5 w-0 flex-1"},js={class:"text-lg font-medium text-gray-900"},Vs={class:"bg-white overflow-hidden shadow rounded-lg"},Us={class:"p-5"},Qs={class:"flex items-center"},Rs={class:"flex-shrink-0"},Hs={class:"ml-5 w-0 flex-1"},Os={class:"text-lg font-medium text-gray-900"},$s={class:"bg-white shadow overflow-hidden sm:rounded-md"},Gs={class:"px-4 py-5 sm:p-6"},qs={key:0,class:"text-center py-8"},Ns={key:1,class:"text-center py-8"},Ws={key:2,class:"space-y-4"},Ys={class:"flex items-center justify-between mb-3"},Js={class:"flex items-center"},Ks={class:"flex-shrink-0"},zs={class:"ml-3"},Zs={class:"text-sm font-medium text-gray-900"},ea={class:"text-sm text-gray-600"},ta={class:"flex items-center space-x-4"},sa={class:"text-right"},aa={class:"text-lg font-semibold text-gray-900"},ia={class:"text-sm text-gray-600"},na={class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600"},la={key:0},oa={class:"mt-4 flex justify-end space-x-2"},ra=["onClick"],ca=["onClick"],da=["onClick"],ga={key:3,class:"mt-6 flex items-center justify-between"},ua={class:"text-sm text-gray-700"},ma={class:"flex space-x-2"},pa=["disabled"],ya={class:"px-3 py-1 text-sm"},ka=["disabled"],ba={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},ha={class:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white"};function fa(e,t,s,i,n,o){const r=(0,a.g2)("font-awesome-icon"),c=(0,a.g2)("InvoiceDetail");return(0,a.uX)(),(0,a.CE)("div",us,[(0,a.Lk)("div",ms,[t[19]||(t[19]=(0,a.Lk)("div",null,[(0,a.Lk)("h3",{class:"text-lg font-medium text-gray-900"},"ประวัติการเรียกเก็บเงิน"),(0,a.Lk)("p",{class:"text-sm text-gray-600"},"ตรวจสอบประวัติการชำระเงินและใบแจ้งหนี้ทั้งหมด")],-1)),(0,a.Lk)("div",ps,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>o.exportBillingHistory&&o.exportBillingHistory(...e)),class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[(0,a.bF)(r,{icon:["fas","download"],class:"mr-2"}),t[17]||(t[17]=(0,a.eW)(" ส่งออก "))]),(0,a.Lk)("button",{onClick:t[1]||(t[1]=e=>n.showFilters=!n.showFilters),class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[(0,a.bF)(r,{icon:["fas","filter"],class:"mr-2"}),t[18]||(t[18]=(0,a.eW)(" กรอง "))])])]),n.showFilters?((0,a.uX)(),(0,a.CE)("div",ys,[(0,a.Lk)("div",ks,[(0,a.Lk)("div",null,[t[21]||(t[21]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ช่วงวันที่",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.filters.dateRange=e),onChange:t[3]||(t[3]=(...e)=>o.applyFilters&&o.applyFilters(...e)),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},t[20]||(t[20]=[(0,a.Fv)('<option value="all" data-v-6b7d6bc9>ทั้งหมด</option><option value="last_7_days" data-v-6b7d6bc9>7 วันที่ผ่านมา</option><option value="last_30_days" data-v-6b7d6bc9>30 วันที่ผ่านมา</option><option value="last_3_months" data-v-6b7d6bc9>3 เดือนที่ผ่านมา</option><option value="last_year" data-v-6b7d6bc9>1 ปีที่ผ่านมา</option><option value="custom" data-v-6b7d6bc9>กำหนดเอง</option>',6)]),544),[[Se.u1,n.filters.dateRange]])]),(0,a.Lk)("div",null,[t[23]||(t[23]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"สถานะ",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.filters.status=e),onChange:t[5]||(t[5]=(...e)=>o.applyFilters&&o.applyFilters(...e)),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},t[22]||(t[22]=[(0,a.Fv)('<option value="all" data-v-6b7d6bc9>ทุกสถานะ</option><option value="paid" data-v-6b7d6bc9>ชำระแล้ว</option><option value="pending" data-v-6b7d6bc9>รอชำระ</option><option value="overdue" data-v-6b7d6bc9>เกินกำหนด</option><option value="failed" data-v-6b7d6bc9>ไม่สำเร็จ</option><option value="refunded" data-v-6b7d6bc9>คืนเงิน</option>',6)]),544),[[Se.u1,n.filters.status]])]),(0,a.Lk)("div",null,[t[25]||(t[25]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Package",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>n.filters.packageId=e),onChange:t[7]||(t[7]=(...e)=>o.applyFilters&&o.applyFilters(...e)),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[t[24]||(t[24]=(0,a.Lk)("option",{value:"all"},"ทุก Package",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.uniquePackages,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e._id,value:e._id},(0,l.v_)(e.name),9,bs)))),128))],544),[[Se.u1,n.filters.packageId]])]),(0,a.Lk)("div",null,[t[27]||(t[27]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ช่วงราคา",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>n.filters.amountRange=e),onChange:t[9]||(t[9]=(...e)=>o.applyFilters&&o.applyFilters(...e)),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},t[26]||(t[26]=[(0,a.Fv)('<option value="all" data-v-6b7d6bc9>ทุกราคา</option><option value="0-1000" data-v-6b7d6bc9>0 - 1,000 บาท</option><option value="1000-5000" data-v-6b7d6bc9>1,000 - 5,000 บาท</option><option value="5000-10000" data-v-6b7d6bc9>5,000 - 10,000 บาท</option><option value="10000+" data-v-6b7d6bc9>มากกว่า 10,000 บาท</option>',5)]),544),[[Se.u1,n.filters.amountRange]])])]),"custom"===n.filters.dateRange?((0,a.uX)(),(0,a.CE)("div",hs,[(0,a.Lk)("div",null,[t[28]||(t[28]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"วันที่เริ่มต้น",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>n.filters.customStartDate=e),type:"date",onChange:t[11]||(t[11]=(...e)=>o.applyFilters&&o.applyFilters(...e)),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,544),[[Se.Jo,n.filters.customStartDate]])]),(0,a.Lk)("div",null,[t[29]||(t[29]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"วันที่สิ้นสุด",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>n.filters.customEndDate=e),type:"date",onChange:t[13]||(t[13]=(...e)=>o.applyFilters&&o.applyFilters(...e)),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,544),[[Se.Jo,n.filters.customEndDate]])])])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),(0,a.Lk)("div",fs,[(0,a.Lk)("div",xs,[(0,a.Lk)("div",vs,[(0,a.Lk)("div",Ls,[(0,a.Lk)("div",ws,[(0,a.bF)(r,{icon:["fas","chart-line"],class:"h-6 w-6 text-green-400"})]),(0,a.Lk)("div",Cs,[(0,a.Lk)("dl",null,[t[30]||(t[30]=(0,a.Lk)("dt",{class:"text-sm font-medium text-gray-500 truncate"},"รายได้รวม",-1)),(0,a.Lk)("dd",Ds,"฿"+(0,l.v_)(n.summary.totalRevenue.toLocaleString()),1)])])])])]),(0,a.Lk)("div",Ps,[(0,a.Lk)("div",_s,[(0,a.Lk)("div",Ss,[(0,a.Lk)("div",Es,[(0,a.bF)(r,{icon:["fas","file-invoice"],class:"h-6 w-6 text-blue-400"})]),(0,a.Lk)("div",Fs,[(0,a.Lk)("dl",null,[t[31]||(t[31]=(0,a.Lk)("dt",{class:"text-sm font-medium text-gray-500 truncate"},"จำนวนใบแจ้งหนี้",-1)),(0,a.Lk)("dd",Ms,(0,l.v_)(n.summary.totalInvoices),1)])])])])]),(0,a.Lk)("div",Is,[(0,a.Lk)("div",Xs,[(0,a.Lk)("div",Bs,[(0,a.Lk)("div",Ts,[(0,a.bF)(r,{icon:["fas","clock"],class:"h-6 w-6 text-yellow-400"})]),(0,a.Lk)("div",As,[(0,a.Lk)("dl",null,[t[32]||(t[32]=(0,a.Lk)("dt",{class:"text-sm font-medium text-gray-500 truncate"},"รอชำระ",-1)),(0,a.Lk)("dd",js,"฿"+(0,l.v_)(n.summary.pendingAmount.toLocaleString()),1)])])])])]),(0,a.Lk)("div",Vs,[(0,a.Lk)("div",Us,[(0,a.Lk)("div",Qs,[(0,a.Lk)("div",Rs,[(0,a.bF)(r,{icon:["fas","calendar-alt"],class:"h-6 w-6 text-indigo-400"})]),(0,a.Lk)("div",Hs,[(0,a.Lk)("dl",null,[t[33]||(t[33]=(0,a.Lk)("dt",{class:"text-sm font-medium text-gray-500 truncate"},"ค่าเฉลี่ย/เดือน",-1)),(0,a.Lk)("dd",Os,"฿"+(0,l.v_)(n.summary.averageMonthly.toLocaleString()),1)])])])])])]),(0,a.Lk)("div",$s,[(0,a.Lk)("div",Gs,[n.loading?((0,a.uX)(),(0,a.CE)("div",qs,t[34]||(t[34]=[(0,a.Lk)("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1),(0,a.Lk)("p",{class:"mt-2 text-sm text-gray-600"},"กำลังโหลดข้อมูล...",-1)]))):0===o.filteredBillingHistory.length?((0,a.uX)(),(0,a.CE)("div",Ns,[(0,a.bF)(r,{icon:["fas","receipt"],class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t[35]||(t[35]=(0,a.Lk)("p",{class:"text-gray-600 mb-4"},"ยังไม่มีประวัติการเรียกเก็บเงิน",-1))])):((0,a.uX)(),(0,a.CE)("div",Ws,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.paginatedBillingHistory,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e._id,class:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors"},[(0,a.Lk)("div",Ys,[(0,a.Lk)("div",Js,[(0,a.Lk)("div",Ks,[(0,a.bF)(r,{icon:o.getStatusIcon(e.status),class:(0,l.C4)(o.getStatusIconClass(e.status))},null,8,["icon","class"])]),(0,a.Lk)("div",zs,[(0,a.Lk)("p",Zs," Invoice #"+(0,l.v_)(e.invoiceNumber||e._id.slice(-8)),1),(0,a.Lk)("p",ea,(0,l.v_)(e.packageName),1)])]),(0,a.Lk)("div",ta,[(0,a.Lk)("div",sa,[(0,a.Lk)("p",aa,"฿"+(0,l.v_)(e.amount.toLocaleString()),1),(0,a.Lk)("p",ia,(0,l.v_)(e.billingCycle),1)]),(0,a.Lk)("span",{class:(0,l.C4)(["inline-flex px-2 py-1 rounded-full text-xs font-medium",o.getStatusClass(e.status)])},(0,l.v_)(o.getStatusText(e.status)),3)])]),(0,a.Lk)("div",na,[(0,a.Lk)("div",null,[(0,a.Lk)("p",null,[t[36]||(t[36]=(0,a.Lk)("strong",null,"วันที่:",-1)),(0,a.eW)(" "+(0,l.v_)(o.formatDate(e.billingDate)),1)]),(0,a.Lk)("p",null,[t[37]||(t[37]=(0,a.Lk)("strong",null,"ครบกำหนด:",-1)),(0,a.eW)(" "+(0,l.v_)(o.formatDate(e.dueDate)),1)])]),(0,a.Lk)("div",null,[t[38]||(t[38]=(0,a.Lk)("p",null,[(0,a.Lk)("strong",null,"ช่วงบริการ:")],-1)),(0,a.Lk)("p",null,(0,l.v_)(o.formatDate(e.servicePeriod.start))+" - "+(0,l.v_)(o.formatDate(e.servicePeriod.end)),1)]),(0,a.Lk)("div",null,[(0,a.Lk)("p",null,[t[39]||(t[39]=(0,a.Lk)("strong",null,"วิธีชำระ:",-1)),(0,a.eW)(" "+(0,l.v_)(e.paymentMethod||"ไม่ระบุ"),1)]),e.paidDate?((0,a.uX)(),(0,a.CE)("p",la,[t[40]||(t[40]=(0,a.Lk)("strong",null,"วันที่ชำระ:",-1)),(0,a.eW)(" "+(0,l.v_)(o.formatDate(e.paidDate)),1)])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",oa,[(0,a.Lk)("button",{onClick:t=>o.viewInvoice(e),class:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50"},[(0,a.bF)(r,{icon:["fas","eye"],class:"mr-1"}),t[41]||(t[41]=(0,a.eW)(" ดูใบแจ้งหนี้ "))],8,ra),(0,a.Lk)("button",{onClick:t=>o.downloadInvoice(e),class:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50"},[(0,a.bF)(r,{icon:["fas","download"],class:"mr-1"}),t[42]||(t[42]=(0,a.eW)(" ดาวน์โหลด "))],8,ca),"pending"===e.status?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t=>o.payNow(e),class:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded text-white bg-indigo-600 hover:bg-indigo-700"},[(0,a.bF)(r,{icon:["fas","credit-card"],class:"mr-1"}),t[43]||(t[43]=(0,a.eW)(" ชำระเงิน "))],8,da)):(0,a.Q3)("",!0)])])))),128))])),o.filteredBillingHistory.length>n.itemsPerPage?((0,a.uX)(),(0,a.CE)("div",ga,[(0,a.Lk)("div",ua," แสดง "+(0,l.v_)(o.startIndex+1)+"-"+(0,l.v_)(o.endIndex)+" จาก "+(0,l.v_)(o.filteredBillingHistory.length)+" รายการ ",1),(0,a.Lk)("div",ma,[(0,a.Lk)("button",{onClick:t[14]||(t[14]=(...e)=>o.previousPage&&o.previousPage(...e)),disabled:1===n.currentPage,class:"px-3 py-1 border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed"}," ก่อนหน้า ",8,pa),(0,a.Lk)("span",ya,(0,l.v_)(n.currentPage)+" / "+(0,l.v_)(o.totalPages),1),(0,a.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>o.nextPage&&o.nextPage(...e)),disabled:n.currentPage===o.totalPages,class:"px-3 py-1 border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed"}," ถัดไป ",8,ka)])])):(0,a.Q3)("",!0)])]),n.showInvoiceModal?((0,a.uX)(),(0,a.CE)("div",ba,[(0,a.Lk)("div",ha,[(0,a.bF)(c,{invoice:n.selectedInvoice,onClose:t[16]||(t[16]=e=>n.showInvoiceModal=!1),onPaid:o.handleInvoicePaid},null,8,["invoice","onPaid"])])])):(0,a.Q3)("",!0)])}s(54520),s(3949),s(8872),s(14603),s(47566),s(98721);const xa={class:"invoice-detail max-w-4xl mx-auto"},va={class:"flex items-center justify-between mb-6"},La={class:"text-sm text-gray-600"},wa={class:"flex space-x-3"},Ca={class:"bg-white shadow-lg rounded-lg overflow-hidden"},Da={class:"px-6 py-4 bg-gray-50 border-b border-gray-200"},Pa={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},_a={class:"text-sm text-gray-600"},Sa={class:"font-medium"},Ea={class:"text-sm text-gray-600"},Fa={class:"font-medium"},Ma={key:0},Ia={key:1},Xa={key:2},Ba={class:"px-6 py-4"},Ta={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},Aa={class:"text-sm text-gray-900"},ja={class:"text-sm text-gray-900"},Va={class:"mb-6 p-4 bg-blue-50 rounded-lg"},Ua={class:"text-sm text-blue-700"},Qa={class:"overflow-x-auto"},Ra={class:"min-w-full divide-y divide-gray-200"},Ha={class:"bg-white divide-y divide-gray-200"},Oa={class:"px-6 py-4 whitespace-nowrap"},$a={class:"text-sm font-medium text-gray-900"},Ga={class:"px-6 py-4"},qa={class:"text-sm text-gray-900"},Na={class:"text-sm text-gray-500"},Wa={class:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900"},Ya={class:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900"},Ja={key:0},Ka={class:"px-6 py-2 text-sm text-gray-900"},za={class:"px-6 py-2 text-sm text-gray-500"},Za={class:"px-6 py-2 text-right text-sm text-gray-900"},ei={class:"px-6 py-2 text-right text-sm text-gray-900"},ti={class:"px-6 py-2 text-right text-sm text-gray-900"},si={class:"mt-6 flex justify-end"},ai={class:"w-full max-w-xs"},ii={class:"space-y-2"},ni={class:"flex justify-between"},li={class:"text-sm text-gray-900"},oi={key:0,class:"flex justify-between"},ri={class:"text-sm text-green-600"},ci={key:1,class:"flex justify-between"},di={class:"text-sm text-gray-600"},gi={class:"text-sm text-gray-900"},ui={class:"border-t border-gray-200 pt-2"},mi={class:"flex justify-between"},pi={class:"text-base font-medium text-gray-900"},yi={key:0,class:"mt-6 p-4 bg-green-50 rounded-lg"},ki={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},bi={key:0},hi={key:1},fi={key:1,class:"mt-6 p-4 bg-yellow-50 rounded-lg"},xi={class:"text-sm text-yellow-700"},vi={class:"mb-2"},Li={class:"mb-3"},wi={class:"list-disc list-inside space-y-1 ml-4"},Ci={class:"flex items-center space-x-4"},Di={class:"w-24 h-24 bg-white border border-gray-300 rounded flex items-center justify-center"},Pi={key:2,class:"mt-6 p-4 bg-gray-50 rounded-lg"},_i={class:"text-sm text-gray-700"},Si={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Ei={class:"relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white"};function Fi(e,t,s,i,n,o){const r=(0,a.g2)("font-awesome-icon"),c=(0,a.g2)("PaymentProcessor");return(0,a.uX)(),(0,a.CE)("div",xa,[(0,a.Lk)("div",va,[(0,a.Lk)("div",null,[t[4]||(t[4]=(0,a.Lk)("h2",{class:"text-2xl font-bold text-gray-900"},"ใบแจ้งหนี้",-1)),(0,a.Lk)("p",La,"เลขที่ "+(0,l.v_)(s.invoice.invoiceNumber||s.invoice._id.slice(-8)),1)]),(0,a.Lk)("div",wa,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>o.downloadPDF&&o.downloadPDF(...e)),class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"},[(0,a.bF)(r,{icon:["fas","download"],class:"mr-2"}),t[5]||(t[5]=(0,a.eW)(" ดาวน์โหลด PDF "))]),"pending"===s.invoice.status?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[1]||(t[1]=(...e)=>o.payInvoice&&o.payInvoice(...e)),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700"},[(0,a.bF)(r,{icon:["fas","credit-card"],class:"mr-2"}),t[6]||(t[6]=(0,a.eW)(" ชำระเงิน "))])):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:t[2]||(t[2]=t=>e.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[(0,a.bF)(r,{icon:["fas","times"],class:"w-6 h-6"})])])]),(0,a.Lk)("div",Ca,[(0,a.Lk)("div",Da,[(0,a.Lk)("div",Pa,[(0,a.Lk)("div",null,[t[7]||(t[7]=(0,a.Lk)("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"จาก",-1)),(0,a.Lk)("div",_a,[(0,a.Lk)("p",Sa,(0,l.v_)(n.companyInfo.name),1),(0,a.Lk)("p",null,(0,l.v_)(n.companyInfo.address),1),(0,a.Lk)("p",null,(0,l.v_)(n.companyInfo.city)+", "+(0,l.v_)(n.companyInfo.postalCode),1),(0,a.Lk)("p",null,"เลขประจำตัวผู้เสียภาษี: "+(0,l.v_)(n.companyInfo.taxId),1)])]),(0,a.Lk)("div",null,[t[8]||(t[8]=(0,a.Lk)("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"ถึง",-1)),(0,a.Lk)("div",Ea,[(0,a.Lk)("p",Fa,(0,l.v_)(s.invoice.customerName||s.collection.siteName),1),s.invoice.customerEmail?((0,a.uX)(),(0,a.CE)("p",Ma,(0,l.v_)(s.invoice.customerEmail),1)):(0,a.Q3)("",!0),s.invoice.customerAddress?((0,a.uX)(),(0,a.CE)("p",Ia,(0,l.v_)(s.invoice.customerAddress),1)):(0,a.Q3)("",!0),s.invoice.customerPhone?((0,a.uX)(),(0,a.CE)("p",Xa,(0,l.v_)(s.invoice.customerPhone),1)):(0,a.Q3)("",!0)])])])]),(0,a.Lk)("div",Ba,[(0,a.Lk)("div",Ta,[(0,a.Lk)("div",null,[t[9]||(t[9]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-700"},"วันที่ออกใบแจ้งหนี้",-1)),(0,a.Lk)("p",Aa,(0,l.v_)(o.formatDate(s.invoice.billingDate)),1)]),(0,a.Lk)("div",null,[t[10]||(t[10]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-700"},"วันที่ครบกำหนด",-1)),(0,a.Lk)("p",ja,(0,l.v_)(o.formatDate(s.invoice.dueDate)),1)]),(0,a.Lk)("div",null,[t[11]||(t[11]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-700"},"สถานะ",-1)),(0,a.Lk)("span",{class:(0,l.C4)(["inline-flex px-2 py-1 rounded-full text-xs font-medium",o.getStatusClass(s.invoice.status)])},(0,l.v_)(o.getStatusText(s.invoice.status)),3)])]),(0,a.Lk)("div",Va,[t[12]||(t[12]=(0,a.Lk)("h4",{class:"text-sm font-medium text-blue-900 mb-2"},"ช่วงระยะเวลาบริการ",-1)),(0,a.Lk)("p",Ua,(0,l.v_)(o.formatDate(s.invoice.servicePeriod?.start))+" - "+(0,l.v_)(o.formatDate(s.invoice.servicePeriod?.end)),1)]),(0,a.Lk)("div",Qa,[(0,a.Lk)("table",Ra,[t[16]||(t[16]=(0,a.Lk)("thead",{class:"bg-gray-50"},[(0,a.Lk)("tr",null,[(0,a.Lk)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," รายการ "),(0,a.Lk)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," รายละเอียด "),(0,a.Lk)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," จำนวน "),(0,a.Lk)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," ราคาต่อหน่วย "),(0,a.Lk)("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," รวม ")])],-1)),(0,a.Lk)("tbody",Ha,[(0,a.Lk)("tr",null,[(0,a.Lk)("td",Oa,[(0,a.Lk)("div",$a,(0,l.v_)(s.invoice.packageName),1),t[13]||(t[13]=(0,a.Lk)("div",{class:"text-sm text-gray-500"}," Package Subscription ",-1))]),(0,a.Lk)("td",Ga,[(0,a.Lk)("div",qa,(0,l.v_)(s.invoice.billingCycle)+" - "+(0,l.v_)(o.getBillingCycleDescription()),1),(0,a.Lk)("div",Na," ระยะเวลา: "+(0,l.v_)(o.calculateDuration())+" วัน ",1)]),t[14]||(t[14]=(0,a.Lk)("td",{class:"px-6 py-4 whitespace-nowrap text-right text-sm text-gray-900"}," 1 ",-1)),(0,a.Lk)("td",Wa," ฿"+(0,l.v_)(s.invoice.amount.toLocaleString()),1),(0,a.Lk)("td",Ya," ฿"+(0,l.v_)(s.invoice.amount.toLocaleString()),1)]),s.invoice.additionalCharges?.length?((0,a.uX)(),(0,a.CE)("tr",Ja,t[15]||(t[15]=[(0,a.Lk)("td",{colspan:"5",class:"px-6 py-2"},[(0,a.Lk)("div",{class:"text-sm font-medium text-gray-700"},"ค่าบริการเพิ่มเติม")],-1)]))):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.invoice.additionalCharges,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.id},[(0,a.Lk)("td",Ka,(0,l.v_)(e.name),1),(0,a.Lk)("td",za,(0,l.v_)(e.description),1),(0,a.Lk)("td",Za,(0,l.v_)(e.quantity),1),(0,a.Lk)("td",ei,"฿"+(0,l.v_)(e.unitPrice.toLocaleString()),1),(0,a.Lk)("td",ti,"฿"+(0,l.v_)((e.quantity*e.unitPrice).toLocaleString()),1)])))),128))])])]),(0,a.Lk)("div",si,[(0,a.Lk)("div",ai,[(0,a.Lk)("div",ii,[(0,a.Lk)("div",ni,[t[17]||(t[17]=(0,a.Lk)("span",{class:"text-sm text-gray-600"},"ยอดรวม:",-1)),(0,a.Lk)("span",li,"฿"+(0,l.v_)(o.calculateSubtotal().toLocaleString()),1)]),s.invoice.discount?((0,a.uX)(),(0,a.CE)("div",oi,[t[18]||(t[18]=(0,a.Lk)("span",{class:"text-sm text-gray-600"},"ส่วนลด:",-1)),(0,a.Lk)("span",ri,"-฿"+(0,l.v_)(s.invoice.discount.toLocaleString()),1)])):(0,a.Q3)("",!0),s.invoice.tax?((0,a.uX)(),(0,a.CE)("div",ci,[(0,a.Lk)("span",di,"ภาษี ("+(0,l.v_)(s.invoice.taxRate)+"%):",1),(0,a.Lk)("span",gi,"฿"+(0,l.v_)(s.invoice.tax.toLocaleString()),1)])):(0,a.Q3)("",!0),(0,a.Lk)("div",ui,[(0,a.Lk)("div",mi,[t[19]||(t[19]=(0,a.Lk)("span",{class:"text-base font-medium text-gray-900"},"ยอดรวมทั้งสิ้น:",-1)),(0,a.Lk)("span",pi,"฿"+(0,l.v_)(o.getFinalTotal().toLocaleString()),1)])])])])]),"paid"===s.invoice.status?((0,a.uX)(),(0,a.CE)("div",yi,[t[24]||(t[24]=(0,a.Lk)("h4",{class:"text-sm font-medium text-green-900 mb-2"},"ข้อมูลการชำระเงิน",-1)),(0,a.Lk)("div",ki,[(0,a.Lk)("div",null,[(0,a.Lk)("p",null,[t[20]||(t[20]=(0,a.Lk)("strong",null,"วันที่ชำระ:",-1)),(0,a.eW)(" "+(0,l.v_)(o.formatDate(s.invoice.paidDate)),1)]),(0,a.Lk)("p",null,[t[21]||(t[21]=(0,a.Lk)("strong",null,"วิธีชำระ:",-1)),(0,a.eW)(" "+(0,l.v_)(s.invoice.paymentMethod||"ไม่ระบุ"),1)])]),(0,a.Lk)("div",null,[s.invoice.transactionId?((0,a.uX)(),(0,a.CE)("p",bi,[t[22]||(t[22]=(0,a.Lk)("strong",null,"เลขที่ธุรกรรม:",-1)),(0,a.eW)(" "+(0,l.v_)(s.invoice.transactionId),1)])):(0,a.Q3)("",!0),s.invoice.receiptNumber?((0,a.uX)(),(0,a.CE)("p",hi,[t[23]||(t[23]=(0,a.Lk)("strong",null,"เลขที่ใบเสร็จ:",-1)),(0,a.eW)(" "+(0,l.v_)(s.invoice.receiptNumber),1)])):(0,a.Q3)("",!0)])])])):(0,a.Q3)("",!0),"pending"===s.invoice.status?((0,a.uX)(),(0,a.CE)("div",fi,[t[31]||(t[31]=(0,a.Lk)("h4",{class:"text-sm font-medium text-yellow-900 mb-2"},"วิธีการชำระเงิน",-1)),(0,a.Lk)("div",xi,[(0,a.Lk)("p",vi,"กรุณาชำระเงินภายในวันที่ "+(0,l.v_)(o.formatDate(s.invoice.dueDate)),1),(0,a.Lk)("div",Li,[t[28]||(t[28]=(0,a.Lk)("h5",{class:"font-medium mb-1"},"โอนเงินผ่านธนาคาร:",-1)),(0,a.Lk)("ul",wi,[t[25]||(t[25]=(0,a.Lk)("li",null,"ธนาคารกสิกรไทย สาขาสีลม",-1)),t[26]||(t[26]=(0,a.Lk)("li",null,"ชื่อบัญชี: บริษัท เทคโนโลยี จำกัด",-1)),t[27]||(t[27]=(0,a.Lk)("li",null,"เลขที่บัญชี: 123-4-56789-0",-1)),(0,a.Lk)("li",null,"จำนวนเงิน: ฿"+(0,l.v_)(o.getFinalTotal().toLocaleString()),1)])]),(0,a.Lk)("div",Ci,[(0,a.Lk)("div",null,[t[29]||(t[29]=(0,a.Lk)("h5",{class:"font-medium mb-1"},"สแกน QR Code:",-1)),(0,a.Lk)("div",Di,[(0,a.bF)(r,{icon:["fas","qrcode"],class:"text-gray-400 text-2xl"})])]),t[30]||(t[30]=(0,a.Lk)("div",{class:"text-xs"},[(0,a.Lk)("p",null,"สแกนเพื่อชำระเงินผ่าน"),(0,a.Lk)("p",null,"Mobile Banking")],-1))])])])):(0,a.Q3)("",!0),s.invoice.notes?((0,a.uX)(),(0,a.CE)("div",Pi,[t[32]||(t[32]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"หมายเหตุ",-1)),(0,a.Lk)("p",_i,(0,l.v_)(s.invoice.notes),1)])):(0,a.Q3)("",!0),t[33]||(t[33]=(0,a.Lk)("div",{class:"mt-6 p-4 border-t border-gray-200"},[(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"ข้อกำหนดและเงื่อนไข"),(0,a.Lk)("ul",{class:"text-xs text-gray-600 space-y-1"},[(0,a.Lk)("li",null,"• การชำระเงินต้องดำเนินการภายในวันที่ครบกำหนด"),(0,a.Lk)("li",null,"• หากชำระเงินล่าช้าอาจมีค่าปรับ 1.5% ต่อเดือน"),(0,a.Lk)("li",null,"• ในกรณีที่ไม่ชำระเงินภายในกำหนด บริการอาจถูกระงับ"),(0,a.Lk)("li",null,"• หากมีข้อสงสัยกรุณาติดต่อทีมสนับสนุน")])],-1))])]),n.showPaymentModal?((0,a.uX)(),(0,a.CE)("div",Si,[(0,a.Lk)("div",Ei,[(0,a.bF)(c,{invoice:s.invoice,amount:o.getFinalTotal(),onClose:t[3]||(t[3]=e=>n.showPaymentModal=!1),onSuccess:o.handlePaymentSuccess,onError:o.handlePaymentError},null,8,["invoice","amount","onSuccess","onError"])])])):(0,a.Q3)("",!0)])}const Mi={class:"payment-processor"},Ii={class:"flex items-center justify-between pb-4 border-b"},Xi={class:"mt-4 p-4 bg-gray-50 rounded-lg"},Bi={class:"space-y-1 text-sm"},Ti={class:"flex justify-between"},Ai={class:"font-medium"},ji={class:"flex justify-between"},Vi={class:"font-medium"},Ui={class:"flex justify-between border-t pt-1"},Qi={class:"text-lg font-semibold text-indigo-600"},Ri={class:"mt-6"},Hi={class:"space-y-3"},Oi={class:"flex items-center"},$i=["checked"],Gi={class:"flex-1"},qi={class:"flex items-center"},Ni={class:"flex items-center"},Wi=["checked"],Yi={class:"flex-1"},Ji={class:"flex items-center"},Ki={class:"flex items-center"},zi=["checked"],Zi={class:"flex-1"},en={class:"flex items-center"},tn={class:"flex items-center"},sn=["checked"],an={class:"flex-1"},nn={class:"flex items-center"},ln={key:0,class:"mt-6"},on={key:0,class:"space-y-4"},rn={class:"grid grid-cols-2 gap-4"},cn={key:1,class:"p-4 bg-blue-50 rounded-lg"},dn={class:"text-sm text-blue-700 space-y-1"},gn={class:"mt-4"},un={key:2,class:"text-center p-6"},mn={class:"inline-block p-4 bg-white border border-gray-300 rounded-lg"},pn={class:"w-48 h-48 bg-gray-100 border border-gray-200 rounded flex items-center justify-center mx-auto mb-4"},yn={class:"text-lg font-semibold text-gray-900"},kn={class:"mt-6 p-3 bg-gray-50 rounded-lg flex items-start"},bn={class:"mt-6 flex justify-end space-x-3"},hn=["disabled"],fn={key:0},xn={key:1},vn={key:1,class:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center rounded-lg"};function Ln(e,t,s,i,n,o){const r=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)("div",Mi,[(0,a.Lk)("div",Ii,[t[14]||(t[14]=(0,a.Lk)("h3",{class:"text-lg font-medium text-gray-900"},"ชำระเงิน",-1)),(0,a.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[(0,a.bF)(r,{icon:["fas","times"],class:"w-6 h-6"})])]),(0,a.Lk)("div",Xi,[t[18]||(t[18]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"สรุปการชำระเงิน",-1)),(0,a.Lk)("div",Bi,[(0,a.Lk)("div",Ti,[t[15]||(t[15]=(0,a.Lk)("span",{class:"text-gray-600"},"ใบแจ้งหนี้:",-1)),(0,a.Lk)("span",Ai,"#"+(0,l.v_)(s.invoice.invoiceNumber||s.invoice._id.slice(-8)),1)]),(0,a.Lk)("div",ji,[t[16]||(t[16]=(0,a.Lk)("span",{class:"text-gray-600"},"Package:",-1)),(0,a.Lk)("span",Vi,(0,l.v_)(s.invoice.packageName),1)]),(0,a.Lk)("div",Ui,[t[17]||(t[17]=(0,a.Lk)("span",{class:"text-gray-900 font-medium"},"ยอดรวม:",-1)),(0,a.Lk)("span",Qi,"฿"+(0,l.v_)(s.amount.toLocaleString()),1)])])]),(0,a.Lk)("div",Ri,[t[27]||(t[27]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-4"},"เลือกวิธีการชำระเงิน",-1)),(0,a.Lk)("div",Hi,[(0,a.Lk)("div",{onClick:t[1]||(t[1]=e=>n.selectedMethod="credit_card"),class:(0,l.C4)(["p-4 border-2 rounded-lg cursor-pointer transition-all","credit_card"===n.selectedMethod?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"])},[(0,a.Lk)("div",Oi,[(0,a.Lk)("input",{type:"radio",checked:"credit_card"===n.selectedMethod,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300 mr-3"},null,8,$i),(0,a.Lk)("div",Gi,[(0,a.Lk)("div",qi,[(0,a.bF)(r,{icon:["fas","credit-card"],class:"text-indigo-600 mr-2"}),t[19]||(t[19]=(0,a.Lk)("span",{class:"font-medium text-gray-900"},"บัตรเครดิต/เดบิต",-1))]),t[20]||(t[20]=(0,a.Lk)("p",{class:"text-sm text-gray-600 mt-1"},"Visa, MasterCard, JCB",-1))])])],2),(0,a.Lk)("div",{onClick:t[2]||(t[2]=e=>n.selectedMethod="bank_transfer"),class:(0,l.C4)(["p-4 border-2 rounded-lg cursor-pointer transition-all","bank_transfer"===n.selectedMethod?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"])},[(0,a.Lk)("div",Ni,[(0,a.Lk)("input",{type:"radio",checked:"bank_transfer"===n.selectedMethod,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300 mr-3"},null,8,Wi),(0,a.Lk)("div",Yi,[(0,a.Lk)("div",Ji,[(0,a.bF)(r,{icon:["fas","university"],class:"text-indigo-600 mr-2"}),t[21]||(t[21]=(0,a.Lk)("span",{class:"font-medium text-gray-900"},"โอนเงินผ่านธนาคาร",-1))]),t[22]||(t[22]=(0,a.Lk)("p",{class:"text-sm text-gray-600 mt-1"},"โอนผ่าน Internet Banking หรือ Mobile Banking",-1))])])],2),(0,a.Lk)("div",{onClick:t[3]||(t[3]=e=>n.selectedMethod="qr_payment"),class:(0,l.C4)(["p-4 border-2 rounded-lg cursor-pointer transition-all","qr_payment"===n.selectedMethod?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"])},[(0,a.Lk)("div",Ki,[(0,a.Lk)("input",{type:"radio",checked:"qr_payment"===n.selectedMethod,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300 mr-3"},null,8,zi),(0,a.Lk)("div",Zi,[(0,a.Lk)("div",en,[(0,a.bF)(r,{icon:["fas","qrcode"],class:"text-indigo-600 mr-2"}),t[23]||(t[23]=(0,a.Lk)("span",{class:"font-medium text-gray-900"},"QR Code Payment",-1))]),t[24]||(t[24]=(0,a.Lk)("p",{class:"text-sm text-gray-600 mt-1"},"สแกน QR Code ผ่าน Mobile Banking",-1))])])],2),(0,a.Lk)("div",{onClick:t[4]||(t[4]=e=>n.selectedMethod="promptpay"),class:(0,l.C4)(["p-4 border-2 rounded-lg cursor-pointer transition-all","promptpay"===n.selectedMethod?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"])},[(0,a.Lk)("div",tn,[(0,a.Lk)("input",{type:"radio",checked:"promptpay"===n.selectedMethod,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300 mr-3"},null,8,sn),(0,a.Lk)("div",an,[(0,a.Lk)("div",nn,[(0,a.bF)(r,{icon:["fas","mobile-alt"],class:"text-indigo-600 mr-2"}),t[25]||(t[25]=(0,a.Lk)("span",{class:"font-medium text-gray-900"},"PromptPay",-1))]),t[26]||(t[26]=(0,a.Lk)("p",{class:"text-sm text-gray-600 mt-1"},"ชำระผ่าน PromptPay QR Code",-1))])])],2)])]),n.selectedMethod?((0,a.uX)(),(0,a.CE)("div",ln,["credit_card"===n.selectedMethod?((0,a.uX)(),(0,a.CE)("div",on,[(0,a.Lk)("div",null,[t[28]||(t[28]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"หมายเลขบัตร",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>n.cardData.number=e),type:"text",placeholder:"1234 5678 9012 3456",maxlength:"19",onInput:t[6]||(t[6]=(...e)=>o.formatCardNumber&&o.formatCardNumber(...e)),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,544),[[Se.Jo,n.cardData.number]])]),(0,a.Lk)("div",rn,[(0,a.Lk)("div",null,[t[29]||(t[29]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"วันหมดอายุ",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>n.cardData.expiry=e),type:"text",placeholder:"MM/YY",maxlength:"5",onInput:t[8]||(t[8]=(...e)=>o.formatExpiry&&o.formatExpiry(...e)),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,544),[[Se.Jo,n.cardData.expiry]])]),(0,a.Lk)("div",null,[t[30]||(t[30]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"CVV",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>n.cardData.cvv=e),type:"text",placeholder:"123",maxlength:"4",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[Se.Jo,n.cardData.cvv]])])]),(0,a.Lk)("div",null,[t[31]||(t[31]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ชื่อผู้ถือบัตร",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>n.cardData.name=e),type:"text",placeholder:"ชื่อตามที่ปรากฏบนบัตร",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[Se.Jo,n.cardData.name]])])])):(0,a.Q3)("",!0),"bank_transfer"===n.selectedMethod?((0,a.uX)(),(0,a.CE)("div",cn,[t[38]||(t[38]=(0,a.Lk)("h5",{class:"font-medium text-blue-900 mb-2"},"ข้อมูลการโอนเงิน",-1)),(0,a.Lk)("div",dn,[t[33]||(t[33]=(0,a.Lk)("p",null,[(0,a.Lk)("strong",null,"ธนาคาร:"),(0,a.eW)(" ธนาคารกสิกรไทย สาขาสีลม")],-1)),t[34]||(t[34]=(0,a.Lk)("p",null,[(0,a.Lk)("strong",null,"ชื่อบัญชี:"),(0,a.eW)(" บริษัท เทคโนโลยี จำกัด")],-1)),t[35]||(t[35]=(0,a.Lk)("p",null,[(0,a.Lk)("strong",null,"เลขที่บัญชี:"),(0,a.eW)(" 123-4-56789-0")],-1)),(0,a.Lk)("p",null,[t[32]||(t[32]=(0,a.Lk)("strong",null,"จำนวนเงิน:",-1)),(0,a.eW)(" ฿"+(0,l.v_)(s.amount.toLocaleString()),1)]),t[36]||(t[36]=(0,a.Lk)("p",{class:"mt-2 text-xs text-blue-600"}," หลังจากโอนเงินแล้ว กรุณาอัปโหลดหลักฐานการโอนเงิน ",-1))]),(0,a.Lk)("div",gn,[t[37]||(t[37]=(0,a.Lk)("label",{class:"block text-sm font-medium text-blue-900 mb-2"},"อัปโหลดหลักฐานการโอน",-1)),(0,a.Lk)("input",{type:"file",onChange:t[11]||(t[11]=(...e)=>o.handleReceiptUpload&&o.handleReceiptUpload(...e)),accept:"image/*,application/pdf",class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32)])])):(0,a.Q3)("",!0),"qr_payment"===n.selectedMethod||"promptpay"===n.selectedMethod?((0,a.uX)(),(0,a.CE)("div",un,[(0,a.Lk)("div",mn,[(0,a.Lk)("div",pn,[(0,a.bF)(r,{icon:["fas","qrcode"],class:"text-gray-400 text-6xl"})]),t[39]||(t[39]=(0,a.Lk)("p",{class:"text-sm text-gray-600 mb-2"},"สแกน QR Code นี้เพื่อชำระเงิน",-1)),(0,a.Lk)("p",yn,"฿"+(0,l.v_)(s.amount.toLocaleString()),1)]),t[40]||(t[40]=(0,a.Lk)("div",{class:"mt-4 text-sm text-gray-600"},[(0,a.Lk)("p",null,"1. เปิดแอป Mobile Banking"),(0,a.Lk)("p",null,"2. เลือกเมนู QR Code Payment"),(0,a.Lk)("p",null,"3. สแกน QR Code ด้านบน"),(0,a.Lk)("p",null,"4. ยืนยันการชำระเงิน")],-1))])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),(0,a.Lk)("div",kn,[(0,a.bF)(r,{icon:["fas","shield-alt"],class:"text-green-500 mt-0.5 mr-2"}),t[41]||(t[41]=(0,a.Lk)("div",{class:"text-xs text-gray-600"},[(0,a.Lk)("p",{class:"font-medium text-gray-900 mb-1"},"การชำระเงินของคุณปลอดภัย"),(0,a.Lk)("p",null,"ข้อมูลการชำระเงินทั้งหมดถูกเข้ารหัสด้วย SSL 256-bit และเป็นไปตามมาตรฐาน PCI DSS")],-1))]),(0,a.Lk)("div",bn,[(0,a.Lk)("button",{onClick:t[12]||(t[12]=t=>e.$emit("close")),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"}," ยกเลิก "),(0,a.Lk)("button",{onClick:t[13]||(t[13]=(...e)=>o.processPayment&&o.processPayment(...e)),disabled:!o.isFormValid||n.processing,class:"px-4 py-2 border border-transparent rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-300"},[n.processing?((0,a.uX)(),(0,a.CE)("span",fn,"กำลังดำเนินการ...")):((0,a.uX)(),(0,a.CE)("span",xn,"ยืนยันการชำระเงิน"))],8,hn)]),n.processing?((0,a.uX)(),(0,a.CE)("div",vn,t[42]||(t[42]=[(0,a.Lk)("div",{class:"text-center"},[(0,a.Lk)("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mb-2"}),(0,a.Lk)("p",{class:"text-sm text-gray-600"},"กำลังดำเนินการชำระเงิน...")],-1)]))):(0,a.Q3)("",!0)])}var wn={name:"PaymentProcessor",props:{invoice:{type:Object,required:!0},amount:{type:Number,required:!0}},emits:["close","success","error"],data(){return{selectedMethod:"",processing:!1,cardData:{number:"",expiry:"",cvv:"",name:""},receiptFile:null}},computed:{isFormValid(){if(!this.selectedMethod)return!1;switch(this.selectedMethod){case"credit_card":return this.cardData.number.length>=16&&5===this.cardData.expiry.length&&this.cardData.cvv.length>=3&&this.cardData.name.trim();case"bank_transfer":return null!==this.receiptFile;case"qr_payment":case"promptpay":return!0;default:return!1}}},methods:{formatCardNumber(e){let t=e.target.value.replace(/\s/g,"").replace(/[^0-9]/gi,""),s=t.match(/.{1,4}/g)?.join(" ")||t;this.cardData.number=s},formatExpiry(e){let t=e.target.value.replace(/\D/g,"");t.length>=2&&(t=t.substring(0,2)+"/"+t.substring(2,4)),this.cardData.expiry=t},handleReceiptUpload(e){const t=e.target.files[0];if(t){if(t.size>5242880)return void alert("ไฟล์มีขนาดใหญ่เกินไป กรุณาเลือกไฟล์ที่มีขนาดไม่เกิน 5MB");const e=["image/jpeg","image/png","image/gif","application/pdf"];if(!e.includes(t.type))return void alert("กรุณาเลือกไฟล์ประเภทรูปภาพหรือ PDF เท่านั้น");this.receiptFile=t}},async processPayment(){this.processing=!0;try{let e={invoiceId:this.invoice._id,amount:this.amount,method:this.selectedMethod,timestamp:(new Date).toISOString()};switch(this.selectedMethod){case"credit_card":e={...e,card:{number:this.cardData.number.replace(/\s/g,""),expiry:this.cardData.expiry,cvv:this.cardData.cvv,name:this.cardData.name}},await this.processCreditCardPayment(e);break;case"bank_transfer":if(this.receiptFile){const t=await this.uploadReceipt(this.receiptFile);e.receiptUrl=t}await this.processBankTransfer(e);break;case"qr_payment":case"promptpay":await this.processQRPayment(e);break}}catch(e){console.error("Payment processing error:",e),this.$emit("error",e)}finally{this.processing=!1}},async processCreditCardPayment(e){await this.simulatePaymentDelay();const t=Math.random()>.1;if(!t)throw new Error("การชำระเงินไม่สำเร็จ กรุณาตรวจสอบข้อมูลบัตรและลองใหม่อีกครั้ง");this.$emit("success",{...e,transactionId:this.generateTransactionId(),status:"completed"})},async processBankTransfer(e){await this.simulatePaymentDelay(),this.$emit("success",{...e,transactionId:this.generateTransactionId(),status:"pending_verification",message:"ได้รับหลักฐานการโอนเงินแล้ว รอการตรวจสอบภายใน 24 ชั่วโมง"})},async processQRPayment(e){await this.simulatePaymentDelay();const t=Math.random()>.05;if(!t)throw new Error("ไม่พบการชำระเงิน กรุณาตรวจสอบและลองใหม่อีกครั้ง");this.$emit("success",{...e,transactionId:this.generateTransactionId(),status:"completed"})},async uploadReceipt(e){const t=new FormData;return t.append("receipt",e),t.append("invoiceId",this.invoice._id),`receipt_${Date.now()}_${e.name}`},simulatePaymentDelay(){return new Promise((e=>{setTimeout(e,2e3+3e3*Math.random())}))},generateTransactionId(){return"TXN"+Date.now()+Math.random().toString(36).substr(2,5).toUpperCase()}}};const Cn=(0,ls.A)(wn,[["render",Ln],["__scopeId","data-v-0c9d28e6"]]);var Dn=Cn,Pn={name:"InvoiceDetail",components:{PaymentProcessor:Dn},props:{invoice:{type:Object,required:!0},collection:{type:Object,default:()=>({})}},emits:["close","paid"],data(){return{showPaymentModal:!1,companyInfo:{name:"บริษัท เทคโนโลยี จำกัด",address:"123 ถนนสีลม",city:"กรุงเทพมหานคร",postalCode:"10500",taxId:"0123456789012"}}},methods:{payInvoice(){this.showPaymentModal=!0},async downloadPDF(){try{window.print()}catch(e){console.error("Error generating PDF:",e),alert("ไม่สามารถสร้าง PDF ได้")}},calculateSubtotal(){let e=this.invoice.amount;return this.invoice.additionalCharges?.length&&(e+=this.invoice.additionalCharges.reduce(((e,t)=>e+t.quantity*t.unitPrice),0)),e},getFinalTotal(){let e=this.calculateSubtotal();return this.invoice.discount&&(e-=this.invoice.discount),this.invoice.tax&&(e+=this.invoice.tax),e},calculateDuration(){if(!this.invoice.servicePeriod?.start||!this.invoice.servicePeriod?.end)return 0;const e=new Date(this.invoice.servicePeriod.start),t=new Date(this.invoice.servicePeriod.end),s=Math.abs(t-e);return Math.ceil(s/864e5)},getBillingCycleDescription(){const e={monthly:"รายเดือน",quarterly:"รายไตรมาส",yearly:"รายปี",weekly:"รายสัปดาห์"};return e[this.invoice.billingCycle]||this.invoice.billingCycle},getStatusClass(e){const t={paid:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",overdue:"bg-red-100 text-red-800",failed:"bg-red-100 text-red-800",refunded:"bg-blue-100 text-blue-800"};return t[e]||"bg-gray-100 text-gray-800"},getStatusText(e){const t={paid:"ชำระแล้ว",pending:"รอชำระ",overdue:"เกินกำหนด",failed:"ไม่สำเร็จ",refunded:"คืนเงิน"};return t[e]||e},formatDate(e){return e?new Date(e).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}):""},handlePaymentSuccess(e){this.showPaymentModal=!1,this.$emit("paid",{...this.invoice,status:"paid",paidDate:(new Date).toISOString(),paymentMethod:e.method,transactionId:e.transactionId}),alert("ชำระเงินสำเร็จ!")},handlePaymentError(e){console.error("Payment error:",e),alert("เกิดข้อผิดพลาดในการชำระเงิน กรุณาลองใหม่อีกครั้ง")}}};const _n=(0,ls.A)(Pn,[["render",Fi],["__scopeId","data-v-e9e64544"]]);var Sn=_n,En={name:"PackageBillingHistory",components:{InvoiceDetail:Sn},props:{collection:{type:Object,required:!0},hostkey:{type:String,required:!0}},data(){return{billingHistory:[],uniquePackages:[],loading:!1,showFilters:!1,showInvoiceModal:!1,selectedInvoice:null,currentPage:1,itemsPerPage:10,filters:{dateRange:"all",status:"all",packageId:"all",amountRange:"all",customStartDate:"",customEndDate:""},summary:{totalRevenue:0,totalInvoices:0,pendingAmount:0,averageMonthly:0}}},computed:{filteredBillingHistory(){let e=[...this.billingHistory];if("all"!==this.filters.dateRange){const t=new Date;let s=new Date;switch(this.filters.dateRange){case"last_7_days":s.setDate(t.getDate()-7);break;case"last_30_days":s.setDate(t.getDate()-30);break;case"last_3_months":s.setMonth(t.getMonth()-3);break;case"last_year":s.setFullYear(t.getFullYear()-1);break;case"custom":this.filters.customStartDate&&(s=new Date(this.filters.customStartDate));break}e=e.filter((e=>{const t=new Date(e.billingDate);if("custom"===this.filters.dateRange&&this.filters.customEndDate){const e=new Date(this.filters.customEndDate);return t>=s&&t<=e}return t>=s}))}if("all"!==this.filters.status&&(e=e.filter((e=>e.status===this.filters.status))),"all"!==this.filters.packageId&&(e=e.filter((e=>e.packageId===this.filters.packageId))),"all"!==this.filters.amountRange){const[t,s]=this.filters.amountRange.includes("+")?[parseInt(this.filters.amountRange.replace("+","")),1/0]:this.filters.amountRange.split("-").map(Number);e=e.filter((e=>e.amount>=t&&e.amount<=s))}return e.sort(((e,t)=>new Date(t.billingDate)-new Date(e.billingDate)))},paginatedBillingHistory(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.filteredBillingHistory.slice(e,t)},totalPages(){return Math.ceil(this.filteredBillingHistory.length/this.itemsPerPage)},startIndex(){return(this.currentPage-1)*this.itemsPerPage},endIndex(){return Math.min(this.startIndex+this.itemsPerPage,this.filteredBillingHistory.length)}},methods:{async loadBillingHistory(){try{this.loading=!0;const e=await fetch("https://gateway.cloudrestfulapi.com/api/billing-history/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{collectionId:this.collection._id}]})});e.ok&&(this.billingHistory=await e.json(),this.calculateSummary(),this.extractUniquePackages())}catch(e){console.error("Error loading billing history:",e)}finally{this.loading=!1}},calculateSummary(){const e=this.billingHistory.filter((e=>"paid"===e.status)),t=this.billingHistory.filter((e=>"pending"===e.status));this.summary={totalRevenue:e.reduce(((e,t)=>e+t.amount),0),totalInvoices:this.billingHistory.length,pendingAmount:t.reduce(((e,t)=>e+t.amount),0),averageMonthly:e.length>0?e.reduce(((e,t)=>e+t.amount),0)/e.length:0}},extractUniquePackages(){const e=new Map;this.billingHistory.forEach((t=>{e.has(t.packageId)||e.set(t.packageId,{_id:t.packageId,name:t.packageName})})),this.uniquePackages=Array.from(e.values())},applyFilters(){this.currentPage=1},previousPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},viewInvoice(e){this.selectedInvoice=e,this.showInvoiceModal=!0},async downloadInvoice(e){try{const t=await fetch(`https://gateway.cloudrestfulapi.com/api/billing-history/${e._id}/download`,{headers:{"client-token-key":this.hostkey}});if(t.ok){const s=await t.blob(),a=window.URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download=`invoice-${e._id}.pdf`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(a),document.body.removeChild(i)}}catch(t){console.error("Error downloading invoice:",t),alert("ไม่สามารถดาวน์โหลดใบแจ้งหนี้ได้")}},async payNow(e){try{const t=`https://payment.gateway.com/pay?invoice=${e._id}&amount=${e.amount}`;window.open(t,"_blank")}catch(t){console.error("Error initiating payment:",t),alert("ไม่สามารถเปิดหน้าชำระเงินได้")}},async exportBillingHistory(){try{const e=this.generateCSV(),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`billing-history-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a)}catch(e){console.error("Error exporting billing history:",e),alert("ไม่สามารถส่งออกข้อมูลได้")}},generateCSV(){const e=["วันที่","เลขที่ใบแจ้งหนี้","Package","จำนวนเงิน","สถานะ","วิธีชำระ"],t=this.filteredBillingHistory.map((e=>[this.formatDate(e.billingDate),e.invoiceNumber||e._id.slice(-8),e.packageName,e.amount,this.getStatusText(e.status),e.paymentMethod||"ไม่ระบุ"]));return[e,...t].map((e=>e.join(","))).join("\n")},handleInvoicePaid(e){const t=this.billingHistory.findIndex((t=>t._id===e._id));t>-1&&(this.billingHistory[t].status="paid",this.billingHistory[t].paidDate=(new Date).toISOString(),this.calculateSummary()),this.showInvoiceModal=!1},getStatusIcon(e){const t={paid:["fas","check-circle"],pending:["fas","clock"],overdue:["fas","exclamation-triangle"],failed:["fas","times-circle"],refunded:["fas","undo"]};return t[e]||["fas","question-circle"]},getStatusIconClass(e){const t={paid:"h-5 w-5 text-green-500",pending:"h-5 w-5 text-yellow-500",overdue:"h-5 w-5 text-red-500",failed:"h-5 w-5 text-red-500",refunded:"h-5 w-5 text-blue-500"};return t[e]||"h-5 w-5 text-gray-500"},getStatusClass(e){const t={paid:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",overdue:"bg-red-100 text-red-800",failed:"bg-red-100 text-red-800",refunded:"bg-blue-100 text-blue-800"};return t[e]||"bg-gray-100 text-gray-800"},getStatusText(e){const t={paid:"ชำระแล้ว",pending:"รอชำระ",overdue:"เกินกำหนด",failed:"ไม่สำเร็จ",refunded:"คืนเงิน"};return t[e]||e},formatDate(e){return e?new Date(e).toLocaleDateString("th-TH"):""}},async mounted(){await this.loadBillingHistory()}};const Fn=(0,ls.A)(En,[["render",fa],["__scopeId","data-v-6b7d6bc9"]]);var Mn=Fn;const In={class:"advanced-package-config bg-white shadow rounded-lg p-6"},Xn={class:"flex items-center justify-between mb-6"},Bn={class:"mb-6"},Tn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},An=["onClick"],jn={class:"flex items-center justify-between mb-3"},Vn={class:"text-lg font-semibold text-gray-900"},Un={class:"flex items-center"},Qn=["checked"],Rn={class:"text-sm text-gray-600 mb-3"},Hn={class:"text-sm text-indigo-600 font-medium"},On={key:0,class:"space-y-6"},$n={class:"p-4 border rounded-lg bg-gray-50"},Gn={class:"space-y-3"},qn=["onClick"],Nn={class:"flex items-center justify-between"},Wn={class:"flex items-center"},Yn=["checked"],Jn={class:"font-medium text-gray-900"},Kn={class:"text-sm text-gray-600"},zn={key:0,class:"text-sm text-green-600"},Zn={class:"text-right"},el={class:"text-lg font-semibold text-indigo-600"},tl={class:"text-sm text-gray-500"},sl={class:"p-4 border rounded-lg bg-gray-50"},al={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},il={class:"space-y-4"},nl={key:0},ll={key:1},ol={class:"space-y-4"},rl={key:0},cl={key:1},dl={class:"p-4 border rounded-lg bg-gray-50"},gl={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ul={class:"space-y-4"},ml={class:"inline-flex items-center"},pl={key:0,class:"space-y-3"},yl={key:0},kl={class:"inline-flex items-center"},bl={class:"space-y-4"},hl={class:"inline-flex items-center"},fl={class:"inline-flex items-center"},xl={key:0},vl={class:"space-y-2"},Ll=["value"],wl={class:"ml-2 text-sm text-gray-700"},Cl={class:"p-4 bg-indigo-50 rounded-lg border border-indigo-200"},Dl={class:"space-y-2 text-sm"},Pl={class:"flex justify-between"},_l={class:"text-indigo-700"},Sl={class:"font-medium text-indigo-900"},El={key:0,class:"flex justify-between"},Fl={class:"font-medium text-green-600"},Ml={key:1,class:"flex justify-between"},Il={class:"font-medium text-indigo-900"},Xl={class:"border-t border-indigo-200 pt-2 flex justify-between font-semibold"},Bl={class:"text-indigo-900"},Tl={class:"text-xs text-indigo-600"},Al={class:"flex justify-end space-x-3"},jl=["disabled"];function Vl(e,t,s,i,n,o){const r=(0,a.g2)("font-awesome-icon"),c=(0,a.g2)("FlexibleDateTimePicker");return(0,a.uX)(),(0,a.CE)("div",In,[(0,a.Lk)("div",Xn,[t[17]||(t[17]=(0,a.Lk)("h3",{class:"text-lg font-medium text-gray-900"},"การกำหนดค่า Package ขั้นสูง",-1)),(0,a.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[(0,a.bF)(r,{icon:["fas","times"],class:"w-6 h-6"})])]),(0,a.Lk)("div",Bn,[t[18]||(t[18]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"เลือก Package",-1)),(0,a.Lk)("div",Tn,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.availablePackages,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e._id,onClick:t=>o.selectPackage(e),class:(0,l.C4)(["relative p-4 border-2 rounded-lg cursor-pointer transition-all",n.selectedPackage&&n.selectedPackage._id===e._id?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"])},[(0,a.Lk)("div",jn,[(0,a.Lk)("h3",Vn,(0,l.v_)(e.name),1),(0,a.Lk)("div",Un,[(0,a.Lk)("input",{type:"radio",checked:n.selectedPackage&&n.selectedPackage._id===e._id,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300"},null,8,Qn)])]),(0,a.Lk)("p",Rn,(0,l.v_)(e.description),1),(0,a.Lk)("div",Hn," เริ่มต้น ฿"+(0,l.v_)(o.getMinPrice(e).toLocaleString())+"/เดือน ",1)],10,An)))),128))])]),n.selectedPackage?((0,a.uX)(),(0,a.CE)("div",On,[(0,a.Lk)("div",$n,[t[19]||(t[19]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-4"},"แผนการชำระเงิน",-1)),(0,a.Lk)("div",Gn,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.selectedPackage.pricing.billingCycles,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.type,onClick:t=>n.config.billingCycle=e.type,class:(0,l.C4)(["p-3 border rounded-lg cursor-pointer transition-all",n.config.billingCycle===e.type?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"])},[(0,a.Lk)("div",Nn,[(0,a.Lk)("div",Wn,[(0,a.Lk)("input",{type:"radio",checked:n.config.billingCycle===e.type,class:"text-indigo-600 focus:ring-indigo-500 border-gray-300 mr-3"},null,8,Yn),(0,a.Lk)("div",null,[(0,a.Lk)("p",Jn,(0,l.v_)(e.label),1),(0,a.Lk)("p",Kn,(0,l.v_)(e.duration)+" วัน",1),e.discount>0?((0,a.uX)(),(0,a.CE)("p",zn," ประหยัด "+(0,l.v_)(e.discount)+"% ",1)):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",Zn,[(0,a.Lk)("p",el," ฿"+(0,l.v_)(e.price.toLocaleString()),1),(0,a.Lk)("p",tl," ฿"+(0,l.v_)((e.price/(e.duration/30)).toFixed(0))+"/เดือน ",1)])])],10,qn)))),128))])]),(0,a.Lk)("div",sl,[t[26]||(t[26]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-4"},"กำหนดการใช้งาน",-1)),(0,a.Lk)("div",al,[(0,a.Lk)("div",il,[(0,a.Lk)("div",null,[t[21]||(t[21]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," รูปแบบวันเริ่มต้น ",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.config.startDateType=e),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},t[20]||(t[20]=[(0,a.Fv)('<option value="immediate" data-v-310b69bf>เริ่มทันที</option><option value="next_business_day" data-v-310b69bf>วันทำการถัดไป</option><option value="specific_date" data-v-310b69bf>กำหนดวันที่เฉพาะ</option><option value="next_month" data-v-310b69bf>ต้นเดือนหน้า</option><option value="custom_delay" data-v-310b69bf>เลื่อนออกไป (วัน)</option>',5)]),512),[[Se.u1,n.config.startDateType]])]),"specific_date"===n.config.startDateType?((0,a.uX)(),(0,a.CE)("div",nl,[(0,a.bF)(c,{modelValue:n.config.specificStartDate,"onUpdate:modelValue":t[2]||(t[2]=e=>n.config.specificStartDate=e),label:"วันที่เริ่มต้น","min-date":o.today,"business-days-only":!0,"custom-validation":o.validateStartDate,required:""},null,8,["modelValue","min-date","custom-validation"])])):(0,a.Q3)("",!0),"custom_delay"===n.config.startDateType?((0,a.uX)(),(0,a.CE)("div",ll,[t[22]||(t[22]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," จำนวนวันที่เลื่อน ",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>n.config.delayDays=e),type:"number",min:"1",max:"365",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[Se.Jo,n.config.delayDays]])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",ol,[(0,a.Lk)("div",null,[t[24]||(t[24]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," รูปแบบการสิ้นสุด ",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.config.endDateType=e),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},t[23]||(t[23]=[(0,a.Lk)("option",{value:"auto_renewal"},"ต่ออายุอัตโนมัติ",-1),(0,a.Lk)("option",{value:"fixed_duration"},"ระยะเวลาคงที่",-1),(0,a.Lk)("option",{value:"specific_end_date"},"กำหนดวันสิ้นสุด",-1),(0,a.Lk)("option",{value:"usage_based"},"ตามการใช้งาน",-1)]),512),[[Se.u1,n.config.endDateType]])]),"fixed_duration"===n.config.endDateType?((0,a.uX)(),(0,a.CE)("div",rl,[t[25]||(t[25]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," ระยะเวลา (วัน) ",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>n.config.fixedDuration=e),type:"number",min:"7",max:"3650",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[Se.Jo,n.config.fixedDuration]])])):(0,a.Q3)("",!0),"specific_end_date"===n.config.endDateType?((0,a.uX)(),(0,a.CE)("div",cl,[(0,a.bF)(c,{modelValue:n.config.specificEndDate,"onUpdate:modelValue":t[6]||(t[6]=e=>n.config.specificEndDate=e),label:"วันที่สิ้นสุด","min-date":o.calculateMinEndDate(),"custom-validation":o.validateEndDate,required:""},null,8,["modelValue","min-date","custom-validation"])])):(0,a.Q3)("",!0)])])]),(0,a.Lk)("div",dl,[t[36]||(t[36]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-4"},"ตัวเลือกขั้นสูง",-1)),(0,a.Lk)("div",gl,[(0,a.Lk)("div",ul,[(0,a.Lk)("div",null,[(0,a.Lk)("label",ml,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>n.config.enableTrial=e),type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[Se.lH,n.config.enableTrial]]),t[27]||(t[27]=(0,a.Lk)("span",{class:"ml-2 text-sm text-gray-700"},"เปิดใช้งานระยะทดลองใช้",-1))])]),n.config.enableTrial?((0,a.uX)(),(0,a.CE)("div",pl,[(0,a.Lk)("div",null,[t[29]||(t[29]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," ระยะเวลาทดลองใช้ (วัน) ",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>n.config.trialDays=e),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},t[28]||(t[28]=[(0,a.Lk)("option",{value:"7"},"7 วัน",-1),(0,a.Lk)("option",{value:"14"},"14 วัน",-1),(0,a.Lk)("option",{value:"30"},"30 วัน",-1),(0,a.Lk)("option",{value:"custom"},"กำหนดเอง",-1)]),512),[[Se.u1,n.config.trialDays]])]),"custom"===n.config.trialDays?((0,a.uX)(),(0,a.CE)("div",yl,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>n.config.customTrialDays=e),type:"number",min:"1",max:"365",placeholder:"จำนวนวัน",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[Se.Jo,n.config.customTrialDays]])])):(0,a.Q3)("",!0),(0,a.Lk)("div",null,[(0,a.Lk)("label",kl,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>n.config.requireCreditCard=e),type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[Se.lH,n.config.requireCreditCard]]),t[30]||(t[30]=(0,a.Lk)("span",{class:"ml-2 text-sm text-gray-700"},"ต้องใส่ข้อมูลบัตรเครดิต",-1))])])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",bl,[(0,a.Lk)("div",null,[(0,a.Lk)("label",hl,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>n.config.enableProration=e),type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[Se.lH,n.config.enableProration]]),t[31]||(t[31]=(0,a.Lk)("span",{class:"ml-2 text-sm text-gray-700"},"คิดค่าใช้จ่ายตามสัดส่วน",-1))])]),(0,a.Lk)("div",null,[(0,a.Lk)("label",fl,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>n.config.enableGracePeriod=e),type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[Se.lH,n.config.enableGracePeriod]]),t[32]||(t[32]=(0,a.Lk)("span",{class:"ml-2 text-sm text-gray-700"},"ระยะเวลาผ่อนผัน",-1))])]),n.config.enableGracePeriod?((0,a.uX)(),(0,a.CE)("div",xl,[t[34]||(t[34]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," ระยะเวลาผ่อนผัน (วัน) ",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>n.config.gracePeriodDays=e),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},t[33]||(t[33]=[(0,a.Lk)("option",{value:"3"},"3 วัน",-1),(0,a.Lk)("option",{value:"7"},"7 วัน",-1),(0,a.Lk)("option",{value:"15"},"15 วัน",-1),(0,a.Lk)("option",{value:"30"},"30 วัน",-1)]),512),[[Se.u1,n.config.gracePeriodDays]])])):(0,a.Q3)("",!0),(0,a.Lk)("div",null,[t[35]||(t[35]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," การแจ้งเตือนก่อนหมดอายุ ",-1)),(0,a.Lk)("div",vl,[((0,a.uX)(),(0,a.CE)(a.FK,null,(0,a.pI)([7,14,30],(e=>(0,a.Lk)("label",{key:e,class:"inline-flex items-center mr-4"},[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>n.config.reminderDays=e),value:e,type:"checkbox",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,8,Ll),[[Se.lH,n.config.reminderDays]]),(0,a.Lk)("span",wl,(0,l.v_)(e)+" วัน",1)]))),64))])])])])]),(0,a.Lk)("div",Cl,[t[40]||(t[40]=(0,a.Lk)("h4",{class:"text-sm font-medium text-indigo-900 mb-4"},"สรุปค่าใช้จ่าย",-1)),(0,a.Lk)("div",Dl,[(0,a.Lk)("div",Pl,[(0,a.Lk)("span",_l,(0,l.v_)(o.selectedBillingCycle?.label)+":",1),(0,a.Lk)("span",Sl,"฿"+(0,l.v_)(o.selectedBillingCycle?.price.toLocaleString()),1)]),o.getTrialDays()>0?((0,a.uX)(),(0,a.CE)("div",El,[t[37]||(t[37]=(0,a.Lk)("span",{class:"text-indigo-700"},"ระยะเวลาทดลองใช้:",-1)),(0,a.Lk)("span",Fl,(0,l.v_)(o.getTrialDays())+" วัน (ฟรี)",1)])):(0,a.Q3)("",!0),n.config.enableProration&&o.prorationAmount?((0,a.uX)(),(0,a.CE)("div",Ml,[t[38]||(t[38]=(0,a.Lk)("span",{class:"text-indigo-700"},"คิดตามสัดส่วน:",-1)),(0,a.Lk)("span",Il,"฿"+(0,l.v_)(o.prorationAmount.toLocaleString()),1)])):(0,a.Q3)("",!0),(0,a.Lk)("div",Xl,[t[39]||(t[39]=(0,a.Lk)("span",{class:"text-indigo-900"},"รวมทั้งสิ้น:",-1)),(0,a.Lk)("span",Bl,"฿"+(0,l.v_)(o.totalAmount.toLocaleString()),1)]),(0,a.Lk)("div",Tl,[(0,a.Lk)("p",null,"วันที่เริ่มต้น: "+(0,l.v_)(o.formatStartDate()),1),(0,a.Lk)("p",null,"วันที่สิ้นสุด: "+(0,l.v_)(o.formatEndDate()),1)])])]),(0,a.Lk)("div",Al,[(0,a.Lk)("button",{onClick:t[15]||(t[15]=t=>e.$emit("close")),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"}," ยกเลิก "),(0,a.Lk)("button",{onClick:t[16]||(t[16]=(...e)=>o.confirmConfiguration&&o.confirmConfiguration(...e)),disabled:!o.isConfigurationValid,class:"px-4 py-2 border border-transparent rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-300"}," ยืนยันการกำหนดค่า ",8,jl)])])):(0,a.Q3)("",!0)])}var Ul={name:"AdvancedPackageConfig",components:{FlexibleDateTimePicker:rs},props:{collection:{type:Object,required:!0},hostkey:{type:String,required:!0}},emits:["close","configured"],data(){return{availablePackages:[],selectedPackage:null,config:{billingCycle:"monthly",startDateType:"immediate",specificStartDate:null,delayDays:1,endDateType:"auto_renewal",fixedDuration:30,specificEndDate:null,enableTrial:!1,trialDays:"7",customTrialDays:7,requireCreditCard:!0,enableProration:!1,enableGracePeriod:!1,gracePeriodDays:"7",reminderDays:[7,30]},loading:!1,error:null}},computed:{today(){return(new Date).toISOString().split("T")[0]},selectedBillingCycle(){return this.selectedPackage?this.selectedPackage.pricing.billingCycles.find((e=>e.type===this.config.billingCycle)):null},prorationAmount(){if(!this.config.enableProration||!this.selectedBillingCycle)return 0;const e=this.getCalculatedStartDate(),t=new Date(e.getFullYear(),e.getMonth()+1,0),s=Math.ceil((t-e)/864e5),a=t.getDate();return Math.round(this.selectedBillingCycle.price/a*s)},totalAmount(){return this.selectedBillingCycle?this.getTrialDays()>0?0:this.config.enableProration?this.prorationAmount:this.selectedBillingCycle.price:0},isConfigurationValid(){return!!this.selectedPackage&&(!("specific_date"===this.config.startDateType&&!this.config.specificStartDate)&&(!("specific_end_date"===this.config.endDateType&&!this.config.specificEndDate)&&!("custom_delay"===this.config.startDateType&&!this.config.delayDays)))}},methods:{async loadPackages(){try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/package/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{status:!0}]})});e.ok&&(this.availablePackages=await e.json())}catch(e){console.error("Error loading packages:",e),this.error="ไม่สามารถโหลดรายการ Package ได้"}},selectPackage(e){this.selectedPackage=e,this.config.billingCycle=e.pricing.defaultCycle||"monthly"},getMinPrice(e){return Math.min(...e.pricing.billingCycles.map((e=>e.price/(e.duration/30))))},getTrialDays(){return this.config.enableTrial?"custom"===this.config.trialDays?this.config.customTrialDays:parseInt(this.config.trialDays):0},getCalculatedStartDate(){const e=new Date;switch(this.config.startDateType){case"immediate":return e;case"next_business_day":return this.getNextBusinessDay(e);case"specific_date":return this.config.specificStartDate?new Date(this.config.specificStartDate):e;case"next_month":return new Date(e.getFullYear(),e.getMonth()+1,1);case"custom_delay":{const t=new Date(e);return t.setDate(t.getDate()+parseInt(this.config.delayDays)),t}default:return e}},getCalculatedEndDate(){const e=this.getCalculatedStartDate();switch(this.config.endDateType){case"auto_renewal":{const t=new Date(e);return t.setDate(t.getDate()+this.selectedBillingCycle.duration),t}case"fixed_duration":{const t=new Date(e);return t.setDate(t.getDate()+parseInt(this.config.fixedDuration)),t}case"specific_end_date":return this.config.specificEndDate?new Date(this.config.specificEndDate):null;case"usage_based":return null;default:return null}},getNextBusinessDay(e){const t=new Date(e);t.setDate(t.getDate()+1);while(0===t.getDay()||6===t.getDay())t.setDate(t.getDate()+1);return t},calculateMinEndDate(){if("specific_date"===this.config.startDateType&&this.config.specificStartDate){const e=new Date(this.config.specificStartDate);return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]}const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]},validateStartDate(e){if(!e)return"กรุณาเลือกวันที่เริ่มต้น";const t=new Date;return t.setHours(0,0,0,0),e<t?"วันที่เริ่มต้นต้องไม่น้อยกว่าวันนี้":null},validateEndDate(e){if(!e)return"กรุณาเลือกวันที่สิ้นสุด";const t=this.getCalculatedStartDate();if(e<=t)return"วันที่สิ้นสุดต้องมากกว่าวันที่เริ่มต้น";const s=Math.ceil((e-t)/864e5);return s<7?"ระยะเวลาใช้งานต้องไม่น้อยกว่า 7 วัน":null},formatStartDate(){const e=this.getCalculatedStartDate();return e.toLocaleDateString("th-TH")},formatEndDate(){const e=this.getCalculatedEndDate();return e?e.toLocaleDateString("th-TH"):"ต่ออายุอัตโนมัติ"},async confirmConfiguration(){try{this.loading=!0;const e=this.getCalculatedStartDate(),t=this.getCalculatedEndDate(),s={package:this.selectedPackage,configuration:{...this.config,calculatedStartDate:e.toISOString(),calculatedEndDate:t?t.toISOString():null,trialDays:this.getTrialDays(),totalAmount:this.totalAmount},collection:this.collection};this.$emit("configured",s)}catch(e){console.error("Error confirming configuration:",e),this.error="เกิดข้อผิดพลาดในการยืนยันการกำหนดค่า"}finally{this.loading=!1}}},async mounted(){await this.loadPackages()}};const Ql=(0,ls.A)(Ul,[["render",Vl],["__scopeId","data-v-310b69bf"]]);var Rl=Ql,Hl={name:"PackageSubscriptionManager",components:{PackageAssignmentModal:gs,PackageBillingHistory:Mn,AdvancedPackageConfig:Rl},props:{collection:{type:Object,required:!0},hostkey:{type:String,required:!0}},data(){return{currentSubscription:null,currentPackage:null,usage:{assets:0,users:0,storageGB:0,bandwidthGB:0},billingHistory:[],showAssignmentModal:!1,showUpgradeModal:!1,showBillingHistory:!1,showAdvancedConfig:!1,loading:!1}},computed:{daysRemaining(){if(!this.currentSubscription?.endDate)return null;const e=new Date(this.currentSubscription.endDate),t=new Date,s=e-t,a=Math.ceil(s/864e5);return a},getExpiryText(){return null===this.daysRemaining?"ไม่ทราบวันหมดอายุ":this.daysRemaining<=0?"Package หมดอายุแล้ว":"เหลืออีก "+this.daysRemaining+" วัน"}},methods:{async loadSubscriptionData(){try{this.loading=!0;const e=await fetch("https://gateway.cloudrestfulapi.com/api/package-assignment/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"findOne",args:[{collectionId:this.collection._id,status:{$in:["active","trial"]}}]})});e.ok&&(this.currentSubscription=await e.json(),this.currentSubscription&&(await this.loadPackageDetails(),await this.loadUsageData(),await this.loadBillingHistory()))}catch(e){console.error("Error loading subscription data:",e)}finally{this.loading=!1}},async loadPackageDetails(){try{const e=await fetch(`https://gateway.cloudrestfulapi.com/api/package/${this.currentSubscription.packageId}`,{headers:{"client-token-key":this.hostkey}});e.ok&&(this.currentPackage=await e.json())}catch(e){console.error("Error loading package details:",e)}},async loadUsageData(){try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/hostname/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{parent:this.collection._id,siteType:"asset"}]})});if(e.ok){const t=await e.json();this.usage.assets=t.length}const t=await fetch("https://gateway.cloudrestfulapi.com/api/user/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{collection:{$in:[this.collection._id]}}]})});if(t.ok){const e=await t.json();this.usage.users=e.length}this.usage.storageGB=10*Math.random(),this.usage.bandwidthGB=50*Math.random()}catch(e){console.error("Error loading usage data:",e)}},async loadBillingHistory(){try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/billing-history/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{collectionId:this.collection._id}],sort:{billingDate:-1}})});e.ok&&(this.billingHistory=await e.json())}catch(e){console.error("Error loading billing history:",e),this.billingHistory=[]}},getBillingCycleLabel(){if(!this.currentPackage||!this.currentSubscription)return"";const e=this.currentPackage.pricing.billingCycles.find((e=>e.type===this.currentSubscription.billingCycle));return e?.label||this.currentSubscription.billingCycle},getStatusClass(e){const t={active:"bg-green-100 text-green-800",trial:"bg-blue-100 text-blue-800",expired:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"};return t[e]||"bg-gray-100 text-gray-800"},getStatusText(e){const t={active:"ใช้งานอยู่",trial:"ทดลองใช้",expired:"หมดอายุ",cancelled:"ยกเลิก"};return t[e]||e},getUsagePercentage(e){if(!this.currentPackage)return 0;const t=this.currentPackage.limits,s=this.usage[e];let a;switch(e){case"assets":a=t.maxAssets;break;case"users":a=t.maxUsers;break;case"storage":a=t.storageGB;break;default:return 0}return a?Math.min(s/a*100,100):0},formatDate(e){return e?new Date(e).toLocaleDateString("th-TH"):""},async toggleAutoRenewal(){try{const e=await fetch(`https://gateway.cloudrestfulapi.com/api/package-assignment/${this.currentSubscription._id}`,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({data:{autoRenewal:!this.currentSubscription.autoRenewal,updatedAt:new Date}})});e.ok&&(this.currentSubscription.autoRenewal=!this.currentSubscription.autoRenewal)}catch(e){console.error("Error toggling auto renewal:",e)}},async cancelSubscription(){if(confirm("คุณแน่ใจหรือไม่ที่จะยกเลิก Package นี้?"))try{const e=await fetch(`https://gateway.cloudrestfulapi.com/api/package-assignment/${this.currentSubscription._id}`,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({data:{status:"cancelled",cancelledAt:new Date,updatedAt:new Date}})});e.ok&&(this.currentSubscription.status="cancelled")}catch(e){console.error("Error cancelling subscription:",e)}},handlePackageAssigned(){this.loadSubscriptionData()},handleAdvancedConfigured(e){console.log("Advanced configuration received:",e),this.showAdvancedConfig=!1,this.loadSubscriptionData()}},async mounted(){await this.loadSubscriptionData()}};const Ol=(0,ls.A)(Hl,[["render",_e]]);var $l=Ol;const Gl={class:"bg-white shadow rounded-lg p-6"},ql={class:"flex items-center justify-between mb-4"},Nl=["disabled"],Wl={key:0,class:"mb-6"},Yl={class:"flex items-center space-x-4 p-4 bg-blue-50 rounded-lg"},Jl={class:"flex-shrink-0"},Kl={class:"flex-1"},zl={class:"text-lg font-semibold text-blue-900"},Zl={class:"text-sm text-blue-700"},eo={class:"mt-2 flex items-center space-x-4 text-sm text-blue-600"},to={key:1,class:"space-y-6"},so={class:"usage-metric"},ao={class:"flex items-center justify-between mb-2"},io={class:"flex items-center"},no={class:"text-sm text-gray-600"},lo={class:"w-full bg-gray-200 rounded-full h-2"},oo={key:0,class:"mt-1 text-xs text-orange-600"},ro={class:"usage-metric"},co={class:"flex items-center justify-between mb-2"},go={class:"flex items-center"},uo={class:"text-sm text-gray-600"},mo={class:"w-full bg-gray-200 rounded-full h-2"},po={key:0,class:"mt-1 text-xs text-orange-600"},yo={class:"usage-metric"},ko={class:"flex items-center justify-between mb-2"},bo={class:"flex items-center"},ho={class:"text-sm text-gray-600"},fo={class:"w-full bg-gray-200 rounded-full h-2"},xo={key:0,class:"mt-1 text-xs text-orange-600"},vo={class:"usage-metric"},Lo={class:"flex items-center justify-between mb-2"},wo={class:"flex items-center"},Co={class:"text-sm text-gray-600"},Do={class:"w-full bg-gray-200 rounded-full h-2"},Po={key:0,class:"mt-1 text-xs text-orange-600"},_o={key:2,class:"mt-6 border-t pt-6"},So={class:"grid grid-cols-2 gap-3"},Eo={class:"mt-6 border-t pt-6 flex space-x-3"};function Fo(e,t,s,i,n,o){const r=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)("div",Gl,[(0,a.Lk)("div",ql,[t[4]||(t[4]=(0,a.Lk)("h3",{class:"text-lg font-medium text-gray-900"},"Package Usage Monitor",-1)),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>o.refreshUsage&&o.refreshUsage(...e)),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",disabled:n.loading},[(0,a.bF)(r,{icon:["fas","refresh"],class:(0,l.C4)(["w-4 h-4 mr-2",n.loading?"animate-spin":""])},null,8,["class"]),t[3]||(t[3]=(0,a.eW)(" รีเฟรช "))],8,Nl)]),s.collection&&s.collection.package?((0,a.uX)(),(0,a.CE)("div",Wl,[(0,a.Lk)("div",Yl,[(0,a.Lk)("div",Jl,[(0,a.bF)(r,{icon:["fas","gift"],class:"w-8 h-8 text-blue-600"})]),(0,a.Lk)("div",Kl,[(0,a.Lk)("h4",zl,(0,l.v_)(s.collection.package.name),1),(0,a.Lk)("p",Zl,(0,l.v_)(s.collection.package.description),1),(0,a.Lk)("div",eo,[(0,a.Lk)("span",null,"฿"+(0,l.v_)(s.collection.package.price)+"/"+(0,l.v_)(s.collection.package.duration)+" วัน",1),(0,a.Lk)("span",{class:(0,l.C4)(["inline-flex px-2 py-1 rounded-full text-xs font-medium",s.collection.package.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},(0,l.v_)(s.collection.package.status?"เปิดใช้งาน":"ปิดใช้งาน"),3)])])])])):(0,a.Q3)("",!0),s.usage?((0,a.uX)(),(0,a.CE)("div",to,[(0,a.Lk)("div",so,[(0,a.Lk)("div",ao,[(0,a.Lk)("div",io,[(0,a.bF)(r,{icon:["fas","database"],class:"w-5 h-5 text-indigo-600 mr-2"}),t[5]||(t[5]=(0,a.Lk)("span",{class:"text-sm font-medium text-gray-900"},"Assets",-1))]),(0,a.Lk)("span",no,(0,l.v_)(o.formatLimits.assets.usage),1)]),(0,a.Lk)("div",lo,[(0,a.Lk)("div",{class:(0,l.C4)(["h-2 rounded-full transition-all duration-300",o.getProgressColor(o.formatLimits.assets.percentage)]),style:(0,l.Tr)({width:`${Math.min(o.formatLimits.assets.percentage,100)}%`})},null,6)]),o.formatLimits.assets.percentage>=80?((0,a.uX)(),(0,a.CE)("div",oo," ⚠️ ใกล้เต็มขีดจำกัดแล้ว ")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",ro,[(0,a.Lk)("div",co,[(0,a.Lk)("div",go,[(0,a.bF)(r,{icon:["fas","users"],class:"w-5 h-5 text-indigo-600 mr-2"}),t[6]||(t[6]=(0,a.Lk)("span",{class:"text-sm font-medium text-gray-900"},"Users",-1))]),(0,a.Lk)("span",uo,(0,l.v_)(o.formatLimits.users.usage),1)]),(0,a.Lk)("div",mo,[(0,a.Lk)("div",{class:(0,l.C4)(["h-2 rounded-full transition-all duration-300",o.getProgressColor(o.formatLimits.users.percentage)]),style:(0,l.Tr)({width:`${Math.min(o.formatLimits.users.percentage,100)}%`})},null,6)]),o.formatLimits.users.percentage>=80?((0,a.uX)(),(0,a.CE)("div",po," ⚠️ ใกล้เต็มขีดจำกัดแล้ว ")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",yo,[(0,a.Lk)("div",ko,[(0,a.Lk)("div",bo,[(0,a.bF)(r,{icon:["fas","hdd"],class:"w-5 h-5 text-indigo-600 mr-2"}),t[7]||(t[7]=(0,a.Lk)("span",{class:"text-sm font-medium text-gray-900"},"Storage",-1))]),(0,a.Lk)("span",ho,(0,l.v_)(o.formatLimits.storage.usage),1)]),(0,a.Lk)("div",fo,[(0,a.Lk)("div",{class:(0,l.C4)(["h-2 rounded-full transition-all duration-300",o.getProgressColor(o.formatLimits.storage.percentage)]),style:(0,l.Tr)({width:`${Math.min(o.formatLimits.storage.percentage,100)}%`})},null,6)]),o.formatLimits.storage.percentage>=80?((0,a.uX)(),(0,a.CE)("div",xo," ⚠️ ใกล้เต็มขีดจำกัดแล้ว ")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",vo,[(0,a.Lk)("div",Lo,[(0,a.Lk)("div",wo,[(0,a.bF)(r,{icon:["fas","tachometer-alt"],class:"w-5 h-5 text-indigo-600 mr-2"}),t[8]||(t[8]=(0,a.Lk)("span",{class:"text-sm font-medium text-gray-900"},"Bandwidth",-1))]),(0,a.Lk)("span",Co,(0,l.v_)(o.formatLimits.bandwidth.usage),1)]),(0,a.Lk)("div",Do,[(0,a.Lk)("div",{class:(0,l.C4)(["h-2 rounded-full transition-all duration-300",o.getProgressColor(o.formatLimits.bandwidth.percentage)]),style:(0,l.Tr)({width:`${Math.min(o.formatLimits.bandwidth.percentage,100)}%`})},null,6)]),o.formatLimits.bandwidth.percentage>=80?((0,a.uX)(),(0,a.CE)("div",Po," ⚠️ ใกล้เต็มขีดจำกัดแล้ว ")):(0,a.Q3)("",!0)])])):(0,a.Q3)("",!0),s.collection&&s.collection.package?((0,a.uX)(),(0,a.CE)("div",_o,[t[9]||(t[9]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"คุณสมบัติ Package",-1)),(0,a.Lk)("div",So,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.packageFeatures,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:"flex items-center"},[(0,a.bF)(r,{icon:["fas",e.available?"check-circle":"times-circle"],class:(0,l.C4)(["w-4 h-4 mr-2",e.available?"text-green-500":"text-red-500"])},null,8,["icon","class"]),(0,a.Lk)("span",{class:(0,l.C4)(["text-sm",e.available?"text-gray-900":"text-gray-500"])},(0,l.v_)(e.label),3)])))),128))])])):(0,a.Q3)("",!0),(0,a.Lk)("div",Eo,[o.hasLimitWarnings?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[1]||(t[1]=t=>e.$emit("upgrade-package")),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[(0,a.bF)(r,{icon:["fas","arrow-up"],class:"w-4 h-4 mr-2"}),t[10]||(t[10]=(0,a.eW)(" อัปเกรด Package "))])):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:t[2]||(t[2]=t=>e.$emit("view-packages")),class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[(0,a.bF)(r,{icon:["fas","gift"],class:"w-4 h-4 mr-2"}),t[11]||(t[11]=(0,a.eW)(" ดู Package อื่น "))])])])}s(37550);function Mo(e,t=1){if(!e||!e.package)return{isValid:!1,message:"Collection หรือ Package ไม่พบ",type:"error"};const s=e.package.limits,a=e.assetsCount||0,i=a+t;return s.maxAssets&&i>s.maxAssets?{isValid:!1,message:`ไม่สามารถเพิ่ม Asset ได้ เนื่องจากเกินขีดจำกัด (${i}/${s.maxAssets})`,type:"limit_exceeded",current:a,limit:s.maxAssets,additional:t}:{isValid:!0,message:`สามารถเพิ่ม Asset ได้ (${i}/${s.maxAssets||"ไม่จำกัด"})`,type:"success",current:a,limit:s.maxAssets,additional:t}}function Io(e,t,s=1){if(!e||!e.package)return{isValid:!1,message:"Collection หรือ Package ไม่พบ",type:"error"};const a=e.package.limits,i=t+s;return a.maxUsers&&i>a.maxUsers?{isValid:!1,message:`ไม่สามารถเพิ่ม User ได้ เนื่องจากเกินขีดจำกัด (${i}/${a.maxUsers})`,type:"limit_exceeded",current:t,limit:a.maxUsers,additional:s}:{isValid:!0,message:`สามารถเพิ่ม User ได้ (${i}/${a.maxUsers||"ไม่จำกัด"})`,type:"success",current:t,limit:a.maxUsers,additional:s}}function Xo(e,t,s=0){if(!e||!e.package)return{isValid:!1,message:"Collection หรือ Package ไม่พบ",type:"error"};const a=e.package.limits,i=t+s;return a.storageGB&&i>a.storageGB?{isValid:!1,message:`ไม่สามารถใช้ Storage ได้ เนื่องจากเกินขีดจำกัด (${i.toFixed(2)}/${a.storageGB} GB)`,type:"limit_exceeded",current:t,limit:a.storageGB,additional:s}:{isValid:!0,message:`Storage ใช้งานได้ (${i.toFixed(2)}/${a.storageGB||"ไม่จำกัด"} GB)`,type:"success",current:t,limit:a.storageGB,additional:s}}function Bo(e,t,s=0){if(!e||!e.package)return{isValid:!1,message:"Collection หรือ Package ไม่พบ",type:"error"};const a=e.package.limits,i=t+s;return a.bandwidth&&i>a.bandwidth?{isValid:!1,message:`ไม่สามารถใช้ Bandwidth ได้ เนื่องจากเกินขีดจำกัด (${i.toFixed(2)}/${a.bandwidth} GB)`,type:"limit_exceeded",current:t,limit:a.bandwidth,additional:s}:{isValid:!0,message:`Bandwidth ใช้งานได้ (${i.toFixed(2)}/${a.bandwidth||"ไม่จำกัด"} GB)`,type:"success",current:t,limit:a.bandwidth,additional:s}}function To(e,t){if(!e||!e.package)return{available:!1,message:"Collection หรือ Package ไม่พบ",type:"error"};const s=e.package.limits,a=!0===s[t];return{available:a,message:a?`${t} ใช้งานได้ในแพ็กเกจนี้`:`${t} ไม่รองรับในแพ็กเกจนี้`,type:a?"success":"feature_unavailable",feature:t}}function Ao(e,t,s={}){const a={isValid:!0,violations:[],warnings:[],summary:{}},i=Mo(e,s.assets||0);if(i.isValid||(a.isValid=!1,a.violations.push(i)),a.summary.assets=i,void 0!==t.users){const i=Io(e,t.users,s.users||0);i.isValid||(a.isValid=!1,a.violations.push(i)),a.summary.users=i}if(void 0!==t.storageGB){const i=Xo(e,t.storageGB,s.storageGB||0);i.isValid||(a.isValid=!1,a.violations.push(i)),a.summary.storage=i}if(void 0!==t.bandwidthGB){const i=Bo(e,t.bandwidthGB,s.bandwidthGB||0);i.isValid||(a.isValid=!1,a.violations.push(i)),a.summary.bandwidth=i}return a}function jo(e,t={}){const s=(e,t="")=>e?`${e}${t}`:"ไม่จำกัด",a=(e,t,s="")=>{const a=e||0,i=t?`${t}${s}`:"ไม่จำกัด";return`${a}${s} / ${i}`};return{assets:{limit:s(e.maxAssets),usage:a(t.assets,e.maxAssets),percentage:e.maxAssets?Math.round((t.assets||0)/e.maxAssets*100):0},users:{limit:s(e.maxUsers),usage:a(t.users,e.maxUsers),percentage:e.maxUsers?Math.round((t.users||0)/e.maxUsers*100):0},storage:{limit:s(e.storageGB," GB"),usage:a(t.storageGB,e.storageGB," GB"),percentage:e.storageGB?Math.round((t.storageGB||0)/e.storageGB*100):0},bandwidth:{limit:s(e.bandwidth," GB"),usage:a(t.bandwidthGB,e.bandwidth," GB"),percentage:e.bandwidth?Math.round((t.bandwidthGB||0)/e.bandwidth*100):0}}}var Vo={name:"PackageLimitMonitor",props:{collection:{type:Object,required:!0},usage:{type:Object,default:()=>({assets:0,users:0,storageGB:0,bandwidthGB:0})}},emits:["upgrade-package","view-packages","refresh-usage"],data(){return{loading:!1,validationResult:null}},computed:{formatLimits(){return this.collection&&this.collection.package?jo(this.collection.package.limits,this.usage):{assets:{usage:"0 / ไม่จำกัด",percentage:0},users:{usage:"0 / ไม่จำกัด",percentage:0},storage:{usage:"0 GB / ไม่จำกัด",percentage:0},bandwidth:{usage:"0 GB / ไม่จำกัด",percentage:0}}},packageFeatures(){if(!this.collection||!this.collection.package)return{};const e={customDomain:{label:"Custom Domain",available:!1},sslCertificate:{label:"SSL Certificate",available:!1},apiAccess:{label:"API Access",available:!1},prioritySupport:{label:"Priority Support",available:!1}};return Object.keys(e).forEach((t=>{const s=To(this.collection,t);e[t].available=s.available})),e},hasLimitWarnings(){return Object.values(this.formatLimits).some((e=>e.percentage>=80))}},methods:{getProgressColor(e){return e>=90?"bg-red-500":e>=80?"bg-orange-500":e>=60?"bg-yellow-500":"bg-green-500"},async refreshUsage(){this.loading=!0;try{this.$emit("refresh-usage"),await new Promise((e=>setTimeout(e,1e3)))}finally{this.loading=!1}},validateLimits(e={}){return this.collection&&this.collection.package?(this.validationResult=Ao(this.collection,this.usage,e),this.validationResult):null}},watch:{collection:{handler(){this.validateLimits()},immediate:!0},usage:{handler(){this.validateLimits()},deep:!0,immediate:!0}}};const Uo=(0,ls.A)(Vo,[["render",Fo],["__scopeId","data-v-4c4172b2"]]);var Qo=Uo,Ro={name:"PackageManagement",components:{PackageSubscriptionManager:$l,PackageLimitMonitor:Qo,PackageAssignmentModal:gs,PackageBillingHistory:Mn,AdvancedPackageConfig:Rl},props:{collectionId:{type:String,required:!0}},data(){return{hostkey:this.$Key,collection:null,usage:{assetsCount:0,usersCount:0,storageGB:0,bandwidthGB:0,apiRequestsCount:0},recentActivities:[],loading:!1,showPackageAssignment:!1,showBillingHistory:!1,showAdvancedConfig:!1,showUpgradeModal:!1,showPackageSelection:!1}},async mounted(){await this.loadData()},methods:{async loadData(){this.loading=!0;try{await Promise.all([this.loadCollection(),this.loadUsageData(),this.loadRecentActivities()])}catch(e){console.error("Error loading package management data:",e)}finally{this.loading=!1}},async loadCollection(){try{const e=await fetch(`https://gateway.cloudrestfulapi.com/api/hostname/${this.collectionId}`,{method:"GET",headers:{"Content-Type":"application/json","client-token-key":this.hostkey}});e.ok&&(this.collection=await e.json())}catch(e){console.error("Error loading collection:",e)}},async loadUsageData(){try{const e=await fetch(`https://gateway.cloudrestfulapi.com/api/usage/${this.collectionId}`,{method:"GET",headers:{"Content-Type":"application/json","client-token-key":this.hostkey}});e.ok?this.usage=await e.json():this.usage={assetsCount:0,usersCount:0,storageGB:0,bandwidthGB:0,apiRequestsCount:0}}catch(e){console.error("Error loading usage data:",e),this.usage={assetsCount:0,usersCount:0,storageGB:0,bandwidthGB:0,apiRequestsCount:0}}},async loadRecentActivities(){try{this.recentActivities=[{id:1,message:"Package upgraded to Professional",created_at:(new Date).toISOString()},{id:2,message:"Payment processed successfully",created_at:new Date(Date.now()-864e5).toISOString()}]}catch(e){console.error("Error loading recent activities:",e),this.recentActivities=[]}},async refreshData(){await this.loadData()},async refreshUsageData(){await this.loadUsageData()},handlePackageAssigned(e){this.showPackageAssignment=!1,this.refreshData(),this.recentActivities.unshift({id:Date.now(),message:`Package "${e.packageName}" assigned successfully`,created_at:(new Date).toISOString()})},handleAdvancedConfigured(){this.showAdvancedConfig=!1,this.refreshData(),this.recentActivities.unshift({id:Date.now(),message:"Advanced configuration updated",created_at:(new Date).toISOString()})},getStatusClass(e){return e?"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800":"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"},formatDate(e){return e?new Date(e).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}}};const Ho=(0,ls.A)(Ro,[["render",V],["__scopeId","data-v-82a9863c"]]);var Oo=Ho,$o={name:"PackageManagementView",components:{PackageManagement:Oo},computed:{collectionId(){return this.$route.params.collectionId||this.getDefaultCollectionId()}},methods:{getDefaultCollectionId(){const e=this.$store?.state?.session||{};return e.current?._id||null}}};const Go=(0,ls.A)($o,[["render",n]]);var qo=Go}}]);
//# sourceMappingURL=2165.6aaa66f4.js.map