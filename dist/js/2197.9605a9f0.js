"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[2197],{12197:function(e,t,s){s.r(t),s.d(t,{default:function(){return re}});var o=s(20641);function a(e,t,s,a,r,n){return(0,o.uX)(),(0,o.Wv)((0,o.$y)(n.componentName))}var r=s(52968),n=s(75220),l=s(40475),i=s(90033);const c={class:"relative isolate pt-1"},u={class:"mx-auto max-w-7xl px-4 py-5 sm:px-6 lg:px-8"},d={class:"mx-auto flex max-w-2xl items-center justify-between gap-x-8 lg:mx-0 lg:max-w-none"},g={class:"flex items-center gap-x-6"},p={class:"relative inline-block"},m={class:"text-sm leading-6 text-white"},h={class:"mt-1 text-base font-semibold leading-6 text-white"},f={class:"font-normal bg-black text-white px-2 py-1 text-sm"},y={class:"flex items-center gap-x-4 sm:gap-x-6"},k={key:0,class:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8 pt-8"},x={class:"pb-4 text-xl"},b={class:"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-4 gap-4"},v={class:"aspect-video rounded-xl bg-gray-50 object-cover overflow-hidden rounded-lg bg-gray-100 group-hover:opacity-75 relative"},w={class:"absolute"},$={class:"text-white text-center"},L=["src"],C={key:0,class:"absolute top-10 -right-10 bg-red-500 text-white font-bold py-0 px-10 transform rotate-45 shadow-xl"},_={class:"mt-4 font-semibold text-indigo-900"},E={class:"italic text-gray-500"},F={class:"mt-2 grid grid-cols-2 md:grid-cols-3 items-center gap-2 text-gray-500"},A={class:"col-span-1 font-medium text-gray-500"},j={class:"col-span-1 font-medium"},T={class:"col-span-2 md:col-span-1 font-medium"},X={class:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8 pt-8"},D={class:"pb-4 text-xl"},W={class:"font-bold"},O={class:"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-4 gap-4"},I={class:"aspect-video rounded-xl bg-gray-50 object-cover overflow-hidden rounded-lg bg-gray-100 group-hover:opacity-75 relative"},S={class:"absolute"},K={class:"text-white text-center"},N=["src"],P={key:0,class:"absolute top-10 -right-10 bg-red-500 text-white font-bold py-0 px-10 transform rotate-45 shadow-xl"},B={class:"mt-4 font-semibold text-indigo-900"},z={class:"italic text-gray-500"},J={class:"mt-2 grid grid-cols-2 md:grid-cols-3 items-center gap-2 text-gray-500"},q={class:"col-span-1 font-medium text-gray-500"},Q={class:"col-span-1 font-medium"},M={class:"col-span-2 md:col-span-1 font-medium"};function R(e,t,s,a,r,n){const l=(0,o.g2)("avatar"),R=(0,o.g2)("font-awesome-icon"),G=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("header",c,[t[3]||(t[3]=(0,o.Lk)("div",{class:"absolute inset-0 -z-10 overflow-hidden bg-profile","aria-hidden":"true"},[(0,o.Lk)("div",{class:"absolute left-16 top-full -mt-16 transform-gpu opacity-50 blur-3xl xl:left-1/2 xl:-ml-80"}),(0,o.Lk)("div",{class:"absolute inset-x-0 bottom-0 h-px bg-gray-900/5"})],-1)),(0,o.Lk)("div",u,[(0,o.Lk)("div",d,[(0,o.Lk)("div",g,[(0,o.Lk)("span",p,[(0,o.bF)(l,{data:{name:r.profile.firstname+" "+r.profile.lastname,image:r.profile.avatar,size:14},class:"h-16 w-16"},null,8,["data"]),t[1]||(t[1]=(0,o.Lk)("span",{class:"absolute right-0 top-0 block h-4 w-4 rounded-full bg-green-400 ring-2 ring-white"},null,-1))]),(0,o.Lk)("h1",null,[(0,o.Lk)("div",m,(0,i.v_)(this.profile.info.departmentName),1),(0,o.Lk)("div",h,[(0,o.eW)((0,i.v_)(this.profile.firstname)+" "+(0,i.v_)(this.profile.lastname)+" ",1),(0,o.Lk)("span",f,(0,i.v_)(r.target.name),1)])])]),(0,o.Lk)("div",y,[t[2]||(t[2]=(0,o.Lk)("a",{href:"#",class:"hidden text-sm font-semibold leading-6 text-white sm:block"},"แก้ไขข้อมูลส่วนตัว",-1)),(0,o.Lk)("button",{onClick:t[0]||(t[0]=e=>n.logout()),type:"button",class:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},[(0,o.bF)(R,{icon:["fas","power-off"]})])])])])]),r.enroll.length>0?((0,o.uX)(),(0,o.CE)("div",k,[(0,o.Lk)("div",x,[(0,o.bF)(R,{icon:["fas","book-open"],class:"text-xl pr-1"}),t[4]||(t[4]=(0,o.eW)(" หลักสูตรที่กำลังเรียน "))]),(0,o.Lk)("div",b,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.enroll,(e=>((0,o.uX)(),(0,o.Wv)(G,{key:e._id,to:"/lesson/detail/"+e.course._id,class:"group text-sm"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",v,[(0,o.Lk)("div",w,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.course.category,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"m-1 p-1 rounded-md bg-gray-800"},[(0,o.Lk)("p",$,(0,i.v_)(n.getCategoryName(e)),1)])))),128))]),(0,o.Lk)("img",{src:e.course.cover,class:"h-full w-full object-cover object-center"},null,8,L),n.loggedInComputed.enrollAccess(e.course._id)&&e.course.sale_price?((0,o.uX)(),(0,o.CE)("div",C," เริ่มเข้าอบรมแล้ว ")):(0,o.Q3)("",!0)]),(0,o.Lk)("h3",_,(0,i.v_)(e.course.name),1),(0,o.Lk)("p",E,[(0,o.bF)(R,{icon:["fas","user-tie"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),Array.isArray(e.course.lecturer)?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(e.course.lecturer,(e=>((0,o.uX)(),(0,o.CE)(o.FK,{key:e.id},[(0,o.eW)((0,i.v_)(e.name)+" ",1),t[5]||(t[5]=(0,o.Lk)("br",null,null,-1))],64)))),128)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,i.v_)(e.course.lecturer),1)],64))]),(0,o.Lk)("div",F,[(0,o.Lk)("span",A,[(0,o.bF)(R,{icon:["far","clock"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),(0,o.eW)((0,i.v_)(e.course.hours)+" ชม.",1)]),(0,o.Lk)("span",j,[(0,o.bF)(R,{icon:["far","calendar"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),(0,o.eW)((0,i.v_)(e.course.days)+" วัน",1)]),(0,o.Lk)("span",T,[(0,o.bF)(R,{icon:["fas","medal"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),(0,o.eW)((0,i.v_)("yes"===e.course.certification?"มีใบรับรอง":"ไม่มีใบรับรอง"),1)])])])),_:2},1032,["to"])))),128))])])):(0,o.Q3)("",!0),(0,o.Lk)("div",X,[(0,o.Lk)("div",D,[(0,o.bF)(R,{icon:["fas","book-open"],class:"text-xl pr-1"}),t[6]||(t[6]=(0,o.eW)(" หลักสูตรสำหรับ ")),(0,o.Lk)("span",W,(0,i.v_)(r.target.name),1)]),(0,o.Lk)("div",O,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.courses,(e=>((0,o.uX)(),(0,o.Wv)(G,{key:e._id,to:"/lesson/detail/"+e._id,class:"group text-sm"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",I,[(0,o.Lk)("div",S,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.category,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"m-1 p-1 rounded-md bg-gray-800"},[(0,o.Lk)("p",K,(0,i.v_)(n.getCategoryName(e)),1)])))),128))]),(0,o.Lk)("img",{src:e.cover,class:"h-full w-full object-cover object-center"},null,8,N),n.loggedInComputed.enrollAccess(e._id)&&e.sale_price?((0,o.uX)(),(0,o.CE)("div",P," เริ่มเข้าอบรมแล้ว ")):(0,o.Q3)("",!0)]),(0,o.Lk)("h3",B,(0,i.v_)(e.name),1),(0,o.Lk)("p",z,[(0,o.bF)(R,{icon:["fas","user-tie"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),Array.isArray(e.lecturer)?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(e.lecturer,(e=>((0,o.uX)(),(0,o.CE)(o.FK,{key:e.id},[(0,o.eW)((0,i.v_)(e.name)+" ",1),t[7]||(t[7]=(0,o.Lk)("br",null,null,-1))],64)))),128)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)((0,i.v_)(e.lecturer),1)],64))]),(0,o.Lk)("div",J,[(0,o.Lk)("span",q,[(0,o.bF)(R,{icon:["far","clock"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),(0,o.eW)((0,i.v_)(e.hours)+" ชม.",1)]),(0,o.Lk)("span",Q,[(0,o.bF)(R,{icon:["far","calendar"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),(0,o.eW)((0,i.v_)(e.days)+" วัน",1)]),(0,o.Lk)("span",M,[(0,o.bF)(R,{icon:["fas","medal"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),(0,o.eW)((0,i.v_)("yes"===e.certification?"มีใบรับรอง":"ไม่มีใบรับรอง"),1)])])])),_:2},1032,["to"])))),128))])])],64)}s(44114),s(98992),s(54520),s(72577);var G=s(9964),U=s(68831),H=s(54973),V=s(31398),Y=s(15851),Z={name:"User Profile",components:{avatar:U.A},data(){return{configs:l.A.get("configs"),profile:l.A.get("session","user"),session:l.A.get("session"),categories:[],enroll:[],target:[],courses:[],avatarData:{image:null}}},created(){this.profile.req_reset&&this.$router.push("/user/reset")},methods:{formatPrice(e,t){return G.A.formatPriceCompact(e,t)},getComponent(e){const t={application:H.A,lesson:V.A,shop:Y.A};return t[e]||null},formatThaidate(e){return G.A.toThaiDatetime(e)},logout(){this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:500,icon:"success",title:"แจ้งเตือน",text:"ออกจากระบบเรียบร้อยแล้ว"}).then((()=>{l.A.delete("session"),window.location.href="/"}))},countEnrollmentsByStatus(e=[],t){return e&&0!==e.length?e.filter((e=>e.analytics&&e.analytics.status&&e.analytics.status.trim()===t)).length:0},countTotalEnrollments(e=[]){return e?e.length:0},async getCategoryData(){try{this.loading_sources=!1;const e=[{$match:{unit:this.configs.siteID}},{$lookup:{from:"course",localField:"code",foreignField:"category",as:"courses"}},{$project:{_id:1,name:1,code:1,type:1,parent:1,count:{$size:"$courses"}}}],t=await fetch("https://gateway.cloudrestfulapi.com/api/category/aggregate",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({pipeline:e})}),s=await t.json();return s}catch(e){console.log(e)}},getCategoryName(e){return this.categoryMap[e]||""},async getDataCourse(){try{this.loading_sources=!1;const e=this.profile.info.bandCode,t=[{$match:{"target.code":e}},{$group:{_id:null,courses:{$push:"$$ROOT"}}},{$project:{_id:0,course:{$arrayToObject:{$map:{input:{$range:[0,{$size:"$courses"}]},as:"index",in:{k:{$toString:"$$index"},v:{$arrayElemAt:["$courses","$$index"]}}}}}}}],s=await fetch("https://gateway.cloudrestfulapi.com/api/course/aggregate",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({pipeline:t})}),o=await s.json(),a=await this.getCategoryData(),r=await this.getDataTargetCourse();this.categories=a,this.target=r[0],200===s.status&&(this.courses=o[0].course)}catch(e){console.log(e)}},async getDataTargetCourse(){try{this.loading_sources=!1;const e=this.profile.info.bandCode,t=[{$match:{code:e}},{$group:{_id:null,target:{$push:"$$ROOT"}}},{$project:{_id:0,target:{$arrayToObject:{$map:{input:{$range:[0,{$size:"$target"}]},as:"index",in:{k:{$toString:"$$index"},v:{$arrayElemAt:["$target","$$index"]}}}}}}}],s=await fetch("https://gateway.cloudrestfulapi.com/api/target/aggregate",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({pipeline:t})}),o=await s.json();if(200===s.status)return o[0].target}catch(e){console.log(e)}},async getData(){try{this.activeBlock=!0;const e=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{userID:this.session.userID}]}]})}),t=await e.json();for(let s=0;s<t.length;s++){const e=t[s],o=await fetch(`https://gateway.cloudrestfulapi.com/api/course/${e.courseID}`,{method:"GET",headers:{"Content-Type":"application/json"}}),a=await o.json();e.course=a}this.enroll=t,this.activeBlock=!1}catch(e){console.log(e)}}},async mounted(){try{await this.getData(),await this.getDataCourse()}catch(e){console.log(Error)}},computed:{categoryMap(){const e={};if(this.categories&&"object"===typeof this.categories){const t=Object.keys(this.categories);for(const s of t){const t=this.categories[s];e[t.code]=t.name}}return e},loggedInComputed(){const e=l.A.get("session","login"),t=l.A.get("session","enroll");return e?{enrollAccess(e){if(!t||0===t.length)return!1;const s=t.find((t=>t.courseID===e));return!!s}}:{enrollAccess(){return!1}}},countPendingEnrollments(){return this.countEnrollmentsByStatus(this.enroll,"pending")},countProcessingEnrollments(){return this.countEnrollmentsByStatus(this.enroll,"processing")},countCompleteEnrollments(){return this.countEnrollmentsByStatus(this.enroll,"complete")},countTotalEnrollment(){return this.countTotalEnrollments(this.enroll)}}},ee=s(64621);const te=(0,ee.A)(Z,[["render",R]]);var se=te,oe={name:"Lesson Detail",components:{Frontend:se},data(){return{session:l.A.get("session")}},setup(){const e=(0,n.lq)(),t=e.meta.title;(0,r.K7)(t)},computed:{componentName(){return"Frontend"}}};const ae=(0,ee.A)(oe,[["render",a]]);var re=ae}}]);
//# sourceMappingURL=2197.9605a9f0.js.map