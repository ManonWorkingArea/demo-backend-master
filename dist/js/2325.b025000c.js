"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[2325],{48783:function(e,t,s){s.d(t,{A:function(){return $}});var o=s(20641),i=s(53751),r=s(90033);const l={class:"bg-gray-50"},n={class:"flex min-h-full flex-col justify-center py-12 sm:px-6 lg:px-8"},a={class:"sm:mx-auto sm:w-full sm:max-w-lg"},d=["src"],c={class:"mt-2 text-center text-sm text-gray-600"},u={class:"mt-8 sm:mx-auto sm:w-full sm:max-w-md"},m={class:"bg-white px-4 py-8 shadow sm:rounded-lg sm:px-10"},g={class:"mt-2"},f={class:"mt-2"},b={class:"flex items-center justify-between"},p={class:"text-sm"},h={key:0,class:"col-span-2"},k={class:"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5"},v={class:"w-full"};function x(e,t,s,x,w,y){const L=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",l,[(0,o.Lk)("div",n,[(0,o.Lk)("div",a,[this.showModal?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("img",{key:0,class:"mx-auto h-24 w-auto",src:this.configs.siteLogo,alt:"Your Company"},null,8,d)),t[5]||(t[5]=(0,o.Lk)("h2",{class:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900"},"เข้าสู่ระบบสมาชิก -2",-1)),(0,o.Lk)("p",c,[t[4]||(t[4]=(0,o.eW)(" หรือ ")),(0,o.bF)(L,{to:"/user/register",class:"font-medium text-indigo-600 hover:text-indigo-500"},{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.eW)(" ลงทะเบียนสมาชิกใหม่ ")]))),_:1})])]),(0,o.Lk)("div",u,[(0,o.Lk)("div",m,[(0,o.Lk)("form",{class:"space-y-6",onSubmit:t[2]||(t[2]=(0,i.D$)(((...e)=>y.login&&y.login(...e)),["prevent"]))},[(0,o.Lk)("div",null,[t[6]||(t[6]=(0,o.Lk)("label",{for:"email",class:"block text-md font-semibold leading-6 text-gray-900"},"อีเมล์",-1)),(0,o.Lk)("div",g,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>w.email=e),id:"email",name:"email",type:"email",autocomplete:"email",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[i.Jo,w.email]])])]),(0,o.Lk)("div",null,[t[7]||(t[7]=(0,o.Lk)("label",{for:"password",class:"block text-md font-semibold leading-6 text-gray-900"},"รหัสผ่าน",-1)),(0,o.Lk)("div",f,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>w.password=e),id:"password",name:"password",type:"password",autocomplete:"current-password",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[i.Jo,w.password]])])]),(0,o.Lk)("div",b,[t[9]||(t[9]=(0,o.Lk)("div",{class:"flex items-center"},[(0,o.Lk)("input",{id:"remember-me",name:"remember-me",type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,o.Lk)("label",{for:"remember-me",class:"ml-2 block text-sm text-gray-900"},"จำฉันไว้")],-1)),(0,o.Lk)("div",p,[(0,o.bF)(L,{to:"/user/forgot",class:"font-medium text-indigo-600 hover:text-indigo-500"},{default:(0,o.k6)((()=>t[8]||(t[8]=[(0,o.eW)(" ลืมรหัสผ่าน ")]))),_:1})])]),(0,o.Lk)("div",null,[this.errorStage?((0,o.uX)(),(0,o.CE)("div",h,[(0,o.Lk)("div",k,[t[10]||(t[10]=(0,o.Lk)("div",{class:"font-semibold pt-3 pb-3"},"เกิดข้อผิดพลาด",-1)),(0,o.Lk)("div",v,(0,r.v_)(this.errorMessage),1)])])):(0,o.Q3)("",!0),t[11]||(t[11]=(0,o.Lk)("button",{type:"submit",class:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},"เข้าสู่ระบบ",-1))])],32)])])])])}s(64979);var w=s(40475),y=s(21396),L=s.n(y),S=s(63084),C=s(40471);const M=new C.A(!1);var A={name:"Login",components:{},props:{showModal:{type:Boolean,default:!1}},data(){return{configs:w.A.get("configs"),hostname:w.A.get("hostname"),email:"",password:"",errorStage:!1,errorMessage:""}},methods:{generateRandomString(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";const o=t.length;for(let i=0;i<e;i++)s+=t.charAt(Math.floor(Math.random()*o));return s},generateStateWithRedirect(e){const t={random:this.generateRandomString(12),redirect:e,siteID:this.configs.siteID};return btoa(JSON.stringify(t))},loginWithLine(){const e=this.configs.line?.client_id,t=encodeURIComponent(this.configs.line?.callback),s=this.generateStateWithRedirect("/user/profile"),o="profile openid",i="aggressive";window.location.href=`https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=${e}&redirect_uri=${t}&state=${s}&scope=${o}&bot_prompt=${i}`},async login(){try{this.activeBlock=!0;const e=await M.POST("user/query",{method:"find",args:[{$and:[{username:this.email}]}]},this.configs.key),t=e.data,s=t.length>0?t[0]:null;if(console.log("loginData",s),null===s||""===s||void 0===s)return this.errorStage=!0,this.errorMessage="ไม่พบข้อมูลบัญชีผู้ใช้นี้",void(this.activeBlock=!1);{const e=s.salt,t=L().SHA256(this.password+e).toString(),o=s.password;if(S.A.log(t,o),t===o)if("user"!=s.role)this.errorStage=!0,this.errorMessage="ไม่มีสิทธิ์เข้าใช้งานเว็บไซต์นี้";else{const e=await M.POST("enroll/query",{method:"find",hidden:["userID"],args:[{$and:[{userID:s._id}]}]},this.configs.key),t=e.data;if(200===e.status){let e=[],o="";const i={active:!0,token:s._id,refresh:"",login:!0,userID:s._id,user:s,loader:!1,role:s.role,nav:"normal-nav",layout:"frontend-layout",current:o,list:e,enroll:t,channel:"web"};w.A.update("session",i),S.A.log("session",i),this.showModal?window.location.reload():this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:500,icon:"success",title:"แจ้งเตือน",text:"เข้าสู่ระบบเรียบร้อยแล้ว"}).then((()=>{s.req_reset?window.location.href="/user/reset":window.location.href="/user/profile"}))}}else this.errorStage=!0,this.errorMessage="ชื่อผู้ใช้งานหรือรหัสผ่านไม่ถูกต้อง"}this.activeBlock=!1}catch(e){S.A.log(e)}}}},_=s(64621);const W=(0,_.A)(A,[["render",x]]);var $=W},2325:function(e,t,s){s.r(t),s.d(t,{default:function(){return ne}});var o=s(20641);function i(e,t,s,i,r,l){return(0,o.uX)(),(0,o.Wv)((0,o.$y)(l.componentName))}var r=s(52968),l=s(75220),n=s(40475),a=s(48783),d=s(90033),c=s(53751);const u={class:"bg-gray-50"},m={class:"flex min-h-full flex-col justify-center py-12 sm:px-6 lg:px-8"},g={class:"sm:mx-auto sm:w-full sm:max-w-lg"},f=["src"],b={class:"mt-6 text-center text-2xl font-bold tracking-tight text-gray-900"},p={class:"mt-2 text-center text-sm text-gray-600"},h={key:0,class:"mt-8 sm:mx-auto sm:w-full sm:max-w-md p-2"},k={class:"bg-white"},v={class:"grid grid-cols-1 gap-2 mt-4"},x={key:0,class:"mt-8 sm:mx-auto sm:w-full sm:max-w-md"},w={class:"relative mt-2"},y={class:"relative mt-2"},L={class:"flex items-center justify-between"},S={class:"text-sm"},C={key:0,class:"col-span-2"},M={class:"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5"},A={class:"w-full"},_={type:"submit",class:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},W={class:"relative mt-2"},$={key:0,class:"col-span-2"},F={class:"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5"},E={class:"w-full"},B={type:"submit",class:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},D={key:1,class:"mt-8 sm:mx-auto sm:w-full sm:max-w-md"},X={class:"relative mt-2"},U={class:"relative mt-2"},j={class:"flex items-center justify-between"},Q={class:"text-sm"},I={key:0,class:"col-span-2"},P={class:"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5"},q={class:"w-full"},J={type:"submit",class:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},R={class:"relative mt-2"},V={key:0,class:"col-span-2"},O={class:"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5"},T={class:"w-full"},N={type:"submit",class:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"};function H(e,t,s,i,r,l){const n=(0,o.g2)("router-link"),a=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",u,[(0,o.Lk)("div",m,[(0,o.Lk)("div",g,[this.showModal?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("img",{key:0,class:"mx-auto h-14 w-auto",src:this.configs.siteLogo,alt:"Your Company"},null,8,f)),(0,o.Lk)("h2",b,(0,d.v_)(r.newmember?"เข้าสูระบบสมาชิกใหม่":"เข้าสู่ระบบสมาชิกเก่า"),1),(0,o.Lk)("p",p,[t[19]||(t[19]=(0,o.eW)(" หรือ ")),(0,o.bF)(n,{to:"/user/register",class:"font-medium text-indigo-600 hover:text-indigo-500"},{default:(0,o.k6)((()=>t[18]||(t[18]=[(0,o.eW)(" ลงทะเบียนสมาชิกใหม่ ")]))),_:1})])]),r.showForm?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",h,[(0,o.Lk)("div",k,[(0,o.Lk)("div",v,[(0,o.Lk)("button",{onClick:t[0]||(t[0]=e=>{r.newmember=!1,l.toggleForm()}),class:"flex flex-col items-center justify-center px-4 py-4 rounded-md bg-white border-2 border-indigo-600 text-indigo-600 font-semibold w-full sm:w-auto"},[(0,o.bF)(a,{icon:["fas","key"],class:"h-10 w-10 mb-2"}),t[20]||(t[20]=(0,o.Lk)("span",{class:"text-2xl leading-6 text-center"},"สมาชิกเก่า",-1)),t[21]||(t[21]=(0,o.Lk)("span",{class:"font-normal text-black leading-6 text-center"},"ลงทะเบียนตั้งแต่ปี 65-66",-1))]),(0,o.Lk)("button",{onClick:t[1]||(t[1]=e=>{r.newmember=!0,l.toggleForm()}),class:"flex flex-col items-center justify-center px-4 py-4 rounded-md bg-white border-2 border-indigo-600 text-indigo-600 font-semibold w-full sm:w-auto"},[(0,o.bF)(a,{icon:["fas","key"],class:"h-10 w-10 mb-2"}),t[22]||(t[22]=(0,o.Lk)("span",{class:"text-2xl leading-6 text-center"},"สมาชิกใหม่",-1)),t[23]||(t[23]=(0,o.Lk)("span",{class:"font-normal text-black leading-6 text-center"},"ลงทะเบียนตั้งแต่ปี 67",-1))])])])])),r.showForm?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[r.newmember?((0,o.uX)(),(0,o.CE)("div",x,[(0,o.Lk)("div",{class:(0,d.C4)(["bg-white px-4 py-8 shadow sm:rounded-lg sm:px-10 relative",[r.activeBlock?"isblock":"isunblock"]]),"data-content":"กำลังติดต่อฐานข้อมูล กรุณารอสักครู่....."},["login"===r.memberMode?((0,o.uX)(),(0,o.CE)("form",{key:0,class:"space-y-6",onSubmit:t[6]||(t[6]=(0,c.D$)(((...e)=>l.login&&l.login(...e)),["prevent"]))},[(0,o.Lk)("div",null,[(0,o.Lk)("div",w,[t[24]||(t[24]=(0,o.Lk)("span",{class:"input-label"},[(0,o.eW)("อีเมล์ "),(0,o.Lk)("small",{class:"text-red-400"},"(*จำเป็นต้องกรอก)")],-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.username=e),type:"text",placeholder:"อีเมล์",class:"w-full p-4 border border-gray-200 text-sm"},null,512),[[c.Jo,r.username]])])]),(0,o.Lk)("div",null,[(0,o.Lk)("div",y,[t[25]||(t[25]=(0,o.Lk)("span",{class:"input-label"},[(0,o.eW)("รหัสผ่าน "),(0,o.Lk)("small",{class:"text-red-400"},"(*จำเป็นต้องกรอก)")],-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>r.password=e),type:"password",placeholder:"รหัสผ่าน",class:"w-full p-4 border border-gray-200 text-sm"},null,512),[[c.Jo,r.password]])])]),(0,o.Lk)("div",L,[t[26]||(t[26]=(0,o.Lk)("div",{class:"flex items-center"},[(0,o.Lk)("input",{id:"remember-me",name:"remember-me",type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,o.Lk)("label",{for:"remember-me",class:"ml-2 block text-sm text-gray-900"},"จำฉันไว้")],-1)),(0,o.Lk)("div",S,[(0,o.Lk)("button",{onClick:t[4]||(t[4]=e=>l.resetPassword("reset")),class:"font-medium text-indigo-600 hover:text-indigo-500"}," ลืมรหัสผ่าน ")])]),(0,o.Lk)("div",null,[this.errorStage?((0,o.uX)(),(0,o.CE)("div",C,[(0,o.Lk)("div",M,[t[27]||(t[27]=(0,o.Lk)("div",{class:"font-semibold pt-3 pb-3"},"เกิดข้อผิดพลาด",-1)),(0,o.Lk)("div",A,(0,d.v_)(this.errorMessage),1)])])):(0,o.Q3)("",!0),(0,o.Lk)("button",_,[(0,o.bF)(a,{icon:["fas","key"],class:"mr-2"}),t[28]||(t[28]=(0,o.eW)(" เข้าสู่ระบบ "))]),(0,o.Lk)("button",{onClick:t[5]||(t[5]=e=>{r.newmember=!1,l.toggleForm()}),class:"flex w-full justify-center rounded-md bg-gray-300 text-md font-semibold text-gray-700 shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600 mt-4 py-2"},"ย้อนกลับ")])],32)):(0,o.Q3)("",!0),"reset"===r.memberMode?((0,o.uX)(),(0,o.CE)("form",{key:1,class:"space-y-6",onSubmit:t[9]||(t[9]=(0,c.D$)(((...e)=>l.reset&&l.reset(...e)),["prevent"]))},[(0,o.Lk)("div",null,[(0,o.Lk)("div",W,[t[29]||(t[29]=(0,o.Lk)("span",{class:"input-label"},[(0,o.eW)("อีเมล์ที่ลงทะเบียน "),(0,o.Lk)("small",{class:"text-red-400"},"(*จำเป็นต้องกรอก)")],-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>r.username=e),type:"text",placeholder:"อีเมล์ที่ลงทะเบียน",class:"w-full p-4 border border-gray-200 text-sm"},null,512),[[c.Jo,r.username]])])]),t[32]||(t[32]=(0,o.Lk)("div",null,[(0,o.Lk)("strong",null,"*หมายเหตุ*"),(0,o.Lk)("br"),(0,o.eW)(' กรอกอีเมล์ที่ลงทะเบียนไว้ในระบบ หลังจากคลิ๊ก "ตั้งค่ารหัสผ่าน" เรียบร้อยแล้ว ระบบจะทำการสร้างรหัสผ่านเป็นเบอร์โทรที่ลงทะเบียนไว้ในระบบ หากจำเบอร์โทรไม่ได้ กรุณาแจ้งทีมงานที่ @doacer ')],-1)),(0,o.Lk)("div",null,[this.errorStage?((0,o.uX)(),(0,o.CE)("div",$,[(0,o.Lk)("div",F,[t[30]||(t[30]=(0,o.Lk)("div",{class:"font-semibold pt-3 pb-3"},"เกิดข้อผิดพลาด",-1)),(0,o.Lk)("div",E,(0,d.v_)(this.errorMessage),1)])])):(0,o.Q3)("",!0),(0,o.Lk)("button",B,[(0,o.bF)(a,{icon:["fas","refresh"],class:"mr-2"}),t[31]||(t[31]=(0,o.eW)(" ตั้งค่ารหัสผ่าน "))]),(0,o.Lk)("button",{onClick:t[8]||(t[8]=e=>l.resetPassword("login")),class:"flex w-full justify-center rounded-md bg-gray-300 text-md font-semibold text-gray-700 shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600 mt-4 py-2"},"ย้อนกลับ")])],32)):(0,o.Q3)("",!0)],2)])):(0,o.Q3)("",!0),r.newmember?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",D,[(0,o.Lk)("div",{class:(0,d.C4)(["bg-white px-4 py-8 shadow sm:rounded-lg sm:px-10 relative",[r.activeBlock?"isblock":"isunblock"]]),"data-content":"กำลังติดต่อฐานข้อมูล กรุณารอสักครู่....."},["login"===r.memberMode?((0,o.uX)(),(0,o.CE)("form",{key:0,class:"space-y-6",onSubmit:t[14]||(t[14]=(0,c.D$)(((...e)=>l.login&&l.login(...e)),["prevent"]))},[(0,o.Lk)("div",null,[(0,o.Lk)("div",X,[t[33]||(t[33]=(0,o.Lk)("span",{class:"input-label"},[(0,o.eW)("เลขที่ประจำตัวประชาชน "),(0,o.Lk)("small",{class:"text-red-400"},"(*จำเป็นต้องกรอก)")],-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>r.username=e),type:"text",placeholder:"เลขที่ประจำตัวประชาชน",class:"w-full p-4 border border-gray-200 text-sm"},null,512),[[c.Jo,r.username]])])]),(0,o.Lk)("div",null,[(0,o.Lk)("div",U,[t[34]||(t[34]=(0,o.Lk)("span",{class:"input-label"},[(0,o.eW)("รหัสผ่าน "),(0,o.Lk)("small",{class:"text-red-400"},"(*จำเป็นต้องกรอก)")],-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>r.password=e),type:"password",placeholder:"รหัสผ่าน",class:"w-full p-4 border border-gray-200 text-sm"},null,512),[[c.Jo,r.password]])])]),(0,o.Lk)("div",j,[t[35]||(t[35]=(0,o.Lk)("div",{class:"flex items-center"},[(0,o.Lk)("input",{id:"remember-me",name:"remember-me",type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,o.Lk)("label",{for:"remember-me",class:"ml-2 block text-sm text-gray-900"},"จำฉันไว้")],-1)),(0,o.Lk)("div",Q,[(0,o.Lk)("button",{onClick:t[12]||(t[12]=e=>l.resetPassword("reset")),class:"font-medium text-indigo-600 hover:text-indigo-500"}," ลืมรหัสผ่าน ")])]),(0,o.Lk)("div",null,[this.errorStage?((0,o.uX)(),(0,o.CE)("div",I,[(0,o.Lk)("div",P,[t[36]||(t[36]=(0,o.Lk)("div",{class:"font-semibold pt-3 pb-3"},"เกิดข้อผิดพลาด",-1)),(0,o.Lk)("div",q,(0,d.v_)(this.errorMessage),1)])])):(0,o.Q3)("",!0),(0,o.Lk)("button",J,[(0,o.bF)(a,{icon:["fas","key"],class:"mr-2"}),t[37]||(t[37]=(0,o.eW)(" เข้าสู่ระบบ "))]),(0,o.Lk)("button",{onClick:t[13]||(t[13]=e=>{r.newmember=!1,l.toggleForm()}),class:"flex w-full justify-center rounded-md bg-gray-300 text-md font-semibold text-gray-700 shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600 mt-4 py-2"},"ย้อนกลับ")])],32)):(0,o.Q3)("",!0),"reset"===r.memberMode?((0,o.uX)(),(0,o.CE)("form",{key:1,class:"space-y-6",onSubmit:t[17]||(t[17]=(0,c.D$)(((...e)=>l.reset&&l.reset(...e)),["prevent"]))},[(0,o.Lk)("div",null,[(0,o.Lk)("div",R,[t[38]||(t[38]=(0,o.Lk)("span",{class:"input-label"},[(0,o.eW)("เลขที่ประจำตัวประชาชน "),(0,o.Lk)("small",{class:"text-red-400"},"(*จำเป็นต้องกรอก)")],-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>r.username=e),type:"text",placeholder:"เลขที่ประจำตัวประชาชน",class:"w-full p-4 border border-gray-200 text-sm"},null,512),[[c.Jo,r.username]])])]),t[41]||(t[41]=(0,o.Lk)("div",null,[(0,o.Lk)("strong",null,"*หมายเหตุ*"),(0,o.Lk)("br"),(0,o.eW)(' กรอกเลขที่บัตรประชาชนที่ลงทะเบียนไว้ในระบบ หลังจากคลิ๊ก "ตั้งค่ารหัสผ่าน" เรียบร้อยแล้ว ระบบจะทำการสร้างรหัสผ่านเป็นเบอร์โทรที่ลงทะเบียนไว้ในระบบ หากจำเบอร์โทรไม่ได้ กรุณาแจ้งทีมงานที่ @doacer ')],-1)),(0,o.Lk)("div",null,[this.errorStage?((0,o.uX)(),(0,o.CE)("div",V,[(0,o.Lk)("div",O,[t[39]||(t[39]=(0,o.Lk)("div",{class:"font-semibold pt-3 pb-3"},"เกิดข้อผิดพลาด",-1)),(0,o.Lk)("div",T,(0,d.v_)(this.errorMessage),1)])])):(0,o.Q3)("",!0),(0,o.Lk)("button",N,[(0,o.bF)(a,{icon:["fas","refresh"],class:"mr-2"}),t[40]||(t[40]=(0,o.eW)(" ตั้งค่ารหัสผ่าน "))]),(0,o.Lk)("button",{onClick:t[16]||(t[16]=e=>l.resetPassword("login")),class:"flex w-full justify-center rounded-md bg-gray-300 text-md font-semibold text-gray-700 shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600 mt-4 py-2"},"ย้อนกลับ")])],32)):(0,o.Q3)("",!0)],2)]))],64)):(0,o.Q3)("",!0)])])}s(64979);var z=s(21396),K=s.n(z),Y=s(63084),G=s(40471),Z=s(73288);const ee=new G.A(!1);var te={name:"Login",components:{},props:{showModal:{type:Boolean,default:!1}},data(){return{configs:n.A.get("configs"),hostname:n.A.get("hostname"),username:"",password:"",errorStage:!1,errorMessage:"",newmember:!1,showForm:!1,activeBlock:!1,memberMode:"login"}},methods:{toggleForm(){this.showForm=!this.showForm},resetPassword(e){this.memberMode=e},generateRandomString(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";const o=t.length;for(let i=0;i<e;i++)s+=t.charAt(Math.floor(Math.random()*o));return s},generateStateWithRedirect(e){const t={random:this.generateRandomString(12),redirect:e,siteID:this.configs.siteID};return btoa(JSON.stringify(t))},loginWithLine(){const e=this.configs.line?.client_id,t=encodeURIComponent(this.configs.line?.callback),s=this.generateStateWithRedirect("/user/profile"),o="profile openid",i="aggressive";window.location.href=`https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=${e}&redirect_uri=${t}&state=${s}&scope=${o}&bot_prompt=${i}`},isValidEmail(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},transformUsername(e){const t=this.isValidEmail(e);e=t?e.toLowerCase().replace(/^\w/,(e=>e.toUpperCase())):e.replace(/^\w/,(e=>e.toUpperCase()));const s=e.replace(/^\w/,(e=>e.toLowerCase())),o=e.toLowerCase(),i=e.toUpperCase();return[e,s,o,i]},async login(){try{if(!this.username||!this.password)return this.errorStage=!0,this.errorMessage="โปรดกรอกชื่อผู้ใช้งานและรหัสผ่าน",void(this.activeBlock=!1);this.activeBlock=!0;const[e,t,s,o]=this.transformUsername(this.username),i=await ee.POST("user/query",{method:"find",args:[{$or:[{username:e},{username:t},{username:s},{username:o}]}]},this.configs.key),r=i.data,l=r.length>0?r[0]:null;if(Y.A.log("loginData",l),null===l||""===l||void 0===l)return this.errorStage=!0,this.errorMessage="ไม่พบข้อมูลบัญชีผู้ใช้นี้",void(this.activeBlock=!1);{const e=l.salt,t=K().SHA256(this.password+e).toString(),s=l.password;if(Y.A.log(t,s),t===s)if("user"!=l.role)this.errorStage=!0,this.activeBlock=!1,this.errorMessage="ไม่มีสิทธิ์เข้าใช้งานเว็บไซต์นี้";else{const e=await ee.POST("enroll/query",{method:"find",hidden:["userID"],args:[{$and:[{userID:l._id}]}]},this.configs.key),t=e.data;if(200===e.status){let e=[],s="";const o={active:!0,token:l._id,refresh:"",login:!0,userID:l._id,user:l,loader:!1,role:l.role,nav:"normal-nav",layout:"frontend-layout",current:s,list:e,enroll:t,channel:"web"};n.A.update("session",o),Y.A.log("session",o),this.showModal?window.location.reload():this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:500,icon:"success",title:"แจ้งเตือน",text:"เข้าสู่ระบบเรียบร้อยแล้ว"}).then((()=>{l.req_reset?window.location.href="/user/reset":window.location.href="/user/profile"}))}}else this.errorStage=!0,this.activeBlock=!1,this.errorMessage="ชื่อผู้ใช้งานหรือรหัสผ่านไม่ถูกต้อง"}}catch(e){Y.A.log(e)}},async reset(){try{this.errorStage=!1,this.activeBlock=!0;const[e,t,s,o]=this.transformUsername(this.username),i=await ee.POST("user/query",{method:"find",args:[{$or:[{username:e},{username:t},{username:s},{username:o}]}]},this.configs.key),r=i.data,l=r.length>0?r[0]:null;if(null===l||""===l||void 0===l)return this.errorStage=!0,this.errorMessage="ไม่พบข้อมูลบัญชีผู้ใช้นี้",void(this.activeBlock=!1);{const e=K().lib.WordArray.random(16),t=K().SHA256(l.phone+e).toString(),s={data:{password:t,salt:e.toString()}},{status:o}=await ee.PUT(`user/${l._id}`,s,this.configs.key);200===o&&(this.activeBlock=!1,Z.A.prompt({title:"รีเซ็ตรหัสผ่านเรียบร้อยแล้ว",message:"คุณสามารถใช้เบอร์โทรที่ลงทะเบียนไว้ ในการเข้าสู่ระบบ !",confirm:async()=>{this.newmember=!1,this.memberMode="login"},cancel:()=>{}}))}}catch(e){Y.A.log(e)}}}},se=s(64621);const oe=(0,se.A)(te,[["render",H],["__scopeId","data-v-53c35a02"]]);var ie=oe,re={name:"userLoginLoader",components:{},data(){return{session:n.A.get("session"),configs:n.A.get("configs")}},setup(){const e=(0,l.lq)(),t=e.meta.title;(0,r.K7)(t)},computed:{componentName(){return this.configs&&this.configs.layout&&this.configs.layout.userLogin&&"DOA"===this.configs.layout.userLogin?ie:a.A}}};const le=(0,se.A)(re,[["render",i]]);var ne=le}}]);
//# sourceMappingURL=2325.b025000c.js.map