"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[2336],{62336:function(e,t,a){a.r(t),a.d(t,{default:function(){return Qe}});var s=a(20641);function o(e,t,a,o,i,n){const l=(0,s.g2)("Category",!0);return this.login?((0,s.uX)(),(0,s.Wv)(l,{key:0})):(0,s.Q3)("",!0)}var i=a(52968),n=a(75220),l=(a(44114),a(90033)),r=a(53751);const c={class:"bg-white rounded-lg shadow-sm border border-gray-200"},d={class:"px-4 py-3 border-b border-gray-200"},g={class:"flex items-center justify-between"},u={class:"flex items-center space-x-3"},y={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center"},m={class:"text-xs text-gray-500"},x={class:"bg-gray-50 border-b border-gray-200 px-4 py-2"},b={class:"p-4"},f={key:0,class:"text-center py-8"},p={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},h={key:1,class:"space-y-3"},v={class:"grid grid-cols-1 lg:grid-cols-2 gap-3"},k={class:"p-4"},C={class:"flex items-start space-x-3 mb-3"},L={class:"flex-shrink-0"},w={class:"w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center group-hover:bg-blue-100 transition-colors duration-200"},_={class:"flex-1 min-w-0"},R={class:"text-base font-semibold text-gray-900 mb-1"},D={class:"text-xs text-gray-500 mb-1"},M={class:"text-sm text-gray-600"},F={class:"mb-3"},j={class:"flex items-center justify-between py-2 border-t border-gray-100"},S={class:"flex items-center space-x-2"},P=["onClick"],T=["onClick"],E={key:0,class:"overflow-hidden"},X={key:0,class:"space-y-2 pt-2"},I={class:"flex items-center justify-between mb-1"},U={class:"text-sm font-medium text-gray-900"},W={class:"flex items-center space-x-1"},Q=["onClick"],A=["onClick"],J=["onClick"],K={class:"text-xs text-gray-500 mb-1"},N={class:"text-xs text-gray-600"},O={key:1,class:"pt-2"},z={class:"flex items-center justify-between pt-3 border-t border-gray-100"},B={class:"flex items-center space-x-1"},V=["onClick"],H=["onClick"],q={class:"flex items-center space-x-1"},$=["onClick"],G=["onClick"],Y={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Z={class:"flex min-h-full items-center justify-center p-4"},ee={class:"relative bg-white rounded-xl shadow-xl max-w-md w-full p-5"},te={class:"flex items-center justify-between mb-4"},ae={class:"flex items-center space-x-2"},se={class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},oe={class:"text-xs text-gray-500"},ie={class:"space-y-3"},ne={class:"flex items-center space-x-2"},le={class:"flex justify-end space-x-2 mt-5"},re={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},ce={class:"flex min-h-full items-center justify-center p-4"},de={class:"relative bg-white rounded-xl shadow-xl max-w-md w-full p-5"},ge={class:"flex items-center justify-between mb-4"},ue={class:"flex items-center space-x-2"},ye={class:"w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center"},me={class:"space-y-3"},xe=["value"],be={class:"flex justify-end space-x-2 mt-5"},fe={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},pe={class:"flex min-h-full items-center justify-center p-4"},he={class:"relative bg-white rounded-xl shadow-xl max-w-md w-full p-5"},ve={class:"flex items-center justify-between mb-4"},ke={class:"flex items-center space-x-2"},Ce={class:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center"},Le={class:"flex justify-end space-x-2"},we={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},_e={class:"flex min-h-full items-center justify-center p-4"},Re={class:"relative bg-white rounded-xl shadow-xl max-w-md w-full p-5"},De={class:"flex items-center justify-between mb-4"},Me={class:"flex items-center space-x-2"},Fe={class:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center"},je={class:"flex justify-end space-x-2"};function Se(e,t,a,o,i,n){const Se=(0,s.g2)("font-awesome-icon");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[(0,s.Lk)("div",g,[(0,s.Lk)("div",u,[(0,s.Lk)("div",y,[(0,s.bF)(Se,{icon:["fas","folder"],class:"text-white text-sm"})]),(0,s.Lk)("div",null,[t[22]||(t[22]=(0,s.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"หมวดหมู่",-1)),(0,s.Lk)("p",m,(0,l.v_)(n.getMainCategories.length)+" หมวดหมู่หลัก",1)])]),(0,s.Lk)("button",{onClick:t[0]||(t[0]=e=>n.addCategory("main")),type:"button",class:"inline-flex items-center rounded-lg bg-blue-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200"},[(0,s.bF)(Se,{icon:["fas","plus"],class:"mr-1.5"}),t[23]||(t[23]=(0,s.eW)(" เพิ่มหมวดหมู่ "))])])]),(0,s.Lk)("div",x,[(0,s.Lk)("button",{onClick:t[1]||(t[1]=t=>e.$router.push("/lesson/home")),type:"button",class:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 transition-colors duration-200"},[(0,s.bF)(Se,{icon:["fas","chevron-left"],class:"mr-1.5 text-xs"}),t[24]||(t[24]=(0,s.eW)(" ย้อนกลับ "))])]),(0,s.Lk)("div",b,[0===n.getMainCategories.length?((0,s.uX)(),(0,s.CE)("div",f,[(0,s.Lk)("div",p,[(0,s.bF)(Se,{icon:["fas","folder"],class:"text-gray-400 text-lg"})]),t[26]||(t[26]=(0,s.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ยังไม่มีหมวดหมู่",-1)),t[27]||(t[27]=(0,s.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"เริ่มต้นสร้างหมวดหมู่สำหรับจัดระเบียบเนื้อหา",-1)),(0,s.Lk)("button",{onClick:t[2]||(t[2]=e=>n.addCategory("main")),type:"button",class:"inline-flex items-center rounded-lg bg-blue-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200"},[(0,s.bF)(Se,{icon:["fas","plus"],class:"mr-1.5"}),t[25]||(t[25]=(0,s.eW)(" สร้างหมวดหมู่แรก "))])])):((0,s.uX)(),(0,s.CE)("div",h,[(0,s.Lk)("div",v,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.flattenedCategories,(e=>((0,s.uX)(),(0,s.CE)(s.FK,null,["main"===e.type?((0,s.uX)(),(0,s.CE)("div",{key:e._id,class:"bg-white border border-gray-200 rounded-lg hover:shadow-md transition-all duration-200 group"},[(0,s.Lk)("div",k,[(0,s.Lk)("div",C,[(0,s.Lk)("div",L,[(0,s.Lk)("div",w,[(0,s.bF)(Se,{icon:["fas","folder"],class:"text-blue-600"})])]),(0,s.Lk)("div",_,[(0,s.Lk)("h3",R,(0,l.v_)(n.getMainCategoryIndex(e))+". "+(0,l.v_)(e.name),1),(0,s.Lk)("p",D,(0,l.v_)(e.code),1),(0,s.Lk)("p",M,(0,l.v_)(e.description),1)])]),(0,s.Lk)("div",F,[(0,s.Lk)("div",j,[(0,s.Lk)("div",S,[(0,s.Lk)("button",{onClick:t=>n.toggleSubcategories(e._id),class:"flex items-center space-x-2 text-sm text-gray-600 hover:text-gray-900 transition-colors duration-200"},[(0,s.bF)(Se,{icon:["fas",i.expandedCategories.includes(e._id)?"chevron-down":"chevron-right"],class:"text-xs transition-transform duration-200"},null,8,["icon"]),(0,s.Lk)("span",null,"หมวดหมู่ย่อย ("+(0,l.v_)(n.getSubcategories(e._id).length)+")",1)],8,P)]),(0,s.Lk)("button",{onClick:t=>n.addCategory("sub",e),class:"inline-flex items-center px-2 py-1 text-xs text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded transition-all duration-200"},[(0,s.bF)(Se,{icon:["fas","plus"],class:"mr-1 text-xs"}),t[28]||(t[28]=(0,s.eW)(" เพิ่ม "))],8,T)]),(0,s.bF)(r.eB,{"enter-active-class":"transition-all duration-300 ease-out","leave-active-class":"transition-all duration-300 ease-in","enter-from-class":"opacity-0 max-h-0","leave-to-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-96","leave-from-class":"opacity-100 max-h-96"},{default:(0,s.k6)((()=>[i.expandedCategories.includes(e._id)?((0,s.uX)(),(0,s.CE)("div",E,[n.getSubcategories(e._id).length>0?((0,s.uX)(),(0,s.CE)("div",X,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getSubcategories(e._id),(e=>((0,s.uX)(),(0,s.CE)("div",{key:e._id,class:"bg-gray-50 rounded-md p-3 border border-gray-100"},[(0,s.Lk)("div",I,[(0,s.Lk)("h4",U,(0,l.v_)(e.name),1),(0,s.Lk)("div",W,[(0,s.Lk)("button",{onClick:t=>n.openRenameDialog(e),class:"p-1 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded transition-all duration-200",title:"แก้ไข"},[(0,s.bF)(Se,{icon:["fas","edit"],class:"text-xs"})],8,Q),(0,s.Lk)("button",{onClick:t=>n.openMoveDialog(e),class:"p-1 text-gray-400 hover:text-amber-600 hover:bg-amber-50 rounded transition-all duration-200",title:"ย้าย"},[(0,s.bF)(Se,{icon:["fas","arrows-alt"],class:"text-xs"})],8,A),(0,s.Lk)("button",{onClick:t=>n.removeSubcategoryConfirmation(e),class:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-all duration-200",title:"ลบ"},[(0,s.bF)(Se,{icon:["fas","trash"],class:"text-xs"})],8,J)])]),(0,s.Lk)("p",K,(0,l.v_)(e.code),1),(0,s.Lk)("p",N,(0,l.v_)(e.description),1)])))),128))])):((0,s.uX)(),(0,s.CE)("div",O,t[29]||(t[29]=[(0,s.Lk)("div",{class:"text-center py-4 text-xs text-gray-500 bg-gray-50 rounded-md border border-gray-100"}," ยังไม่มีหมวดหมู่ย่อย ",-1)])))])):(0,s.Q3)("",!0)])),_:2},1024)]),(0,s.Lk)("div",z,[(0,s.Lk)("div",B,[(0,s.Lk)("button",{onClick:t=>n.moveMainCategoryUp(e),class:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-all duration-200",title:"เลื่อนขึ้น"},[(0,s.bF)(Se,{icon:["fas","chevron-up"],class:"text-xs"})],8,V),(0,s.Lk)("button",{onClick:t=>n.moveMainCategoryDown(e),class:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-all duration-200",title:"เลื่อนลง"},[(0,s.bF)(Se,{icon:["fas","chevron-down"],class:"text-xs"})],8,H)]),(0,s.Lk)("div",q,[(0,s.Lk)("button",{onClick:t=>n.openRenameDialog(e),class:"inline-flex items-center px-2 py-1 text-xs text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-all duration-200"},[(0,s.bF)(Se,{icon:["fas","edit"],class:"mr-1 text-xs"}),t[30]||(t[30]=(0,s.eW)(" แก้ไข "))],8,$),(0,s.Lk)("button",{onClick:t=>n.removeMainCategoryConfirmation(e),class:"inline-flex items-center px-2 py-1 text-xs text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-all duration-200"},[(0,s.bF)(Se,{icon:["fas","trash"],class:"mr-1 text-xs"}),t[31]||(t[31]=(0,s.eW)(" ลบ "))],8,G)])])])])):(0,s.Q3)("",!0)],64)))),256))])]))])]),(0,s.bF)(r.eB,{"enter-active-class":"modal-enter-active","leave-active-class":"modal-leave-active","enter-from-class":"modal-enter-from","leave-to-class":"modal-leave-to"},{default:(0,s.k6)((()=>[i.showRenameDialog?((0,s.uX)(),(0,s.CE)("div",Y,[(0,s.Lk)("div",Z,[(0,s.Lk)("div",{class:"fixed inset-0 bg-black bg-opacity-25 transition-opacity",onClick:t[3]||(t[3]=(...e)=>n.closeRenameDialog&&n.closeRenameDialog(...e))}),(0,s.Lk)("div",ee,[(0,s.Lk)("div",te,[(0,s.Lk)("div",ae,[(0,s.Lk)("div",se,[(0,s.bF)(Se,{icon:["fas","edit"],class:"text-blue-600 text-sm"})]),(0,s.Lk)("div",null,[t[32]||(t[32]=(0,s.Lk)("h3",{class:"text-base font-semibold text-gray-900"},"แก้ไขข้อมูล",-1)),(0,s.Lk)("p",oe,(0,l.v_)("main"===i.selectedCategory?.type?"หมวดหมู่หลัก":"หมวดหมู่ย่อย"),1)])]),(0,s.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>n.closeRenameDialog&&n.closeRenameDialog(...e)),class:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-all duration-200"},[(0,s.bF)(Se,{icon:["fas","times"],class:"text-sm"})])]),(0,s.Lk)("div",ie,[(0,s.Lk)("div",null,[t[33]||(t[33]=(0,s.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ชื่อ",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.selectedCategory.name=e),type:"text",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm",placeholder:"ระบุชื่อหมวดหมู่"},null,512),[[r.Jo,i.selectedCategory.name]])]),(0,s.Lk)("div",null,[t[34]||(t[34]=(0,s.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"รหัส",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.selectedCategory.code=e),type:"text",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm",placeholder:"ระบุรหัสหมวดหมู่"},null,512),[[r.Jo,i.selectedCategory.code]])]),(0,s.Lk)("div",null,[t[35]||(t[35]=(0,s.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"คำอธิบาย",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.selectedCategory.description=e),rows:"2",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 resize-none text-sm",placeholder:"ระบุคำอธิบายหมวดหมู่"},null,512),[[r.Jo,i.selectedCategory.description]])]),(0,s.Lk)("div",ne,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>i.selectedCategory.visible=e),type:"checkbox",id:"visible-checkbox",class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"},null,512),[[r.lH,i.selectedCategory.visible]]),t[36]||(t[36]=(0,s.Lk)("label",{for:"visible-checkbox",class:"text-xs font-medium text-gray-700"},"แสดงหมวดหมู่นี้",-1))])]),(0,s.Lk)("div",le,[(0,s.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>n.closeRenameDialog&&n.closeRenameDialog(...e)),class:"px-3 py-2 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200"}," ยกเลิก "),(0,s.Lk)("button",{onClick:t[10]||(t[10]=e=>n.renameCategory(i.selectedCategory)),class:"px-3 py-2 text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-all duration-200"}," บันทึก ")])])])])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(r.eB,{"enter-active-class":"modal-enter-active","leave-active-class":"modal-leave-active","enter-from-class":"modal-enter-from","leave-to-class":"modal-leave-to"},{default:(0,s.k6)((()=>[i.showMoveDialog?((0,s.uX)(),(0,s.CE)("div",re,[(0,s.Lk)("div",ce,[(0,s.Lk)("div",{class:"fixed inset-0 bg-black bg-opacity-25 transition-opacity",onClick:t[11]||(t[11]=(...e)=>n.closeMoveDialog&&n.closeMoveDialog(...e))}),(0,s.Lk)("div",de,[(0,s.Lk)("div",ge,[(0,s.Lk)("div",ue,[(0,s.Lk)("div",ye,[(0,s.bF)(Se,{icon:["fas","arrows-alt"],class:"text-amber-600 text-sm"})]),t[37]||(t[37]=(0,s.Lk)("div",null,[(0,s.Lk)("h3",{class:"text-base font-semibold text-gray-900"},"ย้ายหมวดหมู่"),(0,s.Lk)("p",{class:"text-xs text-gray-500"},"เลือกหมวดหมู่หลักใหม่")],-1))]),(0,s.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>n.closeMoveDialog&&n.closeMoveDialog(...e)),class:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-all duration-200"},[(0,s.bF)(Se,{icon:["fas","times"],class:"text-sm"})])]),(0,s.Lk)("div",me,[(0,s.Lk)("div",null,[t[39]||(t[39]=(0,s.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"หมวดหมู่หลัก",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>i.selectedCategoryParent=e),class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm"},[t[38]||(t[38]=(0,s.Lk)("option",{value:""},"เลือกหมวดหมู่หลัก",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getMainCategories,(e=>((0,s.uX)(),(0,s.CE)("option",{key:e._id,value:e._id},(0,l.v_)(e.name),9,xe)))),128))],512),[[r.u1,i.selectedCategoryParent]])])]),(0,s.Lk)("div",be,[(0,s.Lk)("button",{onClick:t[14]||(t[14]=(...e)=>n.closeMoveDialog&&n.closeMoveDialog(...e)),class:"px-3 py-2 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200"}," ยกเลิก "),(0,s.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>n.updateSelectedCategoryParent&&n.updateSelectedCategoryParent(...e)),class:"px-3 py-2 text-xs font-medium text-white bg-amber-600 hover:bg-amber-700 rounded-lg transition-all duration-200"}," ย้าย ")])])])])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(r.eB,{"enter-active-class":"modal-enter-active","leave-active-class":"modal-leave-active","enter-from-class":"modal-enter-from","leave-to-class":"modal-leave-to"},{default:(0,s.k6)((()=>[i.showConfirmationPopup?((0,s.uX)(),(0,s.CE)("div",fe,[(0,s.Lk)("div",pe,[(0,s.Lk)("div",{class:"fixed inset-0 bg-black bg-opacity-25 transition-opacity",onClick:t[16]||(t[16]=(...e)=>n.cancelRemoveMainCategory&&n.cancelRemoveMainCategory(...e))}),(0,s.Lk)("div",he,[(0,s.Lk)("div",ve,[(0,s.Lk)("div",ke,[(0,s.Lk)("div",Ce,[(0,s.bF)(Se,{icon:["fas","exclamation-triangle"],class:"text-red-600 text-sm"})]),t[40]||(t[40]=(0,s.Lk)("div",null,[(0,s.Lk)("h3",{class:"text-base font-semibold text-gray-900"},"ยืนยันการลบ"),(0,s.Lk)("p",{class:"text-xs text-gray-500"},"หมวดหมู่หลัก")],-1))])]),t[41]||(t[41]=(0,s.Lk)("div",{class:"mb-4"},[(0,s.Lk)("p",{class:"text-sm text-gray-600"},"คุณแน่ใจหรือไม่ที่จะลบหมวดหมู่หลักนี้? การดำเนินการนี้ไม่สามารถยกเลิกได้")],-1)),(0,s.Lk)("div",Le,[(0,s.Lk)("button",{onClick:t[17]||(t[17]=(...e)=>n.cancelRemoveMainCategory&&n.cancelRemoveMainCategory(...e)),class:"px-3 py-2 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200"}," ยกเลิก "),(0,s.Lk)("button",{onClick:t[18]||(t[18]=(...e)=>n.confirmRemoveMainCategory&&n.confirmRemoveMainCategory(...e)),class:"px-3 py-2 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-all duration-200"}," ลบ ")])])])])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(r.eB,{"enter-active-class":"modal-enter-active","leave-active-class":"modal-leave-active","enter-from-class":"modal-enter-from","leave-to-class":"modal-leave-to"},{default:(0,s.k6)((()=>[i.showSubcategoryConfirmationPopup?((0,s.uX)(),(0,s.CE)("div",we,[(0,s.Lk)("div",_e,[(0,s.Lk)("div",{class:"fixed inset-0 bg-black bg-opacity-25 transition-opacity",onClick:t[19]||(t[19]=(...e)=>n.cancelRemoveSubcategory&&n.cancelRemoveSubcategory(...e))}),(0,s.Lk)("div",Re,[(0,s.Lk)("div",De,[(0,s.Lk)("div",Me,[(0,s.Lk)("div",Fe,[(0,s.bF)(Se,{icon:["fas","exclamation-triangle"],class:"text-red-600 text-sm"})]),t[42]||(t[42]=(0,s.Lk)("div",null,[(0,s.Lk)("h3",{class:"text-base font-semibold text-gray-900"},"ยืนยันการลบ"),(0,s.Lk)("p",{class:"text-xs text-gray-500"},"หมวดหมู่ย่อย")],-1))])]),t[43]||(t[43]=(0,s.Lk)("div",{class:"mb-4"},[(0,s.Lk)("p",{class:"text-sm text-gray-600"},"คุณแน่ใจหรือไม่ที่จะลบหมวดหมู่ย่อยนี้? การดำเนินการนี้ไม่สามารถยกเลิกได้")],-1)),(0,s.Lk)("div",je,[(0,s.Lk)("button",{onClick:t[20]||(t[20]=(...e)=>n.cancelRemoveSubcategory&&n.cancelRemoveSubcategory(...e)),class:"px-3 py-2 text-xs font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200"}," ยกเลิก "),(0,s.Lk)("button",{onClick:t[21]||(t[21]=(...e)=>n.confirmRemoveSubcategory&&n.confirmRemoveSubcategory(...e)),class:"px-3 py-2 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-xl transition-all duration-200"}," ลบ ")])])])])):(0,s.Q3)("",!0)])),_:1})],64)}a(98992),a(54520),a(8872);var Pe=a(40475),Te={name:"CategoryList",components:{},data(){return{session:Pe.A.get("session"),configs:Pe.A.get("configs"),categories:[],uniqueIdCounter:5,showRenameDialog:!1,selectedCategory:null,newCategoryName:"",showMoveDialog:!1,selectedCategoryParent:null,showConfirmationPopup:!1,categoryToRemove:null,showSubcategoryConfirmationPopup:!1,subcategoryToRemove:null,rawData:"",tableHeaders:[],tableData:[],expandedCategories:[]}},computed:{flattenedCategories(){return this.flattenCategories(this.categories)},getMainCategories(){return this.categories.filter((e=>"main"===e.type))}},async mounted(){try{await this.getCategoryData()}catch(e){console.log(e)}},methods:{handleFileChange(e){const t=e.target.files[0],a=new FileReader;a.onload=e=>{this.rawData=e.target.result,this.convertToTable()},a.readAsText(t)},convertToTable(){const e=this.rawData.trim().split("\n");if(0===e.length)return;const t=[],a=e[0].trim().split(/\s+/);for(let s=1;s<e.length;s++){if(e[s].startsWith("H0000010140963012502"))continue;const a=e[s].trim(),o=a.indexOf("88011");if(-1===o)continue;const i=a.slice(0,o).trim(),n=a.slice(o).trim(),l=a.slice(o+1).trim().split(/\s+/);t.push([i,n,...l])}this.tableHeaders=a,this.tableData=t},async getCategoryData(){try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/category/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{unit:this.session.current._id}]}],paging:{page:1,limit:200}})});if(e.ok){const t=await e.json();console.log("finalRes",t),this.categories=t.data}}catch(e){console.error(e)}},async addCategory(e,t){try{console.log("category",t);const a={unit:this.session.current._id,name:"New Category",code:"category-code",description:"Description for New Category",type:"main",visible:!0,order:0};"sub"===e&&(a.type="sub",a.parent=t._id);const s=await fetch("https://gateway.cloudrestfulapi.com/api/category/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:a,options:{}})});if(s.ok){await this.getCategoryData();const e=await s.json();console.log("finalRes",e)}}catch(a){console.error(a)}},async updateCategory(e){try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/category/"+e._id,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{name:e.name,code:e.code,description:e.description,order:e.order,visible:e.visible},options:{}})});if(t.ok){await this.getCategoryData();const e=await t.json();console.log("finalRes",e)}}catch(t){console.error(t)}},async deleteCategory(e){try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/category/"+e._id,{method:"DELETE",headers:{"Content-Type":"application/json","client-token-key":this.configs.key}});if(t.ok){await this.getCategoryData();const e=await t.json();console.log("finalRes",e)}}catch(t){console.error(t)}},getMainCategoryIndex(e){const t=this.flattenedCategories.filter((e=>"main"===e.type));return t.findIndex((t=>t._id===e._id))+1},flattenCategories(e){return e.reduce(((e,t)=>{if(e.push(t),"main"===t.type){const a=this.categories.filter((e=>"sub"===e.type&&e.parent===t._id));e.push(...a)}return e}),[])},getSubcategories(e){return this.categories.filter((t=>"sub"===t.type&&t.parent===e))},moveMainCategoryUp(e){const t=this.categories.findIndex((t=>t._id===e._id&&"main"===t.type));if(t>0){const e=this.categories.splice(t,1)[0];this.categories.splice(t-1,0,e)}},moveMainCategoryDown(e){const t=this.categories.findIndex((t=>t._id===e._id&&"main"===t.type));if(t<this.categories.length-1){const e=this.categories.splice(t,1)[0];this.categories.splice(t+1,0,e)}},async removeMainCategoryConfirmation(e){this.categoryToRemove=e,this.showConfirmationPopup=!0},async confirmRemoveMainCategory(){try{const e=this.categoryToRemove,t=this.categories.findIndex((t=>t._id===e._id&&"main"===t.type));if(-1!==t){const a=this.categories.splice(t,1)[0],s=this.categories.filter((e=>"sub"===e.type&&e.parent===a._id));this.categories=this.categories.filter((e=>"sub"!==e.type||e.parent!==a._id));for(const e of s)await this.deleteCategory(e);await this.deleteCategory(e)}this.categoryToRemove=null,this.showConfirmationPopup=!1}catch(e){console.error(e)}},cancelRemoveMainCategory(){this.categoryToRemove=null,this.showConfirmationPopup=!1},async removeSubcategoryConfirmation(e){this.subcategoryToRemove=e,this.showSubcategoryConfirmationPopup=!0},async confirmRemoveSubcategory(){try{const e=this.subcategoryToRemove,t=this.categories.findIndex((t=>t._id===e._id&&"sub"===t.type));-1!==t&&(this.categories.splice(t,1),await this.deleteCategory(e)),this.subcategoryToRemove=null,this.showSubcategoryConfirmationPopup=!1}catch(e){console.error(e)}},cancelRemoveSubcategory(){this.subcategoryToRemove=null,this.showSubcategoryConfirmationPopup=!1},openRenameDialog(e){this.selectedCategory=e,this.showRenameDialog=!0},async renameCategory(e){try{await this.updateCategory(e),this.selectedCategory=null,this.showRenameDialog=!1}catch(t){console.error(t)}},closeRenameDialog(){this.selectedCategory=null,this.showRenameDialog=!1},openMoveDialog(e){this.selectedCategory=e,this.selectedCategoryParent=null,this.showMoveDialog=!0},async updateSelectedCategoryParent(){try{const e=this.selectedCategory,t=this.selectedCategoryParent;t&&(e.parent=t,await this.updateCategory(e)),this.selectedCategory=null,this.selectedCategoryParent=null,this.showMoveDialog=!1}catch(e){console.error(e)}},closeMoveDialog(){this.selectedCategory=null,this.selectedCategoryParent=null,this.showMoveDialog=!1},toggleSubcategories(e){this.expandedCategories.includes(e)?this.expandedCategories=this.expandedCategories.filter((t=>t!==e)):this.expandedCategories.push(e)}}},Ee=a(64621);const Xe=(0,Ee.A)(Te,[["render",Se],["__scopeId","data-v-4b068d3a"]]);var Ie=Xe,Ue={name:"Lesson Edit",components:{Category:Ie},data(){return{login:Pe.A.get("session","login")}},methods:{},setup(){const e=(0,n.lq)(),t=e.meta.title;(0,i.K7)(t)}};const We=(0,Ee.A)(Ue,[["render",o]]);var Qe=We}}]);
//# sourceMappingURL=2336.45ac184f.js.map