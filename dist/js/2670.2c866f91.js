"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[2670],{92670:function(t,e,s){s.r(e),s.d(e,{default:function(){return w}});var a=s(20641);function o(t,e,s,o,n,r){return(0,a.uX)(),(0,a.Wv)((0,a.$y)(r.componentName))}var n=s(52968),r=s(75220),c=s(40475),l=s(53751),i=s(90033);const u=["onClick"];function d(t,e,s,o,n,r){return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.Lk)("div",null,[(0,a.Lk)("div",null,[e[3]||(e[3]=(0,a.Lk)("label",{for:"start"},"Start Date:",-1)),(0,a.bo)((0,a.Lk)("input",{type:"datetime-local",id:"start","onUpdate:modelValue":e[0]||(e[0]=t=>n.start=t)},null,512),[[l.Jo,n.start]])]),(0,a.Lk)("div",null,[e[4]||(e[4]=(0,a.Lk)("label",{for:"end"},"End Date:",-1)),(0,a.bo)((0,a.Lk)("input",{type:"datetime-local",id:"end","onUpdate:modelValue":e[1]||(e[1]=t=>n.end=t)},null,512),[[l.Jo,n.end]])]),(0,a.Lk)("p",null,"Status: "+(0,i.v_)(n.status.status),1),(0,a.Lk)("p",null,"Message: "+(0,i.v_)(n.status.message),1),e[5]||(e[5]=(0,a.Lk)("hr",null,null,-1)),(0,a.Lk)("button",{onClick:e[2]||(e[2]=(...t)=>r.updateStatus&&r.updateStatus(...t))},"Calculate")]),(0,a.Lk)("table",null,[e[6]||(e[6]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"#"),(0,a.Lk)("th",null,"ID"),(0,a.Lk)("th",null,"score"),(0,a.Lk)("th",null,"User"),(0,a.Lk)("th",null,"Course"),(0,a.Lk)("th",null,"Date"),(0,a.Lk)("th",null,"#")])],-1)),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.duplicates,((t,e)=>((0,a.uX)(),(0,a.CE)("tr",{key:e},[(0,a.Lk)("td",null,(0,i.v_)(e+1),1),(0,a.Lk)("td",null,(0,i.v_)(t._id),1),(0,a.Lk)("td",null,(0,i.v_)(t.score),1),(0,a.Lk)("td",null,(0,i.v_)(t.userID),1),(0,a.Lk)("td",null,(0,i.v_)(t.courseID),1),(0,a.Lk)("td",null,[(0,a.Lk)("pre",null,(0,i.v_)(t.createdAt),1)]),(0,a.Lk)("td",null,[(0,a.Lk)("button",{onClick:e=>r.fetchEnrollData(t.userID,t.score,t._id)},"Get",8,u)])])))),128))])])])}s(44114),s(98992),s(54520),s(81454),s(37550);var h=s(40471),f=s(23324);const p=new h.A(!1);var g={data(){return{configs:c.A.get("configs"),session:c.A.get("session"),message:"Component with getForm function",loadStatus:!1,form:[],userIDsMap:{},duplicates:[],start:"2024-06-20T02:00:00.000",end:"",status:{status:"",message:""}}},methods:{updateStatus(){this.status=(0,f.rv)(this.start,this.end)},async getForm(){try{const t={method:"find",args:[{$and:[{courseID:"65d33ba369c3155dfd669617"}]}],paging:{page:1,limit:2e3}},{data:e,status:s}=await p.POST("form/query",t,this.configs.key);if(200!==s)throw new Error("Failed to fetch player data from API");this.form=e.data,this.loadStatus=!0}catch(t){throw console.error("An error occurred while fetching player data:",t),t}},async findDuplicates(){try{this.duplicates=[];for(const t of this.form){const e=t.userID;if(this.userIDsMap[e]){const s=this.userIDsMap[e],a=s.some((e=>e._id!==t._id));if(a){const e=s.findIndex((e=>e._id===t._id));-1!==e&&this.duplicates.push(s[e]),this.duplicates.push(t)}else s.push(t)}else this.userIDsMap[e]=[t]}}catch(t){throw console.error("An error occurred while finding duplicates:",t),t}},async batchChangeData(){try{for(const t of this.form){const e=await this.changeData(t._id);console.log("Form data updated successfully:",e)}this.getForm(),console.log("Batch update completed.")}catch(t){console.error("An error occurred during batch update:",t)}},async changeData(t){try{const e={data:{courseID:"65d33ba369c3155dfd669617"}},{data:s,status:a}=await p.PUT(`form/${t}`,e,this.configs.key);return console.log(a,s),!0}catch(e){throw console.error("An error occurred while changing data:",e),e}},async deleteData(t){try{const{data:e}=await p.DELETE(`form/${t}`,null,this.configs.key);console.log(e),await this.getForm(),this.findDuplicates()}catch(e){console.log(e)}},async updateScore(t){const e={data:{courseID:"662ed59188ed41e8351d2da4"}};try{const s=await this.$Request.PUT(`score/${t}`,e,this.configs.key),{data:a,status:o}=s;200===o?(console.log(`Successfully updated courseID for session ID: ${t}`),console.log("Updated Data:",a)):console.error(`Failed to update courseID for session ID: ${t}. Status: ${o}`)}catch(s){console.error(`Error updating courseID for session ID: ${t}`,s)}},async fetchEnrollData(t,e,s){const a=[{userID:t},{courseID:"662ed59188ed41e8351d2da4"}],o=[{$match:{$and:a}}];try{const t=await p.POST("enroll/aggregate",{pipeline:o},this.configs.key),a=t.data,n=a.map((t=>t.analytics.post&&null!==t.analytics.post.score?(this.updateScore(s),{...t,status:"hasdata"}):(this.updateAnalyticsPost(t._id,t.analytics,e),this.updateScore(s),{...t,status:"nodata"})));console.log("Filtered Data:",n)}catch(n){console.error("Failed to fetch data:",n)}},async updateAnalyticsPost(t,e,s){const a={has:!0,measure:"33",message:s<33?"ไม่ผ่านการรับรอง":"ผ่านการรับรอง",req:!0,result:s>=33,score:s,verified:"xxx"},o={...e,post:a};try{console.log(o),await p.PUT(`enroll/${t}`,{data:{analytics:o}},this.configs.key),console.log(`Updated item with ID: ${t}`)}catch(n){console.error(`Failed to update item with ID: ${t}`,n)}},async fetchData(){const t=[{examID:"65eb076bef03bebf9ead6f1c"},{courseID:"65d33ba369c3155dfd669617"}],e=[{$match:{$and:t}}];try{const t=await p.POST("score/aggregate",{pipeline:e},this.configs.key),s=t.data,a=s.filter((t=>{const e=new Date(t.createdAt);return e>=new Date("2024-06-21T00:00:00.000Z")&&e<new Date("2024-06-22T00:00:00.000Z")}));this.duplicates=a}catch(s){console.error("Failed to fetch data:",s)}}},mounted(){this.updateStatus(),this.fetchData()}},k=s(64621);const y=(0,k.A)(g,[["render",d]]);var D=y,m={name:"Lesson Detail",components:{Backend:D,Frontend:D},data(){return{session:c.A.get("session")}},setup(){const t=(0,r.lq)(),e=t.meta.title;(0,n.K7)(e)},computed:{componentName(){return"backend"===this.session.interface?"Backend":"frontend"===this.session.interface?"Frontend":(console.error("Invalid interface:",this.session.interface),null)}}};const L=(0,k.A)(m,[["render",o]]);var w=L},23324:function(t,e,s){function a(t){const e={timeZone:"Asia/Bangkok",hour12:!1};return new Date(t.toLocaleString("en-US",e))}function o(t,e){const s=Math.abs(e-t),a=Math.floor(s/864e5),o=Math.floor(s%864e5/36e5);return{days:a,hours:o}}function n(t,e=null){const s=a(new Date(t)),n=a(new Date);let r="",c="";if(e){const t=a(new Date(e));if(n>=s&&n<=t){const e=o(s,n),a=o(n,t);r="in",c=`เริ่มมาแล้ว ${e.days} วัน ${e.hours} ชั่วโมง จะจบในอีก ${a.days} วัน ${a.hours} ชั่วโมง`}else if(n<s){const t=o(n,s);r="not",c=`จะถึงในอีก ${t.days} วัน ${t.hours} ชั่วโมง`}else if(n>t){const e=o(t,n);r="over",c=`เกินกำหนดมา ${e.days} วัน ${e.hours} ชั่วโมง`}}else if(n<s){const t=o(n,s);r="not",c=`จะถึงในอีก ${t.days} วัน ${t.hours} ชั่วโมง`}else if(n>=s){const t=o(s,n);r="over",c=`เกินกำหนดมา ${t.days} วัน ${t.hours} ชั่วโมง`}return{status:r,message:c}}s.d(e,{rv:function(){return n}})}}]);
//# sourceMappingURL=2670.2c866f91.js.map