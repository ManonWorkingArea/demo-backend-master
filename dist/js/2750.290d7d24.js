"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[2750],{42750:function(e,s,t){t.r(s),t.d(s,{default:function(){return Te}});var r=t(20641);function o(e,s,t,o,l,a){const i=(0,r.g2)("List");return this.login?((0,r.uX)(),(0,r.Wv)(i,{key:0})):(0,r.Q3)("",!0)}var l=t(52968),a=t(75220),i=(t(44114),t(98992),t(54520),t(90033)),n=t(53751);const c={class:"bg-white rounded-lg shadow-sm border border-gray-200"},d={class:"px-4 py-3 border-b border-gray-200"},u={class:"flex items-center justify-between"},h={class:"flex items-center space-x-3"},g={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center"},p={class:"text-xs text-gray-500"},b={class:"bg-gray-50 border-b border-gray-200 px-4 py-2"},m={class:"p-4"},f={key:0,class:"text-center py-8"},x={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},k={key:1,class:"space-y-3"},y={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},w={class:"p-4 relative"},v={class:"absolute -top-8 left-4"},L={class:"w-16 h-16 bg-white rounded-full border-2 border-white shadow-lg overflow-hidden"},U=["src"],E={class:"pt-10"},C={class:"flex items-start justify-between mb-2"},D={class:"flex-1"},_={class:"text-base font-semibold text-gray-900 mb-1"},P={class:"text-xs text-gray-500 mb-1"},F={key:0,class:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-md inline-block"},V={class:"flex items-center justify-end pt-3 border-t border-gray-100 space-x-1"},j=["onClick"],T=["onClick"],X={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},A={class:"flex min-h-full items-center justify-center p-4"},$={class:"relative bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Q={class:"px-6 py-4 border-b border-gray-200"},M={class:"flex items-center justify-between"},I={class:"flex items-center space-x-3"},S={class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},J={class:"text-lg font-semibold text-gray-900"},W={class:"px-6 py-4 border-b border-gray-100"},O={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},K={class:"relative"},N={key:0,class:"absolute top-2.5 right-3"},q={key:0,class:"text-red-500 text-sm mt-1"},z={class:"relative"},B={key:0,class:"absolute top-2.5 right-3"},H={key:0,class:"text-red-500 text-sm mt-1"},R={class:"px-6 py-4"},Z={class:"space-y-4"},G={class:"relative"},Y=["disabled"],ee={key:0,class:"absolute top-2.5 right-3"},se={key:0,class:"text-red-500 text-sm mt-1"},te={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"flex items-center justify-between mb-2"},oe={class:"relative"},le=["type"],ae={key:0,class:"absolute top-2.5 right-3"},ie={class:"flex items-center justify-between mb-2"},ne={class:"relative"},ce=["type"],de={key:0,class:"absolute top-2.5 right-3"},ue={class:"col-span-full"},he={key:0,class:"text-red-500 text-sm"},ge={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-xl"},pe={class:"flex justify-end space-x-3"},be=["disabled"],me={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},fe={class:"flex min-h-full items-center justify-center p-4"},xe={class:"relative bg-white rounded-xl shadow-xl max-w-md w-full p-6"},ke={class:"flex items-center justify-between mb-4"},ye={class:"flex items-center space-x-3"},we={class:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center"},ve={class:"flex justify-end space-x-3"};function Le(e,s,t,o,l,a){const Le=(0,r.g2)("font-awesome-icon");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",c,[(0,r.Lk)("div",d,[(0,r.Lk)("div",u,[(0,r.Lk)("div",h,[(0,r.Lk)("div",g,[(0,r.bF)(Le,{icon:["fas","users-cog"],class:"text-white text-sm"})]),(0,r.Lk)("div",null,[s[22]||(s[22]=(0,r.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"เจ้าหน้าที่",-1)),(0,r.Lk)("p",p,(0,i.v_)(l.users.filter((e=>"manager"===e.role)).length)+" เจ้าหน้าที่",1)])]),(0,r.Lk)("button",{onClick:s[0]||(s[0]=e=>a.openUserDialog(null)),type:"button",class:"inline-flex items-center rounded-lg bg-blue-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200"},[(0,r.bF)(Le,{icon:["fas","plus"],class:"mr-1.5"}),s[23]||(s[23]=(0,r.eW)(" เพิ่มเจ้าหน้าที่ "))])])]),(0,r.Lk)("div",b,[(0,r.Lk)("button",{onClick:s[1]||(s[1]=s=>e.$router.push("/setup/dashboard")),type:"button",class:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 transition-colors duration-200"},[(0,r.bF)(Le,{icon:["fas","chevron-left"],class:"mr-1.5 text-xs"}),s[24]||(s[24]=(0,r.eW)(" ย้อนกลับ "))])]),(0,r.Lk)("div",m,[0===l.users.filter((e=>"manager"===e.role)).length?((0,r.uX)(),(0,r.CE)("div",f,[(0,r.Lk)("div",x,[(0,r.bF)(Le,{icon:["fas","users-cog"],class:"text-gray-400 text-lg"})]),s[26]||(s[26]=(0,r.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ยังไม่มีเจ้าหน้าที่",-1)),s[27]||(s[27]=(0,r.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"เริ่มต้นเพิ่มเจ้าหน้าที่สำหรับจัดการระบบ",-1)),(0,r.Lk)("button",{onClick:s[2]||(s[2]=e=>a.openUserDialog(null)),type:"button",class:"inline-flex items-center rounded-lg bg-blue-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200"},[(0,r.bF)(Le,{icon:["fas","plus"],class:"mr-1.5"}),s[25]||(s[25]=(0,r.eW)(" เพิ่มเจ้าหน้าที่คนแรก "))])])):((0,r.uX)(),(0,r.CE)("div",k,[(0,r.Lk)("div",y,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.users,((e,t)=>((0,r.uX)(),(0,r.CE)(r.FK,{key:t},["manager"===e.role?((0,r.uX)(),(0,r.CE)("div",{key:e._id,class:"bg-white border border-gray-200 rounded-lg hover:shadow-md transition-all duration-200 group overflow-hidden"},[s[30]||(s[30]=(0,r.Lk)("div",{class:"h-20 bg-gradient-to-br from-blue-500 to-blue-600 relative"},[(0,r.Lk)("div",{class:"absolute inset-0 bg-black bg-opacity-10"})],-1)),(0,r.Lk)("div",w,[(0,r.Lk)("div",v,[(0,r.Lk)("div",L,[(0,r.Lk)("img",{src:e.logo||"https://dummyimage.com/400x400/dbdbdb/6e6e6e.jpg&text=++USER++",alt:"Avatar",class:"w-full h-full object-cover"},null,8,U)])]),(0,r.Lk)("div",E,[(0,r.Lk)("div",C,[(0,r.Lk)("div",D,[(0,r.Lk)("h3",_,(0,i.v_)(e.firstname)+" "+(0,i.v_)(e.lastname),1),(0,r.Lk)("p",P,(0,i.v_)(e.email),1),e&&e.unit&&e.unit.length>0?((0,r.uX)(),(0,r.CE)("div",F,[(0,r.bF)(Le,{icon:["fas","graduation-cap"],class:"mr-1"}),(0,r.eW)(" "+(0,i.v_)(e.unit.length)+" หลักสูตร ",1)])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",V,[(0,r.Lk)("button",{onClick:s=>a.openUserDialog(e),class:"inline-flex items-center px-2 py-1 text-xs text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-all duration-200"},[(0,r.bF)(Le,{icon:["fas","edit"],class:"mr-1 text-xs"}),s[28]||(s[28]=(0,r.eW)(" แก้ไข "))],8,j),(0,r.Lk)("button",{onClick:s=>a.deleteUserConfirmation(e),class:"inline-flex items-center px-2 py-1 text-xs text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-all duration-200"},[(0,r.bF)(Le,{icon:["fas","trash"],class:"mr-1 text-xs"}),s[29]||(s[29]=(0,r.eW)(" ลบ "))],8,T)])])])])):(0,r.Q3)("",!0)],64)))),128))])]))])]),(0,r.bF)(n.eB,{"enter-active-class":"modal-enter-active","leave-active-class":"modal-leave-active","enter-from-class":"modal-enter-from","leave-to-class":"modal-leave-to"},{default:(0,r.k6)((()=>[l.showUserDialog?((0,r.uX)(),(0,r.CE)("div",X,[(0,r.Lk)("div",A,[(0,r.Lk)("div",{class:"fixed inset-0 bg-black bg-opacity-25 transition-opacity",onClick:s[3]||(s[3]=(...e)=>a.closeUserDialog&&a.closeUserDialog(...e))}),(0,r.Lk)("div",$,[(0,r.Lk)("div",Q,[(0,r.Lk)("div",M,[(0,r.Lk)("div",I,[(0,r.Lk)("div",S,[(0,r.bF)(Le,{icon:["fas",l.selectedUser._id?"edit":"plus"],class:"text-blue-600 text-sm"},null,8,["icon"])]),(0,r.Lk)("div",null,[(0,r.Lk)("h3",J,(0,i.v_)(l.selectedUser._id?"แก้ไขข้อมูลเจ้าหน้าที่":"เพิ่มเจ้าหน้าที่ใหม่"),1),s[31]||(s[31]=(0,r.Lk)("p",{class:"text-sm text-gray-500"},"จัดการข้อมูลส่วนตัวและบัญชีผู้ใช้",-1))])]),(0,r.Lk)("button",{onClick:s[4]||(s[4]=(...e)=>a.closeUserDialog&&a.closeUserDialog(...e)),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200"},[(0,r.bF)(Le,{icon:["fas","times"],class:"text-lg"})])])]),(0,r.Lk)("div",W,[s[36]||(s[36]=(0,r.Lk)("h4",{class:"text-base font-semibold text-gray-900 mb-4"},"ข้อมูลส่วนตัว",-1)),(0,r.Lk)("div",O,[(0,r.Lk)("div",null,[s[32]||(s[32]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ชื่อ",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":s[5]||(s[5]=e=>l.selectedUser.firstname=e),type:"text",placeholder:"กรอกชื่อ",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"},null,512),[[n.Jo,l.selectedUser.firstname]])]),(0,r.Lk)("div",null,[s[33]||(s[33]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"นามสกุล",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":s[6]||(s[6]=e=>l.selectedUser.lastname=e),type:"text",placeholder:"กรอกนามสกุล",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"},null,512),[[n.Jo,l.selectedUser.lastname]])]),(0,r.Lk)("div",null,[s[34]||(s[34]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"อีเมล",-1)),(0,r.Lk)("div",K,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":s[7]||(s[7]=e=>l.selectedUser.email=e),onInput:s[8]||(s[8]=e=>a.checkField("email",l.selectedUser.email,/^[^\s@]+@[^\s@]+\.[^\s@]+$/,"กรุณากรอกอีเมล์ให้ถูกต้อง","emailExists","emailValid")),type:"email",placeholder:"กรอกอีเมล",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"},null,544),[[n.Jo,l.selectedUser.email]]),l.emailValid?((0,r.uX)(),(0,r.CE)("span",N,[(0,r.bF)(Le,{icon:["fas","check-circle"],class:"text-green-500"})])):(0,r.Q3)("",!0)]),l.emailExists?((0,r.uX)(),(0,r.CE)("p",q,(0,i.v_)(l.emailError),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[s[35]||(s[35]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"เบอร์โทร",-1)),(0,r.Lk)("div",z,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":s[9]||(s[9]=e=>l.selectedUser.phone=e),onInput:s[10]||(s[10]=e=>a.checkField("phone",l.selectedUser.phone,/^[\d]{10}$/,"กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง","phoneExists","phoneValid")),type:"tel",placeholder:"กรอกเบอร์โทรศัพท์",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"},null,544),[[n.Jo,l.selectedUser.phone]]),l.phoneValid?((0,r.uX)(),(0,r.CE)("span",B,[(0,r.bF)(Le,{icon:["fas","check-circle"],class:"text-green-500"})])):(0,r.Q3)("",!0)]),l.phoneExists?((0,r.uX)(),(0,r.CE)("p",H,(0,i.v_)(l.phoneError),1)):(0,r.Q3)("",!0)])])]),(0,r.Lk)("div",R,[s[40]||(s[40]=(0,r.Lk)("h4",{class:"text-base font-semibold text-gray-900 mb-4"},"บัญชีผู้ใช้งาน",-1)),(0,r.Lk)("div",Z,[(0,r.Lk)("div",null,[s[37]||(s[37]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ชื่อผู้ใช้งาน",-1)),(0,r.Lk)("div",G,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":s[11]||(s[11]=e=>l.selectedUser.username=e),disabled:l.selectedUser._id,onInput:s[12]||(s[12]=e=>a.checkField("username",l.selectedUser.username,/^[a-zA-Z0-9_-]{6,}$/,"ชื่อผู้ใช้งานต้องมีอย่างน้อย 6 ตัวอักษรและเป็นอักษรหรือตัวเลขเท่านั้น","usernameExists","usernameValid")),type:"text",placeholder:"กรอกชื่อผู้ใช้งาน",class:(0,i.C4)([{"bg-gray-100 text-gray-500":l.selectedUser._id},"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"])},null,42,Y),[[n.Jo,l.selectedUser.username]]),l.usernameValid?((0,r.uX)(),(0,r.CE)("span",ee,[(0,r.bF)(Le,{icon:["fas","check-circle"],class:"text-green-500"})])):(0,r.Q3)("",!0)]),l.usernameExists?((0,r.uX)(),(0,r.CE)("p",se,(0,i.v_)(l.usernameError),1)):(0,r.Q3)("",!0)]),l.selectedUser._id?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",te,[(0,r.Lk)("div",null,[(0,r.Lk)("div",re,[s[38]||(s[38]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700"},"รหัสผ่าน",-1)),(0,r.Lk)("button",{onClick:s[13]||(s[13]=e=>l.showPassword=!l.showPassword),class:"text-xs text-blue-600 hover:text-blue-700"},(0,i.v_)(l.showPassword?"ซ่อน":"แสดง"),1)]),(0,r.Lk)("div",oe,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":s[14]||(s[14]=e=>l.selectedUser.password=e),type:l.showPassword?"text":"password",placeholder:"กรอกรหัสผ่าน",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"},null,8,le),[[n.hp,l.selectedUser.password]]),l.passwordsMatch&&l.selectedUser.password?((0,r.uX)(),(0,r.CE)("span",ae,[(0,r.bF)(Le,{icon:["fas","check-circle"],class:"text-green-500"})])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",null,[(0,r.Lk)("div",ie,[s[39]||(s[39]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700"},"ยืนยันรหัสผ่าน",-1)),(0,r.Lk)("button",{onClick:s[15]||(s[15]=e=>l.showPassword=!l.showPassword),class:"text-xs text-blue-600 hover:text-blue-700"},(0,i.v_)(l.showPassword?"ซ่อน":"แสดง"),1)]),(0,r.Lk)("div",ne,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":s[16]||(s[16]=e=>l.selectedUser.cpassword=e),type:l.showPassword?"text":"password",placeholder:"กรอกรหัสผ่านอีกครั้ง",class:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"},null,8,ce),[[n.hp,l.selectedUser.cpassword]]),l.passwordsMatch&&l.selectedUser.cpassword?((0,r.uX)(),(0,r.CE)("span",de,[(0,r.bF)(Le,{icon:["fas","check-circle"],class:"text-green-500"})])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",ue,[!l.passwordsMatch&&l.selectedUser.password&&l.selectedUser.cpassword?((0,r.uX)(),(0,r.CE)("p",he,"รหัสผ่านไม่ตรงกัน")):(0,r.Q3)("",!0)])]))])]),(0,r.Lk)("div",ge,[(0,r.Lk)("div",pe,[(0,r.Lk)("button",{onClick:s[17]||(s[17]=(...e)=>a.closeUserDialog&&a.closeUserDialog(...e)),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200"}," ยกเลิก "),(0,r.Lk)("button",{onClick:s[18]||(s[18]=e=>l.selectedUser._id?a.updateUser():a.addUser()),disabled:!(l.usernameValid&&l.passwordsMatch),class:(0,i.C4)([{"bg-blue-600 hover:bg-blue-700 text-white":l.usernameValid&&l.passwordsMatch,"bg-gray-300 text-gray-500 cursor-not-allowed":!(l.usernameValid&&l.passwordsMatch)},"px-4 py-2 text-sm font-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200"])},[(0,r.bF)(Le,{icon:["fas","save"],class:"mr-2"}),(0,r.eW)(" "+(0,i.v_)(l.selectedUser._id?"บันทึกการแก้ไข":"เพิ่มเจ้าหน้าที่"),1)],10,be)])])])])])):(0,r.Q3)("",!0)])),_:1}),(0,r.bF)(n.eB,{"enter-active-class":"modal-enter-active","leave-active-class":"modal-leave-active","enter-from-class":"modal-enter-from","leave-to-class":"modal-leave-to"},{default:(0,r.k6)((()=>[l.showConfirmationPopup?((0,r.uX)(),(0,r.CE)("div",me,[(0,r.Lk)("div",fe,[(0,r.Lk)("div",{class:"fixed inset-0 bg-black bg-opacity-25 transition-opacity",onClick:s[19]||(s[19]=(...e)=>a.cancelDeleteUser&&a.cancelDeleteUser(...e))}),(0,r.Lk)("div",xe,[(0,r.Lk)("div",ke,[(0,r.Lk)("div",ye,[(0,r.Lk)("div",we,[(0,r.bF)(Le,{icon:["fas","exclamation-triangle"],class:"text-red-600"})]),s[41]||(s[41]=(0,r.Lk)("div",null,[(0,r.Lk)("h3",{class:"text-lg font-semibold text-gray-900"},"ยืนยันการลบ"),(0,r.Lk)("p",{class:"text-sm text-gray-500"},"เจ้าหน้าที่")],-1))])]),s[42]||(s[42]=(0,r.Lk)("div",{class:"mb-6"},[(0,r.Lk)("p",{class:"text-gray-600"},"คุณแน่ใจหรือไม่ที่จะลบเจ้าหน้าที่นี้? การดำเนินการนี้ไม่สามารถยกเลิกได้")],-1)),(0,r.Lk)("div",ve,[(0,r.Lk)("button",{onClick:s[20]||(s[20]=(...e)=>a.cancelDeleteUser&&a.cancelDeleteUser(...e)),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200"}," ยกเลิก "),(0,r.Lk)("button",{onClick:s[21]||(s[21]=(...e)=>a.confirmDeleteUser&&a.confirmDeleteUser(...e)),class:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all duration-200"}," ลบ ")])])])])):(0,r.Q3)("",!0)])),_:1})],64)}var Ue=t(40475),Ee=t(21396),Ce=t.n(Ee),De={name:"UserList",data(){return{session:Ue.A.get("session"),configs:Ue.A.get("configs"),selectedUser:{},showUserDialog:!1,users:[],passwordsMatch:!1,showPassword:!1,showConfirmationPopup:!1,userToDelete:null,usernameExists:!1,usernameValid:!1,usernameError:"",emailExists:!1,emailValid:!1,emailError:"",phoneExists:!1,phoneValid:!1,phoneError:""}},async mounted(){try{await this.getUserData()}catch(e){console.error(e)}},watch:{"selectedUser.password"(e){this.selectedUser._id||this.checkPasswordMatch(e,this.selectedUser.cpassword)},"selectedUser.cpassword"(e){this.selectedUser._id||this.checkPasswordMatch(this.selectedUser.password,e)}},methods:{showPasswordToggle(){this.showPassword=!this.showPassword},checkPasswordMatch(e,s){this.passwordsMatch=e===s},async getUserData(){try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/user/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{parent:this.configs.siteID,role:"manager"}]}],paging:{page:1,limit:200}})});e.ok?this.users=(await e.json()).data:console.error("API error:",e.status,e.statusText)}catch(e){console.error(e)}},async checkField(e,s,t,r,o,l){console.log(`check${e}`),this.validateField(e,s,t,r,o,l),this[`${e}Error`]||await this.checkFieldExists(e,s,o,l)},validateField(e,s,t,r,o,l){const a=t.test(s);a?(this[`${e}Error`]="",this[o]=!1,this[l]=!0):(this[`${e}Error`]=r,this[o]=!0)},async checkFieldExists(e,s,t,r){try{const o=await fetch("https://gateway.cloudrestfulapi.com/api/user/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{[e]:s}]}],paging:{page:1,limit:200}})});if(o.ok){const s=(await o.json()).data;s.length>0?(this[t]=!0,this[`${e}Error`]=`มี ${e} นี้ในระบบแล้ว`,this[r]=!1):(this[t]=!1,this[`${e}Error`]="",this[r]=!0)}else console.error("API error:",o.status,o.statusText)}catch(o){console.error(o)}},async addUser(){try{const e=Ce().lib.WordArray.random(16),s=Ce().SHA256(this.selectedUser.password+e).toString(),t=[this.session.current._id],r=await fetch("https://gateway.cloudrestfulapi.com/api/user/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{...this.selectedUser,parent:this.configs.siteID,role:"manager",password:s,salt:e.toString(),unit:t},options:{}})});r.ok?(await this.getUserData(),this.closeUserDialog()):console.error("API error:",r.status,r.statusText)}catch(e){console.error(e)}},async updateUser(){try{const e=await fetch(`https://gateway.cloudrestfulapi.com/api/user/${this.selectedUser._id}`,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{firstname:this.selectedUser.firstname,lastname:this.selectedUser.lastname},options:{}})});e.ok?(await this.getUserData(),this.closeUserDialog()):console.error("API error:",e.status,e.statusText)}catch(e){console.error(e)}},async deleteUser(e){try{const s=await fetch(`https://gateway.cloudrestfulapi.com/api/user/${e._id}`,{method:"DELETE",headers:{"Content-Type":"application/json","client-token-key":this.configs.key}});s.ok?await this.getUserData():console.error("API error:",s.status,s.statusText)}catch(s){console.error(s)}},deleteUserConfirmation(e){this.userToDelete=e,this.showConfirmationPopup=!0},async confirmDeleteUser(){this.userToDelete&&(await this.deleteUser(this.userToDelete),this.userToDelete=null),this.showConfirmationPopup=!1},cancelDeleteUser(){this.userToDelete=null,this.showConfirmationPopup=!1},openUserDialog(e){this.selectedUser={...e},e?(this.passwordsMatch=!0,this.usernameValid=!0):(this.passwordsMatch=!1,this.usernameValid=!1),this.showUserDialog=!0,this.showPassword=!1,this.usernameExists=!1,this.usernameError="",this.emailExists=!1,this.emailValid=!1,this.emailError="",this.phoneExists=!1,this.phoneValid=!1,this.phoneError=""},closeUserDialog(){this.selectedUser={},this.showUserDialog=!1,this.passwordsMatch=!1,this.showPassword=!1,this.usernameExists=!1,this.usernameValid=!1,this.usernameError="",this.emailExists=!1,this.emailValid=!1,this.emailError="",this.phoneExists=!1,this.phoneValid=!1,this.phoneError=""}}},_e=t(64621);const Pe=(0,_e.A)(De,[["render",Le],["__scopeId","data-v-3057f9e1"]]);var Fe=Pe,Ve={name:"AdminList",components:{List:Fe},data(){return{login:Ue.A.get("session","login")}},methods:{showAlert(){this.$swal("Hello Vue world!!!")}},setup(){const e=(0,a.lq)(),s=e.meta.title;(0,l.K7)(s)}};const je=(0,_e.A)(Ve,[["render",o]]);var Te=je}}]);
//# sourceMappingURL=2750.290d7d24.js.map