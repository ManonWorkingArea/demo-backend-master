"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[2774],{62291:function(e,t,s){s.d(t,{A:function(){return ot}});var l=s(20641),a=s(90033),o=s(53751);const i={class:"bg-gray-50 flex collection-container h-full"},r={class:"hidden lg:flex lg:w-64 lg:flex-col"},n={class:"flex flex-col flex-grow bg-white border-r border-gray-200 h-full"},c={class:"flex items-center justify-between px-4 py-4 border-b border-gray-200 flex-shrink-0"},d={class:"px-4 py-4 border-b border-gray-200"},u={class:"grid grid-cols-2 gap-3"},g={class:"bg-blue-50 rounded-lg p-3"},h={class:"text-blue-900 text-lg font-bold"},p={class:"bg-green-50 rounded-lg p-3"},b={class:"text-green-900 text-lg font-bold"},k={class:"px-4 py-3 border-b border-gray-200"},f={class:"relative"},y={class:"px-4 py-4 border-b border-gray-200"},m={class:"space-y-1"},x=["onClick"],v={class:"flex items-center gap-3"},w={class:"bg-gray-200 text-gray-700 px-2 py-1 rounded-full text-xs"},C={class:"px-4 py-4"},L={class:"flex-1 flex flex-col min-w-0 h-full"},_={class:"lg:hidden bg-white border-b border-gray-200 px-4 py-3"},A={class:"flex items-center justify-between"},S={class:"bg-white border-b border-gray-200 px-4 py-3"},E={class:"flex items-center justify-between"},T={class:"flex items-center gap-4"},M=["disabled"],$={class:"hidden sm:inline"},I={class:"flex bg-gray-100 rounded-lg p-1"},D={class:"flex-1 p-4 overflow-auto"},F={key:0,class:"flex items-center justify-center py-20"},j={key:1,class:"mb-4"},P={class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},X={class:"block sm:inline"},N={key:2,class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4"},U={class:"flex items-center justify-between"},O={class:"text-blue-800 font-medium"},B={class:"flex items-center gap-3"},H={key:3},R={key:0,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},V={class:"absolute top-2 left-2 z-10"},W=["checked","onClick"],z={class:"absolute top-2 right-2 z-10"},q=["onClick"],J={key:0,class:"absolute right-0 mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 dropdown-menu z-20"},Q=["onClick"],G={class:"relative h-32 bg-gray-100"},K=["src","alt"],Z={key:1,class:"w-full h-full flex items-center justify-center"},Y={class:"absolute bottom-2 left-2"},ee={class:"p-4"},te={class:"font-medium text-gray-900 truncate"},se={class:"text-sm text-gray-600 truncate mt-1"},le={key:0,class:"mt-2"},ae={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"},oe={class:"text-xs text-gray-500 mt-1"},ie={class:"flex items-center justify-between mt-3"},re={class:"text-xs text-gray-500"},ne={class:"text-xs text-gray-500"},ce={key:1,class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},de={class:"overflow-x-auto"},ue={class:"min-w-full divide-y divide-gray-200"},ge={class:"bg-gray-50"},he={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},pe={class:"bg-white divide-y divide-gray-200"},be={class:"px-6 py-4 whitespace-nowrap"},ke=["checked","onChange"],fe={class:"px-6 py-4 whitespace-nowrap"},ye={class:"flex items-center"},me={class:"ml-4"},xe={class:"text-sm font-medium text-gray-900"},ve={class:"text-sm text-gray-500"},we={class:"px-6 py-4 whitespace-nowrap"},Ce={class:"px-6 py-4 whitespace-nowrap"},Le={key:0,class:"flex items-center"},_e={class:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800"},Ae={class:"ml-2 text-xs text-gray-500"},Se={key:1,class:"text-sm text-gray-400"},Ee={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Te={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Me={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},$e=["onClick"],Ie={key:2,class:"text-center py-12"},De={class:"flex flex-col h-full"},Fe={class:"flex items-center justify-between px-4 py-4 border-b border-gray-200"},je={class:"px-4 py-4 border-b border-gray-200"},Pe={class:"grid grid-cols-2 gap-3"},Xe={class:"bg-blue-50 rounded-lg p-3"},Ne={class:"text-blue-900 text-lg font-bold"},Ue={class:"bg-green-50 rounded-lg p-3"},Oe={class:"text-green-900 text-lg font-bold"},Be={class:"px-4 py-3 border-b border-gray-200"},He={class:"relative"},Re={class:"px-4 py-4 border-b border-gray-200"},Ve={class:"space-y-1"},We=["onClick"],ze={class:"flex items-center gap-3"},qe={class:"bg-gray-200 text-gray-700 px-2 py-1 rounded-full text-xs"},Je={class:"px-4 py-4"};function Qe(e,t,s,Qe,Ge,Ke){const Ze=(0,l.g2)("router-link"),Ye=(0,l.g2)("Loader");return(0,l.uX)(),(0,l.CE)("div",i,[(0,l.Lk)("div",r,[(0,l.Lk)("div",n,[(0,l.Lk)("div",c,[t[16]||(t[16]=(0,l.Lk)("h2",{class:"text-lg font-semibold text-gray-900"},"Collections",-1)),(0,l.bF)(Ze,{to:"/origin/collection/add",class:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors duration-200",title:"เพิ่ม Collection"},{default:(0,l.k6)((()=>t[15]||(t[15]=[(0,l.Lk)("i",{class:"fas fa-plus"},null,-1)]))),_:1})]),(0,l.Lk)("div",d,[(0,l.Lk)("div",u,[(0,l.Lk)("div",g,[t[17]||(t[17]=(0,l.Lk)("div",{class:"text-blue-600 text-xs font-medium"},"ทั้งหมด",-1)),(0,l.Lk)("div",h,(0,a.v_)(Ge.stats.total),1)]),(0,l.Lk)("div",p,[t[18]||(t[18]=(0,l.Lk)("div",{class:"text-green-600 text-xs font-medium"},"Assets",-1)),(0,l.Lk)("div",b,(0,a.v_)(Ge.stats.totalAssets),1)])])]),(0,l.Lk)("div",k,[(0,l.Lk)("div",f,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>Ge.searchTerm=e),type:"text",placeholder:"ค้นหา Collections...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[o.Jo,Ge.searchTerm]]),t[19]||(t[19]=(0,l.Lk)("i",{class:"fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},null,-1))])]),(0,l.Lk)("div",y,[(0,l.Lk)("div",m,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Ge.sidebarMenuItems,(e=>((0,l.uX)(),(0,l.CE)("button",{key:e.value,onClick:t=>Ke.selectFilter(e.value),class:(0,a.C4)(["w-full flex items-center justify-between px-3 py-2 text-sm rounded-lg transition-colors duration-200",Ge.activeFilter===e.value?"bg-blue-100 text-blue-700 border-l-4 border-blue-500":"text-gray-700 hover:bg-gray-100"])},[(0,l.Lk)("div",v,[(0,l.Lk)("i",{class:(0,a.C4)(e.icon)},null,2),(0,l.Lk)("span",null,(0,a.v_)(e.label),1)]),(0,l.Lk)("span",w,(0,a.v_)(e.count),1)],10,x)))),128))])]),(0,l.Lk)("div",C,[t[21]||(t[21]=(0,l.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-2"},"เรียงลำดับ",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>Ge.sortBy=e),class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},t[20]||(t[20]=[(0,l.Fv)('<option value="name_asc" data-v-4324c899>ชื่อ A-Z</option><option value="name_desc" data-v-4324c899>ชื่อ Z-A</option><option value="assets_desc" data-v-4324c899>Assets มาก-น้อย</option><option value="assets_asc" data-v-4324c899>Assets น้อย-มาก</option><option value="date_desc" data-v-4324c899>วันที่ใหม่-เก่า</option><option value="date_asc" data-v-4324c899>วันที่ เก่า-ใหม่</option>',6)]),512),[[o.u1,Ge.sortBy]])])])]),(0,l.Lk)("div",L,[(0,l.Lk)("div",_,[(0,l.Lk)("div",A,[(0,l.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>Ke.toggleMobileSidebar&&Ke.toggleMobileSidebar(...e)),class:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg"},t[22]||(t[22]=[(0,l.Lk)("i",{class:"fas fa-bars"},null,-1)])),t[24]||(t[24]=(0,l.Lk)("h1",{class:"text-lg font-semibold text-gray-900"},"Collections",-1)),(0,l.bF)(Ze,{to:"/origin/collection/add",class:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg"},{default:(0,l.k6)((()=>t[23]||(t[23]=[(0,l.Lk)("i",{class:"fas fa-plus"},null,-1)]))),_:1})])]),(0,l.Lk)("div",S,[(0,l.Lk)("div",E,[(0,l.Lk)("div",T,[t[25]||(t[25]=(0,l.Lk)("h1",{class:"hidden lg:block text-xl font-bold text-gray-900"},"Collections Management",-1)),(0,l.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>Ke.refreshData&&Ke.refreshData(...e)),disabled:Ge.isRefreshing,class:"flex items-center gap-2 px-3 py-2 text-sm text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50"},[(0,l.Lk)("i",{class:(0,a.C4)(["fas",Ge.isRefreshing?"fa-spinner fa-spin":"fa-refresh"])},null,2),(0,l.Lk)("span",$,(0,a.v_)(Ge.isRefreshing?"กำลังรีเฟรช...":"รีเฟรช"),1)],8,M)]),(0,l.Lk)("div",I,[(0,l.Lk)("button",{onClick:t[4]||(t[4]=e=>Ge.viewMode="grid"),class:(0,a.C4)(["px-3 py-1 rounded-md text-sm font-medium transition-colors duration-200","grid"===Ge.viewMode?"bg-white text-gray-900 shadow":"text-gray-500 hover:text-gray-700"])},t[26]||(t[26]=[(0,l.Lk)("i",{class:"fas fa-th"},null,-1)]),2),(0,l.Lk)("button",{onClick:t[5]||(t[5]=e=>Ge.viewMode="list"),class:(0,a.C4)(["px-3 py-1 rounded-md text-sm font-medium transition-colors duration-200","list"===Ge.viewMode?"bg-white text-gray-900 shadow":"text-gray-500 hover:text-gray-700"])},t[27]||(t[27]=[(0,l.Lk)("i",{class:"fas fa-list"},null,-1)]),2)])])]),(0,l.Lk)("div",D,[Ge.loading_sources?Ge.error?((0,l.uX)(),(0,l.CE)("div",j,[(0,l.Lk)("div",P,[t[29]||(t[29]=(0,l.Lk)("strong",{class:"font-bold"},"เกิดข้อผิดพลาด!",-1)),(0,l.Lk)("span",X,(0,a.v_)(Ge.error),1),(0,l.Lk)("span",{class:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:t[6]||(t[6]=(...e)=>Ke.dismissError&&Ke.dismissError(...e))},t[28]||(t[28]=[(0,l.Lk)("svg",{class:"fill-current h-6 w-6 text-red-500",role:"button",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},[(0,l.Lk)("title",null,"ปิด"),(0,l.Lk)("path",{d:"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"})],-1)]))])])):Ge.bulkActions&&Ge.selectedItems.length>0?((0,l.uX)(),(0,l.CE)("div",N,[(0,l.Lk)("div",U,[(0,l.Lk)("span",O,"เลือกแล้ว "+(0,a.v_)(Ge.selectedItems.length)+" รายการ",1),(0,l.Lk)("div",B,[(0,l.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>Ke.bulkDelete&&Ke.bulkDelete(...e)),class:"px-4 py-2 text-red-700 bg-red-100 border border-red-300 rounded-lg hover:bg-red-200 transition-colors duration-200"},t[30]||(t[30]=[(0,l.Lk)("i",{class:"fas fa-trash mr-2"},null,-1),(0,l.eW)(" ลบทั้งหมด ")])),(0,l.Lk)("button",{onClick:t[8]||(t[8]=e=>{Ge.selectedItems=[],Ge.bulkActions=!1}),class:"px-4 py-2 text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 transition-colors duration-200"}," ยกเลิก ")])])])):Ge.loading_sources?((0,l.uX)(),(0,l.CE)("div",H,["grid"===Ge.viewMode?((0,l.uX)(),(0,l.CE)("div",R,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Ke.filteredCollections,(e=>((0,l.uX)(),(0,l.Wv)(Ze,{key:e._id,to:`/origin/collection/detail/${e._id}`,class:(0,a.C4)(["relative bg-white rounded-lg shadow-md overflow-hidden transition-all duration-200 cursor-pointer content-card group",[Ke.getStatusClass(Ke.getCollectionStatus(e)),Ge.selectedItems.includes(e._id)?"ring-2 ring-blue-500":""]])},{default:(0,l.k6)((()=>[(0,l.Lk)("div",V,[(0,l.Lk)("input",{type:"checkbox",checked:Ge.selectedItems.includes(e._id),onClick:(0,o.D$)((t=>Ke.toggleSelection(e._id)),["stop","prevent"]),class:"w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500"},null,8,W)]),(0,l.Lk)("div",z,[(0,l.Lk)("button",{onClick:(0,o.D$)((t=>Ke.toggleCardMenu(e._id)),["stop","prevent"]),class:"p-1 bg-white/80 hover:bg-white rounded-full shadow-sm transition-colors duration-200"},t[31]||(t[31]=[(0,l.Lk)("i",{class:"fas fa-ellipsis-v text-gray-600"},null,-1)]),8,q),Ge.openCardMenu===e._id?((0,l.uX)(),(0,l.CE)("div",J,[(0,l.bF)(Ze,{to:`/origin/collection/detail/${e._id}`,class:"flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:Ke.closeCardMenu},{default:(0,l.k6)((()=>t[32]||(t[32]=[(0,l.Lk)("i",{class:"fas fa-eye text-blue-500"},null,-1),(0,l.Lk)("span",null,"ดูรายละเอียด",-1)]))),_:2},1032,["to","onClick"]),(0,l.bF)(Ze,{to:`/origin/package/management/${e._id}`,class:"flex items-center gap-3 px-4 py-2 text-sm text-purple-700 hover:bg-purple-50",onClick:Ke.closeCardMenu},{default:(0,l.k6)((()=>t[33]||(t[33]=[(0,l.Lk)("i",{class:"fas fa-cog text-purple-500"},null,-1),(0,l.Lk)("span",null,"จัดการ Package",-1)]))),_:2},1032,["to","onClick"]),(0,l.bF)(Ze,{to:`/origin/collection/edit/${e._id}`,class:"flex items-center gap-3 px-4 py-2 text-sm text-yellow-700 hover:bg-yellow-50",onClick:Ke.closeCardMenu},{default:(0,l.k6)((()=>t[34]||(t[34]=[(0,l.Lk)("i",{class:"fas fa-edit text-yellow-500"},null,-1),(0,l.Lk)("span",null,"แก้ไข",-1)]))),_:2},1032,["to","onClick"]),t[36]||(t[36]=(0,l.Lk)("div",{class:"border-t border-gray-200 my-1"},null,-1)),(0,l.Lk)("button",{onClick:(0,o.D$)((t=>{Ke.deleteData(e._id),Ke.closeCardMenu()}),["stop"]),class:"flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50 w-full text-left"},t[35]||(t[35]=[(0,l.Lk)("i",{class:"fas fa-trash text-red-500"},null,-1),(0,l.Lk)("span",null,"ลบ",-1)]),8,Q)])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",G,[e.image?((0,l.uX)(),(0,l.CE)("img",{key:0,src:e.image,alt:e.siteName,class:"w-full h-full object-cover"},null,8,K)):((0,l.uX)(),(0,l.CE)("div",Z,t[37]||(t[37]=[(0,l.Lk)("i",{class:"fas fa-folder text-gray-400 text-3xl"},null,-1)]))),(0,l.Lk)("div",Y,[(0,l.Lk)("span",{class:(0,a.C4)(["px-2 py-1 text-xs font-medium rounded-full","active"===Ke.getCollectionStatus(e)?"bg-green-100 text-green-800":"empty"===Ke.getCollectionStatus(e)?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"])},(0,a.v_)("active"===Ke.getCollectionStatus(e)?"ใช้งานได้":"empty"===Ke.getCollectionStatus(e)?"ว่างเปล่า":"ไม่สมบูรณ์"),3)])]),(0,l.Lk)("div",ee,[(0,l.Lk)("h3",te,(0,a.v_)(e.siteName||"ไม่มีชื่อ"),1),(0,l.Lk)("p",se,(0,a.v_)(e.hostname||"ไม่มี hostname"),1),e.package?((0,l.uX)(),(0,l.CE)("div",le,[(0,l.Lk)("span",ae,[t[38]||(t[38]=(0,l.Lk)("i",{class:"fas fa-gift mr-1"},null,-1)),(0,l.eW)(" "+(0,a.v_)(e.package.name),1)]),(0,l.Lk)("div",oe," ฿"+(0,a.v_)(e.package.price)+"/"+(0,a.v_)(e.package.duration),1)])):(0,l.Q3)("",!0),(0,l.Lk)("div",ie,[(0,l.Lk)("span",re,(0,a.v_)(e.assetsCount||0)+" Assets",1),(0,l.Lk)("span",ne,(0,a.v_)(e.createdAt?new Date(e.createdAt).toLocaleDateString("th-TH"):""),1)])])])),_:2},1032,["to","class"])))),128)),(0,l.bF)(Ze,{to:"/origin/collection/add",class:"relative bg-white border-2 border-dashed border-gray-300 rounded-lg overflow-hidden transition-all duration-200 hover:border-blue-400 hover:bg-blue-50 content-card flex items-center justify-center min-h-[200px]"},{default:(0,l.k6)((()=>t[39]||(t[39]=[(0,l.Lk)("div",{class:"text-center"},[(0,l.Lk)("i",{class:"fas fa-plus text-gray-400 text-3xl mb-2"}),(0,l.Lk)("p",{class:"text-gray-600 font-medium"},"เพิ่ม Collection ใหม่")],-1)]))),_:1})])):"list"===Ge.viewMode?((0,l.uX)(),(0,l.CE)("div",ce,[(0,l.Lk)("div",de,[(0,l.Lk)("table",ue,[(0,l.Lk)("thead",ge,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",he,[(0,l.Lk)("input",{type:"checkbox",onChange:t[9]||(t[9]=(...e)=>Ke.toggleSelectAll&&Ke.toggleSelectAll(...e)),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"},null,32)]),t[40]||(t[40]=(0,l.Lk)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Collection",-1)),t[41]||(t[41]=(0,l.Lk)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"สถานะ",-1)),t[42]||(t[42]=(0,l.Lk)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Package",-1)),t[43]||(t[43]=(0,l.Lk)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assets",-1)),t[44]||(t[44]=(0,l.Lk)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"วันที่สร้าง",-1)),t[45]||(t[45]=(0,l.Lk)("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"การจัดการ",-1))])]),(0,l.Lk)("tbody",pe,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Ke.filteredCollections,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e._id,class:"hover:bg-gray-50"},[(0,l.Lk)("td",be,[(0,l.Lk)("input",{type:"checkbox",checked:Ge.selectedItems.includes(e._id),onChange:t=>Ke.toggleSelection(e._id),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"},null,40,ke)]),(0,l.Lk)("td",fe,[(0,l.Lk)("div",ye,[t[46]||(t[46]=(0,l.Lk)("div",{class:"flex-shrink-0 h-10 w-10"},[(0,l.Lk)("div",{class:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center"},[(0,l.Lk)("i",{class:"fas fa-folder text-gray-400"})])],-1)),(0,l.Lk)("div",me,[(0,l.Lk)("div",xe,(0,a.v_)(e.siteName||"ไม่มีชื่อ"),1),(0,l.Lk)("div",ve,(0,a.v_)(e.hostname||"ไม่มี hostname"),1)])])]),(0,l.Lk)("td",we,[(0,l.Lk)("span",{class:(0,a.C4)(["inline-flex px-2 py-1 text-xs font-semibold rounded-full","active"===Ke.getCollectionStatus(e)?"bg-green-100 text-green-800":"empty"===Ke.getCollectionStatus(e)?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"])},(0,a.v_)("active"===Ke.getCollectionStatus(e)?"ใช้งานได้":"empty"===Ke.getCollectionStatus(e)?"ว่างเปล่า":"ไม่สมบูรณ์"),3)]),(0,l.Lk)("td",Ce,[e.package?((0,l.uX)(),(0,l.CE)("div",Le,[(0,l.Lk)("span",_e,(0,a.v_)(e.package.name),1),(0,l.Lk)("div",Ae," ฿"+(0,a.v_)(e.package.price)+"/"+(0,a.v_)(e.package.duration),1)])):((0,l.uX)(),(0,l.CE)("span",Se,"ไม่มี Package"))]),(0,l.Lk)("td",Ee,(0,a.v_)(e.assetsCount||0),1),(0,l.Lk)("td",Te,(0,a.v_)(e.createdAt?new Date(e.createdAt).toLocaleDateString("th-TH"):"-"),1),(0,l.Lk)("td",Me,[(0,l.bF)(Ze,{to:`/origin/collection/detail/${e._id}`,class:"text-blue-600 hover:text-blue-900 mr-3"},{default:(0,l.k6)((()=>t[47]||(t[47]=[(0,l.eW)(" ดู ")]))),_:2},1032,["to"]),(0,l.bF)(Ze,{to:`/origin/collection/edit/${e._id}`,class:"text-yellow-600 hover:text-yellow-900 mr-3"},{default:(0,l.k6)((()=>t[48]||(t[48]=[(0,l.eW)(" แก้ไข ")]))),_:2},1032,["to"]),(0,l.Lk)("button",{onClick:t=>Ke.deleteData(e._id),class:"text-red-600 hover:text-red-900"}," ลบ ",8,$e)])])))),128))])])])])):(0,l.Q3)("",!0),0===Ke.filteredCollections.length?((0,l.uX)(),(0,l.CE)("div",Ie,[t[50]||(t[50]=(0,l.Lk)("i",{class:"fas fa-folder-open text-gray-400 text-5xl mb-4"},null,-1)),t[51]||(t[51]=(0,l.Lk)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"ไม่พบ Collections",-1)),t[52]||(t[52]=(0,l.Lk)("p",{class:"text-gray-600 mb-6"},"ลองเปลี่ยนตัวกรองหรือเพิ่ม Collection ใหม่",-1)),(0,l.bF)(Ze,{to:"/origin/collection/add",class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200"},{default:(0,l.k6)((()=>t[49]||(t[49]=[(0,l.Lk)("i",{class:"fas fa-plus"},null,-1),(0,l.Lk)("span",null,"เพิ่ม Collection",-1)]))),_:1})])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",F,[(0,l.bF)(Ye)]))])]),Ge.showMobileSidebar?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-50",onClick:t[14]||(t[14]=(...e)=>Ke.toggleMobileSidebar&&Ke.toggleMobileSidebar(...e))},[(0,l.Lk)("div",{class:"fixed left-0 top-0 h-full w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out",onClick:t[13]||(t[13]=(0,o.D$)((()=>{}),["stop"]))},[(0,l.Lk)("div",De,[(0,l.Lk)("div",Fe,[t[54]||(t[54]=(0,l.Lk)("h2",{class:"text-lg font-semibold text-gray-900"},"Collections",-1)),(0,l.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>Ke.toggleMobileSidebar&&Ke.toggleMobileSidebar(...e)),class:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg"},t[53]||(t[53]=[(0,l.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,l.Lk)("div",je,[(0,l.Lk)("div",Pe,[(0,l.Lk)("div",Xe,[t[55]||(t[55]=(0,l.Lk)("div",{class:"text-blue-600 text-xs font-medium"},"ทั้งหมด",-1)),(0,l.Lk)("div",Ne,(0,a.v_)(Ge.stats.total),1)]),(0,l.Lk)("div",Ue,[t[56]||(t[56]=(0,l.Lk)("div",{class:"text-green-600 text-xs font-medium"},"Assets",-1)),(0,l.Lk)("div",Oe,(0,a.v_)(Ge.stats.totalAssets),1)])])]),(0,l.Lk)("div",Be,[(0,l.Lk)("div",He,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>Ge.searchTerm=e),type:"text",placeholder:"ค้นหา Collections...",class:"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[o.Jo,Ge.searchTerm]]),t[57]||(t[57]=(0,l.Lk)("i",{class:"fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},null,-1))])]),(0,l.Lk)("div",Re,[(0,l.Lk)("div",Ve,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Ge.sidebarMenuItems,(e=>((0,l.uX)(),(0,l.CE)("button",{key:e.value,onClick:t=>Ke.selectFilter(e.value),class:(0,a.C4)(["w-full flex items-center justify-between px-3 py-2 text-sm rounded-lg transition-colors duration-200",Ge.activeFilter===e.value?"bg-blue-100 text-blue-700 border-l-4 border-blue-500":"text-gray-700 hover:bg-gray-100"])},[(0,l.Lk)("div",ze,[(0,l.Lk)("i",{class:(0,a.C4)(e.icon)},null,2),(0,l.Lk)("span",null,(0,a.v_)(e.label),1)]),(0,l.Lk)("span",qe,(0,a.v_)(e.count),1)],10,We)))),128))])]),(0,l.Lk)("div",Je,[t[59]||(t[59]=(0,l.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-2"},"เรียงลำดับ",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[12]||(t[12]=e=>Ge.sortBy=e),class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},t[58]||(t[58]=[(0,l.Fv)('<option value="name_asc" data-v-4324c899>ชื่อ A-Z</option><option value="name_desc" data-v-4324c899>ชื่อ Z-A</option><option value="assets_desc" data-v-4324c899>Assets มาก-น้อย</option><option value="assets_asc" data-v-4324c899>Assets น้อย-มาก</option><option value="date_desc" data-v-4324c899>วันที่ใหม่-เก่า</option><option value="date_asc" data-v-4324c899>วันที่ เก่า-ใหม่</option>',6)]),512),[[o.u1,Ge.sortBy]])])])])])):(0,l.Q3)("",!0)])}s(44114),s(98992),s(54520),s(3949),s(81454),s(8872);var Ge=s(59911),Ke=s.n(Ge),Ze=s(75435),Ye=s(40475);s(72577);class et{constructor(e){this.hostkey=e,this.baseUrl="https://gateway.cloudrestfulapi.com/api/hostname",this.cache={collections:null,assets:new Map,lastFetch:null},this.CACHE_DURATION=3e5}isCacheValid(){return this.cache.lastFetch&&Date.now()-this.cache.lastFetch<this.CACHE_DURATION}async getCollectionsWithAssets(){try{if(this.isCacheValid()&&this.cache.collections)return this.cache.collections;const e=await this.fetchCollections(),t=await this.fetchAllAssets(),s=await this.fetchAllPackages(),l=e.map((e=>{const l=t.filter((t=>t.parent===e._id)).length,a=s.find((t=>t._id===e.packageId));return{...e,assetsCount:l,package:a||null}}));return this.cache.collections=l,this.cache.lastFetch=Date.now(),l}catch(e){throw console.error("Error fetching collections with assets:",e),e}}async fetchCollections(){const e=await fetch(`${this.baseUrl}/query`,{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{siteType:"collection"}]})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}async fetchAllAssets(){const e=await fetch(`${this.baseUrl}/query`,{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{siteType:"asset"}]})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}async fetchAllPackages(){try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/package/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{status:!0}]})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){return console.error("Error fetching packages:",e),[]}}async deleteCollection(e){try{const t=await fetch(`${this.baseUrl}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json","client-token-key":this.hostkey}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return this.clearCache(),await t.json()}catch(t){throw console.error("Error deleting collection:",t),t}}async getAssetsByCollection(e){try{if(this.cache.assets.has(e))return this.cache.assets.get(e);const t=await fetch(`${this.baseUrl}/query`,{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{$and:[{siteType:"asset"},{parent:e}]}]})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();return this.cache.assets.set(e,s),s}catch(t){throw console.error("Error fetching assets for collection:",e,t),t}}clearCache(){this.cache.collections=null,this.cache.assets.clear(),this.cache.lastFetch=null}async refreshData(){return this.clearCache(),await this.getCollectionsWithAssets()}async validatePackageLimits(e,t="asset"){try{const s=await this.getCollectionsWithAssets(),l=s.find((t=>t._id===e));if(!l||!l.package)throw new Error("Collection หรือ Package ไม่พบ");const a=l.package.limits,o={assets:l.assetsCount||0,users:await this.getUserCount(e)},i={isValid:!0,message:"",limits:a,current:o};return"asset"===t&&a.maxAssets&&o.assets>=a.maxAssets&&(i.isValid=!1,i.message=`ไม่สามารถเพิ่ม Asset ได้ เนื่องจากเกินขีดจำกัด (${o.assets}/${a.maxAssets})`),"user"===t&&a.maxUsers&&o.users>=a.maxUsers&&(i.isValid=!1,i.message=`ไม่สามารถเพิ่ม User ได้ เนื่องจากเกินขีดจำกัด (${o.users}/${a.maxUsers})`),i}catch(s){throw console.error("Error validating package limits:",s),s}}async getUserCount(e){try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/user/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{collection:{$in:[e]}}]})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();return s.length}catch(t){return console.error("Error getting user count:",t),0}}async validateStorageLimits(e,t=0){try{const s=await this.getCollectionsWithAssets(),l=s.find((t=>t._id===e));if(!l||!l.package)throw new Error("Collection หรือ Package ไม่พบ");const a=l.package.limits.storageGB;if(!a)return{isValid:!0,message:"ไม่มีขีดจำกัด Storage"};const o=await this.getStorageUsage(e),i=o+t,r={isValid:i<=a,message:i>a?`ไม่สามารถใช้ Storage ได้ เนื่องจากเกินขีดจำกัด (${i.toFixed(2)}/${a} GB)`:`Storage ใช้งานได้ (${i.toFixed(2)}/${a} GB)`,limits:{storageGB:a},current:{storageGB:o},additional:t};return r}catch(s){throw console.error("Error validating storage limits:",s),s}}async getStorageUsage(e){try{const t=[{$match:{parent:e}},{$group:{_id:null,totalSize:{$sum:"$size"}}}],s=await fetch("https://gateway.cloudrestfulapi.com/api/storage/aggregate",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({pipeline:t})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const l=await s.json(),a=l[0]?.totalSize||0,o=a/1073741824;return o}catch(t){return console.error("Error getting storage usage:",t),0}}}var tt=et,st={inject:["apiServerName","saltSecret"],data(){return{accessToken:Ye.A.get("session","token"),listItems:[],loading_sources:!0,hostkey:this.$Key,collectionService:null,error:null,isRefreshing:!1,viewMode:"grid",searchTerm:"",sortBy:"name_asc",selectedItems:[],bulkActions:!1,openCardMenu:null,stats:{total:0,active:0,empty:0,totalAssets:0},showMobileSidebar:!1,selectedCollection:null,sidebarMenuItems:[{value:"all",label:"ทั้งหมด",icon:"fas fa-folder",count:0},{value:"active",label:"ใช้งานได้",icon:"fas fa-check-circle",count:0},{value:"empty",label:"ว่างเปล่า",icon:"fas fa-exclamation-triangle",count:0},{value:"incomplete",label:"ไม่สมบูรณ์",icon:"fas fa-times-circle",count:0}],activeFilter:"all"}},components:{Loader:Ze.A},computed:{filteredCollections(){let e=this.listItems;if("all"!==this.activeFilter&&(e=e.filter((e=>this.getCollectionStatus(e)===this.activeFilter))),this.searchTerm){const t=this.searchTerm.toLowerCase();e=e.filter((e=>e.siteName&&e.siteName.toLowerCase().includes(t)||e.hostname&&e.hostname.toLowerCase().includes(t)))}return this.sortCollections(e)}},methods:{async getData(){if(Ye.A.get("session","login"))try{this.loading_sources=!1,this.error=null;const e=await this.collectionService.getCollectionsWithAssets();this.listItems=e,this.loading_sources=!0,this.calculateStats()}catch(e){console.error("Error loading collections:",e),this.error="ไม่สามารถโหลดข้อมูล Collection ได้",this.loading_sources=!0}},async refreshData(){if(!this.isRefreshing)try{this.isRefreshing=!0;const e=await this.collectionService.refreshData();this.listItems=e}catch(e){console.error("Error refreshing collections:",e),this.error="ไม่สามารถรีเฟรชข้อมูลได้"}finally{this.isRefreshing=!1}},async deleteData(e){if(Ye.A.get("session","login")&&confirm("คุณแน่ใจหรือไม่ที่จะลบ Collection นี้?"))try{this.loading_sources=!1,await this.collectionService.deleteCollection(e),await this.getData()}catch(t){console.error("Error deleting collection:",t),this.error="ไม่สามารถลบ Collection ได้",this.loading_sources=!0}},dismissError(){this.error=null},toggleCardMenu(e){this.openCardMenu=this.openCardMenu===e?null:e},closeCardMenu(){this.openCardMenu=null},handleClickOutside(e){this.openCardMenu&&!e.target.closest(".dropdown-menu")&&this.closeCardMenu()},toggleSelectAll(e){e.target.checked?(this.selectedItems=this.listItems.map((e=>e._id)),this.bulkActions=!0):(this.selectedItems=[],this.bulkActions=!1)},toggleSelection(e){const t=this.selectedItems.indexOf(e);t>-1?this.selectedItems.splice(t,1):this.selectedItems.push(e),this.bulkActions=this.selectedItems.length>0},async bulkDelete(){if(confirm(`คุณแน่ใจหรือไม่ที่จะลบ Collection ${this.selectedItems.length} รายการ?`))try{this.loading_sources=!1;for(const e of this.selectedItems)await this.collectionService.deleteCollection(e);this.selectedItems=[],this.bulkActions=!1,await this.getData()}catch(e){console.error("Error bulk deleting collections:",e),this.error="ไม่สามารถลบ Collections ได้",this.loading_sources=!0}},getCollectionStatus(e){return e.hostname&&e.siteName?0===(e.assetsCount||0)?"empty":"active":"incomplete"},getStatusClass(e){const t={active:"border-green-200 bg-green-50",empty:"border-yellow-200 bg-yellow-50",incomplete:"border-red-200 bg-red-50"};return t[e]||"border-gray-200 bg-white"},calculateStats(){const e=this.listItems.filter((e=>"active"===this.getCollectionStatus(e))).length,t=this.listItems.filter((e=>"empty"===this.getCollectionStatus(e))).length,s=this.listItems.filter((e=>"incomplete"===this.getCollectionStatus(e))).length;this.stats={total:this.listItems.length,active:e,empty:t,totalAssets:this.listItems.reduce(((e,t)=>e+(t.assetsCount||0)),0)},this.sidebarMenuItems.forEach((l=>{switch(l.value){case"all":l.count=this.stats.total;break;case"active":l.count=e;break;case"empty":l.count=t;break;case"incomplete":l.count=s;break}}))},toggleMobileSidebar(){this.showMobileSidebar=!this.showMobileSidebar},selectFilter(e){this.activeFilter=e,this.filterCollections(),this.selectedCollection=null,this.showMobileSidebar&&this.toggleMobileSidebar()},filterCollections(){},sortCollections(e){return e.sort(((e,t)=>{switch(this.sortBy){case"name_asc":return(e.siteName||"").localeCompare(t.siteName||"");case"name_desc":return(t.siteName||"").localeCompare(e.siteName||"");case"assets_desc":return(t.assetsCount||0)-(e.assetsCount||0);case"assets_asc":return(e.assetsCount||0)-(t.assetsCount||0);case"date_desc":return new Date(t.createdAt||0)-new Date(e.createdAt||0);case"date_asc":return new Date(e.createdAt||0)-new Date(t.createdAt||0);default:return 0}}))},selectCollection(e){this.selectedCollection=e},closeCollectionDetail(){this.selectedCollection=null},updated(){Ke().replace()}},async mounted(){try{this.collectionService=new tt(this.hostkey),document.addEventListener("click",this.handleClickOutside),await this.getData()}catch(e){console.error("Error initializing component:",e),this.error="ไม่สามารถเริ่มต้นระบบได้"}},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},setup(){}},lt=s(64621);const at=(0,lt.A)(st,[["render",Qe],["__scopeId","data-v-4324c899"]]);var ot=at},74284:function(e,t,s){s.d(t,{A:function(){return u}});var l=s(20641);function a(e,t,s,a,o,i){return(0,l.uX)(),(0,l.CE)("div")}var o=s(75220),i=s(63084),r=s(40475),n={name:"Authen",data(){return{configs:r.A.get("configs"),session:r.A.get("session")}},created(){i.A.option(this.$route)},computed:{},components:{},mounted(){this.checkAuth()},updated(){},methods:{async checkAuth(){const e=(0,o.lq)(),t=e.meta.auth,s=e.name,l=r.A.get("session");let a=l.token,n=l.login,c=l.current;i.A.log("hasLogin",n),i.A.log("Page -> Auth:",t),i.A.log("User -> Token:",a),i.A.log("User -> Login:",n),"frontend"===this.session.interface?i.A.log("Front-End"):"backend"===this.session.interface&&(i.A.log("Back-End"),n?("Login"==s||void 0==c?(i.A.log("Not Login Again"),this.$router.replace({path:"/"})):(i.A.log("Has School Active"),t?(i.A.log("This page is : Authen Request"),""===a||null===a||void 0==a?i.A.log("Your Cannot Access"):i.A.log("Your Can Access")):i.A.log("This page is : No Authen Request")),i.A.log("Login")):(i.A.log("Not Login"),"Login"!=s?(window.location.href="/member/login",i.A.log("Not Login Page",s)):i.A.log("Login Page",s)))}},setup(){}},c=s(64621);const d=(0,c.A)(n,[["render",a]]);var u=d}}]);
//# sourceMappingURL=2774.a395cd18.js.map