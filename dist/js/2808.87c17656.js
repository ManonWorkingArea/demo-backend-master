"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[2808],{69023:function(e,t,o){o.r(t),o.d(t,{default:function(){return nn}});var r=o(20641);function a(e,t,o,a,l,s){const n=(0,r.g2)("Target");return this.login?((0,r.uX)(),(0,r.Wv)(n,{key:0})):(0,r.Q3)("",!0)}var l=o(52968),s=o(75220),n=(o(98992),o(54520),o(81454),o(90033)),i=o(53751);const d={class:"hidden lg:flex lg:w-64 lg:flex-col"},c={class:"flex flex-col flex-grow bg-white border-r border-gray-200 h-full"},u={class:"flex items-center justify-between px-4 py-4 border-b border-gray-200 flex-shrink-0"},m={class:"flex items-center space-x-3"},g={class:"text-xs text-gray-500"},p={class:"px-4 py-4 border-b border-gray-200"},y={class:"mb-4"},x={class:"space-y-1"},f={class:"ml-auto px-1.5 py-0.5 text-xs rounded-full bg-gray-200 text-gray-600"},b=["onClick"],v={class:"ml-auto px-1.5 py-0.5 text-xs rounded-full bg-gray-200 text-gray-600"},k={class:"ml-auto px-1.5 py-0.5 text-xs rounded-full bg-gray-200 text-gray-600"},h={class:"space-y-2"},L=["onClick"],T={class:"flex-1 text-left truncate"},w={class:"font-medium"},C={key:0,class:"text-xs opacity-75 mt-0.5"},E={key:0},_={key:0,class:"text-center py-4"},D={class:"text-xs text-gray-500 mb-2"},F={key:0},I={key:1},X={class:"px-4 py-4 border-b border-gray-200"},S={class:"space-y-2"},O={class:"px-4 py-4 border-b border-gray-200"},A={class:"space-y-2"},$={class:"mt-auto px-4 py-4 flex-shrink-0"},R={class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},M={class:"flex-1 min-w-0"},G={class:"text-sm font-medium text-gray-900 truncate"},Q={class:"flex-1 flex flex-col min-w-0 h-full"},j={class:"lg:hidden bg-white border-b border-gray-200 px-4 py-3"},U={class:"flex items-center justify-between"},W={class:"bg-white border-b border-gray-200 px-4 py-3"},K={class:"flex items-center gap-4"},P={class:"flex-1 relative"},H={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},q={key:0,class:"flex items-center gap-2 text-sm whitespace-nowrap"},N={class:"text-gray-600"},B={class:"font-semibold text-blue-600"},V={class:"font-semibold text-green-600"},J={key:0,class:"bg-gray-100"},z={class:"hidden md:block"},Y={class:"tab-folder flex border-gray-400 bg-gray-500 pt-5 pl-2 md:pl-6"},Z=["onClick"],ee={class:"flex items-center"},te={class:"ml-2 px-1.5 py-0.5 text-xs rounded-full bg-gray-200 text-gray-600"},oe={class:"text-xs text-gray-600 hidden md:block"},re={key:0,class:"absolute bottom-0 left-0 w-full"},ae={class:"block md:hidden px-4 py-3"},le={class:"relative"},se={class:"flex items-center space-x-3"},ne={class:"text-left"},ie={class:"font-medium text-gray-900"},de={class:"text-sm text-gray-500"},ce={key:0,class:"mobile-dropdown-menu absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50"},ue={class:"py-2"},me=["onClick"],ge={class:"flex items-center space-x-3"},pe={class:"text-left"},ye={class:"font-medium"},xe={class:"text-sm text-gray-500"},fe={class:"flex items-center space-x-2"},be={class:"px-2 py-1 text-xs rounded-full bg-gray-200 text-gray-600"},ve={key:0,class:"fas fa-check text-blue-600 text-sm"},ke={class:"flex-1 overflow-x-hidden bg-white"},he={key:0,class:"h-full p-4"},Le={class:"bg-white p-3"},Te={key:0},we={class:"mb-6"},Ce={class:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2"},Ee={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},_e=["onClick"],De={class:"flex items-start gap-2.5"},Fe={class:"flex-1 min-w-0"},Ie={class:"text-sm font-semibold text-gray-800 mb-1"},Xe={key:0,class:"text-xs text-gray-500 mb-1"},Se={key:1,class:"text-xs text-gray-600 line-clamp-2"},Oe={class:"flex items-center justify-between mt-2"},Ae={class:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full"},$e={key:1},Re={class:"mb-6"},Me={class:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2"},Ge={class:"space-y-2"},Qe=["onClick"],je={class:"flex items-start gap-3"},Ue={class:"flex-1 min-w-0"},We={class:"flex items-center gap-2 mb-1"},Ke={class:"text-sm font-semibold text-gray-800"},Pe={class:"text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded"},He={key:0,class:"text-xs text-gray-600"},qe={key:2,class:"text-center py-12"},Ne={key:3},Be={key:0},Ve={class:"flex items-center gap-3 mb-3 p-3 bg-gradient-to-r from-gray-50 to-white border border-gray-200 rounded-lg"},Je={class:"flex-1"},ze={class:"text-base font-semibold text-gray-900"},Ye={class:"text-sm text-gray-600"},Ze=["onClick"],et={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 auto-rows-fr"},tt=["onClick"],ot={class:"flex items-start gap-2.5 flex-1"},rt={class:"flex-1 min-w-0 flex flex-col"},at={class:"text-sm font-semibold text-gray-800 mb-1.5"},lt={class:"flex-1 mb-2"},st={key:0,class:"text-xs text-gray-500 mb-0.5"},nt={key:1,class:"text-xs text-gray-600 line-clamp-2"},it={key:2,class:"h-4"},dt={class:"flex items-center justify-between mt-auto"},ct={class:"inline-flex items-center px-1.5 py-0.5 text-xs font-medium bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 rounded-full border border-blue-200"},ut={key:0,class:"text-center py-12"},mt={key:4},gt={class:"flex items-center gap-3 mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg"},pt={class:"flex-1"},yt={class:"text-lg font-semibold text-gray-900"},xt={class:"text-sm text-gray-600"},ft={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 auto-rows-fr"},bt=["onClick"],vt={class:"flex items-start gap-2.5 flex-1"},kt={class:"flex-1 min-w-0 flex flex-col"},ht={class:"text-sm font-semibold text-gray-800 mb-1.5"},Lt={class:"flex-1 mb-2"},Tt={key:0,class:"text-xs text-gray-500 mb-0.5"},wt={key:1,class:"text-xs text-gray-600 line-clamp-2"},Ct={key:2,class:"h-4"},Et={class:"flex items-center justify-between mt-auto"},_t={class:"inline-flex items-center px-1.5 py-0.5 text-xs font-medium bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 rounded-full border border-blue-200"},Dt={key:1,class:"h-full flex flex-col p-4"},Ft={class:"bg-white border border-gray-200 rounded-lg p-4 mb-4 shadow-sm"},It={class:"flex items-center justify-between mb-3"},Xt={class:"flex items-center gap-3"},St={class:"text-lg font-semibold text-gray-900 flex items-center gap-2"},Ot={key:0,class:"text-sm text-gray-600 mt-1"},At={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},$t={class:"bg-blue-50 border border-blue-200 rounded-md p-3"},Rt={class:"flex items-center justify-between"},Mt={class:"text-lg font-bold text-blue-900"},Gt={class:"bg-green-50 border border-green-200 rounded-md p-3"},Qt={class:"flex items-center justify-between"},jt={class:"text-lg font-bold text-green-900"},Ut={class:"bg-purple-50 border border-purple-200 rounded-md p-3"},Wt={class:"flex items-center justify-between"},Kt={class:"text-lg font-bold text-purple-900"},Pt={class:"bg-orange-50 border border-orange-200 rounded-md p-3"},Ht={class:"flex items-center justify-between"},qt={class:"text-lg font-bold text-orange-900"},Nt={class:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-200"},Bt={class:"flex-1 overflow-y-auto bg-white border border-gray-200 rounded-lg shadow-sm"},Vt={key:0,class:"text-center py-12"},Jt={key:1,class:"p-4"},zt={class:"flex items-center justify-between mb-4"},Yt={class:"text-sm font-medium text-gray-700 flex items-center gap-2"},Zt={class:"space-y-2"},eo={class:"flex flex-col h-full"},to={class:"flex items-center justify-between px-4 py-4 border-b border-gray-200"},oo={class:"flex items-center space-x-3"},ro={class:"text-xs text-gray-500"},ao={class:"px-4 py-4 border-b border-gray-200"},lo={class:"mb-4"},so={class:"space-y-1"},no={class:"ml-auto px-1.5 py-0.5 text-xs rounded-full bg-gray-200 text-gray-600"},io=["onClick"],co={class:"ml-auto px-1.5 py-0.5 text-xs rounded-full bg-gray-200 text-gray-600"},uo={class:"ml-auto px-1.5 py-0.5 text-xs rounded-full bg-gray-200 text-gray-600"},mo={class:"space-y-2"},go=["onClick"],po={class:"flex-1 text-left truncate"},yo={class:"font-medium"},xo={key:0,class:"text-xs opacity-75 mt-0.5"},fo={key:0},bo={key:1,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-3"},vo={class:"bg-white rounded-lg shadow-lg max-w-lg w-full max-h-[85vh] overflow-y-auto border border-gray-300"},ko={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200"},ho={class:"text-lg font-semibold text-gray-900"},Lo={class:"p-4 bg-white"},To={class:"flex justify-end gap-2 px-4 py-3 border-t border-gray-200"},wo={key:2,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-3"},Co={class:"bg-white rounded-lg shadow-lg max-w-4xl w-full max-h-[90vh] overflow-hidden border border-gray-300"},Eo={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200 bg-gray-50"},_o={class:"text-xl font-semibold text-gray-900"},Do={class:"bg-gray-100 px-6 py-3 border-b border-gray-200"},Fo={class:"flex space-x-1"},Io={class:"overflow-y-auto",style:{"max-height":"calc(90vh - 180px)"}},Xo={key:0,class:"p-6 bg-white"},So={class:"space-y-6"},Oo={class:"bg-gray-50 p-4 rounded-lg"},Ao={class:"flex items-center text-sm text-gray-700"},$o={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2"},Ro=["value"],Mo={class:"flex-1 min-w-0"},Go={class:"font-medium text-sm text-gray-900"},Qo={class:"text-xs text-gray-400 uppercase"},jo={class:"space-y-4"},Uo={class:"flex items-center space-x-6"},Wo={class:"inline-flex items-center"},Ko={class:"inline-flex items-center"},Po={class:"inline-flex items-center"},Ho={key:0,class:"bg-purple-50 border border-purple-200 rounded-lg p-4"},qo={class:"flex items-center space-x-3"},No={class:"text-xs text-purple-600 mt-2"},Bo={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Vo={class:"text-xs text-blue-700 space-y-1"},Jo={key:0},zo={key:1},Yo={key:2},Zo={key:1,class:"p-6 bg-white"},er={class:"flex justify-between items-center px-6 py-4 border-t border-gray-200 bg-gray-50"},tr={class:"text-sm text-gray-500"},or={key:0},rr={key:1},ar={class:"flex gap-3"},lr={key:3,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-3"},sr={class:"bg-white rounded-lg shadow-lg min-w-[500px] max-w-[600px] border border-gray-300"},nr={class:"p-4 bg-white"},ir={class:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3"},dr={class:"text-sm font-medium text-red-800 mb-2"},cr={class:"font-bold text-red-900"},ur={key:0,class:"mt-2"},mr={class:"text-sm text-red-700 bg-red-100 rounded px-3 py-2 border border-red-200"},gr={class:"mb-1"},pr={key:0,class:"text-xs text-red-600 mt-1"},yr={class:"text-sm text-red-800 mt-2 font-medium"},xr={key:1,class:"mt-2"},fr={class:"flex justify-end gap-2 px-4 py-3 border-t border-gray-200"};function br(e,t,o,a,l,s){const br=(0,r.g2)("TermItem"),vr=(0,r.g2)("CustomFieldRenderer"),kr=(0,r.g2)("FieldConfigManager"),hr=(0,r.g2)("TaxonomyHistoryViewer");return(0,r.uX)(),(0,r.CE)("div",{class:(0,n.C4)(["bg-gray-50 flex overflow-hidden taxonomy-manager-container",[o.headerType&&`with-${o.headerType}`,o.customClass]]),style:(0,n.Tr)(o.customHeight?{height:o.customHeight,maxHeight:o.customHeight}:{})},[(0,r.Lk)("div",d,[(0,r.Lk)("div",c,[(0,r.Lk)("div",u,[(0,r.Lk)("div",m,[t[55]||(t[55]=(0,r.Lk)("div",{class:"w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center"},[(0,r.Lk)("i",{class:"fas fa-tags text-white text-sm"})],-1)),(0,r.Lk)("div",null,[t[54]||(t[54]=(0,r.Lk)("h1",{class:"text-base font-semibold text-gray-900"},"Taxonomy",-1)),(0,r.Lk)("p",g,(0,n.v_)(a.taxonomyGroups.length)+" Taxonomy",1)])]),(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>a.addTaxonomyGroup&&a.addTaxonomyGroup(...e)),type:"button",class:"bg-green-600 hover:bg-green-700 text-white p-2 rounded-lg transition-colors duration-200",title:"เพิ่ม Taxonomy ใหม่"},t[56]||(t[56]=[(0,r.Lk)("i",{class:"fas fa-plus text-sm"},null,-1)]))]),(0,r.Lk)("div",p,[t[64]||(t[64]=(0,r.Lk)("h3",{class:"text-sm font-bold text-gray-700 mb-3"},"กลุ่ม Taxonomy",-1)),(0,r.Lk)("div",y,[t[61]||(t[61]=(0,r.Lk)("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"กรองตามประเภทเนื้อหา",-1)),(0,r.Lk)("div",x,[(0,r.Lk)("button",{onClick:t[1]||(t[1]=e=>a.selectContentType("")),class:(0,n.C4)(["w-full flex items-center gap-2 px-2 py-1.5 text-xs rounded-md transition-colors duration-200",{"bg-blue-100 text-blue-700 font-medium":""===a.selectedContentType,"text-gray-600 hover:bg-gray-100 hover:text-gray-900":""!==a.selectedContentType}])},[t[57]||(t[57]=(0,r.Lk)("i",{class:"fas fa-list text-xs w-3"},null,-1)),t[58]||(t[58]=(0,r.Lk)("span",null,"ทั้งหมด",-1)),(0,r.Lk)("span",f,(0,n.v_)(a.taxonomyGroups.length),1)],2),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.getContentTypesDisplay(),(e=>((0,r.uX)(),(0,r.CE)("button",{key:e.key,onClick:t=>a.selectContentType(e.key),class:(0,n.C4)(["w-full flex items-center gap-2 px-2 py-1.5 text-xs rounded-md transition-colors duration-200",{"bg-blue-100 text-blue-700 font-medium":a.selectedContentType===e.key,"text-gray-600 hover:bg-gray-100 hover:text-gray-900":a.selectedContentType!==e.key}])},[(0,r.Lk)("i",{class:(0,n.C4)([e.icon,"text-xs w-3"]),style:(0,n.Tr)({color:a.selectedContentType===e.key?"":`var(--${e.color}-500)`})},null,6),(0,r.Lk)("span",null,(0,n.v_)(e.label),1),(0,r.Lk)("span",v,(0,n.v_)(a.taxonomyGroups.filter((t=>t.contentTypes&&t.contentTypes.includes(e.key))).length),1)],10,b)))),128)),a.taxonomyGroups.filter((e=>!e.contentTypes||0===e.contentTypes.length)).length>0?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[2]||(t[2]=e=>a.selectContentType("unassigned")),class:(0,n.C4)(["w-full flex items-center gap-2 px-2 py-1.5 text-xs rounded-md transition-colors duration-200",{"bg-blue-100 text-blue-700 font-medium":"unassigned"===a.selectedContentType,"text-gray-600 hover:bg-gray-100 hover:text-gray-900":"unassigned"!==a.selectedContentType}])},[t[59]||(t[59]=(0,r.Lk)("i",{class:"fas fa-question-circle text-xs w-3 text-gray-400"},null,-1)),t[60]||(t[60]=(0,r.Lk)("span",null,"ไม่ได้ระบุประเภท",-1)),(0,r.Lk)("span",k,(0,n.v_)(a.taxonomyGroups.filter((e=>!e.contentTypes||0===e.contentTypes.length)).length),1)],2)):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",h,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.getFilteredTaxonomyGroups(),(e=>((0,r.uX)(),(0,r.CE)("button",{key:e._id,onClick:t=>a.selectTaxonomyGroup(e._id),class:(0,n.C4)(["w-full flex items-center gap-3 px-3 py-2 text-sm rounded-lg transition-colors duration-200 sidebar-menu-item",{"bg-green-100 text-green-700 font-medium active":a.selectedTaxonomyGroup===e._id,"text-gray-600 hover:bg-gray-100 hover:text-gray-900":a.selectedTaxonomyGroup!==e._id}])},[t[62]||(t[62]=(0,r.Lk)("i",{class:"fas fa-folder text-sm w-4"},null,-1)),(0,r.Lk)("div",T,[(0,r.Lk)("div",w,(0,n.v_)(e.name),1),e.contentTypes&&e.contentTypes.length>0?((0,r.uX)(),(0,r.CE)("div",C,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.contentTypes,((t,o)=>((0,r.uX)(),(0,r.CE)("span",{key:t,class:"inline-flex items-center gap-1"},[(0,r.Lk)("i",{class:(0,n.C4)([a.getContentTypeInfo(t).icon,"text-xs"])},null,2),(0,r.eW)(" "+(0,n.v_)(a.getContentTypeInfo(t).label)+" ",1),o<e.contentTypes.length-1?((0,r.uX)(),(0,r.CE)("span",E,", ")):(0,r.Q3)("",!0)])))),128))])):(0,r.Q3)("",!0)]),a.getTermsCountForGroup(e._id)>0?((0,r.uX)(),(0,r.CE)("span",{key:0,class:(0,n.C4)(["px-2 py-1 text-xs rounded-full status-badge",{"bg-green-200 text-green-800":a.selectedTaxonomyGroup===e._id,"bg-gray-200 text-gray-600":a.selectedTaxonomyGroup!==e._id}])},(0,n.v_)(a.getTermsCountForGroup(e._id)),3)):(0,r.Q3)("",!0)],10,L)))),128))]),0===a.getFilteredTaxonomyGroups().length?((0,r.uX)(),(0,r.CE)("div",_,[t[63]||(t[63]=(0,r.Lk)("div",{class:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2"},[(0,r.Lk)("i",{class:"fas fa-folder text-gray-400 text-sm"})],-1)),(0,r.Lk)("p",D,[a.selectedContentType?((0,r.uX)(),(0,r.CE)("span",F,"ไม่มี Taxonomy สำหรับ"+(0,n.v_)(a.getContentTypeInfo(a.selectedContentType).label),1)):((0,r.uX)(),(0,r.CE)("span",I,"ยังไม่มี Taxonomy"))]),(0,r.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>a.addTaxonomyGroup&&a.addTaxonomyGroup(...e)),class:"text-xs text-green-600 hover:text-green-700"}," เพิ่ม Taxonomy แรก ")])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",X,[t[68]||(t[68]=(0,r.Lk)("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"การดำเนินการ",-1)),(0,r.Lk)("div",S,[(0,r.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>a.addTaxonomyGroup&&a.addTaxonomyGroup(...e)),class:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors duration-200"},t[65]||(t[65]=[(0,r.Lk)("i",{class:"fas fa-plus text-sm w-4"},null,-1),(0,r.Lk)("span",null,"เพิ่ม Taxonomy",-1)])),a.selectedTaxonomyGroup?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[5]||(t[5]=e=>a.addTerm(null)),class:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors duration-200"},t[66]||(t[66]=[(0,r.Lk)("i",{class:"fas fa-tag text-sm w-4"},null,-1),(0,r.Lk)("span",null,"เพิ่ม Root Term",-1)]))):(0,r.Q3)("",!0),(0,r.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>a.exportData&&a.exportData(...e)),class:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors duration-200"},t[67]||(t[67]=[(0,r.Lk)("i",{class:"fas fa-download text-sm w-4"},null,-1),(0,r.Lk)("span",null,"Export ข้อมูล",-1)]))])]),(0,r.Lk)("div",O,[t[71]||(t[71]=(0,r.Lk)("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"เครื่องมือ",-1)),(0,r.Lk)("div",A,[(0,r.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>a.importData&&a.importData(...e)),class:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors duration-200"},t[69]||(t[69]=[(0,r.Lk)("i",{class:"fas fa-upload text-sm w-4"},null,-1),(0,r.Lk)("span",null,"Import ข้อมูล",-1)])),(0,r.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>a.purgeLogs&&a.purgeLogs(...e)),class:"w-full flex items-center gap-3 px-3 py-2 text-sm text-red-600 hover:bg-red-50 hover:text-red-700 rounded-lg transition-colors duration-200"},t[70]||(t[70]=[(0,r.Lk)("i",{class:"fas fa-trash text-sm w-4"},null,-1),(0,r.Lk)("span",null,"ลบ Logs ทั้งหมด",-1)]))])]),(0,r.Lk)("div",$,[(0,r.Lk)("div",R,[t[73]||(t[73]=(0,r.Lk)("div",{class:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center"},[(0,r.Lk)("i",{class:"fas fa-user text-white text-sm"})],-1)),(0,r.Lk)("div",M,[(0,r.Lk)("p",G,(0,n.v_)(a.session?.current?.name||"ผู้ใช้"),1),t[72]||(t[72]=(0,r.Lk)("p",{class:"text-xs text-gray-500"},"ผู้ดูแลระบบ",-1))])])])])]),(0,r.Lk)("div",Q,[(0,r.Lk)("div",j,[(0,r.Lk)("div",U,[t[75]||(t[75]=(0,r.Lk)("h1",{class:"text-lg font-semibold text-gray-900"},"ระบบจัดการ Taxonomy",-1)),(0,r.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>a.toggleMobileSidebar&&a.toggleMobileSidebar(...e)),class:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},t[74]||(t[74]=[(0,r.Lk)("i",{class:"fas fa-bars"},null,-1)]))])]),(0,r.Lk)("div",W,[(0,r.Lk)("div",K,[(0,r.Lk)("div",P,[t[77]||(t[77]=(0,r.Lk)("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[(0,r.Lk)("i",{class:"fas fa-search text-gray-400"})],-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>a.searchQuery=e),onInput:t[11]||(t[11]=(...e)=>a.performSearch&&a.performSearch(...e)),type:"text",placeholder:"ค้นหา Taxonomy และ Terms...",class:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm transition-all duration-200"},null,544),[[i.Jo,a.searchQuery]]),a.searchQuery?((0,r.uX)(),(0,r.CE)("div",H,[(0,r.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>a.clearSearch&&a.clearSearch(...e)),class:"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition-colors"},t[76]||(t[76]=[(0,r.Lk)("i",{class:"fas fa-times text-sm"},null,-1)]))])):(0,r.Q3)("",!0)]),a.searchQuery?((0,r.uX)(),(0,r.CE)("div",q,[(0,r.Lk)("span",N,[(0,r.Lk)("span",B,(0,n.v_)(a.searchResults.groups.length),1),t[78]||(t[78]=(0,r.eW)(" กลุ่ม, ")),(0,r.Lk)("span",V,(0,n.v_)(a.searchResults.terms.length),1),t[79]||(t[79]=(0,r.eW)(" Terms "))])])):(0,r.Q3)("",!0),a.searchQuery?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:t[13]||(t[13]=(...e)=>a.addTaxonomyGroup&&a.addTaxonomyGroup(...e)),type:"button",class:"inline-flex items-center text-sm text-white bg-green-600 hover:bg-green-700 transition-colors duration-200 px-4 py-2 rounded-md font-medium"},t[80]||(t[80]=[(0,r.Lk)("i",{class:"fas fa-plus mr-1.5 text-xs"},null,-1),(0,r.eW)(" เพิ่ม Taxonomy ")])))])]),a.selectedTaxonomyGroup?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",J,[(0,r.Lk)("div",z,[(0,r.Lk)("div",Y,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.getTabsData(),(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.key,onClick:t=>a.selectContentTypeTab(e.key),class:(0,n.C4)(["tab-folder-item cursor-pointer py-2 px-3 text-gray-700 hover:text-blue-600 transition-colors duration-200 bg-opacity-100 relative rounded-t-lg bg-gray-100 mr-1",{"active bg-gray-100 text-blue-600":a.selectedContentTypeTab===e.key,"bg-gray-100 bg-opacity-30":a.selectedContentTypeTab!==e.key}])},[(0,r.Lk)("div",ee,[(0,r.Lk)("i",{class:(0,n.C4)([e.icon,"mr-2 text-sm"]),style:(0,n.Tr)({color:a.selectedContentTypeTab===e.key?"#2563eb":`var(--${e.color}-600)`})},null,6),(0,r.Lk)("div",null,(0,n.v_)(e.label),1),(0,r.Lk)("span",te,(0,n.v_)("all"===a.selectedContentTypeTab&&"all"===e.key||"all"===e.key?a.taxonomyGroups.length:a.taxonomyGroups.filter((t=>t.contentTypes&&t.contentTypes.includes(e.key))).length),1)]),(0,r.Lk)("div",oe,(0,n.v_)(e.subText),1),a.selectedContentTypeTab===e.key?((0,r.uX)(),(0,r.CE)("div",re)):(0,r.Q3)("",!0)],10,Z)))),128))])]),(0,r.Lk)("div",ae,[(0,r.Lk)("div",le,[(0,r.Lk)("button",{onClick:t[14]||(t[14]=(...e)=>a.toggleMobileDropdown&&a.toggleMobileDropdown(...e)),class:"mobile-dropdown-button w-full flex items-center justify-between px-4 py-3 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"},[(0,r.Lk)("div",se,[(0,r.Lk)("div",{class:(0,n.C4)(["w-8 h-8 rounded-md flex items-center justify-center",{"bg-blue-100":"blue"===a.getCurrentTabInfo().color,"bg-green-100":"green"===a.getCurrentTabInfo().color,"bg-purple-100":"purple"===a.getCurrentTabInfo().color,"bg-orange-100":"orange"===a.getCurrentTabInfo().color,"bg-red-100":"red"===a.getCurrentTabInfo().color,"bg-gray-100":"gray"===a.getCurrentTabInfo().color}])},[(0,r.Lk)("i",{class:(0,n.C4)([a.getCurrentTabInfo().icon,"text-sm"]),style:(0,n.Tr)({color:`var(--${a.getCurrentTabInfo().color}-600)`})},null,6)],2),(0,r.Lk)("div",ne,[(0,r.Lk)("div",ie,(0,n.v_)(a.getCurrentTabInfo().label),1),(0,r.Lk)("div",de,(0,n.v_)(a.getCurrentTabInfo().subText),1)])]),(0,r.Lk)("i",{class:(0,n.C4)([a.showMobileDropdown?"fas fa-chevron-up":"fas fa-chevron-down","text-gray-400 text-sm transition-transform duration-200"])},null,2)]),a.showMobileDropdown?((0,r.uX)(),(0,r.CE)("div",ce,[(0,r.Lk)("div",ue,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.getTabsData(),(e=>((0,r.uX)(),(0,r.CE)("button",{key:e.key,onClick:t=>a.selectContentTypeTab(e.key),class:(0,n.C4)(["mobile-dropdown-item w-full flex items-center justify-between px-4 py-3 hover:bg-gray-50 transition-colors",{"selected bg-blue-50 border-r-2 border-blue-500":a.selectedContentTypeTab===e.key,"text-blue-600":a.selectedContentTypeTab===e.key,"text-gray-700":a.selectedContentTypeTab!==e.key}])},[(0,r.Lk)("div",ge,[(0,r.Lk)("div",{class:(0,n.C4)(["w-8 h-8 rounded-md flex items-center justify-center",{"bg-blue-100":"blue"===e.color,"bg-green-100":"green"===e.color,"bg-purple-100":"purple"===e.color,"bg-orange-100":"orange"===e.color,"bg-red-100":"red"===e.color,"bg-gray-100":"gray"===e.color}])},[(0,r.Lk)("i",{class:(0,n.C4)([e.icon,"text-sm"]),style:(0,n.Tr)({color:`var(--${e.color}-600)`})},null,6)],2),(0,r.Lk)("div",pe,[(0,r.Lk)("div",ye,(0,n.v_)(e.label),1),(0,r.Lk)("div",xe,(0,n.v_)(e.subText),1)])]),(0,r.Lk)("div",fe,[(0,r.Lk)("span",be,(0,n.v_)("all"===a.selectedContentTypeTab&&"all"===e.key||"all"===e.key?a.taxonomyGroups.length:a.taxonomyGroups.filter((t=>t.contentTypes&&t.contentTypes.includes(e.key))).length),1),a.selectedContentTypeTab===e.key?((0,r.uX)(),(0,r.CE)("i",ve)):(0,r.Q3)("",!0)])],10,me)))),128))])])):(0,r.Q3)("",!0)])]),a.showMobileDropdown?((0,r.uX)(),(0,r.CE)("div",{key:0,onClick:t[15]||(t[15]=(...e)=>a.closeMobileDropdown&&a.closeMobileDropdown(...e)),class:"fixed inset-0 bg-transparent z-40 md:hidden"})):(0,r.Q3)("",!0)])),(0,r.Lk)("div",ke,[a.selectedTaxonomyGroup?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",he,[(0,r.Lk)("div",Le,[a.searchQuery&&a.searchResults.groups.length>0?((0,r.uX)(),(0,r.CE)("div",Te,[(0,r.Lk)("div",we,[(0,r.Lk)("h3",Ce,[t[81]||(t[81]=(0,r.Lk)("i",{class:"fas fa-search text-blue-600"},null,-1)),(0,r.eW)(" ผลการค้นหากลุ่ม Taxonomy ("+(0,n.v_)(a.searchResults.groups.length)+" รายการ) ",1)]),(0,r.Lk)("div",Ee,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.searchResults.groups,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e._id,onClick:t=>a.selectTaxonomyGroup(e._id),class:"bg-gradient-to-r from-white to-blue-50 border border-blue-200 rounded-lg p-3 cursor-pointer hover:shadow-md transition-all duration-300 group"},[(0,r.Lk)("div",De,[t[82]||(t[82]=(0,r.Lk)("div",{class:"w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center flex-shrink-0"},[(0,r.Lk)("i",{class:"fas fa-folder text-blue-600 text-sm"})],-1)),(0,r.Lk)("div",Fe,[(0,r.Lk)("h4",Ie,(0,n.v_)(e.name),1),e.code?((0,r.uX)(),(0,r.CE)("p",Xe,"รหัส: "+(0,n.v_)(e.code),1)):(0,r.Q3)("",!0),e.description?((0,r.uX)(),(0,r.CE)("p",Se,(0,n.v_)(e.description),1)):(0,r.Q3)("",!0),(0,r.Lk)("div",Oe,[(0,r.Lk)("span",Ae,(0,n.v_)(a.getTermsCountForGroup(e._id))+" Terms ",1),(0,r.Lk)("span",{class:(0,n.C4)([e.active?"text-green-600":"text-red-600","text-xs"])},(0,n.v_)(e.active?"✓ เปิดใช้งาน":"✗ ปิดใช้งาน"),3)])])])],8,_e)))),128))])])])):(0,r.Q3)("",!0),a.searchQuery&&a.searchResults.terms.length>0?((0,r.uX)(),(0,r.CE)("div",$e,[(0,r.Lk)("div",Re,[(0,r.Lk)("h3",Me,[t[83]||(t[83]=(0,r.Lk)("i",{class:"fas fa-tags text-green-600"},null,-1)),(0,r.eW)(" ผลการค้นหา Terms ("+(0,n.v_)(a.searchResults.terms.length)+" รายการ) ",1)]),(0,r.Lk)("div",Ge,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.searchResults.terms,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e._id,onClick:t=>a.selectTaxonomyGroup(e.taxonomy),class:"bg-gradient-to-r from-white to-green-50 border border-green-200 rounded-lg p-3 cursor-pointer hover:shadow-md transition-all duration-300"},[(0,r.Lk)("div",je,[t[84]||(t[84]=(0,r.Lk)("div",{class:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0"},[(0,r.Lk)("i",{class:"fas fa-tag text-green-600 text-sm"})],-1)),(0,r.Lk)("div",Ue,[(0,r.Lk)("div",We,[(0,r.Lk)("h4",Ke,(0,n.v_)(e.customData?.name||e.customData?.ชื่อ||e.name||"ไม่มีชื่อ"),1),(0,r.Lk)("span",Pe,(0,n.v_)(a.getTaxonomyGroupName(e.taxonomy)),1)]),e.customData?((0,r.uX)(),(0,r.CE)("div",He,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.customData,((e,t)=>((0,r.uX)(),(0,r.CE)("span",{key:t,class:"mr-3"},[(0,r.Lk)("strong",null,(0,n.v_)(t)+":",1),(0,r.eW)(" "+(0,n.v_)(e),1)])))),128))])):(0,r.Q3)("",!0)])])],8,Qe)))),128))])])])):(0,r.Q3)("",!0),a.searchQuery&&0===a.searchResults.groups.length&&0===a.searchResults.terms.length?((0,r.uX)(),(0,r.CE)("div",qe,[t[85]||(t[85]=(0,r.Lk)("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},[(0,r.Lk)("i",{class:"fas fa-search text-gray-400 text-xl"})],-1)),t[86]||(t[86]=(0,r.Lk)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"ไม่พบผลลัพธ์",-1)),t[87]||(t[87]=(0,r.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"ลองใช้คำค้นหาอื่นหรือตรวจสอบการสะกดคำ",-1)),(0,r.Lk)("button",{onClick:t[16]||(t[16]=(...e)=>a.clearSearch&&a.clearSearch(...e)),class:"text-blue-600 hover:text-blue-700 font-medium"}," ล้างการค้นหา ")])):"all"===a.selectedContentTypeTab?((0,r.uX)(),(0,r.CE)("div",Ne,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.getTabContent(),((e,o)=>((0,r.uX)(),(0,r.CE)("div",{key:o,class:"mb-6"},[e.groups.length>0?((0,r.uX)(),(0,r.CE)("div",Be,[(0,r.Lk)("div",Ve,[(0,r.Lk)("div",{class:(0,n.C4)(["w-10 h-10 rounded-lg flex items-center justify-center",{"bg-blue-100":"blue"===e.color,"bg-green-100":"green"===e.color,"bg-purple-100":"purple"===e.color,"bg-orange-100":"orange"===e.color,"bg-red-100":"red"===e.color,"bg-gray-100":"gray"===e.color}])},[(0,r.Lk)("i",{class:(0,n.C4)([e.icon,"text-lg"]),style:(0,n.Tr)({color:`var(--${e.color}-600)`})},null,6)],2),(0,r.Lk)("div",Je,[(0,r.Lk)("h3",ze,(0,n.v_)(e.label),1),(0,r.Lk)("p",Ye,(0,n.v_)(e.groups.length)+" Taxonomy",1)]),(0,r.Lk)("button",{onClick:e=>a.selectContentTypeTab(o),class:"text-sm px-3 py-1.5 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors"},t[88]||(t[88]=[(0,r.Lk)("i",{class:"fas fa-eye mr-1"},null,-1),(0,r.eW)("ดูเฉพาะประเภทนี้ ")]),8,Ze)]),(0,r.Lk)("div",et,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.groups,(o=>((0,r.uX)(),(0,r.CE)("div",{key:o._id,onClick:e=>a.selectTaxonomyGroup(o._id),class:"bg-gradient-to-r from-white to-gray-50 border border-gray-200/60 rounded-lg p-3 cursor-pointer hover:shadow-md transition-all duration-300 group taxonomy-group-card flex flex-col min-h-[100px] hover:border-blue-300"},[(0,r.Lk)("div",ot,[(0,r.Lk)("div",{class:(0,n.C4)(["w-8 h-8 rounded-lg flex items-center justify-center group-hover:scale-110 transition-all duration-300 flex-shrink-0",{"bg-gradient-to-br from-blue-100 to-blue-200":"blue"===e.color,"bg-gradient-to-br from-green-100 to-green-200":"green"===e.color,"bg-gradient-to-br from-purple-100 to-purple-200":"purple"===e.color,"bg-gradient-to-br from-orange-100 to-orange-200":"orange"===e.color,"bg-gradient-to-br from-red-100 to-red-200":"red"===e.color,"bg-gradient-to-br from-gray-100 to-gray-200":"gray"===e.color}])},[(0,r.Lk)("i",{class:(0,n.C4)([e.icon,"text-sm"]),style:(0,n.Tr)({color:`var(--${e.color}-600)`})},null,6)],2),(0,r.Lk)("div",rt,[(0,r.Lk)("h3",at,(0,n.v_)(o.name),1),(0,r.Lk)("div",lt,[o.code?((0,r.uX)(),(0,r.CE)("p",st,"รหัส: "+(0,n.v_)(o.code),1)):(0,r.Q3)("",!0),o.description?((0,r.uX)(),(0,r.CE)("p",nt,(0,n.v_)(o.description),1)):(0,r.Q3)("",!0),o.code||o.description?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",it))]),(0,r.Lk)("div",dt,[(0,r.Lk)("span",ct,[t[89]||(t[89]=(0,r.Lk)("i",{class:"fas fa-tag mr-1 text-xs"},null,-1)),(0,r.eW)((0,n.v_)(a.getTermsCountForGroup(o._id)),1)]),(0,r.Lk)("span",{class:(0,n.C4)([o.active?"bg-gradient-to-r from-emerald-100 to-green-200 text-green-800 border-green-200":"bg-gradient-to-r from-red-100 to-red-200 text-red-800 border-red-200","inline-flex items-center px-1.5 py-0.5 text-xs font-medium rounded-full border"])},[(0,r.Lk)("i",{class:(0,n.C4)([o.active?"fas fa-check-circle":"fas fa-pause-circle","mr-1 text-xs"])},null,2),(0,r.eW)(" "+(0,n.v_)(o.active?"เปิด":"ปิด"),1)],2)])])])],8,tt)))),128))])])):(0,r.Q3)("",!0)])))),128)),0===a.taxonomyGroups.length?((0,r.uX)(),(0,r.CE)("div",ut,[t[91]||(t[91]=(0,r.Lk)("div",{class:"w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-4"},[(0,r.Lk)("i",{class:"fas fa-tags text-gray-400 text-xl"})],-1)),t[92]||(t[92]=(0,r.Lk)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"ยังไม่มี Taxonomy",-1)),t[93]||(t[93]=(0,r.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"เริ่มต้นด้วยการสร้าง Taxonomy แรกและระบุประเภทเนื้อหาที่เกี่ยวข้อง",-1)),(0,r.Lk)("button",{onClick:t[17]||(t[17]=(...e)=>a.addTaxonomyGroup&&a.addTaxonomyGroup(...e)),class:"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-6 py-3 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-md"},t[90]||(t[90]=[(0,r.Lk)("i",{class:"fas fa-plus mr-2"},null,-1),(0,r.eW)("เพิ่ม Taxonomy แรก ")]))])):(0,r.Q3)("",!0)])):((0,r.uX)(),(0,r.CE)("div",mt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.getTabContent(),((e,o)=>((0,r.uX)(),(0,r.CE)("div",{key:o},[(0,r.Lk)("div",gt,[(0,r.Lk)("div",{class:(0,n.C4)(["w-12 h-12 rounded-lg flex items-center justify-center",{"bg-blue-100":"blue"===e.color,"bg-green-100":"green"===e.color,"bg-purple-100":"purple"===e.color,"bg-orange-100":"orange"===e.color,"bg-red-100":"red"===e.color,"bg-gray-100":"gray"===e.color}])},[(0,r.Lk)("i",{class:(0,n.C4)([e.icon,"text-xl"]),style:(0,n.Tr)({color:`var(--${e.color}-600)`})},null,6)],2),(0,r.Lk)("div",pt,[(0,r.Lk)("h3",yt," Taxonomy สำหรับ"+(0,n.v_)(e.label),1),(0,r.Lk)("p",xt,(0,n.v_)(e.groups.length)+" กลุ่ม",1)]),(0,r.Lk)("button",{onClick:t[18]||(t[18]=e=>a.selectContentTypeTab("all")),class:"text-sm px-3 py-1.5 bg-white text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"},t[94]||(t[94]=[(0,r.Lk)("i",{class:"fas fa-list mr-1"},null,-1),(0,r.eW)("แสดงทั้งหมด ")]))]),(0,r.Lk)("div",ft,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.groups,(o=>((0,r.uX)(),(0,r.CE)("div",{key:o._id,onClick:e=>a.selectTaxonomyGroup(o._id),class:"bg-gradient-to-r from-white to-gray-50 border border-gray-200/60 rounded-lg p-3 cursor-pointer hover:shadow-md transition-all duration-300 group taxonomy-group-card flex flex-col min-h-[100px] hover:border-blue-300"},[(0,r.Lk)("div",vt,[(0,r.Lk)("div",{class:(0,n.C4)(["w-8 h-8 rounded-lg flex items-center justify-center group-hover:scale-110 transition-all duration-300 flex-shrink-0",{"bg-gradient-to-br from-blue-100 to-blue-200":"blue"===e.color,"bg-gradient-to-br from-green-100 to-green-200":"green"===e.color,"bg-gradient-to-br from-purple-100 to-purple-200":"purple"===e.color,"bg-gradient-to-br from-orange-100 to-orange-200":"orange"===e.color,"bg-gradient-to-br from-red-100 to-red-200":"red"===e.color,"bg-gradient-to-br from-gray-100 to-gray-200":"gray"===e.color}])},[(0,r.Lk)("i",{class:(0,n.C4)([e.icon,"text-sm"]),style:(0,n.Tr)({color:`var(--${e.color}-600)`})},null,6)],2),(0,r.Lk)("div",kt,[(0,r.Lk)("h3",ht,(0,n.v_)(o.name),1),(0,r.Lk)("div",Lt,[o.code?((0,r.uX)(),(0,r.CE)("p",Tt,"รหัส: "+(0,n.v_)(o.code),1)):(0,r.Q3)("",!0),o.description?((0,r.uX)(),(0,r.CE)("p",wt,(0,n.v_)(o.description),1)):(0,r.Q3)("",!0),o.code||o.description?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Ct))]),(0,r.Lk)("div",Et,[(0,r.Lk)("span",_t,[t[95]||(t[95]=(0,r.Lk)("i",{class:"fas fa-tag mr-1 text-xs"},null,-1)),(0,r.eW)((0,n.v_)(a.getTermsCountForGroup(o._id)),1)]),(0,r.Lk)("span",{class:(0,n.C4)([o.active?"bg-gradient-to-r from-emerald-100 to-green-200 text-green-800 border-green-200":"bg-gradient-to-r from-red-100 to-red-200 text-red-800 border-red-200","inline-flex items-center px-1.5 py-0.5 text-xs font-medium rounded-full border"])},[(0,r.Lk)("i",{class:(0,n.C4)([o.active?"fas fa-check-circle":"fas fa-pause-circle","mr-1 text-xs"])},null,2),(0,r.eW)(" "+(0,n.v_)(o.active?"เปิด":"ปิด"),1)],2)])])])],8,bt)))),128))])])))),128))]))])])),a.selectedTaxonomyGroup?((0,r.uX)(),(0,r.CE)("div",Dt,[(0,r.Lk)("div",Ft,[(0,r.Lk)("div",It,[(0,r.Lk)("div",Xt,[(0,r.Lk)("button",{onClick:t[19]||(t[19]=(...e)=>a.backToGroupSelection&&a.backToGroupSelection(...e)),class:"p-2 text-gray-400 hover:text-gray-700 hover:bg-gray-100 rounded-md transition-colors"},t[96]||(t[96]=[(0,r.Lk)("i",{class:"fas fa-arrow-left text-sm"},null,-1)])),(0,r.Lk)("div",null,[(0,r.Lk)("h2",St,[t[97]||(t[97]=(0,r.Lk)("i",{class:"fas fa-tags text-blue-600"},null,-1)),(0,r.eW)((0,n.v_)(a.getCurrentTaxonomyGroupTitle()),1)]),a.getCurrentTaxonomyGroup()?.description?((0,r.uX)(),(0,r.CE)("p",Ot,(0,n.v_)(a.getCurrentTaxonomyGroup().description),1)):(0,r.Q3)("",!0)])])]),(0,r.Lk)("div",At,[(0,r.Lk)("div",$t,[(0,r.Lk)("div",Rt,[(0,r.Lk)("div",null,[t[98]||(t[98]=(0,r.Lk)("p",{class:"text-xs text-blue-600 font-medium"},"Terms ทั้งหมด",-1)),(0,r.Lk)("p",Mt,(0,n.v_)(a.getTermsForGroup().length),1)]),t[99]||(t[99]=(0,r.Lk)("i",{class:"fas fa-tags text-blue-400 text-lg"},null,-1))])]),(0,r.Lk)("div",Gt,[(0,r.Lk)("div",Qt,[(0,r.Lk)("div",null,[t[100]||(t[100]=(0,r.Lk)("p",{class:"text-xs text-green-600 font-medium"},"Root Terms",-1)),(0,r.Lk)("p",jt,(0,n.v_)(a.getRootTerms().length),1)]),t[101]||(t[101]=(0,r.Lk)("i",{class:"fas fa-layer-group text-green-400 text-lg"},null,-1))])]),(0,r.Lk)("div",Ut,[(0,r.Lk)("div",Wt,[(0,r.Lk)("div",null,[t[102]||(t[102]=(0,r.Lk)("p",{class:"text-xs text-purple-600 font-medium"},"Sub Terms",-1)),(0,r.Lk)("p",Kt,(0,n.v_)(a.getSubTermsCount()),1)]),t[103]||(t[103]=(0,r.Lk)("i",{class:"fas fa-sitemap text-purple-400 text-lg"},null,-1))])]),(0,r.Lk)("div",Pt,[(0,r.Lk)("div",Ht,[(0,r.Lk)("div",null,[t[104]||(t[104]=(0,r.Lk)("p",{class:"text-xs text-orange-600 font-medium"},"Terms ที่ใช้งาน",-1)),(0,r.Lk)("p",qt,(0,n.v_)(a.getActiveTermsCount()),1)]),t[105]||(t[105]=(0,r.Lk)("i",{class:"fas fa-check-circle text-orange-400 text-lg"},null,-1))])])]),(0,r.Lk)("div",Nt,[(0,r.Lk)("button",{onClick:t[20]||(t[20]=(...e)=>a.editTaxonomyGroup&&a.editTaxonomyGroup(...e)),class:"text-xs px-3 py-1.5 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors font-medium"},t[106]||(t[106]=[(0,r.Lk)("i",{class:"fas fa-edit mr-1"},null,-1),(0,r.eW)("แก้ไข Taxonomy ")])),(0,r.Lk)("button",{onClick:t[21]||(t[21]=(...e)=>a.showGroupHistory&&a.showGroupHistory(...e)),class:"text-xs px-3 py-1.5 bg-purple-100 text-purple-700 rounded-md hover:bg-purple-200 transition-colors font-medium"},t[107]||(t[107]=[(0,r.Lk)("i",{class:"fas fa-history mr-1"},null,-1),(0,r.eW)("ประวัติ ")])),(0,r.Lk)("button",{onClick:t[22]||(t[22]=(...e)=>a.exportData&&a.exportData(...e)),class:"text-xs px-3 py-1.5 bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-colors font-medium"},t[108]||(t[108]=[(0,r.Lk)("i",{class:"fas fa-download mr-1"},null,-1),(0,r.eW)("ส่งออก ")])),t[110]||(t[110]=(0,r.Lk)("div",{class:"flex-1"},null,-1)),(0,r.Lk)("button",{onClick:t[23]||(t[23]=(...e)=>a.deleteTaxonomyGroup&&a.deleteTaxonomyGroup(...e)),class:"text-xs px-3 py-1.5 bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition-colors font-medium"},t[109]||(t[109]=[(0,r.Lk)("i",{class:"fas fa-trash mr-1"},null,-1),(0,r.eW)("ลบ Taxonomy ")]))])]),(0,r.Lk)("div",Bt,[0===a.getRootTerms().length?((0,r.uX)(),(0,r.CE)("div",Vt,[t[112]||(t[112]=(0,r.Lk)("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},[(0,r.Lk)("i",{class:"fas fa-tag text-gray-400 text-xl"})],-1)),t[113]||(t[113]=(0,r.Lk)("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"ยังไม่มี Terms ในกลุ่มนี้",-1)),t[114]||(t[114]=(0,r.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"เริ่มต้นสร้าง Term แรกเพื่อจัดหมวดหมู่ข้อมูล",-1)),(0,r.Lk)("button",{onClick:t[24]||(t[24]=e=>a.addTerm(null)),type:"button",class:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-colors font-medium"},t[111]||(t[111]=[(0,r.Lk)("i",{class:"fas fa-plus mr-2"},null,-1),(0,r.eW)("สร้าง Term แรก ")]))])):((0,r.uX)(),(0,r.CE)("div",Jt,[(0,r.Lk)("div",zt,[(0,r.Lk)("h4",Yt,[t[115]||(t[115]=(0,r.Lk)("i",{class:"fas fa-list text-blue-600"},null,-1)),(0,r.eW)("รายการ Terms ("+(0,n.v_)(a.getRootTerms().length)+" รายการ) ",1)]),(0,r.Lk)("button",{onClick:t[25]||(t[25]=e=>a.addTerm(null)),type:"button",class:"bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-md text-sm transition-colors font-medium"},t[116]||(t[116]=[(0,r.Lk)("i",{class:"fas fa-plus mr-1"},null,-1),(0,r.eW)("เพิ่ม Root Term ")]))]),(0,r.Lk)("div",Zt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.getRootTerms(),(e=>((0,r.uX)(),(0,r.Wv)(br,{key:e._id,"term-data":e,level:0,"all-terms":a.terms,"expanded-terms":a.expandedTerms,"onUpdate:expandedTerms":t[26]||(t[26]=e=>a.expandedTerms=e),onAddTerm:a.addTerm,onEditTerm:a.editTerm,onDeleteTerm:a.deleteTerm,onCloneTerm:a.cloneTerm,onMoveTermUp:a.moveTermUp,onMoveTermDown:a.moveTermDown,onShowTermHistory:a.showTermHistoryHandler},null,8,["term-data","all-terms","expanded-terms","onAddTerm","onEditTerm","onDeleteTerm","onCloneTerm","onMoveTermUp","onMoveTermDown","onShowTermHistory"])))),128))])]))])])):(0,r.Q3)("",!0)])]),a.showMobileSidebar?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-50",onClick:t[31]||(t[31]=(...e)=>a.toggleMobileSidebar&&a.toggleMobileSidebar(...e))},[(0,r.Lk)("div",{class:"w-64 h-full bg-white transform transition-transform duration-300",onClick:t[30]||(t[30]=(0,i.D$)((()=>{}),["stop"]))},[(0,r.Lk)("div",eo,[(0,r.Lk)("div",to,[(0,r.Lk)("div",oo,[t[118]||(t[118]=(0,r.Lk)("div",{class:"w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center"},[(0,r.Lk)("i",{class:"fas fa-tags text-white text-sm"})],-1)),(0,r.Lk)("div",null,[t[117]||(t[117]=(0,r.Lk)("h1",{class:"text-base font-semibold text-gray-900"},"Taxonomy",-1)),(0,r.Lk)("p",ro,(0,n.v_)(a.taxonomyGroups.length)+" กลุ่ม",1)])]),(0,r.Lk)("button",{onClick:t[27]||(t[27]=(...e)=>a.toggleMobileSidebar&&a.toggleMobileSidebar(...e)),class:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},t[119]||(t[119]=[(0,r.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,r.Lk)("div",ao,[t[126]||(t[126]=(0,r.Lk)("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"กลุ่ม Taxonomy",-1)),(0,r.Lk)("div",lo,[t[124]||(t[124]=(0,r.Lk)("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"กรองตามประเภทเนื้อหา",-1)),(0,r.Lk)("div",so,[(0,r.Lk)("button",{onClick:t[28]||(t[28]=e=>a.selectContentType("")),class:(0,n.C4)(["w-full flex items-center gap-2 px-2 py-1.5 text-xs rounded-md transition-colors duration-200",{"bg-blue-100 text-blue-700 font-medium":""===a.selectedContentType,"text-gray-600 hover:bg-gray-100 hover:text-gray-900":""!==a.selectedContentType}])},[t[120]||(t[120]=(0,r.Lk)("i",{class:"fas fa-list text-xs w-3"},null,-1)),t[121]||(t[121]=(0,r.Lk)("span",null,"ทั้งหมด",-1)),(0,r.Lk)("span",no,(0,n.v_)(a.taxonomyGroups.length),1)],2),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.getContentTypesDisplay(),(e=>((0,r.uX)(),(0,r.CE)("button",{key:e.key,onClick:t=>a.selectContentType(e.key),class:(0,n.C4)(["w-full flex items-center gap-2 px-2 py-1.5 text-xs rounded-md transition-colors duration-200",{"bg-blue-100 text-blue-700 font-medium":a.selectedContentType===e.key,"text-gray-600 hover:bg-gray-100 hover:text-gray-900":a.selectedContentType!==e.key}])},[(0,r.Lk)("i",{class:(0,n.C4)([e.icon,"text-xs w-3"]),style:(0,n.Tr)({color:a.selectedContentType===e.key?"":`var(--${e.color}-500)`})},null,6),(0,r.Lk)("span",null,(0,n.v_)(e.label),1),(0,r.Lk)("span",co,(0,n.v_)(a.taxonomyGroups.filter((t=>t.contentTypes&&t.contentTypes.includes(e.key))).length),1)],10,io)))),128)),a.taxonomyGroups.filter((e=>!e.contentTypes||0===e.contentTypes.length)).length>0?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[29]||(t[29]=e=>a.selectContentType("unassigned")),class:(0,n.C4)(["w-full flex items-center gap-2 px-2 py-1.5 text-xs rounded-md transition-colors duration-200",{"bg-blue-100 text-blue-700 font-medium":"unassigned"===a.selectedContentType,"text-gray-600 hover:bg-gray-100 hover:text-gray-900":"unassigned"!==a.selectedContentType}])},[t[122]||(t[122]=(0,r.Lk)("i",{class:"fas fa-question-circle text-xs w-3 text-gray-400"},null,-1)),t[123]||(t[123]=(0,r.Lk)("span",null,"ไม่ได้ระบุประเภท",-1)),(0,r.Lk)("span",uo,(0,n.v_)(a.taxonomyGroups.filter((e=>!e.contentTypes||0===e.contentTypes.length)).length),1)],2)):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",mo,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.getFilteredTaxonomyGroups(),(e=>((0,r.uX)(),(0,r.CE)("button",{key:e._id,onClick:t=>a.selectTaxonomyGroupAndCloseMobile(e._id),class:(0,n.C4)(["w-full flex items-center gap-3 px-3 py-2 text-sm rounded-lg transition-colors duration-200",{"bg-green-100 text-green-700 font-medium":a.selectedTaxonomyGroup===e._id,"text-gray-600 hover:bg-gray-100 hover:text-gray-900":a.selectedTaxonomyGroup!==e._id}])},[t[125]||(t[125]=(0,r.Lk)("i",{class:"fas fa-folder text-sm w-4"},null,-1)),(0,r.Lk)("div",po,[(0,r.Lk)("div",yo,(0,n.v_)(e.name),1),e.contentTypes&&e.contentTypes.length>0?((0,r.uX)(),(0,r.CE)("div",xo,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.contentTypes,((t,o)=>((0,r.uX)(),(0,r.CE)("span",{key:t,class:"inline-flex items-center gap-1"},[(0,r.Lk)("i",{class:(0,n.C4)([a.getContentTypeInfo(t).icon,"text-xs"])},null,2),(0,r.eW)(" "+(0,n.v_)(a.getContentTypeInfo(t).label)+" ",1),o<e.contentTypes.length-1?((0,r.uX)(),(0,r.CE)("span",fo,", ")):(0,r.Q3)("",!0)])))),128))])):(0,r.Q3)("",!0)]),a.getTermsCountForGroup(e._id)>0?((0,r.uX)(),(0,r.CE)("span",{key:0,class:(0,n.C4)(["px-2 py-1 text-xs rounded-full",{"bg-green-200 text-green-800":a.selectedTaxonomyGroup===e._id,"bg-gray-200 text-gray-600":a.selectedTaxonomyGroup!==e._id}])},(0,n.v_)(a.getTermsCountForGroup(e._id)),3)):(0,r.Q3)("",!0)],10,go)))),128))])])])])])):(0,r.Q3)("",!0),a.showTermModal?((0,r.uX)(),(0,r.CE)("div",bo,[(0,r.Lk)("div",vo,[(0,r.Lk)("div",ko,[(0,r.Lk)("h3",ho,(0,n.v_)(a.editingTerm?"แก้ไข Term":"เพิ่ม Term ใหม่"),1),(0,r.Lk)("button",{onClick:t[32]||(t[32]=(...e)=>a.closeTermModal&&a.closeTermModal(...e)),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors"},t[127]||(t[127]=[(0,r.Lk)("i",{class:"fas fa-times text-sm"},null,-1)]))]),(0,r.Lk)("div",Lo,[(0,r.bF)(vr,{fieldConfig:a.getCurrentFieldConfig(),customData:a.termForm.customData,showValidation:!1,existingTerms:a.terms,currentTermId:a.editingTerm?._id,taxonomyGroupId:a.selectedTaxonomyGroup,"onUpdate:customData":t[33]||(t[33]=e=>a.termForm.customData=e)},null,8,["fieldConfig","customData","existingTerms","currentTermId","taxonomyGroupId"]),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[34]||(t[34]=e=>a.termForm.sortOrder=e),type:"hidden"},null,512),[[i.Jo,a.termForm.sortOrder,void 0,{number:!0}]])]),(0,r.Lk)("div",To,[(0,r.Lk)("button",{onClick:t[35]||(t[35]=(...e)=>a.closeTermModal&&a.closeTermModal(...e)),class:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 font-medium"}," ยกเลิก "),(0,r.Lk)("button",{onClick:t[36]||(t[36]=(...e)=>a.saveTerm&&a.saveTerm(...e)),class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 font-medium"},(0,n.v_)(a.editingTerm?"อัปเดต":"เพิ่ม"),1)])])])):(0,r.Q3)("",!0),a.showTaxonomyModal?((0,r.uX)(),(0,r.CE)("div",wo,[(0,r.Lk)("div",Co,[(0,r.Lk)("div",Eo,[(0,r.Lk)("h3",_o,(0,n.v_)(a.editingTaxonomyGroup?"แก้ไข Taxonomy":"เพิ่ม Taxonomy ใหม่"),1),(0,r.Lk)("button",{onClick:t[37]||(t[37]=(...e)=>a.closeTaxonomyModal&&a.closeTaxonomyModal(...e)),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors"},t[128]||(t[128]=[(0,r.Lk)("i",{class:"fas fa-times text-lg"},null,-1)]))]),(0,r.Lk)("div",Do,[(0,r.Lk)("div",Fo,[(0,r.Lk)("button",{onClick:t[38]||(t[38]=e=>a.selectedTaxonomyModalTab="basic"),class:(0,n.C4)(["px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200",{"bg-white text-blue-600 shadow-sm border border-gray-200":"basic"===a.selectedTaxonomyModalTab,"text-gray-600 hover:text-gray-900 hover:bg-gray-50":"basic"!==a.selectedTaxonomyModalTab}])},t[129]||(t[129]=[(0,r.Lk)("i",{class:"fas fa-info-circle mr-2"},null,-1),(0,r.eW)(" ข้อมูลพื้นฐาน ")]),2),(0,r.Lk)("button",{onClick:t[39]||(t[39]=e=>a.selectedTaxonomyModalTab="fields"),class:(0,n.C4)(["px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200",{"bg-white text-blue-600 shadow-sm border border-gray-200":"fields"===a.selectedTaxonomyModalTab,"text-gray-600 hover:text-gray-900 hover:bg-gray-50":"fields"!==a.selectedTaxonomyModalTab}])},t[130]||(t[130]=[(0,r.Lk)("i",{class:"fas fa-cogs mr-2"},null,-1),(0,r.eW)(" การตั้งค่าฟิลด์ ")]),2)])]),(0,r.Lk)("div",Io,["basic"===a.selectedTaxonomyModalTab?((0,r.uX)(),(0,r.CE)("div",Xo,[(0,r.Lk)("div",So,[(0,r.Lk)("div",null,[t[131]||(t[131]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[(0,r.Lk)("i",{class:"fas fa-tag text-blue-600 mr-2"}),(0,r.eW)(" ชื่อ Taxonomy * ")],-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[40]||(t[40]=e=>a.taxonomyGroupForm.name=e),type:"text",placeholder:"ชื่อกลุ่ม Taxonomy",class:"w-full px-4 py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"},null,512),[[i.Jo,a.taxonomyGroupForm.name]])]),(0,r.Lk)("div",null,[t[132]||(t[132]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[(0,r.Lk)("i",{class:"fas fa-code text-purple-600 mr-2"}),(0,r.eW)(" รหัสกลุ่ม ")],-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[41]||(t[41]=e=>a.taxonomyGroupForm.code=e),type:"text",placeholder:"เช่น SUBJECT, LEVEL, DEPARTMENT (ไม่บังคับ)",class:"w-full px-4 py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"},null,512),[[i.Jo,a.taxonomyGroupForm.code]]),t[133]||(t[133]=(0,r.Lk)("p",{class:"text-xs text-gray-500 mt-2"},"รหัสสำหรับอ้างอิงในระบบ ควรเป็นภาษาอังกฤษ ไม่มีช่องว่าง",-1))]),(0,r.Lk)("div",Oo,[(0,r.Lk)("label",Ao,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[42]||(t[42]=e=>a.taxonomyGroupForm.active=e),type:"checkbox",class:"mr-3 h-4 w-4 rounded border-gray-300 text-green-600 focus:ring-green-500"},null,512),[[i.lH,a.taxonomyGroupForm.active]]),t[134]||(t[134]=(0,r.Lk)("i",{class:"fas fa-toggle-on text-green-600 mr-2"},null,-1)),t[135]||(t[135]=(0,r.eW)(" เปิดใช้งาน (Active) "))]),t[136]||(t[136]=(0,r.Lk)("p",{class:"text-xs text-gray-500 mt-2 ml-7"},"ยกเลิกการเลือกเพื่อปิดใช้งานกลุ่มนี้ชั่วคราว",-1))]),(0,r.Lk)("div",null,[t[137]||(t[137]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[(0,r.Lk)("i",{class:"fas fa-layer-group text-orange-600 mr-2"}),(0,r.eW)(" ประเภทเนื้อหาที่เกี่ยวข้อง * ")],-1)),(0,r.Lk)("div",$o,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.getContentTypesDisplay(),(e=>((0,r.uX)(),(0,r.CE)("label",{key:e.key,class:(0,n.C4)(["flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-all duration-200",{"border-blue-500 bg-blue-50 shadow-sm":a.taxonomyGroupForm.contentTypes.includes(e.key),"border-gray-200 hover:border-gray-300":!a.taxonomyGroupForm.contentTypes.includes(e.key)}])},[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:e.key,"onUpdate:modelValue":t[43]||(t[43]=e=>a.taxonomyGroupForm.contentTypes=e),class:"mr-2 h-3 w-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Ro),[[i.lH,a.taxonomyGroupForm.contentTypes]]),(0,r.Lk)("div",{class:(0,n.C4)(["w-8 h-8 rounded-lg flex items-center justify-center mr-2 flex-shrink-0",{"bg-blue-100":"blue"===e.color,"bg-green-100":"green"===e.color,"bg-purple-100":"purple"===e.color,"bg-orange-100":"orange"===e.color,"bg-red-100":"red"===e.color,"bg-gray-100":"gray"===e.color}])},[(0,r.Lk)("i",{class:(0,n.C4)([e.icon,"text-sm"]),style:(0,n.Tr)({color:`var(--${e.color}-600)`})},null,6)],2),(0,r.Lk)("div",Mo,[(0,r.Lk)("div",Go,(0,n.v_)(e.label),1),(0,r.Lk)("div",Qo,(0,n.v_)(e.key),1)])],2)))),128))]),t[138]||(t[138]=(0,r.Lk)("p",{class:"text-xs text-gray-500 mt-2"},"เลือกประเภทเนื้อหาที่ Taxonomy นี้จะใช้งานด้วย (เลือกได้หลายประเภท)",-1))]),(0,r.Lk)("div",null,[t[145]||(t[145]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-3"},[(0,r.Lk)("i",{class:"fas fa-mouse-pointer text-purple-600 mr-2"}),(0,r.eW)(" โหมดการเลือก Terms ")],-1)),(0,r.Lk)("div",jo,[(0,r.Lk)("div",Uo,[(0,r.Lk)("label",Wo,[(0,r.bo)((0,r.Lk)("input",{type:"radio",value:"single","onUpdate:modelValue":t[44]||(t[44]=e=>a.taxonomyGroupForm.selectionMode=e),class:"form-radio text-blue-600 focus:ring-blue-500"},null,512),[[i.XL,a.taxonomyGroupForm.selectionMode]]),t[139]||(t[139]=(0,r.Lk)("span",{class:"ml-2 text-sm"},[(0,r.Lk)("strong",null,"เลือกได้หนึ่งรายการ"),(0,r.Lk)("div",{class:"text-xs text-gray-500"},"ผู้ใช้เลือกได้เพียง term เดียวในกลุ่มนี้")],-1))]),(0,r.Lk)("label",Ko,[(0,r.bo)((0,r.Lk)("input",{type:"radio",value:"multiple","onUpdate:modelValue":t[45]||(t[45]=e=>a.taxonomyGroupForm.selectionMode=e),class:"form-radio text-blue-600 focus:ring-blue-500"},null,512),[[i.XL,a.taxonomyGroupForm.selectionMode]]),t[140]||(t[140]=(0,r.Lk)("span",{class:"ml-2 text-sm"},[(0,r.Lk)("strong",null,"เลือกได้หลายรายการ"),(0,r.Lk)("div",{class:"text-xs text-gray-500"},"ผู้ใช้สามารถเลือกได้หลาย terms")],-1))]),(0,r.Lk)("label",Po,[(0,r.bo)((0,r.Lk)("input",{type:"radio",value:"limited","onUpdate:modelValue":t[46]||(t[46]=e=>a.taxonomyGroupForm.selectionMode=e),class:"form-radio text-blue-600 focus:ring-blue-500"},null,512),[[i.XL,a.taxonomyGroupForm.selectionMode]]),t[141]||(t[141]=(0,r.Lk)("span",{class:"ml-2 text-sm"},[(0,r.Lk)("strong",null,"เลือกได้จำกัด"),(0,r.Lk)("div",{class:"text-xs text-gray-500"},"กำหนดจำนวนสูงสุดที่เลือกได้")],-1))])]),"limited"===a.taxonomyGroupForm.selectionMode?((0,r.uX)(),(0,r.CE)("div",Ho,[t[143]||(t[143]=(0,r.Lk)("label",{class:"block text-sm font-medium text-purple-800 mb-2"},[(0,r.Lk)("i",{class:"fas fa-hashtag text-purple-600 mr-1"}),(0,r.eW)(" จำนวนสูงสุดที่เลือกได้ ")],-1)),(0,r.Lk)("div",qo,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[47]||(t[47]=e=>a.taxonomyGroupForm.selectionLimit=e),type:"number",min:"1",max:"50",placeholder:"เช่น 3",class:"w-24 px-3 py-2 border border-purple-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"},null,512),[[i.Jo,a.taxonomyGroupForm.selectionLimit,void 0,{number:!0}]]),t[142]||(t[142]=(0,r.Lk)("span",{class:"text-sm text-purple-700"},"รายการ",-1))]),(0,r.Lk)("p",No," ผู้ใช้จะสามารถเลือกได้สูงสุด "+(0,n.v_)(a.taxonomyGroupForm.selectionLimit||1)+" รายการจากกลุ่มนี้ ",1)])):(0,r.Q3)("",!0),(0,r.Lk)("div",Bo,[t[144]||(t[144]=(0,r.Lk)("h5",{class:"text-sm font-medium text-blue-800 mb-2"},[(0,r.Lk)("i",{class:"fas fa-info-circle text-blue-600 mr-1"}),(0,r.eW)(" ตัวอย่างการใช้งาน ")],-1)),(0,r.Lk)("div",Vo,["single"===a.taxonomyGroupForm.selectionMode?((0,r.uX)(),(0,r.CE)("div",Jo," • เหมาะสำหรับ: ระดับความยาก, ประเภทหลักสูตร, สถานะ ")):"multiple"===a.taxonomyGroupForm.selectionMode?((0,r.uX)(),(0,r.CE)("div",zo," • เหมาะสำหรับ: หมวดหมู่, แท็ก, ทักษะที่ได้รับ ")):"limited"===a.taxonomyGroupForm.selectionMode?((0,r.uX)(),(0,r.CE)("div",Yo," • เหมาะสำหรับ: หมวดหมู่หลัก (เลือกได้ "+(0,n.v_)(a.taxonomyGroupForm.selectionLimit||1)+" หมวด), ผู้สอนหลัก ",1)):(0,r.Q3)("",!0)])])])]),(0,r.Lk)("div",null,[t[146]||(t[146]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[(0,r.Lk)("i",{class:"fas fa-align-left text-gray-600 mr-2"}),(0,r.eW)(" คำอธิบาย ")],-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":t[48]||(t[48]=e=>a.taxonomyGroupForm.description=e),rows:"4",placeholder:"คำอธิบายกลุ่ม Taxonomy (ไม่บังคับ)",class:"w-full px-4 py-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-vertical transition-all duration-200"},null,512),[[i.Jo,a.taxonomyGroupForm.description]])])])])):(0,r.Q3)("",!0),"fields"===a.selectedTaxonomyModalTab?((0,r.uX)(),(0,r.CE)("div",Zo,[t[147]||(t[147]=(0,r.Lk)("div",{class:"mb-4"},[(0,r.Lk)("h4",{class:"text-lg font-semibold text-gray-900 mb-2"},[(0,r.Lk)("i",{class:"fas fa-cogs text-blue-600 mr-2"}),(0,r.eW)(" การตั้งค่าฟิลด์สำหรับ Terms ")]),(0,r.Lk)("p",{class:"text-sm text-gray-600 mb-4"}," กำหนดฟิลด์ที่จะใช้เก็บข้อมูลใน Terms ของ Taxonomy นี้ เช่น ชื่อ, รหัส, สถานะ, รูปภาพ, คำอธิบาย เป็นต้น ")],-1)),(0,r.bF)(kr,{fieldConfig:a.taxonomyGroupForm.fieldConfig,"onUpdate:fieldConfig":t[49]||(t[49]=e=>a.taxonomyGroupForm.fieldConfig=e)},null,8,["fieldConfig"])])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",er,[(0,r.Lk)("div",tr,["basic"===a.selectedTaxonomyModalTab?((0,r.uX)(),(0,r.CE)("span",or,t[148]||(t[148]=[(0,r.Lk)("i",{class:"fas fa-info-circle mr-1"},null,-1),(0,r.eW)(" กรอกข้อมูลพื้นฐานของ Taxonomy ")]))):((0,r.uX)(),(0,r.CE)("span",rr,t[149]||(t[149]=[(0,r.Lk)("i",{class:"fas fa-cogs mr-1"},null,-1),(0,r.eW)(" ตั้งค่าฟิลด์สำหรับเก็บข้อมูล Terms ")])))]),(0,r.Lk)("div",ar,[(0,r.Lk)("button",{onClick:t[50]||(t[50]=(...e)=>a.closeTaxonomyModal&&a.closeTaxonomyModal(...e)),class:"px-5 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-medium transition-colors duration-200"},t[150]||(t[150]=[(0,r.Lk)("i",{class:"fas fa-times mr-1"},null,-1),(0,r.eW)(" ยกเลิก ")])),(0,r.Lk)("button",{onClick:t[51]||(t[51]=(...e)=>a.saveTaxonomyGroup&&a.saveTaxonomyGroup(...e)),class:"px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors duration-200"},[t[151]||(t[151]=(0,r.Lk)("i",{class:"fas fa-save mr-1"},null,-1)),(0,r.eW)(" "+(0,n.v_)(a.editingTaxonomyGroup?"อัปเดต":"เพิ่ม Taxonomy"),1)])])])])])):(0,r.Q3)("",!0),a.showDeleteModal?((0,r.uX)(),(0,r.CE)("div",lr,[(0,r.Lk)("div",sr,[t[156]||(t[156]=(0,r.Lk)("div",{class:"px-4 py-3 border-b border-gray-200"},[(0,r.Lk)("h3",{class:"text-lg font-semibold text-red-800"}," ยืนยันการลบ ")],-1)),(0,r.Lk)("div",nr,[(0,r.Lk)("div",ir,[(0,r.Lk)("p",dr,[t[152]||(t[152]=(0,r.Lk)("strong",null,"คุณแน่ใจหรือไม่ที่จะลบ:",-1)),(0,r.Lk)("span",cr,'"'+(0,n.v_)(a.termToDelete?.name)+'"',1)]),a.termToDelete&&a.getDeletePreview(a.termToDelete).count>0?((0,r.uX)(),(0,r.CE)("div",ur,[t[154]||(t[154]=(0,r.Lk)("p",{class:"text-sm text-red-700 mb-2"},[(0,r.Lk)("strong",null,"⚠️ การลบนี้จะส่งผลกระทบต่อ:")],-1)),(0,r.Lk)("ul",mr,[(0,r.Lk)("li",gr,[t[153]||(t[153]=(0,r.Lk)("strong",null,"Sub Terms ที่จะถูกลบ:",-1)),(0,r.eW)(" "+(0,n.v_)(a.getDeletePreview(a.termToDelete).count)+" รายการ ",1)]),a.getDeletePreview(a.termToDelete).children&&a.getDeletePreview(a.termToDelete).children.length>0?((0,r.uX)(),(0,r.CE)("li",pr,(0,n.v_)(a.getDeletePreview(a.termToDelete).children.map((e=>e?.name||"ไม่มีชื่อ")).join(", ")),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("p",yr," รวมทั้งหมด "+(0,n.v_)(a.getDeletePreview(a.termToDelete).count+1)+" รายการจะถูกลบ ",1)])):a.termToDelete?((0,r.uX)(),(0,r.CE)("div",xr,t[155]||(t[155]=[(0,r.Lk)("p",{class:"text-sm text-green-700 bg-green-50 rounded px-2 py-1.5 border border-green-200"}," Term นี้ไม่มี Sub Terms จะลบเฉพาะ Term เดียวเท่านั้น ",-1)]))):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",fr,[(0,r.Lk)("button",{onClick:t[52]||(t[52]=(...e)=>a.cancelDelete&&a.cancelDelete(...e)),class:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 font-medium"}," ยกเลิก "),(0,r.Lk)("button",{onClick:t[53]||(t[53]=(...e)=>a.confirmDelete&&a.confirmDelete(...e)),class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 font-medium"}," ลบแน่นอน "+(0,n.v_)(a.termToDelete&&a.getDeletePreview(a.termToDelete).count>0?`(${a.getDeletePreview(a.termToDelete).count+1} รายการ)`:""),1)])])])):(0,r.Q3)("",!0),(0,r.bF)(hr,{visible:a.showHistoryModal,targetType:a.historyTarget.type,targetId:a.historyTarget.id,targetName:a.historyTarget.name,onClose:a.closeHistoryModal,onRollbackComplete:a.onRollbackComplete},null,8,["visible","targetType","targetId","targetName","onClose","onRollbackComplete"])],6)}o(44114),o(17642),o(58004),o(33853),o(45876),o(32475),o(15024),o(31698),o(72577),o(3949),o(37550),o(14603),o(47566),o(98721);var vr=o(50953),kr=o(40475),hr=o(77823),Lr=o(73288);const Tr={key:0,class:"mt-4 p-3 border border-gray-200 rounded-lg bg-white"},wr={class:"flex justify-between items-center mb-3 pb-2 border-b border-gray-200"},Cr={key:0,class:"text-center py-6 text-gray-500 bg-gray-50 rounded-md border border-gray-200"},Er={key:1,class:"space-y-2"},_r={class:"flex justify-between items-start"},Dr={class:"flex-1"},Fr={class:"flex items-center gap-2 mb-1"},Ir={class:"font-medium text-gray-900 text-sm"},Xr={class:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs font-mono"},Sr={key:0,class:"text-red-500 text-xs"},Or={key:1,class:"text-orange-600 text-xs"},Ar={class:"text-xs text-gray-600"},$r={key:0,class:"ml-3"},Rr={class:"flex items-center gap-1 ml-3"},Mr=["onClick"],Gr=["onClick"],Qr=["onClick"],jr=["onClick"],Ur={key:2,class:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm overflow-y-auto h-full w-full z-50"},Wr={class:"relative top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg shadow-xl min-w-[500px] max-w-[600px] border border-gray-200"},Kr={class:"flex justify-between items-center p-4 border-b border-gray-200 bg-white rounded-t-lg"},Pr={class:"text-sm font-semibold text-gray-900"},Hr={class:"p-4 max-h-[70vh] overflow-y-auto"},qr={class:"space-y-3"},Nr={key:0,class:"border border-gray-200 rounded-md p-3 bg-gray-50"},Br=["onUpdate:modelValue"],Vr=["onUpdate:modelValue"],Jr=["onClick"],zr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Yr={class:"flex items-center p-2 border border-gray-200 rounded-md bg-red-50"},Zr={class:"flex items-center p-2 border border-gray-200 rounded-md bg-orange-50"},ea={class:"flex justify-end gap-2 p-4 border-t border-gray-200 bg-white rounded-b-lg"};function ta(e,t,o,a,l,s){return o.visible?((0,r.uX)(),(0,r.CE)("div",Tr,[(0,r.Lk)("div",wr,[t[10]||(t[10]=(0,r.Lk)("h4",{class:"text-sm font-medium text-gray-700"}," การตั้งค่าฟิลด์สำหรับ Terms ",-1)),(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>a.addFieldConfig&&a.addFieldConfig(...e)),type:"button",class:"bg-blue-600 text-white px-3 py-1.5 rounded-md hover:bg-blue-700 transition-colors text-sm font-medium"}," เพิ่มฟิลด์ ")]),0===o.fieldConfig.length?((0,r.uX)(),(0,r.CE)("div",Cr,t[11]||(t[11]=[(0,r.Lk)("p",{class:"text-sm text-gray-600 mb-2"},"ยังไม่มีฟิลด์เพิ่มเติม",-1),(0,r.Lk)("p",{class:"text-xs text-gray-500"},'คลิก "เพิ่มฟิลด์" เพื่อสร้างฟิลด์แรกของคุณ',-1)]))):((0,r.uX)(),(0,r.CE)("div",Er,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.fieldConfig,((e,l)=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"bg-white border border-gray-200 rounded-md p-3 hover:bg-gray-50 transition-colors"},[(0,r.Lk)("div",_r,[(0,r.Lk)("div",Dr,[(0,r.Lk)("div",Fr,[(0,r.Lk)("h5",Ir,(0,n.v_)(e.label),1),(0,r.Lk)("span",Xr,(0,n.v_)(e.key),1),e.required?((0,r.uX)(),(0,r.CE)("span",Sr,"*")):(0,r.Q3)("",!0),e.unique?((0,r.uX)(),(0,r.CE)("span",Or,"(ไม่ซ้ำ)")):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Ar,[t[13]||(t[13]=(0,r.Lk)("span",{class:"font-medium"},"ประเภท:",-1)),(0,r.eW)(" "+(0,n.v_)(a.getFieldTypeLabel(e.type))+" ",1),"select"===e.type&&e.options.length>0?((0,r.uX)(),(0,r.CE)("span",$r,[t[12]||(t[12]=(0,r.Lk)("span",{class:"font-medium"},"ตัวเลือก:",-1)),(0,r.eW)(" "+(0,n.v_)(e.options.map((e=>e.label)).join(", ")),1)])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",Rr,[l>0?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:e=>a.moveFieldUp(l),class:"p-1 bg-gray-100 text-gray-600 hover:bg-gray-200 rounded transition-colors",title:"ย้ายขึ้น"},t[14]||(t[14]=[(0,r.Lk)("i",{class:"fas fa-chevron-up text-xs"},null,-1)]),8,Mr)):(0,r.Q3)("",!0),l<o.fieldConfig.length-1?((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:e=>a.moveFieldDown(l),class:"p-1 bg-gray-100 text-gray-600 hover:bg-gray-200 rounded transition-colors",title:"ย้ายลง"},t[15]||(t[15]=[(0,r.Lk)("i",{class:"fas fa-chevron-down text-xs"},null,-1)]),8,Gr)):(0,r.Q3)("",!0),(0,r.Lk)("button",{onClick:t=>a.editFieldConfig(e),class:"p-1 bg-yellow-100 text-yellow-700 hover:bg-yellow-200 rounded transition-colors",title:"แก้ไข"},t[16]||(t[16]=[(0,r.Lk)("i",{class:"fas fa-edit text-xs"},null,-1)]),8,Qr),(0,r.Lk)("button",{onClick:t=>a.removeFieldConfig(e.id),class:"p-1 bg-red-100 text-red-700 hover:bg-red-200 rounded transition-colors",title:"ลบ"},t[17]||(t[17]=[(0,r.Lk)("i",{class:"fas fa-trash text-xs"},null,-1)]),8,jr)])])])))),128))])),a.showFieldConfigModal?((0,r.uX)(),(0,r.CE)("div",Ur,[(0,r.Lk)("div",Wr,[(0,r.Lk)("div",Kr,[(0,r.Lk)("h3",Pr,(0,n.v_)(a.editingFieldId?"แก้ไขฟิลด์":"เพิ่มฟิลด์ใหม่")+"สำหรับ Terms ",1),(0,r.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>a.closeFieldConfigModal&&a.closeFieldConfigModal(...e)),class:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors"},t[18]||(t[18]=[(0,r.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,r.Lk)("div",Hr,[(0,r.Lk)("div",qr,[(0,r.Lk)("div",null,[t[19]||(t[19]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ชื่อฟิลด์ * ",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.fieldConfigForm.label=e),type:"text",placeholder:"เช่น รูปภาพ, คำอธิบาย, สถานะ",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,512),[[i.Jo,a.fieldConfigForm.label]])]),(0,r.Lk)("div",null,[t[20]||(t[20]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Key (สำหรับระบบ) * ",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>a.fieldConfigForm.key=e),type:"text",placeholder:"เช่น image, description, status (ภาษาอังกฤษ ไม่มีช่องว่าง)",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500 font-mono"},null,512),[[i.Jo,a.fieldConfigForm.key]]),t[21]||(t[21]=(0,r.Lk)("small",{class:"text-gray-500 text-xs mt-1"}," ใช้เป็น key สำหรับเก็บข้อมูล ควรเป็นภาษาอังกฤษ ",-1))]),(0,r.Lk)("div",null,[t[23]||(t[23]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ประเภทฟิลด์ * ",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>a.fieldConfigForm.type=e),class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},t[22]||(t[22]=[(0,r.Fv)('<option value="input" data-v-5eba8478>Input - ช่องกรอกข้อความ</option><option value="textarea" data-v-5eba8478>Textarea - ช่องกรอกข้อความหลายบรรทัด</option><option value="select" data-v-5eba8478>Select - ตัวเลือก Dropdown</option><option value="status" data-v-5eba8478>Status - True/False</option><option value="image" data-v-5eba8478>Image - รูปภาพ</option>',5)]),512),[[i.u1,a.fieldConfigForm.type]])]),"select"===a.fieldConfigForm.type?((0,r.uX)(),(0,r.CE)("div",Nr,[t[25]||(t[25]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," ตัวเลือก: ",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.fieldConfigForm.options,((e,o)=>((0,r.uX)(),(0,r.CE)("div",{key:o,class:"flex gap-2 mb-2 items-center"},[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t=>e.label=t,type:"text",placeholder:"ป้ายกำกับ (ที่ผู้ใช้เห็น)",class:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,8,Br),[[i.Jo,e.label]]),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t=>e.value=t,type:"text",placeholder:"ค่า (ที่เก็บในระบบ)",class:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500 font-mono"},null,8,Vr),[[i.Jo,e.value]]),(0,r.Lk)("button",{onClick:e=>a.removeSelectOption(o),class:"p-2 bg-red-100 text-red-700 hover:bg-red-200 rounded transition-colors"},t[24]||(t[24]=[(0,r.Lk)("i",{class:"fas fa-trash text-xs"},null,-1)]),8,Jr)])))),128)),(0,r.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>a.addSelectOption&&a.addSelectOption(...e)),type:"button",class:"bg-green-600 text-white px-3 py-1.5 rounded-md hover:bg-green-700 transition-colors text-sm font-medium"}," เพิ่มตัวเลือก ")])):(0,r.Q3)("",!0),(0,r.Lk)("div",zr,[(0,r.Lk)("div",Yr,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>a.fieldConfigForm.required=e),type:"checkbox",class:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500 mr-2"},null,512),[[i.lH,a.fieldConfigForm.required]]),t[26]||(t[26]=(0,r.Lk)("div",null,[(0,r.Lk)("label",{class:"font-medium text-gray-900 text-sm"}," ฟิลด์บังคับ (Required) "),(0,r.Lk)("small",{class:"text-gray-600 text-xs block"},"ผู้ใช้จะต้องกรอกข้อมูลในฟิลด์นี้")],-1))]),(0,r.Lk)("div",Zr,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>a.fieldConfigForm.unique=e),type:"checkbox",class:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500 mr-2"},null,512),[[i.lH,a.fieldConfigForm.unique]]),t[27]||(t[27]=(0,r.Lk)("div",null,[(0,r.Lk)("label",{class:"font-medium text-gray-900 text-sm"}," ข้อมูลไม่ซ้ำ (Unique) "),(0,r.Lk)("small",{class:"text-gray-600 text-xs block"},"ระบบจะเช็คว่าข้อมูลในฟิลด์นี้ไม่ซ้ำกันในกลุ่ม taxonomy เดียวกัน")],-1))])])])]),(0,r.Lk)("div",ea,[(0,r.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>a.closeFieldConfigModal&&a.closeFieldConfigModal(...e)),class:"px-3 py-1.5 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors text-sm font-medium"}," ยกเลิก "),(0,r.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>a.saveFieldConfig&&a.saveFieldConfig(...e)),class:"px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm font-medium"},(0,n.v_)(a.editingFieldId?"บันทึกการแก้ไข":"เพิ่มฟิลด์"),1)])])])):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0)}var oa={name:"FieldConfigManager",props:{fieldConfig:{type:Array,default:()=>[]},visible:{type:Boolean,default:!0}},emits:["update:fieldConfig"],setup(e,{emit:t}){const o=(0,vr.KR)(!1),r=(0,vr.KR)(null),a=(0,vr.KR)({type:"input",label:"",key:"",required:!1,unique:!1,options:[]}),l=e=>{const t={input:"ช่องกรอกข้อความ",textarea:"ช่องกรอกข้อความหลายบรรทัด",select:"ตัวเลือก Dropdown",status:"สถานะ True/False",image:"รูปภาพ"};return t[e]||e},s=()=>{a.value={type:"input",label:"",key:"",required:!1,unique:!1,options:[]},r.value=null,o.value=!0},n=()=>{if(!a.value.label.trim()||!a.value.key.trim())return void(0,hr.A)({type:"error",message:"กรุณากรอกชื่อฟิลด์และ Key",autohide:!0});const o=e.fieldConfig.some((e=>e.key===a.value.key.trim()&&e.id!==r.value));if(o)(0,hr.A)({type:"error",message:"Key ซ้ำ กรุณาใช้ Key อื่น",autohide:!0});else{if(r.value){const o=e.fieldConfig.map((e=>e.id===r.value?{...a.value,label:a.value.label.trim(),key:a.value.key.trim(),id:r.value}:e));t("update:fieldConfig",o),(0,hr.A)({type:"success",message:"แก้ไขฟิลด์สำเร็จ",autohide:!0})}else{const o={...a.value,label:a.value.label.trim(),key:a.value.key.trim(),id:Date.now()},r=[...e.fieldConfig,o];t("update:fieldConfig",r),(0,hr.A)({type:"success",message:"เพิ่มฟิลด์สำเร็จ",autohide:!0})}d()}},i=o=>{const r=e.fieldConfig.find((e=>e.id===o)),a=r?r.label:"ฟิลด์นี้";Lr.A.confirm({title:"ยืนยันการลบฟิลด์",message:`คุณแน่ใจหรือไม่ที่จะลบฟิลด์ "${a}"?`,confirm:()=>{const r=e.fieldConfig.filter((e=>e.id!==o));t("update:fieldConfig",r),(0,hr.A)({type:"success",message:`ลบฟิลด์ "${a}" สำเร็จ`,autohide:!0})},cancel:()=>{}})},d=()=>{o.value=!1,r.value=null,a.value={type:"input",label:"",key:"",required:!1,unique:!1,options:[]}},c=()=>{a.value.options.push({label:"",value:""})},u=e=>{a.value.options.splice(e,1)},m=o=>{if(o>0){const r=[...e.fieldConfig],a=r[o];r[o]=r[o-1],r[o-1]=a,t("update:fieldConfig",r),(0,hr.A)({type:"success",message:"ย้ายฟิลด์ขึ้นสำเร็จ",autohide:!0})}},g=o=>{if(o<e.fieldConfig.length-1){const r=[...e.fieldConfig],a=r[o];r[o]=r[o+1],r[o+1]=a,t("update:fieldConfig",r),(0,hr.A)({type:"success",message:"ย้ายฟิลด์ลงสำเร็จ",autohide:!0})}},p=e=>{a.value={type:e.type,label:e.label,key:e.key,required:e.required,unique:e.unique,options:e.options.map((e=>({...e})))},r.value=e.id,o.value=!0};return{showFieldConfigModal:o,editingFieldId:r,fieldConfigForm:a,getFieldTypeLabel:l,addFieldConfig:s,saveFieldConfig:n,removeFieldConfig:i,closeFieldConfigModal:d,addSelectOption:c,removeSelectOption:u,moveFieldUp:m,moveFieldDown:g,editFieldConfig:p}}},ra=o(64621);const aa=(0,ra.A)(oa,[["render",ta],["__scopeId","data-v-5eba8478"]]);var la=aa;const sa={key:0,class:"mt-4 p-3 border border-gray-200 rounded-lg bg-white"},na={key:0},ia={class:"block text-sm font-medium text-gray-700 mb-1"},da={key:0,class:"text-red-500 ml-1"},ca=["value","onInput","placeholder"],ua={key:0,class:"text-red-600 text-xs mt-1 block"},ma={key:1},ga={class:"block text-sm font-medium text-gray-700 mb-1"},pa={key:0,class:"text-red-500 ml-1"},ya=["value","onInput","placeholder"],xa={key:0,class:"text-red-600 text-xs mt-1 block"},fa={key:2},ba={class:"block text-sm font-medium text-gray-700 mb-1"},va={key:0,class:"text-red-500 ml-1"},ka=["value","onChange"],ha={value:""},La=["value"],Ta={key:0,class:"text-red-600 text-xs mt-1 block"},wa={key:3},Ca={class:"block text-sm font-medium text-gray-700 mb-2"},Ea={key:0,class:"text-red-500 ml-1"},_a={class:"flex gap-4 flex-wrap"},Da={class:"flex items-center cursor-pointer hover:bg-gray-50 px-3 py-2 rounded-md transition-colors border border-gray-200"},Fa=["checked","onChange","name"],Ia={class:"flex items-center cursor-pointer hover:bg-gray-50 px-3 py-2 rounded-md transition-colors border border-gray-200"},Xa=["checked","onChange","name"],Sa={key:0,class:"flex items-center cursor-pointer hover:bg-gray-50 px-3 py-2 rounded-md transition-colors border border-gray-200"},Oa=["checked","onChange","name"],Aa={key:0,class:"text-red-600 text-xs mt-2 block"},$a={key:4},Ra={class:"block text-sm font-medium text-gray-700 mb-1"},Ma={key:0,class:"text-red-500 ml-1"},Ga={key:1,class:"text-orange-600 ml-1 text-xs"},Qa=["onClick"],ja={class:"bg-white/90 p-2 rounded"},Ua={class:"text-sm text-gray-600"},Wa={class:"mt-2"},Ka=["value","onInput"],Pa=["onClick"],Ha={key:1,class:"text-red-600 text-xs mt-1 block"},qa={key:0,class:"mt-3 p-2 bg-red-50 border border-red-200 rounded text-sm"},Na={class:"text-red-700 text-xs space-y-0.5 ml-3"};function Ba(e,t,o,a,l,s){const i=(0,r.g2)("FileBrowser");return(0,r.uX)(),(0,r.CE)(r.FK,null,[((0,r.uX)(),(0,r.Wv)(r.Im,{to:"body"},[a.fileBrowserOpen?((0,r.uX)(),(0,r.Wv)(i,{key:0,isWindowsOpen:!0,callbackFunction:a.currentImageFieldKey,allowFileType:["jpg","gif","png","jpeg","webp","svg"],onFileBrowserTrigger:a.changeFileTrigger,onFileBrowserCallback:a.selectFileTrigger,style:{"z-index":"9999 !important"}},null,8,["callbackFunction","onFileBrowserTrigger","onFileBrowserCallback"])):(0,r.Q3)("",!0)])),o.fieldConfig.length>0?((0,r.uX)(),(0,r.CE)("div",sa,[t[6]||(t[6]=(0,r.Lk)("h4",{class:"text-sm font-medium text-gray-700 mb-3 pb-2 border-b border-gray-100"}," ฟิลด์เพิ่มเติม ",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.fieldConfig,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.key,class:"mb-3"},["input"===e.type?((0,r.uX)(),(0,r.CE)("div",na,[(0,r.Lk)("label",ia,[(0,r.eW)((0,n.v_)(e.label)+" ",1),e.required?((0,r.uX)(),(0,r.CE)("span",da,"*")):(0,r.Q3)("",!0)]),(0,r.Lk)("input",{value:o.customData[e.key]||"",onInput:t=>a.updateField(e.key,t.target.value),type:"text",placeholder:e.label,class:(0,n.C4)([a.getFieldClass(e),"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500"])},null,42,ca),a.getFieldError(e)?((0,r.uX)(),(0,r.CE)("small",ua,(0,n.v_)(a.getFieldError(e)),1)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),"textarea"===e.type?((0,r.uX)(),(0,r.CE)("div",ma,[(0,r.Lk)("label",ga,[(0,r.eW)((0,n.v_)(e.label)+" ",1),e.required?((0,r.uX)(),(0,r.CE)("span",pa,"*")):(0,r.Q3)("",!0)]),(0,r.Lk)("textarea",{value:o.customData[e.key]||"",onInput:t=>a.updateField(e.key,t.target.value),rows:"3",placeholder:e.label,class:(0,n.C4)([a.getFieldClass(e),"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500 resize-vertical"])},null,42,ya),a.getFieldError(e)?((0,r.uX)(),(0,r.CE)("small",xa,(0,n.v_)(a.getFieldError(e)),1)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),"select"===e.type?((0,r.uX)(),(0,r.CE)("div",fa,[(0,r.Lk)("label",ba,[(0,r.eW)((0,n.v_)(e.label)+" ",1),e.required?((0,r.uX)(),(0,r.CE)("span",va,"*")):(0,r.Q3)("",!0)]),(0,r.Lk)("select",{value:o.customData[e.key]||"",onChange:t=>a.updateField(e.key,t.target.value),class:(0,n.C4)([a.getFieldClass(e),"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500"])},[(0,r.Lk)("option",ha,"-- เลือก "+(0,n.v_)(e.label)+" --",1),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.options,(e=>((0,r.uX)(),(0,r.CE)("option",{key:e.value,value:e.value},(0,n.v_)(e.label),9,La)))),128))],42,ka),a.getFieldError(e)?((0,r.uX)(),(0,r.CE)("small",Ta,(0,n.v_)(a.getFieldError(e)),1)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),"status"===e.type?((0,r.uX)(),(0,r.CE)("div",wa,[(0,r.Lk)("label",Ca,[(0,r.eW)((0,n.v_)(e.label)+" ",1),e.required?((0,r.uX)(),(0,r.CE)("span",Ea,"*")):(0,r.Q3)("",!0)]),(0,r.Lk)("div",_a,[(0,r.Lk)("label",Da,[(0,r.Lk)("input",{checked:!0===o.customData[e.key]||"true"===o.customData[e.key],onChange:t=>a.updateField(e.key,!0),name:`status_${e.key}`,type:"radio",value:"true",class:"w-4 h-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2"},null,40,Fa),t[0]||(t[0]=(0,r.Lk)("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},[(0,r.Lk)("i",{class:"fas fa-check text-xs mr-1"}),(0,r.eW)(" เปิดใช้งาน ")],-1))]),(0,r.Lk)("label",Ia,[(0,r.Lk)("input",{checked:!1===o.customData[e.key]||"false"===o.customData[e.key],onChange:t=>a.updateField(e.key,!1),name:`status_${e.key}`,type:"radio",value:"false",class:"w-4 h-4 text-red-600 border-gray-300 focus:ring-red-500 mr-2"},null,40,Xa),t[1]||(t[1]=(0,r.Lk)("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800"},[(0,r.Lk)("i",{class:"fas fa-times text-xs mr-1"}),(0,r.eW)(" ปิดใช้งาน ")],-1))]),e.required?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("label",Sa,[(0,r.Lk)("input",{checked:null===o.customData[e.key]||void 0===o.customData[e.key]||""===o.customData[e.key],onChange:t=>a.updateField(e.key,null),name:`status_${e.key}`,type:"radio",value:"",class:"w-4 h-4 text-gray-600 border-gray-300 focus:ring-gray-500 mr-2"},null,40,Oa),t[2]||(t[2]=(0,r.Lk)("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600"},[(0,r.Lk)("i",{class:"fas fa-minus text-xs mr-1"}),(0,r.eW)(" ไม่ระบุ ")],-1))]))]),a.getFieldError(e)?((0,r.uX)(),(0,r.CE)("small",Aa,(0,n.v_)(a.getFieldError(e)),1)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),"image"===e.type?((0,r.uX)(),(0,r.CE)("div",$a,[(0,r.Lk)("label",Ra,[(0,r.eW)((0,n.v_)(e.label)+" ",1),e.required?((0,r.uX)(),(0,r.CE)("span",Ma,"*")):(0,r.Q3)("",!0),e.unique?((0,r.uX)(),(0,r.CE)("span",Ga,"(ไม่ซ้ำ)")):(0,r.Q3)("",!0)]),(0,r.Lk)("button",{onClick:t=>a.openImageFileBrowser(e.key),type:"button",style:(0,n.Tr)([{"background-image":o.customData[e.key]?`url(${o.customData[e.key]})`:"none"},{"min-height":"100px"}]),class:(0,n.C4)([a.getFieldClass(e),"relative bg-cover bg-center block w-full border-2 border-dashed border-gray-300 hover:border-gray-400 focus:outline-none focus:border-blue-500 rounded-md p-6 text-center"])},[(0,r.Lk)("div",ja,[t[3]||(t[3]=(0,r.Lk)("div",{class:"text-gray-500 mb-1"},[(0,r.Lk)("i",{class:"fas fa-image text-xl"})],-1)),(0,r.Lk)("span",Ua,(0,n.v_)(o.customData[e.key]?"เปลี่ยนรูปภาพ":"เลือกรูปภาพ"),1)])],14,Qa),(0,r.Lk)("details",Wa,[t[4]||(t[4]=(0,r.Lk)("summary",{class:"text-xs text-gray-500 cursor-pointer hover:text-gray-700"}," กรอก URL ด้วยตนเอง ",-1)),(0,r.Lk)("input",{value:o.customData[e.key]||"",onInput:t=>a.updateField(e.key,t.target.value),type:"text",placeholder:"https://example.com/image.jpg",class:(0,n.C4)([a.getFieldClass(e),"w-full px-3 py-2 mt-1 text-xs border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500"])},null,42,Ka)]),o.customData[e.key]?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t=>a.clearImageField(e.key),type:"button",class:"mt-2 px-2 py-1 text-xs text-red-600 hover:text-red-800 hover:bg-red-50 rounded border border-red-200"}," ลบรูปภาพ ",8,Pa)):(0,r.Q3)("",!0),a.getFieldError(e)?((0,r.uX)(),(0,r.CE)("small",Ha,(0,n.v_)(a.getFieldError(e)),1)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0)])))),128)),a.hasValidationErrors?((0,r.uX)(),(0,r.CE)("div",qa,[t[5]||(t[5]=(0,r.Lk)("div",{class:"text-red-800 font-medium mb-1"},"กรุณาแก้ไขข้อผิดพลาด:",-1)),(0,r.Lk)("ul",Na,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.validationErrors,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.field}," • "+(0,n.v_)(e.message),1)))),128))])])):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0)],64)}var Va=o(40687),Ja={name:"CustomFieldRenderer",components:{FileBrowser:Va.A},props:{fieldConfig:{type:Array,default:()=>[]},customData:{type:Object,default:()=>({})},showValidation:{type:Boolean,default:!1},existingTerms:{type:Array,default:()=>[]},currentTermId:{type:[String,Number],default:null},taxonomyGroupId:{type:[String,Number],default:null}},emits:["update:customData","validation-change"],setup(e,{emit:t}){const o=(0,vr.KR)({}),a=(0,vr.KR)(!1),l=(0,vr.KR)(""),s=(0,r.EW)((()=>{const t=[];return e.fieldConfig.forEach((o=>{const r=e.customData[o.key];if(o.required&&(r&&("string"!==typeof r||r.trim())||t.push({field:o.key,message:`${o.label} เป็นฟิลด์บังคับ`})),o.unique&&r&&("string"===typeof r?r.trim():r)){const e=g(o.key,r);e&&t.push({field:o.key,message:`${o.label} ซ้ำกัน กรุณาใช้ข้อมูลอื่น`})}})),t})),n=(0,r.EW)((()=>e.showValidation&&s.value.length>0)),i=(r,a)=>{const l={...e.customData,[r]:a};t("update:customData",l),o.value[r]&&(o.value={...o.value,[r]:null})},d=t=>{if(e.showValidation){const o=e.customData[t.key];if(t.required){if("status"===t.type&&(null===o||void 0===o||""===o))return"error-field";if("status"!==t.type&&(!o||"string"===typeof o&&!o.trim()))return"error-field"}if(t.unique&&o&&("string"===typeof o?o.trim():o)){const e=g(t.key,o);if(e)return"error-field"}}return""},c=t=>{if(e.showValidation){const o=e.customData[t.key];if(t.required){if("status"===t.type&&(null===o||void 0===o||""===o))return`${t.label} เป็นฟิลด์บังคับ กรุณาเลือกตัวเลือก`;if("status"!==t.type&&(!o||"string"===typeof o&&!o.trim()))return`${t.label} เป็นฟิลด์บังคับ`}if(t.unique&&o&&("string"===typeof o?o.trim():o)){const e=g(t.key,o);if(e)return`${t.label} ซ้ำกัน กรุณาใช้ข้อมูลอื่น`}}return null},u=e=>!!e&&(/\.(jpg|jpeg|png|gif|bmp|svg|webp)$/i.test(e)||e.startsWith("http")||e.startsWith("data:image")),m=e=>{console.warn("Failed to load image:",e.target.src),e.target.style.display="none"},g=(t,o)=>{if(!e.existingTerms||!e.taxonomyGroupId)return!1;const r="string"===typeof o?o.toLowerCase().trim():o;return e.existingTerms.some((o=>{if(e.currentTermId&&o._id===e.currentTermId)return!1;if(o.taxonomy!==e.taxonomyGroupId)return!1;const a=o.customData?.[t]||o[t];if(!a)return!1;const l="string"===typeof a?a.toLowerCase().trim():a;return l===r}))},p=e=>{l.value=e,a.value=!0},y=e=>{a.value=e},x=e=>{void 0!==e&&l.value&&(i(l.value,e.file),l.value="")},f=e=>{i(e,"")};return(0,r.wB)(s,(e=>{t("validation-change",{isValid:0===e.length,errors:e})}),{immediate:!0}),{fieldErrors:o,validationErrors:s,hasValidationErrors:n,updateField:i,getFieldClass:d,getFieldError:c,isValidImageUrl:u,onImageError:m,checkFieldUniqueness:g,fileBrowserOpen:a,currentImageFieldKey:l,openImageFileBrowser:p,changeFileTrigger:y,selectFileTrigger:x,clearImageField:f}}};const za=(0,ra.A)(Ja,[["render",Ba],["__scopeId","data-v-652b75a2"]]);var Ya=za;const Za={class:"taxonomy-history-viewer"},el={key:0,class:"fixed inset-0 bg-black bg-opacity-50 overflow-y-auto h-full w-full z-50"},tl={class:"relative top-20 mx-auto p-4 border border-gray-300 w-11/12 max-w-4xl shadow-lg rounded-lg bg-white"},ol={class:"flex justify-between items-center pb-3 border-b border-gray-200 mb-4"},rl={class:"flex-1"},al={class:"text-lg font-semibold text-gray-900 mb-2"},ll={class:"flex items-center gap-2 mb-2"},sl={key:0,class:"px-2 py-1 bg-green-100 text-green-700 rounded text-sm font-medium"},nl={key:1,class:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-sm font-medium"},il={class:"py-3 border border-gray-200 bg-gray-50 rounded-lg mb-4"},dl={class:"flex flex-wrap gap-4 px-4"},cl={key:0},ul={key:0,class:"text-center py-8"},ml={key:1,class:"max-h-96 overflow-y-auto bg-white rounded-lg border border-gray-200"},gl={key:0,class:"text-center py-8 text-gray-500"},pl={class:"flex justify-between items-start mb-2"},yl={class:"flex-1"},xl={class:"flex items-center gap-3 mb-2"},fl={key:0,class:"text-xs text-purple-600 bg-purple-50 px-2 py-1 rounded"},bl={class:"text-xs text-gray-600"},vl={class:"text-xs text-gray-500"},kl={class:"text-sm font-medium text-gray-900"},hl={key:0,class:"text-purple-600 mr-2"},Ll={class:"flex items-center gap-2 ml-3"},Tl=["onClick"],wl=["onClick"],Cl={key:0,class:"mt-2 bg-gray-50 rounded-md p-3 border border-gray-200"},El={key:0,class:"grid grid-cols-2 gap-3"},_l={class:"bg-red-50 p-2 rounded border-l-2 border-red-300"},Dl={class:"text-xs text-red-600 whitespace-pre-wrap"},Fl={class:"bg-green-50 p-2 rounded border-l-2 border-green-300"},Il={class:"text-xs text-green-600 whitespace-pre-wrap"},Xl={key:1,class:"bg-blue-50 p-2 rounded border-l-2 border-blue-300"},Sl={class:"text-xs text-blue-600 whitespace-pre-wrap"},Ol={key:2,class:"mt-2 pt-2 border-t border-gray-200"},Al={class:"text-xs text-gray-600 space-y-1"},$l={class:"text-red-600"},Rl={class:"text-green-600"},Ml={class:"text-xs text-gray-500 mt-2 flex items-center justify-between"},Gl={key:2,class:"flex justify-center mt-4 pt-4 border-t border-gray-200"},Ql={class:"flex rounded-md shadow-sm"},jl=["disabled"],Ul={class:"px-4 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-gray-700"},Wl=["disabled"],Kl={class:"flex justify-end pt-4 mt-4 border-t border-gray-200 gap-2"},Pl={key:1,class:"fixed inset-0 bg-black bg-opacity-75 overflow-y-auto h-full w-full",style:{"z-index":"9999"}},Hl={class:"relative top-1/3 mx-auto p-4 border border-gray-300 w-96 shadow-lg rounded-lg bg-white"},ql={class:"text-center"},Nl={class:"mt-4"},Bl={class:"text-sm text-gray-600 mb-4"},Vl={class:"px-2 py-1 bg-blue-100 text-blue-800 rounded font-medium"},Jl={key:0,class:"mb-4 p-3 bg-gray-50 rounded text-left max-h-48 overflow-y-auto border border-gray-200"},zl={class:"text-xs"},Yl={key:0},Zl={class:"whitespace-pre-wrap text-xs bg-white p-2 rounded border border-gray-200 font-mono"},es={key:1},ts={class:"whitespace-pre-wrap text-xs bg-white p-2 rounded border border-gray-200 font-mono"},os={key:2,class:"text-red-600 bg-red-50 p-2 rounded border border-red-200"},rs={class:"flex justify-center gap-3"},as=["disabled"],ls=["disabled"],ss={key:0,class:"inline-flex items-center"},ns={key:1};function is(e,t,o,a,l,s){return(0,r.uX)(),(0,r.CE)("div",Za,[a.showModal?((0,r.uX)(),(0,r.CE)("div",el,[(0,r.Lk)("div",tl,[(0,r.Lk)("div",ol,[(0,r.Lk)("div",rl,[(0,r.Lk)("h3",al," ประวัติการเปลี่ยนแปลง - "+(0,n.v_)(o.targetName),1),(0,r.Lk)("div",ll,["group"===o.targetType?((0,r.uX)(),(0,r.CE)("span",sl," Taxonomy Group ")):((0,r.uX)(),(0,r.CE)("span",nl," Term (รวมถึง Sub Terms) "))]),t[16]||(t[16]=(0,r.Lk)("div",{class:"text-xs text-gray-600 bg-gray-50 p-2 rounded border border-gray-200"},[(0,r.Lk)("strong",null,"การแสดงประวัติ:"),(0,r.Lk)("span",{class:"text-blue-600 font-medium"},"Main Terms"),(0,r.eW)(" แสดงด้วยพื้นหลังสีขาว | "),(0,r.Lk)("span",{class:"text-purple-600 font-medium"},"Sub Terms"),(0,r.eW)(" แสดงด้วย └─ prefix ")],-1))]),(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>a.closeModal&&a.closeModal(...e)),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors ml-4"},t[17]||(t[17]=[(0,r.Lk)("i",{class:"fas fa-times text-lg"},null,-1)]))]),(0,r.Lk)("div",il,[(0,r.Lk)("div",dl,[(0,r.Lk)("div",null,[t[19]||(t[19]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ประเภทการเปลี่ยนแปลง: ",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.filterAction=e),onChange:t[2]||(t[2]=(...e)=>a.loadHistory&&a.loadHistory(...e)),class:"block w-40 rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-sm"},t[18]||(t[18]=[(0,r.Fv)('<option value="" data-v-b11607c4>ทั้งหมด</option><option value="CREATE" data-v-b11607c4>สร้าง</option><option value="UPDATE" data-v-b11607c4>แก้ไข</option><option value="DELETE" data-v-b11607c4>ลบ</option><option value="ROLLBACK" data-v-b11607c4>กู้คืน</option><option value="SUB_CREATE" data-v-b11607c4>เพิ่ม Sub Term</option><option value="SUB_UPDATE" data-v-b11607c4>แก้ไข Sub Term</option><option value="SUB_DELETE" data-v-b11607c4>ลบ Sub Term</option>',8)]),544),[[i.u1,a.filterAction]])]),"term"===o.targetType?((0,r.uX)(),(0,r.CE)("div",cl,[t[21]||(t[21]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ระดับ Term: ",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>a.filterTermType=e),onChange:t[4]||(t[4]=(...e)=>a.loadHistory&&a.loadHistory(...e)),class:"block w-40 rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-sm"},t[20]||(t[20]=[(0,r.Lk)("option",{value:""},"ทั้งหมด",-1),(0,r.Lk)("option",{value:"main"},"Main Term เท่านั้น",-1),(0,r.Lk)("option",{value:"sub"},"Sub Terms เท่านั้น",-1)]),544),[[i.u1,a.filterTermType]])])):(0,r.Q3)("",!0),(0,r.Lk)("div",null,[t[23]||(t[23]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ช่วงเวลา: ",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>a.filterPeriod=e),onChange:t[6]||(t[6]=(...e)=>a.loadHistory&&a.loadHistory(...e)),class:"block w-32 rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-sm"},t[22]||(t[22]=[(0,r.Lk)("option",{value:""},"ทั้งหมด",-1),(0,r.Lk)("option",{value:"today"},"วันนี้",-1),(0,r.Lk)("option",{value:"week"},"7 วันที่ผ่านมา",-1),(0,r.Lk)("option",{value:"month"},"30 วันที่ผ่านมา",-1)]),544),[[i.u1,a.filterPeriod]])]),(0,r.Lk)("div",null,[t[24]||(t[24]=(0,r.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," ผู้ดำเนินการ: ",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>a.filterUser=e),onInput:t[8]||(t[8]=(...e)=>a.loadHistory&&a.loadHistory(...e)),placeholder:"ชื่อผู้ใช้...",class:"block w-40 rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-sm"},null,544),[[i.Jo,a.filterUser]])])])]),a.loading?((0,r.uX)(),(0,r.CE)("div",ul,t[25]||(t[25]=[(0,r.Lk)("div",{class:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"},null,-1),(0,r.Lk)("p",{class:"text-gray-600"},"กำลังโหลดประวัติ...",-1)]))):((0,r.uX)(),(0,r.CE)("div",ml,[0===a.historyList.length?((0,r.uX)(),(0,r.CE)("div",gl,t[26]||(t[26]=[(0,r.Lk)("div",{class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},[(0,r.Lk)("i",{class:"fas fa-inbox text-gray-400 text-lg"})],-1),(0,r.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ไม่มีประวัติการเปลี่ยนแปลง",-1),(0,r.Lk)("p",{class:"text-sm text-gray-500"},"ยังไม่มีการแก้ไขหรือเปลี่ยนแปลงใดๆ",-1)]))):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.historyList,((e,o)=>((0,r.uX)(),(0,r.CE)("div",{key:e._id,class:"border border-gray-200 rounded-md p-3 mb-3 bg-white hover:bg-gray-50 transition-colors"},[(0,r.Lk)("div",pl,[(0,r.Lk)("div",yl,[(0,r.Lk)("div",xl,[(0,r.Lk)("span",{class:(0,n.C4)([a.getActionBadgeClass(e.action),"px-2 py-1 rounded text-xs font-medium"])},(0,n.v_)(a.getActionText(e.action)),3),e.isSubTerm?((0,r.uX)(),(0,r.CE)("span",fl," Sub Term ")):(0,r.Q3)("",!0),(0,r.Lk)("span",bl,(0,n.v_)(e.userName||e.userId),1),(0,r.Lk)("span",vl,(0,n.v_)(a.formatDate(e.timestamp)),1)]),(0,r.Lk)("div",kl,[e.isSubTerm?((0,r.uX)(),(0,r.CE)("span",hl,"└─")):(0,r.Q3)("",!0),(0,r.eW)(" "+(0,n.v_)(e.targetName),1)])]),(0,r.Lk)("div",Ll,[(0,r.Lk)("button",{onClick:e=>a.toggleDiff(o),class:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors"},(0,n.v_)(e.showDiff?"ซ่อน":"ดู"),9,Tl),"DELETE"!==e.action&&a.canRollback(e)?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t=>a.confirmRollback(e),class:"text-xs px-2 py-1 bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200 transition-colors"}," กู้คืน ",8,wl)):(0,r.Q3)("",!0)])]),e.showDiff?((0,r.uX)(),(0,r.CE)("div",Cl,[t[32]||(t[32]=(0,r.Lk)("div",{class:"text-sm font-medium text-gray-700 mb-2"},"รายละเอียดการเปลี่ยนแปลง:",-1)),"UPDATE"===e.action&&e.diff?((0,r.uX)(),(0,r.CE)("div",El,[(0,r.Lk)("div",_l,[t[27]||(t[27]=(0,r.Lk)("div",{class:"text-xs font-medium text-red-700 mb-1"},"ก่อนแก้ไข:",-1)),(0,r.Lk)("pre",Dl,(0,n.v_)(a.formatDiffData(e.diff.before)),1)]),(0,r.Lk)("div",Fl,[t[28]||(t[28]=(0,r.Lk)("div",{class:"text-xs font-medium text-green-700 mb-1"},"หลังแก้ไข:",-1)),(0,r.Lk)("pre",Il,(0,n.v_)(a.formatDiffData(e.diff.after)),1)])])):e.data?((0,r.uX)(),(0,r.CE)("div",Xl,[t[29]||(t[29]=(0,r.Lk)("div",{class:"text-xs font-medium text-blue-700 mb-1"},"ข้อมูล:",-1)),(0,r.Lk)("pre",Sl,(0,n.v_)(a.formatDiffData(e.data)),1)])):(0,r.Q3)("",!0),"UPDATE"===e.action&&e.changesSummary?((0,r.uX)(),(0,r.CE)("div",Ol,[t[31]||(t[31]=(0,r.Lk)("div",{class:"text-xs font-medium text-gray-700 mb-1"},"สรุปการเปลี่ยนแปลง:",-1)),(0,r.Lk)("ul",Al,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.changesSummary,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.field,class:"bg-white p-1 rounded"},[(0,r.Lk)("strong",null,(0,n.v_)(e.field)+":",1),(0,r.Lk)("span",$l,(0,n.v_)(e.from),1),t[30]||(t[30]=(0,r.eW)(" → ")),(0,r.Lk)("span",Rl,(0,n.v_)(e.to),1)])))),128))])])):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),(0,r.Lk)("div",Ml,[(0,r.Lk)("span",null,"Version: "+(0,n.v_)(e.version),1),(0,r.Lk)("span",null,"ID: "+(0,n.v_)(e._id),1)])])))),128))])),a.totalPages>1?((0,r.uX)(),(0,r.CE)("div",Gl,[(0,r.Lk)("nav",Ql,[(0,r.Lk)("button",{onClick:t[9]||(t[9]=e=>a.changePage(a.currentPage-1)),disabled:1===a.currentPage,class:"px-3 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ก่อนหน้า ",8,jl),(0,r.Lk)("span",Ul,(0,n.v_)(a.currentPage)+" / "+(0,n.v_)(a.totalPages),1),(0,r.Lk)("button",{onClick:t[10]||(t[10]=e=>a.changePage(a.currentPage+1)),disabled:a.currentPage===a.totalPages,class:"px-3 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ถัดไป ",8,Wl)])])):(0,r.Q3)("",!0),(0,r.Lk)("div",Kl,[(0,r.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>a.closeModal&&a.closeModal(...e)),class:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 font-medium"}," ปิด "),(0,r.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>a.exportHistory&&a.exportHistory(...e)),class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-medium"}," ส่งออกประวัติ "),(0,r.Lk)("button",{onClick:t[13]||(t[13]=(...e)=>a.purgeTargetLogs&&a.purgeTargetLogs(...e)),class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 font-medium"}," ลบประวัติทั้งหมด ")])])])):(0,r.Q3)("",!0),a.showRollbackModal?((0,r.uX)(),(0,r.CE)("div",Pl,[(0,r.Lk)("div",Hl,[(0,r.Lk)("div",ql,[t[39]||(t[39]=(0,r.Lk)("div",{class:"mb-4 pb-3 border-b border-gray-200"},[(0,r.Lk)("div",{class:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3"},[(0,r.Lk)("i",{class:"fas fa-exclamation-triangle text-yellow-600 text-lg"})]),(0,r.Lk)("h3",{class:"text-lg font-semibold text-gray-900"}," ยืนยันการกู้คืน ")],-1)),(0,r.Lk)("div",Nl,[(0,r.Lk)("p",Bl,[t[33]||(t[33]=(0,r.eW)(" คุณต้องการกู้คืนข้อมูลกลับไปเป็น version")),t[34]||(t[34]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("span",Vl,(0,n.v_)(a.selectedRollbackItem?.version),1),t[35]||(t[35]=(0,r.eW)(" หรือไม่? "))]),a.selectedRollbackItem?((0,r.uX)(),(0,r.CE)("div",Jl,[t[36]||(t[36]=(0,r.Lk)("h4",{class:"font-medium text-sm mb-2 text-gray-700"}," ข้อมูลที่จะกู้คืน: ",-1)),(0,r.Lk)("div",zl,["UPDATE"===a.selectedRollbackItem.action&&a.selectedRollbackItem.diff?.before?((0,r.uX)(),(0,r.CE)("div",Yl,[(0,r.Lk)("pre",Zl,(0,n.v_)(JSON.stringify(a.selectedRollbackItem.diff.before,null,2)),1)])):a.selectedRollbackItem.data?((0,r.uX)(),(0,r.CE)("div",es,[(0,r.Lk)("pre",ts,(0,n.v_)(JSON.stringify(a.selectedRollbackItem.data,null,2)),1)])):((0,r.uX)(),(0,r.CE)("div",os," ไม่พบข้อมูลสำหรับ rollback "))])])):(0,r.Q3)("",!0),t[38]||(t[38]=(0,r.Lk)("p",{class:"text-xs text-orange-600 mb-4 bg-orange-50 p-2 rounded border border-orange-200"}," การกู้คืนจะสร้างประวัติใหม่ และไม่สามารถยกเลิกได้ ",-1)),(0,r.Lk)("div",rs,[(0,r.Lk)("button",{onClick:t[14]||(t[14]=e=>a.showRollbackModal=!1),disabled:a.rollbackLoading,class:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed font-medium"}," ยกเลิก ",8,as),(0,r.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>a.executeRollback&&a.executeRollback(...e)),disabled:a.rollbackLoading,class:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed font-medium"},[a.rollbackLoading?((0,r.uX)(),(0,r.CE)("span",ss,t[37]||(t[37]=[(0,r.Lk)("div",{class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"},null,-1),(0,r.eW)(" กำลังกู้คืน... ")]))):((0,r.uX)(),(0,r.CE)("span",ns," กู้คืนแน่นอน "))],8,ls)])])])])])):(0,r.Q3)("",!0)])}var ds={name:"TaxonomyHistoryViewer",props:{visible:{type:Boolean,default:!1},targetType:{type:String,required:!0},targetId:{type:[String,Number],required:!0},targetName:{type:String,default:""}},emits:["close","rollback-complete"],setup(e,{emit:t}){const o=kr.A.get("configs"),a=(0,vr.KR)(!1),l=(0,vr.KR)(!1),s=(0,vr.KR)([]),n=(0,vr.KR)(1),i=(0,vr.KR)(1),d=(0,vr.KR)(10),c=(0,vr.KR)(""),u=(0,vr.KR)(""),m=(0,vr.KR)(""),g=(0,vr.KR)(""),p=(0,vr.KR)(!1),y=(0,vr.KR)(null),x=(0,vr.KR)(!1),f=(0,r.EW)({get:()=>e.visible,set:e=>{a.value=e}}),b=async()=>{if(e.targetId){l.value=!0;try{const t={targetType:e.targetType,targetId:e.targetId};let r=[t];if("term"===e.targetType){const t=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({method:"find",args:[{type:"term",parentId:e.targetId}],paging:{page:1,limit:1e3}})});if(t.ok){const e=await t.json(),o=e.data?.map((e=>e._id))||[];o.forEach((e=>{r.push({targetType:"term",targetId:e})}))}}const a={$or:r};if(c.value&&(a.action=c.value),m.value&&(a.userName={$regex:m.value,$options:"i"}),u.value){const e=new Date;let t=new Date;switch(u.value){case"today":t.setHours(0,0,0,0);break;case"week":t.setDate(e.getDate()-7);break;case"month":t.setDate(e.getDate()-30);break}a.timestamp={$gte:t.toISOString()}}const l=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy_audit/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({method:"find",args:[a],paging:{page:n.value,limit:d.value},sort:{timestamp:-1}})});if(l.ok){const t=await l.json();let o=t.data.map((t=>({...t,showDiff:!1,isSubTerm:t.targetId!==e.targetId})));g.value&&("main"===g.value?o=o.filter((e=>!e.isSubTerm)):"sub"===g.value&&(o=o.filter((e=>e.isSubTerm)))),s.value=o,i.value=Math.ceil((t.total||0)/d.value)}else console.error("Failed to load history"),s.value=[]}catch(t){console.error("Error loading history:",t),s.value=[]}finally{l.value=!1}}},v=e=>{const t={CREATE:"สร้าง",UPDATE:"แก้ไข",DELETE:"ลบ",ROLLBACK:"กู้คืน",SUB_CREATE:"เพิ่ม Sub Term",SUB_UPDATE:"แก้ไข Sub Term",SUB_DELETE:"ลบ Sub Term"};return t[e]||e},k=e=>{const t={CREATE:"bg-green-100 text-green-800",UPDATE:"bg-blue-100 text-blue-800",DELETE:"bg-red-100 text-red-800",ROLLBACK:"bg-yellow-100 text-yellow-800",SUB_CREATE:"bg-emerald-100 text-emerald-800",SUB_UPDATE:"bg-sky-100 text-sky-800",SUB_DELETE:"bg-rose-100 text-rose-800"};return t[e]||"bg-gray-100 text-gray-800"},h=e=>{const t={CREATE:"border-green-300",UPDATE:"border-blue-300",DELETE:"border-red-300",ROLLBACK:"border-yellow-300",SUB_CREATE:"border-emerald-300",SUB_UPDATE:"border-sky-300",SUB_DELETE:"border-rose-300"};return t[e]||"border-gray-300"},L=e=>new Date(e).toLocaleString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),T=e=>"object"===typeof e?JSON.stringify(e,null,2):String(e),w=e=>{s.value[e].showDiff=!s.value[e].showDiff},C=e=>"DELETE"!==e.action&&0!==s.value.indexOf(e),E=e=>{y.value=e,p.value=!0},_=async()=>{if(y.value&&!x.value){x.value=!0;try{const r=y.value.data||y.value.diff?.before;if(console.log("📝 Rollback Debug Info:"),console.log("Selected item:",y.value),console.log("Rollback to data:",r),console.log("Target ID:",e.targetId),console.log("Target Type:",e.targetType),!r)return void(0,hr.A)({type:"error",message:"ไม่พบข้อมูลสำหรับการกู้คืน",autohide:!0});const a=(0,hr.A)({type:"pending",message:"กำลังกู้คืนข้อมูล..."}),l={...r};delete l._id,delete l.createdAt,delete l.updatedAt,console.log("Clean data for update:",l);const s={action:"ROLLBACK",targetType:e.targetType,targetId:e.targetId,targetName:`Rollback to version ${y.value.version}`,toVersion:y.value.version,rollbackData:r,reason:`Rollback to version ${y.value.version}`,userId:"current-user-id",userName:"Current User",timestamp:(new Date).toISOString(),data:r,version:`${Date.now()}`,userAgent:navigator.userAgent,ipAddress:"auto-detect"};console.log("🔄 Updating taxonomy data...");const n=await fetch(`https://gateway.cloudrestfulapi.com/api/taxonomy/${e.targetId}`,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({data:l,options:{}})});if(console.log("Update response status:",n.status),!n.ok){const e=await n.json();return console.error("Update error:",e),void a.hide(`เกิดข้อผิดพลาดในการอัพเดตข้อมูล: ${e.message}`,"error",300)}const i=await n.json();console.log("✅ Update successful:",i),console.log("📝 Creating audit log...");const d=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy_audit",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({data:s,options:{}})});if(d.ok)p.value=!1,y.value=null,await b(),t("rollback-complete",{targetType:e.targetType,targetId:e.targetId,version:y.value?.version,rollbackData:r}),a.hide("กู้คืนข้อมูลสำเร็จ","success",300);else{const o=await d.json();console.warn("Failed to create audit log, but data was updated:",o),p.value=!1,y.value=null,t("rollback-complete",{targetType:e.targetType,targetId:e.targetId,version:y.value?.version,rollbackData:r}),a.hide("กู้คืนข้อมูลสำเร็จ (แต่บันทึก audit log ไม่สำเร็จ)","success",300)}}catch(r){console.error("Rollback error:",r),(0,hr.A)({type:"error",message:"เกิดข้อผิดพลาดในการกู้คืนข้อมูล",autohide:!0})}finally{x.value=!1}}},D=e=>{e>=1&&e<=i.value&&(n.value=e,b())},F=()=>{const t=["เวลา,ประเภท,ผู้ดำเนินการ,รายละเอียด,Version",...s.value.map((e=>[L(e.timestamp),v(e.action),e.userName||e.userId,e.targetName,e.version].join(",")))].join("\n"),o=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),a=URL.createObjectURL(o);r.setAttribute("href",a),r.setAttribute("download",`taxonomy_history_${e.targetId}_${Date.now()}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r)},I=async()=>{try{const t="group"===e.targetType?"กลุ่ม":"Term";Lr.A.confirm({title:"ยืนยันการลบประวัติ",message:`คุณแน่ใจหรือไม่ที่จะลบประวัติทั้งหมดของ ${t} "${e.targetName}"?\n\nการดำเนินการนี้ไม่สามารถยกเลิกได้\nจะลบประวัติการเปลี่ยนแปลงทั้งหมดของ ${t} นี้`,confirm:async()=>{const t=(0,hr.A)({type:"pending",message:"กำลังลบประวัติ..."});try{let a=[{targetType:e.targetType,targetId:e.targetId}];if("term"===e.targetType){const t=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({method:"find",args:[{type:"term",parentId:e.targetId}],paging:{page:1,limit:1e3}})});if(t.ok){const e=await t.json(),o=e.data?.map((e=>e._id))||[];o.forEach((e=>{a.push({targetType:"term",targetId:e})}))}}const l={$or:a},s=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy_audit/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({method:"find",args:[l],paging:{page:1,limit:1e4}})});if(!s.ok)return void t.hide("ไม่สามารถดึงรายการ logs ได้","error",300);const n=await s.json(),i=n.data?.map((e=>e._id))||[],d=i.length;if(0===d)return void t.hide("ไม่มี audit logs ให้ลบ","info",300);let c=0;for(const e of i)try{const t=await fetch(`https://gateway.cloudrestfulapi.com/api/taxonomy_audit/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json","client-token-key":o.key}});t.ok?c++:console.warn(`Failed to delete log: ${e}`)}catch(r){console.warn(`Error deleting log ${e}:`,r)}c>0?(t.hide(`ลบประวัติสำเร็จ\nลบแล้ว: ${c}/${d} รายการ`,"success",500),await b()):t.hide("ไม่สามารถลบประวัติได้","error",300)}catch(r){console.error("Error in purge operation:",r),t.hide("เกิดข้อผิดพลาดในการลบประวัติ","error",300)}},cancel:()=>{}})}catch(t){console.error("Error purging target logs:",t),(0,hr.A)({type:"error",message:"เกิดข้อผิดพลาดในการลบประวัติ",autohide:!0})}},X=()=>{a.value=!1,t("close")},S=()=>{e.visible?(a.value=!0,b()):a.value=!1};return(0,r.sV)((()=>{e.visible&&b()})),{showModal:f,loading:l,historyList:s,currentPage:n,totalPages:i,filterAction:c,filterPeriod:u,filterUser:m,filterTermType:g,showRollbackModal:p,selectedRollbackItem:y,rollbackLoading:x,loadHistory:b,getActionText:v,getActionBadgeClass:k,getActionBorderClass:h,formatDate:L,formatDiffData:T,toggleDiff:w,canRollback:C,confirmRollback:E,executeRollback:_,changePage:D,exportHistory:F,purgeTargetLogs:I,closeModal:X,watchVisible:S}},watch:{visible:{handler:"watchVisible",immediate:!0}}};const cs=(0,ra.A)(ds,[["render",is],["__scopeId","data-v-b11607c4"]]);var us=cs;const ms={class:"bg-gradient-to-r from-white to-gray-50 border border-gray-200/60 rounded-lg mb-2 shadow-sm hover:shadow-md transition-all duration-300 group"},gs={key:0,class:"h-0.5 bg-gray-100"},ps={class:"flex items-center gap-2 flex-1 min-w-0"},ys={class:"w-4 flex-shrink-0 flex items-center justify-center"},xs=["title"],fs={key:1,class:"w-4 h-4 flex items-center justify-center"},bs={class:"flex-1 min-w-0"},vs={class:"flex items-center gap-2 flex-wrap"},ks={class:"text-sm text-gray-800 font-semibold"},hs={class:"flex items-center gap-1.5"},Ls={key:0,class:"inline-flex items-center px-1.5 py-0.5 text-xs font-medium bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 rounded-full border border-purple-200"},Ts={key:1,class:"inline-flex items-center px-1.5 py-0.5 text-xs font-medium bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 rounded-full border border-blue-200"},ws={key:2,class:"inline-flex items-center px-1.5 py-0.5 text-xs font-medium bg-gradient-to-r from-red-100 to-red-200 text-red-800 rounded-full border border-red-200"},Cs={key:3,class:"inline-flex items-center px-1.5 py-0.5 text-xs font-medium bg-gradient-to-r from-emerald-100 to-green-200 text-green-800 rounded-full border border-green-200"},Es={key:4,class:"inline-flex items-center px-1.5 py-0.5 text-xs font-medium bg-gradient-to-r from-orange-100 to-yellow-200 text-orange-800 rounded-full border border-orange-200"},_s={key:0,class:"text-xs text-gray-600 mt-1 flex items-center"},Ds={key:1,class:"text-xs text-gray-500 mt-0.5 flex items-center"},Fs={class:"flex items-center gap-0.5 ml-2"},Is={class:"flex items-center bg-gray-50 rounded-md p-0.5 gap-0.5"},Xs={key:2,class:"p-1"},Ss={class:"relative z-10"},Os={class:"py-1"},As={class:"py-1"},$s={key:0,class:"border-t border-gray-200/60 bg-gradient-to-b from-gray-50/50 to-white px-3 py-2"},Rs={key:0,class:"mb-2"},Ms={class:"relative"},Gs={class:"space-y-1.5"},Qs={key:1,class:"mt-2 text-center"},js={class:"px-4 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white"},Us={class:"font-semibold text-base"},Ws={class:"p-4"},Ks={class:"space-y-2"},Ps={key:0},Hs={class:"ml-2 text-sm text-gray-800"},qs={key:1},Ns={class:"ml-2 text-sm text-gray-800 mt-0.5"},Bs={class:"ml-2 text-sm text-gray-800"},Vs={class:"ml-2 mt-1"},Js={class:"w-full bg-gray-200 rounded-full h-1.5"},zs={class:"text-xs text-gray-600 mt-0.5"};function Ys(e,t,o,a,l,s){const d=(0,r.g2)("TermItem",!0);return(0,r.uX)(),(0,r.CE)("div",{class:"term-item",style:(0,n.Tr)({paddingLeft:12*o.level+"px"})},[(0,r.Lk)("div",ms,[o.showProgress?((0,r.uX)(),(0,r.CE)("div",gs,[(0,r.Lk)("div",{class:"h-full bg-gradient-to-r from-emerald-400 to-green-500 transition-all duration-500 ease-out",style:(0,n.Tr)({width:`${a.completionRate}%`})},null,4)])):(0,r.Q3)("",!0),(0,r.Lk)("div",{class:(0,n.C4)(["flex items-center justify-between py-2.5 px-3 transition-all duration-200 rounded-lg",{"hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 cursor-pointer":a.childTerms.length>0,"hover:bg-gray-50":0===a.childTerms.length}]),onClick:t[15]||(t[15]=e=>a.childTerms.length>0?a.toggleExpanded():null)},[(0,r.Lk)("div",ps,[(0,r.Lk)("div",ys,[a.childTerms.length>0?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"w-4 h-4 flex items-center justify-center text-sm font-bold text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-sm transition-all duration-200 cursor-pointer border border-gray-300 hover:border-blue-400",onClick:t[0]||(t[0]=(0,i.D$)(((...e)=>a.toggleExpanded&&a.toggleExpanded(...e)),["stop"])),title:a.isExpanded?"ย่อ":"ขยาย"},(0,n.v_)(a.isExpanded?"−":"+"),9,xs)):((0,r.uX)(),(0,r.CE)("div",fs,t[34]||(t[34]=[(0,r.Lk)("div",{class:"w-1.5 h-1.5 bg-gray-300 rounded-full"},null,-1)])))]),(0,r.Lk)("div",bs,[(0,r.Lk)("div",vs,[(0,r.Lk)("span",ks,(0,n.v_)(o.termData.name),1),(0,r.Lk)("div",hs,[o.termData.code?((0,r.uX)(),(0,r.CE)("span",Ls,[t[35]||(t[35]=(0,r.Lk)("i",{class:"fas fa-hashtag mr-1 text-xs"},null,-1)),(0,r.eW)((0,n.v_)(o.termData.code),1)])):(0,r.Q3)("",!0),a.childTerms.length>0?((0,r.uX)(),(0,r.CE)("span",Ts,[t[36]||(t[36]=(0,r.Lk)("i",{class:"fas fa-folder mr-1 text-xs"},null,-1)),(0,r.eW)((0,n.v_)(a.childTerms.length),1)])):(0,r.Q3)("",!0),!1===o.termData.active?((0,r.uX)(),(0,r.CE)("span",ws,t[37]||(t[37]=[(0,r.Lk)("i",{class:"fas fa-pause-circle mr-1 text-xs"},null,-1),(0,r.eW)("ปิด ")]))):(0,r.Q3)("",!0),a.isRecent?((0,r.uX)(),(0,r.CE)("span",Cs,t[38]||(t[38]=[(0,r.Lk)("i",{class:"fas fa-sparkles mr-1 text-xs"},null,-1),(0,r.eW)("ใหม่ ")]))):(0,r.Q3)("",!0),a.hasChanges?((0,r.uX)(),(0,r.CE)("span",Es,t[39]||(t[39]=[(0,r.Lk)("i",{class:"fas fa-clock mr-1 text-xs"},null,-1),(0,r.eW)("แก้ไข ")]))):(0,r.Q3)("",!0)])]),o.termData.meta?((0,r.uX)(),(0,r.CE)("div",_s,[t[40]||(t[40]=(0,r.Lk)("i",{class:"fas fa-info-circle mr-1.5 text-gray-400 text-xs"},null,-1)),(0,r.eW)(" "+(0,n.v_)(o.termData.meta),1)])):(0,r.Q3)("",!0),o.showProgress?((0,r.uX)(),(0,r.CE)("div",Ds,[t[41]||(t[41]=(0,r.Lk)("i",{class:"fas fa-chart-pie mr-1 text-xs"},null,-1)),(0,r.eW)(" "+(0,n.v_)(a.completionRate)+"% ",1)])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",Fs,[(0,r.Lk)("button",{onClick:t[1]||(t[1]=(0,i.D$)(((...e)=>a.quickPreview&&a.quickPreview(...e)),["stop"])),class:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-all duration-200 hover:scale-105",title:"ดูตัวอย่างด่วน"},t[42]||(t[42]=[(0,r.Lk)("i",{class:"fas fa-eye text-xs"},null,-1)])),(0,r.Lk)("button",{onClick:t[2]||(t[2]=(0,i.D$)(((...e)=>a.addChild&&a.addChild(...e)),["stop"])),class:"p-1.5 text-gray-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-md transition-all duration-200 hover:scale-105",title:"เพิ่มรายการย่อย"},t[43]||(t[43]=[(0,r.Lk)("i",{class:"fas fa-plus text-xs"},null,-1)])),(0,r.Lk)("button",{onClick:t[3]||(t[3]=(0,i.D$)(((...e)=>a.edit&&a.edit(...e)),["stop"])),class:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-all duration-200 hover:scale-105",title:"แก้ไข"},t[44]||(t[44]=[(0,r.Lk)("i",{class:"fas fa-edit text-xs"},null,-1)])),(0,r.Lk)("button",{onClick:t[4]||(t[4]=(0,i.D$)(((...e)=>a.clone&&a.clone(...e)),["stop"])),class:"p-1.5 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-md transition-all duration-200 hover:scale-105",title:"ทำซ้ำ"},t[45]||(t[45]=[(0,r.Lk)("i",{class:"fas fa-copy text-xs"},null,-1)])),a.siblings.length>1?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[t[49]||(t[49]=(0,r.Lk)("div",{class:"border-l border-gray-300 mx-1 h-4"},null,-1)),(0,r.Lk)("div",Is,[a.canMoveUp?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[5]||(t[5]=(0,i.D$)(((...e)=>a.moveUp&&a.moveUp(...e)),["stop"])),class:"p-1 text-gray-400 hover:text-blue-600 hover:bg-white rounded-sm transition-all duration-200 hover:scale-105",title:"ย้ายขึ้น"},t[46]||(t[46]=[(0,r.Lk)("i",{class:"fas fa-chevron-up text-xs"},null,-1)]))):(0,r.Q3)("",!0),a.canMoveDown?((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:t[6]||(t[6]=(0,i.D$)(((...e)=>a.moveDown&&a.moveDown(...e)),["stop"])),class:"p-1 text-gray-400 hover:text-blue-600 hover:bg-white rounded-sm transition-all duration-200 hover:scale-105",title:"ย้ายลง"},t[47]||(t[47]=[(0,r.Lk)("i",{class:"fas fa-chevron-down text-xs"},null,-1)]))):(0,r.Q3)("",!0),a.canMoveUp||a.canMoveDown?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Xs,t[48]||(t[48]=[(0,r.Lk)("i",{class:"fas fa-grip-lines text-xs text-gray-300"},null,-1)])))])],64)):(0,r.Q3)("",!0),(0,r.Lk)("div",Ss,[(0,r.Lk)("button",{onClick:t[7]||(t[7]=(0,i.D$)((e=>a.showMoreActions=!a.showMoreActions),["stop"])),class:"p-1.5 text-gray-400 hover:text-gray-700 hover:bg-gray-100 rounded-md transition-all duration-200",title:"ตัวเลือกเพิ่มเติม"},t[50]||(t[50]=[(0,r.Lk)("i",{class:"fas fa-ellipsis-v text-xs"},null,-1)])),(0,r.bF)(i.eB,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:(0,r.k6)((()=>[a.showMoreActions?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"absolute right-0 top-full mt-1 w-44 bg-white border border-gray-200 rounded-lg shadow-xl z-[9999] overflow-hidden backdrop-blur-sm",onClick:t[14]||(t[14]=(0,i.D$)((e=>a.showMoreActions=!1),["stop"]))},[t[56]||(t[56]=(0,r.Lk)("div",{class:"px-3 py-2 bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200"},[(0,r.Lk)("div",{class:"text-xs font-semibold text-gray-700 uppercase tracking-wider"},"การดำเนินการ")],-1)),(0,r.Lk)("div",Os,[(0,r.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>a.toggleFavorite&&a.toggleFavorite(...e)),class:"w-full px-3 py-1.5 text-xs text-gray-700 hover:bg-yellow-50 hover:text-yellow-700 text-left transition-colors flex items-center"},[(0,r.Lk)("i",{class:(0,n.C4)(["fas fa-star mr-2 text-yellow-500",{fas:a.isFavorite,far:!a.isFavorite}])},null,2),(0,r.eW)(" "+(0,n.v_)(a.isFavorite?"ลบออกจากโปรด":"เพิ่มเป็นโปรด"),1)]),(0,r.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>a.showHistory&&a.showHistory(...e)),class:"w-full px-3 py-1.5 text-xs text-gray-700 hover:bg-blue-50 hover:text-blue-700 text-left transition-colors flex items-center"},t[51]||(t[51]=[(0,r.Lk)("i",{class:"fas fa-history mr-2 text-blue-500"},null,-1),(0,r.eW)("ดูประวัติ ")])),(0,r.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>a.exportTerm&&a.exportTerm(...e)),class:"w-full px-3 py-1.5 text-xs text-gray-700 hover:bg-green-50 hover:text-green-700 text-left transition-colors flex items-center"},t[52]||(t[52]=[(0,r.Lk)("i",{class:"fas fa-download mr-2 text-green-500"},null,-1),(0,r.eW)("ส่งออก ")])),(0,r.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>a.shareLink&&a.shareLink(...e)),class:"w-full px-3 py-1.5 text-xs text-gray-700 hover:bg-indigo-50 hover:text-indigo-700 text-left transition-colors flex items-center"},t[53]||(t[53]=[(0,r.Lk)("i",{class:"fas fa-share-alt mr-2 text-indigo-500"},null,-1),(0,r.eW)("แชร์ลิงก์ ")]))]),t[57]||(t[57]=(0,r.Lk)("div",{class:"border-t border-gray-100"},null,-1)),(0,r.Lk)("div",As,[(0,r.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>a.archiveTerm&&a.archiveTerm(...e)),class:"w-full px-3 py-1.5 text-xs text-orange-600 hover:bg-orange-50 text-left transition-colors flex items-center"},t[54]||(t[54]=[(0,r.Lk)("i",{class:"fas fa-archive mr-2 text-orange-500"},null,-1),(0,r.eW)("เก็บถาวร ")])),(0,r.Lk)("button",{onClick:t[13]||(t[13]=(...e)=>a.deleteTerm&&a.deleteTerm(...e)),class:"w-full px-3 py-1.5 text-xs text-red-600 hover:bg-red-50 text-left transition-colors flex items-center"},t[55]||(t[55]=[(0,r.Lk)("i",{class:"fas fa-trash mr-2 text-red-500"},null,-1),(0,r.eW)("ลบออก ")]))])])):(0,r.Q3)("",!0)])),_:1})])])],2),(0,r.bF)(i.eB,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-screen","leave-active-class":"transition-all duration-300 ease-in","leave-from-class":"opacity-100 max-h-screen","leave-to-class":"opacity-0 max-h-0"},{default:(0,r.k6)((()=>[a.isExpanded&&a.childTerms.length>0?((0,r.uX)(),(0,r.CE)("div",$s,[a.childTerms.length>5?((0,r.uX)(),(0,r.CE)("div",Rs,[(0,r.Lk)("div",Ms,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>a.childSearchQuery=e),type:"text",placeholder:"ค้นหารายการย่อย...",class:"w-full pl-8 pr-3 py-1.5 text-xs border border-gray-200 rounded-md focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition-colors"},null,512),[[i.Jo,a.childSearchQuery]]),t[58]||(t[58]=(0,r.Lk)("i",{class:"fas fa-search absolute left-2.5 top-2 text-gray-400 text-xs"},null,-1))])])):(0,r.Q3)("",!0),(0,r.Lk)("div",Gs,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.filteredChildTerms,(a=>((0,r.uX)(),(0,r.Wv)(d,{key:a._id,"term-data":a,level:o.level+1,"all-terms":o.allTerms,"expanded-terms":o.expandedTerms,"onUpdate:expandedTerms":t[17]||(t[17]=t=>e.$emit("update:expandedTerms",t)),onAddTerm:t[18]||(t[18]=t=>e.$emit("add-term",t)),onEditTerm:t[19]||(t[19]=t=>e.$emit("edit-term",t)),onDeleteTerm:t[20]||(t[20]=t=>e.$emit("delete-term",t)),onCloneTerm:t[21]||(t[21]=t=>e.$emit("clone-term",t)),onMoveTermUp:t[22]||(t[22]=t=>e.$emit("move-term-up",t)),onMoveTermDown:t[23]||(t[23]=t=>e.$emit("move-term-down",t)),onShowTermHistory:t[24]||(t[24]=t=>e.$emit("show-term-history",t)),onArchiveTerm:t[25]||(t[25]=t=>e.$emit("archive-term",t)),onExportTerm:t[26]||(t[26]=t=>e.$emit("export-term",t)),onToggleFavorite:t[27]||(t[27]=t=>e.$emit("toggle-favorite",t)),onShareLink:t[28]||(t[28]=t=>e.$emit("share-link",t)),onQuickPreview:t[29]||(t[29]=t=>e.$emit("quick-preview",t))},null,8,["term-data","level","all-terms","expanded-terms"])))),128))]),a.childSearchQuery&&a.filteredChildTerms.length<a.childTerms.length?((0,r.uX)(),(0,r.CE)("div",Qs,[(0,r.Lk)("button",{onClick:t[30]||(t[30]=e=>a.childSearchQuery=""),class:"text-xs text-blue-600 hover:text-blue-800 font-medium"}," แสดงทั้งหมด ("+(0,n.v_)(a.childTerms.length)+" รายการ) ",1)])):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0)])),_:1})]),(0,r.bF)(i.eB,{"enter-active-class":"transition-all duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition-all duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:(0,r.k6)((()=>[a.showQuickPreview?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm",onClick:t[33]||(t[33]=e=>a.showQuickPreview=!1)},[(0,r.Lk)("div",{class:"bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",onClick:t[32]||(t[32]=(0,i.D$)((()=>{}),["stop"]))},[(0,r.Lk)("div",js,[(0,r.Lk)("h3",Us,(0,n.v_)(o.termData.name),1),(0,r.Lk)("button",{onClick:t[31]||(t[31]=e=>a.showQuickPreview=!1),class:"absolute top-3 right-3 text-white hover:text-gray-200"},t[59]||(t[59]=[(0,r.Lk)("i",{class:"fas fa-times text-sm"},null,-1)]))]),(0,r.Lk)("div",Ws,[(0,r.Lk)("div",Ks,[o.termData.code?((0,r.uX)(),(0,r.CE)("div",Ps,[t[60]||(t[60]=(0,r.Lk)("span",{class:"text-xs font-medium text-gray-500"},"รหัส:",-1)),(0,r.Lk)("span",Hs,(0,n.v_)(o.termData.code),1)])):(0,r.Q3)("",!0),o.termData.meta?((0,r.uX)(),(0,r.CE)("div",qs,[t[61]||(t[61]=(0,r.Lk)("span",{class:"text-xs font-medium text-gray-500"},"คำอธิบาย:",-1)),(0,r.Lk)("p",Ns,(0,n.v_)(o.termData.meta),1)])):(0,r.Q3)("",!0),(0,r.Lk)("div",null,[t[62]||(t[62]=(0,r.Lk)("span",{class:"text-xs font-medium text-gray-500"},"จำนวนรายการย่อย:",-1)),(0,r.Lk)("span",Bs,(0,n.v_)(a.childTerms.length)+" รายการ",1)]),(0,r.Lk)("div",null,[t[63]||(t[63]=(0,r.Lk)("span",{class:"text-xs font-medium text-gray-500"},"ความสมบูรณ์:",-1)),(0,r.Lk)("div",Vs,[(0,r.Lk)("div",Js,[(0,r.Lk)("div",{class:"bg-gradient-to-r from-emerald-400 to-green-500 h-1.5 rounded-full transition-all duration-500",style:(0,n.Tr)({width:`${a.completionRate}%`})},null,4)]),(0,r.Lk)("span",zs,(0,n.v_)(a.completionRate)+"%",1)])])])])])])):(0,r.Q3)("",!0)])),_:1})],4)}var Zs={name:"TermItem",props:{termData:{type:Object,required:!0},level:{type:Number,default:0},allTerms:{type:Array,required:!0},expandedTerms:{type:Array,default:()=>[]},showProgress:{type:Boolean,default:!0}},emits:["update:expandedTerms","add-term","edit-term","delete-term","clone-term","move-term-up","move-term-down","show-term-history","archive-term","export-term","toggle-favorite","share-link","quick-preview"],setup(e,{emit:t}){const o=(0,vr.KR)(!1),a=(0,vr.KR)(!1),l=(0,vr.KR)(!1),s=(0,vr.KR)(""),n=()=>{o.value&&(o.value=!1)};(0,r.sV)((()=>{document.addEventListener("click",n)})),(0,r.hi)((()=>{document.removeEventListener("click",n)})),(0,r.wB)((()=>e.allTerms),((t,o)=>{console.log("AllTerms changed for",e.termData.name),console.log("Old length:",o?.length,"New length:",t?.length);const r=o?.find((t=>t._id===e.termData._id)),a=t?.find((t=>t._id===e.termData._id));r&&a&&r.sortOrder!==a.sortOrder&&console.log("Sort order changed for",e.termData.name,"from",r.sortOrder,"to",a.sortOrder)}),{deep:!0}),(0,r.wB)((()=>e.termData),((e,t)=>{t&&e.sortOrder!==t.sortOrder&&console.log("TermData sortOrder changed for",e.name,"from",t.sortOrder,"to",e.sortOrder)}),{deep:!0});const i=(0,r.EW)((()=>e.expandedTerms.includes(e.termData._id))),d=(0,r.EW)((()=>e.allTerms.filter((t=>t.parentId===e.termData._id)).sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))))),c=(0,r.EW)((()=>{if(!s.value)return d.value;const e=s.value.toLowerCase();return d.value.filter((t=>t.name.toLowerCase().includes(e)||t.code&&t.code.toLowerCase().includes(e)||t.meta&&t.meta.toLowerCase().includes(e)))})),u=(0,r.EW)((()=>{const t=e.allTerms;console.log("Computing siblings for:",e.termData.name,"Total terms:",t.length);const o=t.filter((t=>t.taxonomy===e.termData.taxonomy&&t.parentId===e.termData.parentId)).sort(((e,t)=>{const o=void 0!==e.sortOrder&&null!==e.sortOrder?e.sortOrder:999999,r=void 0!==t.sortOrder&&null!==t.sortOrder?t.sortOrder:999999;if(o!==r)return o-r;const a=new Date(e.createdAt||0).getTime(),l=new Date(t.createdAt||0).getTime();return a!==l?a-l:(e._id||"").localeCompare(t._id||"")}));console.log("Siblings found:",o.map((e=>({name:e.name,sortOrder:e.sortOrder,createdAt:e.createdAt,_id:e._id}))));const r=o.map((e=>e.sortOrder)).filter((e=>null!==e&&void 0!==e)),a=[...new Set(r)];return r.length!==a.length&&(console.warn("⚠️ Duplicate sortOrder detected!",r),console.warn("Consider implementing sortOrder normalization in parent component")),o})),m=(0,r.EW)((()=>{const t=u.value.findIndex((t=>t._id===e.termData._id));return console.log("Current index for",e.termData.name,":",t,"/",u.value.length),t})),g=(0,r.EW)((()=>{const t=m.value>0;return console.log("Can move up:",e.termData.name,t,"index:",m.value),t})),p=(0,r.EW)((()=>{const t=m.value>=0&&m.value<u.value.length-1;return console.log("Can move down:",e.termData.name,t,"index:",m.value,"total:",u.value.length),t})),y=(0,r.EW)((()=>S())),x=(0,r.EW)((()=>{if(!e.termData.createdAt)return!1;const t=Date.now()-6048e5;return new Date(e.termData.createdAt).getTime()>t})),f=(0,r.EW)((()=>!(!e.termData.updatedAt||!e.termData.createdAt)&&e.termData.updatedAt!==e.termData.createdAt)),b=()=>{console.log("🔄 toggleExpanded clicked for:",e.termData.name),console.log("Current expandedTerms:",e.expandedTerms),console.log("Current termData._id:",e.termData._id),console.log("isExpanded before:",i.value);const o=[...e.expandedTerms],r=o.indexOf(e.termData._id);console.log("Index in expandedTerms:",r),-1===r?(o.push(e.termData._id),console.log("➕ Adding to expanded:",e.termData._id)):(o.splice(r,1),console.log("➖ Removing from expanded:",e.termData._id)),console.log("New expandedTerms:",o),t("update:expandedTerms",o),setTimeout((()=>{console.log("isExpanded after:",i.value)}),100)},v=()=>{o.value=!1,t("add-term",e.termData._id)},k=()=>{o.value=!1,t("edit-term",e.termData)},h=()=>{o.value=!1,Lr.A.confirm({title:"ยืนยันการลบ",message:`คุณต้องการลบ "${e.termData.name}" หรือไม่?`,confirm:()=>{t("delete-term",e.termData)},cancel:()=>{}})},L=()=>{o.value=!1,t("clone-term",e.termData)},T=()=>{console.log("🔄 moveUp clicked for:",e.termData.name),console.log("Current index:",m.value,"Siblings length:",u.value.length),console.log("canMoveUp:",g.value);const o=m.value;if(o<=0)return void console.log("❌ Cannot move up - already at top or invalid index");const r=u.value[o-1];console.log("✅ Moving up - swapping with:",r.name),console.log("Current sortOrder:",e.termData.sortOrder,"Target sortOrder:",r.sortOrder);const a={termId:e.termData._id,currentSortOrder:e.termData.sortOrder,targetTermId:r._id,targetSortOrder:r.sortOrder,suggestedCurrentOrder:r.sortOrder,suggestedTargetOrder:e.termData.sortOrder};console.log("📤 Emitting move-term-up with data:",a),t("move-term-up",a),console.log("📤 Emitting move-term-up (simple) with ID:",e.termData._id),setTimeout((()=>{t("move-term-up",e.termData._id)}),100)},w=()=>{console.log("🔄 moveDown clicked for:",e.termData.name),console.log("Current index:",m.value,"Siblings length:",u.value.length),console.log("canMoveDown:",p.value);const o=m.value;if(o<0||o>=u.value.length-1)return void console.log("❌ Cannot move down - already at bottom or invalid index");const r=u.value[o+1];console.log("✅ Moving down - swapping with:",r.name),console.log("Current sortOrder:",e.termData.sortOrder,"Target sortOrder:",r.sortOrder);const a={termId:e.termData._id,currentSortOrder:e.termData.sortOrder,targetTermId:r._id,targetSortOrder:r.sortOrder,suggestedCurrentOrder:r.sortOrder,suggestedTargetOrder:e.termData.sortOrder};console.log("📤 Emitting move-term-down with data:",a),t("move-term-down",a),console.log("📤 Emitting move-term-down (simple) with ID:",e.termData._id),setTimeout((()=>{t("move-term-down",e.termData._id)}),100)},C=()=>{const e=u.value.map((e=>e.sortOrder)).filter((e=>null!==e&&void 0!==e)),t=[...new Set(e)];if(e.length!==t.length){const e=u.value.map(((e,t)=>({termId:e._id,currentSortOrder:e.sortOrder,suggestedSortOrder:t})));return console.log("🔧 Suggested sortOrder normalization:",e),e}return null},E=()=>{o.value=!1,t("show-term-history",e.termData)},_=()=>{a.value=!0,t("quick-preview",e.termData)},D=()=>{o.value=!1,Lr.A.confirm({title:"ยืนยันการเก็บถาวร",message:`คุณต้องการเก็บ "${e.termData.name}" เข้าถาวรหรือไม่?`,confirm:()=>{t("archive-term",e.termData)},cancel:()=>{}})},F=()=>{o.value=!1,t("export-term",e.termData)},I=()=>{l.value=!l.value,o.value=!1,t("toggle-favorite",{term:e.termData,isFavorite:l.value})},X=()=>{o.value=!1;const r=`${window.location.origin}/terms/${e.termData._id}`;navigator.clipboard.writeText(r).then((()=>{(0,hr.A)({type:"success",message:"ลิงก์ถูกคัดลอกแล้ว!",autohide:!0})})).catch((()=>{(0,hr.A)({type:"error",message:"ไม่สามารถคัดลอกลิงก์ได้",autohide:!0})})),t("share-link",e.termData)},S=()=>{let t=0,o=0;if(e.termData.name&&(t+=20),o+=20,e.termData.code&&(t+=15),o+=15,e.termData.meta&&(t+=15),o+=15,d.value.length>0&&(t+=Math.min(5*d.value.length,25)),o+=25,e.termData.customData){const o=Object.keys(e.termData.customData),r=o.filter((t=>null!==e.termData.customData[t]&&void 0!==e.termData.customData[t]&&""!==e.termData.customData[t]));o.length>0&&(t+=Math.round(r.length/o.length*25))}return o+=25,o>0?Math.round(t/o*100):85};return{showMoreActions:o,showQuickPreview:a,isFavorite:l,childSearchQuery:s,isExpanded:i,childTerms:d,filteredChildTerms:c,siblings:u,currentIndex:m,canMoveUp:g,canMoveDown:p,completionRate:y,isRecent:x,hasChanges:f,toggleExpanded:b,addChild:v,edit:k,deleteTerm:h,clone:L,moveUp:T,moveDown:w,showHistory:E,quickPreview:_,archiveTerm:D,exportTerm:F,toggleFavorite:I,shareLink:X,getCompletionRate:S,suggestSortOrderFix:C}}};const en=(0,ra.A)(Zs,[["render",Ys],["__scopeId","data-v-0c1990e7"]]);var tn=en,on={name:"TaxonomyManager",components:{FieldConfigManager:la,CustomFieldRenderer:Ya,TaxonomyHistoryViewer:us,TermItem:tn},props:{headerType:{type:String,default:null,validator:e=>["topbar","breadcrumb","full-admin",null].includes(e)},headerHeight:{type:[Number,String],default:null},customHeight:{type:String,default:null},customClass:{type:String,default:""}},setup(e){const t=kr.A.get("session"),o=kr.A.get("configs"),r=(0,vr.KR)([{key:"course",label:"คอร์สเรียน",icon:"fas fa-graduation-cap",color:"blue"},{key:"post",label:"โพสต์",icon:"fas fa-file-alt",color:"green"},{key:"member",label:"สมาชิก",icon:"fas fa-users",color:"purple"},{key:"resource",label:"ทรัพยากร",icon:"fas fa-folder",color:"orange"},{key:"product",label:"สินค้า",icon:"fas fa-box",color:"red"},{key:"assessment",label:"แบบประเมินผล",icon:"fas fa-clipboard-check",color:"indigo"}]),a=(0,vr.KR)([]),l=(0,vr.KR)([]),s=(0,vr.KR)(""),n=(0,vr.KR)(""),i=(0,vr.KR)("all"),d=(0,vr.KR)("basic"),c=(0,vr.KR)([]),u=(0,vr.KR)(!1),m=(0,vr.KR)(!1),g=(0,vr.KR)(!1),p=(0,vr.KR)(!1),y=(0,vr.KR)(!1),x=(0,vr.KR)(!1),f=(0,vr.KR)(""),b=(0,vr.KR)({groups:[],terms:[]}),v=(0,vr.KR)(null),k=(0,vr.KR)(null),h=(0,vr.KR)(null),L=(0,vr.KR)(null),T=(0,vr.KR)({type:"",id:"",name:""}),w=(0,vr.KR)({name:"",code:"",sortOrder:0,active:!0,meta:"",customData:{}}),C=(0,vr.KR)({name:"",code:"",active:!0,description:"",fieldConfig:[],contentTypes:[],selectionMode:"multiple",selectionLimit:3}),E=()=>r.value,_=e=>r.value.find((t=>t.key===e))||{label:e,icon:"fas fa-tag",color:"gray"},D=()=>{const e={};r.value.forEach((t=>{e[t.key]={...t,groups:a.value.filter((e=>e.contentTypes&&e.contentTypes.includes(t.key)))}}));const t=a.value.filter((e=>!e.contentTypes||0===e.contentTypes.length));return t.length>0&&(e["unassigned"]={key:"unassigned",label:"ไม่ได้ระบุประเภท",icon:"fas fa-question-circle",color:"gray",groups:t}),e},F=()=>n.value?"unassigned"===n.value?a.value.filter((e=>!e.contentTypes||0===e.contentTypes.length)):a.value.filter((e=>e.contentTypes&&e.contentTypes.includes(n.value))):a.value,I=e=>{n.value=e===n.value?"":e,s.value=""},X=e=>{i.value=e,s.value="",x.value=!1,"undefined"!==typeof window&&(window.location.hash=`#${e}`)},S=()=>{x.value=!x.value},O=()=>{x.value=!1},A=()=>{const e=$();return e.find((e=>e.key===i.value))||e[0]},$=()=>{const e=[{key:"all",label:"ทั้งหมด",icon:"fas fa-list",color:"gray",subText:"Taxonomy ทุกประเภท"}],t=r.value.map((e=>({key:e.key,label:e.label,icon:e.icon,color:e.color,subText:`Taxonomy สำหรับ${e.label}`})));return[...e,...t]},R=()=>{if("all"===i.value)return D();{const e=a.value.filter((e=>e.contentTypes&&e.contentTypes.includes(i.value)));return{[i.value]:{..._(i.value),groups:e}}}},M=e=>{s.value=e},G=()=>{s.value=""},Q=()=>{y.value=!y.value},j=e=>{s.value=e,y.value=!1},U=e=>l.value.filter((t=>t.taxonomy===e)).length,W=()=>{if(e.customHeight||e.headerHeight){if(e.headerHeight){const t="number"===typeof e.headerHeight?`${e.headerHeight}px`:e.headerHeight;document.documentElement.style.setProperty("--header-height",t)}return}let t=0;const o=["header",".header",".navbar",".topbar",".breadcrumb",".access-bar",'[class*="header"]','[class*="navbar"]','[class*="topbar"]','[role="banner"]'];if(o.forEach((e=>{const o=document.querySelectorAll(e);o.forEach((e=>{K(e)&&(t+=e.offsetHeight)}))})),0===t)switch(e.headerType){case"topbar":t=120;break;case"breadcrumb":t=140;break;case"full-admin":t=160;break;default:t=window.innerWidth<=768?56:80}t+=8,document.documentElement.style.setProperty("--header-height",`${t}px`),console.log(`Taxonomy Manager: Calculated header height = ${t}px`)},K=e=>{const t=document.querySelector(".taxonomy-manager-container");if(!t)return!1;const o=e.getBoundingClientRect(),r=t.getBoundingClientRect();return o.bottom<=r.top},P=()=>a.value.find((e=>e._id===s.value)),H=()=>{const e=P();return e?.fieldConfig||[]},q=()=>l.value.filter((e=>e.taxonomy===s.value&&null===e.parentId)).sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))),N=e=>l.value.filter((t=>t.parentId===e)).sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))),B=e=>{const t=[],o=e=>{const r=l.value.filter((t=>t.parentId===e));r.forEach((e=>{t.push(e),o(e._id)}))};return o(e),t},V=e=>{if(!e)return{count:0,items:[],children:[]};const t=B(e._id);return{count:t.length,items:t,children:t}},J=async()=>{try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({method:"find",args:[{$and:[{unit:t.current._id}]}],paging:{page:1,limit:200}})});if(e.ok){const t=await e.json();console.log("Taxonomy data:",t);const o=t.data.filter((e=>"group"===e.type)),r=t.data.filter((e=>"term"===e.type));a.value=o,l.value=r}else console.error("Failed to fetch taxonomy data")}catch(e){console.error("Error fetching taxonomy data:",e)}},z=async(e,t)=>{try{const r=await fetch(`https://gateway.cloudrestfulapi.com/api/taxonomy/${e}`,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({data:t,options:{}})});if(r.ok){await J();const e=await r.json();console.log("Updated taxonomy item:",e)}else console.error("Failed to update taxonomy item")}catch(r){console.error("Error updating taxonomy item:",r)}},Y=async e=>{try{const t=await fetch(`https://gateway.cloudrestfulapi.com/api/taxonomy/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json","client-token-key":o.key}});if(t.ok){await J();const e=await t.json();console.log("Deleted taxonomy item:",e)}else console.error("Failed to delete taxonomy item")}catch(t){console.error("Error deleting taxonomy item:",t)}},Z=async()=>{C.value={name:"",code:"",active:!0,description:"",fieldConfig:[],contentTypes:[],selectionMode:"multiple",selectionLimit:3},k.value=null,m.value=!0},ee=()=>{const e=P();e&&(C.value={name:e.name,code:e.code||"",description:e.description||"",active:e.active,fieldConfig:e.fieldConfig||[],contentTypes:e.contentTypes||[],selectionMode:e.selectionMode||"multiple",selectionLimit:e.selectionLimit||3},k.value=e,m.value=!0)},te=()=>{const e=P();if(e){const t=l.value.filter((t=>t.taxonomy===e._id)).length;t>0?Lr.A.confirm({title:"ยืนยันการลบกลุ่ม",message:`คุณแน่ใจหรือไม่ที่จะลบกลุ่ม "${e.name}"?\n\nจะลบ Terms ทั้งหมด ${t} รายการในกลุ่มนี้ด้วย\n\nการดำเนินการนี้ไม่สามารถยกเลิกได้`,confirm:()=>{const t=(0,hr.A)({type:"pending",message:"กำลังลบ Taxonomy..."}),o=l.value.filter((t=>t.taxonomy===e._id));Promise.all(o.map((e=>Y(e._id)))).then((()=>{Y(e._id),s.value="",t.hide("ลบ Taxonomy สำเร็จ","success",300)})).catch((e=>{t.hide(`เกิดข้อผิดพลาด: ${e.message}`,"error",300)}))},cancel:()=>{}}):Lr.A.confirm({title:"ยืนยันการลบกลุ่ม",message:`คุณแน่ใจหรือไม่ที่จะลบกลุ่ม "${e.name}"?`,confirm:()=>{const t=(0,hr.A)({type:"pending",message:"กำลังลบ Taxonomy..."});Y(e._id).then((()=>{s.value="",t.hide("ลบ Taxonomy สำเร็จ","success",300)})).catch((e=>{t.hide(`เกิดข้อผิดพลาด: ${e.message}`,"error",300)}))},cancel:()=>{}})}},oe=async e=>{const t=l.value.find((t=>t._id===e));if(!t)return;const o=l.value.filter((e=>e.taxonomy===t.taxonomy&&e.parentId===t.parentId)).sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))),r=o.findIndex((t=>t._id===e));if(r<=0)return;const a=o[r-1],s=t.sortOrder||0,{_id:n,...i}=t,{_id:d,...c}=a;await z(t._id,{...i,sortOrder:a.sortOrder||0}),await z(a._id,{...c,sortOrder:s})},re=async e=>{const t=l.value.find((t=>t._id===e));if(!t)return;const o=l.value.filter((e=>e.taxonomy===t.taxonomy&&e.parentId===t.parentId)).sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))),r=o.findIndex((t=>t._id===e));if(r>=o.length-1)return;const a=o[r+1],s=t.sortOrder||0,{_id:n,...i}=t,{_id:d,...c}=a;await z(t._id,{...i,sortOrder:a.sortOrder||0}),await z(a._id,{...c,sortOrder:s})},ae=async e=>{const t=l.value.filter((t=>t.taxonomy===s.value&&t.parentId===e)).sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))),o=t.length>0?Math.max(...t.map((e=>e.sortOrder||0)))+1:0;w.value={sortOrder:o,customData:{}},L.value=e,v.value=null,u.value=!0},le=e=>{w.value={sortOrder:e.sortOrder||0,customData:e.customData||{}},v.value=e,u.value=!0},se=e=>{h.value=e,g.value=!0},ne=async e=>{try{console.log("Starting clone process for term:",e),Lr.A.confirm({title:"ยืนยันการ Clone",message:`คุณต้องการ clone "${e.name}" พร้อมกับ sub terms ทั้งหมดหรือไม่?`,confirm:async()=>{const t=(0,hr.A)({type:"pending",message:`กำลัง clone "${e.name}"...`});try{const o=await ie(e,e.parentId);console.log("Successfully cloned term:",o),await J(),t.hide(`Clone "${e.name}" สำเร็จแล้ว!`,"success",500)}catch(o){console.error("Error cloning term:",o),t.hide(`เกิดข้อผิดพลาดในการ clone term: ${o.message}`,"error",500)}},cancel:()=>{}})}catch(t){console.error("Error in cloneTerm:",t),(0,hr.A)({type:"error",message:`เกิดข้อผิดพลาด: ${t.message}`,autohide:!0})}},ie=async(e,r,a=!0)=>{const s=l.value.filter((t=>t.taxonomy===e.taxonomy&&t.parentId===r)).sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))),n=s.length>0?Math.max(...s.map((e=>e.sortOrder||0)))+1:0,i={type:"term",taxonomy:e.taxonomy,name:a?`Copy of ${e.name}`:e.name,code:e.code?`${e.code}_COPY_${Date.now()}`:"",parentId:r,sortOrder:n,active:!1!==e.active,meta:e.meta||"",customData:e.customData||{}},d=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({data:{unit:t.current._id,...i},options:{}})});if(!d.ok){const e=await d.text();throw new Error(`Failed to create cloned term: ${d.status} - ${e}`)}const c=await d.json();console.log("Clone API response:",c);let u=null;if(c&&c.data&&c.data._id)u=c.data._id;else if(c&&c._id)u=c._id;else{if(!c||!c.insertedId)throw console.error("Unexpected API response structure:",c),new Error("ไม่สามารถดึง ID ของ term ที่สร้างใหม่ได้");u=c.insertedId}console.log("New term ID:",u),await J();const m=l.value.filter((t=>t.parentId===e._id));if(m.length>0){console.log(`Cloning ${m.length} child terms for parent:`,e.name);for(const e of m)await ie(e,u,!1)}return c},de=async()=>{try{const r=H();let a=[];if(r.forEach((e=>{const t=w.value.customData[e.key];if(e.required&&(t&&("string"!==typeof t||t.trim())||a.push(`${e.label} เป็นฟิลด์บังคับ`)),e.unique&&t&&("string"===typeof t?t.trim():t)){const o=l.value.some((o=>{if(v.value&&o._id===v.value._id)return!1;if(o.taxonomy!==s.value)return!1;const r=o.customData?.[e.key];if(!r)return!1;const a="string"===typeof t?t.toLowerCase().trim():t,l="string"===typeof r?r.toLowerCase().trim():r;return l===a}));o&&a.push(`${e.label} ซ้ำกัน กรุณาใช้ข้อมูลอื่น`)}})),a.length>0)return void(0,hr.A)({type:"error",title:"ข้อมูลไม่ถูกต้อง",message:`กรุณาแก้ไขข้อผิดพลาด:\n${a.join("\n")}`,autohide:!0});const n=(0,hr.A)({type:"pending",message:v.value?"กำลังอัปเดต Term...":"กำลังสร้าง Term..."}),i=null!==v.value,d=i?{...v.value}:null,c=w.value.customData?.name||w.value.customData?.ชื่อ,u=c||`Term-${Date.now()}`,m={type:"term",taxonomy:s.value,name:u.trim(),parentId:L.value,sortOrder:w.value.sortOrder||0,active:!0,customData:w.value.customData||{}};if(i){if(await z(v.value._id,m),await Te("UPDATE","term",v.value._id,u,m,d),v.value&&v.value.parentId){const e=l.value.find((e=>e._id===v.value.parentId));e&&await Ce("UPDATE",e,v.value)}n.hide("อัปเดต Term สำเร็จ","success",300)}else try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({data:{unit:t.current._id,...m},options:{}})});if(e.ok){const t=await e.json(),o=t.data?._id||t._id;if(await Te("CREATE","term",o,u,m),L.value){const e=l.value.find((e=>e._id===L.value));if(e){const t={_id:o,name:u,...m};await Ce("CREATE",e,t)}}n.hide("เพิ่ม Term สำเร็จ","success",300),await J()}else{const t=await e.json();n.hide(`เกิดข้อผิดพลาด: ${t.message}`,"error",300)}}catch(e){console.error("Error creating term:",e),n.hide(`เกิดข้อผิดพลาด: ${e.message}`,"error",300)}ge()}catch(e){console.error("Error saving term:",e),(0,hr.A)({type:"error",message:`เกิดข้อผิดพลาด: ${e.message}`,autohide:!0})}},ce=async()=>{if(C.value.name?.trim())if(C.value.contentTypes&&0!==C.value.contentTypes.length)try{const r=(0,hr.A)({type:"pending",message:k.value?"กำลังอัปเดตกลุ่ม...":"กำลังสร้างกลุ่ม..."}),a=null!==k.value,l=a?{...k.value}:null,s={type:"group",name:C.value.name.trim(),code:C.value.code?.trim()||"",description:C.value.description?.trim()||"",active:!1!==C.value.active,fieldConfig:C.value.fieldConfig||[],contentTypes:C.value.contentTypes||[],selectionMode:C.value.selectionMode||"multiple",selectionLimit:"limited"===C.value.selectionMode?C.value.selectionLimit||3:null};if(a)await z(k.value._id,s),await Te("UPDATE","group",k.value._id,s.name,s,l),r.hide("อัปเดตกลุ่ม Taxonomy สำเร็จ","success",300);else try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({data:{unit:t.current._id,...s},options:{}})});if(e.ok){const t=await e.json();await Te("CREATE","group",t.data?._id||t._id,s.name,s),r.hide("สร้างกลุ่ม Taxonomy สำเร็จ","success",300),await J()}else{const t=await e.json();r.hide(`เกิดข้อผิดพลาด: ${t.message}`,"error",300)}}catch(e){console.error("Error creating taxonomy group:",e),r.hide(`เกิดข้อผิดพลาด: ${e.message}`,"error",300)}pe()}catch(e){console.error("Error saving taxonomy group:",e),(0,hr.A)({type:"error",message:`เกิดข้อผิดพลาด: ${e.message}`,autohide:!0})}else(0,hr.A)({type:"error",message:"กรุณาเลือกประเภทเนื้อหาอย่างน้อย 1 ประเภท",autohide:!0});else(0,hr.A)({type:"error",message:"กรุณากรอกชื่อ Taxonomy",autohide:!0})},ue=async()=>{try{const e=h.value,t=e.name||"Unknown Term",o=V(e),r=o.count+1,a=(0,hr.A)({type:"pending",message:`กำลังลบ "${t}"...`}),s=[h.value._id],n=e=>{const t=l.value.filter((t=>t.parentId===e));t.forEach((e=>{s.push(e._id),n(e._id)}))};n(h.value._id),console.log(`Deleting ${s.length} terms cascading from "${t}"`);const i=[],d=[];for(const c of s){const e=l.value.find((e=>e._id===c));if(e&&(i.push(Te("DELETE","term",c,e.name||"Unknown",null,e)),e.parentId)){const t=l.value.find((t=>t._id===e.parentId));t&&!s.includes(t._id)&&d.push({parentTerm:t,deletedSubTerm:e})}}await Promise.all(i);for(const l of d)await Ce("DELETE",l.parentTerm,l.deletedSubTerm);for(const l of s)await Y(l),console.log(`🗑️ Deleted term from database: ${l}`);o.count>0?a.hide(`ลบ "${t}" และ Sub Terms ทั้งหมด ${r} รายการสำเร็จแล้ว\n📝 บันทึก audit logs สำหรับทุก term แล้ว`,"success",500):a.hide(`ลบ "${t}" สำเร็จแล้ว\n📝 บันทึก audit log แล้ว`,"success",500),me()}catch(e){console.error("Error deleting terms:",e),(0,hr.A)({type:"error",message:`เกิดข้อผิดพลาดในการลบ: ${e.message}`,autohide:!0})}},me=()=>{h.value=null,g.value=!1},ge=()=>{u.value=!1,v.value=null,L.value=null,w.value={sortOrder:0,customData:{}}},pe=()=>{m.value=!1,k.value=null,d.value="basic",C.value={name:"",code:"",description:"",active:!0,fieldConfig:[],contentTypes:[],selectionMode:"multiple",selectionLimit:3}},ye=e=>{const t=c.value.indexOf(e);-1===t?c.value.push(e):c.value.splice(t,1)},xe=()=>{const e={taxonomyGroups:a.value,terms:l.value};console.log("Export data:",JSON.stringify(e,null,2));const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),o=URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download="taxonomy-data.json",r.click(),URL.revokeObjectURL(o)},fe=()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{try{const t=JSON.parse(e.target.result);t.taxonomyGroups&&t.terms&&(a.value=t.taxonomyGroups,l.value=t.terms,s.value="",c.value=[])}catch(t){alert("Invalid JSON file")}},e.readAsText(t)}},e.click()},be=async()=>{try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy_audit/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({method:"find",args:[{unit:t.current._id}],paging:{page:1,limit:1}})});if(!e.ok)return void(0,hr.A)({type:"error",message:"ไม่สามารถตรวจสอบจำนวน logs ได้",autohide:!0});const r=await e.json(),a=r.total||0;if(0===a)return void(0,hr.A)({type:"info",message:"ไม่มี audit logs ให้ลบ",autohide:!0});Lr.A.confirm({title:"ยืนยันการลบ Audit Logs",message:`คุณแน่ใจหรือไม่ที่จะลบ Audit Logs ทั้งหมด?\n\nจำนวน logs ที่จะลบ: ${a} รายการ\n\nการดำเนินการนี้ไม่สามารถยกเลิกได้\nจะลบประวัติการเปลี่ยนแปลงทั้งหมดของ Taxonomy`,confirm:async()=>{const e=(0,hr.A)({type:"pending",message:"กำลังลบ audit logs..."});try{const a=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy_audit/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({method:"find",args:[{unit:t.current._id}],paging:{page:1,limit:1e4}})});if(!a.ok)return void e.hide("ไม่สามารถดึงรายการ logs ได้","error",300);const l=await a.json(),s=l.data?.map((e=>e._id))||[],n=s.length;if(0===n)return void e.hide("ไม่มี audit logs ให้ลบ","info",300);let i=0;for(const e of s)try{const t=await fetch(`https://gateway.cloudrestfulapi.com/api/taxonomy_audit/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json","client-token-key":o.key}});t.ok?i++:console.warn(`Failed to delete log: ${e}`)}catch(r){console.warn(`Error deleting log ${e}:`,r)}i>0?e.hide(`ลบ audit logs สำเร็จ\nลบแล้ว: ${i}/${n} รายการ`,"success",500):e.hide("ไม่สามารถลบ audit logs ได้","error",300)}catch(r){console.error("Error in delete operation:",r),e.hide("เกิดข้อผิดพลาดในการลบ logs","error",300)}},cancel:()=>{}})}catch(e){console.error("Error purging logs:",e),(0,hr.A)({type:"error",message:"เกิดข้อผิดพลาดในการลบ logs",autohide:!0})}},ve=()=>{T.value={type:"group",id:s.value,name:P()?.name},p.value=!0},ke=e=>{T.value={type:"term",id:e._id,name:e.name},p.value=!0},he=()=>{p.value=!1},Le=async e=>{console.log("Rollback completed:",e);try{const t=(0,hr.A)({type:"pending",message:"กำลังรีเฟรชข้อมูล..."});await J();const o="group"===e.targetType?"กลุ่ม":"Term";t.hide(`กู้คืน${o}สำเร็จ - ข้อมูลได้รับการอัพเดตแล้ว`,"success",500),he()}catch(t){console.error("Error refreshing data after rollback:",t),(0,hr.A)({type:"error",message:"กู้คืนสำเร็จแต่เกิดข้อผิดพลาดในการรีเฟรชข้อมูล",autohide:!0})}},Te=async(e,r,a,l,s,n=null)=>{try{const i={action:e,targetType:r,targetId:a,targetName:l,userId:"current-user-id",userName:"Current User",timestamp:(new Date).toISOString(),data:s,diff:n?{before:n,after:s}:null,changesSummary:n?Ee(n,s):null,version:`${Date.now()}`,userAgent:navigator.userAgent,ipAddress:"auto-detect",unit:t.current._id},d=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy_audit",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({data:i,options:{}})});if(d.ok){const e=await d.json();console.log("Audit log created:",e)}else console.warn("Failed to create audit log:",await d.text())}catch(i){console.warn("Error creating audit log:",i)}},we=async(e,r,a,s)=>{try{const n=l.value.find((e=>e._id===r));if(!n||!n.parentId)return void console.log(`⚠️ Skipping cascade audit log - no parent found for term: ${a} (${r})`);const i=l.value.find((e=>e._id===n.parentId));if(!i)return void console.log(`⚠️ Parent term not found for: ${a} (Parent ID: ${n.parentId})`);console.log(`🔗 Creating cascade audit log for parent "${i.name}" due to sub term "${a}" ${e}`);const d={action:`SUB_${e}`,targetType:"term",targetId:i._id,targetName:`${i.name} (Sub term activity)`,userId:"current-user-id",userName:"Current User",timestamp:(new Date).toISOString(),data:{parentTerm:i,subTermAction:e,subTermId:r,subTermName:a,subTermData:s},version:`${Date.now()}`,userAgent:navigator.userAgent,ipAddress:"auto-detect",unit:t.current._id},c=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy_audit",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({data:d,options:{}})});if(c.ok)console.log(`✅ Cascade audit log created for parent term: ${i.name}`);else{const e=await c.text();console.warn("❌ Failed to create cascade audit log:",e)}}catch(n){console.warn("Error creating cascade audit log:",n)}},Ce=async(e,r,a)=>{try{console.log(`🔗 Creating direct cascade audit log for parent "${r.name}" due to sub term "${a.name}" ${e}`);const l={action:`SUB_${e}`,targetType:"term",targetId:r._id,targetName:`${r.name} (Sub term activity: ${e})`,userId:"current-user-id",userName:"Current User",timestamp:(new Date).toISOString(),data:{parentTerm:r,subTermAction:e,subTermId:a._id,subTermName:a.name,subTermData:a},version:`${Date.now()}`,userAgent:navigator.userAgent,ipAddress:"auto-detect",unit:t.current._id},s=await fetch("https://gateway.cloudrestfulapi.com/api/taxonomy_audit",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":o.key},body:JSON.stringify({data:l,options:{}})});if(s.ok)console.log(`✅ Direct cascade audit log created for parent term: ${r.name}`);else{const e=await s.text();console.warn("❌ Failed to create direct cascade audit log:",e)}}catch(l){console.warn("Error creating direct cascade audit log:",l)}},Ee=(e,t)=>{const o=[],r=new Set([...Object.keys(e||{}),...Object.keys(t||{})]);for(const a of r){const r=e?.[a],l=t?.[a];JSON.stringify(r)!==JSON.stringify(l)&&o.push({field:a,from:r,to:l})}return o},_e=()=>{if(!f.value.trim())return void(b.value={groups:[],terms:[]});const e=f.value.toLowerCase().trim(),t=a.value.filter((t=>t.name?.toLowerCase().includes(e)||t.code?.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e))),o=l.value.filter((t=>{const o=t.customData&&Object.values(t.customData).some((t=>"string"===typeof t&&t.toLowerCase().includes(e)));return t.name?.toLowerCase().includes(e)||t.code?.toLowerCase().includes(e)||o}));b.value={groups:t,terms:o}},De=()=>{f.value="",b.value={groups:[],terms:[]}},Fe=e=>{const t=a.value.find((t=>t._id===e));return t?.name||"ไม่ระบุกลุ่ม"};J();const Ie=()=>{const e=P();if(!e)return"";if(e.contentTypes&&e.contentTypes.length>0){const t=e.contentTypes.map((e=>{const t=_(e);return t.label})).join(", ");return`${t} > ${e.name}`}return e.name};return{taxonomyGroups:a,terms:l,selectedTaxonomyGroup:s,selectedContentType:n,selectedContentTypeTab:i,contentTypes:r,expandedTerms:c,showTermModal:u,showTaxonomyModal:m,showDeleteModal:g,showHistoryModal:p,showMobileSidebar:y,showMobileDropdown:x,editingTerm:v,editingTaxonomyGroup:k,termToDelete:h,termForm:w,taxonomyGroupForm:C,historyTarget:T,session:t,searchQuery:f,searchResults:b,getCurrentTaxonomyGroup:P,getRootTerms:q,getChildTerms:N,getTermsForGroup:()=>l.value.filter((e=>e.taxonomy===s.value)),getSubTermsCount:()=>l.value.filter((e=>e.taxonomy===s.value&&null!==e.parentId)).length,getActiveTermsCount:()=>l.value.filter((e=>e.taxonomy===s.value&&!1!==e.active)).length,getAllDescendants:B,getDeletePreview:V,getCurrentFieldConfig:H,getContentTypesDisplay:E,getContentTypeInfo:_,getGroupsByContentType:D,getFilteredTaxonomyGroups:F,selectContentType:I,selectContentTypeTab:X,selectTaxonomyGroup:M,backToGroupSelection:G,toggleMobileSidebar:Q,selectTaxonomyGroupAndCloseMobile:j,getTermsCountForGroup:U,calculateHeaderHeight:W,addTaxonomyGroup:Z,editTaxonomyGroup:ee,deleteTaxonomyGroup:te,addTerm:ae,editTerm:le,deleteTerm:se,saveTerm:de,saveTaxonomyGroup:ce,confirmDelete:ue,cancelDelete:me,closeTermModal:ge,closeTaxonomyModal:pe,getTaxonomyData:J,updateTaxonomyItem:z,deleteTaxonomyItem:Y,exportData:xe,importData:fe,moveTermUp:oe,moveTermDown:re,cloneTerm:ne,toggleChildren:ye,showGroupHistory:ve,showTermHistoryHandler:ke,closeHistoryModal:he,onRollbackComplete:Le,createAuditLog:Te,createCascadeAuditLog:we,createCascadeAuditLogDirect:Ce,generateChangesSummary:Ee,purgeLogs:be,getTabsData:$,getTabContent:R,toggleMobileDropdown:S,closeMobileDropdown:O,getCurrentTabInfo:A,getCurrentTaxonomyGroupTitle:Ie,performSearch:_e,clearSearch:De,getTaxonomyGroupName:Fe,selectedTaxonomyModalTab:d}},mounted(){this.calculateHeaderHeight(),window.addEventListener("resize",this.calculateHeaderHeight);try{const e=window.location.hash;if(e){const t=e.replace("#",""),o=["all",...this.contentTypes.map((e=>e.key))];o.includes(t)&&(this.selectedContentTypeTab=t)}}catch(e){console.log("Hash navigation error:",e)}},beforeUnmount(){window.removeEventListener("resize",this.calculateHeaderHeight)}};const rn=(0,ra.A)(on,[["render",br],["__scopeId","data-v-2df17feb"]]);var an=rn,ln={name:"Lesson Edit",components:{Target:an},data(){return{login:kr.A.get("session","login")}},methods:{},setup(){const e=(0,s.lq)(),t=e.meta.title;(0,l.K7)(t)}};const sn=(0,ra.A)(ln,[["render",a]]);var nn=sn},40687:function(e,t,o){o.d(t,{A:function(){return x}});var r=o(20641),a=o(50953),l=o(90033),s=o(94232),n=o(10797),i=o(55372);const d={key:0,class:"fixed inset-0 overflow-y-auto"},c={class:"flex min-h-full items-center justify-center p-4 text-center"},u={class:"font-medium"},m={class:"bg-black w-8 h-8 right-2 top-2 leading-8 hover:bg-gray-500"},g={props:["isWindowsOpen","allowFileType","callbackFunction"],data(){return console.log("FileBrowser props:",this.isWindowsOpen,this.allowFileType,this.callbackFunction),{SessionList:[],loading_sources:!0,activeBlock:!1,schoolId:"",isOpen:this.isWindowsOpen,isAllow:this.allowFileType,isCallback:this.callbackFunction,mode:"popup"}},components:{FileManager:i.A},watch:{isWindowsOpen(e){console.log("isWindowsOpen changed to:",e),this.isOpen=e}},methods:{selectFileTrigger(e){this.selectFileTrigger=e,this.closeModal(),this.selectFile(e)},closeModal(){this.isOpen=!1,this.$emit("fileBrowserTrigger",!1)},selectFile(e){this.$emit("fileBrowserCallback",e)}},async mounted(){console.log("FileBrowser mounted with isOpen:",this.isOpen,"isWindowsOpen:",this.isWindowsOpen)},setup(){}};var p=Object.assign(g,{__name:"FileBrowser",setup(e){return(t,o)=>{const g=(0,r.g2)("font-awesome-icon");return(0,r.uX)(),(0,r.Wv)((0,a.R1)(s.O),{appear:"",show:t.isOpen,as:"template"},{default:(0,r.k6)((()=>[(0,r.bF)((0,a.R1)(n.lG),{as:"div",onClose:t.closeModal,class:"relative z-10"},{default:(0,r.k6)((()=>[(0,r.bF)((0,a.R1)(s._),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:(0,r.k6)((()=>o[1]||(o[1]=[(0,r.Lk)("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)]))),_:1}),t.loading_sources?((0,r.uX)(),(0,r.CE)("div",d,[(0,r.Lk)("div",c,[(0,r.bF)((0,a.R1)(s._),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:(0,r.k6)((()=>[(0,r.bF)((0,a.R1)(n.Lj),{class:(0,l.C4)(["w-[60rem] z-40 transform overflow-hidden bg-white p-3 text-left align-middle shadow-xl transition-all blocking relative",[t.activeBlock?"isblock":"isunblock"]]),"data-content":"กำลังติดต่อฐานข้อมูล กรุณารอสักครู่....."},{default:(0,r.k6)((()=>[(0,r.bF)((0,a.R1)(n.L3),{as:"h3",class:"text-lg pb-2 font-bold leading-6 text-gray-900 border-b"},{default:(0,r.k6)((()=>[o[3]||(o[3]=(0,r.eW)("เลือกไฟล์ (Select File) ")),(0,r.Lk)("p",u,[o[2]||(o[2]=(0,r.eW)("อนุญาติเฉพาะไฟล์ ")),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.allowFileType,(e=>((0,r.uX)(),(0,r.CE)("span",{key:e.code,class:"text-xs font-medium bg-indigo-600 pl-2 pr-2 pt-1 mr-1 rounded text-white"},(0,l.v_)(e),1)))),128))]),(0,r.Lk)("button",{onClick:o[0]||(o[0]=(...e)=>t.closeModal&&t.closeModal(...e)),type:"button",class:"z-50 absolute top-2 right-2"},[(0,r.Lk)("div",m,[(0,r.bF)(g,{icon:["fas","times"],class:"text-white mt-[7px] font-sm"})])])])),_:1}),(0,r.Lk)("div",null,[(0,r.bF)(i.A,{onSelectFileTrigger:t.selectFileTrigger,Mode:t.mode,AllowFile:t.isAllow,CallbackFunc:t.isCallback},null,8,["onSelectFileTrigger","Mode","AllowFile","CallbackFunc"])])])),_:1},8,["class"])])),_:1})])])):(0,r.Q3)("",!0)])),_:1},8,["onClose"])])),_:1},8,["show"])}}});const y=p;var x=y},97080:function(e,t,o){var r=o(94402).has;e.exports=function(e){return r(e),e}},83789:function(e,t,o){var r=o(79306),a=o(28551),l=o(69565),s=o(91291),n=o(1767),i="Invalid size",d=RangeError,c=TypeError,u=Math.max,m=function(e,t){this.set=e,this.size=u(t,0),this.has=r(e.has),this.keys=r(e.keys)};m.prototype={getIterator:function(){return n(a(l(this.keys,this.set)))},includes:function(e){return l(this.has,this.set,e)}},e.exports=function(e){a(e);var t=+e.size;if(t!==t)throw new c(i);var o=s(t);if(o<0)throw new d(i);return new m(e,o)}},40507:function(e,t,o){var r=o(69565);e.exports=function(e,t,o){var a,l,s=o?e:e.iterator,n=e.next;while(!(a=r(n,s)).done)if(l=t(a.value),void 0!==l)return l}},89286:function(e,t,o){var r=o(94402),a=o(38469),l=r.Set,s=r.add;e.exports=function(e){var t=new l;return a(e,(function(e){s(t,e)})),t}},83440:function(e,t,o){var r=o(97080),a=o(94402),l=o(89286),s=o(25170),n=o(83789),i=o(38469),d=o(40507),c=a.has,u=a.remove;e.exports=function(e){var t=r(this),o=n(e),a=l(t);return s(t)<=o.size?i(t,(function(e){o.includes(e)&&u(a,e)})):d(o.getIterator(),(function(e){c(t,e)&&u(a,e)})),a}},94402:function(e,t,o){var r=o(79504),a=Set.prototype;e.exports={Set:Set,add:r(a.add),has:r(a.has),remove:r(a["delete"]),proto:a}},68750:function(e,t,o){var r=o(97080),a=o(94402),l=o(25170),s=o(83789),n=o(38469),i=o(40507),d=a.Set,c=a.add,u=a.has;e.exports=function(e){var t=r(this),o=s(e),a=new d;return l(t)>o.size?i(o.getIterator(),(function(e){u(t,e)&&c(a,e)})):n(t,(function(e){o.includes(e)&&c(a,e)})),a}},64449:function(e,t,o){var r=o(97080),a=o(94402).has,l=o(25170),s=o(83789),n=o(38469),i=o(40507),d=o(9539);e.exports=function(e){var t=r(this),o=s(e);if(l(t)<=o.size)return!1!==n(t,(function(e){if(o.includes(e))return!1}),!0);var c=o.getIterator();return!1!==i(c,(function(e){if(a(t,e))return d(c,"normal",!1)}))}},53838:function(e,t,o){var r=o(97080),a=o(25170),l=o(38469),s=o(83789);e.exports=function(e){var t=r(this),o=s(e);return!(a(t)>o.size)&&!1!==l(t,(function(e){if(!o.includes(e))return!1}),!0)}},28527:function(e,t,o){var r=o(97080),a=o(94402).has,l=o(25170),s=o(83789),n=o(40507),i=o(9539);e.exports=function(e){var t=r(this),o=s(e);if(l(t)<o.size)return!1;var d=o.getIterator();return!1!==n(d,(function(e){if(!a(t,e))return i(d,"normal",!1)}))}},38469:function(e,t,o){var r=o(79504),a=o(40507),l=o(94402),s=l.Set,n=l.proto,i=r(n.forEach),d=r(n.keys),c=d(new s).next;e.exports=function(e,t,o){return o?a({iterator:d(e),next:c},t):i(e,t)}},84916:function(e,t,o){var r=o(97751),a=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},l=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var o=r("Set");try{(new o)[e](a(0));try{return(new o)[e](a(-1)),!1}catch(n){if(!t)return!0;try{return(new o)[e](l(-1/0)),!1}catch(i){var s=new o;return s.add(1),s.add(2),t(s[e](l(1/0)))}}}catch(i){return!1}}},25170:function(e,t,o){var r=o(46706),a=o(94402);e.exports=r(a.proto,"size","get")||function(e){return e.size}},83650:function(e,t,o){var r=o(97080),a=o(94402),l=o(89286),s=o(83789),n=o(40507),i=a.add,d=a.has,c=a.remove;e.exports=function(e){var t=r(this),o=s(e).getIterator(),a=l(t);return n(o,(function(e){d(t,e)?c(a,e):i(a,e)})),a}},44204:function(e,t,o){var r=o(97080),a=o(94402).add,l=o(89286),s=o(83789),n=o(40507);e.exports=function(e){var t=r(this),o=s(e).getIterator(),i=l(t);return n(o,(function(e){a(i,e)})),i}},17642:function(e,t,o){var r=o(46518),a=o(83440),l=o(84916),s=!l("difference",(function(e){return 0===e.size}));r({target:"Set",proto:!0,real:!0,forced:s},{difference:a})},58004:function(e,t,o){var r=o(46518),a=o(79039),l=o(68750),s=o(84916),n=!s("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||a((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));r({target:"Set",proto:!0,real:!0,forced:n},{intersection:l})},33853:function(e,t,o){var r=o(46518),a=o(64449),l=o(84916),s=!l("isDisjointFrom",(function(e){return!e}));r({target:"Set",proto:!0,real:!0,forced:s},{isDisjointFrom:a})},45876:function(e,t,o){var r=o(46518),a=o(53838),l=o(84916),s=!l("isSubsetOf",(function(e){return e}));r({target:"Set",proto:!0,real:!0,forced:s},{isSubsetOf:a})},32475:function(e,t,o){var r=o(46518),a=o(28527),l=o(84916),s=!l("isSupersetOf",(function(e){return!e}));r({target:"Set",proto:!0,real:!0,forced:s},{isSupersetOf:a})},15024:function(e,t,o){var r=o(46518),a=o(83650),l=o(84916);r({target:"Set",proto:!0,real:!0,forced:!l("symmetricDifference")},{symmetricDifference:a})},31698:function(e,t,o){var r=o(46518),a=o(44204),l=o(84916);r({target:"Set",proto:!0,real:!0,forced:!l("union")},{union:a})}}]);
//# sourceMappingURL=2808.87c17656.js.map