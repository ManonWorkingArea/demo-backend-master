"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[3263],{43263:function(e,s,t){t.d(s,{A:function(){return Xe}});var a=t(20641),r=t(90033);const l={key:0},n={role:"list",class:"divide-y divide-gray-200 player"},i={key:0,class:"flex items-center justify-center py-8 rounded"},o={key:1,class:"divide-y divide-gray-200"},c=["href"],d={class:"px-4 py-4 sm:px-6"},u={class:"flex items-center justify-between"},m={class:"flex items-center"},p={class:"mr-2"},y={class:"truncate text-sm font-semibold text-red-600"},g={class:"ml-2 flex flex-shrink-0"},h={class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"},f={class:"mt-2 sm:flex sm:justify-between"},x={class:"sm:flex"},k={class:"mt-2 flex items-center text-sm text-gray-500 sm:mt-0"},b={class:"mt-2 flex items-center text-sm text-gray-500 sm:mt-0"},v=["href"],_={key:0,class:"before:not-available absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-red-500 text-white px-2 text-sm text-center"},L={class:"px-4 py-4 sm:px-6"},P={class:"flex items-center justify-between"},w={class:"flex items-center"},C={key:0,class:"mr-2"},E={key:1,class:"mr-2"},D={class:"truncate text-sm font-semibold text-indigo-600"},I={key:0,class:"absolute inline-block rounded-full bg-red-500 ml-2 p-1 h-5 w-5"},A={class:"ml-2 flex flex-shrink-0"},F=["innerHTML"],T={key:0,class:"mt-2 sm:flex sm:justify-between"},X={class:"sm:flex"},M={class:"mt-2 flex items-center text-sm text-gray-500 sm:mt-0"},Q={class:"mt-2 flex items-center text-sm text-gray-500 sm:mt-0"},W={key:0},$={key:1},S={key:0,role:"list",class:"divide-y divide-gray-200"},j=["href"],O={key:0,class:"before:not-available absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-red-500 text-white px-2 text-sm text-center"},U={class:"px-4 py-4 sm:px-6"},q={class:"flex items-center justify-between"},K={class:"truncate text-sm font-semibold text-indigo-600"},H={key:0,class:"absolute inline-block rounded-full bg-red-500 ml-2 p-1 h-5 w-5"},Y={class:"text-gray-400 text-sm pt-2 pb-2"},z={class:"ml-2 flex flex-shrink-0"},B=["innerHTML"],G={class:"mt-2 sm:flex sm:justify-between"},N={class:"sm:flex"},J={class:"mt-2 flex items-center text-sm text-gray-500 sm:mt-0"},R={key:0,class:"mt-2 flex items-center text-sm text-gray-500 sm:mt-0"},V={class:"mt-2 flex items-center text-sm text-gray-500 sm:mt-0"},Z={key:0},ee={key:1},se={key:0,class:"divide-y divide-gray-200"},te=["href"],ae={class:"px-4 py-4 sm:px-6"},re={class:"flex items-center justify-between"},le={class:"flex items-center"},ne={class:"mr-2"},ie={class:"truncate text-sm font-semibold text-red-600"},oe={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-200 text-green-800"},ce={class:"ml-2 flex flex-shrink-0"},de={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"},ue={key:1,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"},me={class:"mt-2 sm:flex sm:justify-between"},pe={class:"sm:flex"},ye={class:"mt-2 flex items-center text-sm text-gray-500 mr-2 sm:mt-0"},ge={class:"mt-2 flex items-center text-sm text-gray-500 sm:mt-0"},he={class:"mt-2 flex items-center text-sm text-gray-500 sm:mt-0"};function fe(e,s,t,fe,xe,ke){const be=(0,a.g2)("spinner"),ve=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)(a.FK,null,[t.debug?((0,a.uX)(),(0,a.CE)("div",l,[(0,a.Lk)("div",null,[s[0]||(s[0]=(0,a.eW)(" Due Status: ")),(0,a.Lk)("span",null,(0,r.v_)(ke.checkDue(t.courseData.endDate)?"True":"False"),1)]),s[1]||(s[1]=(0,a.Lk)("p",null,"courseData",-1)),(0,a.Lk)("pre",null,(0,r.v_)(t.courseData),1),s[2]||(s[2]=(0,a.Lk)("p",null,"groupedPlayers",-1)),(0,a.Lk)("pre",null,(0,r.v_)(ke.groupedPlayers),1),s[3]||(s[3]=(0,a.Lk)("p",null,"analytics",-1)),(0,a.Lk)("pre",null,(0,r.v_)(ke.groupedPlayers.analytics),1),(0,a.eW)(" Pre Exam : "+(0,r.v_)(ke.checkExam("pre"))+" ",1),s[4]||(s[4]=(0,a.Lk)("br",null,null,-1)),(0,a.eW)(" Exam : "+(0,r.v_)(ke.getFilteredExams("pre")),1),s[5]||(s[5]=(0,a.Lk)("br",null,null,-1)),(0,a.eW)(" dataItem : "+(0,r.v_)(t.dataItem),1),s[6]||(s[6]=(0,a.Lk)("br",null,null,-1)),(0,a.eW)(" playerItem : "+(0,r.v_)(t.playerItem),1),s[7]||(s[7]=(0,a.Lk)("br",null,null,-1)),(0,a.eW)(" playOption : "+(0,r.v_)(t.playOption),1),s[8]||(s[8]=(0,a.Lk)("br",null,null,-1))])):(0,a.Q3)("",!0),(0,a.Lk)("ul",n,[xe.loading_sources?((0,a.uX)(),(0,a.CE)("li",i,[(0,a.bF)(be,{class:"w-full"}),s[9]||(s[9]=(0,a.Lk)("div",{class:"ml-3"},[(0,a.Lk)("p",{class:"text-lg font-semibold text-gray-600"},"กำลังโหลดข้อมูล"),(0,a.Lk)("span",{class:"text-xs font-normal leading-2 block text-gray-500"},"กรุณารอสักครู่...")],-1))])):(0,a.Q3)("",!0),ke.checkExam("pre")&&ke.enrollAccess?((0,a.uX)(),(0,a.CE)("li",o,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ke.getFilteredExams("pre"),(e=>((0,a.uX)(),(0,a.CE)("div",{key:e._id},[(0,a.Lk)("a",{href:ke.isLinkClickable(e)?`/lesson/assessment/${this.dataItem}/${e._id}`:"javascript:void(0)",class:(0,r.C4)(["block hover:bg-gray-50",{"opacity-30":!ke.isLinkClickable(e),relative:!0}])},[(0,a.Lk)("div",d,[(0,a.Lk)("div",u,[(0,a.Lk)("div",m,[(0,a.Lk)("span",p,[(0,a.bF)(ve,{icon:["fas","file-alt"],class:"mr-1.5 h-5 w-5 flex-shrink-0 text-red-500"})]),(0,a.Lk)("p",y,(0,r.v_)(e.name),1)]),(0,a.Lk)("div",g,[(0,a.Lk)("span",h,(0,r.v_)(e.score?e.score.score+" คะแนน":"ยังไม่ได้สอบ"),1)])]),(0,a.Lk)("div",f,[(0,a.Lk)("div",x,[(0,a.Lk)("p",k,[(0,a.bF)(ve,{icon:["far","list-alt"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),s[10]||(s[10]=(0,a.Lk)("span",{class:"text-gray-600 font-semibold mr-1.5"}," จำนวนข้อสอบ ",-1)),(0,a.eW)(" "+(0,r.v_)(e.total)+" ข้อ ",1)])]),(0,a.Lk)("div",b,[(0,a.bF)(ve,{icon:["far","clock"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),(0,a.Lk)("p",null,(0,r.v_)(e.timer)+" นาที",1)])])])],10,c)])))),128))])):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ke.groupedPlayers.allItems,(e=>((0,a.uX)(),(0,a.CE)("li",{key:e._id,class:"divide-y divide-gray-200"},[(0,a.Lk)("a",{href:"folder"!=e.type&&ke.enrollAccess&&this.login&&e.canPlay?"/lesson/play/"+this.dataItem+"/"+e._id:"javascript:void(0);",class:(0,r.C4)([{"bg-gray-200":this.player&&this.player._id&&e&&e._id&&e._id===this.player._id,"opacity-60":!e.canPlay&&this.enrollAccess&&"folder"!=e.type,relative:!0},"block hover:bg-gray-50"])},[!e.canPlay&&"folder"!=e.type&&this.enrollAccess?((0,a.uX)(),(0,a.CE)("span",_,(0,r.v_)(e.canPlayMessage||"ยังเรียนบทก่อนหน้าไม่จบ"),1)):(0,a.Q3)("",!0),(0,a.Lk)("div",L,[(0,a.Lk)("div",P,[(0,a.Lk)("div",w,["folder"===e.type?((0,a.uX)(),(0,a.CE)("span",C,[(0,a.bF)(ve,{icon:["fas","folder-open"],class:"mr-1.5 h-5 w-5 flex-shrink-0 text-orange-500"})])):((0,a.uX)(),(0,a.CE)("span",E,[(0,a.bF)(ve,{icon:["fas","video"],class:"mr -1.5 h-5 w-5 flex-shrink-0 text-green-600"})])),(0,a.Lk)("p",D,[(0,a.eW)((0,r.v_)(e.name)+" ",1),this.player&&this.player._id&&e&&e._id&&e._id===this.player._id?((0,a.uX)(),(0,a.CE)("span",I,[(0,a.bF)(ve,{icon:["far","play-circle"],class:"text-white h-3 w-3 mb-1 playing-icon"})])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",A,[e.progress&&this.enrollAccess?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"ml-2 flex flex-shrink-0",innerHTML:ke.getStatus(e.progress.status)},null,8,F)):(0,a.Q3)("",!0)])]),"folder"!=e.type?((0,a.uX)(),(0,a.CE)("div",T,[(0,a.Lk)("div",X,[(0,a.Lk)("p",M,[(0,a.bF)(ve,{icon:["far","clock"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),s[11]||(s[11]=(0,a.Lk)("span",{class:"text-gray-600 font-semibold mr-1.5"}," เวลาของเนื้อหา ",-1)),(0,a.eW)(" "+(0,r.v_)(e.duration),1)])]),(0,a.Lk)("div",Q,[(0,a.bF)(ve,{icon:["fas","calendar-alt"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),ke.enrollAccess?((0,a.uX)(),(0,a.CE)("p",W,(0,r.v_)(e.progress?"เรียนล่าสุดเมื่อ "+ke.formatThaidate(e.progress.updatedAt||e.progress.createdAt):"ยังไม่ได้เริ่มเรียน"),1)):((0,a.uX)(),(0,a.CE)("p",$,"เรียนได้ "+(0,r.v_)(xe.lesson.days)+" วัน",1))])])):(0,a.Q3)("",!0)])],10,v),e.subItems?((0,a.uX)(),(0,a.CE)("ul",S,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.subItems,(t=>((0,a.uX)(),(0,a.CE)("li",{key:t._id,class:""},[(0,a.Lk)("a",{href:ke.enrollAccess&&this.login&&t.canPlay?"/lesson/play/"+this.dataItem+"/"+t._id:"javascript:void(0);",class:(0,r.C4)([{"bg-gray-200":this.player&&this.player._id&&t&&t._id&&t._id===this.player._id,"opacity-60":!t.canPlay&&this.enrollAccess,relative:!0},"block hover:bg-gray-50 ml-5 border-gray-300 border border-b-0 border-l-2 border-dashed border-t-0 border-r-0"])},[!t.canPlay&&this.enrollAccess?((0,a.uX)(),(0,a.CE)("span",O,(0,r.v_)(t.canPlayMessage||"ยังเรียนบทก่อนหน้าไม่จบ"),1)):(0,a.Q3)("",!0),s[14]||(s[14]=(0,a.Lk)("div",{class:"w-6 h-7 border-gray-300 border border-b-2 border-l-0 border-dashed border-t-0 border-r-0 absolute"},null,-1)),(0,a.Lk)("div",U,[(0,a.Lk)("div",q,[(0,a.Lk)("div",null,[(0,a.Lk)("p",K,[(0,a.bF)(ve,{icon:["far","square"],class:"mr-1.5 h-5 w-5 flex-shrink-0 text-gray-300"}),(0,a.bF)(ve,{icon:["fas","video"],class:"mr-1.5 h-5 w-5 flex-shrink-0 text-green-600"}),(0,a.eW)(" "+(0,r.v_)(t.name)+" ",1),this.player&&this.player._id&&t&&t._id&&t._id===this.player._id?((0,a.uX)(),(0,a.CE)("span",H,[(0,a.bF)(ve,{icon:["far","play-circle"],class:"text-white h-3 w-3 mb-1 playing-icon"})])):(0,a.Q3)("",!0)]),(0,a.Lk)("p",Y,(0,r.v_)(t.description),1)]),(0,a.Lk)("div",z,[t.progress&&this.enrollAccess?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"ml-2 flex flex-shrink-0",innerHTML:ke.getStatus(t.progress.status)},null,8,B)):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",G,[(0,a.Lk)("div",N,[(0,a.Lk)("p",J,[(0,a.bF)(ve,{icon:["far","clock"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),s[12]||(s[12]=(0,a.Lk)("span",{class:"text-gray-600 font-semibold mr-1.5"}," เวลาเรียน ",-1)),(0,a.eW)(" "+(0,r.v_)(t.duration),1)]),t.progress&&this.enrollAccess?((0,a.uX)(),(0,a.CE)("p",R,[(0,a.bF)(ve,{icon:["far","clock"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),s[13]||(s[13]=(0,a.Lk)("span",{class:"text-gray-600 font-semibold mr-1.5"}," เรียนแล้ว ",-1)),(0,a.eW)(" "+(0,r.v_)(ke.formatSeconds(t.progress.progress)),1)])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",V,[(0,a.bF)(ve,{icon:["fas","calendar-alt"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),ke.enrollAccess?((0,a.uX)(),(0,a.CE)("p",Z,(0,r.v_)(e.progress?"เรียนล่าสุดเมื่อ "+ke.formatThaidate(e.progress.updatedAt||e.progress.createdAt):"ยังไม่ได้เริ่มเรียน"),1)):((0,a.uX)(),(0,a.CE)("p",ee,"เรียนได้ "+(0,r.v_)(xe.lesson.days)+" วัน",1))])])])],10,j)])))),128))])):(0,a.Q3)("",!0)])))),128)),this.lesson.standalone?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)(a.FK,{key:2},[ke.checkExam("post")&&ke.enrollAccess&&"complete"===ke.groupedPlayers.analytics.status?((0,a.uX)(),(0,a.CE)("li",se,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ke.getFilteredExams("post"),(e=>((0,a.uX)(),(0,a.CE)("div",{key:e._id},[(0,a.Lk)("a",{href:ke.isLinkClickable(e)?`/lesson/assessment/${this.dataItem}/${e._id}`:"javascript:void(0)",class:(0,r.C4)(["block hover:bg-gray-50",{"opacity-30":!ke.isLinkClickable(e),relative:!0}])},[(0,a.Lk)("div",ae,[(0,a.Lk)("div",re,[(0,a.Lk)("div",le,[(0,a.Lk)("span",ne,[(0,a.bF)(ve,{icon:["fas","file-alt"],class:"mr-1.5 h-5 w-5 flex-shrink-0 text-red-500"})]),(0,a.Lk)("p",ie,[(0,a.eW)((0,r.v_)(e.name)+" ",1),e.score?((0,a.uX)(),(0,a.CE)("span",oe,["now"===e.result?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.eW)((0,r.v_)(e.score.score>=e.measure?"ผ่านการรับรอง":"yes"===e.is_repeat?"ไม่ผ่านการรับรอง สามารถสอบซ่อมได้":"ไม่ผ่านการรับรอง"),1)],64)):(0,a.Q3)("",!0),"duedate"===e.result&&!0===ke.checkPostExamDue(e.result_duedate)?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.eW)(" รอประกาศผลวันที่ "+(0,r.v_)(ke.formatThaidate(e.result_duedate)),1)],64)):(0,a.Q3)("",!0),"duedate"===e.result&&!1===ke.checkPostExamDue(e.result_duedate)?((0,a.uX)(),(0,a.CE)(a.FK,{key:2},[(0,a.eW)((0,r.v_)(e.score.score>=e.measure?"ผ่านการรับรอง":"yes"===e.is_repeat?"ไม่ผ่านการรับรอง สามารถสอบซ่อมได้":"ไม่ผ่านการรับรอง"),1)],64)):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",ce,["now"===e.result?((0,a.uX)(),(0,a.CE)("span",de,(0,r.v_)(e.score?e.score.score+" คะแนน":"ยังไม่ได้สอบ"),1)):(0,a.Q3)("",!0),"duedate"===e.result&&!1===ke.checkPostExamDue(e.result_duedate)?((0,a.uX)(),(0,a.CE)("span",ue,(0,r.v_)(e.score?e.score.score+" คะแนน":"ยังไม่ได้สอบ"),1)):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",me,[(0,a.Lk)("div",pe,[(0,a.Lk)("p",ye,[(0,a.bF)(ve,{icon:["far","list-alt"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),s[15]||(s[15]=(0,a.Lk)("span",{class:"text-gray-600 font-semibold mr-1.5"}," จำนวนข้อสอบ ",-1)),(0,a.eW)(" "+(0,r.v_)(e.total)+" ข้อ ",1)]),(0,a.Lk)("p",ge,[(0,a.bF)(ve,{icon:["far","calendar"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),s[16]||(s[16]=(0,a.Lk)("span",{class:"text-gray-600 font-semibold mr-1.5"}," เปิดสอบ ",-1)),(0,a.eW)(" "+(0,r.v_)(ke.formatThaidate(e.show_duedate)),1)])]),(0,a.Lk)("div",he,[(0,a.bF)(ve,{icon:["far","clock"],class:"mr-1.5 h-3 w-3 flex-shrink-0 text-gray-400"}),(0,a.Lk)("p",null,(0,r.v_)(e.timer)+" นาที",1)])])])],10,te)])))),128))])):(0,a.Q3)("",!0)],64))])],64)}t(44114),t(98992),t(54520),t(72577),t(3949),t(81454),t(8872),t(37550);var xe=t(40475),ke=t(9964),be=t(57313);const ve={class:"loader-spinner"};function _e(e,s){return(0,a.uX)(),(0,a.CE)("div",ve)}var Le=t(64621);const Pe={},we=(0,Le.A)(Pe,[["render",_e],["__scopeId","data-v-6b83df5c"]]);var Ce=we,Ee=t(40471),De=t(63084);const Ie=new Ee.A(!1),Ae=[{name:"pending",label:"รอเรียน",styleClass:"bg-gray-300 text-gray-600",icon:"hourglass-start"},{name:"processing",label:"กำลังเรียน",styleClass:"bg-yellow-300 text-yellow-800",icon:"spinner"},{name:"complete",label:"เรียนจบแล้ว",styleClass:"bg-green-300 text-green-800",icon:"check"}];var Fe={name:"Lesson Playlist",components:{spinner:Ce},props:{courseData:Object,dataItem:String,playerItem:String,playOption:String,debug:Boolean},data(){return{receivedEvents:[],receivedProgressStatus:"",login:xe.A.get("session","login"),configs:xe.A.get("configs"),session:xe.A.get("session"),enroll:xe.A.get("session","enroll"),deviceType:be.A.deviceDetect(),exam:[],lesson:[],players:[],player:[],progress:[],progressArray:[],enrollData:[],param_id:"",param_ep:"",loading_sources:!1,dataFromChild:null,analytics:{counts:[]},resEnrollData:[]}},methods:{calculateAnalytics(){let e=0,s=0,t=0,a=0;function r(l){l.forEach((l=>{"folder"!==l.type&&(e++,l.progress&&(s++,"complete"===l.progress.status?t++:"processing"===l.progress.status&&a++)),l.subItems&&Array.isArray(l.subItems)&&r(l.subItems)}))}r(this.groupedPlayers.allItems);let l=e-s,n=e>0?t/e*100:0;this.analytics={counts:[{totalItems:e,itemsWithProgress:s,itemsComplete:t,itemsProgress:a,itemsPending:l,percentComplete:parseFloat(n.toFixed(2))}]},console.log(":: Calculator Data Of Analytics"),this.getEnrollData()},async getEnrollData(){try{const e=await Ie.POST("enroll/query",{method:"find",args:[{$and:[{courseID:this.courseData._id,userID:this.session.userID}]}]},this.configs.key,!0);if(200!==e.status)throw new Error("Failed to fetch enroll data from API");const s=e.data[0];this.resEnrollData=s,this.updateEnroll(this.analytics)}catch(e){console.error(e)}},async updateEnroll(e){try{let s={...this.resEnrollData.analytics};const t={percent:e.counts[0].percentComplete||0,total:e.counts[0].totalItems||0,pending:e.counts[0].itemsPending||0,processing:e.counts[0].itemsProgress||0,complete:e.counts[0].itemsComplete||0,status:e.counts[0].itemsComplete<e.counts[0].totalItems?"processing":"complete",message:e.counts[0].itemsComplete<e.counts[0].totalItems?"กำลังเรียน":"เรียนจบแล้ว"},a={...s,...t},r=await Ie.PUT(`enroll/${this.resEnrollData._id}`,{data:{analytics:a}},this.configs.key);200===r.status||console.error("Failed to update enrollment:",r)}catch(s){console.error("Error updating enrollment:",s)}},checkAnalytics(){if(this.groupedPlayers)return this.enrollData&&this.enrollData.analytics&&this.enrollData.analytics.status?this.enrollData.analytics.status:"No data"},checkDue(){const e=new Date(this.courseData.endDate),s=new Date;return s<e},checkPostExamDue(e){const s=420,t=new Date(e),a=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes()+s),r=new Date,l=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes()+s);return l<a},isLinkClickable(e){return!this.checkPostExamDue(e.show_duedate)&&(!e.score||void 0===e.score.score||""===e.score.score||!(e.score.score<e.measure&&"no"===e.is_repeat)&&!(e.score.score>=e.measure&&"yes"===e.is_repeat))},getStatus(e){const s=Ae.find((s=>s.name===e));return s?`<p class="inline-flex rounded-full px-2 text-xs font-semibold leading-5 capitalize ${s.styleClass}">\n          <i class="fa fa-${s.icon} mr-1 mt-1"></i>${s.label}\n          </p>`:""},checkExam(e){return this.exam.some((s=>s.type===e))},getFilteredExams(e){return this.exam&&this.exam.length?this.exam.filter((s=>s.type===e)):[]},formatSeconds(e){return ke.A.secondsToTime(e)},formatThaidate(e){return ke.A.toThaiDatetime(e)},detectDevice(){return be.A.deviceDetect()},async getData(e=!1){try{De.A.log("getData : Playlist"),e?console.log(":: Silence Call"):this.loading_sources=!0;const s=await Ie.GET(`course/${this.dataItem}`,this.configs.key,!0);if(200!==s.status)throw new Error("Failed to fetch course data from API");this.lesson=s.data;const t=await Ie.POST("player/query",{method:"find",hidden:["lecturer","updatedAt"],args:[{$and:[{courseId:this.lesson.master},{status:{$ne:!0}}]}]},this.configs.key,!0);if(200!==t.status)throw new Error("Failed to fetch player data from API");const a=t.data,r=await Ie.POST("enroll/query",{method:"find",args:[{$and:[{courseID:this.dataItem,userID:this.session.userID}]}]},this.configs.key,!0);if(200!==r.status)throw new Error("Failed to fetch enroll data from API");const l=r.data;this.enrollData=l[0];const n=await Ie.POST("exam/query",{method:"find",args:[{$and:[{courseId:this.lesson.master}]}]},this.configs.key);if(200===n.status){const e=n.data,s=await Promise.all(e.map((async e=>{const s=await Ie.POST("score/query",{method:"find",args:[{$and:[{userID:this.session.userID},{examID:e._id},{courseID:this.dataItem},{type:{$ne:"retest"}}]}]},this.configs.key,!0);if(200===s.status){const t=s.data;return{...e,score:t[t.length-1]}}return De.A.log(`Failed to fetch score data for exam: ${e._id}`),e})));this.exam=s}else De.A.log("Failed to fetch exam data from API");const{userID:i}=this.session,o=await Ie.POST("progress/query",{method:"find",args:[{$and:[{courseID:this.dataItem,userID:i}]}]},this.configs.key);if(200===o.status){const s=o.data;this.progressArray=s;const t=this.playerItem,r=a.find((e=>e._id===t));this.players=a,this.player=r,this.players=this.players.map((e=>{const s=this.progressArray.find((s=>s.playerID===e._id)),t=void 0!==e.not_visible&&e.not_visible;return s?{...e,progress:s,not_visible:t}:{...e,not_visible:t}})),this.loading_sources=!1,e?console.log(":: Silence Call"):this.loading_sources=!1}else De.A.log("Failed to fetch progress data from API")}catch(s){console.error(s)}}},async mounted(){try{await this.getData(),this.dataFromChild=this.groupedPlayers,this.$emit("data-fetched",this.groupedPlayers)}catch(e){De.A.log(Error)}},watch:{hasItems(e){e&&this.calculateAnalytics()}},computed:{enrollAccess(){if(!this.enroll||!Array.isArray(this.enroll))return!1;const e=this.dataItem,s=this.enroll.find((s=>s.courseID===e));return!!s},hasItems(){return this.groupedPlayers.allItems.length>0},groupedPlayers(){const e=this.enrollAccess,s=this.exam.some((e=>"pre"===e.type)),t=this.exam.find((e=>"pre"===e.type)),a=(()=>!s||null!==t.score&&void 0!==t.score)();De.A.log("score",a),De.A.log("playOption",this.playOption);const r=this.exam.some((e=>"post"===e.type)),l=this.exam.find((e=>"post"===e.type)),n=this.players.filter((e=>"folder"===e.type)),i=this.players.filter((e=>"folder"!==e.type)),o=e=>"string"===typeof e.order,c=e=>e.sort(((e,s)=>o(e)?o(s)?e.order.localeCompare(s.order):1:-1)),d=n.map((e=>({...e,subItems:c(i.filter((s=>s.root===e._id)))}))),u=c(i.filter((e=>!d.some((s=>s._id===e.root))))),m=c([...d,...u]),p=m.reduce(((e,s)=>("folder"!==s.type?e.push({...s,canPlay:!0}):s.subItems.forEach((s=>{"folder"!==s.type&&e.push({...s,canPlay:!1})})),e)),[]);if("full"===this.playOption&&a)for(let C=0;C<m.length;C++){m[C].canPlay=!0;const e=e=>{const s=(new Date).getTime();if(e.public_by_date){const t=e.start_date?new Date(e.start_date).getTime():null,a=e.stop_date?new Date(e.stop_date).getTime():null;t&&a?s<t?(e.canPlay=!1,e.canPlayMessage=`ยังไม่ถึงกำหนด (จะเปิดในวันที่ ${new Date(t).toLocaleDateString()})`):s>a?(e.canPlay=!1,e.canPlayMessage="เลยกำหนดเปิดเรียน"):(e.canPlay=!0,e.canPlayMessage="อยู่ระหว่างเปิดเรียน"):(e.canPlay=!1,e.canPlayMessage="ยังไม่กำหนดวันที่เปิดเรียน")}else if(e.not_visible){const t=this.session.userID,a=e.assignments?e.assignments.find((e=>e.userID===t)):null;if(a)if("none"===a.expire)e.canPlay=!0,e.canPlayMessage="";else{const t=new Date(a.expire).getTime();t<s?(e.canPlay=!1,e.canPlayMessage="ปิดการเข้าเรียนแล้ว รอเรียนสด ครั้งต่อไป"):(e.canPlay=!0,e.canPlayMessage="")}else e.canPlay=!1,e.canPlayMessage="ปิดการเข้าเรียนแล้ว รอเรียนสด ครั้งต่อไป"}else e.canPlay=!0};"folder"===m[C].type?m[C].subItems.forEach((s=>{e(s)})):e(m[C])}else{for(let e=0;e<p.length;e++)if(0===e)p[e].canPlay=!0;else{const s=p[e-1];s.progress&&"complete"===s.progress.status?p[e].canPlay=!0:this.enrollAccess&&(p[e].canPlay=!1)}for(let e=0;e<m.length;e++){const s=m[e];if("folder"!==s.type){const e=p.find((e=>e._id===s._id));e&&(s.canPlay=e.canPlay)}else s.subItems.forEach((e=>{const s=p.find((s=>s._id===e._id));s&&(e.canPlay=s.canPlay)}))}}s&&m.length>0&&(a||(De.A.slack("pre",s),De.A.slack("score",a),m[0].canPlay=!1,m[0].notice="ต้องทำแบบทดสอบก่อนเรียนก่อน"));const y={total:p.length,pending:0,processing:0,complete:0,status:""};p.forEach((e=>{e.progress&&"pending"===e.progress.status?y.pending++:e.progress&&"processing"===e.progress.status?y.processing++:e.progress&&"complete"===e.progress.status&&y.complete++})),y.complete===y.total?(y.status="complete",y.message="เรียนจบแล้ว"):(y.status="processing",y.message="กำลังเรียน"),y.pre={req:"no",has:s,measure:t?.measure||null,score:t?.score?.score||null,result:t?.score?.score>=t?.measure,message:null===t?.score?.score||void 0===t?.score?.score?"ยังไม่ได้สอบวัดผล":t?.score?.score>=t?.measure?"ผ่านการรับรอง":"ไม่ผ่านการรับรอง"},y.post={req:"yes"===this.lesson.certification&&"pass"===this.lesson.certification_type,has:r,measure:l?.measure||null,score:l?.score?.score||null,result:l?.score?.score>=l?.measure,message:null===l?.score?.score||void 0===l?.score?.score?"ยังไม่ได้สอบวัดผล":l?.score?.score>=l?.measure?"ผ่านการรับรอง":"ไม่ผ่านการรับรอง"};const g=this.lesson.certification,h=this.lesson.certification_type,f=l?.score?.score,x=l?.measure,k=this.lesson.survey;let b,v;switch(g){case"yes":"end"===h?y.complete!==y.total?(b="ยังเรียนไม่จบ",v=!1):(b="ผ่านการรับรอง",v=!0):"pass"===h&&(null===f||void 0===f?(b="ยังไม่ได้สอบ",v=!1):f>=x?(b="ผ่านการรับรอง",v=!0):(b="ไม่ผ่านการรับรอง",v=!1));break;case"no":b="ไม่มีใบประกาศ",v=!1;break;default:break}y.certification={status:v,type:h,survey:k,message:b};const _=y.complete/y.total*100;y.percent=parseFloat(_.toFixed(2)),y.percent<0&&(y.percent=0);const L=this.checkDue(),P=this.checkAnalytics(),w=m.map((s=>{const t=void 0!==s.not_visible&&s.not_visible;return!L&&"complete"===P&&this.courseData?.has_duedate?{...s,visible:t,canPlay:!1,canPlayMessage:"หลักสูตรนี้ปิดการเข้าเรียนแล้ว"}:e?{...s,visible:t}:{_id:s._id,courseId:s.courseId,name:s.name,slug:s.slug,description:s.description,duration:s.duration,type:s.type,demo:s.demo,cover:s.cover,order:s.order,createdAt:s.createdAt,subItems:s.subItems,canPlay:s.canPlay,visible:t}}));return{allItems:w,playlist:p,analytics:y}}}};const Te=(0,Le.A)(Fe,[["render",fe],["__scopeId","data-v-30ef315b"]]);var Xe=Te},57313:function(e,s){class t{isMobile(){return window.innerWidth<=768}deviceDetect(){return this.isMobile()?"mobile":"desktop"}}const a=new t;s.A=a}}]);
//# sourceMappingURL=3263.f500af8c.js.map