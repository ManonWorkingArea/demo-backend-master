"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[3349],{93349:function(e,t,s){s.r(t),s.d(t,{default:function(){return F}});var o=s(20641);function i(e,t,s,i,n,r){return(0,o.uX)(),(0,o.Wv)((0,o.$y)(r.componentName))}var n=s(52968),r=s(75220),a=s(40475),l=s(53751),d=s(90033);const c={class:"bg-gray-50"},u={class:"flex min-h-full flex-col justify-center py-12 sm:px-6 lg:px-8"},m={class:"sm:mx-auto sm:w-full sm:max-w-lg"},g=["src"],f={class:"mt-2 text-center text-sm text-gray-600"},p={class:"mt-8 sm:mx-auto sm:w-full sm:max-w-md"},h={class:"bg-white px-4 py-8 shadow sm:rounded-lg sm:px-10"},k={class:"mt-2"},y={class:"mt-2"},b={class:"flex items-center justify-between"},x={class:"text-sm"},w={key:0,class:"col-span-2"},v={class:"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5"},L={class:"w-full"};function S(e,t,s,i,n,r){const a=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",c,[(0,o.Lk)("div",u,[(0,o.Lk)("div",m,[this.showModal?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("img",{key:0,class:"mx-auto h-24 w-auto",src:this.config.siteLogo,alt:"Your Company"},null,8,g)),t[5]||(t[5]=(0,o.Lk)("h2",{class:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900"},"เข้าสู่บัญชี FTI Academy",-1)),(0,o.Lk)("p",f,[t[4]||(t[4]=(0,o.eW)(" หรือ ")),(0,o.bF)(a,{to:"/student/register",class:"font-medium text-indigo-600 hover:text-indigo-500"},{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.eW)(" ลงทะเบียนผู้อบรมใหม่ ")]))),_:1})])]),(0,o.Lk)("div",p,[(0,o.Lk)("div",h,[(0,o.Lk)("form",{class:"space-y-6",onSubmit:t[2]||(t[2]=(0,l.D$)(((...e)=>r.login&&r.login(...e)),["prevent"]))},[(0,o.Lk)("div",null,[t[6]||(t[6]=(0,o.Lk)("label",{for:"email",class:"block text-md font-semibold leading-6 text-gray-900"},"อีเมล์",-1)),(0,o.Lk)("div",k,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),id:"email",name:"email",type:"email",autocomplete:"email",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[l.Jo,n.email]])])]),(0,o.Lk)("div",null,[t[7]||(t[7]=(0,o.Lk)("label",{for:"password",class:"block text-md font-semibold leading-6 text-gray-900"},"รหัสผ่าน",-1)),(0,o.Lk)("div",y,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),id:"password",name:"password",type:"password",autocomplete:"current-password",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[l.Jo,n.password]])])]),(0,o.Lk)("div",b,[t[9]||(t[9]=(0,o.Lk)("div",{class:"flex items-center"},[(0,o.Lk)("input",{id:"remember-me",name:"remember-me",type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,o.Lk)("label",{for:"remember-me",class:"ml-2 block text-sm text-gray-900"},"จำฉันไว้")],-1)),(0,o.Lk)("div",x,[(0,o.bF)(a,{to:"/student/forgot",class:"font-medium text-indigo-600 hover:text-indigo-500"},{default:(0,o.k6)((()=>t[8]||(t[8]=[(0,o.eW)(" ลืมรหัสผ่าน ")]))),_:1})])]),(0,o.Lk)("div",null,[this.errorStage?((0,o.uX)(),(0,o.CE)("div",w,[(0,o.Lk)("div",v,[t[10]||(t[10]=(0,o.Lk)("div",{class:"font-semibold pt-3 pb-3"},"เกิดข้อผิดพลาด",-1)),(0,o.Lk)("div",L,(0,d.v_)(this.errorMessage),1)])])):(0,o.Q3)("",!0),t[11]||(t[11]=(0,o.Lk)("button",{type:"submit",class:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},"เข้าสู่ระบบ",-1))])],32)])])])])}var C=s(21396),_=s.n(C),M={name:"Login",components:{},props:{showModal:{type:Boolean,default:!1}},data(){return{config:a.A.get("configs"),email:"",password:"",errorStage:!1,errorMessage:""}},methods:{async login(){try{this.activeBlock=!0;const e=await fetch("https://gateway.cloudrestfulapi.com/api/user/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{username:this.email}]}]})}),t=await e.json(),s=t.length>0?t[0]:null;if(console.log("loginData",s),0===s.length)return this.errorStage=!0,this.errorMessage="ไม่พบข้อมูลบัญชีผู้ใช้นี้",void(this.activeBlock=!1);{const e=s.salt,t=_().SHA256(this.password+e).toString(),o=s.password;if(console.log(t,o),t===o)if("user"!=s.role)this.errorStage=!0,this.errorMessage="ไม่มีสิทธิ์เข้าใช้งานเว็บไซต์นี้";else{const e=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",hidden:["userID"],args:[{$and:[{userID:s._id}]}]})}),t=await e.json();if(200===e.status){let e=[],o="";const i={active:!0,token:s._id,refresh:"",login:!0,userID:s._id,user:s,loader:!1,role:s.role,nav:"normal-nav",layout:"frontend-layout",current:o,list:e,enroll:t};a.A.update("session",i),console.log("session",i),this.showModal?window.location.reload():this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:500,icon:"success",title:"แจ้งเตือน",text:"เข้าสู่ระบบเรียบร้อยแล้ว"}).then((()=>{s.req_reset?window.location.href="/student/reset":window.location.href="/student/profile"}))}}else this.errorStage=!0,this.errorMessage="ชื่อผู้ใช้งานหรือรหัสผ่านไม่ถูกต้อง"}this.activeBlock=!1}catch(e){console.log(e)}}}},j=s(64621);const A=(0,j.A)(M,[["render",S]]);var q=A,D={name:"Lesson Detail",components:{Frontend:q},data(){return{session:a.A.get("session")}},setup(){const e=(0,r.lq)(),t=e.meta.title;(0,n.K7)(t)},computed:{componentName(){return"Frontend"}}};const B=(0,j.A)(D,[["render",i]]);var F=B}}]);
//# sourceMappingURL=3349.8a04fd48.js.map