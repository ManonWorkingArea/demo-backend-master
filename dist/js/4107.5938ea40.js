"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[4107],{84107:function(t,e,r){r.r(e),r.d(e,{default:function(){return N}});var s=r(20641);function a(t,e,r,a,o,n){return(0,s.uX)(),(0,s.Wv)((0,s.$y)(n.componentName))}var o=r(52968),n=r(75220),d=r(40475),u=r(90033);const c={class:"tabs"},l=["onClick"],i={key:0},h=["onClick"],S={key:1};function k(t,e,r,a,o,n){return(0,s.uX)(),(0,s.CE)("div",null,[e[4]||(e[4]=(0,s.Lk)("h1",null,"Orders",-1)),(0,s.Lk)("div",c,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.orderStatuses,(t=>((0,s.uX)(),(0,s.CE)("button",{key:t.code,class:(0,u.C4)({active:o.selectedStatus===t.code}),onClick:e=>n.selectStatus(t.code)},(0,u.v_)(t.name),11,l)))),128))]),o.orders.length?((0,s.uX)(),(0,s.CE)("div",i,[(0,s.Lk)("h2",null,(0,u.v_)(n.getStatusName(o.selectedStatus))+" Orders",1),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.orders,(t=>((0,s.uX)(),(0,s.CE)("li",{key:t._id},[(0,s.Lk)("span",null,"Order ID: #"+(0,u.v_)(t.code),1),e[0]||(e[0]=(0,s.Lk)("br",null,null,-1)),(0,s.Lk)("span",null,"Total: $"+(0,u.v_)(t.total),1),e[1]||(e[1]=(0,s.Lk)("br",null,null,-1)),(0,s.Lk)("span",null,"Status: "+(0,u.v_)(n.getStatusName(t.status)),1),e[2]||(e[2]=(0,s.Lk)("br",null,null,-1)),(0,s.Lk)("button",{onClick:e=>n.changeOrderStatus(t)},"Next Status",8,h)])))),128))])])):((0,s.uX)(),(0,s.CE)("div",S,e[3]||(e[3]=[(0,s.Lk)("p",null,"No orders found for this status.",-1)])))])}r(98992),r(72577);var f=r(40471);const y=new f.A(!1),g=d.A.get("configs"),p=d.A.get("session"),w=async()=>{try{const t=await y.POST("shop_order_status/query",{method:"find",args:[{unit:p.current._id}]},g.key);if(200===t.status){const e=t.data;return e.sort(((t,e)=>t.order-e.order)),e}throw new Error("Failed to fetch order statuses")}catch(t){throw console.error("Error fetching order statuses:",t),t}},v=async t=>{try{const e=await y.POST("shop_orders/query",{method:"find",args:[{unit:p.current._id,status:t}]},g.key);if(200===e.status)return e.data;throw new Error("Failed to fetch orders")}catch(e){throw console.error("Error fetching orders:",e),e}},_=async(t,e)=>{try{const r=await y.PUT(`shop_orders/${t}`,{data:{status:e}},g.key);if(200===r.status)return r.data;throw new Error("Failed to update order status")}catch(r){throw console.error("Error updating order status:",r),r}};var m={data(){return{orderStatuses:[],orders:[],selectedStatus:""}},async created(){await this.loadOrderStatuses(),this.orderStatuses.length&&(this.selectedStatus=this.orderStatuses[0].code,await this.loadOrdersByStatus())},methods:{async loadOrderStatuses(){try{this.orderStatuses=await w()}catch(t){console.error("Error loading order statuses:",t)}},async loadOrdersByStatus(){try{this.orders=await v(this.selectedStatus)}catch(t){console.error("Error loading orders:",t)}},selectStatus(t){this.selectedStatus=t,this.loadOrdersByStatus()},getStatusName(t){const e=this.orderStatuses.find((e=>e.code===t));return e?e.name:t},getNextStatus(t){const e=this.orderStatuses.findIndex((e=>e.code===t));return e>=0&&e<this.orderStatuses.length-1?this.orderStatuses[e+1].code:null},async changeOrderStatus(t){const e=this.getNextStatus(t.status);if(e)try{await _(t._id,e),this.loadOrdersByStatus()}catch(r){console.error("Error updating order status:",r)}else alert("This order is already at the final status.")}}},E=r(64621);const C=(0,E.A)(m,[["render",k],["__scopeId","data-v-88174a94"]]);var O=C,L={name:"Order List",components:{Backend:O,Frontend:O},data(){return{session:d.A.get("session")}},setup(){const t=(0,n.lq)(),e=t.meta.title;(0,o.K7)(e)},computed:{componentName(){return"backend"===this.session.interface?"Backend":"frontend"===this.session.interface?"Frontend":(console.error("Invalid interface:",this.session.interface),null)}}};const b=(0,E.A)(L,[["render",a]]);var N=b}}]);
//# sourceMappingURL=4107.5938ea40.js.map