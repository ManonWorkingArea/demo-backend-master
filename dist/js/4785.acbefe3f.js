"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[4785],{74528:function(e,t,r){r.r(t),r.d(t,{default:function(){return v}});var a=r(20641);function s(e,t,r,s,o,i){return(0,a.uX)(),(0,a.Wv)((0,a.$y)(i.componentName))}var o=r(52968),i=r(75220),n=r(40475),u=r(53751);const c={class:"bg-gray-100"},l={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-75 flex justify-center items-center z-[9999]"},d={class:"bg-white p-8 rounded-lg w-full md:w-1/4 min-w-min md:min-w-0",style:{"min-width":"200px"}},h={class:"text-center"},p={key:0,class:"text-red-500 mb-4"},m={key:1,class:"mx-auto max-w-2xl px-4 pb-12 pt-8 sm:px-6 sm:pb-12 sm:pt-6 lg:grid lg:max-w-7xl lg:gap-x-8 lg:px-8"},$={class:"lg:flex lg:items-center lg:justify-between"};function y(e,t,r,s,o,i){const n=(0,a.g2)("EnrollDashboard");return(0,a.uX)(),(0,a.CE)("div",c,[o.isAuthenticated?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",l,[(0,a.Lk)("div",d,[t[2]||(t[2]=(0,a.Lk)("div",{class:"flex justify-center mb-4"},[(0,a.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),t[3]||(t[3]=(0,a.Lk)("div",{class:"text-center mb-4 text-lg font-medium text-gray-800"},[(0,a.eW)(" หน้านี้มีการจำกัดการเข้าถึง "),(0,a.Lk)("br"),(0,a.eW)("โปรดกรอกรหัสผ่านเพื่อดำเนินการต่อไป ")],-1)),(0,a.Lk)("div",h,[o.authError?((0,a.uX)(),(0,a.CE)("div",p,"รหัสผ่านไม่ถูกต้อง")):(0,a.Q3)("",!0),(0,a.bo)((0,a.Lk)("input",{type:"password","onUpdate:modelValue":t[0]||(t[0]=e=>o.inputPassword=e),placeholder:"กรอกรหัสผ่าน",class:"border p-2 rounded w-full"},null,512),[[u.Jo,o.inputPassword]]),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>i.checkPassword&&i.checkPassword(...e)),class:"bg-blue-500 text-white p-2 rounded mt-4 w-full"},"ดูข้อมูล")])])])),o.isAuthenticated?((0,a.uX)(),(0,a.CE)("div",m,[(0,a.Lk)("div",$,[(0,a.bF)(n,{pageTitle:o.courseData.name,courseData:o.courseData,isPublic:!0},null,8,["pageTitle","courseData"])])])):(0,a.Q3)("",!0)])}r(44114),r(17642),r(58004),r(33853),r(45876),r(32475),r(15024),r(31698),r(98992),r(3949);var g=r(50953),f=r(34982),x=r(40471);const D=new x.A(!1);var k={data(){const e=n.A.get("session");return{dataItem:this.$route.params.id,accessToken:e.token,login:e.login,configs:n.A.get("configs"),session:e,courseData:[],isAuthenticated:!1,inputPassword:"",authError:!1}},components:{EnrollDashboard:f.A},methods:{checkPassword(){"767241"===this.inputPassword?(this.isAuthenticated=!0,this.authError=!1,sessionStorage.setItem("isAuthenticated","true")):this.authError=!0},processingData(e){const t={players:[],categories:[],document:[],exam:[],course:null},r=new Set,a=new Set,s=new Set,o=new Set,i=[],n=[],u=[];return e.forEach((e=>{Array.isArray(e.player)?e.player.forEach((e=>{o.has(e._id)||(t.players.push(e),o.add(e._id))})):e.player&&!o.has(e.player._id)&&(t.players.push(e.player),o.add(e.player._id)),Array.isArray(e.category)?e.category.forEach((e=>{r.has(e._id)||(t.categories.push(e),r.add(e._id))})):e.category&&!r.has(e.category._id)&&(t.categories.push(e.category),r.add(e.category._id)),Array.isArray(e.document)?e.document.forEach((e=>{a.has(e._id)||(t.document.push(e),a.add(e._id))})):e.document&&!a.has(e.document._id)&&(t.document.push(e.document),a.add(e.document._id)),Array.isArray(e.exam)?e.exam.forEach((e=>{s.has(e._id)||(t.exam.push(e),s.add(e._id))})):e.exam&&!s.has(e.exam._id)&&(t.exam.push(e.exam),s.add(e.exam._id)),t.course||(t.course=e.course)})),t.players.forEach((e=>{"folder"!==e.type&&"sub"===e.mode&&n.push(e)})),t.players.forEach((e=>{"sub"!=e.mode&&(0,g.KR)(i.push(e))})),i.forEach((e=>{let t=e._id;u[t]=[],n.forEach((r=>{r.root===e._id&&u[t].push(r)}))})),{formattedData:t,playerParentItems:i,playerParentChild:n,playerParentFolder:u}},async getQueryData(){try{let e=null;const t=[{$match:{$expr:{$eq:["$_id",{$toObjectId:this.dataItem}]}}},{$lookup:{from:"player",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT.master","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseId"]}}}],as:"players"}},{$addFields:{playersCount:{$size:"$players"}}},{$lookup:{from:"exam",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT.master","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseId"]}}}],as:"exams"}},{$addFields:{examsCount:{$size:"$exams"}}},{$lookup:{from:"document",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT.master","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseId"]}}}],as:"documents"}},{$addFields:{documentsCount:{$size:"$documents"}}},{$lookup:{from:"enroll",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT._id","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseID"]}}},{$group:{_id:null,count:{$sum:1}}},{$project:{_id:0,count:1}}],as:"enrollsCountArray"}},{$addFields:{enrollsCount:{$ifNull:[{$arrayElemAt:["$enrollsCountArray.count",0]},0]}}},{$lookup:{from:"form",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT._id","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseID"]}}},{$group:{_id:null,count:{$sum:1}}},{$project:{_id:0,count:1}}],as:"formsCountArray"}},{$addFields:{formsCount:{$ifNull:[{$arrayElemAt:["$formsCountArray.count",0]},0]}}},{$lookup:{from:"category",let:{categoryCodes:{$ifNull:["$$ROOT.category",[]]}},pipeline:[{$match:{$expr:{$in:["$code","$$categoryCodes"]}}}],as:"categories"}},{$group:{_id:"$_id",material:{$first:"$playersCount"},document:{$first:"$documentsCount"},contest:{$first:"$examsCount"},enroll:{$first:"$enrollsCount"},form:{$first:"$formsCount"},course:{$first:"$$ROOT"},category:{$first:"$categories"},exam:{$first:"$exams"}}}],r={pipeline:t},a=await D.POST("course/aggregate",r,this.configs.key);if(200===a.status&&(e=a.data,e&&e.length>0)){const t=this.processingData(e);this.masterDataRecord=t,this.courseApiData=e,this.playerData=t.formattedData.players??null,this.courseData=t.formattedData.course??null,this.courseData.categories=t.formattedData.categories??null,this.examData=t.formattedData.exam??null,this.documentData=t.formattedData.document??null,this.playerParent=t.playerParentItems,this.playerChild=t.playerParentChild,this.playerFolder=t.playerParentFolder,this.masterDataRecord&&(this.playerData.sort((function(e,t){return e.order<t.order?-1:1})),this.playerParent.sort((function(e,t){return e.order<t.order?-1:1})),this.playerChild.sort((function(e,t){return e.order<t.order?-1:1}))),this.playerCount=this.playerData.length,this.playerParentCount=this.playerParent.length,this.playerChildCount=this.playerChild.length,this.courseCategory=this.courseData.categories,this.principles=this.courseData.principles,this.objective=this.courseData.objective,this.target=this.courseData.target,this.structure=this.courseData.structure,this.description=this.courseData.description,this.cover=this.courseData.cover,this.mode=this.courseData.mode,this.display=this.courseData.display,this.type=this.courseData.type,this.ref=this.courseData.master,this.playerRef=this.courseData.playerRef??this.courseData.master,this.examRef=this.courseData.examRef??this.courseData.master,this.status=this.courseData.status??!0,this.visibility=this.courseData.visibility??!0,this.examCount=this.examData.length??0,this.documentCount=this.documentData.length??0,this.$setPageTitle("รายละเอียด / "+this.courseData.name)}}catch(e){}}},async mounted(){try{this.isAuthenticated="true"===sessionStorage.getItem("isAuthenticated"),await this.getQueryData()}catch(e){console.error(Error)}}},w=r(64621);const C=(0,w.A)(k,[["render",y]]);var _=C,b={name:"Lesson Public",components:{Frontend:_},data(){return{session:n.A.get("session")}},setup(){const e=(0,i.lq)(),t=e.meta.title;(0,o.K7)(t)},computed:{componentName(){return"Frontend"}}};const A=(0,w.A)(b,[["render",s]]);var v=A}}]);
//# sourceMappingURL=4785.acbefe3f.js.map