"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[5153],{65153:function(e,t,s){s.r(t),s.d(t,{default:function(){return te}});var o=s(20641),i=s(90033),a=s(53751);const n={class:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 flex"},r={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 backdrop-blur-sm"},l={class:"bg-white rounded-2xl p-8 max-w-sm mx-4 text-center shadow-2xl transform transition-all duration-300 scale-100"},d={class:"text-gray-700 font-medium animate-pulse"},c={class:"flex-1 flex flex-col justify-center py-12 px-4 sm:px-6 lg:px-20 xl:px-24 relative"},u={class:"mx-auto w-full max-w-md lg:w-96 relative z-10"},g={class:"relative group"},h=["src","alt"],p={class:"mt-6 text-4xl font-bold bg-gradient-to-r from-indigo-600 to-cyan-600 bg-clip-text text-transparent"},f={class:"bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 p-8 hover:shadow-3xl transition-all duration-300"},m={class:"transform transition-all duration-300 hover:translate-y-[-2px]"},k={for:"email",class:"block text-sm font-semibold text-gray-700 mb-2"},v={class:"relative group"},w=["placeholder"],y={class:"transform transition-all duration-300 hover:translate-y-[-2px]"},b={for:"password",class:"block text-sm font-semibold text-gray-700 mb-2"},x={class:"relative group"},L=["placeholder","type"],A={key:0,class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},T={key:1,class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},C={class:"flex items-center justify-between"},B={class:"flex items-center group"},_={for:"remember-me",class:"ml-3 block text-sm text-gray-700 group-hover:text-gray-900 transition-colors cursor-pointer"},j={class:"text-sm"},S={href:"forgot",class:"font-medium text-indigo-600 hover:text-indigo-800 transition-colors duration-200 relative group"},E={key:0,class:"bg-red-50 border-l-4 border-red-400 p-4 rounded-lg"},I={class:"flex"},z={class:"ml-3"},F={class:"text-sm text-red-700"},M=["disabled"],D={key:0,class:"absolute left-0 inset-y-0 flex items-center pl-3"},$={key:1,class:"absolute right-4 inset-y-0 flex items-center"},X={class:"text-sm text-gray-500"},O={class:"hidden lg:block relative w-0 flex-1"},q=["src"];function N(e,t,s,N,H,P){return(0,o.uX)(),(0,o.CE)("div",n,[H.activeBlock?((0,o.uX)(),(0,o.CE)("div",r,[(0,o.Lk)("div",l,[t[6]||(t[6]=(0,o.Lk)("div",{class:"relative"},[(0,o.Lk)("div",{class:"w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,o.Lk)("div",{class:"absolute inset-0 w-16 h-16 border-4 border-cyan-400 border-t-transparent rounded-full animate-spin mx-auto opacity-30 animate-pulse"})],-1)),(0,o.Lk)("p",d,(0,i.v_)(H.processing_text),1)])])):(0,o.Q3)("",!0),(0,o.Lk)("div",c,[t[18]||(t[18]=(0,o.Fv)('<div class="absolute inset-0 opacity-5" data-v-f1a622f6><div class="absolute inset-0 bg-gradient-to-r from-indigo-100 to-cyan-100" data-v-f1a622f6></div><svg class="absolute inset-0 w-full h-full" xmlns="http://www.w3.org/2000/svg" data-v-f1a622f6><defs data-v-f1a622f6><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse" data-v-f1a622f6><path d="m 40 0 l 0 40 m -40 0 l 40 0" fill="none" stroke="currentColor" stroke-width="1" data-v-f1a622f6></path></pattern></defs><rect width="100%" height="100%" fill="url(#grid)" data-v-f1a622f6></rect></svg></div>',1)),(0,o.Lk)("div",u,[(0,o.Lk)("div",{class:(0,i.C4)(["text-center",H.showForm?"animate-fade-in-up":"opacity-0"])},[(0,o.Lk)("div",g,[H.isLoaded?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"mx-auto h-28 w-auto transform transition-all duration-500 hover:scale-105 drop-shadow-lg",src:H.loginLogo,alt:H.siteName},null,8,h)):(0,o.Q3)("",!0),t[7]||(t[7]=(0,o.Lk)("div",{class:"absolute inset-0 bg-gradient-to-r from-indigo-400 to-cyan-400 rounded-full blur-xl opacity-20 group-hover:opacity-30 transition-opacity duration-300"},null,-1))]),(0,o.Lk)("h1",p,(0,i.v_)(H.siteName),1),t[8]||(t[8]=(0,o.Lk)("p",{class:"mt-2 text-gray-600 font-medium"},"ยินดีต้อนรับเข้าสู่ระบบ",-1))],2),(0,o.Lk)("div",{class:(0,i.C4)(["mt-10",H.showForm?"animate-fade-in-up animation-delay-200":"opacity-0"])},[(0,o.Lk)("div",f,[(0,o.Lk)("form",{class:"space-y-6",onSubmit:t[5]||(t[5]=(0,a.D$)(((...e)=>P.login&&P.login(...e)),["prevent"]))},[(0,o.Lk)("div",m,[(0,o.Lk)("label",k,(0,i.v_)(P.translate("login-user")),1),(0,o.Lk)("div",v,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>H.email=e),onFocus:t[1]||(t[1]=(...e)=>P.clearErrors&&P.clearErrors(...e)),id:"email",name:"email",type:"text",autocomplete:"email",placeholder:P.translate("login-user"),required:"",class:"block w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl bg-gray-50/50 placeholder-gray-400 transition-all duration-300 focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/20 focus:outline-none hover:border-gray-300"},null,40,w),[[a.Jo,H.email]]),t[9]||(t[9]=(0,o.Lk)("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none opacity-40 group-focus-within:opacity-60 transition-opacity"},[(0,o.Lk)("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1))])]),(0,o.Lk)("div",y,[(0,o.Lk)("label",b,(0,i.v_)(P.translate("login-password")),1),(0,o.Lk)("div",x,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>H.password=e),onFocus:t[3]||(t[3]=(...e)=>P.clearErrors&&P.clearErrors(...e)),id:"password",name:"password",placeholder:P.translate("login-password"),type:H.passwordFieldType,autocomplete:"off",required:"",class:"block w-full pl-12 pr-16 py-4 border-2 border-gray-200 rounded-xl bg-gray-50/50 placeholder-gray-400 transition-all duration-300 focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/20 focus:outline-none hover:border-gray-300"},null,40,L),[[a.hp,H.password]]),t[12]||(t[12]=(0,o.Lk)("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none opacity-40 group-focus-within:opacity-60 transition-opacity"},[(0,o.Lk)("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})])],-1)),(0,o.Lk)("button",{type:"button",onClick:t[4]||(t[4]=(...e)=>P.switchVisibility&&P.switchVisibility(...e)),ref:"btnToggle",class:"absolute inset-y-0 right-0 pr-4 flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors duration-200 focus:outline-none"},["password"===H.passwordFieldType?((0,o.uX)(),(0,o.CE)("svg",A,t[10]||(t[10]=[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)]))):((0,o.uX)(),(0,o.CE)("svg",T,t[11]||(t[11]=[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"},null,-1)])))],512)])]),(0,o.Lk)("div",C,[(0,o.Lk)("div",B,[t[13]||(t[13]=(0,o.Lk)("input",{id:"remember-me",name:"remember-me",type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 transition-colors duration-200"},null,-1)),(0,o.Lk)("label",_,(0,i.v_)(P.translate("login-remember")),1)]),(0,o.Lk)("div",j,[(0,o.Lk)("a",S,[(0,o.eW)((0,i.v_)(P.translate("login-forgot"))+"? ",1),t[14]||(t[14]=(0,o.Lk)("span",{class:"absolute bottom-0 left-0 w-0 h-0.5 bg-indigo-600 group-hover:w-full transition-all duration-300"},null,-1))])])]),(0,o.bF)(a.eB,{name:"error",mode:"out-in"},{default:(0,o.k6)((()=>[H.errors.length?((0,o.uX)(),(0,o.CE)("div",E,[(0,o.Lk)("div",I,[t[15]||(t[15]=(0,o.Lk)("div",{class:"flex-shrink-0"},[(0,o.Lk)("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[(0,o.Lk)("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),(0,o.Lk)("div",z,[(0,o.Lk)("ul",F,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(H.errors,(e=>((0,o.uX)(),(0,o.CE)("li",{key:e,class:"mb-1"},(0,i.v_)(e),1)))),128))])])])])):(0,o.Q3)("",!0)])),_:1}),(0,o.Lk)("div",null,[(0,o.Lk)("button",{type:"submit",disabled:H.isLoading,class:"group relative w-full flex justify-center py-4 px-4 border border-transparent text-sm font-bold rounded-xl text-white bg-gradient-to-r from-indigo-600 to-cyan-600 hover:from-indigo-700 hover:to-cyan-700 focus:outline-none focus:ring-4 focus:ring-indigo-500/50 disabled:opacity-50 disabled:cursor-not-allowed transform transition-all duration-300 hover:scale-[1.02] hover:shadow-xl active:scale-[0.98]"},[H.isLoading?((0,o.uX)(),(0,o.CE)("span",D,t[16]||(t[16]=[(0,o.Lk)("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)]))):(0,o.Q3)("",!0),(0,o.Lk)("span",{class:(0,i.C4)({"ml-8":H.isLoading})},(0,i.v_)(H.isLoading?"กำลังเข้าสู่ระบบ...":P.translate("login-btn")),3),H.isLoading?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",$,t[17]||(t[17]=[(0,o.Lk)("svg",{class:"w-5 h-5 transform group-hover:translate-x-1 transition-transform duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1)])))],8,M)])],32)])],2),(0,o.Lk)("div",{class:(0,i.C4)(["mt-8 text-center",H.showForm?"animate-fade-in-up animation-delay-400":"opacity-0"])},[(0,o.Lk)("p",X," © 2024 "+(0,i.v_)(H.siteName)+". ระบบปลอดภัยด้วยเทคโนโลยีการเข้ารหัสขั้นสูง ",1)],2)])]),(0,o.Lk)("div",O,[t[19]||(t[19]=(0,o.Lk)("div",{class:"absolute inset-0 bg-gradient-to-br from-indigo-900/20 to-cyan-900/20"},null,-1)),H.isLoaded?((0,o.uX)(),(0,o.CE)("img",{key:0,class:"absolute inset-0 h-full w-full object-cover",src:H.loginBg,alt:""},null,8,q)):(0,o.Q3)("",!0),t[20]||(t[20]=(0,o.Lk)("div",{class:"absolute inset-0 bg-gradient-to-br from-indigo-600/30 via-transparent to-cyan-600/30"},null,-1)),t[21]||(t[21]=(0,o.Lk)("div",{class:"absolute inset-0 bg-black/20"},null,-1)),t[22]||(t[22]=(0,o.Lk)("div",{class:"absolute top-1/4 left-1/4 w-32 h-32 bg-white/10 rounded-full blur-xl animate-float"},null,-1)),t[23]||(t[23]=(0,o.Lk)("div",{class:"absolute top-3/4 right-1/4 w-24 h-24 bg-cyan-400/20 rounded-full blur-xl animate-float-delayed"},null,-1))])])}s(44114);var H=s(93426),P=s(52968),Q=s(75220),V=s(94486),K=s(40475),U=s(21396),G=s.n(U),J=s(40471),W=s(63084);const R=new J.A;var Z={name:"Login",created(){W.A.option(this.$route)},data(){return{hostkey:this.$Key,logo:s(64760),email:"",password:"",processing_text:(0,H.Tl)("database-connect"),showPassword:!1,returnSecureToken:!0,passwordFieldType:"password",activeBlock:!1,isLoaded:!1,siteName:"",loginLogo:"",loginBg:"",configs:K.A.get("configs"),errors:[],isLoading:!1,showForm:!1}},components:{},methods:{translate:H.Tl,async login(){try{if(this.isLoading=!0,"origin"===this.configs.siteType){console.log("origin"),this.errors=[],this.activeBlock=!0;const e={method:"find",args:[{$and:[{role:"root"},{username:this.email}]}]},t=await R.POST("user/query",e,this.configs.key),s=t.data,o=s.length>0?s[0]:null;if(null===o)return this.errors.push("ไม่พบข้อมูลผู้ใช้งาน/รหัสผ่าน"),this.activeBlock=!1,void(this.isLoading=!1);{const e=o.salt,t=G().SHA256(this.password+e).toString(),s=o.password;if(console.log(t,s),t===s){W.A.log("Login successful");const e={active:!0,token:o._id,refresh:"",login:!0,userID:o._id,user:o,loader:!1,role:o.role,nav:"superadmin-nav",layout:"backend-layout",current:this.configs};K.A.update("session",e),setTimeout((()=>{window.location.href="/"}),1e3)}else this.errors.push("ข้อมูลผู้ใช้งาน/รหัสผ่านไม่ถูกต้อง")}this.activeBlock=!1,this.isLoading=!1}else if("collection"===this.configs.siteType){console.log("collection"),this.activeBlock=!0;const e={method:"find",args:[{$and:[{role:"superadmin"},{username:this.email}]}]},t=await R.POST("user/query",e,this.configs.key),s=t.data,o=s.length>0?s[0]:null;if(null===o)return W.A.log("Invalid username or password"),this.errors.push("Invalid username or password"),this.activeBlock=!1,void(this.isLoading=!1);{const e=o.salt,t=G().SHA256(this.password+e).toString(),s=o.password;if(console.log(t,s),t===s){console.log("Login successful");const e={active:!0,token:o._id,refresh:"",login:!0,userID:o._id,user:o,loader:!1,role:o.role,nav:"admin-nav",layout:"backend-layout",current:this.configs};K.A.update("session",e),setTimeout((()=>{window.location.href="/"}),1e3)}else W.A.log("Invalid username or password"),this.errors.push("Invalid username or password")}this.activeBlock=!1,this.isLoading=!1}else if("asset"===this.configs.siteType){console.log("asset"),this.activeBlock=!0;const e={method:"find",args:[{$and:[{username:this.email}]}]},t=await R.POST("user/query",e,this.configs.key),s=t.data,o=s.length>0?s[0]:null;if(console.log("loginData",o),null===o)return W.A.log("Invalid username or password A"),this.errors.push("Invalid username or password A"),this.activeBlock=!1,void(this.isLoading=!1);{const e=o.salt,t=G().SHA256(this.password+e).toString(),s=o.password;if(console.log("inputHash",t),console.log("storedHash",s),t===s){let e=[],t="";if("superadmin"===o.role){W.A.log("Asset",o.asset);const e=o.asset.includes(this.configs.siteID);W.A.log("canAccess",e),t=this.configs}else if("admin"===o.role||"manager"===o.role){W.A.log("Unit",o.unit);const s=o.parent===this.configs.siteID;W.A.log("canAccess",s),W.A.log("ids",o.unit);const i=await fetch("https://gateway.cloudrestfulapi.com/api/hostname/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.hostkey},body:JSON.stringify({method:"find",args:[{_id:{$in:o.unit}}]})}),a=await i.json();e=a,t="none",W.A.log("List Return",a)}const s={active:!0,token:o._id,refresh:"",login:!0,userID:o._id,user:o,loader:!1,role:o.role,nav:"admin-nav",layout:"backend-layout",current:t,list:e};K.A.update("session",s),W.A.log("session",s),this.$router.push("/"),setTimeout((()=>{window.location.href="/"}),1e3)}else W.A.log("Invalid username or password"),this.errors.push("Invalid username or password")}this.activeBlock=!1,this.isLoading=!1}else{this.activeBlock=!0;const e=await fetch("https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyDODKwE1BfZOj9ieB6pisJm-p2MmudWLSw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.email,password:this.password,returnSecureToken:this.returnSecureToken})}),t=await e.json(),s=e.status;if(this.processing_text="เข้าสู่ระบบสำเร็จ.....","200"==s){const e={active:t.registered,token:t.idToken,refresh:t.refreshToken,login:!0,current:"none"};if(K.A.update("session",e),t.registered){const e=await fetch("https://asia-southeast2-elearning-6871c.cloudfunctions.net/auth/role/",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t.idToken}}),s=await e.json();if(s.success){const e=await fetch("https://asia-southeast2-elearning-6871c.cloudfunctions.net/users/"+s.data.userId,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+K.A.get("session","token")}}),t=await e.json();let o=[];if("superadmin"===s.data.role){const e=K.A.get("configs");o={userID:s.data.userId,user:t.data,loader:!1,role:s.data.role,nav:s.data.role+"-nav",layout:"backend-layout",current:e}}else o={userID:s.data.userId,user:t.data,loader:!1,role:s.data.role,nav:s.data.role+"-nav",layout:"backend-layout"};if(K.A.update("session",o),"admin"===s.data.role||"manager"===s.data.role){const e=await this.loadMaster();e&&this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:500,icon:"success",title:"แจ้งเตือน",text:"เข้าสู่ระบบเรียบร้อยแล้ว"}).then((()=>{window.location.href="/"}))}else setTimeout((()=>{window.location.href="/"}),1e3)}}else this.$router.replace({path:"/member/unactive"})}else this.$swal({title:"เกิดข้อผิดพลาด",text:t.message,icon:"error",confirmButtonText:"ตกลง"}).then((()=>{this.activeBlock=!1,this.isLoading=!1}))}}catch(e){W.A.log(e),this.isLoading=!1}},async loadMaster(){W.A.log("loadMaster"),this.processing_text="กำลังโหลดข้อมูลหมวดหมู่.....";const e=await this.getCategoryData();if(e.success){const t={category:e.data};K.A.update("session",t),this.processing_text="กำลังโหลดข้อมูลโรงเรียน.....";const s=await this.getuserSession();if(s.success){const e={list:s.data};return K.A.update("session",e),!0}}},async getCategoryData(){if(this.login)try{const e=K.A.get("session");let t=e.token;this.loading_sources=!1;const s=await fetch("https://asia-southeast2-elearning-6871c.cloudfunctions.net/catagories/",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t}}),o=await s.json();return W.A.log("Category",o),o}catch(e){W.A.log(e)}},async getuserSession(){try{this.schoolCurrent="none";const t=K.A.get("session");if("undefined"!==typeof t.list&&t.list.length>0)this.SessionList=t.list,this.loading_sources=!0;else{let s=t.token;this.loading_sources=!1;const o=await fetch("https://asia-southeast2-elearning-6871c.cloudfunctions.net/schools/getAdminSchool/",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+s}});try{const e=await o.json();return e}catch(e){W.A.log("Error")}}}catch(e){W.A.log(e)}},switchVisibility(){this.passwordFieldType="password"===this.passwordFieldType?"text":"password",this.show=!this.show,this.$refs.btnToggle.innerText=this.show?(0,H.Tl)("login-hide"):(0,H.Tl)("login-show")},clearErrors(){this.errors=[]}},setup(){const e=(0,Q.lq)(),t=e.meta.title;(0,P.K7)(t)},async mounted(){const e=(0,Q.lq)(),t=e.meta.title;(0,P.K7)(t);try{const e=await(0,V.j)(!0);this.siteName=e.siteName,this.loginLogo=e.loginLogo,this.loginBg=e.loginBg,this.isLoaded=!0,setTimeout((()=>{this.showForm=!0}),300)}catch(s){console.error(s)}}},Y=s(64621);const ee=(0,Y.A)(Z,[["render",N],["__scopeId","data-v-f1a622f6"]]);var te=ee},64760:function(e,t,s){e.exports=s.p+"img/color-logo.9f3f18a5.png"}}]);
//# sourceMappingURL=5153.77b3617e.js.map