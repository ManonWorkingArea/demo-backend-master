"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[5163],{34982:function(e,t,s){s.d(t,{A:function(){return aa}});s(44114);var a=s(20641),r=s(90033),o=s(53751);const i={class:"max-w-full mx-auto"},n={key:0,class:"flex justify-center py-8"},l={key:1,class:"space-y-6"},c={class:"bg-white rounded-lg shadow-sm border border-gray-200"},d={class:"px-4 py-3 border-b border-gray-200"},u={class:"flex items-center justify-between"},p={class:"flex items-center space-x-3"},m={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center"},g={class:"text-base font-semibold text-gray-900"},h={class:"text-xs text-gray-500"},y={class:"flex items-center space-x-2"},f={class:"bg-blue-50 border-l-4 border-blue-400 p-3"},b={class:"flex"},x={class:"flex-shrink-0"},v={class:"p-4"},k={class:"flex items-center justify-between mb-3"},_={class:"bg-gray-600 text-white px-3 py-1 rounded-full text-sm font-medium"},$={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},L={class:"bg-gray-50 p-3 rounded"},w={class:"flex justify-between items-center"},C={class:"text-lg font-semibold text-gray-900"},I={class:"bg-gray-50 p-3 rounded"},T={class:"flex justify-between items-center"},D={class:"text-lg font-semibold text-gray-900"},S={class:"bg-gray-50 p-3 rounded"},E={class:"text-lg font-semibold text-gray-900"},A={class:"bg-gray-50 p-3 rounded"},P={class:"text-lg font-semibold text-gray-900"},N={class:"bg-gray-50 p-3 rounded"},O={class:"text-lg font-semibold text-gray-900"},j={class:"bg-gray-50 p-3 rounded"},X={class:"text-lg font-semibold text-gray-900"},M={class:"bg-white shadow-sm border border-gray-200"},Q={class:"px-4 py-3 border-b border-gray-200"},F={class:"flex items-center space-x-3"},R={class:"w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center"},U={class:"p-4"},V={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},z={class:"bg-gray-50 rounded-lg p-4 border border-gray-200"},H={class:"flex items-center justify-between mb-3"},B={class:"bg-gray-600 text-white px-3 py-1 rounded-full text-sm font-medium"},W={class:"grid grid-cols-3 gap-2 mb-3 text-xs"},q={class:"bg-gray-100 px-2 py-1 rounded text-center"},J={class:"font-medium text-gray-700"},G={class:"bg-gray-100 px-2 py-1 rounded text-center"},K={class:"font-medium text-gray-700"},Z={class:"bg-gray-100 px-2 py-1 rounded text-center"},Y={class:"font-medium text-gray-700"},ee={class:"grid grid-cols-2 gap-2 mb-3"},te={class:"bg-gray-50 p-2 rounded"},se={class:"flex justify-between items-center"},ae={class:"font-semibold text-gray-900"},re={class:"bg-gray-50 p-2 rounded"},oe={class:"flex justify-between items-center"},ie={class:"font-semibold text-gray-900"},ne={class:"bg-gray-50 p-2 rounded"},le={class:"flex justify-between items-center"},ce={class:"font-semibold text-gray-900"},de={class:"bg-gray-50 p-2 rounded"},ue={class:"flex justify-between items-center"},pe={class:"font-semibold text-gray-900"},me={class:"grid grid-cols-3 gap-2"},ge={class:"bg-gray-50 p-2 rounded text-center"},he={class:"font-semibold text-gray-900"},ye={class:"bg-gray-50 p-2 rounded text-center"},fe={class:"font-semibold text-gray-900"},be={class:"bg-gray-50 p-2 rounded text-center"},xe={class:"font-semibold text-gray-900"},ve={class:"bg-gray-50 rounded-lg p-4 border border-gray-200"},ke={class:"flex items-center justify-between mb-3"},_e={class:"bg-gray-600 text-white px-3 py-1 rounded-full text-sm font-medium"},$e={class:"grid grid-cols-3 gap-2 mb-3 text-xs"},Le={class:"bg-gray-100 px-2 py-1 rounded text-center"},we={class:"font-medium text-gray-700"},Ce={class:"bg-gray-100 px-2 py-1 rounded text-center"},Ie={class:"font-medium text-gray-700"},Te={class:"bg-gray-100 px-2 py-1 rounded text-center"},De={class:"font-medium text-gray-700"},Se={class:"grid grid-cols-2 gap-2 mb-3"},Ee={class:"bg-gray-50 p-2 rounded"},Ae={class:"flex justify-between items-center"},Pe={class:"font-semibold text-gray-900"},Ne={class:"bg-gray-50 p-2 rounded"},Oe={class:"flex justify-between items-center"},je={class:"font-semibold text-gray-900"},Xe={class:"bg-gray-50 p-2 rounded"},Me={class:"flex justify-between items-center"},Qe={class:"font-semibold text-gray-900"},Fe={class:"bg-gray-50 p-2 rounded"},Re={class:"flex justify-between items-center"},Ue={class:"font-semibold text-gray-900"},Ve={class:"grid grid-cols-3 gap-2"},ze={class:"bg-gray-50 p-2 rounded text-center"},He={class:"font-semibold text-gray-900"},Be={class:"bg-gray-50 p-2 rounded text-center"},We={class:"font-semibold text-gray-900"},qe={class:"bg-gray-50 p-2 rounded text-center"},Je={class:"font-semibold text-gray-900"},Ge={class:"bg-white shadow-sm border border-gray-200"},Ke={class:"px-4 py-3 border-b border-gray-200"},Ze={class:"flex items-center justify-between mb-4"},Ye={class:"flex items-center space-x-3"},et={class:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg flex items-center justify-center"},tt={class:"flex items-center space-x-3"},st=["value"],at={class:"flex items-center justify-between"},rt={class:"flex items-center space-x-3"},ot={class:"flex items-center space-x-4 text-sm"},it={class:"flex items-center cursor-pointer"},nt={class:"flex items-center cursor-pointer"},lt={class:"overflow-x-auto"},ct={class:"min-w-full divide-y divide-gray-200"},dt={class:"bg-white divide-y divide-gray-200"},ut={class:"hover:bg-gray-50"},pt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},mt={class:"px-6 py-4 whitespace-nowrap"},gt=["src"],ht={class:"font-medium text-gray-900"},yt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 hidden md:table-cell"},ft={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 hidden md:table-cell"},bt={class:"px-6 py-4 whitespace-nowrap text-sm text-center hidden md:table-cell"},xt={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 hidden md:table-cell"},kt={class:"px-6 py-4 whitespace-nowrap text-sm hidden md:table-cell"},_t={class:"flex space-x-2"},$t=["onClick"],Lt=["onClick"],wt={key:0,class:"bg-gray-50"},Ct={colspan:"7",class:"px-6 py-4"},It={class:"grid grid-cols-1 md:grid-cols-5 gap-4 text-sm"},Tt={class:"space-y-2"},Dt={class:"w-full bg-gray-200 rounded-full h-2"},St={class:"space-y-2"},Et={class:"video-wrapper bg-gray-200 rounded-lg relative"},At={key:0},Pt=["src","poster"],Nt=["onClick"],Ot={class:"flex items-center"},jt={key:1,class:"no-video-placeholder"},Xt={class:"grid grid-cols-6 gap-1"},Mt=["src","onClick"],Qt={key:1,class:"bg-gray-200 h-6 rounded"},Ft={class:"flex space-x-2"},Rt=["onClick"],Ut=["onClick"],Vt={class:"video-wrapper bg-gray-200 rounded-lg relative"},zt={key:0},Ht=["src","poster"],Bt=["onClick"],Wt={class:"flex items-center"},qt={key:1,class:"no-video-placeholder"},Jt={class:"grid grid-cols-6 gap-1"},Gt=["src","onClick"],Kt={key:1,class:"bg-gray-200 h-6 rounded"},Zt={class:"flex space-x-2"},Yt=["onClick"],es=["onClick"],ts={class:"video-wrapper bg-gray-200 rounded-lg relative"},ss={key:0},as=["src","poster"],rs=["onClick"],os={class:"flex items-center"},is={key:1,class:"no-video-placeholder"},ns={class:"grid grid-cols-6 gap-1"},ls=["src","onClick"],cs={key:1,class:"bg-gray-200 h-6 rounded"},ds={class:"flex space-x-2"},us=["onClick"],ps=["onClick"],ms={class:"space-y-2"},gs={class:"p-2 bg-white rounded border text-xs"},hs={class:"grid grid-cols-1 gap-1"},ys={key:0,class:"px-6 py-3 border-t border-gray-200 bg-gray-50"},fs={class:"flex items-center justify-center space-x-4"},bs={key:0,class:"flex items-center space-x-2 text-blue-600"},xs={key:2,class:"text-sm text-green-600"},vs={class:"px-6 py-3 border-t border-gray-200"},ks={key:0,class:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-40 pointer-events-none"},_s={class:"bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg flex items-center space-x-3 pointer-events-auto"},$s={class:"flex items-center space-x-2"},Ls={class:"text-sm font-medium"},ws={class:"w-20 bg-blue-500 rounded-full h-1.5"},Cs={class:"text-xs text-blue-200 font-medium"},Is={class:"relative"},Ts=["src"],Ds={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ss={class:"bg-white rounded-lg w-4/5 h-4/5 flex flex-col shadow-xl"},Es={class:"px-4 py-3 border-b border-gray-200 bg-gray-50 rounded-t-lg"},As={class:"flex items-center justify-between"},Ps={class:"flex items-center space-x-3"},Ns={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center"},Os={class:"flex space-x-1 mt-3"},js={class:"p-4 flex-grow overflow-y-auto"},Xs={key:0},Ms={key:0},Qs={class:"overflow-x-auto"},Fs={class:"table-auto border border-gray-300"},Rs={key:1},Us={class:"grid grid-cols-2 gap-4"},Vs={class:"px-4 py-3 border-t border-gray-200 bg-gray-50 rounded-b-lg flex justify-end space-x-2"};function zs(e,t,s,zs,Hs,Bs){const Ws=(0,a.g2)("batch-progress"),qs=(0,a.g2)("Loader"),Js=(0,a.g2)("font-awesome-icon"),Gs=(0,a.g2)("Pagination"),Ks=(0,a.g2)("router-link");return(0,a.uX)(),(0,a.CE)("div",i,[(0,a.bF)(Ws,{processName:Hs.processName,progressText:Hs.progressText,progressTotal:Hs.progressTotal,progressCurrent:Hs.progressCurrent,isVisible:Hs.isProcessing,startTime:Hs.startTime,endTime:Hs.endTime,onClose:Bs.closeProgress},null,8,["processName","progressText","progressTotal","progressCurrent","isVisible","startTime","endTime","onClose"]),Hs.loading_sources?((0,a.uX)(),(0,a.CE)("div",l,[(0,a.Lk)("div",c,[(0,a.Lk)("div",d,[(0,a.Lk)("div",u,[(0,a.Lk)("div",p,[(0,a.Lk)("div",m,[(0,a.bF)(Js,{icon:["fas","users"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[(0,a.Lk)("h2",g,(0,r.v_)(s.pageTitle),1),(0,a.Lk)("p",h,"จัดการผู้ลงทะเบียนหลักสูตร ("+(0,r.v_)(Hs.totalItems)+" รายการ)",1)])]),(0,a.Lk)("div",y,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>Bs.getData&&Bs.getData(...e)),class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors"},[(0,a.bF)(Js,{icon:["fas","refresh"],class:"mr-1 text-xs"}),t[37]||(t[37]=(0,a.eW)(" รีเฟรช "))]),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>Bs.exportToCSV&&Bs.exportToCSV(...e)),class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors"},[(0,a.bF)(Js,{icon:["fas","download"],class:"mr-1 text-xs"}),t[38]||(t[38]=(0,a.eW)(" Export CSV "))]),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>Bs.assignUserModal&&Bs.assignUserModal(...e)),class:"inline-flex items-center rounded-lg border border-transparent bg-blue-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(Js,{icon:["fas","plus"],class:"mr-1.5"}),t[39]||(t[39]=(0,a.eW)(" เพิ่มผู้ลงทะเบียน "))])])])]),(0,a.Lk)("div",f,[(0,a.Lk)("div",b,[(0,a.Lk)("div",x,[(0,a.bF)(Js,{icon:["fas","info-circle"],class:"text-blue-400 text-sm"})]),t[40]||(t[40]=(0,a.Lk)("div",{class:"ml-2"},[(0,a.Lk)("p",{class:"text-xs text-blue-700"},[(0,a.Lk)("strong",null,"หมายเหตุ:"),(0,a.eW)(" ระบบจะแสดงข้อมูลผู้ลงทะเบียนทั้งหมดในหลักสูตรนี้ คุณสามารถค้นหา กรองข้อมูล และส่งออกเป็นไฟล์ CSV เพื่อนำไปใช้งานต่อได้ ")])],-1))])]),(0,a.Lk)("div",v,[(0,a.Lk)("div",k,[t[41]||(t[41]=(0,a.Lk)("h3",{class:"text-lg font-semibold text-gray-900"},"ภาพรวมการเรียน",-1)),(0,a.Lk)("div",_,(0,r.v_)(Bs.formatNumber(Hs.summary.total_entries))+" คน ",1)]),(0,a.Lk)("div",$,[(0,a.Lk)("div",L,[(0,a.Lk)("div",w,[(0,a.Lk)("div",null,[t[42]||(t[42]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"ลงทะเบียนทั้งหมด",-1)),(0,a.Lk)("div",C,(0,r.v_)(Bs.formatNumber(Hs.summary.total_entries)),1)]),Hs.loadSummary?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[3]||(t[3]=e=>Bs.getSumList("total_entries")),class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"},[(0,a.bF)(Js,{icon:["fas","download"],class:"mr-1"}),t[43]||(t[43]=(0,a.eW)(" CSV "))])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",I,[(0,a.Lk)("div",T,[(0,a.Lk)("div",null,[t[44]||(t[44]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"ยังไม่ได้เริ่มเรียน",-1)),(0,a.Lk)("div",D,(0,r.v_)(Bs.formatNumber(Hs.summary.no_analytics_data)),1)]),Hs.loadSummary?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[4]||(t[4]=e=>Bs.getSumList("no_analytics_data")),class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"},[(0,a.bF)(Js,{icon:["fas","download"],class:"mr-1"}),t[45]||(t[45]=(0,a.eW)(" CSV "))])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",S,[t[46]||(t[46]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"เริ่มเรียนแล้ว",-1)),(0,a.Lk)("div",E,(0,r.v_)(Bs.formatNumber(Hs.summary.complete_between_1_and_12)),1)]),(0,a.Lk)("div",A,[t[47]||(t[47]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"เรียนจบแล้ว",-1)),(0,a.Lk)("div",P,(0,r.v_)(Bs.formatNumber(Hs.summary.complete_13)),1)]),(0,a.Lk)("div",N,[t[48]||(t[48]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"ยืนยันตัวแล้ว",-1)),(0,a.Lk)("div",O,(0,r.v_)(Bs.formatNumber(Hs.summary.verified_all)),1)]),(0,a.Lk)("div",j,[t[49]||(t[49]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"ยืนยันตัวสำเร็จ",-1)),(0,a.Lk)("div",X,(0,r.v_)(Bs.formatNumber(Hs.summary.verified_true)),1)])])]),(0,a.Lk)("div",M,[(0,a.Lk)("div",Q,[(0,a.Lk)("div",F,[(0,a.Lk)("div",R,[(0,a.bF)(Js,{icon:["fas","graduation-cap"],class:"text-white text-sm"})]),t[50]||(t[50]=(0,a.Lk)("div",null,[(0,a.Lk)("h3",{class:"text-base font-semibold text-gray-900"},"ผลการสอบตามรอบ"),(0,a.Lk)("p",{class:"text-xs text-gray-500"},"สถิติการสอบแบ่งตามรอบการสอบ")],-1))])]),(0,a.Lk)("div",U,[(0,a.Lk)("div",V,[(0,a.Lk)("div",z,[(0,a.Lk)("div",H,[t[51]||(t[51]=(0,a.Lk)("h3",{class:"text-lg font-semibold text-gray-900"},"สอบรอบที่ 1",-1)),(0,a.Lk)("div",B,(0,r.v_)(Bs.formatNumber(Hs.summary.exam_round_1))+" คน ",1)]),(0,a.Lk)("div",W,[(0,a.Lk)("div",q,[(0,a.Lk)("div",J,(0,r.v_)(Bs.formatNumber(Hs.summary.complete_13_exam_round_1)),1),t[52]||(t[52]=(0,a.Lk)("div",{class:"text-gray-600"},"เรียนจบ",-1))]),(0,a.Lk)("div",G,[(0,a.Lk)("div",K,(0,r.v_)(Bs.formatNumber(Hs.summary.no_analytics_data_exam_round_1)),1),t[53]||(t[53]=(0,a.Lk)("div",{class:"text-gray-600"},"ยังไม่เริ่ม",-1))]),(0,a.Lk)("div",Z,[(0,a.Lk)("div",Y,(0,r.v_)(Bs.formatNumber(Hs.summary.complete_between_1_and_12_exam_round_1)),1),t[54]||(t[54]=(0,a.Lk)("div",{class:"text-gray-600"},"กำลังเรียน",-1))])]),(0,a.Lk)("div",ee,[(0,a.Lk)("div",te,[(0,a.Lk)("div",se,[(0,a.Lk)("div",null,[t[55]||(t[55]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"ส่งข้อสอบแล้ว",-1)),(0,a.Lk)("div",ae,(0,r.v_)(Bs.formatNumber(Hs.summary.post_1_to_50)),1)]),(0,a.Lk)("button",{onClick:t[5]||(t[5]=e=>Bs.getData({gte:1,lte:50})),class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," ดู ")])]),(0,a.Lk)("div",re,[(0,a.Lk)("div",oe,[(0,a.Lk)("div",null,[t[56]||(t[56]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"คะแนน 1-10",-1)),(0,a.Lk)("div",ie,(0,r.v_)(Bs.formatNumber(Hs.summary.post_1_to_10)),1)]),(0,a.Lk)("button",{onClick:t[6]||(t[6]=e=>Bs.getData({gte:1,lte:10})),class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," ดู ")])]),(0,a.Lk)("div",ne,[(0,a.Lk)("div",le,[(0,a.Lk)("div",null,[t[57]||(t[57]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"คะแนน 11-32",-1)),(0,a.Lk)("div",ce,(0,r.v_)(Bs.formatNumber(Hs.summary.post_11_to_32)),1)]),(0,a.Lk)("button",{onClick:t[7]||(t[7]=e=>Bs.getData({gte:11,lte:32})),class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," ดู ")])]),(0,a.Lk)("div",de,[(0,a.Lk)("div",ue,[(0,a.Lk)("div",null,[t[58]||(t[58]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"คะแนน 33-50",-1)),(0,a.Lk)("div",pe,(0,r.v_)(Bs.formatNumber(Hs.summary.post_over_33)),1)]),(0,a.Lk)("button",{onClick:t[8]||(t[8]=e=>Bs.getData({gte:33,lte:50})),class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," ดู ")])])]),(0,a.Lk)("div",me,[(0,a.Lk)("div",ge,[t[59]||(t[59]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"สอบซ่อม",-1)),(0,a.Lk)("div",he,(0,r.v_)(Bs.formatNumber(Hs.summary.has_retest)),1)]),(0,a.Lk)("div",ye,[t[60]||(t[60]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"ซ่อม 1-32",-1)),(0,a.Lk)("div",fe,(0,r.v_)(Bs.formatNumber(Hs.summary.has_retest_fail)),1)]),(0,a.Lk)("div",be,[t[61]||(t[61]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"ซ่อม 33-50",-1)),(0,a.Lk)("div",xe,(0,r.v_)(Bs.formatNumber(Hs.summary.has_retest_pass)),1)])])]),(0,a.Lk)("div",ve,[(0,a.Lk)("div",ke,[t[62]||(t[62]=(0,a.Lk)("h3",{class:"text-lg font-semibold text-gray-900"},"สอบรอบที่ 2",-1)),(0,a.Lk)("div",_e,(0,r.v_)(Bs.formatNumber(Hs.summary.exam_round_2))+" คน ",1)]),(0,a.Lk)("div",$e,[(0,a.Lk)("div",Le,[(0,a.Lk)("div",we,(0,r.v_)(Bs.formatNumber(Hs.summary.complete_13_exam_round_2)),1),t[63]||(t[63]=(0,a.Lk)("div",{class:"text-gray-600"},"เรียนจบ",-1))]),(0,a.Lk)("div",Ce,[(0,a.Lk)("div",Ie,(0,r.v_)(Bs.formatNumber(Hs.summary.no_analytics_data_exam_round_2)),1),t[64]||(t[64]=(0,a.Lk)("div",{class:"text-gray-600"},"ยังไม่เริ่ม",-1))]),(0,a.Lk)("div",Te,[(0,a.Lk)("div",De,(0,r.v_)(Bs.formatNumber(Hs.summary.complete_between_1_and_12_exam_round_2)),1),t[65]||(t[65]=(0,a.Lk)("div",{class:"text-gray-600"},"กำลังเรียน",-1))])]),(0,a.Lk)("div",Se,[(0,a.Lk)("div",Ee,[(0,a.Lk)("div",Ae,[(0,a.Lk)("div",null,[t[66]||(t[66]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"ส่งข้อสอบแล้ว",-1)),(0,a.Lk)("div",Pe,(0,r.v_)(Bs.formatNumber(Hs.summary.post_1_to_50_round2)),1)]),(0,a.Lk)("button",{onClick:t[9]||(t[9]=e=>Bs.getData({gte:1,lte:50})),class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," ดู ")])]),(0,a.Lk)("div",Ne,[(0,a.Lk)("div",Oe,[(0,a.Lk)("div",null,[t[67]||(t[67]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"คะแนน 1-10",-1)),(0,a.Lk)("div",je,(0,r.v_)(Bs.formatNumber(Hs.summary.post_1_to_10_round2)),1)]),(0,a.Lk)("button",{onClick:t[10]||(t[10]=e=>Bs.getData({gte:1,lte:10})),class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," ดู ")])]),(0,a.Lk)("div",Xe,[(0,a.Lk)("div",Me,[(0,a.Lk)("div",null,[t[68]||(t[68]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"คะแนน 11-32",-1)),(0,a.Lk)("div",Qe,(0,r.v_)(Bs.formatNumber(Hs.summary.post_11_to_32_round2)),1)]),(0,a.Lk)("button",{onClick:t[11]||(t[11]=e=>Bs.getData({gte:11,lte:32})),class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," ดู ")])]),(0,a.Lk)("div",Fe,[(0,a.Lk)("div",Re,[(0,a.Lk)("div",null,[t[69]||(t[69]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"คะแนน 33-50",-1)),(0,a.Lk)("div",Ue,(0,r.v_)(Bs.formatNumber(Hs.summary.post_over_33_round2)),1)]),(0,a.Lk)("button",{onClick:t[12]||(t[12]=e=>Bs.getData({gte:33,lte:50})),class:"text-xs px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700"}," ดู ")])])]),(0,a.Lk)("div",Ve,[(0,a.Lk)("div",ze,[t[70]||(t[70]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"สอบซ่อม",-1)),(0,a.Lk)("div",He,(0,r.v_)(Bs.formatNumber(Hs.summary.has_retest_round2)),1)]),(0,a.Lk)("div",Be,[t[71]||(t[71]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"ซ่อม 1-32",-1)),(0,a.Lk)("div",We,(0,r.v_)(Bs.formatNumber(Hs.summary.has_retest_fail_round2)),1)]),(0,a.Lk)("div",qe,[t[72]||(t[72]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"ซ่อม 33-50",-1)),(0,a.Lk)("div",Je,(0,r.v_)(Bs.formatNumber(Hs.summary.has_retest_pass_round2)),1)])])])])])]),(0,a.Lk)("div",Ge,[(0,a.Lk)("div",Ke,[(0,a.Lk)("div",Ze,[(0,a.Lk)("div",Ye,[(0,a.Lk)("div",et,[(0,a.bF)(Js,{icon:["fas","list"],class:"text-white text-sm"})]),t[73]||(t[73]=(0,a.Lk)("div",null,[(0,a.Lk)("h3",{class:"text-base font-semibold text-gray-900"},"รายชื่อผู้ลงทะเบียน"),(0,a.Lk)("p",{class:"text-xs text-gray-500"},"จัดการข้อมูลผู้เรียนในหลักสูตร")],-1))]),(0,a.Lk)("div",tt,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>Hs.limitItem=e),onChange:t[14]||(t[14]=(...e)=>Bs.handleLimitChange&&Bs.handleLimitChange(...e)),class:"px-3 py-2 border border-gray-300 rounded-md text-sm"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(Hs.limitOptions,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,r.v_)(e),9,st)))),128))],544),[[o.u1,Hs.limitItem]]),(0,a.bF)(Gs,{"current-page":Hs.currentPage,"total-items":Hs.totalItems,"total-pages":Hs.totalPages,"limit-items":Hs.limitItem,"data-loading":Hs.loading,"display-mode":"nav",onPageChanged:Bs.handlePageChanged},null,8,["current-page","total-items","total-pages","limit-items","data-loading","onPageChanged"])])]),(0,a.Lk)("div",at,[(0,a.Lk)("div",rt,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>Hs.searchQuery=e),onInput:t[16]||(t[16]=(...t)=>e.handleSearchInput&&e.handleSearchInput(...t)),type:"text",placeholder:"ค้นหาชื่อ, อีเมล, เบอร์โทร...",class:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,544),[[o.Jo,Hs.searchQuery]]),Hs.searchQuery.length>0?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[17]||(t[17]=(...e)=>Bs.clearSearchQuery&&Bs.clearSearchQuery(...e)),class:"text-blue-500 hover:underline text-sm"}," Clear ")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",ot,[Bs.hasMoreItems?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[18]||(t[18]=(...e)=>Bs.showAllItems&&Bs.showAllItems(...e)),class:"text-xs px-2 py-1 bg-orange-500 text-white rounded hover:bg-orange-600"}," แสดงทั้งหมดเลย ")):(0,a.Q3)("",!0),(0,a.Lk)("label",it,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[19]||(t[19]=e=>Hs.layoutVisibility.order=e),class:"mr-2 rounded"},null,512),[[o.lH,Hs.layoutVisibility.order]]),t[74]||(t[74]=(0,a.eW)(" คำสั่งซื้อ "))]),(0,a.Lk)("label",nt,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[20]||(t[20]=e=>Hs.layoutVisibility.enroll=e),class:"mr-2 rounded"},null,512),[[o.lH,Hs.layoutVisibility.enroll]]),t[75]||(t[75]=(0,a.eW)(" การเรียน "))])])])]),(0,a.Lk)("div",lt,[(0,a.Lk)("table",ct,[t[94]||(t[94]=(0,a.Lk)("thead",{class:"bg-gray-50"},[(0,a.Lk)("tr",{class:"text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[(0,a.Lk)("th",{class:"px-6 py-3"},"#"),(0,a.Lk)("th",{class:"px-6 py-3"},"ชื่อ-นามสกุล"),(0,a.Lk)("th",{class:"px-6 py-3 hidden md:table-cell"},"เลขบัตรประจำตัว"),(0,a.Lk)("th",{class:"px-6 py-3 hidden md:table-cell"},"การติดต่อ"),(0,a.Lk)("th",{class:"px-6 py-3 hidden md:table-cell text-center"},"จำนวนหลักสูตร"),(0,a.Lk)("th",{class:"px-6 py-3 hidden md:table-cell"},"วันที่ลงทะเบียน"),(0,a.Lk)("th",{class:"px-6 py-3 hidden md:table-cell"},"เครื่องมือ")])],-1)),(0,a.Lk)("tbody",dt,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(Bs.visibleItems,((o,i)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:o.user._id},[(0,a.Lk)("tr",ut,[(0,a.Lk)("td",pt,(0,r.v_)(Bs.leadingZero((Hs.currentPage-1)*Hs.limitItem+i+1)),1),(0,a.Lk)("td",mt,[(0,a.bF)(Ks,{to:"/student/detail/"+o.user._id+"?back=/lesson/detail/"+this.dataItem+"/enroll",class:"flex items-center hover:text-indigo-600"},{default:(0,a.k6)((()=>[(0,a.Lk)("img",{src:o.enroll?.form?.formData?.["upload-22-0-12"]?.value?.[0]??"path/to/default/image.png",class:"w-10 h-10 rounded-md bg-gray-200 mr-3",alt:"Profile"},null,8,gt),(0,a.Lk)("span",ht,(0,r.v_)(o.user.firstname)+" "+(0,r.v_)(o.user.lastname),1)])),_:2},1032,["to"])]),(0,a.Lk)("td",yt,(0,r.v_)(o.user.citizen),1),(0,a.Lk)("td",ft,[(0,a.Lk)("div",null,(0,r.v_)(o.user.phone),1),(0,a.Lk)("div",null,(0,r.v_)(o.user.email),1)]),(0,a.Lk)("td",bt,[(0,a.Lk)("span",xt,(0,r.v_)(o.enroll.enrollCount||"0")+" หลักสูตร ",1)]),(0,a.Lk)("td",vt,(0,r.v_)(o.enroll.createdAt||"-"),1),(0,a.Lk)("td",kt,[(0,a.Lk)("div",_t,[s.isPublic?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t=>e.$router.push("/lesson/edit/"+o.user._id),class:"px-2 py-1 border border-gray-300 rounded text-xs hover:bg-gray-50"}," แก้ไข ",8,$t)),s.isPublic?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:e=>Bs.bypassContent(o.enroll),class:"px-2 py-1 border border-gray-300 rounded text-xs hover:bg-gray-50"},(0,r.v_)(o.enroll.analytics.bypass?"ยกเลิก Bypass":"Bypass วีดีโอ"),9,Lt))])])]),Hs.layoutVisibility.enroll?((0,a.uX)(),(0,a.CE)("tr",wt,[(0,a.Lk)("td",Ct,[(0,a.Lk)("div",It,[(0,a.Lk)("div",Tt,[(0,a.Lk)("div",null,[t[76]||(t[76]=(0,a.Lk)("strong",null,"Bypass:",-1)),(0,a.eW)(" "+(0,r.v_)(o.enroll.analytics.bypass?"ไม่นับเวลา":"นับเวลาปกติ"),1)]),(0,a.Lk)("div",null,[t[77]||(t[77]=(0,a.Lk)("strong",null,"รอบสอบ:",-1)),(0,a.eW)(" "+(0,r.v_)(o.enroll?.form?.formData?.["radiobox-14-0-9"]?.value?.label||"N/A"),1)]),(0,a.Lk)("div",null,[t[78]||(t[78]=(0,a.Lk)("strong",null,"ความคืบหน้า:",-1)),(0,a.eW)(" "+(0,r.v_)(o.enroll?.analytics?.complete||"0")+" / "+(0,r.v_)(o.enroll?.analytics?.total||"")+" EP ("+(0,r.v_)(o.enroll?.analytics?.percent||0)+"%) ",1)]),(0,a.Lk)("div",Dt,[(0,a.Lk)("div",{class:"bg-blue-600 h-2 rounded-full",style:(0,r.Tr)(`width: ${o.enroll?.analytics?.percent||0}%`)},null,4)])]),(0,a.Lk)("div",St,[t[81]||(t[81]=(0,a.Lk)("div",{class:"font-semibold text-gray-700"},"ก่อนเรียน",-1)),(0,a.Lk)("div",Et,[Bs.isValidVideoUrl(o.enroll?.verified?.pre?.url)?((0,a.uX)(),(0,a.CE)("div",At,[Hs.videoLoaded[i]?((0,a.uX)(),(0,a.CE)("video",{key:0,ref_for:!0,ref:`videoElement-${i}`,src:o.enroll?.verified?.pre?.url,poster:o.posterUrl,controls:"",class:"fixed-size-video"},null,8,Pt)):((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:e=>Bs.loadVideo(o.enroll?.verified?.pre?.url,i),class:"absolute inset-0 flex items-center justify-center w-full h-full bg-gray-800 bg-opacity-80 text-white hover:bg-opacity-90 transition-opacity"},[(0,a.Lk)("div",Ot,[(0,a.bF)(Js,{icon:"fas fa-play",class:"mr-2"}),t[79]||(t[79]=(0,a.Lk)("span",null,"Play Video",-1))])],8,Nt))])):((0,a.uX)(),(0,a.CE)("div",jt," No Video "))]),(0,a.Lk)("div",Xt,[((0,a.uX)(),(0,a.CE)(a.FK,null,(0,a.pI)(6,((e,t)=>(0,a.Lk)("div",{key:t,class:"thumbnail"},[o.enroll?.capture?.pre?.urls&&o.enroll?.capture?.pre?.urls[t]?((0,a.uX)(),(0,a.CE)("img",{key:0,src:o.enroll.capture.pre.urls[t],alt:"Video thumbnail",class:"w-full h-6 cursor-pointer rounded",onClick:e=>Bs.openLightbox(o.enroll.capture.pre.urls[t])},null,8,Mt)):((0,a.uX)(),(0,a.CE)("div",Qt))]))),64))]),(0,a.Lk)("div",null,[t[80]||(t[80]=(0,a.Lk)("strong",null,"คะแนน:",-1)),(0,a.eW)(" "+(0,r.v_)(o.enroll?.analytics?.pre?.score||"N/A"),1)]),(0,a.Lk)("div",Ft,[s.isPublic?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:e=>Bs.resetScore(o.enroll?.examPre?._id,o.user._id,o.enroll,"pre"),class:"px-2 py-1 bg-gray-200 rounded text-xs hover:bg-gray-300"}," Reset ",8,Rt)),s.isPublic?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:e=>Bs.bypassVerified(o.enroll,"pre"),class:"px-2 py-1 bg-gray-200 rounded text-xs hover:bg-gray-300"}," Skip Verified ",8,Ut))])]),(0,a.Lk)("div",{class:(0,r.C4)(["space-y-2",o.enroll?.analytics?.post?.score>32?"text-green-700":"text-red-700"])},[t[84]||(t[84]=(0,a.Lk)("div",{class:"font-semibold text-gray-700"},"หลังเรียน",-1)),(0,a.Lk)("div",Vt,[Bs.isValidVideoUrl(o.enroll?.verified?.post?.url)?((0,a.uX)(),(0,a.CE)("div",zt,[Hs.videoLoaded[`post-${i}`]?((0,a.uX)(),(0,a.CE)("video",{key:0,ref_for:!0,ref:`videoElement-post-${i}`,src:o.enroll?.verified?.post?.url,poster:o.posterUrl,controls:"",class:"fixed-size-video"},null,8,Ht)):((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:e=>Bs.loadVideo(o.enroll?.verified?.post?.url,`post-${i}`),class:"absolute inset-0 flex items-center justify-center w-full h-full bg-gray-800 bg-opacity-80 text-white hover:bg-opacity-90 transition-opacity"},[(0,a.Lk)("div",Wt,[(0,a.bF)(Js,{icon:"fas fa-play",class:"mr-2"}),t[82]||(t[82]=(0,a.Lk)("span",null,"Play Video",-1))])],8,Bt))])):((0,a.uX)(),(0,a.CE)("div",qt," No Video "))]),(0,a.Lk)("div",Jt,[((0,a.uX)(),(0,a.CE)(a.FK,null,(0,a.pI)(6,((e,t)=>(0,a.Lk)("div",{key:t,class:"thumbnail"},[o.enroll?.capture?.post?.urls&&o.enroll?.capture?.post?.urls[t]?((0,a.uX)(),(0,a.CE)("img",{key:0,src:o.enroll.capture.post.urls[t],alt:"Video thumbnail",class:"w-full h-6 cursor-pointer rounded",onClick:e=>Bs.openLightbox(o.enroll.capture.post.urls[t])},null,8,Gt)):((0,a.uX)(),(0,a.CE)("div",Kt))]))),64))]),(0,a.Lk)("div",null,[t[83]||(t[83]=(0,a.Lk)("strong",null,"คะแนน:",-1)),(0,a.Lk)("span",{class:(0,r.C4)(o.enroll?.analytics?.post?.score>32?"text-green-600":"text-red-600")},(0,r.v_)(o.enroll?.analytics?.post?.score||"N/A"),3)]),(0,a.Lk)("div",Zt,[s.isPublic?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:e=>Bs.resetScore(o.enroll?.examPost?._id,o.user._id,o.enroll,"post"),class:"px-2 py-1 bg-gray-200 rounded text-xs hover:bg-gray-300"}," Reset ",8,Yt)),s.isPublic?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:e=>Bs.bypassVerified(o.enroll,"post"),class:"px-2 py-1 bg-gray-200 rounded text-xs hover:bg-gray-300"}," Skip Verified ",8,es))])],2),o.enroll?.analytics?.post?.score<33?((0,a.uX)(),(0,a.CE)("div",{key:0,class:(0,r.C4)(["space-y-2",o.enroll?.analytics?.retest?.score>32?"text-green-700":"text-red-700"])},[t[87]||(t[87]=(0,a.Lk)("div",{class:"font-semibold text-gray-700"},"สอบซ่อม",-1)),(0,a.Lk)("div",ts,[Bs.isValidVideoUrl(o.enroll?.verified?.retest?.url)?((0,a.uX)(),(0,a.CE)("div",ss,[Hs.videoLoaded[`retest-${i}`]?((0,a.uX)(),(0,a.CE)("video",{key:0,ref_for:!0,ref:`videoElement-retest-${i}`,src:o.enroll?.verified?.retest?.url,poster:o.posterUrl,controls:"",class:"fixed-size-video"},null,8,as)):((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:e=>Bs.loadVideo(o.enroll?.verified?.retest?.url,`retest-${i}`),class:"absolute inset-0 flex items-center justify-center w-full h-full bg-gray-800 bg-opacity-80 text-white hover:bg-opacity-90 transition-opacity"},[(0,a.Lk)("div",os,[(0,a.bF)(Js,{icon:"fas fa-play",class:"mr-2"}),t[85]||(t[85]=(0,a.Lk)("span",null,"Play Video",-1))])],8,rs))])):((0,a.uX)(),(0,a.CE)("div",is," No Video "))]),(0,a.Lk)("div",ns,[((0,a.uX)(),(0,a.CE)(a.FK,null,(0,a.pI)(6,((e,t)=>(0,a.Lk)("div",{key:t,class:"thumbnail"},[o.enroll?.capture?.retest?.urls&&o.enroll?.capture?.retest?.urls[t]?((0,a.uX)(),(0,a.CE)("img",{key:0,src:o.enroll.capture.retest.urls[t],alt:"Video thumbnail",class:"w-full h-6 cursor-pointer rounded",onClick:e=>Bs.openLightbox(o.enroll.capture.retest.urls[t])},null,8,ls)):((0,a.uX)(),(0,a.CE)("div",cs))]))),64))]),(0,a.Lk)("div",null,[t[86]||(t[86]=(0,a.Lk)("strong",null,"คะแนน:",-1)),(0,a.eW)(" "+(0,r.v_)(o.enroll?.analytics?.retest?.score||"N/A"),1)]),(0,a.Lk)("div",ds,[s.isPublic?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:e=>Bs.resetScore(o.enroll?.examPost?._id,o.user._id,o.enroll,"retest"),class:"px-2 py-1 bg-gray-200 rounded text-xs hover:bg-gray-300"}," Reset ",8,us)),s.isPublic?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:e=>Bs.bypassVerified(o.enroll,"retest"),class:"px-2 py-1 bg-gray-200 rounded text-xs hover:bg-gray-300"}," Skip Verified ",8,ps))])],2)):(0,a.Q3)("",!0),(0,a.Lk)("div",ms,[t[93]||(t[93]=(0,a.Lk)("div",{class:"font-semibold text-gray-700"},"สถานะ",-1)),(0,a.Lk)("div",{class:(0,r.C4)(["p-2 rounded","ผ่านการรับรอง"===o.enroll?.analytics?.post?.message?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},(0,r.v_)(o.enroll?.analytics?.post?.message||"รอการประเมิน"),3),(0,a.Lk)("div",gs,[t[92]||(t[92]=(0,a.Lk)("div",{class:"font-medium mb-2"},"ข้อมูลอุปกรณ์",-1)),(0,a.Lk)("div",hs,[(0,a.Lk)("div",null,[t[88]||(t[88]=(0,a.Lk)("strong",null,"OS:",-1)),(0,a.eW)(" "+(0,r.v_)(o?.user?.clientData?.os||"N/A"),1)]),(0,a.Lk)("div",null,[t[89]||(t[89]=(0,a.Lk)("strong",null,"Browser:",-1)),(0,a.eW)(" "+(0,r.v_)(o?.user?.clientData?.browser||"N/A"),1)]),(0,a.Lk)("div",null,[t[90]||(t[90]=(0,a.Lk)("strong",null,"IP:",-1)),(0,a.eW)(" "+(0,r.v_)(o?.user?.clientData?.ip||"N/A"),1)]),(0,a.Lk)("div",null,[t[91]||(t[91]=(0,a.Lk)("strong",null,"Location:",-1)),(0,a.eW)(" "+(0,r.v_)(o?.user?.clientData?.location||"N/A"),1)])])])])])])])):(0,a.Q3)("",!0)],64)))),128))])])]),Hs.lazy?((0,a.uX)(),(0,a.CE)("div",ys,[(0,a.Lk)("div",fs,[Hs.isLoadingMore?((0,a.uX)(),(0,a.CE)("div",bs,t[95]||(t[95]=[(0,a.Lk)("svg",{class:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[(0,a.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),(0,a.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),(0,a.Lk)("span",{class:"text-sm"},"กำลังโหลดเพิ่ม...",-1)]))):Bs.hasMoreItems?((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:t[21]||(t[21]=(...e)=>Bs.loadMoreItems&&Bs.loadMoreItems(...e)),class:"inline-flex items-center px-4 py-2 border border-blue-300 rounded-md text-sm font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 transition-colors"},[(0,a.bF)(Js,{icon:["fas","plus"],class:"mr-2"}),(0,a.eW)(" โหลดเพิ่ม ("+(0,r.v_)(Bs.progressiveLoadingStats?.remaining||0)+" รายการ) ",1)])):((0,a.uX)(),(0,a.CE)("div",xs,[(0,a.bF)(Js,{icon:["fas","check-circle"],class:"mr-1"}),(0,a.eW)(" แสดงครบทั้งหมดแล้ว ("+(0,r.v_)(Bs.progressiveLoadingStats?.total||0)+" รายการ) ",1)]))])])):(0,a.Q3)("",!0),(0,a.Lk)("div",vs,[(0,a.bF)(Gs,{"current-page":Hs.currentPage,"total-items":Hs.totalItems,"total-pages":Hs.totalPages,"limit-items":Hs.limitItem,"data-loading":Hs.loading,"display-mode":"summary",onPageChanged:Bs.handlePageChanged},null,8,["current-page","total-items","total-pages","limit-items","data-loading","onPageChanged"])])]),(0,a.bF)(o.eB,{name:"toast-slide"},{default:(0,a.k6)((()=>[Hs.showProgressToast&&Bs.progressiveLoadingStats&&Bs.progressiveLoadingStats.percentage<100?((0,a.uX)(),(0,a.CE)("div",ks,[(0,a.Lk)("div",_s,[(0,a.Lk)("div",$s,[(0,a.bF)(Js,{icon:["fas","list"],class:"text-blue-200"}),(0,a.Lk)("span",Ls," แสดง "+(0,r.v_)(Bs.progressiveLoadingStats.showing)+" / "+(0,r.v_)(Bs.progressiveLoadingStats.total)+" รายการ ",1)]),(0,a.Lk)("div",ws,[(0,a.Lk)("div",{class:"bg-white h-1.5 rounded-full transition-all duration-300",style:(0,r.Tr)(`width: ${Bs.progressiveLoadingStats.percentage}%`)},null,4)]),(0,a.Lk)("span",Cs,(0,r.v_)(Bs.progressiveLoadingStats.percentage)+"%",1),Bs.hasMoreItems?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[22]||(t[22]=(...e)=>Bs.showAllItems&&Bs.showAllItems(...e)),class:"text-xs px-2 py-1 bg-white bg-opacity-20 rounded hover:bg-opacity-30 transition-colors"}," ทั้งหมด ")):(0,a.Q3)("",!0)])])):(0,a.Q3)("",!0)])),_:1}),Hs.lightboxOpen?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 z-50",onClick:t[25]||(t[25]=(0,o.D$)((e=>Hs.lightboxOpen=!1),["self"]))},[(0,a.Lk)("div",Is,[(0,a.Lk)("button",{onClick:t[23]||(t[23]=e=>Hs.lightboxOpen=!1),class:"absolute top-0 right-0 m-2 text-white text-xl font-semibold leading-none bg-transparent border-0 cursor-pointer z-10"}," × "),(0,a.Lk)("img",{src:Hs.selectedImageUrl,alt:"Selected image",class:"max-w-full max-h-full",onClick:t[24]||(t[24]=(0,o.D$)((()=>{}),["stop"]))},null,8,Ts)])])):(0,a.Q3)("",!0),Hs.isModalOpen?((0,a.uX)(),(0,a.CE)("div",Ds,[(0,a.Lk)("div",Ss,[(0,a.Lk)("div",Es,[(0,a.Lk)("div",As,[(0,a.Lk)("div",Ps,[(0,a.Lk)("div",Ns,[(0,a.bF)(Js,{icon:["fas","user-plus"],class:"text-white text-sm"})]),t[96]||(t[96]=(0,a.Lk)("div",null,[(0,a.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"เพิ่มผู้ลงทะเบียน"),(0,a.Lk)("p",{class:"text-xs text-gray-500"},"เพิ่มผู้ลงทะเบียนหลักสูตรนี้")],-1))]),(0,a.Lk)("button",{onClick:t[26]||(t[26]=(...e)=>Bs.closeModal&&Bs.closeModal(...e)),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[(0,a.bF)(Js,{icon:["fas","times"],class:"text-xl"})])]),(0,a.Lk)("div",Os,[(0,a.Lk)("button",{onClick:t[27]||(t[27]=e=>Bs.selectTab("csv")),class:(0,r.C4)(["csv"===Hs.selectedTab?"bg-white border-gray-200":"bg-gray-200","px-4 py-2 border rounded-t-md text-sm"])}," Upload CSV ",2),(0,a.Lk)("button",{onClick:t[28]||(t[28]=e=>Bs.selectTab("manual")),class:(0,r.C4)(["manual"===Hs.selectedTab?"bg-white border-gray-200":"bg-gray-200","px-4 py-2 border rounded-t-md text-sm"])}," Input Manual ",2)])]),(0,a.Lk)("div",js,["csv"===Hs.selectedTab?((0,a.uX)(),(0,a.CE)("div",Xs,[(0,a.Lk)("input",{type:"file",onChange:t[29]||(t[29]=(...e)=>Bs.handleFileUpload&&Bs.handleFileUpload(...e)),accept:".csv",class:"mb-4"},null,32),Hs.csvData.length>0?((0,a.uX)(),(0,a.CE)("div",Ms,[t[97]||(t[97]=(0,a.Lk)("h3",{class:"text-base font-semibold mb-2"},"ข้อมูลตัวอย่าง",-1)),(0,a.Lk)("div",Qs,[(0,a.Lk)("table",Fs,[(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(Hs.csvData,((e,t)=>((0,a.uX)(),(0,a.CE)("tr",{key:t},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e,((e,t)=>((0,a.uX)(),(0,a.CE)("td",{key:t,class:"border px-4 py-2 text-sm"},(0,r.v_)(e),1)))),128))])))),128))])])])])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),"manual"===Hs.selectedTab?((0,a.uX)(),(0,a.CE)("div",Rs,[t[102]||(t[102]=(0,a.Lk)("h3",{class:"text-base font-semibold mb-4"},"ข้อมูลผู้เข้าอบรม",-1)),(0,a.Lk)("div",Us,[(0,a.Lk)("div",null,[t[98]||(t[98]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ชื่อจริง",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[30]||(t[30]=e=>Hs.manualInput.firstname=e),placeholder:"กรอกชื่อจริง",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[o.Jo,Hs.manualInput.firstname]])]),(0,a.Lk)("div",null,[t[99]||(t[99]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"นามสกุล",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[31]||(t[31]=e=>Hs.manualInput.lastname=e),placeholder:"กรอกนามสกุล",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[o.Jo,Hs.manualInput.lastname]])]),(0,a.Lk)("div",null,[t[100]||(t[100]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"เบอร์โทร",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[32]||(t[32]=e=>Hs.manualInput.phone=e),placeholder:"กรอกเบอร์โทร",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[o.Jo,Hs.manualInput.phone]])]),(0,a.Lk)("div",null,[t[101]||(t[101]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"อีเมล",-1)),(0,a.bo)((0,a.Lk)("input",{type:"email","onUpdate:modelValue":t[33]||(t[33]=e=>Hs.manualInput.email=e),placeholder:"กรอกอีเมล",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[o.Jo,Hs.manualInput.email]])])])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",Vs,[(0,a.Lk)("button",{onClick:t[34]||(t[34]=(...e)=>Bs.closeModal&&Bs.closeModal(...e)),class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors"}," ยกเลิก "),"csv"===Hs.selectedTab?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[35]||(t[35]=(...e)=>Bs.processCSV&&Bs.processCSV(...e)),class:"inline-flex items-center rounded-lg border border-transparent bg-blue-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(Js,{icon:["fas","upload"],class:"mr-1.5"}),t[103]||(t[103]=(0,a.eW)(" ดำเนินการ CSV "))])):(0,a.Q3)("",!0),"manual"===Hs.selectedTab?((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:t[36]||(t[36]=(...e)=>Bs.processManualInput&&Bs.processManualInput(...e)),class:"inline-flex items-center rounded-lg border border-transparent bg-blue-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(Js,{icon:["fas","save"],class:"mr-1.5"}),t[104]||(t[104]=(0,a.eW)(" ดำเนินการ Manual "))])):(0,a.Q3)("",!0)])])])):(0,a.Q3)("",!0)])])):((0,a.uX)(),(0,a.CE)("div",n,[(0,a.bF)(qs)]))])}s(98992),s(54520),s(72577),s(3949),s(81454),s(37550),s(14603),s(47566),s(98721);var Hs=s(40475),Bs=s(75435),Ws=s(38558),qs=s(86530),Js=s(9964),Gs=s(63084),Ks=s(21396),Zs=s.n(Ks),Ys=s(73288),ea={props:{pageTitle:{type:String,default:()=>""},isPublic:Boolean,courseData:Object,callParentFunctionProp:Function,tabs:Object,updateTabs:Object},data(){const e=Hs.A.get("session"),t=Hs.A.get("configs");return{videoLoaded:[],lazy:!0,initialDisplayCount:20,loadMoreCount:10,currentDisplayCount:20,isLoadingMore:!1,scrollCleanup:null,showProgressToast:!1,scrollTimeout:null,open:!1,dataItem:this.$route.params.id,school:e&&e.current&&e.current._id||t&&t.siteID,login:e.login,isModalOpen:!1,csvData:[],editingCell:null,listItems:[],reportData:[],loadSummary:!1,lightboxOpen:!1,selectedImageUrl:null,summary:{complete_13:"N/A",processing_0:"N/A",no_analytics_data:"N/A",complete_between_1_and_12:"N/A",verified_true:"N/A",verified_false:"N/A",verified_all:"N/A",exam_round_1:"N/A",exam_round_2:"N/A",cert_5_year:"N/A",cert_3_year:"N/A",cert_zone_1:"N/A",total_entries:"N/A",no_analytics_data_exam_round_1:"N/A",complete_13_exam_round_1:"N/A",no_analytics_data_exam_round_2:"N/A",complete_13_exam_round_2:"N/A"},categoryData:[],loading_sources:!0,endpoint:"",master:e.master,accessToken:Hs.A.get("session","token"),configs:Hs.A.get("configs"),session:Hs.A.get("session"),limitItem:10,limitOptions:[1,10,50,100,200,500,1e3,2e3,3e3,4e3],currentPage:1,totalPages:0,totalItems:0,loading:!1,showingOverlay:!1,searchQuery:"",statusFilter:"all",isCreatingUser:!1,isShowingOverlay:!1,loadingMessage:"",processingCount:"",debounceTimer:null,activeBlock:!1,scb:[],isProcessing:!1,selectedTab:"csv",manualInput:{firstname:"",lastname:"",citizen:null,phone:"",email:"",username:"",password:"",parent:e&&e.current&&e.current._id||t&&t.siteID,salt:"",role:"user",info:{prefix:"",sex:"",bu_type:"",bu_name:"",position:""}},prefixMapping:{mrs:"นาง",mis:"นางสาว",mr:"นาย"},sexMapping:{male:"ชาย",female:"หญิง",other:"ไม่ระบุ"},educationMapping:{standard_bachelor:"ปริญญาตรี",upper_bachelor:"สูงกว่าปริญญาตรี",under_bachelor:"ต่ำกว่าปริญญาตรี"},processName:"Enroll Processing",progressText:"",progressTotal:0,progressCurrent:0,startTime:null,endTime:null,layoutVisibility:{order:!0,enroll:!0},cert_area:[{id:"1",value:"สำนักวิจัยและพัฒนาการเกษตรเขตที่ 1"},{id:"2",value:"สำนักวิจัยและพัฒนาการเกษตรเขตที่ 2"},{id:"3",value:"สำนักวิจัยและพัฒนาการเกษตรเขตที่ 3"},{id:"4",value:"สำนักวิจัยและพัฒนาการเกษตรเขตที่ 4"},{id:"5",value:"สำนักวิจัยและพัฒนาการเกษตรเขตที่ 5"},{id:"6",value:"สำนักวิจัยและพัฒนาการเกษตรเขตที่ 6"},{id:"7",value:"สำนักวิจัยและพัฒนาการเกษตรเขตที่ 7"},{id:"8",value:"สำนักวิจัยและพัฒนาการเกษตรเขตที่ 8"},{id:"9",value:"สำนักควบคุมพืชและวัสดุการเกษตร กรุงเทพมหานคร"}],cert_age:[{id:"3",value:"จำหน่ายสารไกลโฟเซต"},{id:"5",value:"ไม่จำหน่ายสารไกลโฟเซต"}]}},components:{Loader:Bs.A,Pagination:Ws.A,BatchProgress:qs.A},methods:{async loadMoreItems(){!this.isLoadingMore&&this.hasMoreItems&&(this.isLoadingMore=!0,await new Promise((e=>setTimeout(e,300))),this.currentDisplayCount=Math.min(this.currentDisplayCount+this.loadMoreCount,this.listItems.length),this.isLoadingMore=!1)},setupScrollDetection(){if(!this.lazy)return;const e=this.debounce((()=>{if(this.isLoadingMore||!this.hasMoreItems)return;const e=[window,document.documentElement,document.body];for(const t of e){const e=t===window?Math.max(document.documentElement.scrollHeight,document.body.scrollHeight):t.scrollHeight,s=t===window?window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop,a=t===window?window.innerHeight:t.clientHeight;if(s+a>=.8*e){this.loadMoreItems();break}}}),100),t=["scroll","wheel"],s=[window,document,document.body];s.forEach((s=>{t.forEach((t=>{s.addEventListener(t,e,{passive:!0})}))})),this.scrollCleanup=()=>{s.forEach((s=>{t.forEach((t=>{s.removeEventListener(t,e)}))}))}},resetDisplayCount(){const e=this.listItems.length;this.limitItem<=50?this.initialDisplayCount=Math.min(25,e):this.limitItem<=100?this.initialDisplayCount=Math.min(50,e):this.limitItem<=500?this.initialDisplayCount=Math.min(100,e):this.initialDisplayCount=Math.min(200,e),this.currentDisplayCount=this.initialDisplayCount,this.$nextTick((()=>{this.setupScrollDetection(),this.setupScrollToastDetection()}))},setupScrollToastDetection(){const e=()=>{!this.progressiveLoadingStats||this.progressiveLoadingStats.percentage>=100||(this.showProgressToast=!0,this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout((()=>{this.showProgressToast=!1}),2e3))},t=[window,document,document.body];t.forEach((t=>{t.addEventListener("scroll",e,{passive:!0})}));const s=()=>{t.forEach((t=>{t.removeEventListener("scroll",e)})),this.scrollTimeout&&(clearTimeout(this.scrollTimeout),this.scrollTimeout=null)},a=this.scrollCleanup;this.scrollCleanup=()=>{a&&a(),s()}},showAllItems(){this.currentDisplayCount=this.listItems.length,this.scrollCleanup&&(this.scrollCleanup(),this.scrollCleanup=null)},debounce(e,t){let s;return function(...a){const r=()=>{clearTimeout(s),e(...a)};clearTimeout(s),s=setTimeout(r,t)}},saveLazyPreference(){try{localStorage.setItem("enrollDashboard_lazyLoading",JSON.stringify(this.userLazyPreference))}catch(e){console.warn("Failed to save lazy loading preference:",e)}},loadLazyPreference(){try{const e=localStorage.getItem("enrollDashboard_lazyLoading");null!==e&&(this.userLazyPreference=JSON.parse(e),this.lazy=this.userLazyPreference)}catch(e){console.warn("Failed to load lazy loading preference:",e)}},async bypassContent(e){try{const t=e._id,s=`https://gateway.cloudrestfulapi.com/api/enroll/${t}`,a=e.analytics.bypass,r={data:{analytics:{...e.analytics,bypass:!a}},options:{}},o=await fetch(s,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify(r)});if(!o.ok)throw new Error("Failed to update content bypass");await this.getData({field:"form.createdAt",order:-1})}catch(t){console.error("Error updating content bypass:",t),this.$toast.error("Failed to update content bypass")}},loadVideo(e,t){this.videoLoaded[t]=!0,this.$nextTick((()=>{const e=this.$refs[`videoElement-${t}`];e&&e.length>0?(e[0].load(),e[0].play()):console.error(`Video element not found for index: ${t}`)}))},captureFrame(e,t){if(!e)return void console.error(`Video element not found for index: ${t}`);const s=document.createElement("canvas");s.width=e.videoWidth,s.height=e.videoHeight;const a=s.getContext("2d");try{a.drawImage(e,0,0,s.width,s.height);const r=s.toDataURL();this.items[t].posterUrl=r}catch(r){console.error("Error capturing frame:",r)}},progressBarColor(e){return e<25?"bg-red-600":e<50?"bg-orange-600":e<75?"bg-yellow-600":"bg-green-600"},openLightbox(e){this.selectedImageUrl=e,this.lightboxOpen=!0},isValidVideoUrl(e){return e&&e.endsWith(".webm")},generateRandomIPv4(){const e=()=>Math.floor(256*Math.random());return`${e()}.${e()}.${e()}.${e()}`},formatNumber(e){return Js.A.formatNumber(e)},calculateSummary(){this.summary={complete_13:0,processing_0:0,verified_true:0,verified_false:0,exam_round_1:0,exam_round_2:0,cert_3_year:0,cert_5_year:0,cert_zone_1:0},this.listItems.forEach((e=>{const{analytics:t,verified:s,form:a}=e.enroll,r=a?.formData;13===t?.complete&&this.summary.complete_13++,0===t?.processing&&this.summary.processing_0++,!0===s?.pre?.status&&null!==s?.pre?.url&&""!==s?.pre?.url?this.summary.verified_true++:this.summary.verified_false++,"round-1"===r?.["radiobox-14-0-9"]?.value?.value&&this.summary.exam_round_1++,"round-2"===r?.["radiobox-14-0-9"]?.value?.value&&this.summary.exam_round_2++,"5-year"===r?.["radiobox-24-10-10"]?.value?.value&&this.summary.cert_5_year++,"3-year"===r?.["radiobox-24-10-10"]?.value?.value&&this.summary.cert_3_year++,"zone-1"===r?.["radiobox-25-10-10"]?.value?.value&&this.summary.cert_zone_1++}))},toggleVideoPlay(){const e=this.$refs.videoElement;this.isPlaying?(e.pause(),this.isPlaying=!1):(e.play(),this.isPlaying=!0)},async callbackFunction(){try{Gs.A.log("callbackFunction"),await this.getData()}catch(e){console.error(e)}},updateBadge(e){Gs.A.log(e),this.$emit("update-badge",{code:this.tabs.code,badge:e})},isEditing(e,t){return null!==this.editingCell&&this.editingCell.rowIndex===e&&this.editingCell.cellIndex===t},startEditing(e,t){this.editingCell={rowIndex:e,cellIndex:t}},stopEditing(e,t){this.editingCell=null,Gs.A.log(e,t)},selectTab(e){this.selectedTab=e},assignUserModal(){this.isModalOpen=!0},closeModal(){document.body.classList.remove("body-scroll-lock"),this.isModalOpen=!1},handleFileUpload(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{const t=e.target.result;this.parseCSV(t)},e.readAsText(t)}},parseCSV(e){const t=e.split("\n"),s=[];for(let a=0;a<t.length;a++){const e=t[a].split(",");s.push(e)}this.csvData=s},openCSVModal(){document.body.classList.add("body-scroll-lock"),this.csvModalOpen=!0},async processManualInput(){try{const e=Zs().lib.WordArray.random(16),t=Zs().SHA256(this.manualInput.password+e).toString(),s={firstname:this.manualInput.firstname,lastname:this.manualInput.lastname,citizen:null,phone:this.manualInput.phone,email:this.manualInput.email,username:this.manualInput.username,password:t,parent:this.session.current._id,salt:e.toString(),role:"user",info:{prefix:this.manualInput.info.prefix,bu_type:this.manualInput.info.bu_type,bu_name:this.manualInput.info.bu_name,position:this.manualInput.info.position}},a=await fetch("https://gateway.cloudrestfulapi.com/api/user/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:s})});if(200===a.status){const e=await a.json(),t=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{userID:e._id,courseID:this.dataItem},options:{}})});if(200===t.status){const e=await t.json();await fetch("https://gateway.cloudrestfulapi.com/api/course/"+this.dataItem+"/enroll",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({action:"add",element:e._id,type:"string"})})}}this.isModalOpen=!1,await this.getData(),await this.getCourse(),this.fetchData()}catch(e){console.error("Error processing manual input:",e)}},async processCSV(){try{for(const e of this.csvData){const t=Zs().lib.WordArray.random(16),s=Zs().SHA256(e[6]+t).toString(),a={firstname:e[3],lastname:e[4],citizen:null,phone:e[6],email:e[7],username:e[7],password:s,parent:this.session.current._id,salt:t.toString(),role:"user",info:{}};e[2]&&(a.info.prefix=e[2]),e[1]&&(a.info.bu_type=e[1]),e[0]&&(a.info.bu_name=e[0]),e[5]&&(a.info.position=e[5]);const r=await fetch("https://gateway.cloudrestfulapi.com/api/user/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:a})});if(200===r.status){const e=await r.json(),t=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{userID:e._id,courseID:this.dataItem},options:{}})});if(200===t.status){const e=await t.json();await fetch("https://gateway.cloudrestfulapi.com/api/course/"+this.dataItem+"/enroll",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({action:"add",element:e._id,type:"string"})})}}}this.isModalOpen=!1,await this.getData(),await this.getCourse(),this.fetchData()}catch(e){console.error("Error processing CSV:",e)}},togglePanel(){this.open=!this.open},closePanel(){this.open=!1},leadingZero(e){return e<10?"0"+e:e.toString()},getCertAreaValue(e){const t=this.cert_area.find((t=>t.id===e));return t?t.value:""},getCertAgeValue(e){const t=this.cert_age.find((t=>t.id===e));return t?t.value:""},async fetchData(){try{const e=await fetch("https://vue-project.sgp1.digitaloceanspaces.com/Demo3/convertcsv_3155.json");if(!e.ok)throw new Error("Network response was not ok");const t=await e.json();this.scb=t}catch(e){console.error("Error fetching data:",e.message)}},searchData(e,t){const s=e,a=this.searchSCBData(s);a&&this.updateOrderStatus(t),Gs.A.log("Result:",a)},searchSCBData(e){const t=this.scb.some((t=>t.id1===e));return t},exportToCSV(){const e=this.listItems.map(((e,t)=>{const s={"#":(this.currentPage-1)*this.limitItem+t+1,"สถานะ":e.order?.status||"","หลักสูตรที่ลงทะเบียน":this.courseData?.name||"",Ref_No_1:e.order?.ref1||"",Ref_No_2:e.order?.ref2||"",Ref_No_3:e.order?.ref3||"","คำนำหน้า":this.prefixMapping[e.user.info.prefix]||"","ผู้ซื้อ":(this.prefixMapping[e.user.info.prefix]||"")+" "+e.user.firstname+" "+e.user.lastname,"ชื่อ":e.user?.firstname||"","นามสกุล":e.user?.lastname||"","หมายเลขบัตรประชาชน":e.user?.citizen||"","รหัสใบรับรอง":e.user?.token||"","เบอร์โทร":e.user?.phone||"","อีเมล์":e.user?.email||"","ช่องทางการชำระเงิน":e.order?.payment||"","วุฒิการศึกษา":this.educationMapping[e.user.info.education]||"","หมายเลขใบรับรอง":e.user?.citizen?"66/01/"+e.user.citizen:"","วันออกใบรับรอง":"first"===e.order?.enroll?.analytics?.option?.exam_round?"17 มี.ค. พ.ศ. 2566":"28 ก.พ. พ.ศ. 2566","วันหมดอายุ":"first"===e.order?.enroll?.analytics?.option?.exam_round?"16 มี.ค. พ.ศ. 2571":"27 ก.พ. พ.ศ. 2571","Certification URL":e.user?.token?"https://doa.fti.or.th/certification-force?token="+e.user.token+"&session=220":"","รูปประจำตัว":e.user?.avatar_img||"",Column_11:"ที่อยู่จัดส่งใบเสร็จ/หนังสือ","เลขที่":e.order?.address?.delivery?"เลขที่"+e.order.address.delivery.address.mailinG_NO:"","หมู่ที่":e.order?.address?.delivery?e.order.address.delivery.address.mailinG_MOO:"","ซอย":e.order?.address?.delivery?e.order.address.delivery.address.mailinG_SOI_TH:"","อาคาร":e.order?.address?.delivery?e.order.address.delivery.address.mailinG_BUILDING_TH:"","ถนน":e.order?.address?.delivery?e.order.address.delivery.address.mailinG_ROAD_TH:"","ตำบล":e.order?.address?.delivery?e.order.address.delivery.address.mailinG_SUB_DISTRICT_TH:"","อำเภอ":e.order?.address?.delivery?e.order.address.delivery.address.mailinG_DISTRICT_TH:"","จังหวัด":e.order?.address?.delivery?e.order.address.delivery.province:"","รหัสไปรษณีย์":e.order?.address?.delivery?e.order.address.delivery.zipcode:"",_2:"ที่อยู่ออกใบเสร็จ","เลขที่2":e.order?.address?.invoice?"เลขที่"+e.order.address.invoice.address.officE_NO:"","หมู่ที่2":e.order?.address?.invoice?e.order.address.invoice.address.officE_MOO:"","ซอย2":e.order?.address?.invoice?e.order.address.invoice.address.officE_SOI_TH:"","อาคาร2":e.order?.address?.invoice?e.order.address.invoice.address.officE_BUILDING_TH:"","ถนน2":e.order?.address?.invoice?e.order.address.invoice.address.officE_ROAD_TH:"","ตำบล2":e.order?.address?.invoice?e.order.address.invoice.address.officE_SUB_DISTRICT_TH:"","อำเภอ2":e.order?.address?.invoice?e.order.address.invoice.address.officE_DISTRICT_TH:"","จังหวัด2":e.order?.address?.invoice?e.order.address.invoice.province:"","รหัสไปรษณีย์2":e.order?.address?.invoice?e.order.address.invoice.zipcode:"",_3:"ที่อยู่นิติบุคคล","เลขที่ประจำตัวผู้เสียภาษี":e.order?.address?.tax?e.order.address.tax.address.taX_ID:"","ชื่อนิติบุคคล":e.order?.address?.tax?e.order.address.tax.address.owneR_NAME_TH:"","เลขที่3":e.order?.address?.tax?"เลขที่"+e.order.address.tax.address.taX_NO:"","หมู่ที่3":e.order?.address?.tax?e.order.address.tax.address.taX_MOO:"","ซอย3":e.order?.address?.tax?e.order.address.tax.address.taX_SOI_TH:"","อาคาร3":e.order?.address?.tax?e.order.address.tax.address.taX_BUILDING_TH:"","ถนน3":e.order?.address?.tax?e.order.address.tax.address.taX_ROAD_TH:"","ตำบล3":e.order?.address?.tax?e.order.address.tax.address.taX_SUB_DISTRICT_TH:"","อำเภอ3":e.order?.address?.tax?e.order.address.tax.address.taX_DISTRICT_TH:"","จังหวัด3":e.order?.address?.tax?e.order.address.tax.province:"","รหัสไปรษณีย์3":e.order?.address?.tax?e.order.address.tax.zipcode:"","วันที่สั่งซื้อ":e.order?.adddate||"","วันที่อนุมัติ":e.order?.updatedAt||"","ใบเสร็จ":"online"===e.order?.bill?"ออนไลน์":"ตัวจริง","ประเภทผู้ซื้อ":"personal"===e.order?.receipt?"บุคคลธรรมดา":"นิติบุคคล","ความคืบหน้า":e?.enroll?.analytics?.complete||"0","บทเรียน":e?.enroll?.analytics?.total||"14","คะแนนก่อนเรียน":e?.enroll?.analytics?.pre?.score||"0","คะแนนหลังเรียน":e?.enroll?.analytics?.post?.score||"0","คะแนนสอบซ่อม":e?.enroll?.analytics?.retest?.score||"0","ผลการเรียน":e?.enroll?.analytics?.post?.score||e?.enroll?.analytics?.retest?.score?(e?.enroll?.analytics?.post?.score??0)>33||(e?.enroll?.analytics?.retest?.score??0)>33?"ผ่านการประเมิน":"ไม่ผ่านการประเมิน":"ไม่ได้สอบ"};return s}));let t="";const s=Object.keys(e[0]);t+=s.join(",")+"\n",e.forEach((e=>{const a=s.map((t=>t in e?e[t]:""));t+=a.join(",")+"\n"}));const a=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.setAttribute("href",URL.createObjectURL(a)),r.setAttribute("download",this.courseData.name+"_exportdata_"+this.courseData._id+".csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},formatDeliveryAddress(e){const t={mailinG_NO:"เลขที่",mailinG_MOO:"หมู่ที่",mailinG_ROAD_TH:"ถนน",mailinG_SOI_TH:"ซอย",mailinG_BUILDING_TH:"อาคาร/ตึก",mailinG_SUB_DISTRICT_TH:"ตำบล/แขวง",mailinG_DISTRICT_TH:"อำเภอ/เขต"};return this.getAddressString(e,t)},formatInvoiceAddress(e){Gs.A.log(e);const t={officE_NO:"เลขที่",officE_MOO:"หมู่ที่",officE_ROAD_TH:"ถนน",officE_SOI_TH:"ซอย",officE_BUILDING_TH:"อาคาร/ตึก",officE_SUB_DISTRICT_TH:"ตำบล/แขวง",officE_DISTRICT_TH:"อำเภอ/เขต"};return this.getAddressString(e,t)},formatTaxAddress(e){const t={taX_NO:"เลขที่",taX_MOO:"หมู่ที่",taX_ROAD_TH:"ถนน",taX_SOI_TH:"ซอย",taX_BUILDING_TH:"อาคาร/ตึก",taX_SUB_DISTRICT_TH:"ตำบล/แขวง",taX_DISTRICT_TH:"อำเภอ/เขต"};return this.getAddressString(e,t)},getAddressString(e,t){const s=[];Object.keys(t).forEach((a=>{if(e&&a in e&&e[a])if("object"===typeof e[a]){const r=Object.values(e[a]).join(" ");r.trim().length>0&&s.push(`${t[a]} ${r}`)}else s.push(`${t[a]} ${e[a]}`)}));const a=s.join(" ");return a.length>0?a:"ไม่มีข้อมูลที่อยู่"},formatThaidate(e){return Js.A.toThaiDatetime(e,"short")},handleLimitChange(){const e=Hs.A.get("session");e.limitItem=this.limitItem,Hs.A.set("session",e),this.currentPage=1,e.currentPage=this.currentPage,Hs.A.set("session",e);const t=new URLSearchParams(window.location.search);t.set("page",e.currentPage);const s=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",s),Gs.A.log("getdata","handleLimitChange"),this.getData(),this.resetProgressToast(),this.$nextTick((()=>{this.resetDisplayCount()}))},handlePageChanged(e){if(e!==this.currentPage){window.scrollTo(0,0),this.currentPage=e;const t=Hs.A.get("session");t.currentPage=this.currentPage,Hs.A.set("session",t),Gs.A.log("getdata","handlePageChanged"),this.getData(),this.resetProgressToast(),this.$nextTick((()=>{this.resetDisplayCount()}))}},clearSearchQuery(){this.searchQuery="";const e=Hs.A.get("session");e.searchQuery="",Hs.A.set("session",e),Gs.A.log("getdata","clearSearchQuery"),this.getData()},async callAPI(e){try{const t=`https://faas-sgp1-18bc02ac.doserverless.co/api/v1/web/fn-3bf765c8-bb4f-4bac-ba41-9698000f7334/default/getstudentdata?id=${e}`,s=await fetch(t),a=await s.json();Gs.A.log(a)}catch(t){Gs.A.log(t)}},async getCourse(){try{const e=await fetch(`https://gateway.cloudrestfulapi.com/api/course/${this.dataItem}`,{method:"GET",headers:{"Content-Type":"application/json","client-token-key":this.configs.key}}),t=await e.json();200===e.status&&Gs.A.log(t)}catch(e){console.error(e)}},async executeCustomQueries(e,t){const s=`\n          SELECT *\n          FROM transaction\n          WHERE transaction.transaction_token = '${e}'\n        `,a="",r={query:{mainQuery:s,countQuery:a}};try{const e=await fetch("https://multisource-api-edsdv.ondigitalocean.app/api/GOLqSG7QyA10uoasyN9x/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify(r)}),s=await e.json();let a=s.data[0];Gs.A.log("responseData",s.data[0]),await this.updateOrder(t,a.get_bill,a.receipt_type)}catch(o){console.error(o)}},async executemarketplaceQueries(e,t){const s=`\n          SELECT *\n          FROM marketplace\n          WHERE marketplace.order_ref_no = '${e}'\n        `,a="",r={query:{mainQuery:s,countQuery:a}};try{const e=await fetch("https://multisource-api-edsdv.ondigitalocean.app/api/04ZQdW5sGA9C9eXXXk6x/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify(r)}),s=await e.json();let a=s.data[0];Gs.A.log("responseData",s.data[0]);const o={delivery:{province:a.order_delivery_province},invoice:{province:a.order_invoice_province},tax:{province:a.order_tax_province}};await this.updateProvince(t,o)}catch(o){console.error(o)}},async executemarketplaceQueriesPersonal(e,t){const s=`\n          SELECT *\n          FROM marketplace\n          WHERE marketplace.order_ref_no = '${e}'\n        `,a="",r={query:{mainQuery:s,countQuery:a}};try{const e=await fetch("https://multisource-api-edsdv.ondigitalocean.app/api/04ZQdW5sGA9C9eXXXk6x/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify(r)}),s=await e.json();let a=s.data[0];Gs.A.log("responseData",s.data[0]);const o={delivery:{province:a.order_delivery_province},invoice:{province:a.order_invoice_province},tax:{province:a.order_invoice_province,zipcode:a.order_invoice_zipcode}};await this.updateProvince(t,o)}catch(o){console.error(o)}},isImageValid(e){const t=new Image;return t.src=e,t.complete&&0!==t.naturalWidth},modifyURL(e){return e.includes("https://doa-academy.sgp1.digitaloceanspaces.com/https://doa-academy.sgp1.digitaloceanspaces.com/https://doa-academy.sgp1.digitaloceanspaces.com/Upload/")?e.replace("https://doa-academy.sgp1.digitaloceanspaces.com/https://doa-academy.sgp1.digitaloceanspaces.com/https://doa-academy.sgp1.digitaloceanspaces.com/Upload/","https://doa-academy.sgp1.digitaloceanspaces.com/Upload/"):e.includes("https://doa-academy.sgp1.digitaloceanspaces.com/https://doa-academy.sgp1.digitaloceanspaces.com/1639435666414290693/")?e.replace("https://doa-academy.sgp1.digitaloceanspaces.com/https://doa-academy.sgp1.digitaloceanspaces.com/1639435666414290693/","https://content.fti.academy/doa-academy/1639435666414290693/"):e.includes("1639435666414290693/")&&e.includes("https://doa-academy.sgp1.digitaloceanspaces.com")?e.replace("https://doa-academy.sgp1.digitaloceanspaces.com","https://content.fti.academy/doa-academy"):e.includes("1639435666414290693/")&&!e.includes("https://doa-academy.sgp1.digitaloceanspaces.com")?`https://content.fti.academy/doa-academy/${e}`:(e=`https://doa-academy.sgp1.digitaloceanspaces.com/${e}`,e)},async executUserQueries(e,t){const s=`\n        SELECT  student_idcard AS Card,student_avatar AS Profile\n        FROM    student\n        WHERE   student_id = '${e}'\n        `,a="",r={query:{mainQuery:s,countQuery:a}};try{const e=await fetch("https://multisource-api-edsdv.ondigitalocean.app/api/04ZQdW5sGA9C9eXXXk6x/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify(r)}),s=await e.json();Gs.A.log("responseData",s.data[0]);let a=this.modifyURL(s.data[0].Profile),o=this.modifyURL(s.data[0].Card);await this.updateProfile(t,o,a),Gs.A.log("id",t)}catch(o){console.error(o)}},async createUserCourse(e,t,s){const a={student:e,lesson:t};try{const e=await fetch("https://api.fti.academy/api/firebase/setup",{method:"POST",headers:{"API-KEY":"5CB584F5ECFD7","SECRET-KEY":"6A5891C7352197F8A5CE8A9B67EF3","Content-Type":"application/json"},body:JSON.stringify(a)});await e.json(),await this.confirmTransaction(s),this.status=!0}catch(r){console.error("Error creating user course:",r)}},async confirmTransaction(e){const t=`https://api.fti.academy/api/connection/confirm/${e}`,s={"API-KEY":"5CB584F5ECFD7","SECRET-KEY":"6A5891C7352197F8A5CE8A9B67EF3","Content-Type":"application/json"};try{const e=await fetch(t,{method:"GET",headers:s});await e.json()}catch(a){console.error("Error confirming transaction:",a)}},async updateOrderStatus(e){try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/order/"+e,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{status:"ชำระเงินแล้ว"},options:{}})}),s=await t.json();Gs.A.log(s),200===t.status&&Gs.A.log("order : "+e+" Update Success!!")}catch(t){Gs.A.log(t)}},async updateOrder(e,t,s){try{const a=await fetch("https://gateway.cloudrestfulapi.com/api/order/"+e,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{bill:t,receipt:s},options:{}})}),r=await a.json();Gs.A.log(r),200===a.status&&Gs.A.log("order : "+e+" Update Success!!")}catch(a){Gs.A.log(a)}},async updateProfile(e,t,s){try{const a=await fetch("https://gateway.cloudrestfulapi.com/api/user/"+e,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{card_img:t,avatar_img:s},options:{}})});await a.json(),200===a.status&&Gs.A.log("user : "+e+" Update Success!!")}catch(a){Gs.A.log(a)}},async updateOrderEnroll(e,t){try{const s=await fetch("https://gateway.cloudrestfulapi.com/api/order/"+e,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{enrollID:t},options:{}})});await s.json(),200===s.status&&Gs.A.log("order : "+e+" Update Success!!")}catch(s){Gs.A.log(s)}},async updateProvince(e,t){try{const s=["delivery","invoice","tax"];for(const a of s){const s=t[a],r=s.province,o=s.zipcode;if(void 0!==r&&null!==r&&""!==r){const t=await fetch(`https://gateway.cloudrestfulapi.com/api/order/${e}`,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{[`address.${a}.province`]:r,[`address.${a}.zipcode`]:o},options:{}})}),s=await t.json();Gs.A.log(s),200===t.status&&Gs.A.log(`Province (${a}) for order ${e} updated successfully!!`)}}}catch(s){Gs.A.log(s)}},async resetScore(e,t,s,a){try{console.log(s);const r=await this.$Request.POST("score/query",{method:"find",hidden:["userID"],args:[{$and:[{userID:t,examID:e}]}]},this.configs.key),{data:o,status:i}=r;200===i&&o.length>0?Ys.A.confirm({title:"คุณต้องการลบการสอบ?",message:"ลบข้อสอบออกจากผู้อบรม !",confirm:async()=>{try{const e=await this.$Request.DELETE(`score/${o[0]._id}`,null,this.configs.key),{data:t}=e;if(t){Gs.A.log(t);let e=s&&s.verified?{...s.verified}:{};"pre"===a?e={pre:{},post:e.post||{}}:"post"===a&&(e={pre:e.pre||{},post:{}}),s.verified=e;const r={data:{verified:s.verified}},{status:o}=await this.$Request.PUT(`enroll/${s._id}`,r,this.configs.key);Gs.A.log(o),await this.getData()}}catch(e){Gs.A.log(e)}},cancel:()=>{}}):Ys.A.prompt({title:"เกิดข้อผิดพลาด",message:"ไม่สามารถลบได้ !",confirm:async()=>{},cancel:()=>{}})}catch(r){console.error("Error confirming transaction:",r)}},async bypassVerified(e,t){try{const s=new Date,a=s.toISOString();Ys.A.confirm({title:"คุณต้องการ Bypass ระบบ Verified?",message:"ตั้งให้ผู้อบรมไม่ต้อง Verified !",confirm:async()=>{try{let s=e&&e.verified?{...e.verified}:{};"pre"===t?(s.pre={...s.pre,status:!0,url:`bypass-${a}`},s.post=s.post||{}):"post"===t&&(s.pre=s.pre||{},s.post={...s.post,status:!0,url:`bypass-${a}`}),e.verified=s;const r={data:{verified:e.verified}},{status:o}=await this.$Request.PUT(`enroll/${e._id}`,r,this.configs.key);Gs.A.log(o),await this.getData()}catch(s){Gs.A.log(s)}},cancel:()=>{}})}catch(s){console.error("Error confirming transaction:",s)}},generateCsvData(e){const t=[["รอบสอบ","คำนำหน้า","ชื่อจริง","นามสกุล","เบอร์โทร","อีเมล์","เลขบัตรประชาชน","ความคืบหน้า","สอบก่อนเรียน","สอบหลังเรียน"]];return e.forEach((e=>{if(!e.enroll||!e.enroll.form||!e.enroll.form.formData)return void console.error("Missing data for entry:",e);const s=e.enroll.form.formData,a=e.enroll.analytics,r=s["radiobox-14-0-9"]?.value?.label??"N/A";if(!s.setData||!s.setData["ข้อมูลส่วนตัว"])return void console.error("Missing personal info for entry:",e);const o=s.setData["ข้อมูลส่วนตัว"][0],i=o.find((e=>"คำนำหน้า"===e.name))?.value?.label??"N/A",n=o.find((e=>"ชื่อจริง*"===e.name))?.value??"N/A",l=o.find((e=>"นามสกุลจริง*"===e.name))?.value??"N/A",c=s["input-16-6-6"]?.value??"N/A",d=s["input-17-6-6"]?.value??"N/A",u=s["input-13-6-6"]?.value??"N/A",p=a&&"complete"in a?a["complete"]:"N/A",m=a&&a["pre"]&&"score"in a["pre"]?a["pre"].score:"N/A",g=a&&a["post"]&&"score"in a["post"]?a["post"].score:"N/A";t.push([r,i,n,l,c,d,u,p,m,g].join(","))})),t.join("\n")},downloadCsv(e,t){const s=(e.match(/\n/g)||[]).length-1,a=new Date,r=a.toISOString().replace(/[^0-9]/g,"").slice(0,14),o=`${t}_${s}_${r}.csv`,i=new Blob([e],{type:"text/csv"}),n=window.URL.createObjectURL(i),l=document.createElement("a");l.setAttribute("hidden",""),l.setAttribute("href",n),l.setAttribute("download",o),document.body.appendChild(l),l.click(),document.body.removeChild(l)},handleDownload(e){const t=this.generateCsvData(this.reportData);this.downloadCsv(t,e)},async getSumList(e){try{if(!this.login)return void console.error("User is not logged in.");this.loading=!0,this.activeBlock=!0;let t=[],s={courseID:this.dataItem};switch(this.statusFilter&&"all"!==this.statusFilter&&(s["status"]=this.statusFilter),t.push({$match:s}),t.push({$set:{userID:{$toObjectId:"$userID"},formID:{$toObjectId:"$formID"}}}),t.push({$lookup:{from:"form",localField:"formID",foreignField:"_id",as:"form"}}),t.push({$unwind:{path:"$form",preserveNullAndEmptyArrays:!0}}),t.push({$lookup:{from:"user",localField:"userID",foreignField:"_id",as:"user"}}),t.push({$unwind:{path:"$user",preserveNullAndEmptyArrays:!0}}),e){case"no_analytics_data":t.push({$match:{analytics:{$exists:!1}}});break;case"complete_13":t.push({$match:{"analytics.complete":13}});break;case"processing_0":t.push({$match:{"analytics.processing":0}});break;case"complete_between_1_and_12":t.push({$match:{"analytics.complete":{$gt:0,$lt:13}}});break;case"total_entries":t.push({$match:{}});break;default:return console.error("Invalid condition specified"),this.loading=!1,void(this.activeBlock=!1)}t.push({$project:{enroll:"$$ROOT",user:"$user",form:"$form.formData"}});const a={method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({pipeline:t})},r=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/aggregate",a),o=await r.json();o&&o.length>0?(console.log(o),this.reportData=o,this.handleDownload(e)):console.error("No data returned for condition:",e)}catch(t){console.error("Error fetching list for condition:",e,t)}finally{this.loading=!1,this.activeBlock=!1}},async getSummary(){try{this.loading=!0,this.activeBlock=!0;let e=[{courseID:this.dataItem}];"all"!==this.statusFilter&&e.push({status:this.statusFilter});const t=[{$match:{$and:e}},{$set:{formID:{$toObjectId:"$formID"}}},{$lookup:{from:"form",localField:"orderID",foreignField:"orderID",pipeline:[{$project:{orderID:1,"formData.radiobox-14-0-9.value.value":1}}],as:"form"}},{$unwind:{path:"$form",preserveNullAndEmptyArrays:!0}},{$project:{_id:1,courseID:1,"analytics.complete":1,"analytics.post.score":1,"analytics.retest.has":1,"analytics.retest.score":1,"verified.pre.status":1,"verified.pre.url":1,"form.formData.radiobox-14-0-9.value.value":1,"form.formData.radiobox-24-10-10.value.value":1,"form.formData.radiobox-25-10-10.value.value":1}}],s=[[...t,{$group:{_id:null,complete_13:{$sum:{$cond:[{$eq:["$analytics.complete",13]},1,0]}},post_over_33:{$sum:{$cond:[{$gt:["$analytics.post.score",32]},1,0]}},post_over_33_round2:{$sum:{$cond:[{$and:[{$gt:["$analytics.post.score",32]},{$eq:["$form.formData.radiobox-14-0-9.value.value","round-2"]}]},1,0]}},processing_0:{$sum:{$cond:[{$eq:["$analytics.complete",0]},1,0]}},no_analytics_data:{$sum:{$cond:[{$eq:[{$type:"$analytics"},"missing"]},1,0]}},complete_between_1_and_12:{$sum:{$cond:[{$and:[{$gt:["$analytics.complete",0]},{$lt:["$analytics.complete",13]}]},1,0]}},total_entries:{$sum:1}}}],[...t,{$group:{_id:null,post_1_to_32:{$sum:{$cond:[{$and:[{$gte:["$analytics.post.score",1]},{$lte:["$analytics.post.score",32]},{$eq:["$form.formData.radiobox-14-0-9.value.value","round-1"]}]},1,0]}},post_1_to_32_round2:{$sum:{$cond:[{$and:[{$gte:["$analytics.post.score",1]},{$lte:["$analytics.post.score",32]},{$eq:["$form.formData.radiobox-14-0-9.value.value","round-2"]}]},1,0]}},post_11_to_32:{$sum:{$cond:[{$and:[{$gte:["$analytics.post.score",11]},{$lte:["$analytics.post.score",32]},{$eq:["$form.formData.radiobox-14-0-9.value.value","round-1"]}]},1,0]}},post_11_to_32_round2:{$sum:{$cond:[{$and:[{$gte:["$analytics.post.score",11]},{$lte:["$analytics.post.score",32]},{$eq:["$form.formData.radiobox-14-0-9.value.value","round-2"]}]},1,0]}}}}],[...t,{$group:{_id:null,has_retest:{$sum:{$cond:[{$and:[{$ifNull:["$analytics.retest.has",!1]},{$eq:["$form.formData.radiobox-14-0-9.value.value","round-1"]}]},1,0]}},has_retest_round2:{$sum:{$cond:[{$and:[{$ifNull:["$analytics.retest.has",!1]},{$eq:["$form.formData.radiobox-14-0-9.value.value","round-2"]}]},1,0]}},has_retest_pass:{$sum:{$cond:[{$and:[{$ifNull:["$analytics.retest.has",!1]},{$gt:["$analytics.retest.score",32]},{$eq:["$form.formData.radiobox-14-0-9.value.value","round-1"]}]},1,0]}},has_retest_fail:{$sum:{$cond:[{$and:[{$ifNull:["$analytics.retest.has",!1]},{$lt:["$analytics.retest.score",33]},{$eq:["$form.formData.radiobox-14-0-9.value.value","round-1"]}]},1,0]}}}}]],a=s.map((e=>{const t={method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({pipeline:e})};return fetch("https://gateway.cloudrestfulapi.com/api/enroll/aggregate",t)})),r=await Promise.all(a),o=await Promise.all(r.map((e=>e.json())));this.summary={...o[0][0],...o[1][0],...o[2][0]},this.loading=!1,this.activeBlock=!1,this.loadSummary=!0,console.log("optimized summary",this.summary)}catch(e){console.error(e),this.loading=!1,this.activeBlock=!1}},async getData(e=null){try{this.loading=!0,this.activeBlock=!0,this.listItems=[];let t=[{courseID:this.dataItem}];e&&"number"===typeof e.gte&&"number"===typeof e.lte&&t.push({"analytics.post.score":{$gte:e.gte,$lte:e.lte}}),"all"!==this.statusFilter&&t.push({status:this.statusFilter});const s=[{$match:{$and:t}},{$set:{userID:{$convert:{input:"$userID",to:"objectId",onError:null,onNull:null}},formID:{$convert:{input:"$formID",to:"objectId",onError:null,onNull:null}},courseID:{$convert:{input:"$courseID",to:"objectId",onError:null,onNull:null}}}},...this.searchQuery?[{$lookup:{from:"user",localField:"userID",foreignField:"_id",pipeline:[{$match:{$or:[{name:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{citizen:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{email:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{firstname:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{lastname:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{old_id:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{phone:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{token:{$regex:`.*${this.searchQuery}.*`,$options:"i"}}]}},{$project:{_id:1,firstname:1,lastname:1,citizen:1,phone:1,email:1,token:1,old_id:1,createdAt:1,card_img:1,avatar_img:1,clientData:1,enroll:1}}],as:"user"}},{$match:{user:{$ne:[]}}},{$unwind:"$user"}]:[{$lookup:{from:"user",localField:"userID",foreignField:"_id",pipeline:[{$project:{_id:1,firstname:1,lastname:1,citizen:1,phone:1,email:1,token:1,old_id:1,createdAt:1,card_img:1,avatar_img:1,clientData:1,enroll:1}}],as:"user"}},{$unwind:"$user"}],{$lookup:{from:"enroll",let:{userId:{$toString:"$userID"}},pipeline:[{$match:{$expr:{$eq:["$userID","$$userId"]}}},{$project:{_id:1}}],as:"userEnrolls"}},{$addFields:{enrollCount:{$size:"$userEnrolls"}}},{$unset:"userEnrolls"},{$lookup:{from:"form",localField:"formID",foreignField:"_id",pipeline:[{$project:{_id:1,userID:1,courseID:1,createdAt:1,updatedAt:1,"formData.radiobox-14-0-9":1,"formData.upload-22-0-12":1,"formData.input-16-6-6":1,"formData.input-17-6-6":1,"formData.input-13-6-6":1,"formData.setData":1}}],as:"form"}},{$lookup:{from:"course",localField:"courseID",foreignField:"_id",pipeline:[{$project:{_id:1,master:1,name:1,lesson_old_id:1}}],as:"course"}},{$unwind:"$course"},{$lookup:{from:"exam",let:{masterID:"$course.master"},pipeline:[{$match:{$expr:{$and:[{$eq:["$courseId","$$masterID"]},{$eq:["$type","pre"]}]}}},{$project:{_id:1,courseId:1,type:1,name:1}}],as:"examPre"}},{$lookup:{from:"exam",let:{masterID:"$course.master"},pipeline:[{$match:{$expr:{$and:[{$eq:["$courseId","$$masterID"]},{$eq:["$type","post"]}]}}},{$project:{_id:1,courseId:1,type:1,name:1}}],as:"examPost"}},{$sort:{updatedAt:-1}},{$facet:{paginatedData:[{$skip:(this.currentPage-1)*this.limitItem},{$limit:this.limitItem},{$project:{enroll:{_id:"$$ROOT._id",userID:"$$ROOT.userID",courseID:"$$ROOT.courseID",formID:"$$ROOT.formID",analytics:"$$ROOT.analytics",verified:"$$ROOT.verified",capture:"$$ROOT.capture",certification:"$$ROOT.certification",status:"$$ROOT.status",createdAt:"$$ROOT.createdAt",updatedAt:"$$ROOT.updatedAt",examPre:"$$ROOT.examPre",examPost:"$$ROOT.examPost",enrollCount:"$$ROOT.enrollCount"},user:"$user",form:"$form"}}],totalCount:[{$count:"count"}]}}],a={method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({pipeline:s})},r=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/aggregate",a),o=await r.json();if(o){const e=o[0].paginatedData,t=o[0].totalCount[0]?.count||0,s={data:e.map((e=>({user:e.user,enroll:e.enroll}))),total:t,paging:{page:this.currentPage,limit:this.limitItem,totalPages:Math.ceil(t/this.limitItem)}};this.listItems=s.data.sort(((e,t)=>new Date(t.enroll.updatedAt)-new Date(e.enroll.updatedAt))),this.totalItems=s.total,this.totalPages=s.paging.totalPages,console.log("listItems with enrollCount",this.listItems),this.loading=!1,this.activeBlock=!1,this.updateBadge(t)}}catch(t){console.error("getData error:",t),this.loading=!1,this.activeBlock=!1}},async getScoreData(){try{this.loading=!0,this.activeBlock=!0,this.listItems=[];let e=[{courseID:this.dataItem}];"all"!==this.statusFilter&&e.push({status:this.statusFilter});const t=[{$match:{$and:e}},{$set:{userID:{$toObjectId:"$userID"},formID:{$toObjectId:"$formID"},courseID:{$toObjectId:"$courseID"}}},{$lookup:{from:"user",localField:"userID",foreignField:"_id",as:"user"}},{$unwind:"$user"},{$lookup:{from:"form",let:{userId:"$userID",courseId:"$courseID"},pipeline:[{$match:{$expr:{$and:[{$eq:["$userID","$$userId"]},{$eq:["$courseID","$$courseId"]}]}}}],as:"form"}},{$unwind:"$form"},{$lookup:{from:"course",localField:"courseID",foreignField:"_id",as:"course"}},{$unwind:"$course"},{$lookup:{from:"exam",let:{masterID:"$course.master"},pipeline:[{$match:{$expr:{$and:[{$eq:["$courseId","$$masterID"]},{$eq:["$type","pre"]}]}}}],as:"examPre"}},{$lookup:{from:"exam",let:{masterID:"$course.master"},pipeline:[{$match:{$expr:{$and:[{$eq:["$courseId","$$masterID"]},{$eq:["$type","post"]}]}}}],as:"examPost"}},...this.searchQuery?[{$match:{$or:[{"user.name":{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{"user.citizen":{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{"user.email":{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{"user.firstname":{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{"user.lastname":{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{"user.old_id":{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{"user.phone":{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{"user.token":{$regex:`.*${this.searchQuery}.*`,$options:"i"}}]}}]:[],{$sort:{"user.createdAt":-1}},{$facet:{paginatedData:[{$skip:(this.currentPage-1)*this.limitItem},{$limit:this.limitItem},{$project:{enroll:"$$ROOT",user:"$user",form:"$form"}}],totalCount:[{$count:"count"}]}}],s={method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({pipeline:t})},a=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/aggregate",s),r=await a.json();if(r){const e=r[0].paginatedData,t=r[0].totalCount[0].count,s={data:e.map((e=>({user:e.user,enroll:e.enroll}))),total:t,paging:{page:this.currentPage,limit:this.limitItem,totalPages:Math.ceil(t/this.limitItem)}};this.listItems=s.data,this.totalItems=s.total,this.totalPages=s.paging.totalPages,console.log("listItems with enrollCount",this.listItems),this.loading=!1,this.activeBlock=!1,this.updateBadge(t)}}catch(e){Gs.A.log(e)}},async getEnrollData(e,t,s,a){try{let r=[{courseID:e,userID:t}];const o=[{$match:{$and:r}},{$facet:{paginatedData:[{$skip:0},{$limit:1},{$project:{enroll:"$$ROOT"}}],totalCount:[{$count:"count"}]}}],i={method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({pipeline:o})},n=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/aggregate",i),l=await n.json();if(l){const e=l[0].paginatedData,t=l[0].totalCount[0].count,r={data:e.map((e=>({enroll:e.enroll}))),total:t,paging:{page:this.currentPage,limit:this.limitItem,totalPages:Math.ceil(t/this.limitItem)}};Gs.A.log("Enroll Local Data",r.data[0].enroll._id),await this.getEnrollRemote(s,r.data[0].enroll._id,a)}}catch(r){Gs.A.log(r)}finally{this.loading=!1,this.activeBlock=!1}},async getEnrollRemote(e,t,s){const a=`\n        SELECT\n        MAX(CASE WHEN data_type = 'cert_area' THEN data_value END) AS cert_area,\n        MAX(CASE WHEN data_type = 'cert_age' THEN data_value END) AS cert_age,\n        MAX(CASE WHEN data_type = 'exam_round' THEN data_value END) AS exam_round,\n        MAX(CASE WHEN data_type = 'get_receipt' THEN data_value END) AS get_receipt,\n\n        MAX(CASE WHEN data_type = 'progress' THEN data_value END) AS progress,\n        MAX(CASE WHEN data_type = 'pretest' THEN data_value END) AS pretest,\n        MAX(CASE WHEN data_type = 'posttest' THEN data_value END) AS posttest,\n        MAX(CASE WHEN data_type = 'retest' THEN data_value END) AS retest\n        FROM student_adddition_data\n        WHERE data_target = '${this.courseData.lesson_old_id}' AND student_id = '${e}'\n        AND data_type IN ('cert_area','cert_age','exam_round','get_receipt','progress', 'pretest', 'posttest', 'retest');\n        `,r="",o={query:{mainQuery:a,countQuery:r}};try{const e=await fetch("https://multisource-api-edsdv.ondigitalocean.app/api/04ZQdW5sGA9C9eXXXk6x/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify(o)}),a=await e.json();Gs.A.log("Enroll Remote Data",a.data[0]);const r=a.data[0];let i=parseInt(r.progress),n=0,l=0,c=0,d="",u="",p=33;i<13?(l=13-i,n=i,c=i,d="processing",u="กำลังเรียน"):0===i||null===i||void 0===i?(l=13,n=0,c=0,d="pending",u="ยังไม่ได้เรียน"):13===i&&(n=0,c=13,l=0,d="complete",u="เรียนจบแล้ว");const m={analytics:{total:13,pending:l,processing:n,complete:c,status:d,message:u,post:{req:!0,has:!0,measure:p,score:r.posttest,result:r.posttest>=p,message:null===r.posttest||void 0===r.posttest?"ยังไม่ได้สอบวัดผล":r.posttest>=p?"ผ่านการรับรอง":"ไม่ผ่านการรับรอง"},pre:{req:!0,has:!0,measure:p,score:r.pretest,result:r.pretest>=p,message:null===r.pretest||void 0===r.pretest?"ยังไม่ได้สอบก่อนเรียน":r.pretest>=p?"สอบก่อนเรียนผ่าน":"สอบก่อนเรียนไม่ผ่าน"},retest:{req:!0,has:!0,measure:p,result:r.retest>=p,score:r.retest,message:null===r.retest||void 0===r.retest?"ยังไม่ได้สอบวัดผล":r.retest>=p?"ผ่านการรับรอง":"ไม่ผ่านการรับรอง"},option:{cert_age:r.cert_age,cert_area:r.cert_area,exam_round:r.exam_round,get_receipt:r.get_receipt}},certification:[]};Gs.A.log("updateEnroll",t,m),await this.updateEnroll(t,m),Gs.A.log("updateOrderEnroll",s),await this.updateOrderEnroll(s,t)}catch(i){console.error(i)}},async updateEnroll(e,t){try{const s=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/"+e,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:t})});await s.json(),200===s.status&&Gs.A.log("Enroll "+e+" updated successfully!")}catch(s){Gs.A.log(s)}},toggleStatus(e){Gs.A.log("Toggle Status",e),this.statusFilter=e,this.getData(),this.getSummary()},async renderStatus(){Gs.A.log("renderStatus");for(const e of this.listItems)Gs.A.log(e.order.ref3),"สั่งซื้อ"===e.order.status&&(Gs.A.log("searchData"),await this.searchData(e.order.ref3,e.order._id))},async renderProvince(){Gs.A.log("renderProvince");for(const e of this.listItems)Gs.A.log(e.order.ref_no),await this.executemarketplaceQueriesPersonal(e.order.ref_no,e.order._id)},async renderProfile(){const e=this.listItems.length;let t=0;this.isProcessing=!0,this.processName="Render Profile Image",this.progressTotal=e,this.startTime=(new Date).toISOString(),this.endTime=null;for(const s of this.listItems)t++,this.progressText=`Processing : ${t}/${e}`,this.progressCurrent=t,await this.executUserQueries(s.user.old_id,s.user._id);this.progressText="All Process : Done",this.endTime=(new Date).toISOString()},closeProgress(){this.isProcessing=!1},async makePosttest(e){if(this.open=!1,e){const t=1;let s=0;this.isProcessing=!0,this.processName="Render Single Posttest",this.progressTotal=t,this.startTime=(new Date).toISOString(),this.endTime=null,this.progressText=`Processing : ${s}/${t}`,this.progressCurrent=0,Gs.A.log("single",e);const a=Math.floor(4*Math.random())+33;await this.executeInsertQueries(e,a),await this.saveExamRecord(e,a),await this.renderEnroll(e),this.progressCurrent=1}else{const e=this.listItems.length;let t=0;this.isProcessing=!0,this.processName="Render Posttest",this.progressTotal=e,this.startTime=(new Date).toISOString(),this.endTime=null;for(const s of this.listItems)t++,this.progressText=`Processing : ${t}/${e}`,this.progressCurrent=t,Gs.A.log("item",s)}this.progressText="All Process : Done",this.endTime=(new Date).toISOString()},async executeInsertQueries(e,t){const s=`\n          INSERT INTO student_adddition_data (student_id, student_token, data_type, data_value, data_target, data_method, data_status)\n          VALUES ('${e.user.old_id}', '${e.user.token}', 'posttest', '${t}', '224', 'edit', 'active')\n        `,a="",r={query:{mainQuery:s,countQuery:a}};try{const e=await fetch("https://multisource-api-edsdv.ondigitalocean.app/api/04ZQdW5sGA9C9eXXXk6x/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify(r)}),t=await e.json();Gs.A.log("responseData",t.data[0])}catch(o){console.error(o)}},async saveExamRecord(e,t){const s={user:e.user.token,course:"224",score:"posttest",data:{result:t}};try{const e=await fetch("https://asia-southeast1-academy-f0925.cloudfunctions.net/api/user/course/score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),t=await e.json();Gs.A.log("API response:",t)}catch(a){console.error(a)}},async renderEnroll(e){if(this.open=!1,e){const t=1;let s=0;this.isProcessing=!0,this.processName="Render Single Enroll",this.progressTotal=t,this.startTime=(new Date).toISOString(),this.endTime=null,this.progressText=`Processing : ${s}/${t}`,this.progressCurrent=0,await this.getEnrollData(e.order.courseID,e.order.userID,e.user.old_id,e.order._id),await this.getData(),this.progressCurrent=1}else{const e=this.listItems.length;let t=0;this.isProcessing=!0,this.processName="Render Enroll",this.progressTotal=e,this.startTime=(new Date).toISOString(),this.endTime=null;for(const s of this.listItems)t++,this.progressText=`Processing : ${t}/${e}`,this.progressCurrent=t,await this.getEnrollData(s.order.courseID,s.order.userID,s.user.old_id,s.order._id)}this.progressText="All Process : Done",this.endTime=(new Date).toISOString()},async renderEnrollFirebase(){Gs.A.log("########## Render Firebase");const e=this.listItems.length;let t=0;for(const s of this.listItems)t++,await this.createUserCourse(s.user.token,"20",s.order.ref_no),Gs.A.log(`Processing ${t}/${e}`)},async renderData(){this.open=!1;const e=this.listItems.length;let t=0;this.isProcessing=!0,this.processName="Render Billing",this.progressTotal=e,this.startTime=(new Date).toISOString(),this.endTime=null;for(const s of this.listItems)t++,this.progressText=`Processing : ${t}/${e}`,this.progressCurrent=t,Gs.A.log("item",s);this.progressText="All Process : Done",this.endTime=(new Date).toISOString()},async renderBilling(){this.open=!1;const e=this.listItems.length;let t=0;this.isProcessing=!0,this.processName="Render Billing",this.progressTotal=e,this.startTime=(new Date).toISOString(),this.endTime=null;for(const s of this.listItems)t++,this.progressText=`Processing : ${t}/${e}`,this.progressCurrent=t,await this.executeCustomQueries(s.order.ref,s.order._id);this.progressText="All Process : Done",this.endTime=(new Date).toISOString()},resetProgressToast(){this.showProgressToast=!1,this.scrollTimeout&&(clearTimeout(this.scrollTimeout),this.scrollTimeout=null)},getIndexRecommendations(){return[{courseID:1,status:1,updatedAt:-1},{userID:1,courseID:1},{"analytics.complete":1},{"analytics.post.score":1},{"analytics.retest.has":1,"analytics.retest.score":1},{orderID:1},{userID:1,courseID:1},{firstname:"text",lastname:"text",citizen:"text",email:"text"},{master:1},{courseId:1,type:1}]},async getCachedSummary(){const e=`summary_${this.dataItem}_${this.statusFilter}`,t=3e5,s=sessionStorage.getItem(e);if(s){const{data:e,timestamp:a}=JSON.parse(s);if(Date.now()-a<t)return this.summary=e,void(this.loadSummary=!0)}await this.getSummary();const a={data:this.summary,timestamp:Date.now()};sessionStorage.setItem(e,JSON.stringify(a))},async getBatchedData(){const e=1e3,t=await this.getTotalCount(),s=Math.ceil(t/e);let a=[];for(let r=0;r<s;r++){const t=r*e,s=[{$match:{courseID:this.dataItem}},{$skip:t},{$limit:e}],o=await this.executePipeline(s);a=a.concat(o)}return a},getOptimizedUserLookup(){return this.searchQuery?{$lookup:{from:"user",let:{userId:"$userID"},pipeline:[{$match:{$expr:{$eq:["$_id",{$toObjectId:"$$userId"}]},$or:[{firstname:{$regex:this.searchQuery,$options:"i"}},{lastname:{$regex:this.searchQuery,$options:"i"}},{citizen:{$regex:this.searchQuery,$options:"i"}},{email:{$regex:this.searchQuery,$options:"i"}}]}},{$project:{firstname:1,lastname:1,citizen:1,phone:1,email:1,token:1}}],as:"user"}}:{$lookup:{from:"user",localField:"userID",foreignField:"_id",pipeline:[{$project:{firstname:1,lastname:1,citizen:1,phone:1,email:1,token:1}}],as:"user"}}}},async mounted(){try{const e=new URLSearchParams(window.location.search),t=e.get("page");if(t&&/^\d+$/.test(t))this.currentPage=parseInt(t);else{const e=Hs.A.get("session");if(e&&e.currentPage){this.currentPage=e.currentPage;const t=new URLSearchParams(window.location.search);t.set("page",e.currentPage);const s=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",s)}}const s=Hs.A.get("session");s&&s.searchQuery&&(this.searchQuery=s.searchQuery);const a=s.limitItem;a&&(this.limitItem=a),await this.getData({field:"form.createdAt",order:-1}),console.log("getData"),await this.getCourse(),console.log("getCourse"),await this.getSummary(),console.log("getSummary"),this.fetchData(),console.log("fetchData"),this.$nextTick((()=>{this.resetDisplayCount()}))}catch(e){Gs.A.log(Error)}},setup(){Gs.A.log("Setup")},watch:{searchQuery(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((()=>{this.getData();const e=Hs.A.get("session");e.searchQuery=this.searchQuery,Hs.A.set("session",e),this.currentPage=1}),500)}},computed:{visibleItems(){if(!this.lazy)return this.listItems;const e=this.listItems.slice(0,this.currentDisplayCount);return e},hasMoreItems(){return this.lazy&&this.currentDisplayCount<this.listItems.length},progressiveLoadingStats(){return this.lazy?{showing:Math.min(this.currentDisplayCount,this.listItems.length),total:this.listItems.length,remaining:Math.max(0,this.listItems.length-this.currentDisplayCount),percentage:Math.round(this.currentDisplayCount/this.listItems.length*100)}:null},filteredListItems(){return"All"===this.selectedStatus?this.listItems:this.listItems.filter((e=>e.status===this.selectedStatus))}},beforeUnmount(){this.scrollCleanup&&(this.scrollCleanup(),this.scrollCleanup=null),this.scrollTimeout&&(clearTimeout(this.scrollTimeout),this.scrollTimeout=null)}},ta=s(64621);const sa=(0,ta.A)(ea,[["render",zs],["__scopeId","data-v-147371cc"]]);var aa=sa},86530:function(e,t,s){s.d(t,{A:function(){return y}});var a=s(20641),r=s(90033);const o={key:0,class:"fixed top-0 left-0 w-full h-full flex flex-col justify-center items-center z-50"},i={class:"text-white text-center z-20"},n={class:"text-2xl text-green-500 font-bold mb-2"},l={class:"text-xl"},c={key:0,class:"mt-2"},d={class:"text-lg"},u={class:"fixed top-0 left-0 w-full h-1 bg-gray-600"};function p(e,t,s,p,m,g){return s.isVisible?((0,a.uX)(),(0,a.CE)("div",o,[t[1]||(t[1]=(0,a.Lk)("div",{class:"absolute w-full h-full bg-black bg-opacity-80"},null,-1)),(0,a.Lk)("div",i,[(0,a.Lk)("div",n,"## "+(0,r.v_)(s.processName)+" ##",1),(0,a.Lk)("div",l,(0,r.v_)(s.progressText),1),s.startTime&&s.endTime?((0,a.uX)(),(0,a.CE)("div",c,[(0,a.Lk)("div",d,"Usage Time : "+(0,r.v_)(g.calculateUsageTime(s.startTime,s.endTime)),1)])):(0,a.Q3)("",!0),s.startTime&&s.endTime?((0,a.uX)(),(0,a.CE)("button",{key:1,class:"mt-4 bg-blue-600 text-white px-4 py-2 rounded",onClick:t[0]||(t[0]=(...e)=>g.closeProgress&&g.closeProgress(...e))},"Close")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",u,[(0,a.Lk)("div",{style:(0,r.Tr)({width:g.progressBarWidth}),class:"h-full bg-green-500"},null,4)])])):(0,a.Q3)("",!0)}var m={props:{processName:String,progressText:String,progressTotal:Number,progressCurrent:Number,isVisible:Boolean,startTime:String,endTime:String},computed:{progressBarWidth(){return this.progressCurrent/this.progressTotal*100+"%"}},methods:{calculateUsageTime(e,t){const s=new Date(e),a=new Date(t),r=a-s,o=Math.floor(r/1e3),i=Math.floor(o/60),n=o%60;return`${i}m ${n}s`},closeProgress(){this.$emit("close")}}},g=s(64621);const h=(0,g.A)(m,[["render",p],["__scopeId","data-v-48124189"]]);var y=h},38558:function(e,t,s){s.d(t,{A:function(){return D}});var a=s(20641),r=s(90033);const o={class:"flex flex-col justify-center items-center h-full"},i={key:0,class:"flex flex-wrap justify-center"},n=["disabled"],l={key:0,class:"font-medium"},c=["disabled"],d=["onClick","disabled"],u={key:1,class:"font-medium"},p=["disabled"],m=["disabled"],g={key:1,class:"text-sm text-gray-400 text-center"},h={class:"font-medium"},y={class:"text-gray-600"},f={class:"font-medium"},b={class:"text-gray-600"},x={class:"font-medium"},v={class:"text-gray-600"},k={class:"font-medium"},_={class:"text-gray-600"};function $(e,t,s,$,L,w){const C=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)("div",o,["nav"===s.displayMode||"full"===s.displayMode?((0,a.uX)(),(0,a.CE)("ul",i,[(0,a.Lk)("li",{class:(0,r.C4)({"opacity-50 cursor-not-allowed":1===L.activePage})},[(0,a.Lk)("button",{onClick:t[0]||(t[0]=e=>w.handleButtonClick(L.activePage-1)),disabled:s.dataLoading||L.buttonClicked,class:"block px-2 py-2 rounded-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"},[(0,a.bF)(C,{icon:["fas","chevron-left"],class:"text-gray-700 pl-1 pr-1 text-md"})],8,n)],2),L.activePage>2?((0,a.uX)(),(0,a.CE)("li",l,[(0,a.Lk)("button",{onClick:t[1]||(t[1]=e=>w.handleButtonClick(1)),disabled:s.dataLoading||L.buttonClicked,class:"block px-2 py-2 ml-1 mr-1 text-sm text-gray-700 rounded-md hover:bg-indigo-100"}," หน้าแรก ",8,c)])):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(w.pages,(e=>((0,a.uX)(),(0,a.CE)("li",{key:e,class:(0,r.C4)([{"bg-indigo-100 ml-1 mr-1 rounded-md border-indigo-500 text-indigo-600 font-semibold":L.activePage===e},"font-medium"])},[(0,a.Lk)("button",{onClick:t=>w.handleButtonClick(e),disabled:s.dataLoading||L.buttonClicked,class:"block px-2 py-2 ml-1 mr-1 text-sm text-gray-700 rounded-md hover:bg-indigo-100"},(0,r.v_)(e.toString().padStart(2,"0")),9,d)],2)))),128)),L.activePage<s.totalPages-1?((0,a.uX)(),(0,a.CE)("li",u,[(0,a.Lk)("button",{onClick:t[2]||(t[2]=e=>w.handleButtonClick(s.totalPages)),disabled:s.dataLoading||L.buttonClicked,class:"block px-2 py-2 ml-1 mr-1 text-sm text-gray-700 rounded-md hover:bg-indigo-100"}," หน้าสุดท้าย ",8,p)])):(0,a.Q3)("",!0),(0,a.Lk)("li",{class:(0,r.C4)({"opacity-50 cursor-not-allowed":L.activePage===s.totalPages})},[(0,a.Lk)("button",{onClick:t[3]||(t[3]=e=>w.handleButtonClick(L.activePage+1)),disabled:s.dataLoading||L.buttonClicked,class:"block px-2 py-2 rounded-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"},[(0,a.bF)(C,{icon:["fas","chevron-right"],class:"text-gray-700 pl-1 pr-1 text-md"})],8,m)],2)])):(0,a.Q3)("",!0),"summary"===s.displayMode||"full"===s.displayMode?((0,a.uX)(),(0,a.CE)("div",g,[(0,a.eW)((0,r.v_)(w.translate("paging-display"))+" ",1),(0,a.Lk)("span",h,[(0,a.Lk)("span",y,(0,r.v_)(w.startItem),1)]),(0,a.eW)(" "+(0,r.v_)(w.translate("paging-to"))+" ",1),(0,a.Lk)("span",f,[(0,a.Lk)("span",b,(0,r.v_)(w.endItem),1)]),t[4]||(t[4]=(0,a.eW)(" / ")),(0,a.Lk)("span",x,[(0,a.Lk)("span",v,(0,r.v_)(w.formatNumber(s.totalPages)),1)]),(0,a.eW)(" "+(0,r.v_)(w.translate("paging-page"))+" | "+(0,r.v_)(w.translate("paging-from"))+" ",1),(0,a.Lk)("span",k,[(0,a.Lk)("span",_,(0,r.v_)(w.formatNumber(s.totalItems)),1)]),(0,a.eW)(" "+(0,r.v_)(w.translate("paging-item")),1)])):(0,a.Q3)("",!0)])}s(44114),s(14603),s(47566),s(98721);var L=s(9964),w=s(93426),C={props:{currentPage:{type:Number,required:!0},dataLoading:{type:Boolean,required:!0},displayMode:{type:String,required:!0,default:"full"},totalPages:{type:Number,required:!0},totalItems:{type:Number,required:!0},limitItems:{type:Number,required:!0}},data(){return{activePage:this.currentPage,buttonClicked:!1}},computed:{pages(){if(window.innerWidth>=600){const e=Math.max(this.activePage-2,1),t=Math.min(this.activePage+2,this.totalPages);let s=[];for(let a=e;a<=t;a++)s.push(a);return s}{let e=Math.max(this.activePage-1,1),t=Math.min(e+2,this.totalPages);t-e<2&&(e=Math.max(t-2,1));let s=[];for(let a=e;a<=t;a++)s.push(a);return s}},startItem(){return(this.activePage-1)*this.limitItems+1},endItem(){return Math.min(this.activePage*this.limitItems,this.totalItems)}},methods:{translate:w.Tl,formatNumber(e){return L.A.formatNumber(e,"short")},goToPage(e){if(e<1||e>this.totalPages)return;const t=new URLSearchParams(window.location.search),s=t.get("searchQuery");let a="";e>1&&s?a=`?page=${e}&searchQuery=${s}`:e>1?a=`?page=${e}`:s&&(a=`?searchQuery=${s}`);const r=`${window.location.pathname}${a||""}`;window.history.pushState({path:r},"",r),this.activePage=e,this.$emit("page-changed",e)},handleButtonClick(e){this.buttonClicked||(this.buttonClicked=!0,this.goToPage(e),setTimeout((()=>{this.buttonClicked=!1}),1e3))}},watch:{currentPage(e){this.activePage=e},activePage(e){this.$emit("page-changed",e)},$route(){}},created(){const e=new URLSearchParams(window.location.search),t=e.get("page");if(t){const e=parseInt(t);isNaN(e)||this.goToPage(e)}}},I=s(64621);const T=(0,I.A)(C,[["render",$]]);var D=T},97080:function(e,t,s){var a=s(94402).has;e.exports=function(e){return a(e),e}},83789:function(e,t,s){var a=s(79306),r=s(28551),o=s(69565),i=s(91291),n=s(1767),l="Invalid size",c=RangeError,d=TypeError,u=Math.max,p=function(e,t){this.set=e,this.size=u(t,0),this.has=a(e.has),this.keys=a(e.keys)};p.prototype={getIterator:function(){return n(r(o(this.keys,this.set)))},includes:function(e){return o(this.has,this.set,e)}},e.exports=function(e){r(e);var t=+e.size;if(t!==t)throw new d(l);var s=i(t);if(s<0)throw new c(l);return new p(e,s)}},40507:function(e,t,s){var a=s(69565);e.exports=function(e,t,s){var r,o,i=s?e:e.iterator,n=e.next;while(!(r=a(n,i)).done)if(o=t(r.value),void 0!==o)return o}},89286:function(e,t,s){var a=s(94402),r=s(38469),o=a.Set,i=a.add;e.exports=function(e){var t=new o;return r(e,(function(e){i(t,e)})),t}},83440:function(e,t,s){var a=s(97080),r=s(94402),o=s(89286),i=s(25170),n=s(83789),l=s(38469),c=s(40507),d=r.has,u=r.remove;e.exports=function(e){var t=a(this),s=n(e),r=o(t);return i(t)<=s.size?l(t,(function(e){s.includes(e)&&u(r,e)})):c(s.getIterator(),(function(e){d(t,e)&&u(r,e)})),r}},94402:function(e,t,s){var a=s(79504),r=Set.prototype;e.exports={Set:Set,add:a(r.add),has:a(r.has),remove:a(r["delete"]),proto:r}},68750:function(e,t,s){var a=s(97080),r=s(94402),o=s(25170),i=s(83789),n=s(38469),l=s(40507),c=r.Set,d=r.add,u=r.has;e.exports=function(e){var t=a(this),s=i(e),r=new c;return o(t)>s.size?l(s.getIterator(),(function(e){u(t,e)&&d(r,e)})):n(t,(function(e){s.includes(e)&&d(r,e)})),r}},64449:function(e,t,s){var a=s(97080),r=s(94402).has,o=s(25170),i=s(83789),n=s(38469),l=s(40507),c=s(9539);e.exports=function(e){var t=a(this),s=i(e);if(o(t)<=s.size)return!1!==n(t,(function(e){if(s.includes(e))return!1}),!0);var d=s.getIterator();return!1!==l(d,(function(e){if(r(t,e))return c(d,"normal",!1)}))}},53838:function(e,t,s){var a=s(97080),r=s(25170),o=s(38469),i=s(83789);e.exports=function(e){var t=a(this),s=i(e);return!(r(t)>s.size)&&!1!==o(t,(function(e){if(!s.includes(e))return!1}),!0)}},28527:function(e,t,s){var a=s(97080),r=s(94402).has,o=s(25170),i=s(83789),n=s(40507),l=s(9539);e.exports=function(e){var t=a(this),s=i(e);if(o(t)<s.size)return!1;var c=s.getIterator();return!1!==n(c,(function(e){if(!r(t,e))return l(c,"normal",!1)}))}},38469:function(e,t,s){var a=s(79504),r=s(40507),o=s(94402),i=o.Set,n=o.proto,l=a(n.forEach),c=a(n.keys),d=c(new i).next;e.exports=function(e,t,s){return s?r({iterator:c(e),next:d},t):l(e,t)}},84916:function(e,t,s){var a=s(97751),r=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},o=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var s=a("Set");try{(new s)[e](r(0));try{return(new s)[e](r(-1)),!1}catch(n){if(!t)return!0;try{return(new s)[e](o(-1/0)),!1}catch(l){var i=new s;return i.add(1),i.add(2),t(i[e](o(1/0)))}}}catch(l){return!1}}},25170:function(e,t,s){var a=s(46706),r=s(94402);e.exports=a(r.proto,"size","get")||function(e){return e.size}},83650:function(e,t,s){var a=s(97080),r=s(94402),o=s(89286),i=s(83789),n=s(40507),l=r.add,c=r.has,d=r.remove;e.exports=function(e){var t=a(this),s=i(e).getIterator(),r=o(t);return n(s,(function(e){c(t,e)?d(r,e):l(r,e)})),r}},44204:function(e,t,s){var a=s(97080),r=s(94402).add,o=s(89286),i=s(83789),n=s(40507);e.exports=function(e){var t=a(this),s=i(e).getIterator(),l=o(t);return n(s,(function(e){r(l,e)})),l}},17642:function(e,t,s){var a=s(46518),r=s(83440),o=s(84916),i=!o("difference",(function(e){return 0===e.size}));a({target:"Set",proto:!0,real:!0,forced:i},{difference:r})},58004:function(e,t,s){var a=s(46518),r=s(79039),o=s(68750),i=s(84916),n=!i("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||r((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));a({target:"Set",proto:!0,real:!0,forced:n},{intersection:o})},33853:function(e,t,s){var a=s(46518),r=s(64449),o=s(84916),i=!o("isDisjointFrom",(function(e){return!e}));a({target:"Set",proto:!0,real:!0,forced:i},{isDisjointFrom:r})},45876:function(e,t,s){var a=s(46518),r=s(53838),o=s(84916),i=!o("isSubsetOf",(function(e){return e}));a({target:"Set",proto:!0,real:!0,forced:i},{isSubsetOf:r})},32475:function(e,t,s){var a=s(46518),r=s(28527),o=s(84916),i=!o("isSupersetOf",(function(e){return!e}));a({target:"Set",proto:!0,real:!0,forced:i},{isSupersetOf:r})},15024:function(e,t,s){var a=s(46518),r=s(83650),o=s(84916);a({target:"Set",proto:!0,real:!0,forced:!o("symmetricDifference")},{symmetricDifference:r})},31698:function(e,t,s){var a=s(46518),r=s(44204),o=s(84916);a({target:"Set",proto:!0,real:!0,forced:!o("union")},{union:r})}}]);
//# sourceMappingURL=5163.a80a236c.js.map