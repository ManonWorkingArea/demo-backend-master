"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[5183],{95857:function(e,t,s){s.r(t),s.d(t,{default:function(){return CX}});var a=s(20641);function o(e,t,s,o,i,r){return(0,a.uX)(),(0,a.Wv)((0,a.$y)(r.componentName))}var i=s(52968),r=s(75220),n=s(40475),l=(s(44114),s(98992),s(54520),s(90033)),c=s(53751);const d={key:2,class:"text-center"},u={class:"bg-white border-b border-gray-200"},m={key:0,class:"mx-auto px-4 sm:px-6 lg:px-8"},g={class:"pt-5"},p={class:"flex items-center space-x-5"},h={class:"text-2xl font-bold text-gray-900"},b={class:"mt-2 text-sm font-medium text-gray-500"},x={class:"bg-gray-600 text-[12px] text-white rounded mr-2 pl-1 pr-1 pt-1 pb-1"},y={class:"bg-gray-600 text-[12px] text-white rounded mr-2 pl-1 pr-1 pt-1 pb-1"},f={class:"bg-gray-600 text-[12px] text-white rounded mr-2 pl-1 pr-1 pt-1 pb-1"},k={key:1,class:"text-xs font-medium bg-red-600 pl-2 pr-2 pt-1 pb-1 mr-1 rounded text-white"},v={class:"border-t border-gray-200 pt-3 mt-5"},w={class:"flex space-x-2 tab-navigation",id:"tab-list"},L=["onClick"],C={class:"hidden md:inline relative"},D={key:0,class:"text-xs bg-red-500 text-white py-0 px-1 rounded-md text-center absolute right-0 top-[-15px]"},S={class:"md:hidden text-xs"},F={class:"mobile-navigation"},I={class:"dropdown-selected"},E={class:"flex justify-between"},$={class:"flex"},_={class:"tab-icon"},P={class:"flex flex-col relative"},T={class:"status-name"},A={key:0,class:"text-xs bg-red-500 text-white py-0 px-1 rounded-md text-center absolute right-0 top-[-15px]"},X={class:"status-description text-xs text-gray-400 single-line-ellipsis"},j={class:"tab-icon icon-line"},U={class:"dropdown-content"},B=["onClick"],O={class:"flex justify-between"},Q={class:"flex"},M={class:"tab-icon"},V={class:"flex flex-col"},R={class:"status-description text-xs text-gray-400 single-line-ellipsis"},W={class:"tab-icon icon-line relative"},N={key:0,class:"text-xs bg-red-500 text-white py-0 px-1 rounded-md text-center absolute right-0 top-[-15px]"},q={key:3,class:"mx-auto mt-8 sm:px-6"},K={class:"space-y-6"},H={key:0,"aria-labelledby":"applicant-information-title",class:"md:flex md:space-x-4"},z={class:"w-full md:w-9/12"},G={class:"bg-white rounded-lg shadow relative overflow-hidden"},J={class:"px-4 py-5 sm:px-6 relative"},Y={id:"notes-title",class:"text-lg font-bold text-gray-900"},Z={class:"absolute top-4 right-4 ml-3 inline-flex items-center"},ee={type:"button",class:"ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-100"},te={class:"border-t border-gray-200 p-2"},se={class:"px-4 py-5 sm:px-6"},ae={class:"grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2"},oe={class:"sm:col-span-1"},ie={class:"text-sm font-bold text-black"},re={class:"mt-1 text-sm text-gray-900"},ne={class:"sm:col-span-1"},le={class:"text-sm font-bold text-black"},ce={class:"mt-1 text-sm text-gray-900"},de={class:"sm:col-span-1"},ue={class:"text-sm font-bold text-black"},me={class:"mt-1 text-sm text-gray-900"},ge={class:"sm:col-span-1"},pe={class:"text-sm font-bold text-black"},he={class:"mt-1 text-sm text-gray-900"},be={class:"mt-3 bg-white rounded-lg shadow"},xe={class:"px-5 pt-5"},ye={id:"applicant-information-title",class:"text-lg font-semibold leading-6 text-gray-900"},fe={class:"px-4 py-2 pb-4 sm:px-6"},ke={key:0,class:"pt-2 mt-2 border-t border-gray-200"},ve=["innerHTML"],we={key:1,class:"pt-2 mt-2 border-t border-gray-200"},Le=["innerHTML"],Ce={key:2,class:"pt-2 mt-2 border-t border-gray-200"},De=["innerHTML"],Se={key:3,class:"pt-2 mt-2 border-t border-gray-200"},Fe={class:"flex flex-wrap gap-2 mt-2"},Ie={key:4,class:"pt-2 mt-2 border-t border-gray-200"},Ee=["innerHTML"],$e={class:"w-full md:w-3/12"},_e={class:"bg-white rounded-lg shadow mt-3 md:mt-0"},Pe={class:"border-b border-gray-200"},Te={class:"flex -mb-px justify-around"},Ae={class:"flex-1"},Xe={class:"flex-1"},je={key:0,class:"p-0"},Ue={class:"bg-white/80 p-3 rounded"},Be={class:"mt-2 block text-sm font-medium text-black"},Oe={key:1,class:"p-0"},Qe={class:"bg-white/80 p-3 rounded"},Me={class:"mt-3 relative bg-white rounded-lg shadow overflow-hidden"},Ve={key:0,class:"absolute right-0 top-0 h-16 w-16"},Re={class:"absolute transform rotate-45 bg-rose-600 text-sm text-center text-white font-medium py-1 left-[-64px] top-[32px] w-[170px]"},We={key:1,class:"absolute right-0 top-0 h-16 w-16"},Ne={class:"absolute transform rotate-45 bg-emerald-600 text-sm text-center text-white font-medium py-1 left-[-64px] top-[32px] w-[170px]"},qe={class:"px-5 py-5 sm:px-5"},Ke={class:"mt-1 flex items-center"},He={class:"flex"},ze={class:"relative flex cursor-pointer items-center py-1 px-1 border-r-[1px] pr-5 mr-1"},Ge={class:"relative text-sm font-medium text-blue-gray-900"},Je={class:"ml-3 rounded-md border border-transparent bg-transparent py-2 px-3 text-sm font-bold text-blue-gray-900 hover:text-blue-gray-700 focus:border-blue-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-blue-gray-50"},Ye={class:"font-medium"},Ze={class:"mt-1 flex items-center"},et={class:"flex"},tt={class:"relative flex cursor-pointer items-center py-1 px-1 border-r-[1px] pr-5 mr-1"},st={class:"relative text-sm font-medium text-blue-gray-900"},at={class:"ml-3 rounded-md border border-transparent bg-transparent py-2 px-3 text-sm font-bold text-blue-gray-900 hover:text-blue-gray-700 focus:border-blue-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-blue-gray-50"},ot={class:"font-medium"},it={class:"relative px-4 pt-5 pb-12 sm:px-6 sm:pt-6 border-t border-gray-200"},rt={class:"absolute rounded-md bg-indigo-500 p-3"},nt={class:"ml-16 truncate text-sm font-medium text-gray-500"},lt={class:"ml-16 flex items-baseline pb-6 sm:pb-7"},ct={class:"text-2xl font-semibold text-gray-900"},dt={class:"absolute inset-x-0 bottom-0 bg-gray-50 px-2 py-2 sm:px-3"},ut={class:"text-sm"},mt={key:0,class:"fixed inset-0 flex items-center justify-center z-10"},gt={class:"bg-white w-[600px] z-10 max-w-lg mx-auto rounded-lg overflow-hidden"},pt={class:"mb-4"},ht={class:"w-full"},bt={class:"px-6 py-4 whitespace-no-wrap"},xt={class:"px-6 py-4 whitespace-no-wrap"},yt={class:"px-6 py-4 whitespace-no-wrap"},ft=["onClick"],kt={class:"px-6 py-4 whitespace-no-wrap"},vt={class:"px-6 py-4 whitespace-no-wrap"},wt={class:"px-6 py-4 whitespace-no-wrap"},Lt=["onClick"],Ct={class:"p-4 bg-gray-100 flex justify-between"},Dt={class:"bg-green-500 hover:bg-green-700 text-white py-2 px-4 rounded"},St={key:2,class:"border-t border-gray-200 bg-gray-50 px-4 py-4 sm:px-6 text-right"},Ft={class:"grid grid-cols-2 gap-1"},It={class:"text-left text-sm text-rose-400 pt-3"},Et={key:1,"aria-labelledby":"applicant-information-title"},$t={key:2,"aria-labelledby":"applicant-information-title"},_t={class:"bg-white shadow sm:rounded-lg"},Pt={key:3,"aria-labelledby":"applicant-information-title"},Tt={class:"bg-white shadow sm:rounded-lg"},At={key:4,"aria-labelledby":"applicant-information-title"},Xt={class:"bg-white shadow sm:rounded-lg"},jt={key:5,"aria-labelledby":"applicant-information-title"},Ut={key:6,"aria-labelledby":"applicant-information-title"},Bt={key:7,"aria-labelledby":"applicant-information-title"},Ot={class:"bg-white shadow sm:rounded-lg"},Qt={key:8,"aria-labelledby":"applicant-information-title"},Mt={class:"bg-white shadow sm:rounded-lg"},Vt={key:9,"aria-labelledby":"applicant-information-title"},Rt={class:"bg-white shadow sm:rounded-lg"},Wt={key:10,"aria-labelledby":"applicant-information-title"},Nt={class:"bg-white shadow sm:rounded-lg"},qt={key:11,"aria-labelledby":"applicant-information-title"},Kt={class:"bg-white shadow sm:rounded-lg"},Ht={key:12,"aria-labelledby":"applicant-information-title"},zt={class:"bg-white shadow sm:rounded-lg"};function Gt(e,t,s,o,i,r){const n=(0,a.g2)("FileBrowser"),Gt=(0,a.g2)("Loader"),Jt=(0,a.g2)("Subhead"),Yt=(0,a.g2)("CourseIcon"),Zt=(0,a.g2)("font-awesome-icon"),es=(0,a.g2)("Tooltip"),ts=(0,a.g2)("Toggle"),ss=(0,a.g2)("router-link"),as=(0,a.g2)("MaterialList"),os=(0,a.g2)("FormList"),is=(0,a.g2)("ContestList"),rs=(0,a.g2)("DocumentList"),ns=(0,a.g2)("EnrollTable"),ls=(0,a.g2)("EnrollDashboard"),cs=(0,a.g2)("SurveyList"),ds=(0,a.g2)("CertificateList"),us=(0,a.g2)("Condition"),ms=(0,a.g2)("PipelineList"),gs=(0,a.g2)("Schedule"),ps=(0,a.g2)("AssignmentSubmission");return(0,a.uX)(),(0,a.CE)(a.FK,null,[i.FileBrowserOpen?((0,a.uX)(),(0,a.Wv)(n,{key:0,isWindowsOpen:!0,callbackFunction:"cover",allowFileType:["jpg","gif","png","jpeg"],onFileBrowserTrigger:r.changeFileTrigger,onFileBrowserCallback:r.selectFileTrigger},null,8,["onFileBrowserTrigger","onFileBrowserCallback"])):(0,a.Q3)("",!0),i.ThumbnailBrowserOpen?((0,a.uX)(),(0,a.Wv)(n,{key:1,isWindowsOpen:!0,callbackFunction:"thumbnail",allowFileType:["jpg","gif","png","jpeg"],onFileBrowserTrigger:r.changeThumbnailTrigger,onFileBrowserCallback:r.selectThumbnailTrigger},null,8,["onFileBrowserTrigger","onFileBrowserCallback"])):(0,a.Q3)("",!0),i.loading_sources?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",d,[(0,a.bF)(Gt)])),(0,a.bF)(Jt,{navigation:[{name:this.translate("general-back"),link:"/lesson/home#"+i.courseData.type,style:"chevron-left",class:"default-btn",visible:!0,type:"button"}]},null,8,["navigation"]),(0,a.Lk)("div",u,[i.loading_sources?((0,a.uX)(),(0,a.CE)("div",m,[(0,a.Lk)("div",g,[(0,a.Lk)("div",p,[(0,a.Lk)("div",null,[(0,a.Lk)("h1",h,[(0,a.bF)(Yt,{title:i.courseData.name,chcek:i.courseData.master},null,8,["title","chcek"])]),(0,a.Lk)("p",b,[(0,a.bF)(es,{title:"จำนวนบทเรียน",size:"12"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",x,[t[15]||(t[15]=(0,a.eW)(" 0 ")),(0,a.bF)(Zt,{icon:["fas","book"],class:"text-white mr-2"})])])),_:1}),(0,a.bF)(es,{title:"แบบทดสอบ",size:"12"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",y,[t[16]||(t[16]=(0,a.eW)(" 0 ")),(0,a.bF)(Zt,{icon:["fas","square-check"],class:"text-white mr-2"})])])),_:1}),(0,a.bF)(es,{title:"ผู้ลงทะเบียน",size:"12"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",f,[(0,a.eW)((0,l.v_)(void 0!==i.courseData.enroll?i.courseData.enroll.length:0)+" ",1),(0,a.bF)(Zt,{icon:["fas","user"],class:"text-white mr-2"})])])),_:1}),Array.isArray(i.courseData.categories)&&i.courseData.categories.length>0&&i.courseData.categories.filter(Boolean).length>0?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:0},(0,a.pI)(i.courseData.categories,(e=>((0,a.uX)(),(0,a.CE)("a",{key:e.id,href:"#",class:"text-xs font-medium bg-indigo-600 pl-2 pr-2 pt-1 pb-1 mr-1 rounded text-white"},(0,l.v_)(e.name),1)))),128)):((0,a.uX)(),(0,a.CE)("span",k,"ยังไม่มีหมวดหมู่"))])])])]),(0,a.Lk)("div",null,[(0,a.Lk)("div",v,[(0,a.Lk)("ul",w,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.tabs,(e=>((0,a.uX)(),(0,a.CE)(a.FK,{key:e.code},[r.isTabVisible(e)?((0,a.uX)(),(0,a.CE)("li",{key:0,class:(0,l.C4)([{"text-gray-500":i.activeTab!==e.code,"text-black":i.activeTab===e.code,"border-b-4 border-blue-500":i.activeTab===e.code},"cursor-pointer py-2 px-2"]),onClick:t=>r.setActiveTab(e.code)},[(0,a.Lk)("span",C,[(0,a.bF)(Zt,{icon:["fas",e.icon]},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(e.name)+" ",1),null!==e.badge?((0,a.uX)(),(0,a.CE)("span",D,(0,l.v_)(e.badge),1)):(0,a.Q3)("",!0)]),(0,a.Lk)("span",S,[(0,a.bF)(Zt,{icon:["fas",e.icon]},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(e.shortname),1)])],10,L)):(0,a.Q3)("",!0)],64)))),128))]),(0,a.Lk)("div",F,[(0,a.Lk)("div",{class:"dropdown",onClick:t[0]||(t[0]=e=>i.dropdownOpen=!i.dropdownOpen)},[(0,a.Lk)("div",I,[(0,a.Lk)("div",E,[(0,a.Lk)("div",$,[(0,a.Lk)("div",_,[(0,a.bF)(Zt,{icon:["fas",r.TabData.icon],class:"text-sm mr-2"},null,8,["icon"])]),(0,a.Lk)("div",P,[(0,a.Lk)("div",T,[(0,a.eW)((0,l.v_)(r.TabData.name)+" ",1),null!==r.TabData.badge?((0,a.uX)(),(0,a.CE)("span",A,(0,l.v_)(r.TabData.badge),1)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",X,(0,l.v_)(r.TabData.description),1)])]),(0,a.Lk)("div",j,[(0,a.bF)(Zt,{icon:i.dropdownOpen?["fas","caret-up"]:["fas","caret-down"],class:"text-sm ml-2"},null,8,["icon"])])])]),(0,a.bo)((0,a.Lk)("div",U,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.tabs,((e,t)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:t},[r.isTabVisible(e)?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"dropdown-item",onClick:t=>r.setActiveTab(e.code)},[(0,a.Lk)("div",O,[(0,a.Lk)("div",Q,[(0,a.Lk)("div",M,[(0,a.bF)(Zt,{icon:["fas",e.icon],class:"text-sm mr-2"},null,8,["icon"])]),(0,a.Lk)("div",V,[(0,a.Lk)("div",{class:(0,l.C4)(["status-name",{"font-bold":e.code===r.TabData.code}])},(0,l.v_)(e.name),3),(0,a.Lk)("div",R,(0,l.v_)(e.description),1)])]),(0,a.Lk)("div",W,[null!==e.badge?((0,a.uX)(),(0,a.CE)("span",N,(0,l.v_)(e.badge),1)):(0,a.Q3)("",!0)])])],8,B)):(0,a.Q3)("",!0)],64)))),128))],512),[[c.aG,i.dropdownOpen]])])])])])])):(0,a.Q3)("",!0)]),i.loading_sources?((0,a.uX)(),(0,a.CE)("div",q,[(0,a.Lk)("div",K,["detail"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",H,[(0,a.Lk)("div",z,[(0,a.Lk)("div",G,[(0,a.Lk)("div",J,[(0,a.Lk)("h2",Y,[(0,a.bF)(Zt,{icon:["fas","home"],class:"text-black mr-2"}),(0,a.eW)(" "+(0,l.v_)(r.translate("lesson-description")),1)]),(0,a.Lk)("div",Z,[(0,a.Lk)("button",{onClick:t[1]||(t[1]=t=>e.$router.push("/lesson/edit/"+this.dataItem+"/child/"+this.dataItem)),type:"button",class:"ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-100"},[(0,a.bF)(Zt,{icon:["fas","pencil"],class:"text-black pr-1"}),(0,a.eW)(" "+(0,l.v_)(r.translate("general-edit")),1)]),(0,a.Lk)("button",ee,[(0,a.bF)(Zt,{icon:["fas","trash"],class:"text-black pr-1"}),(0,a.eW)(" "+(0,l.v_)(r.translate("general-delete")),1)])])]),(0,a.Lk)("div",te,[(0,a.Lk)("div",se,[(0,a.Lk)("dl",ae,[(0,a.Lk)("div",oe,[(0,a.Lk)("dt",ie,(0,l.v_)(r.translate("lesson-category")),1),(0,a.Lk)("dd",re,(0,l.v_)(i.kindName),1)]),(0,a.Lk)("div",ne,[(0,a.Lk)("dt",le,(0,l.v_)(r.translate("lesson-mode")),1),(0,a.Lk)("dd",ce,(0,l.v_)(i.modeName),1)]),(0,a.Lk)("div",de,[(0,a.Lk)("dt",ue,(0,l.v_)(r.translate("lesson-display")),1),(0,a.Lk)("dd",me,(0,l.v_)(i.displayName),1)]),(0,a.Lk)("div",ge,[(0,a.Lk)("dt",pe,(0,l.v_)(r.translate("lesson-price")),1),(0,a.Lk)("dd",he,(0,l.v_)(i.courseData.regular_price)+" ("+(0,l.v_)(i.courseData.sale_price)+")",1)])])])])]),(0,a.Lk)("div",be,[(0,a.Lk)("div",xe,[(0,a.Lk)("h2",ye,(0,l.v_)(r.translate("lesson-content")),1)]),(0,a.Lk)("div",fe,[void 0!=i.description&&""!=i.description?((0,a.uX)(),(0,a.CE)("div",ke,[t[17]||(t[17]=(0,a.Lk)("h2",{id:"applicant-information-title",class:"leading-6 text-sm font-bold text-black"},"คำอธิบาย",-1)),(0,a.Lk)("div",{innerHTML:i.description},null,8,ve)])):(0,a.Q3)("",!0),void 0!=i.principles&&""!=i.principles?((0,a.uX)(),(0,a.CE)("div",we,[t[18]||(t[18]=(0,a.Lk)("h2",{id:"applicant-information-title",class:"leading-6 text-sm font-bold text-black"},"หลักการและเหตุผล",-1)),(0,a.Lk)("div",{innerHTML:i.description},null,8,Le)])):(0,a.Q3)("",!0),void 0!=i.objective&&""!=i.objective?((0,a.uX)(),(0,a.CE)("div",Ce,[t[19]||(t[19]=(0,a.Lk)("h2",{id:"applicant-information-title",class:"leading-6 text-sm font-bold text-black"},"วัตถุประสงค์",-1)),(0,a.Lk)("div",{innerHTML:i.objective},null,8,De)])):(0,a.Q3)("",!0),i.target&&i.target.length>0?((0,a.uX)(),(0,a.CE)("div",Se,[t[20]||(t[20]=(0,a.Lk)("h2",{id:"applicant-information-title",class:"leading-6 text-sm font-bold text-black"},"กลุ่มเป้าหมาย",-1)),(0,a.Lk)("div",Fe,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.target,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:"bg-blue-500 text-white rounded-sm px-2 py-1 text-xs"},(0,l.v_)(e.name),1)))),128))])])):(0,a.Q3)("",!0),void 0!=i.structure&&""!=i.structure?((0,a.uX)(),(0,a.CE)("div",Ie,[t[21]||(t[21]=(0,a.Lk)("h2",{id:"applicant-information-title",class:"leading-6 text-sm font-bold text-black"},"โครงสร้างหลักสูตร",-1)),(0,a.Lk)("div",{innerHTML:i.structure},null,8,Ee)])):(0,a.Q3)("",!0)])])]),(0,a.Lk)("div",$e,[(0,a.Lk)("div",_e,[(0,a.Lk)("div",Pe,[(0,a.Lk)("ul",Te,[(0,a.Lk)("li",Ae,[(0,a.Lk)("a",{href:"#",onClick:t[2]||(t[2]=(0,c.D$)((e=>i.activeSubTab="cover"),["prevent"])),class:(0,l.C4)([{"border-indigo-500 text-indigo-600":"cover"===i.activeSubTab,"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300":"cover"!==i.activeSubTab},"block text-center whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm"])}," Thumbnail ",2)]),(0,a.Lk)("li",Xe,[(0,a.Lk)("a",{href:"#",onClick:t[3]||(t[3]=(0,c.D$)((e=>i.activeSubTab="thumbnail"),["prevent"])),class:(0,l.C4)([{"border-indigo-500 text-indigo-600":"thumbnail"===i.activeSubTab,"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300":"thumbnail"!==i.activeSubTab},"block text-center whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm"])}," Cover ",2)])])]),"cover"===i.activeSubTab?((0,a.uX)(),(0,a.CE)("div",je,[(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.OpenFileBrowser&&r.OpenFileBrowser(...e)),type:"button",style:(0,l.Tr)({"background-image":"url("+this.cover+")"}),class:"relative bg-cover block w-full rounded-b-lg border-t-0 border-2 border-dashed border-gray-300 p-12 text-center hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},[(0,a.Lk)("div",Ue,[(0,a.bF)(Zt,{icon:["fas","cloud-upload"],class:"mx-auto h-12 w-12 text-black"}),(0,a.Lk)("span",Be,(0,l.v_)(r.translate("lesson-cover")),1)])],4)])):(0,a.Q3)("",!0),"thumbnail"===i.activeSubTab?((0,a.uX)(),(0,a.CE)("div",Oe,[(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>r.OpenThumbnailBrowser&&r.OpenThumbnailBrowser(...e)),type:"button",style:(0,l.Tr)({"background-image":"url("+this.thumbnail+")"}),class:"relative bg-cover block w-full rounded-b-lg border-t-0 border-2 border-dashed border-gray-300 p-12 text-center hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},[(0,a.Lk)("div",Qe,[(0,a.bF)(Zt,{icon:["fas","images"],class:"mx-auto h-12 w-12 text-black"}),t[22]||(t[22]=(0,a.Lk)("span",{class:"mt-2 block text-sm font-medium text-black"},"Thumbnail",-1))])],4)])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",Me,[this.master?((0,a.uX)(),(0,a.CE)("div",Ve,[(0,a.Lk)("div",Re,(0,l.v_)(r.translate("lesson-master")),1)])):(0,a.Q3)("",!0),this.master?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",We,[(0,a.Lk)("div",Ne,(0,l.v_)(r.translate("lesson-mirror")),1)])),(0,a.Lk)("div",qe,[(0,a.Lk)("div",Ke,[(0,a.Lk)("div",He,[(0,a.Lk)("div",ze,[(0,a.Lk)("div",Ge,[(0,a.Lk)("span",null,[(0,a.bF)(ts,{modelValue:i.status,"onUpdate:modelValue":t[6]||(t[6]=e=>i.status=e),onChange:r.toggleStatus},null,8,["modelValue","onChange"])])])]),(0,a.Lk)("div",Je,[(0,a.eW)((0,l.v_)(r.translate("lesson-display-method"))+" ",1),(0,a.Lk)("p",Ye,(0,l.v_)(i.status?"แสดงหน้าเว็บ":"ไม่แสดง"),1)])])]),(0,a.Lk)("div",Ze,[(0,a.Lk)("div",et,[(0,a.Lk)("div",tt,[(0,a.Lk)("div",st,[(0,a.Lk)("span",null,[(0,a.bF)(ts,{modelValue:i.visibility,"onUpdate:modelValue":t[7]||(t[7]=e=>i.visibility=e),onChange:r.toggleVisibility},null,8,["modelValue","onChange"])])])]),(0,a.Lk)("div",at,[(0,a.eW)((0,l.v_)(r.translate("lesson-register-method"))+" ",1),(0,a.Lk)("p",ot,(0,l.v_)(i.visibility?"ลงทะเบียนได้ทุกคน":"จำกัดผู้ลงทะเบียน"),1)])])])]),(0,a.Lk)("div",it,[(0,a.Lk)("dt",null,[(0,a.Lk)("div",rt,[(0,a.bF)(Zt,{icon:["fas","user-tie"],class:"h-6 w-6 text-white"})]),(0,a.Lk)("p",nt,(0,l.v_)(r.translate("lesson-staff")),1)]),(0,a.Lk)("dd",lt,[(0,a.Lk)("p",ct,(0,l.v_)(i.courseData.admin&&Array.isArray(i.courseData.admin)&&i.courseData.admin.length>0?i.courseData.admin.length:"0"),1),t[29]||(t[29]=(0,a.Lk)("p",{class:"ml-2 flex items-baseline text-sm font-semibold text-green-600"},[(0,a.Lk)("svg",{class:"h-5 w-5 flex-shrink-0 self-center text-green-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z","clip-rule":"evenodd"})]),(0,a.Lk)("span",{class:"sr-only"}," Increased by "),(0,a.eW)(" 0 ")],-1)),(0,a.Lk)("div",dt,[(0,a.Lk)("div",ut,[(0,a.Lk)("div",null,[(0,a.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>r.openModal&&r.openModal(...e)),class:"bg-blue-500 hover:bg-blue-700 text-white py-2 px-4 rounded w-full"},[(0,a.bF)(Zt,{icon:["fas","edit"],class:"pr-2 pl-2"}),(0,a.eW)(" "+(0,l.v_)(r.translate("lesson-managestaff")),1)]),i.modalOpen?((0,a.uX)(),(0,a.CE)("div",mt,[t[28]||(t[28]=(0,a.Lk)("div",{class:"absolute inset-0 bg-black opacity-75"},null,-1)),(0,a.Lk)("div",gt,[(0,a.Lk)("form",{onSubmit:t[11]||(t[11]=(0,c.D$)(((...e)=>r.performSearch&&r.performSearch(...e)),["prevent"])),class:"p-6"},[(0,a.Lk)("div",pt,[t[23]||(t[23]=(0,a.Lk)("label",{for:"searchQuery",class:"block text-gray-700 font-bold mb-2"},"ค้นหาข้อมูลเจ้าหน้าที่:",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text",id:"searchQuery","onUpdate:modelValue":t[9]||(t[9]=e=>i.searchQuery=e),onInput:t[10]||(t[10]=(...e)=>r.autoSearch&&r.autoSearch(...e)),placeholder:"ค้นหาจาก ชื่อผู้ใช้ อีเมล์ ชื่อ-นามสกุล หรือ เบอร์โทร...",class:"border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"},null,544),[[c.Jo,i.searchQuery]])])],32),(0,a.Lk)("table",ht,[t[26]||(t[26]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",{class:"px-6 py-3 bg-gray-200 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider"},"Name"),(0,a.Lk)("th",{class:"px-6 py-3 bg-gray-200 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider"},"Email"),(0,a.Lk)("th",{class:"px-6 py-3 bg-gray-200 text-left text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider"},"Action")])],-1)),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.filteredResults,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.id},[(0,a.Lk)("td",bt,(0,l.v_)(e.firstname)+" "+(0,l.v_)(e.lastname),1),(0,a.Lk)("td",xt,(0,l.v_)(e.email),1),(0,a.Lk)("td",yt,[(0,a.Lk)("button",{onClick:t=>r.assignManager(e),class:"bg-blue-500 hover:bg-blue-700 text-white p-2 rounded"},[(0,a.bF)(Zt,{icon:["fas","plus"],class:"h-3 w-3 text-white"}),t[24]||(t[24]=(0,a.eW)(" Assign"))],8,ft)])])))),128)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.filteredAdmin,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e._id},[(0,a.Lk)("td",kt,(0,l.v_)(e.firstname)+" "+(0,l.v_)(e.lastname),1),(0,a.Lk)("td",vt,(0,l.v_)(e.email),1),(0,a.Lk)("td",wt,[(0,a.Lk)("button",{onClick:t=>r.unassignManager(e),class:"bg-red-500 hover:bg-red-700 text-white p-2 rounded"},[(0,a.bF)(Zt,{icon:["fas","trash"],class:"h-3 w-3 text-white"}),t[25]||(t[25]=(0,a.eW)(" ลบ"))],8,Lt)])])))),128))])]),(0,a.Lk)("div",Ct,[(0,a.bF)(ss,{to:"/setup/admin",class:""},{default:(0,a.k6)((()=>[(0,a.Lk)("button",Dt,[(0,a.bF)(Zt,{icon:["fas","user-tie"],class:"h-3 w-3 text-white"}),t[27]||(t[27]=(0,a.eW)(" รายชื่อเจ้าหน้าที่ "))])])),_:1}),(0,a.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>r.closeModal&&r.closeModal(...e)),class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"}," ปิด ")])])])):(0,a.Q3)("",!0)])])])])]),"none"==i.courseData.master||this.master?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",St,[(0,a.Lk)("div",Ft,[(0,a.Lk)("button",{onClick:t[13]||(t[13]=t=>e.$router.push("/lesson/edit/"+i.courseData.master+"/master/"+this.dataItem)),type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent bg-gray-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},[(0,a.bF)(Zt,{icon:["fas","edit"],class:"pr-2 pl-2"}),(0,a.eW)((0,l.v_)(r.translate("lesson-edit-master")),1)]),(0,a.Lk)("button",{onClick:t[14]||(t[14]=e=>r.unlinkMaster()),type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent bg-rose-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},[(0,a.bF)(Zt,{icon:["fas","save"],class:"pr-2 pl-2"}),(0,a.eW)((0,l.v_)(r.translate("lesson-unlink-master")),1)])]),(0,a.Lk)("p",It,(0,l.v_)(r.translate("lesson-unlink-comment")),1)]))])])])):(0,a.Q3)("",!0),"material"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",Et,[(0,a.bF)(as,{ref:"material",tabs:r.TabData,dataItem:i.dataItem},null,8,["tabs","dataItem"])])):(0,a.Q3)("",!0),"form"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",$t,[(0,a.Lk)("div",_t,[(0,a.bF)(os,{ref:"form",tabs:r.TabData,examCount:i.examCount,courseData:i.courseData,dataItem:i.dataItem,examData:i.examData,callParentFunctionProp:r.getQueryData},null,8,["tabs","examCount","courseData","dataItem","examData","callParentFunctionProp"])])])):(0,a.Q3)("",!0),"contest"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",Pt,[(0,a.Lk)("div",Tt,[(0,a.bF)(is,{ref:"contest",tabs:r.TabData,examCount:i.examCount,courseData:i.courseData,dataItem:i.dataItem,examData:i.examData},null,8,["tabs","examCount","courseData","dataItem","examData"])])])):(0,a.Q3)("",!0),"document"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",At,[(0,a.Lk)("div",Xt,[(0,a.bF)(rs,{ref:"document",tabs:r.TabData,documentData:i.documentData,courseData:i.courseData,onDeleteDocument:r.handleDeleteDocument,onAddDocument:r.handleAddDocument},null,8,["tabs","documentData","courseData","onDeleteDocument","onAddDocument"])])])):(0,a.Q3)("",!0),"enroll"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",jt,[(0,a.bF)(ns,{ref:"enroll",tabs:r.TabData,pageTitle:"ผู้ลงทะเบียนหลักสูตรนี้",courseData:i.courseData},null,8,["tabs","courseData"])])):(0,a.Q3)("",!0),"dashboard"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",Ut,[(0,a.bF)(ls,{ref:"enroll",tabs:r.TabData,pageTitle:"ผู้ลงทะเบียนหลักสูตรนี้",courseData:i.courseData,isPublic:!1},null,8,["tabs","courseData"])])):(0,a.Q3)("",!0),"survey"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",Bt,[(0,a.Lk)("div",Ot,[(0,a.bF)(cs,{ref:"survey",tabs:r.TabData,examCount:i.examCount,courseData:i.courseData,dataItem:i.dataItem,examData:i.examData,callParentFunctionProp:r.getQueryData},null,8,["tabs","examCount","courseData","dataItem","examData","callParentFunctionProp"])])])):(0,a.Q3)("",!0),"certification"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",Qt,[(0,a.Lk)("div",Mt,[(0,a.bF)(ds,{ref:"certification",tabs:r.TabData,examCount:i.examCount,courseData:i.courseData,dataItem:i.dataItem,examData:i.examData,callParentFunctionProp:r.getQueryData},null,8,["tabs","examCount","courseData","dataItem","examData","callParentFunctionProp"])])])):(0,a.Q3)("",!0),"condition"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",Vt,[(0,a.Lk)("div",Rt,[(0,a.bF)(us,{ref:"condition",tabs:r.TabData,examCount:i.examCount,courseData:i.courseData,dataItem:i.dataItem,examData:i.examData,callParentFunctionProp:r.getQueryData},null,8,["tabs","examCount","courseData","dataItem","examData","callParentFunctionProp"])])])):(0,a.Q3)("",!0),"learning_path"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",Wt,[(0,a.Lk)("div",Nt,[(0,a.bF)(ms,{ref:"pipeline",tabs:r.TabData,courseData:i.courseData,dataItem:i.dataItem,callParentFunctionProp:r.getQueryData,onUpdateBadge:r.handleUpdateBadge},null,8,["tabs","courseData","dataItem","callParentFunctionProp","onUpdateBadge"])])])):(0,a.Q3)("",!0),"schedule"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",qt,[(0,a.Lk)("div",Kt,[(0,a.bF)(gs,{ref:"schedule",tabs:r.TabData,documentData:i.documentData,courseData:i.courseData,onDeleteDocument:r.handleDeleteDocument,onAddDocument:r.handleAddDocument},null,8,["tabs","documentData","courseData","onDeleteDocument","onAddDocument"])])])):(0,a.Q3)("",!0),"assignment"===i.activeTab?((0,a.uX)(),(0,a.CE)("section",Ht,[(0,a.Lk)("div",zt,[(0,a.bF)(ps,{ref:"assignment",tabs:r.TabData,courseData:i.courseData,dataItem:i.dataItem,callParentFunctionProp:r.getQueryData,onUpdateBadge:r.handleUpdateBadge},null,8,["tabs","courseData","dataItem","callParentFunctionProp","onUpdateBadge"])])])):(0,a.Q3)("",!0)])])):(0,a.Q3)("",!0)],64)}s(16573),s(78100),s(77936),s(17642),s(58004),s(33853),s(45876),s(32475),s(15024),s(31698),s(37467),s(44732),s(79577),s(72577),s(3949),s(8872),s(37550);var Jt=s(93426),Yt=s(87054),Zt=s(50953),es=s(59911),ts=s.n(es),ss=s(75435),as=s(69505),os=s(40687),is=s(49170),rs=s(87814),ns=s(9964),ls=s(95093),cs=s.n(ls),ds=s(77066);const us={class:"bg-white rounded-lg shadow-sm border border-gray-200"},ms={class:"px-4 py-3 border-b border-gray-200"},gs={class:"flex items-center justify-between"},ps={class:"flex items-center space-x-3"},hs={class:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg flex items-center justify-center"},bs={class:"text-xs text-gray-500"},xs={class:"flex items-center space-x-2"},ys={class:"bg-blue-50 border-l-4 border-blue-400 p-3"},fs={class:"flex"},ks={class:"flex-shrink-0"},vs={class:"p-4"},ws={class:"grid grid-cols-4 gap-4 mb-6"},Ls={class:"bg-indigo-50 rounded-lg p-3 border border-indigo-100"},Cs={class:"text-lg font-semibold text-indigo-900"},Ds={class:"bg-green-50 rounded-lg p-3 border border-green-100"},Ss={class:"text-lg font-semibold text-green-900"},Fs={class:"bg-purple-50 rounded-lg p-3 border border-purple-100"},Is={class:"text-lg font-semibold text-purple-900"},Es={class:"bg-blue-50 rounded-lg p-3 border border-blue-100"},$s={class:"text-lg font-semibold text-blue-900"},_s={key:0,class:"mb-6 bg-gray-50 rounded-lg border border-gray-200 p-4"},Ps={class:"flex items-center justify-between"},Ts={class:"flex items-center space-x-2"},As={class:"flex items-center space-x-2"},Xs=["value"],js=["value"],Us={key:1,class:"space-y-4",id:"root-panel"},Bs={key:0,class:"text-center py-12"},Os={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},Qs={class:"text-sm text-gray-500"},Ms={key:1,class:"text-center py-12"},Vs={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},Rs={class:"flex justify-center space-x-3"},Ws={key:2,class:"space-y-2"},Ns=["id"],qs={key:0,class:"p-4 bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-yellow-400"},Ks=["onClick"],Hs={class:"flex items-center space-x-3 flex-1 cursor-pointer"},zs={class:"handle cursor-move p-1 hover:bg-yellow-100 rounded"},Gs={class:"w-10 h-10 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-lg flex items-center justify-center text-white"},Js={class:"flex-1 min-w-0"},Ys={class:"flex items-center space-x-2"},Zs={class:"text-sm font-medium text-gray-900"},ea={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},ta={class:"flex items-center space-x-3 mt-1 text-xs text-gray-500"},sa={class:"flex items-center"},aa={class:"flex items-center"},oa={class:"flex items-center"},ia={class:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity"},ra=["onClick"],na=["onClick"],la=["onClick"],ca={key:0,class:"mt-4 space-y-2"},da={class:"border-t border-yellow-200 pt-4"},ua={class:"text-sm font-medium text-gray-700 mb-3 flex items-center"},ma=["onClick"],ga={class:"flex items-center space-x-3 flex-1 cursor-pointer"},pa={class:"handle cursor-move p-1 hover:bg-gray-100 rounded"},ha={class:"flex-1 min-w-0"},ba={class:"flex items-center space-x-2"},xa={class:"text-sm font-medium text-gray-900"},ya={key:0,class:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},fa={class:"flex items-center space-x-2 mt-1 text-xs text-gray-500"},ka={class:"flex items-center"},va={class:"flex items-center"},wa={class:"flex items-center space-x-1"},La=["onClick"],Ca={key:0,class:"border-t border-gray-200 mt-3 pt-3"},Da={class:"p-4"},Sa=["onClick"],Fa={class:"flex items-center space-x-3 flex-1 cursor-pointer"},Ia={class:"handle cursor-move p-1 hover:bg-gray-100 rounded"},Ea={class:"w-10 h-10 rounded-lg overflow-hidden bg-gray-100"},$a=["src"],_a={class:"flex-1 min-w-0"},Pa={class:"flex items-center space-x-2"},Ta={class:"text-sm font-medium text-gray-900"},Aa={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Xa={class:"flex items-center space-x-3 mt-1 text-xs text-gray-500"},ja={class:"flex items-center"},Ua={class:"flex items-center"},Ba={class:"flex items-center"},Oa={class:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity"},Qa=["onClick"],Ma=["onClick"],Va={key:0,class:"border-t border-gray-200 bg-gray-50"},Ra={key:2,class:"space-y-4"},Wa={class:"bg-white rounded-lg border border-gray-200 p-4"},Na={class:"flex items-center justify-between mb-4"},qa={class:"flex items-center space-x-3"},Ka={class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},Ha={class:"bg-gray-50 rounded-lg p-4"},za={key:0,class:"flex items-center justify-between"},Ga={class:"flex items-center space-x-3"},Ja={class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},Ya={class:"text-sm font-medium text-gray-900"},Za={key:1,class:"text-center py-6"},eo={key:1,class:"fixed inset-0 flex items-center justify-center z-50"},to={class:"bg-white rounded-lg shadow-xl z-20 w-96 max-w-md mx-4"},so={class:"p-6"},ao={class:"flex items-center justify-between mb-4"},oo={class:"space-y-3 max-h-64 overflow-y-auto"},io=["value"],ro={class:"flex-1"},no={class:"text-sm font-medium text-gray-900"},lo={class:"flex justify-end space-x-3 mt-6"},co=["disabled"];function uo(e,t,s,o,i,r){const n=(0,a.g2)("FileBrowser"),d=(0,a.g2)("font-awesome-icon"),u=(0,a.g2)("PlayerEditor"),m=(0,a.g2)("draggable"),g=(0,a.g2)("router-link");return(0,a.uX)(),(0,a.CE)(a.FK,null,[i.FileBrowserOpen?((0,a.uX)(),(0,a.Wv)(n,{key:0,isWindowsOpen:!0,callbackFunction:"cover",allowFileType:["jpg","gif","png","jpeg"],onFileBrowserTrigger:r.changeFileTrigger,onFileBrowserCallback:r.selectFileTrigger},null,8,["onFileBrowserTrigger","onFileBrowserCallback"])):(0,a.Q3)("",!0),(0,a.Lk)("div",us,[(0,a.Lk)("div",ms,[(0,a.Lk)("div",gs,[(0,a.Lk)("div",ps,[(0,a.Lk)("div",hs,[(0,a.bF)(d,{icon:["fas","book"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[15]||(t[15]=(0,a.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"จัดการบทเรียน",-1)),(0,a.Lk)("p",bs,"จัดการเนื้อหาและสื่อการเรียนรู้ ("+(0,l.v_)(i.playerCount)+" รายการ)",1)])]),(0,a.Lk)("div",xs,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=e=>r.addPlayer("demand",i.playerCount,i.courseData.name)),class:"inline-flex items-center rounded-lg border border-transparent bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(d,{icon:["fas","plus"],class:"text-white mr-1.5"}),t[16]||(t[16]=(0,a.eW)(" เพิ่มบทเรียน "))]),(0,a.Lk)("button",{onClick:t[1]||(t[1]=e=>r.addPlayer("folder",i.playerCount,i.courseData.name)),class:"inline-flex items-center rounded-lg border border-transparent bg-yellow-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(d,{icon:["fas","folder-plus"],class:"text-white mr-1.5"}),t[17]||(t[17]=(0,a.eW)(" เพิ่มโฟลเดอร์ "))])])])]),(0,a.Lk)("div",ys,[(0,a.Lk)("div",fs,[(0,a.Lk)("div",ks,[(0,a.bF)(d,{icon:["fas","info-circle"],class:"text-blue-400 text-sm"})]),t[18]||(t[18]=(0,a.Lk)("div",{class:"ml-2"},[(0,a.Lk)("p",{class:"text-xs text-blue-700"},[(0,a.Lk)("strong",null,"หมายเหตุ:"),(0,a.eW)(" จัดการเนื้อหาบทเรียน วิดีโอ เอกสาร และแบบทดสอบสำหรับหลักสูตรนี้ ")])],-1))])]),(0,a.Lk)("div",vs,[(0,a.Lk)("div",ws,[(0,a.Lk)("div",Ls,[t[19]||(t[19]=(0,a.Lk)("div",{class:"text-xs font-medium text-indigo-600"},"บทเรียนทั้งหมด",-1)),(0,a.Lk)("div",Cs,(0,l.v_)(i.playerCount),1)]),(0,a.Lk)("div",Ds,[t[20]||(t[20]=(0,a.Lk)("div",{class:"text-xs font-medium text-green-600"},"โฟลเดอร์",-1)),(0,a.Lk)("div",Ss,(0,l.v_)(r.folderCount),1)]),(0,a.Lk)("div",Fs,[t[21]||(t[21]=(0,a.Lk)("div",{class:"text-xs font-medium text-purple-600"},"เอกสาร",-1)),(0,a.Lk)("div",Is,(0,l.v_)(r.documentCount),1)]),(0,a.Lk)("div",Es,[t[22]||(t[22]=(0,a.Lk)("div",{class:"text-xs font-medium text-blue-600"},"วิดีโอ",-1)),(0,a.Lk)("div",$s,(0,l.v_)(r.videoCount),1)])]),this.master||"none"==i.courseData.master?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",_s,[(0,a.Lk)("div",Ps,[(0,a.Lk)("div",Ts,[(0,a.bF)(d,{icon:["fas","link"],class:"text-gray-500"}),t[23]||(t[23]=(0,a.Lk)("span",{class:"text-sm font-medium text-gray-700"},"ใช้ข้อมูลบทเรียนจาก",-1))]),(0,a.Lk)("div",As,[(0,a.bo)((0,a.Lk)("select",{onChange:t[2]||(t[2]=e=>r.changePlayerRef(e)),"onUpdate:modelValue":t[3]||(t[3]=e=>i.playerRef=e),class:"block w-48 rounded-lg border-gray-300 text-sm focus:border-indigo-500 focus:ring-indigo-500"},[(0,a.Lk)("option",{value:i.courseData.master},"Master Data",8,Xs),(0,a.Lk)("option",{value:this.dataItem},"หลักสูตรนี้",8,js)],544),[[c.u1,i.playerRef]])])])])),"onsite"!=i.courseData.type?((0,a.uX)(),(0,a.CE)("div",Us,[i.activeBlock?((0,a.uX)(),(0,a.CE)("div",Bs,[(0,a.Lk)("div",Os,[(0,a.bF)(d,{icon:["fas","spinner"],class:"text-gray-400 text-lg animate-spin"})]),t[24]||(t[24]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"กำลังโหลด",-1)),(0,a.Lk)("p",Qs,(0,l.v_)(i.activeBlock_text),1)])):0===i.playerParent.length?((0,a.uX)(),(0,a.CE)("div",Ms,[(0,a.Lk)("div",Vs,[(0,a.bF)(d,{icon:["fas","book-open"],class:"text-gray-400 text-lg"})]),t[26]||(t[26]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ยังไม่มีบทเรียน",-1)),t[27]||(t[27]=(0,a.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"เริ่มต้นสร้างบทเรียนสำหรับหลักสูตรของคุณ",-1)),(0,a.Lk)("div",Rs,[(0,a.Lk)("button",{onClick:t[4]||(t[4]=e=>r.addPlayer("demand",i.playerCount,i.courseData.name)),class:"inline-flex items-center rounded-lg border border-transparent bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(d,{icon:["fas","plus"],class:"mr-1.5"}),t[25]||(t[25]=(0,a.eW)(" เพิ่มบทเรียนแรก "))])])])):((0,a.uX)(),(0,a.CE)("div",Ws,[(0,a.bF)(m,(0,a.v6)({role:"list_parent",tag:"div",list:i.playerParent,handle:".handle"},r.dragOptions,{onChange:r.log,move:r.checkMove,onStart:t[7]||(t[7]=t=>e.isDragging=!0),onEnd:t[8]||(t[8]=t=>e.isDragging=!1),class:"space-y-2"}),{default:(0,a.k6)((()=>[(0,a.bF)(c.F,{name:"material",tag:"div",class:"space-y-2"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.playerParent,((s,o)=>((0,a.uX)(),(0,a.CE)("div",{key:s.id,class:(0,l.C4)(["group bg-white border border-gray-200 rounded-lg hover:border-gray-300 hover:shadow-md transition-all duration-200",{"border-indigo-300 bg-indigo-50":i.selectedPlayerIndex===o}]),id:`panel-${o}`},["folder"===s.type&&"sub"!=s.mode?((0,a.uX)(),(0,a.CE)("div",qs,[(0,a.Lk)("div",{class:"flex items-center justify-between",onClick:e=>r.togglePanel(o,s)},[(0,a.Lk)("div",Hs,[(0,a.Lk)("div",zs,[(0,a.bF)(d,{icon:["fas","grip-vertical"],class:"text-gray-400"})]),(0,a.Lk)("div",Gs,[(0,a.bF)(d,{icon:["fas","folder"],class:"text-lg"})]),(0,a.Lk)("div",Js,[(0,a.Lk)("div",Ys,[(0,a.Lk)("h3",Zs,(0,l.v_)(s.name),1),s.demo?((0,a.uX)(),(0,a.CE)("span",ea," ตัวอย่าง ")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",ta,[(0,a.Lk)("span",sa,[(0,a.bF)(d,{icon:["fas","items"],class:"mr-1 text-yellow-500"}),(0,a.eW)(" "+(0,l.v_)(i.playerFolder[s._id]?.length||0)+" รายการ ",1)]),t[28]||(t[28]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",aa,[(0,a.bF)(d,{icon:["fas","code"],class:"mr-1 text-gray-400"}),(0,a.eW)(" "+(0,l.v_)(s.slug),1)]),t[29]||(t[29]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",oa,[(0,a.bF)(d,{icon:["fas","tag"],class:"mr-1 text-gray-400"}),(0,a.eW)(" "+(0,l.v_)(r.getPlayerTypeName(s.type)),1)])])])]),(0,a.Lk)("div",ia,[(0,a.Lk)("button",{onClick:(0,c.D$)((e=>r.addPlayer("demand",i.playerFolder[s._id].length,i.courseData.name+" - "+s.name,s._id)),["stop"]),class:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:"เพิ่มบทเรียน"},[(0,a.bF)(d,{icon:["fas","plus"],class:"text-sm"})],8,ra),(0,a.Lk)("button",{onClick:(0,c.D$)((e=>r.deleteParentPlayer(s._id)),["stop"]),class:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"ลบโฟลเดอร์"},[(0,a.bF)(d,{icon:["fas","trash"],class:"text-sm"})],8,na),(0,a.Lk)("button",{onClick:(0,c.D$)((e=>r.togglePanel(o,s)),["stop"]),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded transition-colors",title:"ตั้งค่า"},[(0,a.bF)(d,{icon:["fas",i.selectedPlayerIndex===o?"chevron-up":"chevron-down"],class:"text-sm"},null,8,["icon"])],8,la)])],8,Ks),i.selectedPlayerIndex===o&&i.playerFolder[s._id]?((0,a.uX)(),(0,a.CE)("div",ca,[(0,a.Lk)("div",da,[(0,a.Lk)("h4",ua,[(0,a.bF)(d,{icon:["fas","list"],class:"mr-2 text-yellow-500"}),t[30]||(t[30]=(0,a.eW)(" รายการในโฟลเดอร์ "))]),(0,a.bF)(m,(0,a.v6)({role:"list_sub",tag:"div",list:i.playerFolder[s._id],handle:".handle",ref_for:!0},r.dragOptions,{onChange:e.logSub,move:r.checkMove,onStart:t[5]||(t[5]=t=>e.isDragging=!0),onEnd:t[6]||(t[6]=t=>e.isDragging=!1),class:"space-y-2"}),{default:(0,a.k6)((()=>[(0,a.bF)(c.F,{name:"sub-material",tag:"div",class:"space-y-2"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.playerFolder[s._id],((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"bg-white border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-shadow"},[(0,a.Lk)("div",{class:"flex items-center justify-between",onClick:(0,c.D$)((t=>r.toggleSubPanel(o,s,e)),["stop"])},[(0,a.Lk)("div",ga,[(0,a.Lk)("div",pa,[(0,a.bF)(d,{icon:["fas","grip-vertical"],class:"text-gray-400 text-xs"})]),(0,a.Lk)("div",{class:(0,l.C4)(["w-8 h-8 rounded-lg flex items-center justify-center text-white",r.getSubItemIconColor(e.type)])},[(0,a.bF)(d,{icon:r.getIconForSubItem(e.type),class:"text-sm"},null,8,["icon"])],2),(0,a.Lk)("div",ha,[(0,a.Lk)("div",ba,[(0,a.Lk)("h5",xa,(0,l.v_)(e.name),1),e.demo?((0,a.uX)(),(0,a.CE)("span",ya," ตัวอย่าง ")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",fa,[(0,a.Lk)("span",ka,[(0,a.bF)(d,{icon:["fas","clock"],class:"mr-1"}),(0,a.eW)(" "+(0,l.v_)(e.duration)+" นาที ",1)]),t[31]||(t[31]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",va,[(0,a.bF)(d,{icon:["fas","tag"],class:"mr-1"}),(0,a.eW)(" "+(0,l.v_)(r.getPlayerTypeName(e.type)),1)])])])]),(0,a.Lk)("div",wa,[(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.deletePlayer(e)),["stop"]),class:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"ลบ"},[(0,a.bF)(d,{icon:["fas","trash"],class:"text-xs"})],8,La)])],8,ma),r.isOpenSubPanel(o,s)?((0,a.uX)(),(0,a.CE)("div",Ca,[(0,a.bF)(u,{onClick:(0,c.D$)(r.handleCheckboxClick,["stop"]),"select-player-item":e,onUpdateSelectPlayerItem:r.updataPlayer,onUpdatePlayerVideo:r.updataVideo,onUpdatePlayerDocument:r.updataDocument,onUpdatePlayerExam:r.updataExam,onUpdatePlayerVideoUrl:r.SetContentSource,onDeleteSelectPlayerItem:r.deletePlayer,onCancelUpdate:r.hideSubPanel,onUpdatePlayerData:r.reloadPlayerData,onReopenSelectedItem:t=>r.handleReopenItem(e)},null,8,["onClick","select-player-item","onUpdateSelectPlayerItem","onUpdatePlayerVideo","onUpdatePlayerDocument","onUpdatePlayerExam","onUpdatePlayerVideoUrl","onDeleteSelectPlayerItem","onCancelUpdate","onUpdatePlayerData","onReopenSelectedItem"])])):(0,a.Q3)("",!0)])))),128))])),_:2},1024)])),_:2},1040,["list","onChange","move"])])])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),"folder"!=s.type&&"sub"!=s.mode?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.Lk)("div",Da,[(0,a.Lk)("div",{class:"flex items-center justify-between",onClick:(0,c.D$)((e=>r.togglePanel(o,s)),["stop"])},[(0,a.Lk)("div",Fa,[(0,a.Lk)("div",Ia,[(0,a.bF)(d,{icon:["fas","grip-vertical"],class:"text-gray-400"})]),(0,a.Lk)("div",Ea,[(0,a.Lk)("img",{class:"w-full h-full object-cover",src:s.cover||s.thumbnail||"https://dummyimage.com/800x600/ededed/303030.png&text=++++++COVER+++++",alt:""},null,8,$a)]),(0,a.Lk)("div",_a,[(0,a.Lk)("div",Pa,[(0,a.Lk)("h3",Ta,(0,l.v_)(s.name),1),s.demo?((0,a.uX)(),(0,a.CE)("span",Aa," ตัวอย่าง ")):(0,a.Q3)("",!0),(0,a.Lk)("div",{class:(0,l.C4)(["w-2 h-2 rounded-full","text-lime-600"===r.getClassForTypeAndData(s.type,s)?"bg-green-400":"bg-red-400"])},null,2)]),(0,a.Lk)("div",Xa,[(0,a.Lk)("span",ja,[(0,a.bF)(d,{icon:r.getIconForSubItem(s.type),class:(0,l.C4)([r.getClassForTypeAndData(s.type,s),"mr-1"])},null,8,["icon","class"]),(0,a.eW)(" "+(0,l.v_)(r.getPlayerTypeName(s.type)),1)]),t[32]||(t[32]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",Ua,[(0,a.bF)(d,{icon:["fas","clock"],class:"mr-1 text-gray-400"}),(0,a.eW)(" "+(0,l.v_)(s.duration)+" นาที ",1)]),t[33]||(t[33]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",Ba,[(0,a.bF)(d,{icon:["fas","code"],class:"mr-1 text-gray-400"}),(0,a.eW)(" "+(0,l.v_)(s.slug),1)])])])]),(0,a.Lk)("div",Oa,[(0,a.Lk)("button",{onClick:(0,c.D$)((e=>r.deleteParentPlayer(s._id)),["stop"]),class:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"ลบ"},[(0,a.bF)(d,{icon:["fas","trash"],class:"text-sm"})],8,Qa),(0,a.Lk)("button",{onClick:(0,c.D$)((e=>r.togglePanel(o,s)),["stop"]),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded transition-colors",title:"ตั้งค่า"},[(0,a.bF)(d,{icon:["fas",i.selectedPlayerIndex===o?"chevron-up":"chevron-down"],class:"text-sm"},null,8,["icon"])],8,Ma)])],8,Sa)]),r.isOpenPanel(o)?((0,a.uX)(),(0,a.CE)("div",Va,[null===i.selectedSubPlayerIndex?((0,a.uX)(),(0,a.Wv)(u,{key:0,"select-player-item":s,onUpdateSelectPlayerItem:r.updataPlayer,onUpdatePlayerVideo:r.updataVideo,onUpdatePlayerDocument:r.updataDocument,onUpdatePlayerExam:r.updataExam,onUpdatePlayerVideoUrl:r.SetContentSource,onCancelUpdate:r.hidePanel,onDeleteSelectPlayerItem:r.deletePlayer,onUpdatePlayerData:r.reloadPlayerData},null,8,["select-player-item","onUpdateSelectPlayerItem","onUpdatePlayerVideo","onUpdatePlayerDocument","onUpdatePlayerExam","onUpdatePlayerVideoUrl","onCancelUpdate","onDeleteSelectPlayerItem","onUpdatePlayerData"])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)],64)):(0,a.Q3)("",!0)],10,Ns)))),128))])),_:1})])),_:1},16,["list","onChange","move"])]))])):(0,a.Q3)("",!0),"onsite"===i.courseData.type?((0,a.uX)(),(0,a.CE)("div",Ra,[(0,a.Lk)("div",Wa,[(0,a.Lk)("div",Na,[(0,a.Lk)("div",qa,[(0,a.Lk)("div",Ka,[(0,a.bF)(d,{icon:["fas","file-alt"],class:"text-blue-600 text-sm"})]),t[34]||(t[34]=(0,a.Lk)("div",null,[(0,a.Lk)("h3",{class:"text-base font-semibold text-gray-900"},"แบบฟอร์มการลงทะเบียน"),(0,a.Lk)("p",{class:"text-sm text-gray-500"},"จัดการแบบฟอร์มสำหรับการลงทะเบียนเข้าเรียน")],-1))]),(0,a.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>r.showPopup&&r.showPopup(...e)),class:"inline-flex items-center rounded-lg border border-transparent bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(d,{icon:["fas","plus"],class:"text-white mr-1.5"}),t[35]||(t[35]=(0,a.eW)(" เลือกแบบฟอร์ม "))])]),(0,a.Lk)("div",Ha,[void 0!==i.courseData.form?((0,a.uX)(),(0,a.CE)("div",za,[(0,a.Lk)("div",Ga,[(0,a.Lk)("div",Ja,[(0,a.bF)(d,{icon:["fas","file-alt"],class:"text-blue-600"})]),(0,a.Lk)("div",null,[(0,a.Lk)("h4",Ya,(0,l.v_)(i.courseData.form.title),1),t[36]||(t[36]=(0,a.Lk)("p",{class:"text-xs text-gray-500"},"แบบฟอร์มที่เลือกใช้",-1))])]),(0,a.bF)(g,{to:"/cms/form/"+i.courseData.form._id+"/"+i.courseData._id,class:"inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-colors"},{default:(0,a.k6)((()=>[(0,a.bF)(d,{icon:["fas","users"],class:"mr-1.5"}),t[37]||(t[37]=(0,a.eW)(" ดูผู้ลงทะเบียน "))])),_:1},8,["to"])])):((0,a.uX)(),(0,a.CE)("div",Za,[(0,a.bF)(d,{icon:["fas","file-plus"],class:"text-gray-400 text-2xl mb-2"}),t[38]||(t[38]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-1"},"ยังไม่มีแบบฟอร์ม",-1)),t[39]||(t[39]=(0,a.Lk)("p",{class:"text-xs text-gray-500"},"เลือกแบบฟอร์มการลงทะเบียนสำหรับหลักสูตรนี้",-1))]))])])])):(0,a.Q3)("",!0)])]),i.showPopupWindow?((0,a.uX)(),(0,a.CE)("div",eo,[(0,a.Lk)("div",{class:"bg-black bg-opacity-50 absolute inset-0",onClick:t[10]||(t[10]=(...e)=>r.closePopup&&r.closePopup(...e))}),(0,a.Lk)("div",to,[(0,a.Lk)("div",so,[(0,a.Lk)("div",ao,[t[40]||(t[40]=(0,a.Lk)("h3",{class:"text-lg font-semibold text-gray-900"},"เลือกแบบฟอร์ม",-1)),(0,a.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>r.closePopup&&r.closePopup(...e)),class:"text-gray-400 hover:text-gray-600"},[(0,a.bF)(d,{icon:["fas","times"]})])]),(0,a.Lk)("div",oo,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.listItems,(e=>((0,a.uX)(),(0,a.CE)("label",{key:e._id,class:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer"},[(0,a.bo)((0,a.Lk)("input",{type:"radio",value:e,"onUpdate:modelValue":t[12]||(t[12]=e=>i.selectedItem=e),class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 mr-3"},null,8,io),[[c.XL,i.selectedItem]]),(0,a.Lk)("div",ro,[(0,a.Lk)("div",no,(0,l.v_)(e.title),1),t[41]||(t[41]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"แบบฟอร์มการลงทะเบียน",-1))])])))),128))]),(0,a.Lk)("div",lo,[(0,a.Lk)("button",{onClick:t[13]||(t[13]=(...e)=>r.closePopup&&r.closePopup(...e)),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50"}," ยกเลิก "),(0,a.Lk)("button",{onClick:t[14]||(t[14]=(...e)=>r.updateForm&&r.updateForm(...e)),disabled:!i.selectedItem,class:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg"}," เลือกแบบฟอร์ม ",8,co)])])])])):(0,a.Q3)("",!0)],64)}var mo=s(51678);const go={class:"border-b border-gray-200"},po={class:"grid grid-cols-3"},ho={class:"col-span-1 p-2"},bo={class:"flex justify-left items-left"},xo={class:"relative inline-block text-left"},yo=["disabled"],fo=["value"],ko={class:"col-span-1 p-2 flex justify-center items-center"},vo={class:"text-center"},wo={class:"col-span-1 p-2 flex justify-end items-center"},Lo={key:0},Co={class:"relative"},Do={key:0,controls:"",class:"w-full h-60"},So=["src"],Fo={key:1,style:{position:"relative","padding-top":"56.25%"}},Io=["src"],Eo={key:2,controls:"",class:"w-full h-60"},$o=["src"],_o=["src"],Po={key:1,class:"bg-gray-100 min-h-[200px] h-full flex justify-center items-center rounded text-xs"},To={class:"absolute top-10 left-1/2 transform -translate-x-1/2 -translate-y-1/2"},Ao={class:"pt-2 text-sm"},Xo={class:"border-t border-gray-200 pb-1"},jo={class:"grid grid-cols-1"},Uo={class:"col-span-1 p-2"},Bo={class:"font-medium text-gray-500"},Oo={key:0,class:"ml-2 bg-blue-100 pl-2 pr-2 rounded text-xs"},Qo={key:1,class:"ml-2 bg-blue-100 pl-2 pr-2 rounded text-xs"},Mo={key:2,class:"ml-2 bg-blue-100 pl-2 pr-2 rounded text-xs"},Vo={key:3,class:"ml-2 bg-blue-100 pl-2 pr-2 rounded text-xs"},Ro={key:4,class:"ml-2 bg-blue-100 pl-2 pr-2 rounded text-xs"},Wo={key:1},No={key:0,class:"bg-gray-100 min-h-[100px] h-full flex justify-center items-center rounded text-xs"},qo={key:1,class:"bg-gray-100 min-h-[100px] h-full flex justify-center items-center rounded text-xs"},Ko={key:1,class:"bg-gray-100 min-h-[100px] h-full flex justify-center items-center rounded text-xs"},Ho={class:"absolute top-28 left-1/2 transform -translate-x-1/2 -translate-y-1/2"},zo={class:"pt-2 text-sm"},Go={key:2,class:"p-2"},Jo={class:"bg-gray-100 p-3 rounded shadow-md"},Yo={class:"mt-2"},Zo={key:0,class:"col-span-1"},ei={key:1,class:"mt-2"},ti={class:"list-disc pl-5"},si={class:"font-semibold"},ai={class:"mt-1"},oi=["onUpdate:modelValue"],ii=["onClick"],ri=["onClick"],ni={class:"mt-1"},li=["value","onUpdate:modelValue"],ci=["onClick"],di={class:"mt-4"},ui={class:"border-t border-gray-200 grid grid-cols-2 gap-4 px-5 py-3"},mi={class:"col-span-1"},gi={class:"col-span-1"},pi={class:"col-span-1"},hi={class:"block text-base font-medium text-gray-900"},bi={class:"col-span-2"},xi={class:"bg-gray-50 border-t border-gray-200 p-2 text-right flex justify-between"},yi={class:"flex items-center space-x-4"};function fi(e,t,s,o,i,r){const n=(0,a.g2)("FileBrowser"),d=(0,a.g2)("SetContentSource"),u=(0,a.g2)("font-awesome-icon"),m=(0,a.g2)("SpecialAssign");return(0,a.uX)(),(0,a.CE)(a.FK,null,[i.VideoBrowserOpen?((0,a.uX)(),(0,a.Wv)(n,{key:0,isWindowsOpen:!0,callbackFunction:"video",allowFileType:["mp4","m3u8"],onFileBrowserTrigger:r.changeVideoTrigger,onFileBrowserCallback:r.selectVideoTrigger},null,8,["onFileBrowserTrigger","onFileBrowserCallback"])):(0,a.Q3)("",!0),i.DocumentBrowserOpen?((0,a.uX)(),(0,a.Wv)(n,{key:1,isWindowsOpen:!0,callbackFunction:"document",allowFileType:["pdf","doc","docx","xls","xlsx","csv"],onFileBrowserTrigger:r.changeDocumentTrigger,onFileBrowserCallback:r.selectDocumentTrigger},null,8,["onFileBrowserTrigger","onFileBrowserCallback"])):(0,a.Q3)("",!0),i.SetContentSourceModal?((0,a.uX)(),(0,a.Wv)(d,{key:2,isWindowsOpen:!0,setContentTriggerObj:r.getContentTriggerObj,contentType:i.initialSelectPlayerItemType,contentOriginal:r.getContentTriggerObj,onSetContentTrigger:r.SetContentTrigger,onSetContentEvent:r.handleSetContentSource},null,8,["setContentTriggerObj","contentType","contentOriginal","onSetContentTrigger","onSetContentEvent"])):(0,a.Q3)("",!0),(0,a.Lk)("div",{class:"bg-white",onClick:t[24]||(t[24]=(0,c.D$)(((...e)=>r.handleCheckboxClick&&r.handleCheckboxClick(...e)),["stop"]))},[(0,a.Lk)("div",go,[(0,a.Lk)("div",po,[(0,a.Lk)("div",ho,[(0,a.Lk)("div",bo,[(0,a.Lk)("div",xo,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.type=e),id:"content-type",class:"mt-1 block w-full p-2 rounded border border-gray-300 focus:ring focus:ring-indigo-200",disabled:r.isTypeChangeDisabled,onClick:t[1]||(t[1]=(0,c.D$)((()=>{}),["stop"])),onChange:t[2]||(t[2]=(...e)=>r.handleTypeChange&&r.handleTypeChange(...e))},[t[25]||(t[25]=(0,a.Lk)("option",{value:"",disabled:""},"กรุณาเลือก",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.playerType,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e.code,value:e.code},(0,l.v_)(e.name),9,fo)))),128))],40,yo),[[c.u1,i.type]])])])]),(0,a.Lk)("div",ko,[(0,a.Lk)("p",vo,(0,l.v_)(s.selectPlayerItem.duration),1)]),(0,a.Lk)("div",wo,[(0,a.Lk)("button",{onClick:t[3]||(t[3]=(0,c.D$)(((...e)=>r.cancelUpdate&&r.cancelUpdate(...e)),["stop"])),type:"button",class:"mr-1 border border-transparent bg-white shadow-sm border border-gray-400 px-4 py-2 text-sm font-medium text-gray-600 shadow-sm hover:bg-gray-100"},[(0,a.bF)(u,{icon:["fas","times"],class:"text-gray-600 pr-2"}),t[26]||(t[26]=(0,a.eW)(" ปิด "))])])])]),["demand","streaming","youtube","live"].includes(s.selectPlayerItem.type)||["demand","streaming","youtube","live"].includes(i.type)?((0,a.uX)(),(0,a.CE)("div",Lo,[(0,a.Lk)("div",Co,[s.selectPlayerItem.video?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},["demand"===i.type||"demand"===i.initialSelectPlayerItemType?((0,a.uX)(),(0,a.CE)("video",Do,[(0,a.Lk)("source",{src:s.selectPlayerItem.video.desktop,type:"video/mp4"},null,8,So),t[27]||(t[27]=(0,a.eW)(" Your browser does not support the video tag. "))])):(0,a.Q3)("",!0),"streaming"===i.type||"streaming"===i.initialSelectPlayerItemType?((0,a.uX)(),(0,a.CE)("div",Fo,[(0,a.Lk)("iframe",{src:r.getIframeSrc(s.selectPlayerItem.video.streaming),loading:"lazy",style:{border:"0",position:"absolute",top:"0",height:"100%",width:"100%"},allow:"accelerometer;gyroscope;autoplay;encrypted-media;picture-in-picture;",allowfullscreen:"true"},null,8,Io)])):(0,a.Q3)("",!0),"live"===i.type||"live"===i.initialSelectPlayerItemType?((0,a.uX)(),(0,a.CE)("video",Eo,[(0,a.Lk)("source",{src:s.selectPlayerItem.video.live,type:"application/x-mpegURL"},null,8,$o),t[28]||(t[28]=(0,a.eW)(" Your browser does not support the video tag. "))])):(0,a.Q3)("",!0),"youtube"===i.type||"youtube"===i.initialSelectPlayerItemType?((0,a.uX)(),(0,a.CE)("iframe",{key:3,width:"100%",height:"300",src:s.selectPlayerItem.video.youtube,frameborder:"0",allowfullscreen:""},null,8,_o)):(0,a.Q3)("",!0)],64)):((0,a.uX)(),(0,a.CE)("div",Po,t[29]||(t[29]=[(0,a.Lk)("span",{class:"bg-black text-white p-2"},"!! ไม่มีเนื้อหา",-1)]))),(0,a.Lk)("div",To,[(0,a.Lk)("button",{onClick:t[4]||(t[4]=(0,c.D$)((e=>r.handleButtonClick(i.buttonType)),["stop"])),class:"bg-yellow-500 hover:bg-yellow-600 text-white text-md px-2 py-1 rounded"},[(0,a.bF)(u,{icon:["fas","folder-open"],class:"pt-2 text-white text-md"}),t[30]||(t[30]=(0,a.Lk)("br",null,null,-1)),(0,a.Lk)("span",Ao,(0,l.v_)("live"===i.buttonType?"รหัส Live":"youtube"!==i.buttonType&&"streaming"!==i.buttonType?"เลือกวีดีโอ":"เปลี่ยนลิงค์"),1)]),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(0,c.D$)(((...e)=>r.removeVideo&&r.removeVideo(...e)),["stop"])),class:"ml-2 bg-red-500 hover:bg-red-600 text-white text-md px-2 py-1 rounded"},[(0,a.bF)(u,{icon:["fas","trash"],class:"pt-2 text-white text-md"}),t[31]||(t[31]=(0,a.Lk)("br",null,null,-1)),t[32]||(t[32]=(0,a.Lk)("span",{class:"pt-2 text-sm"},"ลบวีดีโอ",-1))])])]),(0,a.Lk)("div",Xo,[(0,a.Lk)("div",jo,[(0,a.Lk)("div",Uo,[(0,a.Lk)("span",Bo,[(0,a.bF)(u,{icon:["fas","video"],class:(0,l.C4)(["text-rose-600",void 0===s.selectPlayerItem.video?"text-rose-600":"text-lime-600"])},null,8,["class"]),void 0===s.selectPlayerItem.video?((0,a.uX)(),(0,a.CE)("span",Oo,"ไม่มีเนื้อหา")):(0,a.Q3)("",!0),void 0!=s.selectPlayerItem.video&&"demand"===s.selectPlayerItem.type?((0,a.uX)(),(0,a.CE)("span",Qo,(0,l.v_)(s.selectPlayerItem.video.desktop),1)):(0,a.Q3)("",!0),void 0!=s.selectPlayerItem.video&&"streaming"===s.selectPlayerItem.type?((0,a.uX)(),(0,a.CE)("span",Mo,(0,l.v_)(s.selectPlayerItem.video.streaming),1)):(0,a.Q3)("",!0),void 0!=s.selectPlayerItem.video&&"youtube"===s.selectPlayerItem.type?((0,a.uX)(),(0,a.CE)("span",Vo,(0,l.v_)(s.selectPlayerItem.video.youtube),1)):(0,a.Q3)("",!0),void 0!=s.selectPlayerItem.video&&"live"===s.selectPlayerItem.type?((0,a.uX)(),(0,a.CE)("span",Ro,(0,l.v_)(s.selectPlayerItem.video.live),1)):(0,a.Q3)("",!0)])])])])])):(0,a.Q3)("",!0),["document","exam"].includes(s.selectPlayerItem.type)||["document","exam"].includes(i.type)?((0,a.uX)(),(0,a.CE)("div",Wo,[s.selectPlayerItem.content?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},["document"===i.type||"document"===i.initialSelectPlayerItemType?((0,a.uX)(),(0,a.CE)("div",No,(0,l.v_)(s.selectPlayerItem.content),1)):(0,a.Q3)("",!0),"exam"===i.type||"exam"===i.initialSelectPlayerItemType?((0,a.uX)(),(0,a.CE)("div",qo)):(0,a.Q3)("",!0)],64)):((0,a.uX)(),(0,a.CE)("div",Ko)),(0,a.Lk)("div",Ho,[(0,a.Lk)("button",{onClick:t[6]||(t[6]=(0,c.D$)((e=>r.handleButtonClick(i.buttonType)),["stop"])),class:"bg-yellow-500 hover:bg-yellow-600 text-white text-md px-2 py-1 rounded"},[(0,a.bF)(u,{icon:["fas","folder-open"],class:"pt-2 text-white text-md"}),t[33]||(t[33]=(0,a.Lk)("br",null,null,-1)),(0,a.Lk)("span",zo,(0,l.v_)("document"===i.buttonType?"เลือกไฟล์":"exam"===i.buttonType?"เลือกข้อสอบ":"เลือกไฟล์"),1)]),(0,a.Lk)("button",{onClick:t[7]||(t[7]=(0,c.D$)(((...e)=>r.removeVideo&&r.removeVideo(...e)),["stop"])),class:"ml-2 bg-red-500 hover:bg-red-600 text-white text-md px-2 py-1 rounded"},[(0,a.bF)(u,{icon:["fas","trash"],class:"pt-2 text-white text-md"}),t[34]||(t[34]=(0,a.Lk)("br",null,null,-1)),t[35]||(t[35]=(0,a.Lk)("span",{class:"pt-2 text-sm"},"ลบข้อมูล",-1))])])])):(0,a.Q3)("",!0),"exam"===s.selectPlayerItem.type?((0,a.uX)(),(0,a.CE)("div",Go,[(0,a.Lk)("div",Jo,[t[36]||(t[36]=(0,a.Lk)("h3",{class:"font-medium text-lg mb-1"},"สร้างข้อสอบ",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>i.newQuestion=e),placeholder:"คำถามใหม่",class:"w-full p-1 border border-gray-300 rounded mb-1"},null,512),[[c.Jo,i.newQuestion]]),(0,a.Lk)("button",{onClick:t[9]||(t[9]=(0,c.D$)(((...e)=>r.addQuestion&&r.addQuestion(...e)),["stop"])),class:"w-full bg-blue-500 text-white p-1 rounded hover:bg-blue-600"},"เพิ่มคำถาม")]),(0,a.Lk)("div",Yo,[(0,a.Lk)("label",null,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=e=>i.examOptionValid=e)},null,512),[[c.lH,i.examOptionValid]]),t[37]||(t[37]=(0,a.eW)(" Exam Option "))])]),i.examOptionValid?((0,a.uX)(),(0,a.CE)("div",Zo,[t[38]||(t[38]=(0,a.Lk)("label",{for:"validScore",class:"block text-base font-medium text-gray-900"},"คะแนนที่ถูกต้อง",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>i.validScore=e),onClick:t[12]||(t[12]=(0,c.D$)(((...e)=>r.handleCheckboxClick&&r.handleCheckboxClick(...e)),["stop"])),type:"number",autocomplete:"validScore",class:"mt-1 block w-full rounded-sm border border-gray-300 py-2 px-3 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-gray-900 sm:text-sm"},null,512),[[c.Jo,i.validScore]])])):(0,a.Q3)("",!0),i.questions.length?((0,a.uX)(),(0,a.CE)("div",ei,[t[39]||(t[39]=(0,a.Lk)("h4",{class:"font-medium text-lg"},"คำถามที่เพิ่มแล้ว:",-1)),(0,a.Lk)("ul",ti,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.questions,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:e.id,class:"mb-2"},[(0,a.Lk)("div",si,(0,l.v_)(e.text),1),(0,a.Lk)("div",ai,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t=>e.newAnswer=t,placeholder:"คำตอบใหม่",class:"w-full p-1 border border-gray-300 rounded mb-1"},null,8,oi),[[c.Jo,e.newAnswer]]),(0,a.Lk)("button",{onClick:(0,c.D$)((e=>r.addAnswerToQuestion(t)),["stop"]),class:"bg-green-500 text-white p-1 rounded hover:bg-green-600"},"เพิ่มคำตอบ",8,ii),(0,a.Lk)("button",{onClick:(0,c.D$)((e=>r.removeQuestion(t)),["stop"]),class:"ml-2 bg-red-500 text-white p-1 rounded hover:bg-red-600"},"ลบคำถาม",8,ri)]),(0,a.Lk)("ul",ni,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.answers,((s,o)=>((0,a.uX)(),(0,a.CE)("li",{key:s.id,class:"flex items-center mb-1"},[(0,a.bo)((0,a.Lk)("input",{type:"radio",value:s.id,"onUpdate:modelValue":t=>e.correctAnswer=t,class:"mr-1"},null,8,li),[[c.XL,e.correctAnswer]]),(0,a.Lk)("span",null,(0,l.v_)(s.text),1),(0,a.Lk)("button",{onClick:(0,c.D$)((e=>r.removeAnswer(t,o)),["stop"]),class:"ml-2 bg-red-500 text-white p-1 rounded hover:bg-red-600"},"ลบคำตอบ",8,ci)])))),128))])])))),128))])])):(0,a.Q3)("",!0),(0,a.Lk)("div",di,[(0,a.Lk)("button",{onClick:t[13]||(t[13]=(0,c.D$)(((...e)=>r.updateExam&&r.updateExam(...e)),["stop"])),class:"bg-indigo-600 text-white p-2 rounded hover:bg-indigo-700"}," อัปเดตข้อมูลข้อสอบ ")])])):(0,a.Q3)("",!0),(0,a.Lk)("div",ui,[(0,a.Lk)("div",mi,[t[40]||(t[40]=(0,a.Lk)("label",{for:"name",class:"block text-base font-medium text-gray-900"},"ชื่อบทเรียน",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>i.name=e),onClick:t[15]||(t[15]=(0,c.D$)(((...e)=>r.handleCheckboxClick&&r.handleCheckboxClick(...e)),["stop"])),type:"text",autocomplete:"name",class:"mt-1 block w-full rounded-sm border border-gray-300 py-2 px-3 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-gray-900 sm:text-sm"},null,512),[[c.Jo,i.name]])]),(0,a.Lk)("div",gi,[t[41]||(t[41]=(0,a.Lk)("label",{for:"duration",class:"block text-base font-medium text-gray-900"},"ความยาว (นาที)",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>i.duration=e),onClick:t[17]||(t[17]=(0,c.D$)(((...e)=>r.handleCheckboxClick&&r.handleCheckboxClick(...e)),["stop"])),type:"text",autocomplete:"duration",class:"mt-1 block w-full rounded-sm border border-gray-300 py-2 px-3 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-gray-900 sm:text-sm"},null,512),[[c.Jo,i.duration]])]),(0,a.Lk)("div",pi,[(0,a.Lk)("label",hi,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>i.demo=e),onClick:t[19]||(t[19]=(0,c.D$)(((...e)=>r.handleCheckboxClick&&r.handleCheckboxClick(...e)),["stop"])),type:"checkbox",class:"mt-1 rounded-sm border border-gray-300 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-gray-900 sm:text-sm"},null,512),[[c.lH,i.demo]]),t[42]||(t[42]=(0,a.eW)(" ตัวอย่างเนื้อหา "))])]),(0,a.Lk)("div",bi,[t[43]||(t[43]=(0,a.Lk)("label",{for:"slug",class:"block text-base font-medium text-gray-900"},"คำอธิบาย",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[20]||(t[20]=e=>i.description=e),onClick:t[21]||(t[21]=(0,c.D$)(((...e)=>r.handleCheckboxClick&&r.handleCheckboxClick(...e)),["stop"])),rows:"3",cols:"20",class:"mt-1 block w-full rounded-sm border border-gray-300 py-2 px-3 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-gray-900 sm:text-sm"},"                ",512),[[c.Jo,i.description]])])]),(0,a.Lk)("div",xi,[(0,a.Lk)("div",yi,[(0,a.Lk)("button",{onClick:t[22]||(t[22]=(0,c.D$)(((...e)=>r.deleteItem&&r.deleteItem(...e)),["stop"])),type:"button",class:"border border-transparent bg-red-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"},[(0,a.bF)(u,{icon:["fas","trash"],class:"text-gray-200 pr-2"}),t[44]||(t[44]=(0,a.eW)(" ลบ "))]),(0,a.bF)(m,{player:s.selectPlayerItem,onSetContentReload:r.handleDataSource},null,8,["player","onSetContentReload"])]),(0,a.Lk)("div",null,[(0,a.Lk)("button",{onClick:t[23]||(t[23]=(0,c.D$)(((...e)=>r.saveChanges&&r.saveChanges(...e)),["stop"])),type:"button",class:"border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},[(0,a.bF)(u,{icon:["fas","save"],class:"text-gray-200 pr-2"}),t[45]||(t[45]=(0,a.eW)(" บันทึก "))])])])])],64)}s(81454);var ki=s(13955);const vi={key:0,class:"fixed inset-0 flex items-center justify-center z-50"},wi={class:"relative p-4 w-96 bg-white border rounded shadow-lg z-10"},Li={class:"flex justify-between items-center mb-4 border-b border-b-gray-200 mb-3 pb-3"},Ci={class:"text-gray-700 font-semibold"},Di={class:"mb-4 pb-4 border-b border-b-gray-200"},Si={class:"flex space-x-4"},Fi={class:"flex items-center"},Ii={class:"flex items-center"},Ei={class:"flex items-center"},$i={key:0,class:"mt-4 grid grid-cols-2 gap-4"},_i=["onClick"],Pi=["onClick"],Ti={class:"mb-4 pb-4 border-b border-b-gray-200"},Ai={key:0},Xi={class:"flex items-center justify-between text-left"},ji={class:"font-bold text-sm pb-2"},Ui={class:"text-sm text-gray-700"},Bi={class:"flex items-center space-x-2"},Oi=["onClick"],Qi=["onClick"],Mi={key:0,class:"mt-2"},Vi=["onClick"],Ri={key:1,class:"text-sm text-gray-500 mt-1"},Wi=["onClick"],Ni={key:1,class:"text-center text-gray-500 pt-3"},qi={class:"flex justify-between items-center mb-4"},Ki={key:0,class:"mt-2 text-left text-gray-500"},Hi={class:"text-black font-semibold"},zi={key:1,class:"mt-2"},Gi={class:"flex items-center text-left"},Ji=["value","checked","onChange"],Yi=["innerHTML"],Zi=["innerHTML"],er=["innerHTML"],tr={key:2,class:"mt-2 px-4 text-center text-gray-500"},sr={key:3,class:"mt-2 px-4 text-center text-gray-500"};function ar(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon"),d=(0,a.g2)("Datepicker");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.toggleDropdown&&r.toggleDropdown(...e)),class:"px-4 py-2 bg-blue-500 text-white rounded shadow"},[(0,a.bF)(n,{icon:["fas","lock"],class:"text-gray-200 pr-2"}),t[13]||(t[13]=(0,a.eW)(" การเข้าถึงบทเรียน "))]),i.isDropdownVisible?((0,a.uX)(),(0,a.CE)("div",vi,[(0,a.Lk)("div",{class:"absolute inset-0 bg-black opacity-50",onClick:t[1]||(t[1]=(...e)=>r.closeDropdown&&r.closeDropdown(...e))}),(0,a.Lk)("div",wi,[(0,a.Lk)("div",Li,[(0,a.Lk)("h3",Ci,[(0,a.bF)(n,{icon:["fas","lock"],class:"text-gray-300 pr-1"}),t[14]||(t[14]=(0,a.eW)(" ตั้งค่าการเข้าถึงเนื้อหา "))]),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.closeDropdown&&r.closeDropdown(...e)),class:"px-4 py-2 bg-blue-500 text-white rounded shadow"}," ปิด ")]),(0,a.Lk)("div",Di,[t[20]||(t[20]=(0,a.Lk)("h4",{class:"text-gray-700 font-semibold text-left mb-2"},"การเข้าถึงมาตรฐาน",-1)),(0,a.Lk)("div",Si,[(0,a.Lk)("div",Fi,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.localNotVisible=e),onChange:t[4]||(t[4]=(...e)=>r.updatePlayer&&r.updatePlayer(...e)),type:"checkbox",class:"rounded-sm border border-gray-300 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-gray-900 sm:text-sm"},null,544),[[c.lH,i.localNotVisible]]),t[15]||(t[15]=(0,a.Lk)("label",{class:"ml-2 text-sm font-medium text-gray-900"},"ปิดการเข้าถึง",-1))]),(0,a.Lk)("div",Ii,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.localStatus=e),onChange:t[6]||(t[6]=(...e)=>r.updatePlayer&&r.updatePlayer(...e)),type:"checkbox",class:"rounded-sm border border-gray-300 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-gray-900 sm:text-sm"},null,544),[[c.lH,i.localStatus]]),t[16]||(t[16]=(0,a.Lk)("label",{class:"ml-2 text-sm font-medium text-gray-900"},"ไม่แสดง",-1))]),(0,a.Lk)("div",Ei,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.localPublicByDate=e),onChange:t[8]||(t[8]=(...e)=>r.updatePlayer&&r.updatePlayer(...e)),type:"checkbox",class:"rounded-sm border border-gray-300 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-gray-900 sm:text-sm"},null,544),[[c.lH,i.localPublicByDate]]),t[17]||(t[17]=(0,a.Lk)("label",{class:"ml-2 text-sm font-medium text-gray-900"},"ตั้งเวลา",-1))])]),i.localPublicByDate?((0,a.uX)(),(0,a.CE)("div",$i,[(0,a.Lk)("div",null,[t[18]||(t[18]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 text-left"},"Select Start Date:",-1)),(0,a.bF)(d,{modelValue:i.startDate,"onUpdate:modelValue":[t[9]||(t[9]=e=>i.startDate=e),r.updatePlayer],clearable:!0},{clear:(0,a.k6)((({onClear:e})=>[(0,a.Lk)("button",{onClick:e},"Clear",8,_i)])),_:1},8,["modelValue","onUpdate:modelValue"])]),(0,a.Lk)("div",null,[t[19]||(t[19]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 text-left"},"Select Stop Date:",-1)),(0,a.bF)(d,{modelValue:i.stopDate,"onUpdate:modelValue":[t[10]||(t[10]=e=>i.stopDate=e),r.updatePlayer],clearable:!0},{clear:(0,a.k6)((({onClear:e})=>[(0,a.Lk)("button",{onClick:e},"Clear",8,Pi)])),_:1},8,["modelValue","onUpdate:modelValue"])])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",Ti,[t[23]||(t[23]=(0,a.Lk)("h4",{class:"text-gray-700 font-semibold text-left"},"การเข้าถึงแบบพิเศษ (กำหนดรายชื่อ)",-1)),i.checkedItems.length>0?((0,a.uX)(),(0,a.CE)("ul",Ai,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.checkedItems,((e,s)=>((0,a.uX)(),(0,a.CE)("li",{key:e._id,class:"py-2 px-4 bg-gray-100 mt-2 rounded"},[(0,a.Lk)("div",Xi,[(0,a.Lk)("div",null,[(0,a.Lk)("div",ji,(0,l.v_)(s+1)+". "+(0,l.v_)(e.firstname)+" "+(0,l.v_)(e.lastname),1),(0,a.Lk)("div",Ui,[(0,a.Lk)("div",Bi,[(0,a.Lk)("button",{onClick:t=>r.toggleExpire(e._id),class:"px-2 py-1 bg-blue-500 text-white text-xs rounded shadow"},[(0,a.bF)(n,{icon:["fas","calendar"],class:"text-white pr-1"}),t[21]||(t[21]=(0,a.eW)(" วันหมดอายุ "))],8,Oi),(0,a.Lk)("button",{onClick:t=>r.removeAssignment(e._id),class:"px-2 py-1 bg-red-500 text-white text-xs rounded shadow"},[(0,a.bF)(n,{icon:["fas","trash"],class:"text-white pr-1"}),t[22]||(t[22]=(0,a.eW)(" ลบรายชื่อ "))],8,Qi)])])])]),i.showExpirePanel[e._id]?((0,a.uX)(),(0,a.CE)("div",Mi,[(0,a.bF)(d,{modelValue:i.expireDates[e._id],"onUpdate:modelValue":[t=>i.expireDates[e._id]=t,t=>r.onDateSelect(e._id)],clearable:!0},{clear:(0,a.k6)((({onClear:e})=>[(0,a.Lk)("button",{onClick:e},"Clear",8,Vi)])),_:2},1032,["modelValue","onUpdate:modelValue"])])):(0,a.Q3)("",!0),e.expireDate&&"none"!==e.expireDate?((0,a.uX)(),(0,a.CE)("div",Ri,[(0,a.eW)(" Expiration Date: "+(0,l.v_)(r.formatThaidate(e.expireDate))+" ",1),(0,a.Lk)("button",{onClick:t=>r.clearExpireDate(e._id),class:"ml-2 text-blue-500 hover:underline focus:outline-none"}," ล้าง ",8,Wi)])):(0,a.Q3)("",!0)])))),128))])):((0,a.uX)(),(0,a.CE)("div",Ni,"ไม่มีข้อมูลที่บันทึกไว้"))]),t[26]||(t[26]=(0,a.Lk)("h4",{class:"text-gray-700 font-semibold pb-2 text-left"},"เพิ่มรายชื่อใหม่:",-1)),(0,a.Lk)("div",qi,[(0,a.bo)((0,a.Lk)("input",{id:"search",type:"text",class:"px-4 py-2 w-full border-b border-gray-300 focus:outline-none",placeholder:"ค้นหา...","onUpdate:modelValue":t[11]||(t[11]=e=>i.searchQuery=e)},null,512),[[c.Jo,i.searchQuery]])]),i.searchQuery.length>0?((0,a.uX)(),(0,a.CE)("div",Ki,[t[24]||(t[24]=(0,a.eW)(" ผลการค้นหา ")),(0,a.Lk)("span",Hi,(0,l.v_)(i.totalItems),1),t[25]||(t[25]=(0,a.eW)(" รายการ ")),(0,a.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>r.clearSearchQuery&&r.clearSearchQuery(...e)),type:"button",class:"ml-2 text-blue-500 hover:underline focus:outline-none"}," Clear ")])):(0,a.Q3)("",!0),i.searchResults.length>0?((0,a.uX)(),(0,a.CE)("ul",zi,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.searchResults,(e=>((0,a.uX)(),(0,a.CE)("li",{key:e.enroll._id,class:"py-2 px-4 hover:bg-gray-100 cursor-pointer"},[(0,a.Lk)("div",Gi,[(0,a.Lk)("input",{type:"checkbox",value:e.user,checked:r.isUserChecked(e.user._id),onChange:t=>r.toggleCheckedItem(e.user),class:"mr-2"},null,40,Ji),(0,a.Lk)("div",null,[(0,a.Lk)("div",{class:"font-bold text-sm",innerHTML:r.highlight(e.user.firstname+" "+e.user.lastname)},null,8,Yi),(0,a.Lk)("div",{class:"text-xs text-gray-700",innerHTML:r.highlight(e.user.email)},null,8,Zi),(0,a.Lk)("div",{class:"text-xs text-gray-600 mt-1",innerHTML:r.highlight("Status: "+e.enroll.analytics.status)},null,8,er)])])])))),128))])):(0,a.Q3)("",!0),i.loading?((0,a.uX)(),(0,a.CE)("div",tr,"กำลังโหลด...")):(0,a.Q3)("",!0),i.loading||0!==i.searchResults.length?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",sr,"ไม่พบข้อมูลที่ค้นหา.")),t[27]||(t[27]=(0,a.Lk)("div",{class:"flex justify-end mt-4 border-t border-t-gray-200 mt-3 pt-3"}," * เลือกรายชื่อผู้ที่เข้าเรียนแบบพิเศษหลังจากปิดการแสดงผล ",-1))])])):(0,a.Q3)("",!0)])}var or=s(87275),ir={props:{player:Object},components:{Datepicker:or.A},data(){return{isDropdownVisible:!1,configs:n.A.get("configs"),searchQuery:"",searchResults:[],totalItems:0,debounceTimer:null,loading:!1,activeBlock:!1,listItems:[],currentPage:1,limitItem:10,statusFilter:"all",dataItem:this.$route.params.id,checkedItems:[],showExpirePanel:{},expireDates:{},assign:[],localNotVisible:this.player.not_visible,localStatus:this.player.status,localPublicByDate:this.player.public_by_date||!1,startDate:this.player.start_date||null,stopDate:this.player.stop_date||null}},watch:{searchQuery(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(this.handleSearchQuery,500)},expireDates:{handler(e){for(const[t,s]of Object.entries(e))s&&(this.updateCheckedItem(t,s),this.hideExpirePanel(t))},deep:!0},isDropdownVisible(e){e&&this.initializeCheckedItems()},localNotVisible(e){this.updatePlayer(e)},localStatus(e){this.updatePlayer(e)},localPublicByDate(e){this.updatePlayer(e)},startDate(e){this.updatePlayer(e)},stopDate(e){this.updatePlayer(e)}},methods:{formatThaidate(e){return ns.A.toThaiDatetime(e,"short")},toggleDropdown(){this.isDropdownVisible=!this.isDropdownVisible},closeDropdown(){this.checkedItems=[],this.isDropdownVisible=!1},clearSearchQuery(){this.searchQuery="",this.searchResults=[],this.totalItems=0},async handleSearchQuery(){this.searchQuery.length>=3?await this.getData():(this.searchResults=[],this.totalItems=0)},async getData(){this.loading=!0,this.activeBlock=!0,this.listItems=[];let e=[{courseID:this.dataItem}];"all"!==this.statusFilter&&e.push({status:this.statusFilter});const t=[{$match:{$and:e}},{$set:{userID:{$toObjectId:"$userID"},courseID:{$toObjectId:"$courseID"}}},{$lookup:{from:"user",localField:"userID",foreignField:"_id",as:"user"}},{$unwind:"$user"},{$lookup:{from:"course",localField:"courseID",foreignField:"_id",as:"course"}},{$unwind:"$course"},{$lookup:{from:"exam",let:{masterID:"$course.master"},pipeline:[{$match:{$expr:{$and:[{$eq:["$courseId","$$masterID"]},{$eq:["$type","pre"]}]}}}],as:"examPre"}},{$unwind:{path:"$examPre",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"exam",let:{masterID:"$course.master"},pipeline:[{$match:{$expr:{$and:[{$eq:["$courseId","$$masterID"]},{$eq:["$type","post"]}]}}}],as:"examPost"}},{$unwind:{path:"$examPost",preserveNullAndEmptyArrays:!0}},...this.searchQuery?[{$match:{$or:[{"user.firstname":{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{"user.lastname":{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{"user.email":{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{"user.citizen":{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{"user.phone":{$regex:`.*${this.searchQuery}.*`,$options:"i"}}]}}]:[],{$facet:{paginatedData:[{$skip:(this.currentPage-1)*this.limitItem},{$limit:this.limitItem},{$project:{enroll:"$$ROOT",user:"$user",course:"$course"}}],totalCount:[{$count:"count"}]}}],s={method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({pipeline:t})};try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/aggregate",s),t=await e.json();if(t&&t.length>0){const e=t[0].paginatedData,s=t[0].totalCount,a={data:e.map((e=>({enroll:e.enroll,user:e.enroll.user,course:e.enroll.course,checked:this.checkedItems.some((t=>t._id===e.enroll.user._id))}))),total:s.length>0?s[0].count:0,paging:{page:this.currentPage,limit:this.limitItem,totalPages:s.length>0?Math.ceil(s[0].count/this.limitItem):0}};this.searchResults=a.data,this.totalItems=a.total,this.totalPages=a.paging.totalPages,this.loading=!1,this.activeBlock=!1}}catch(a){console.error("Error fetching data:",a),this.loading=!1,this.activeBlock=!1}},async getUser(e){try{const{data:t}=await this.$Request.GET(`user/${e}`,this.configs.key);return t}catch(t){return console.error(`Error fetching user data for ID: ${e}`,t),null}},async initializeCheckedItems(){if(await this.getPlayer(),this.assign&&Array.isArray(this.assign)){const e=this.assign.map((async e=>{const t=await this.getUser(e.userID);t&&(this.checkedItems.push({...t,expireDate:e.expire}),this.expireDates[t._id]=e.expire)}));await Promise.all(e)}},async getPlayer(){try{const{data:e}=await this.$Request.GET(`player/${this.player._id}`,this.configs.key);this.assign=e.assignments||[]}catch(e){return console.error(`Error fetching player data for ID: ${this.player._id}`,e),null}},async assignEnroll(e,t){t=t||"none",this.assign||(this.assign=[]);const s=this.assign.findIndex((t=>t.userID===e));-1!==s?this.assign[s].expire=t:this.assign.push({userID:e,expire:t}),await this.updateAssignments()},async removeAssignment(e){this.assign=this.assign.filter((t=>t.userID!==e)),this.checkedItems=this.checkedItems.filter((t=>t._id!==e)),await this.updateAssignments()},async updateAssignments(){const e={data:{assignments:this.assign}};try{const t=await this.$Request.PUT(`player/${this.player._id}`,e,this.configs.key),{data:s,status:a}=t;200===a?(console.log(`Successfully updated assignments for session ID: ${this.player._id}`),console.log("Updated Data:",s)):console.error(`Failed to update assignments for session ID: ${this.player._id}. Status: ${a}`)}catch(t){console.error(`Error updating assignments for session ID: ${this.player._id}`,t)}},toggleExpire(e){const t={...this.showExpirePanel};t[e]=!t[e],this.showExpirePanel=t},onDateSelect(e){const t=this.expireDates[e];t&&(this.updateCheckedItem(e,t),this.hideExpirePanel(e))},updateCheckedItem(e,t){const s=this.checkedItems.map((s=>s._id===e?{...s,expireDate:t}:s));this.checkedItems=s,this.assignEnroll(e,t)},hideExpirePanel(e){const t={...this.showExpirePanel};delete t[e],this.showExpirePanel=t},highlight(e){if(!this.searchQuery)return e;const t=new RegExp(`(${this.searchQuery})`,"gi");return e.replace(t,'<span class="bg-black text-white">$1</span>')},clearExpireDate(e){const t=this.checkedItems.map((t=>t._id===e?{...t,expireDate:null}:t));this.checkedItems=t,this.expireDates={...this.expireDates,[e]:null},this.assignEnroll(e,null)},isUserChecked(e){return this.checkedItems.some((t=>t._id===e))},async toggleCheckedItem(e){const t=this.checkedItems.findIndex((t=>t._id===e._id));-1===t?(this.checkedItems.push(e),await this.assignEnroll(e._id,this.expireDates[e._id]||"none")):(this.checkedItems.splice(t,1),await this.removeAssignment(e._id))},async updatePlayer(){const e={data:{assignments:this.assign,not_visible:this.localNotVisible,status:this.localStatus,public_by_date:this.localPublicByDate,start_date:this.startDate,stop_date:this.stopDate}};try{const t=await this.$Request.PUT(`player/${this.player._id}`,e,this.configs.key),{data:s,status:a}=t;200===a?(console.log(`Successfully updated player data for session ID: ${this.player._id}`),console.log("Updated Data:",s),this.$emit("set-content-reload")):console.error(`Failed to update player data for session ID: ${this.player._id}. Status: ${a}`)}catch(t){console.error(`Error updating player data for session ID: ${this.player._id}`,t)}}}},rr=s(64621);const nr=(0,rr.A)(ir,[["render",ar],["__scopeId","data-v-6172dba4"]]);var lr=nr,cr={props:{selectPlayerItem:{type:Object,required:!0}},data(){return{playerType:Yt.OC,id:this.selectPlayerItem._id,name:this.selectPlayerItem.name,duration:this.selectPlayerItem.duration,description:this.selectPlayerItem.description,type:this.selectPlayerItem.type,demo:this.selectPlayerItem.demo,not_visible:this.selectPlayerItem.not_visible,status:this.selectPlayerItem.status,VideoBrowserOpen:!1,SetContentSourceModal:!1,DocumentBrowserOpen:!1,initialSelectPlayerItemType:this.selectPlayerItem.type,buttonType:this.selectPlayerItem.type,newQuestion:"",questions:this.selectPlayerItem.content&&this.selectPlayerItem.content.exam||[],examOptionValid:!1,validScore:""}},components:{FileBrowser:os.A,SetContentSource:ki.A,SpecialAssign:lr},computed:{getContentTriggerObj(){return this.selectPlayerItem.video?"streaming"===this.selectPlayerItem.type?this.selectPlayerItem.video.streaming:"youtube"===this.selectPlayerItem.type?this.selectPlayerItem.video.youtube:"live"===this.selectPlayerItem.type?this.selectPlayerItem.video.live:null:null},isTypeChangeDisabled(){return"folder"===this.selectPlayerItem.type&&this.selectPlayerItem.items&&this.selectPlayerItem.items.length>0},formattedQuestions(){return{exam:this.questions.map((e=>({id:e.id,text:e.text,answers:e.answers,newAnswer:e.newAnswer,correctAnswer:e.correctAnswer}))),option:{valid:this.examOptionValid,score:this.validScore}}}},watch:{type(e){this.initialSelectPlayerItemType=e,this.buttonType=e}},methods:{extractVideoID(e){if(!e)return null;const t=e.match(/\/([a-f0-9-]+)\//);return t?t[1]:null},getIframeSrc(e){if(!e)return"";const t=this.extractVideoID(e);return t?`https://iframe.mediadelivery.net/embed/37374/${t}?autoplay=false&loop=false&muted=false&preload=true&responsive=true`:""},handleCheckboxClick(e){e.stopPropagation()},saveChanges(){const e={id:this.id,name:this.name,duration:this.duration,description:this.description,type:this.type,demo:this.demo,not_visible:this.not_visible,status:this.status};this.$emit("update-select-player-item",e)},deleteItem(){const e={id:this.id};this.$emit("delete-select-player-item",e)},removeVideo(){const e={id:this.id};this.$emit("remove-select-player-item",e)},cancelUpdate(){this.$emit("cancel-update")},handleButtonClick(e){console.log("type",e),"demand"===e?this.OpenVideoBrowser():"document"===e?this.OpenDocumentBrowser():"exam"===e?this.OpenExamBrowser():this.openSetContentSource(this.selectPlayerItem,e)},OpenDocumentBrowser(){this.DocumentBrowserOpen=!0},changeDocumentTrigger(e){this.DocumentBrowserOpen=e},selectDocumentTrigger(e){if(void 0!=e){const t={id:this.id,file:e.file};this.$emit("update-player-document",t)}},OpenVideoBrowser(){this.VideoBrowserOpen=!0},changeVideoTrigger(e){this.VideoBrowserOpen=e},selectVideoTrigger(e){if(void 0!=e){const t={id:this.id,file:e.file,duration:e.duration,thumbnail:e.thumbnail};this.$emit("update-player-video",t)}},updateExam(e){if(void 0!=e){const e={id:this.id,questions:this.formattedQuestions};this.$emit("update-player-exam",e)}},openSetContentSource(e,t){console.log("type",e,t),this.setContentTriggerObj=e,this.contentType=t,this.SetContentSourceModal=!0},SetContentTrigger(e){console.log("SetContentTrigger",e),this.SetContentSourceModal=e},handleSetContentSource(e){if(void 0!=e){const t={id:this.id,type:this.type,file:e.contentURL};this.$emit("update-player-video-url",t),this.SetContentSourceModal=!1}},handleDataSource(){console.log("handleDataSource"),this.$emit("update-player-data")},handleTypeChange(){this.saveChanges()},OpenExamBrowser(){},addQuestion(){if(this.newQuestion){const e={id:Date.now(),text:this.newQuestion,answers:[],newAnswer:"",correctAnswer:""};this.questions.push(e),this.newQuestion=""}},addAnswerToQuestion(e){const t=this.questions[e];t.newAnswer&&(t.answers.push({id:Date.now(),text:t.newAnswer}),t.newAnswer="")},removeQuestion(e){this.questions.splice(e,1)},removeAnswer(e,t){this.questions[e].answers.splice(t,1)}}};const dr=(0,rr.A)(cr,[["render",fi],["__scopeId","data-v-d68381e8"]]);var ur=dr,mr=s(40471),gr=s(77823),pr=s(73288),hr=s(63084);cs()().format();const br=new mr.A(!1),xr=["vue.js 3.0","vue.draggable","draggable","component","for","based","on","Sortablejs"];var yr={props:{dataItem:String,tabs:Object},data(){const e=n.A.get("session"),t=n.A.get("configs"),s=t;return{toast:null,configs:n.A.get("configs"),refreshKey:0,schoolSession:s,masterDataRecord:[],contentType:[],courseData:[],courseCategory:[],playerData:[],playerCount:"0",examData:[],categoryData:[],documentData:[],playerParent:[],playerFolder:[],playerChild:[],selectPlayerItem:[],playerParentCount:"",playerChildCount:"",selectedPlayerIndex:null,selectedSubPlayerIndex:null,showPopupWindow:!1,activeBlock:!1,listItems:[],selectedItem:null,activeBlock_text:"กำลังติดต่อฐานข้อมูล กรุณารอสักครู่.....",examCount:"0",schoolAdmin:[],subArray:[],accessToken:e.token,login:e.login,session:e,selectCourseCover:"",loading_sources:!0,FileBrowserOpen:!1,readMoreActivated:!1,dragging:!1,cover:"",type:"",ref:"",display:"",mode:"",modeName:"",displayName:"",kindName:"",principles:"",objective:"",description:"",target:"",structure:"",enabled:!0,order:6,status:"",visibility:"",endpoint:"",valuePoint:"",playerRef:"",examRef:"",playerType:[],modeType:[],displayType:[],kindType:[],enrollCount:0,passCount:0,MasterText:e.MasterText,master:e.master,current:e.current,SetContentSourceModal:!1,setContentTriggerObj:"",list:xr.map(((e,t)=>({name:e,order:t+1}))),modalOpen:!1,filteredResults:[],filteredAdmin:[],searchQuery:"",limitItem:20,limitOptions:[10,20,50,100,200,500,1e3,2e3],currentPage:1,totalPages:0,totalItems:0,searchResults:[{id:1,name:"User 1",email:"user1@example.com"},{id:2,name:"User 2",email:"user2@example.com"},{id:3,name:"User 3",email:"user3@example.com"}],activeTab:"detail"}},components:{draggable:mo.H,FileBrowser:os.A,PlayerEditor:ur},computed:{examType(){return hr.A.log("examType",Yt.Ac),Yt.Ac},dragOptions(){return{animation:1,group:"description",disabled:!1,ghostClass:"ghost"}},getIconForSubItem(){return e=>{switch(e){case"streaming":return["fas","film"];case"demand":return["fas","video"];case"live":return["fas","video"];case"youtube":return["fas","play-circle"];case"document":return["fas","file"];default:return["fas","question-circle"]}}},getClassForTypeAndData(){return(e,t)=>"demand"===e||"streaming"===e||"youtube"===e?void 0===t.video||""===t.video||null===t.video||0===Object.keys(t.video).length?"text-rose-600":"text-lime-600":"document"===e?void 0===t.content||""===t.content||null===t.content?"text-rose-600":"text-lime-600":"text-rose-600"},folderCount(){return this.playerParent.filter((e=>"folder"===e.type)).length},videoCount(){return this.playerParent.filter((e=>"demand"===e.type||"streaming"===e.type||"youtube"===e.type)).length},documentCount(){return this.playerParent.filter((e=>"document"===e.type)).length}},methods:{async callbackFunction(){try{console.log("callbackFunction"),await this.getSurvey(),await this.getSurveySubmission()}catch(e){console.error(e)}},updateBadge(e){this.$emit("update-badge",{code:this.tabs.code,badge:e})},openModal(){this.modalOpen=!0,this.filteredResults=[]},handleCheckboxClick(e){e.stopPropagation()},async closeModal(){this.modalOpen=!1,this.searchQuery=""},formatDuration(e){const t=parseFloat(e);if(isNaN(t)||t<=0)return"00:00";const s=Math.floor(t/60),a=Math.floor(t%60),o=s.toString().padStart(2,"0"),i=a.toString().padStart(2,"0");return`${o}:${i}`},async addPlayer(e,t,s,a){try{this.toast=(0,gr.A)({type:"pending",message:"กำลังเพิ่ม..."});const o=a?"sub":a;let i=("0"+parseInt(t+1)).slice(-2);const r={data:{courseId:this.courseData.master,root:a,mode:o,type:e,name:"บทเรียนสำหรับ "+s+" - "+i,order:i,duration:"00:00:00"},options:{}},n=await this.$Request.POST("player",r,this.configs.key);200===n.status&&(this.toast.hide("เพิ่มเสร็จแล้ว.","success",300),await this.getQueryData())}catch(o){hr.A.log(o)}},async removeVideo(){try{const e={data:{video:{}}},{status:t}=await this.$Request.PUT(`player/${this.selectPlayerItem._id}`,e,this.configs.key);200===t&&(this.selectedPlayerIndex=null,this.playerParent=[],this.selectPlayerItem=[],await this.getQueryData())}catch(e){hr.A.log(e)}},async updataVideo(e){try{let t;console.log("updataVideo",e),e.file.endsWith(".m3u8")?t="streaming":e.file.endsWith(".mp4")&&(t="demand");const s={data:{type:t,video:"streaming"===t?{streaming:e.file}:{desktop:e.file,mobile:e.file},duration:this.formatDuration(e.duration),thumbnail:e.thumbnail},options:{}},{status:a}=await this.$Request.PUT(`player/${e.id}`,s,this.configs.key);if(200===a){this.hideSubPanel(),await this.getQueryData();const t=this.playerParent.find((t=>t._id===e.id))||this.playerChild.find((t=>t._id===e.id));if(t){if("sub"===t.mode){const e=this.playerParent.findIndex((e=>e._id===t.root)),s=this.playerFolder[t.root]?.findIndex((e=>e._id===t._id));-1!==e&&-1!==s&&(this.selectedPlayerIndex=e,this.selectedSubPlayerIndex=[e,s])}else{const e=this.playerParent.findIndex((e=>e._id===t._id));-1!==e&&(this.selectedPlayerIndex=e)}const e=document.getElementById(`panel-${this.selectedPlayerIndex}`);if(e){const t=e.getBoundingClientRect().top+window.scrollY-10;this.smoothScrollTo(t)}}}}catch(t){hr.A.log(t)}},async updataDocument(e){try{const t={data:{content:e.file},options:{}},{status:s}=await this.$Request.PUT(`player/${e.id}`,t,this.configs.key);200===s&&await this.getQueryData()}catch(t){hr.A.log(t)}},async updataExam(e){try{const t={data:{content:e.questions},options:{}},{status:s}=await this.$Request.PUT(`player/${e.id}`,t,this.configs.key);200===s&&await this.getQueryData()}catch(t){hr.A.log(t)}},async updataPlayer(e){try{const t={data:{name:e.name,description:e.description,duration:e.duration,type:e.type,demo:e.demo,not_visible:e.not_visible,status:e.status}},{status:s}=await this.$Request.PUT(`player/${e.id}`,t,this.configs.key);200===s&&(hr.A.log("updataPlayer"),await this.getQueryData())}catch(t){hr.A.log(t)}},async SetContentSource(e){try{const t={data:{video:{}},options:{}};"streaming"===e.type?t.data.video.streaming=e.file:"youtube"===e.type?t.data.video.youtube=e.file:"live"===e.type&&(t.data.video.live=e.file),console.log("SetContentSource A",e);const{status:s}=await this.$Request.PUT(`player/${e.id}`,t,this.configs.key);200===s&&await this.getQueryData()}catch(t){hr.A.log(t)}},togglePanel(e,t){this.selectedPlayerIndex===e?(this.selectedPlayerIndex=null,this.selectedSubPlayerIndex=null):(this.selectedPlayerIndex=e,this.selectedSubPlayerIndex=null,this.selectPlayerItem=t)},smoothScrollTo(e){const t=window.scrollY,s=e-t,a=500;let o=null;function i(e){null===o&&(o=e);const n=e-o,l=r(n,t,s,a);window.scrollTo(0,l),n<a&&requestAnimationFrame(i)}function r(e,t,s,a){return e/=a/2,e<1?s/2*e*e+t:(e--,-s/2*(e*(e-2)-1)+t)}requestAnimationFrame(i)},isOpenPanel(e){return this.selectedPlayerIndex===e&&null===this.selectedSubPlayerIndex},toggleSubPanel(e,t,s){const a=[e,t];this.selectedSubPlayerIndex&&this.selectedSubPlayerIndex[0]===e&&this.selectedSubPlayerIndex[1]===t?this.selectedSubPlayerIndex=null:(this.selectedPlayerIndex=e,this.selectedSubPlayerIndex=a,this.selectPlayerItem=s)},isOpenSubPanel(e,t){return this.selectedSubPlayerIndex&&this.selectedSubPlayerIndex[0]===e&&this.selectedSubPlayerIndex[1]===t},hideSubPanel(){this.selectedSubPlayerIndex=null},hidePanel(){this.selectedPlayerIndex=null,this.selectedSubPlayerIndex=null},getPlayerItemVideoUrl(e){return"demand"===e.type?e.video.desktop:"streaming"===e.type?e.video.streaming:"youtube"===e.type?e.video.youtube:"live"===e.type?e.video.live:""},formatNumber(e){return ns.A.formatNumber(e,"short")},objectFindByKey(e,t,s){for(var a=0;a<e.length;a++)if(e[a][t]===s)return e[a];return null},getCategoryName(e){const t=this.objectFindByKey(this.categoryData,"code",e);return t?t.name:""},getPlayerTypeName(e){if(this.playerType&&Array.isArray(this.playerType)){const t=this.objectFindByKey(this.playerType,"code",e);if(t)return t.name}const t={streaming:"สตรีมมิ่ง",demand:"วิดีโอ",live:"ไลฟ์",youtube:"ยูทูป",document:"เอกสาร",exam:"แบบทดสอบ",folder:"โฟลเดอร์"};return t[e]||e||""},log(e){for(var t of(hr.A.log(e),Object.keys(this.playerParent)))hr.A.log(t+" -> "+this.playerParent[t]._id),this.reOrderPlayer(this.playerParent[t]._id,("0"+t).slice(-2))},log_sub(e){for(var t of(hr.A.log(e),Object.keys(this.playerFolder[e])))hr.A.log(t+" -> "+this.playerFolder[e][t]._id),this.reOrderPlayer(this.playerFolder[e][t]._id,("0"+t).slice(-2))},sort(){this.list=this.list.sort(((e,t)=>e.order-t.order))},dateTime(e){return cs()(e).format("DD/MM/YYYY hh:mm:ss")},async getQueryData(){try{let e=null;const t=[{$match:{$expr:{$eq:["$_id",{$toObjectId:this.dataItem}]}}},{$lookup:{from:"player",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT.master","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseId"]}}}],as:"players"}},{$lookup:{from:"exam",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT.master","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseId"]}}}],as:"exams"}},{$lookup:{from:"document",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT.master","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseId"]}}}],as:"documents"}},{$lookup:{from:"category",let:{categoryCodes:{$ifNull:["$$ROOT.category",[]]}},pipeline:[{$match:{$expr:{$in:["$code","$$categoryCodes"]}}}],as:"categories"}},{$group:{_id:"$_id",course:{$first:"$$ROOT"},category:{$first:"$categories"},player:{$first:"$players"},document:{$first:"$documents"},exam:{$first:"$exams"}}}],s={pipeline:t},a=await br.POST(`${this.endpoint}/aggregate`,s,this.configs.key);if(200===a.status&&(e=a.data,e&&e.length>0)){const t=this.processingData(e);this.masterDataRecord=t,this.resetData(),this.playerData=t.formattedData.players??null,this.courseData=t.formattedData.course??null,this.courseData.categories=t.formattedData.categories??null,this.examData=t.formattedData.exam??null,this.documentData=t.formattedData.document??null,this.playerParent=t.playerParentItems,this.playerChild=t.playerParentChild,this.playerFolder=t.playerParentFolder,this.masterDataRecord&&(this.playerData.sort((function(e,t){return e.order<t.order?-1:1})),this.playerParent.sort((function(e,t){return e.order<t.order?-1:1})),this.playerChild.sort((function(e,t){return e.order<t.order?-1:1}))),this.playerCount=this.playerData.length,this.playerParentCount=this.playerParent.length,this.playerChildCount=this.playerChild.length,this.courseCategory=this.courseData.categories,this.principles=this.courseData.principles,this.objective=this.courseData.objective,this.target=this.courseData.target,this.structure=this.courseData.structure,this.description=this.courseData.description,this.cover=this.courseData.cover,this.mode=this.courseData.mode,this.display=this.courseData.display,this.type=this.courseData.type,this.ref=this.courseData.master,this.playerRef=this.courseData.playerRef??this.courseData.master,this.examRef=this.courseData.examRef??this.courseData.master,this.status=this.courseData.status??!0,this.visibility=this.courseData.visibility??!0,this.examCount=this.examData.length??0,this.documentCount=this.documentData.length??0,this.updateBadge(this.playerCount)}}catch(e){hr.A.log(e)}},processingData(e){const t={players:[],categories:[],document:[],exam:[],course:null},s=new Set,a=new Set,o=new Set,i=new Set,r=[],n=[],l=[];return e.forEach((e=>{Array.isArray(e.player)?e.player.forEach((e=>{i.has(e._id)||(t.players.push(e),i.add(e._id))})):e.player&&!i.has(e.player._id)&&(t.players.push(e.player),i.add(e.player._id)),Array.isArray(e.category)?e.category.forEach((e=>{s.has(e._id)||(t.categories.push(e),s.add(e._id))})):e.category&&!s.has(e.category._id)&&(t.categories.push(e.category),s.add(e.category._id)),Array.isArray(e.document)?e.document.forEach((e=>{a.has(e._id)||(t.document.push(e),a.add(e._id))})):e.document&&!a.has(e.document._id)&&(t.document.push(e.document),a.add(e.document._id)),Array.isArray(e.exam)?e.exam.forEach((e=>{o.has(e._id)||(t.exam.push(e),o.add(e._id))})):e.exam&&!o.has(e.exam._id)&&(t.exam.push(e.exam),o.add(e.exam._id)),t.course||(t.course=e.course)})),t.players.forEach((e=>{"folder"!==e.type&&"sub"===e.mode&&n.push(e)})),t.players.forEach((e=>{"sub"!=e.mode&&(0,Zt.KR)(r.push(e))})),r.forEach((e=>{let t=e._id;l[t]=[],n.forEach((s=>{s.root===e._id&&l[t].push(s)}))})),{formattedData:t,playerParentItems:r,playerParentChild:n,playerParentFolder:l}},resetData(){hr.A.log("resetData",this.courseData),this.searchQuery=null,this.playerData=null,this.courseData=null,this.examData=null,this.documentData=null,this.playerParent=[],this.playerChild=[],this.playerFolder=[],this.playerCount=0,this.playerParentCount=0,this.playerChildCount=0,this.principles=null,this.objective=null,this.target=null,this.structure=null,this.description=null,this.cover=null,this.mode=null,this.display=null,this.type=null,this.ref=null,this.playerRef=null,this.examRef=null,this.status=!0,this.sync=!1,this.examCount=0,this.documentCount=0},changeFileTrigger(e){this.FileBrowserOpen=e},selectFileTrigger(e){hr.A.log("selectFileTrigger"),void 0!=e&&(this.selectCourseCover=e,this.updataCover(e.file))},async updataCover(e){try{const t={data:{cover:e},options:{}},{status:s}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,t,this.configs.key);200===s&&(this.cover=e,this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"แก้ไขรูปหน้าปก",text:"แก้ไขรูปหน้าปก สำเร็จแล้ว"}))}catch(t){hr.A.log(t)}},async toggleStatus(){try{const e={data:{status:this.status},options:{}},{status:t}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,e,this.configs.key);200===t&&hr.A.log("Update Status")}catch(e){hr.A.log(e)}},async toggleVisibility(){try{const e={data:{visibility:this.visibility},options:{}},{status:t}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,e,this.configs.key);200===t&&hr.A.log("Update Sync")}catch(e){hr.A.log(e)}},async changePlayerRef(){try{hr.A.log(this.playerRef);const e={playerRef:this.playerRef},{data:t}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,e,this.accessToken);t.success&&(hr.A.log("Update playerRef"),location.reload())}catch(e){hr.A.log(e)}},async changeExamRef(){try{hr.A.log(this.examRef);const e={examRef:this.examRef},{data:t}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,e,this.accessToken);t.success&&(hr.A.log("Update examRef"),location.reload())}catch(e){hr.A.log(e)}},async unlinkMaster(){try{const e={master:"none",examRef:this.dataItem,playerRef:this.dataItem},{data:t}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,e,this.accessToken);t.success&&(hr.A.log("Update Unlink Master"),location.reload())}catch(e){hr.A.log(e)}},async clonePlayer(e){try{const t=JSON.parse(JSON.stringify(e));t.name+=" (Clone)",t._id=void 0;const s=!e.root;if(s){const s=await this.$Request.POST("player",{data:t},this.configs.key);if(200===s.status){const t=s.data._id;if(this.playerFolder[e._id]&&this.playerFolder[e._id].length>0)for(const s of this.playerFolder[e._id]){const e=JSON.parse(JSON.stringify(s));e.name+=" (Clone)",e._id=void 0,e.root=t,await this.$Request.POST("player",{data:e},this.configs.key)}}}else await this.$Request.POST("player",{data:t},this.configs.key);this.toast.hide("คัดลอกสำเร็จแล้ว.","success",300),await this.getQueryData()}catch(t){console.error(t),this.toast.hide("คัดลอกไม่สำเร็จ.","error",300)}},async deleteParentPlayer(e){pr.A.confirm({title:"ต้องการลบข้อมูลนี้?",message:"หลังจากลบแล้วจะไม่สามารถกู้คืนข้อมูลนี้ได้อีก !",confirm:async()=>{try{this.toast=(0,gr.A)({type:"pending",message:"กำลังลบ.."});const{status:t,data:s}=await this.$Request.DELETE(`player/${e}`,null,this.configs.key);200===t&&(this.toast.hide("ลบเสร็จแล้ว.","success",300),await this.getQueryData(),hr.A.log(s))}catch(t){hr.A.log(t)}},cancel:()=>{}})},async reloadPlayerData(){console.log("reloadPlayerData"),await this.getQueryData()},async deletePlayer(e){try{hr.A.log("updatedItem",e),this.$swal({title:"ต้องการลบข้อมูลนี้ ?",text:"หลังจากลบแล้วจะไม่สามารถกู้คืนข้อมูลนี้ได้อีก !",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ตกลง ลบเลย",cancelButtonText:"ยกเลิก",closeOnConfirm:!1,closeOnCancel:!1}).then((t=>{t.isConfirmed?(hr.A.log("Delete"),this.confirmDeletePlayer(e.id)):hr.A.log("Cancel")}))}catch(t){hr.A.log(t)}},async deleteExam(e,t){if(this.login)try{hr.A.log("id",e),hr.A.log("index",t),this.$swal({title:"ต้องการลบข้อมูลนี้ ?",text:"หลังจากลบแล้วจะไม่สามารถกู้คืนข้อมูลนี้ได้อีก !",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ตกลง ลบเลย",cancelButtonText:"ยกเลิก",closeOnConfirm:!1,closeOnCancel:!1}).then((s=>{s.isConfirmed?(hr.A.log("Delete"),this.confirmDeleteExam(e,t)):hr.A.log("Cancel")}))}catch(s){hr.A.log(s)}},async confirmDeleteExam(e,t){if(this.login)try{const{status:s}=await this.$Request.DELETE(`exam/${e}`,null,this.configs.key);200===s&&(this.examData.splice(t,1),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"ลบข้อมูล",text:"ลบข้อมุลนี้ สำเร็จแล้ว"}))}catch(s){hr.A.log(s)}},async reOrderPlayer(e,t){if(this.login)try{const s={data:{order:t},options:{}},{data:a}=await this.$Request.PUT(`player/${e}`,s,this.configs.key);a.success&&hr.A.log("ReOrder")}catch(s){hr.A.log(s)}},OpenFileBrowser(){this.FileBrowserOpen=!0},OpenVideoBrowser(){this.VideoBrowserOpen=!0},changeVideoTrigger(e){this.VideoBrowserOpen=e},selectVideoTrigger(e){hr.A.log("selectVideoTrigger"),void 0!=e&&(this.selectCourseVideo=e,hr.A.log("selectVideoTriggerFunction",e),this.updataVideo(e.file))},checkMove:function(e){return"apple"!==e.draggedContext.element.name},updated(){ts().replace()},async getFormData(){try{const e={method:"find",args:[{$and:[{owner:this.session.current._id},{type:{$in:["form"]}},{action:{$in:["course"]}}]}],paging:{page:this.currentPage,limit:this.limitItem}},{data:t}=await this.$Request.POST("post/query",e,this.configs.key);this.listItems=t.data,hr.A.log(this.listItems),this.loading_sources=!0}catch(e){hr.A.log(e)}},async updataForm(e){if(this.login)try{const t={data:{form:e},options:{}},{status:s}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,t,this.configs.key);200===s&&(this.form=e,this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"Assign แบบฟอร์ม",text:"Assign แบบฟอร์ม สำเร็จแล้ว"}))}catch(t){hr.A.log(t)}},async updateForm(){this.selectedItem&&(hr.A.log("Selected Item:",this.selectedItem._id,this.dataItem),await this.updataForm(this.selectedItem),await this.getQueryData(),this.showPopupWindow=!1)},async showPopup(){await this.getFormData(),this.showPopupWindow=!0},closePopup(){this.showPopupWindow=!1},handleDeleteDocument(e,t){this.documentData.splice(t,1)},handleAddDocument(){this.getQueryData()},async handleReopenItem(e){await this.getQueryData(),console.log("handleReopenItem",e);const t=this.playerParent.findIndex((t=>t._id===e._id));if(-1!==t){this.selectedPlayerIndex=t;const e=document.getElementById(`panel-${t}`);if(e){const t=e.getBoundingClientRect().top+window.scrollY-10;this.smoothScrollTo(t)}}if("sub"===e.mode){const t=this.playerParent.findIndex((t=>t._id===e.root)),s=this.playerFolder[e.root]?.findIndex((t=>t._id===e._id));if(-1!==t&&-1!==s){this.selectedPlayerIndex=t,this.selectedSubPlayerIndex=[t,s];const e=document.getElementById(`panel-${t}`);if(e){const t=e.getBoundingClientRect().top+window.scrollY-10;this.smoothScrollTo(t)}}}},getSubItemIconColor(e){const t={streaming:"bg-gradient-to-br from-red-500 to-red-600",demand:"bg-gradient-to-br from-blue-500 to-blue-600",live:"bg-gradient-to-br from-purple-500 to-purple-600",youtube:"bg-gradient-to-br from-red-500 to-red-600",document:"bg-gradient-to-br from-green-500 to-green-600",exam:"bg-gradient-to-br from-orange-500 to-orange-600"};return t[e]||"bg-gradient-to-br from-gray-500 to-gray-600"}},created(){this.playerType=Yt.OC},async mounted(){try{this.master?this.endpoint="mcourse":this.endpoint="course",await this.getQueryData(),this.modeType=Yt.Mq,this.modeName=this.modeType&&this.objectFindByKey(this.modeType,"code",this.mode)?.name||"None",this.displayType=Yt.Vy,this.displayName=this.displayType&&this.objectFindByKey(this.displayType,"code",this.display)?.name||"None",this.kindType=Yt.fM,this.kindName=this.kindType&&this.objectFindByKey(this.kindType,"code",this.type)?.name||"None",this.playerType=Yt.OC}catch(e){console.error(Error)}}};const fr=(0,rr.A)(yr,[["render",uo],["__scopeId","data-v-1f4c348d"]]);var kr=fr,vr=s(98589),wr=s(34982);const Lr={class:"fixed top-4 right-4 z-50 space-y-2"},Cr={class:"p-4"},Dr={class:"flex items-start"},Sr={class:"flex-shrink-0"},Fr={key:0,class:"w-6 h-6 text-green-400"},Ir={key:1,class:"w-6 h-6 text-red-400"},Er={class:"ml-3 w-0 flex-1 pt-0.5"},$r={class:"text-sm font-medium text-gray-900"},_r={class:"ml-4 flex-shrink-0 flex"},Pr=["onClick"],Tr={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Ar={class:"px-4 py-3 border-b border-gray-200"},Xr={class:"flex items-center justify-between"},jr={class:"flex items-center space-x-3"},Ur={class:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg flex items-center justify-center"},Br={class:"text-xs text-gray-500"},Or={class:"flex items-center space-x-2"},Qr={class:"flex items-center bg-gray-100 rounded-lg p-1"},Mr={class:"bg-blue-50 border-l-4 border-blue-400 p-3"},Vr={class:"flex"},Rr={class:"flex-shrink-0"},Wr={class:"p-4"},Nr={class:"flex flex-col lg:flex-row gap-3 mb-6"},qr={class:"relative flex-1"},Kr={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},Hr={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},zr={class:"flex items-center gap-3"},Gr={key:0,class:"flex items-center space-x-2 ml-2"},Jr={class:"text-sm text-gray-600 whitespace-nowrap"},Yr={class:"grid grid-cols-4 gap-4 mb-6"},Zr={class:"bg-blue-50 rounded-lg p-3 border border-blue-100"},en={class:"text-lg font-semibold text-blue-900"},tn={class:"bg-red-50 rounded-lg p-3 border border-red-100"},sn={class:"text-lg font-semibold text-red-900"},an={class:"bg-blue-50 rounded-lg p-3 border border-blue-100"},on={class:"text-lg font-semibold text-blue-900"},rn={class:"bg-green-50 rounded-lg p-3 border border-green-100"},nn={class:"text-lg font-semibold text-green-900"},ln={class:"space-y-4"},cn={key:0,class:"text-center py-8"},dn={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},un={key:1,class:"text-center py-8"},mn={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},gn={key:2,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},pn=["onClick"],hn={class:"absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-opacity"},bn=["checked","onChange"],xn={class:"flex justify-center mb-3"},yn={class:"text-center"},fn=["title"],kn={class:"text-xs text-gray-500 uppercase"},vn={class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex space-x-1"},wn=["onClick"],Ln=["onClick"],Cn={key:3,class:"space-y-3"},Dn=["onClick"],Sn={class:"flex-shrink-0 mr-3 opacity-0 group-hover:opacity-100 transition-opacity"},Fn=["checked","onChange"],In={class:"flex-shrink-0 mr-4"},En={class:"flex-1 min-w-0"},$n={class:"flex items-center space-x-2 mb-1"},_n={class:"text-base font-semibold text-gray-900 truncate"},Pn={class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-700 uppercase"},Tn={class:"text-sm text-gray-500"},An={key:0,class:"flex-shrink-0 mr-4"},Xn={class:"text-xs text-gray-500"},jn={class:"flex items-center space-x-1"},Un=["onClick"],Bn=["onClick"],On=["onClick"];function Qn(e,t,s,o,i,r){const n=(0,a.g2)("FileBrowser"),d=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)(a.FK,null,[i.FileBrowserDocOpen?((0,a.uX)(),(0,a.Wv)(n,{key:0,isWindowsOpen:!0,callbackFunction:"document",allowFileType:["doc","docx","xls","xlsx","pdf"],onFileBrowserTrigger:r.changeFileDocumentTrigger,onFileBrowserCallback:r.selectFileDocumentTrigger},null,8,["onFileBrowserTrigger","onFileBrowserCallback"])):(0,a.Q3)("",!0),(0,a.Lk)("div",Lr,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.notifications,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:(0,l.C4)(["max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden transform transition-all duration-300 ease-in-out",{"translate-x-0":e.show,"translate-x-full":!e.show}])},[(0,a.Lk)("div",Cr,[(0,a.Lk)("div",Dr,[(0,a.Lk)("div",Sr,["success"===e.type?((0,a.uX)(),(0,a.CE)("div",Fr,t[13]||(t[13]=[(0,a.Lk)("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)]))):"error"===e.type?((0,a.uX)(),(0,a.CE)("div",Ir,t[14]||(t[14]=[(0,a.Lk)("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)]))):(0,a.Q3)("",!0)]),(0,a.Lk)("div",Er,[(0,a.Lk)("p",$r,(0,l.v_)(e.message),1)]),(0,a.Lk)("div",_r,[(0,a.Lk)("button",{onClick:t=>r.hideNotification(e.id),class:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none"},t[15]||(t[15]=[(0,a.Lk)("span",{class:"sr-only"},"ปิด",-1),(0,a.Lk)("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,Pr)])])])],2)))),128))]),(0,a.Lk)("div",Tr,[(0,a.Lk)("div",Ar,[(0,a.Lk)("div",Xr,[(0,a.Lk)("div",jr,[(0,a.Lk)("div",Ur,[(0,a.bF)(d,{icon:["fas","file"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[16]||(t[16]=(0,a.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"เอกสารประกอบการเรียน",-1)),(0,a.Lk)("p",Br,"จัดการเอกสารและไฟล์ประกอบการเรียน ("+(0,l.v_)(r.filteredDocuments.length)+"/"+(0,l.v_)(s.documentData.length)+" ไฟล์)",1)])]),(0,a.Lk)("div",Or,[(0,a.Lk)("div",Qr,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=e=>i.viewMode="grid"),class:(0,l.C4)(["grid"===i.viewMode?"bg-white shadow-sm text-gray-900":"text-gray-500","p-1.5 rounded text-xs font-medium transition-colors"])},[(0,a.bF)(d,{icon:["fas","th"]})],2),(0,a.Lk)("button",{onClick:t[1]||(t[1]=e=>i.viewMode="list"),class:(0,l.C4)(["list"===i.viewMode?"bg-white shadow-sm text-gray-900":"text-gray-500","p-1.5 rounded text-xs font-medium transition-colors"])},[(0,a.bF)(d,{icon:["fas","list"]})],2)]),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.OpenFileDocumentBrowser&&r.OpenFileDocumentBrowser(...e)),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors shadow-sm"},[(0,a.bF)(d,{icon:["fas","plus"],class:"text-white mr-1.5"}),t[17]||(t[17]=(0,a.eW)(" เพิ่มเอกสาร "))])])])]),(0,a.Lk)("div",Mr,[(0,a.Lk)("div",Vr,[(0,a.Lk)("div",Rr,[(0,a.bF)(d,{icon:["fas","info-circle"],class:"text-blue-400 text-sm"})]),t[18]||(t[18]=(0,a.Lk)("div",{class:"ml-2"},[(0,a.Lk)("p",{class:"text-xs text-blue-700"},[(0,a.Lk)("strong",null,"หมายเหตุ:"),(0,a.eW)(" รองรับไฟล์ประเภท PDF, Word (doc/docx) และ Excel (xls/xlsx) สำหรับเอกสารประกอบการเรียน ")])],-1))])]),(0,a.Lk)("div",Wr,[(0,a.Lk)("div",Nr,[(0,a.Lk)("div",qr,[(0,a.Lk)("div",Kr,[(0,a.bF)(d,{icon:["fas","search"],class:"h-4 w-4 text-gray-400"})]),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.searchQuery=e),type:"text",placeholder:"ค้นหาเอกสาร...",class:"block w-full pl-10 pr-3 py-2.5 border border-gray-200 rounded-lg text-sm bg-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"},null,512),[[c.Jo,i.searchQuery]]),i.searchQuery?((0,a.uX)(),(0,a.CE)("div",Hr,[(0,a.Lk)("button",{onClick:t[4]||(t[4]=e=>i.searchQuery=""),class:"text-gray-400 hover:text-gray-600"},[(0,a.bF)(d,{icon:["fas","times"],class:"h-4 w-4"})])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",zr,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.filterType=e),class:"text-sm border border-gray-200 rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white min-w-0"},t[19]||(t[19]=[(0,a.Fv)('<option value="all" data-v-086e1270>ทุกประเภท</option><option value="pdf" data-v-086e1270>PDF</option><option value="doc" data-v-086e1270>Word</option><option value="docx" data-v-086e1270>Word (docx)</option><option value="xls" data-v-086e1270>Excel</option><option value="xlsx" data-v-086e1270>Excel (xlsx)</option>',6)]),512),[[c.u1,i.filterType]]),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.sortBy=e),class:"text-sm border border-gray-200 rounded-lg px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white min-w-0"},t[20]||(t[20]=[(0,a.Lk)("option",{value:"name"},"เรียงตามชื่อ",-1),(0,a.Lk)("option",{value:"type"},"เรียงตามประเภท",-1),(0,a.Lk)("option",{value:"date"},"เรียงตามวันที่",-1)]),512),[[c.u1,i.sortBy]]),(0,a.Lk)("button",{onClick:t[7]||(t[7]=e=>i.sortDirection="asc"===i.sortDirection?"desc":"asc"),class:"p-2.5 text-gray-400 hover:text-gray-600 text-sm border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors"},[(0,a.bF)(d,{icon:"asc"===i.sortDirection?["fas","sort-up"]:["fas","sort-down"]},null,8,["icon"])]),i.selectedDocuments.length>0?((0,a.uX)(),(0,a.CE)("div",Gr,[(0,a.Lk)("span",Jr,"เลือกแล้ว "+(0,l.v_)(i.selectedDocuments.length)+" ไฟล์",1),(0,a.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>r.bulkDownload&&r.bulkDownload(...e)),class:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-indigo-600 bg-indigo-100 hover:bg-indigo-200 rounded-lg transition-colors whitespace-nowrap"},[(0,a.bF)(d,{icon:["fas","download"],class:"mr-1"}),t[21]||(t[21]=(0,a.eW)(" ดาวน์โหลด "))]),(0,a.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>r.bulkDelete&&r.bulkDelete(...e)),class:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-red-600 bg-red-100 hover:bg-red-200 rounded-lg transition-colors whitespace-nowrap"},[(0,a.bF)(d,{icon:["fas","trash"],class:"mr-1"}),t[22]||(t[22]=(0,a.eW)(" ลบ "))])])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",Yr,[(0,a.Lk)("div",Zr,[t[23]||(t[23]=(0,a.Lk)("div",{class:"text-xs font-medium text-blue-600"},"ทั้งหมด",-1)),(0,a.Lk)("div",en,(0,l.v_)(s.documentData.length),1)]),(0,a.Lk)("div",tn,[t[24]||(t[24]=(0,a.Lk)("div",{class:"text-xs font-medium text-red-600"},"PDF",-1)),(0,a.Lk)("div",sn,(0,l.v_)(r.getFileTypeCount("pdf")),1)]),(0,a.Lk)("div",an,[t[25]||(t[25]=(0,a.Lk)("div",{class:"text-xs font-medium text-blue-600"},"Word",-1)),(0,a.Lk)("div",on,(0,l.v_)(r.getFileTypeCount("doc")+r.getFileTypeCount("docx")),1)]),(0,a.Lk)("div",rn,[t[26]||(t[26]=(0,a.Lk)("div",{class:"text-xs font-medium text-green-600"},"Excel",-1)),(0,a.Lk)("div",nn,(0,l.v_)(r.getFileTypeCount("xls")+r.getFileTypeCount("xlsx")),1)])]),(0,a.Lk)("div",ln,[0===r.filteredDocuments.length&&0===s.documentData.length?((0,a.uX)(),(0,a.CE)("div",cn,[(0,a.Lk)("div",dn,[(0,a.bF)(d,{icon:["fas","file"],class:"text-gray-400 text-lg"})]),t[28]||(t[28]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ยังไม่มีเอกสาร",-1)),t[29]||(t[29]=(0,a.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"เริ่มต้นด้วยการเพิ่มเอกสารประกอบการเรียนครั้งแรก",-1)),(0,a.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>r.OpenFileDocumentBrowser&&r.OpenFileDocumentBrowser(...e)),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors shadow-sm"},[(0,a.bF)(d,{icon:["fas","plus"],class:"mr-1.5"}),t[27]||(t[27]=(0,a.eW)(" เพิ่มเอกสารแรก "))])])):0===r.filteredDocuments.length?((0,a.uX)(),(0,a.CE)("div",un,[(0,a.Lk)("div",mn,[(0,a.bF)(d,{icon:["fas","search"],class:"text-gray-400 text-lg"})]),t[30]||(t[30]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ไม่พบเอกสารที่ค้นหา",-1)),t[31]||(t[31]=(0,a.Lk)("p",{class:"text-sm text-gray-500"},"ลองเปลี่ยนคำค้นหาหรือตัวกรองใหม่",-1))])):"grid"===i.viewMode?((0,a.uX)(),(0,a.CE)("div",gn,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.filteredDocuments,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:e._id,class:"group relative bg-white border border-gray-200 rounded-lg p-4 hover:border-gray-300 hover:shadow-md transition-all duration-200 cursor-pointer",onClick:t=>r.previewDocument(e)},[(0,a.Lk)("div",hn,[(0,a.Lk)("input",{type:"checkbox",checked:i.selectedDocuments.includes(e._id),onChange:t=>r.toggleDocumentSelection(e._id),onClick:t[11]||(t[11]=(0,c.D$)((()=>{}),["stop"])),class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"},null,40,bn)]),(0,a.Lk)("div",xn,[(0,a.Lk)("div",{class:(0,l.C4)(["w-12 h-12 rounded-lg flex items-center justify-center text-white",r.getFileTypeColor(e.type)])},[(0,a.bF)(d,{icon:["fas",r.getFileIcon(e.type)],class:"text-xl"},null,8,["icon"])],2)]),(0,a.Lk)("div",yn,[(0,a.Lk)("h3",{class:"text-sm font-medium text-gray-900 truncate mb-1",title:e.name},(0,l.v_)(e.name),9,fn),(0,a.Lk)("p",kn,(0,l.v_)(e.type),1)]),(0,a.Lk)("div",vn,[(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.downloadDocument(e)),["stop"]),type:"button",class:"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:"ดาวน์โหลด"},[(0,a.bF)(d,{icon:["fas","download"],class:"text-xs"})],8,wn),(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.deleteDocument(e._id,s)),["stop"]),type:"button",class:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"ลบเอกสาร"},[(0,a.bF)(d,{icon:["fas","trash"],class:"text-xs"})],8,Ln)])],8,pn)))),128))])):((0,a.uX)(),(0,a.CE)("div",Cn,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.filteredDocuments,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:e._id,class:"group flex items-center p-4 bg-white border border-gray-200 rounded-lg hover:border-gray-300 hover:bg-gray-50 hover:shadow-sm transition-all duration-200 cursor-pointer",onClick:t=>r.previewDocument(e)},[(0,a.Lk)("div",Sn,[(0,a.Lk)("input",{type:"checkbox",checked:i.selectedDocuments.includes(e._id),onChange:t=>r.toggleDocumentSelection(e._id),onClick:t[12]||(t[12]=(0,c.D$)((()=>{}),["stop"])),class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"},null,40,Fn)]),(0,a.Lk)("div",In,[(0,a.Lk)("div",{class:(0,l.C4)(["w-12 h-12 rounded-lg flex items-center justify-center text-white",r.getFileTypeColor(e.type)])},[(0,a.bF)(d,{icon:["fas",r.getFileIcon(e.type)],class:"text-base"},null,8,["icon"])],2)]),(0,a.Lk)("div",En,[(0,a.Lk)("div",$n,[(0,a.Lk)("h3",_n,(0,l.v_)(e.name),1),(0,a.Lk)("span",Pn,(0,l.v_)(e.type),1)]),(0,a.Lk)("p",Tn," เอกสารประกอบการเรียน • อัปเดตล่าสุด "+(0,l.v_)(r.formatDate(e.updatedAt)),1)]),e.size?((0,a.uX)(),(0,a.CE)("div",An,[(0,a.Lk)("span",Xn,(0,l.v_)(r.formatFileSize(e.size)),1)])):(0,a.Q3)("",!0),(0,a.Lk)("div",jn,[(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.previewDocument(e)),["stop"]),type:"button",class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors",title:"ดูตัวอย่าง"},[(0,a.bF)(d,{icon:["fas","eye"],class:"mr-1 text-xs"}),t[32]||(t[32]=(0,a.eW)(" ดูตัวอย่าง "))],8,Un),(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.downloadDocument(e)),["stop"]),type:"button",class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors",title:"ดาวน์โหลด"},[(0,a.bF)(d,{icon:["fas","download"],class:"mr-1 text-xs"}),t[33]||(t[33]=(0,a.eW)(" ดาวน์โหลด "))],8,Bn),(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.deleteDocument(e._id,s)),["stop"]),type:"button",class:"inline-flex items-center px-2.5 py-1 border border-red-200 rounded-md text-xs font-medium text-red-600 bg-red-50 hover:bg-red-100 transition-colors",title:"ลบเอกสาร"},[(0,a.bF)(d,{icon:["fas","trash"],class:"mr-1 text-xs"}),t[34]||(t[34]=(0,a.eW)(" ลบ "))],8,On)])],8,Dn)))),128))]))])])])],64)}var Mn={data(){return{configs:n.A.get("configs"),FileBrowserDocOpen:!1,viewMode:"list",searchQuery:"",filterType:"all",sortBy:"name",sortDirection:"asc",selectedDocuments:[],notifications:[],notificationId:0}},props:{documentData:{type:Array,required:!0},courseData:{type:Array,required:!0},tabs:Object,updateTabs:Object},components:{FileBrowser:os.A},computed:{filteredDocuments(){let e=this.documentData.filter((e=>{const t=!this.searchQuery||e.name.toLowerCase().includes(this.searchQuery.toLowerCase()),s="all"===this.filterType||e.type.toLowerCase()===this.filterType.toLowerCase();return t&&s}));return e.sort(((e,t)=>{let s,a;switch(this.sortBy){case"name":s=e.name.toLowerCase(),a=t.name.toLowerCase();break;case"type":s=e.type.toLowerCase(),a=t.type.toLowerCase();break;case"date":s=new Date(e.updatedAt||e.createdAt||0),a=new Date(t.updatedAt||t.createdAt||0);break;default:s=e.name.toLowerCase(),a=t.name.toLowerCase()}return"asc"===this.sortDirection?s>a?1:-1:s<a?1:-1})),e}},methods:{getFileIcon(e){const t=e.toLowerCase();switch(t){case"pdf":return"file-pdf";case"doc":case"docx":return"file-word";case"xls":case"xlsx":return"file-excel";default:return"file"}},getFileTypeColor(e){const t=e.toLowerCase();switch(t){case"pdf":return"bg-red-500";case"doc":case"docx":return"bg-blue-500";case"xls":case"xlsx":return"bg-green-500";default:return"bg-gray-500"}},getFileTypeCount(e){return this.documentData.filter((t=>t.type.toLowerCase()===e.toLowerCase())).length},formatDate(e){if(!e)return"ไม่ระบุ";const t=new Date(e);return t.toLocaleDateString("th-TH")},formatFileSize(e){if(!e)return"";const t=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,s)*100)/100+" "+t[s]},toggleDocumentSelection(e){const t=this.selectedDocuments.indexOf(e);t>-1?this.selectedDocuments.splice(t,1):this.selectedDocuments.push(e)},previewDocument(e){this.showNotification(`เปิดดูเอกสาร: ${e.name}`,"success")},downloadDocument(e){this.showNotification(`กำลังดาวน์โหลด: ${e.name}`,"success")},bulkDownload(){0!==this.selectedDocuments.length&&(this.showNotification(`กำลังดาวน์โหลด ${this.selectedDocuments.length} ไฟล์`,"success"),this.selectedDocuments=[])},bulkDelete(){0!==this.selectedDocuments.length&&this.$swal({title:`ต้องการลบเอกสาร ${this.selectedDocuments.length} ไฟล์?`,text:"หลังจากลบแล้วจะไม่สามารถกู้คืนข้อมูลได้อีก!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ตกลง ลบเลย",cancelButtonText:"ยกเลิก"}).then((async e=>{if(e.isConfirmed){for(const e of this.selectedDocuments){const t=this.documentData.findIndex((t=>t._id===e));t>-1&&await this.deleteDocument(e,t)}this.selectedDocuments=[],this.showNotification(`ลบเอกสาร ${this.selectedDocuments.length} ไฟล์เรียบร้อยแล้ว`,"success")}}))},showNotification(e,t="success"){const s={id:++this.notificationId,message:e,type:t,show:!0};this.notifications.push(s),setTimeout((()=>{this.hideNotification(s.id)}),3e3)},hideNotification(e){const t=this.notifications.findIndex((t=>t.id===e));t>-1&&this.notifications.splice(t,1)},async callbackFunction(){try{console.log("callbackFunction")}catch(e){console.error(e)}},delay(e){return new Promise((t=>setTimeout(t,e)))},updateBadge(e){this.$emit("update-badge",{code:this.tabs.code,badge:e})},OpenFileDocumentBrowser(){this.FileBrowserDocOpen=!0},changeFileDocumentTrigger(e){this.FileBrowserDocOpen=e},selectFileDocumentTrigger(e){hr.A.log("selectFileDocumentTrigger"),void 0!=e&&(this.FileBrowserDocOpen=!1,this.addDocument(e.file))},async addDocument(e){try{let t=e.replace("/","").substring(e.replace("/","").lastIndexOf(".")+1),s=e.substring(e.lastIndexOf("/"));hr.A.log("filename",s);const a=await fetch("https://gateway.cloudrestfulapi.com/api/document",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{courseId:this.courseData.master,file:e,name:s.replace(/\//g,""),type:t},options:{}})});if(a.ok){const e=await a.json();hr.A.log("Document added:",e),this.$emit("add-document",e),this.showNotification(`เพิ่มเอกสาร "${e.name}" เรียบร้อยแล้ว`,"success")}else{const e=await a.text();hr.A.error("Failed to add document:",a.status,e),this.showNotification("เกิดข้อผิดพลาดในการเพิ่มเอกสาร","error")}}catch(t){hr.A.error("Error in addDocument:",t),this.showNotification("เกิดข้อผิดพลาดในการเพิ่มเอกสาร","error")}},async deleteDocument(e,t){try{const s=await fetch("https://gateway.cloudrestfulapi.com/api/document/"+e,{method:"DELETE",headers:{"Content-Type":"application/json","client-token-key":this.configs.key}});if(s.ok){if(hr.A.log("Document deleted:",e),this.$emit("delete-document",e,t),this.showNotification("ลบเอกสารเรียบร้อยแล้ว","success"),204!==s.status){const e=await s.json();hr.A.log("Delete response:",e)}}else{const e=await s.text();hr.A.error("Failed to delete document:",s.status,e),this.showNotification("เกิดข้อผิดพลาดในการลบเอกสาร","error")}}catch(s){hr.A.error("Error in deleteDocument:",s),this.showNotification("เกิดข้อผิดพลาดในการลบเอกสาร","error")}}}};const Vn=(0,rr.A)(Mn,[["render",Qn],["__scopeId","data-v-086e1270"]]);var Rn=Vn;const Wn={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Nn={class:"px-4 py-3 border-b border-gray-200"},qn={class:"flex items-center justify-between"},Kn={class:"flex items-center space-x-3"},Hn={class:"w-8 h-8 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center"},zn={class:"text-xs text-gray-500"},Gn={class:"flex items-center space-x-2"},Jn={class:"bg-blue-50 border-l-4 border-blue-400 p-3"},Yn={class:"flex"},Zn={class:"flex-shrink-0"},el={class:"p-4"},tl={class:"grid grid-cols-4 gap-4 mb-6"},sl={class:"bg-purple-50 rounded-lg p-3 border border-purple-100"},al={class:"text-lg font-semibold text-purple-900"},ol={class:"bg-green-50 rounded-lg p-3 border border-green-100"},il={class:"text-lg font-semibold text-green-900"},rl={class:"bg-blue-50 rounded-lg p-3 border border-blue-100"},nl={class:"text-lg font-semibold text-blue-900"},ll={class:"bg-indigo-50 rounded-lg p-3 border border-indigo-100"},cl={class:"text-lg font-semibold text-indigo-900"},dl={class:"space-y-4"},ul={key:0,class:"text-center py-8"},ml={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},gl={key:1,class:"space-y-3"},pl={class:"p-4"},hl=["onClick"],bl={class:"flex items-center space-x-3 flex-1 cursor-pointer"},xl={class:"flex-shrink-0"},yl={class:"w-12 h-12 rounded-lg flex items-center justify-center text-white bg-gradient-to-br from-purple-500 to-purple-600"},fl={class:"flex-1 min-w-0"},kl={class:"flex items-center space-x-2 mb-1"},vl={class:"text-base font-semibold text-gray-900"},wl={class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800"},Ll={class:"flex items-center space-x-3 text-xs text-gray-500"},Cl={class:"flex items-center"},Dl={class:"flex items-center"},Sl={class:"flex items-center"},Fl={class:"flex items-center justify-between pt-3 border-t border-gray-200"},Il={class:"flex items-center space-x-2"},El=["onClick"],$l={class:"flex items-center space-x-1"},_l=["onClick"],Pl=["onClick"],Tl={key:0,class:"border-t border-gray-200 bg-gray-50"},Al={class:"p-4"};function Xl(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon"),d=(0,a.g2)("ContestDetail");return(0,a.uX)(),(0,a.CE)("div",Wn,[(0,a.Lk)("div",Nn,[(0,a.Lk)("div",qn,[(0,a.Lk)("div",Kn,[(0,a.Lk)("div",Hn,[(0,a.bF)(n,{icon:["fas","square-check"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[2]||(t[2]=(0,a.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"แบบทดสอบ",-1)),(0,a.Lk)("p",zn,"จัดการแบบทดสอบและการประเมินผล ("+(0,l.v_)(s.examCount)+" แบบทดสอบ)",1)])]),(0,a.Lk)("div",Gn,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$router.push("/lesson/exam/add/"+s.courseData.master+"/"+s.dataItem)),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-purple-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-white mr-1.5"}),t[3]||(t[3]=(0,a.eW)(" เพิ่มแบบทดสอบ "))])])])]),(0,a.Lk)("div",Jn,[(0,a.Lk)("div",Yn,[(0,a.Lk)("div",Zn,[(0,a.bF)(n,{icon:["fas","info-circle"],class:"text-blue-400 text-sm"})]),t[4]||(t[4]=(0,a.Lk)("div",{class:"ml-2"},[(0,a.Lk)("p",{class:"text-xs text-blue-700"},[(0,a.Lk)("strong",null,"หมายเหตุ:"),(0,a.eW)(" จัดการแบบทดสอบ แบบฝึกหัด และการประเมินผลสำหรับหลักสูตรนี้ ")])],-1))])]),(0,a.Lk)("div",el,[(0,a.Lk)("div",tl,[(0,a.Lk)("div",sl,[t[5]||(t[5]=(0,a.Lk)("div",{class:"text-xs font-medium text-purple-600"},"ทั้งหมด",-1)),(0,a.Lk)("div",al,(0,l.v_)(s.examCount),1)]),(0,a.Lk)("div",ol,[t[6]||(t[6]=(0,a.Lk)("div",{class:"text-xs font-medium text-green-600"},"ข้อสอบ",-1)),(0,a.Lk)("div",il,(0,l.v_)(r.totalQuestions),1)]),(0,a.Lk)("div",rl,[t[7]||(t[7]=(0,a.Lk)("div",{class:"text-xs font-medium text-blue-600"},"เวลาเฉลี่ย",-1)),(0,a.Lk)("div",nl,(0,l.v_)(r.averageTime)+" นาที",1)]),(0,a.Lk)("div",ll,[t[8]||(t[8]=(0,a.Lk)("div",{class:"text-xs font-medium text-indigo-600"},"ประเภท",-1)),(0,a.Lk)("div",cl,(0,l.v_)(r.uniqueTypes),1)])]),(0,a.Lk)("div",dl,[0===s.examData.length?((0,a.uX)(),(0,a.CE)("div",ul,[(0,a.Lk)("div",ml,[(0,a.bF)(n,{icon:["fas","square-check"],class:"text-gray-400 text-lg"})]),t[10]||(t[10]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ยังไม่มีแบบทดสอบ",-1)),t[11]||(t[11]=(0,a.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"เริ่มต้นด้วยการสร้างแบบทดสอบครั้งแรก",-1)),(0,a.Lk)("button",{onClick:t[1]||(t[1]=t=>e.$router.push("/lesson/exam/add/"+s.courseData.master+"/"+s.dataItem)),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-purple-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-1.5"}),t[9]||(t[9]=(0,a.eW)(" เพิ่มแบบทดสอบแรก "))])])):((0,a.uX)(),(0,a.CE)("div",gl,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.examData,((o,u)=>((0,a.uX)(),(0,a.CE)("div",{key:o._id,class:"bg-white border border-gray-200 rounded-lg hover:border-gray-300 hover:shadow-md transition-all duration-200"},[(0,a.Lk)("div",pl,[(0,a.Lk)("div",{class:"flex items-center justify-between mb-3",onClick:e=>r.toggleExpand(o._id)},[(0,a.Lk)("div",bl,[(0,a.Lk)("div",xl,[(0,a.Lk)("div",yl,[(0,a.bF)(n,{icon:["fas",r.getExamTypeIcon(o.type)],class:"text-base"},null,8,["icon"])])]),(0,a.Lk)("div",fl,[(0,a.Lk)("div",kl,[(0,a.Lk)("h3",vl,(0,l.v_)(u+1)+". "+(0,l.v_)(o.name),1),(0,a.Lk)("span",wl,(0,l.v_)(r.objectFindByKey(r.examType,"code",o.type).name),1)]),(0,a.Lk)("div",Ll,[(0,a.Lk)("span",Cl,[(0,a.bF)(n,{icon:["fas","question-circle"],class:"mr-1 text-blue-500"}),(0,a.eW)(" "+(0,l.v_)(o.total)+" ข้อ ",1)]),t[12]||(t[12]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",Dl,[(0,a.bF)(n,{icon:["fas","clock"],class:"mr-1 text-green-500"}),(0,a.eW)(" "+(0,l.v_)(o.timer)+" นาที ",1)]),t[13]||(t[13]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",Sl,[(0,a.bF)(n,{icon:["fas","chart-bar"],class:"mr-1 text-orange-500"}),(0,a.eW)(" 0/"+(0,l.v_)(o.total),1)])])])])],8,hl),(0,a.Lk)("div",Fl,[(0,a.Lk)("div",Il,[(0,a.Lk)("button",{onClick:(0,c.D$)((t=>e.$router.push("/lesson/exam/edit/"+o._id+"/"+s.dataItem)),["stop"]),class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors",title:"แก้ไข"},[(0,a.bF)(n,{icon:["fas","pencil"],class:"mr-1 text-xs"}),t[14]||(t[14]=(0,a.eW)(" แก้ไข "))],8,El)]),(0,a.Lk)("div",$l,[(0,a.Lk)("button",{onClick:(0,c.D$)((e=>r.toggleExpand(o._id)),["stop"]),type:"button",class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors"},[(0,a.bF)(n,{icon:["fas","eye"],class:"mr-1 text-xs"}),t[15]||(t[15]=(0,a.eW)(" ดูรายละเอียด "))],8,_l),(0,a.Lk)("button",{onClick:(0,c.D$)((e=>r.deleteExam(o._id,u)),["stop"]),type:"button",class:"inline-flex items-center px-2.5 py-1 border border-red-200 rounded-md text-xs font-medium text-red-600 bg-red-50 hover:bg-red-100 transition-colors"},[(0,a.bF)(n,{icon:["fas","trash"],class:"mr-1 text-xs"}),t[16]||(t[16]=(0,a.eW)(" ลบ "))],8,Pl)])])]),(0,a.bF)(c.eB,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:(0,a.k6)((()=>[i.expandedExams[o._id]?((0,a.uX)(),(0,a.CE)("div",Tl,[(0,a.Lk)("div",Al,[(0,a.bF)(d,{examid:o._id,pageTitle:"ผู้ลงทะเบียนหลักสูตรนี้"},null,8,["examid"])])])):(0,a.Q3)("",!0)])),_:2},1024)])))),128))]))])])])}const jl={class:"fixed top-4 right-4 z-50 space-y-2"},Ul={class:"p-4"},Bl={class:"flex items-start"},Ol={class:"flex-shrink-0"},Ql={key:0,class:"w-6 h-6 text-green-400"},Ml={key:1,class:"w-6 h-6 text-red-400"},Vl={class:"ml-3 w-0 flex-1 pt-0.5"},Rl={class:"text-sm font-medium text-gray-900"},Wl={class:"ml-4 flex-shrink-0 flex"},Nl=["onClick"],ql={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Kl={class:"mx-auto w-full"},Hl={class:"w-full"},zl={"aria-labelledby":"notes-title",id:"root-panel"},Gl={class:"bg-transparent border-t border-gray-200 pt-4 mt-5"},Jl={class:"space-y-4"},Yl={class:"px-0 py-0"},Zl={class:"flex items-center justify-between mb-4"},ec={id:"notes-title",class:"text-sm font-bold text-gray-900"},tc={class:"text-sm font-normal text-gray-500"},sc={class:"flex items-center space-x-2"},ac={class:"mb-4 space-y-3"},oc={class:"relative"},ic={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},rc={class:"flex flex-wrap items-center gap-2"},nc={class:"flex items-center ml-auto"},lc=["checked","indeterminate"],cc={key:0,class:"grid grid-cols-4 gap-2 mb-4"},dc={class:"bg-blue-50 rounded px-2 py-1.5 border border-blue-100"},uc={class:"text-sm font-semibold text-blue-900"},mc={class:"bg-green-50 rounded px-2 py-1.5 border border-green-100"},gc={class:"text-sm font-semibold text-green-900"},pc={class:"bg-yellow-50 rounded px-2 py-1.5 border border-yellow-100"},hc={class:"text-sm font-semibold text-yellow-900"},bc={class:"bg-purple-50 rounded px-2 py-1.5 border border-purple-100"},xc={class:"text-xs text-purple-900"},yc={key:1,class:"mb-4 p-2 bg-indigo-50 border border-indigo-200 rounded"},fc={class:"flex items-center justify-between"},kc={class:"text-xs font-medium text-indigo-900"},vc={class:"flex items-center space-x-1"},wc={class:"pb-5"},Lc={key:0,class:"flex items-center justify-center py-8"},Cc={key:1,class:"space-y-2"},Dc=["id"],Sc={class:"w-full block text-sm font-medium text-gray-900 border-b border-gray-100 pb-2 hover:text-blue-600 transition-colors relative"},Fc={class:"absolute top-0 left-0 opacity-0 group-hover:opacity-100 transition-opacity"},Ic=["checked","onChange"],Ec=["onClick"],$c={class:"flex items-start justify-between pr-6 pl-5"},_c={class:"flex-1"},Pc={class:"inline-block w-6 text-indigo-600 text-sm font-medium"},Tc=["onClick","innerHTML"],Ac={class:"flex items-center space-x-1 ml-3"},Xc={key:0,class:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800"},jc={class:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-700"},Uc={class:"mt-2 w-full pl-5"},Bc={class:"flex items-center"},Oc={key:0,type:"radio",checked:"",class:"h-3 w-3 border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-2",disabled:"",readonly:""},Qc=["id"],Mc={class:"block text-sm text-gray-700"},Vc={class:"pb-3 font-medium flex justify-between items-center border-b border-gray-100"},Rc={class:"flex items-center space-x-2"},Wc={class:"text-sm text-gray-900"},Nc={key:0,class:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800"},qc={class:"space-y-3 mt-3"},Kc={class:"flex space-x-3"},Hc={class:"flex items-center"},zc=["onUpdate:modelValue","onChange"],Gc={class:"flex items-center"},Jc=["onUpdate:modelValue","onChange"],Yc={class:"flex items-center"},Zc=["onUpdate:modelValue","onChange"],ed=["onUpdate:modelValue","onInput"],td={class:"border-t border-gray-100 pt-3"},sd={class:"flex items-center justify-between mb-1"},ad=["onClick","disabled"],od={class:"flex items-center justify-between mb-2"},id=["onClick"],rd={class:"space-y-1"},nd={class:"flex items-center space-x-2 flex-shrink-0"},ld={class:"inline-flex items-center justify-center w-5 h-5 rounded-full text-xs font-medium bg-gray-100 text-gray-600"},cd=["onUpdate:modelValue","id","name","value"],dd={class:"flex-1 min-w-0"},ud=["onUpdate:modelValue","onInput","placeholder"],md=["onClick"],gd={class:"border-t border-gray-100 pt-3 mt-3 flex justify-between"},pd=["onClick"],hd=["onClick"];function bd(e,t,s,o,i,r){const n=(0,a.g2)("FileBrowser"),d=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)(a.FK,null,[i.FileBrowserOpen?((0,a.uX)(),(0,a.Wv)(n,{key:0,isWindowsOpen:!0,allowFileType:["jpg","gif","png","jpeg"],onFileBrowserTrigger:r.changeFileTrigger,onSelectFileTrigger:r.selectFileTrigger},null,8,["onFileBrowserTrigger","onSelectFileTrigger"])):(0,a.Q3)("",!0),(0,a.Lk)("div",null,[(0,a.Lk)("div",jl,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.notifications,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:(0,l.C4)(["max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden transform transition-all duration-300 ease-in-out",{"translate-x-0":e.show,"translate-x-full":!e.show}])},[(0,a.Lk)("div",Ul,[(0,a.Lk)("div",Bl,[(0,a.Lk)("div",Ol,["success"===e.type?((0,a.uX)(),(0,a.CE)("div",Ql,t[16]||(t[16]=[(0,a.Lk)("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)]))):"error"===e.type?((0,a.uX)(),(0,a.CE)("div",Ml,t[17]||(t[17]=[(0,a.Lk)("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)]))):(0,a.Q3)("",!0)]),(0,a.Lk)("div",Vl,[(0,a.Lk)("p",Rl,(0,l.v_)(e.message),1)]),(0,a.Lk)("div",Wl,[(0,a.Lk)("button",{onClick:t=>r.hideNotification(e.id),class:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none"},t[18]||(t[18]=[(0,a.Lk)("span",{class:"sr-only"},"ปิด",-1),(0,a.Lk)("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,Nl)])])])],2)))),128))]),i.isSaving?((0,a.uX)(),(0,a.CE)("div",ql,t[19]||(t[19]=[(0,a.Lk)("div",{class:"bg-white rounded-lg p-6 flex items-center space-x-3"},[(0,a.Lk)("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"}),(0,a.Lk)("span",{class:"text-gray-700"},"กำลังบันทึกข้อมูล...")],-1)]))):(0,a.Q3)("",!0),(0,a.Lk)("div",Kl,[(0,a.Lk)("div",Hl,[(0,a.Lk)("section",zl,[(0,a.Lk)("div",Gl,[(0,a.Lk)("div",Jl,[(0,a.Lk)("div",Yl,[(0,a.Lk)("div",Zl,[(0,a.Lk)("h2",ec,[t[20]||(t[20]=(0,a.eW)(" ข้อสอบทั้งหมด ")),(0,a.Lk)("span",tc," ("+(0,l.v_)(r.filteredQuestions.length)+"/"+(0,l.v_)(r.questionStats.total)+" ข้อ) ",1)]),(0,a.Lk)("div",sc,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.exportQuestions&&r.exportQuestions(...e)),type:"button",class:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-1 focus:ring-indigo-500 transition-colors"},[(0,a.bF)(d,{icon:["fas","download"],class:"mr-1 text-xs"}),t[21]||(t[21]=(0,a.eW)(" ส่งออก "))]),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.toggleExpandAll&&r.toggleExpandAll(...e)),type:"button",class:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-1 focus:ring-indigo-500 transition-colors"},[(0,a.bF)(d,{icon:i.expandAll?["fas","compress"]:["fas","expand"],class:"mr-1 text-xs"},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(i.expandAll?"ย่อทั้งหมด":"ขยายทั้งหมด"),1)]),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(0,c.D$)((e=>r.addQuestion(i.questionData.length)),["stop"])),type:"button",class:"inline-flex items-center rounded border border-transparent bg-indigo-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-1 focus:ring-indigo-500 transition-colors"},[(0,a.bF)(d,{icon:["fas","plus"],class:"text-white mr-1 text-xs"}),t[22]||(t[22]=(0,a.eW)(" เพิ่มข้อสอบ "))])])]),(0,a.Lk)("div",ac,[(0,a.Lk)("div",oc,[(0,a.Lk)("div",ic,[(0,a.bF)(d,{icon:["fas","search"],class:"h-3 w-3 text-gray-400"})]),(0,a.bo)((0,a.Lk)("input",{ref:"searchInput","onUpdate:modelValue":t[3]||(t[3]=e=>i.searchQuery=e),type:"text",placeholder:"ค้นหาข้อสอบ... (Ctrl+F)",class:"block w-full pl-9 pr-3 py-2 border border-gray-200 rounded text-sm bg-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[c.Jo,i.searchQuery]])]),(0,a.Lk)("div",rc,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>i.filterType=e),class:"text-xs border border-gray-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-indigo-500 bg-white"},t[23]||(t[23]=[(0,a.Lk)("option",{value:"all"},"ทุกประเภท",-1),(0,a.Lk)("option",{value:"text"},"ข้อความ",-1),(0,a.Lk)("option",{value:"image"},"รูปภาพ",-1),(0,a.Lk)("option",{value:"video"},"วิดีโอ",-1)]),512),[[c.u1,i.filterType]]),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.sortBy=e),class:"text-xs border border-gray-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-indigo-500 bg-white"},t[24]||(t[24]=[(0,a.Lk)("option",{value:"order"},"เรียงตามลำดับ",-1),(0,a.Lk)("option",{value:"created"},"เรียงตามวันที่สร้าง",-1),(0,a.Lk)("option",{value:"modified"},"เรียงตามวันที่แก้ไข",-1)]),512),[[c.u1,i.sortBy]]),(0,a.Lk)("button",{onClick:t[6]||(t[6]=e=>i.sortDirection="asc"===i.sortDirection?"desc":"asc"),class:"p-1 text-gray-400 hover:text-gray-600 text-xs"},[(0,a.bF)(d,{icon:"asc"===i.sortDirection?["fas","sort-up"]:["fas","sort-down"]},null,8,["icon"])]),(0,a.Lk)("div",nc,[(0,a.Lk)("input",{type:"checkbox",checked:r.allSelected,indeterminate:r.someSelected,onChange:t[7]||(t[7]=(...e)=>r.selectAllQuestions&&r.selectAllQuestions(...e)),class:"h-3 w-3 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"},null,40,lc),t[25]||(t[25]=(0,a.Lk)("label",{class:"ml-1 text-xs text-gray-600"},"เลือกทั้งหมด",-1))])])]),i.showStats?((0,a.uX)(),(0,a.CE)("div",cc,[(0,a.Lk)("div",dc,[t[26]||(t[26]=(0,a.Lk)("div",{class:"text-xs font-medium text-blue-600"},"ทั้งหมด",-1)),(0,a.Lk)("div",uc,(0,l.v_)(r.questionStats.total),1)]),(0,a.Lk)("div",mc,[t[27]||(t[27]=(0,a.Lk)("div",{class:"text-xs font-medium text-green-600"},"มีคำตอบ",-1)),(0,a.Lk)("div",gc,(0,l.v_)(r.questionStats.withAnswers),1)]),(0,a.Lk)("div",pc,[t[28]||(t[28]=(0,a.Lk)("div",{class:"text-xs font-medium text-yellow-600"},"ยังไม่บันทึก",-1)),(0,a.Lk)("div",hc,(0,l.v_)(r.questionStats.unsaved),1)]),(0,a.Lk)("div",bc,[t[29]||(t[29]=(0,a.Lk)("div",{class:"text-xs font-medium text-purple-600"},"ประเภท",-1)),(0,a.Lk)("div",xc,(0,l.v_)(r.questionStats.byType.text)+"/"+(0,l.v_)(r.questionStats.byType.image)+"/"+(0,l.v_)(r.questionStats.byType.video),1)])])):(0,a.Q3)("",!0),i.showBulkActions?((0,a.uX)(),(0,a.CE)("div",yc,[(0,a.Lk)("div",fc,[(0,a.Lk)("span",kc," เลือกแล้ว "+(0,l.v_)(i.selectedQuestions.length)+" ข้อ ",1),(0,a.Lk)("div",vc,[(0,a.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>r.bulkDeleteQuestions&&r.bulkDeleteQuestions(...e)),class:"inline-flex items-center px-2 py-1 text-xs font-medium text-red-600 bg-red-100 hover:bg-red-200 rounded transition-colors"},[(0,a.bF)(d,{icon:["fas","trash"],class:"mr-1 text-xs"}),t[30]||(t[30]=(0,a.eW)(" ลบที่เลือก "))]),(0,a.Lk)("button",{onClick:t[9]||(t[9]=e=>{i.selectedQuestions=[],i.showBulkActions=!1}),class:"inline-flex items-center px-2 py-1 text-xs font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded transition-colors"}," ยกเลิก ")])])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",wc,[i.loading_sources?((0,a.uX)(),(0,a.CE)("div",Cc,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.filteredQuestions,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:e._id,class:(0,l.C4)(["p-3 cursor-pointer rounded border border-gray-200 transition-all duration-200 group hover:border-gray-300 hover:bg-gray-50",{"border-indigo-300 bg-indigo-50":i.selectedExamIndex===s,"border-l-4 border-l-orange-400":r.hasUnsavedChanges(e._id),"ring-1 ring-indigo-200":i.selectedQuestions.includes(e._id)}]),id:`panel-${s}`},[(0,a.Lk)("fieldset",{class:(0,l.C4)({hidden:i.selectedExamIndex===s||i.expandAll})},[(0,a.Lk)("div",Sc,[(0,a.Lk)("div",Fc,[(0,a.Lk)("input",{type:"checkbox",checked:i.selectedQuestions.includes(e._id),onChange:t=>r.toggleQuestionSelection(e._id),onClick:t[10]||(t[10]=(0,c.D$)((()=>{}),["stop"])),class:"h-3 w-3 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"},null,40,Ic)]),(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.handleButtonClick(e)),["stop"]),type:"button",class:"absolute top-0 right-0 p-1 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors opacity-0 group-hover:opacity-100",title:"ลบข้อสอบนี้"},[(0,a.bF)(d,{icon:["fas","trash"],class:"text-xs"})],8,Ec),(0,a.Lk)("div",$c,[(0,a.Lk)("div",_c,[(0,a.Lk)("span",Pc,(0,l.v_)(s+1)+".",1),(0,a.Lk)("div",{onClick:t=>r.togglePanel(s,e),innerHTML:e.detail,class:"inline text-sm font-bold"},null,8,Tc)]),(0,a.Lk)("div",Ac,[r.hasUnsavedChanges(e._id)?((0,a.uX)(),(0,a.CE)("span",Xc,t[32]||(t[32]=[(0,a.Lk)("div",{class:"w-1.5 h-1.5 bg-orange-400 rounded-full mr-1 animate-pulse"},null,-1),(0,a.eW)(" ยังไม่บันทึก ")]))):(0,a.Q3)("",!0),(0,a.Lk)("span",jc,(0,l.v_)(e.type),1)])])]),(0,a.Lk)("div",Uc,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.answers,((t,s)=>((0,a.uX)(),(0,a.CE)("div",{key:t._id,class:"flex items-center py-1"},[(0,a.Lk)("div",Bc,[(0,a.Lk)("span",{class:(0,l.C4)(["inline-flex items-center justify-center w-5 h-5 rounded-full text-xs font-medium mr-2",e.correct===t._id?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"])},(0,l.v_)(String.fromCharCode(65+s)),3),e.correct===t._id?((0,a.uX)(),(0,a.CE)("input",Oc)):((0,a.uX)(),(0,a.CE)("input",{key:1,id:t._id,type:"radio",class:"h-3 w-3 border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-2",disabled:"",readonly:""},null,8,Qc)),(0,a.Lk)("label",Mc,(0,l.v_)(t.detail),1)])])))),128))])],2),r.isOpenPanel(s)||i.expandAll?((0,a.uX)(),(0,a.CE)("div",{key:0,class:(0,l.C4)(["mt-2 relative",{isblock:i.isLoading}]),"data-content":"กำลังบันทึกข้อมูล..."},[(0,a.Lk)("div",Vc,[(0,a.Lk)("div",Rc,[(0,a.Lk)("span",Wc,"แก้ไขข้อสอบข้อที่ "+(0,l.v_)(s+1),1),r.hasUnsavedChanges(e._id)?((0,a.uX)(),(0,a.CE)("span",Nc,t[33]||(t[33]=[(0,a.Lk)("div",{class:"w-1.5 h-1.5 bg-orange-400 rounded-full mr-1 animate-pulse"},null,-1),(0,a.eW)(" มีการเปลี่ยนแปลง ")]))):(0,a.Q3)("",!0)]),(0,a.Lk)("button",{onClick:t[11]||(t[11]=(0,c.D$)(((...e)=>r.hidePanel&&r.hidePanel(...e)),["stop"])),type:"button",class:"inline-flex items-center px-2 py-1 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-1 focus:ring-indigo-500 transition-colors"},[(0,a.bF)(d,{icon:["fas","times"],class:"text-gray-600 mr-1 text-xs"}),t[34]||(t[34]=(0,a.eW)(" ปิด "))])]),(0,a.Lk)("div",qc,[(0,a.Lk)("div",null,[t[38]||(t[38]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ประเภทคำถาม",-1)),(0,a.Lk)("div",Kc,[(0,a.Lk)("div",Hc,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t=>e.type=t,onChange:t=>r.markAsChanged(e._id),id:"type_text",value:"text",name:"type",type:"radio",class:"h-3 w-3 border-gray-300 text-indigo-600 focus:ring-indigo-500 focus:ring-1"},null,40,zc),[[c.XL,e.type]]),t[35]||(t[35]=(0,a.Lk)("label",{for:"type_text",class:"ml-1 text-xs text-gray-600"},"ข้อความ",-1))]),(0,a.Lk)("div",Gc,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t=>e.type=t,onChange:t=>r.markAsChanged(e._id),id:"type_image",value:"image",name:"type",type:"radio",class:"h-3 w-3 border-gray-300 text-indigo-600 focus:ring-indigo-500 focus:ring-1"},null,40,Jc),[[c.XL,e.type]]),t[36]||(t[36]=(0,a.Lk)("label",{for:"type_image",class:"ml-1 text-xs text-gray-600"},"รูปภาพ",-1))]),(0,a.Lk)("div",Yc,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t=>e.type=t,onChange:t=>r.markAsChanged(e._id),id:"type_video",value:"video",name:"type",type:"radio",class:"h-3 w-3 border-gray-300 text-indigo-600 focus:ring-indigo-500 focus:ring-1"},null,40,Zc),[[c.XL,e.type]]),t[37]||(t[37]=(0,a.Lk)("label",{for:"type_video",class:"ml-1 text-xs text-gray-600"},"วิดีโอ",-1))])])]),(0,a.Lk)("div",null,[t[39]||(t[39]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"โจทย์",-1)),e&&e.detail?(0,a.bo)(((0,a.uX)(),(0,a.CE)("textarea",{key:0,"onUpdate:modelValue":t=>e.detail=t,onInput:t=>r.onQuestionDetailChange(e),onFocus:t[12]||(t[12]=(...e)=>r.inputFocusHandler&&r.inputFocusHandler(...e)),rows:"3",class:"block w-full text-sm border border-gray-200 rounded focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 resize-none",placeholder:"กรอกโจทย์ข้อสอบ..."},"                              ",40,ed)),[[c.Jo,e.detail]]):(0,a.Q3)("",!0)]),(0,a.Lk)("div",td,[(0,a.Lk)("div",sd,[t[41]||(t[41]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700"},"เพิ่มคำตอบแบบรวดเร็ว",-1)),(0,a.Lk)("button",{onClick:t=>r.processAnswerCommand(e),disabled:!i.answerCommand.trim(),type:"button",class:"inline-flex items-center px-2 py-1 text-xs font-medium text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed rounded transition-colors"},[(0,a.bF)(d,{icon:["fas","magic"],class:"mr-1 text-xs"}),t[40]||(t[40]=(0,a.eW)(" ประมวลผล "))],8,ad)]),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>i.answerCommand=e),onFocus:t[14]||(t[14]=(...e)=>r.inputFocusHandler&&r.inputFocusHandler(...e)),rows:"3",placeholder:"วางคำตอบทั้งหมดที่นี่ (แต่ละบรรทัดคือ 1 ตัวเลือก)",class:"block w-full text-sm border border-gray-200 rounded focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 resize-none"},"                              ",544),[[c.Jo,i.answerCommand]]),t[42]||(t[42]=(0,a.Lk)("p",{class:"mt-1 text-xs text-gray-500"}," * จะลบคำตอบเดิมทั้งหมดและเพิ่มใหม่ตามที่กรอก ",-1))]),(0,a.Lk)("div",null,[(0,a.Lk)("div",od,[t[44]||(t[44]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-900"},"คำตอบ",-1)),(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.addAnswer(e.answers.length,e._id)),["stop"]),type:"button",class:"inline-flex items-center px-2 py-1 text-xs font-medium text-indigo-600 hover:text-indigo-700 focus:outline-none"},[(0,a.bF)(d,{icon:["fas","plus"],class:"mr-1 text-xs"}),t[43]||(t[43]=(0,a.eW)(" เพิ่ม "))],8,id)]),(0,a.Lk)("div",rd,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.answers,((s,o)=>((0,a.uX)(),(0,a.CE)("div",{key:s._id,class:"flex items-center space-x-2 group hover:bg-gray-50 rounded px-2 py-1 transition-colors"},[(0,a.Lk)("div",nd,[(0,a.Lk)("span",ld,(0,l.v_)(String.fromCharCode(65+o)),1),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t=>e.correct=t,id:s._id,name:e._id,value:s._id,type:"radio",class:"h-3 w-3 border-gray-300 text-indigo-600 focus:ring-indigo-500 focus:ring-1"},null,8,cd),[[c.XL,e.correct]])]),(0,a.Lk)("div",dd,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":e=>s.detail=e,onInput:t=>r.onAnswerDetailChange(e._id),onFocus:t[15]||(t[15]=(...e)=>r.inputFocusHandler&&r.inputFocusHandler(...e)),type:"text",class:"block w-full text-sm border-0 border-b border-transparent hover:border-gray-200 focus:border-indigo-500 focus:ring-0 bg-transparent px-0 py-1",placeholder:`ตัวเลือกที่ ${o+1}`},null,40,ud),[[c.Jo,s.detail]])]),(0,a.Lk)("button",{onClick:e=>r.deleteAnswer(s._id),class:"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-red-500 focus:outline-none transition-all"},[(0,a.bF)(d,{icon:["fas","trash"],class:"text-xs"})],8,md)])))),128))])])]),(0,a.Lk)("div",gd,[(0,a.Lk)("button",{onClick:t=>r.handleButtonClick(e),type:"button",class:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-red-600 bg-red-50 hover:bg-red-100 border border-red-200 hover:border-red-300 rounded focus:outline-none focus:ring-1 focus:ring-red-500 transition-colors"},[(0,a.bF)(d,{icon:["fas","trash"],class:"mr-1 text-xs"}),t[45]||(t[45]=(0,a.eW)(" ลบ "))],8,pd),(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.updateAnswer(e)),["stop"]),type:"button",class:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500 transition-colors"},[(0,a.bF)(d,{icon:["fas","save"],class:"mr-1 text-xs"}),t[46]||(t[46]=(0,a.eW)(" บันทึก "))],8,hd)])],2)):(0,a.Q3)("",!0)],10,Dc)))),128))])):((0,a.uX)(),(0,a.CE)("div",Lc,t[31]||(t[31]=[(0,a.Lk)("div",{class:"text-center"},[(0,a.Lk)("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-3"}),(0,a.Lk)("p",{class:"text-gray-500 text-sm"},"กำลังโหลดข้อสอบ...")],-1)])))])])])])])])])],64)}s(14603),s(47566),s(98721);cs()().format();var xd={props:{examid:{type:String,required:!0}},data(){const e=n.A.get("session");return{configs:n.A.get("configs"),courseData:[],examData:[],schoolAdmin:[],questionData:[],parentID:"",dataItem:this.examid,history:this.$route.params.history,accessToken:e.token,login:e.login,master:e.master,selectCourseCover:"",cover:"",count:"",loading_sources:!0,FileBrowserOpen:!1,readMoreActivated:!1,selectedExamIndex:null,isLoading:!1,isSaving:!1,longText:"",endpoint:"",answerCommand:"",unsavedChanges:{},autoSaveTimeout:null,notifications:[],notificationId:0,searchQuery:"",selectedQuestions:[],showBulkActions:!1,filterType:"all",sortBy:"order",sortDirection:"asc",showStats:!0,expandAll:!1}},components:{FileBrowser:os.A},computed:{filteredQuestions(){let e=this.questionData.filter((e=>{const t=!this.searchQuery||e.detail.toLowerCase().includes(this.searchQuery.toLowerCase())||e.answers.some((e=>e.detail.toLowerCase().includes(this.searchQuery.toLowerCase()))),s="all"===this.filterType||e.type===this.filterType;return t&&s}));return e.sort(((e,t)=>{let s,a;switch(this.sortBy){case"order":s=e.order,a=t.order;break;case"created":s=new Date(e.createdAt||0),a=new Date(t.createdAt||0);break;case"modified":s=new Date(e.updatedAt||0),a=new Date(t.updatedAt||0);break;default:s=e.order,a=t.order}return"asc"===this.sortDirection?s>a?1:-1:s<a?1:-1})),e},questionStats(){const e=this.questionData.length,t={text:this.questionData.filter((e=>"text"===e.type)).length,image:this.questionData.filter((e=>"image"===e.type)).length,video:this.questionData.filter((e=>"video"===e.type)).length},s=this.questionData.filter((e=>e.answers&&e.answers.length>0)).length,a=Object.keys(this.unsavedChanges).length;return{total:e,byType:t,withAnswers:s,unsaved:a}},allSelected(){return this.filteredQuestions.length>0&&this.selectedQuestions.length===this.filteredQuestions.length},someSelected(){return this.selectedQuestions.length>0&&this.selectedQuestions.length<this.filteredQuestions.length}},methods:{markAsChanged(e,t="question"){this.unsavedChanges[e]||(this.unsavedChanges[e]={}),this.unsavedChanges[e][t]=!0,this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout((()=>{this.autoSaveQuestion(e)}),2e3)},async autoSaveQuestion(e){const t=this.questionData.find((t=>t._id===e));if(t&&this.unsavedChanges[e])try{this.isSaving=!0,await this.updateQuestionData(t),delete this.unsavedChanges[e],this.showNotification("บันทึกข้อมูลอัตโนมัติแล้ว","success")}catch(s){console.error("Auto-save failed:",s),this.showNotification("เกิดข้อผิดพลาดในการบันทึกอัตโนมัติ","error")}finally{this.isSaving=!1}},async processAnswerCommand(e){this.unsavedChanges[e._id]&&await this.autoSaveQuestion(e._id);const t=[/ก\.\t/g,/ข\.\t/g,/ค\.\t/g,/ง\.\t/g],s=this.answerCommand.split("\n").filter((e=>""!==e.trim())).map((e=>(t.forEach((t=>{e=e.replace(t,"")})),e.trim())));if(e.answers&&e.answers.length>0)for(const a of e.answers)await this.confirmDeleteAnswer(a._id);for(let a=0;a<s.length;a++)await this.addAnswerAuto(a,e._id,s[a]);await this.getData(!0),this.answerCommand=""},inputFocusHandler(e){e.stopPropagation()},onQuestionDetailChange(e){this.markAsChanged(e._id,"question")},onAnswerDetailChange(e){this.markAsChanged(e,"answers")},async handleButtonClick(e){hr.A.log(e);try{e.answers.length<=0?await this.deleteQuestion(e._id):await this.deleteQuestionAnswer(e),this.hidePanel()}catch(t){console.error("An error occurred:",t)}},togglePanel(e){if(this.isOpenPanel(e))this.selectedExamIndex=null;else{this.selectedExamIndex=e;const t=document.getElementById(`panel-${this.selectedExamIndex}`);if(t){const e=t.getBoundingClientRect().top+window.scrollY-20;this.smoothScrollTo(e)}}},smoothScrollTo(e,t=500){const s=window.scrollY,a=e-s,o=performance.now();function i(){const n=performance.now(),l=n-o;l<t?(window.scrollTo(0,s+r(l/t)*a),requestAnimationFrame(i)):window.scrollTo(0,e)}function r(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}requestAnimationFrame(i)},isOpenPanel(e){return this.selectedExamIndex===e},hidePanel(){this.selectedExamIndex=null},dateTime(e){return cs()(e).format("DD/MM/YYYY hh:mm:ss")},activateReadMore(){this.readMoreActivated=!0},unActivateReadMore(){this.readMoreActivated=!1},async getData(e=!1){try{e?hr.A.log("Get Data Silent : Start"):this.loading_sources=!1;const t=await fetch("https://gateway.cloudrestfulapi.com/api/exam/"+this.dataItem,{method:"GET",headers:{"Content-Type":"application/json","client-token-key":this.configs.key}}),s=await t.json();if(hr.A.log(s),200===t.status){this.examData=s,this.parentID=s.courseId;const t=await this.getCourseData(this.parentID),a=await this.getQuestionData(this.dataItem);this.questionData=a,hr.A.log("examData",this.examData),hr.A.log("questionData",this.questionData),this.questionData=await Promise.all(this.questionData.map((async e=>{hr.A.log("element",e._id);const t=await fetch("https://gateway.cloudrestfulapi.com/api/answer/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{questionID:e._id}]}]})}),s=await t.json();return e.answers=s.sort(((e,t)=>e.order-t.order)),e}))),this.questionData.sort(((e,t)=>e.order-t.order)),this.count=this.questionData.length,hr.A.log("questionData",this.questionData),hr.A.log("courseReturn",t),t&&(this.courseData=t,e?hr.A.log("Get Data Silent : Finish"):this.loading_sources=!0)}}catch(t){hr.A.log(t)}},async getCourseData(e){if(n.A.get("session","login"))try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/"+this.endpoint+"/"+e,{method:"GET",headers:{"Content-Type":"application/json","client-token-key":this.configs.key}});return await t.json()}catch(t){hr.A.log(t)}},async getQuestionData(e){if(n.A.get("session","login"))try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/questions/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{examID:e}]}]})});return await t.json()}catch(t){hr.A.log(t)}},async addQuestion(e){try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/questions/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{examID:this.dataItem,detail:"โจทย์สำหรับ "+this.examData.name+"ข้อที่ "+parseInt(("0"+(e+1)).slice(-2)),type:"text",order:parseInt(("0"+(e+1)).slice(-2))},options:{}})}),s=await t.json();if(200===t.status){await this.getData(!0);const e=this.filteredQuestions.findIndex((e=>e._id===s._id));-1!==e?(this.selectedExamIndex=e,this.$nextTick((()=>{const t=document.getElementById(`panel-${e}`);if(t){const e=t.getBoundingClientRect().top+window.scrollY-20;this.smoothScrollTo(e),t.classList.add("bounce-in"),setTimeout((()=>{t.classList.remove("bounce-in")}),600)}})),this.showNotification("เพิ่มข้อสอบใหม่เรียบร้อยแล้ว","success")):(this.selectedExamIndex=this.filteredQuestions.length-1,this.showNotification("เพิ่มข้อสอบใหม่เรียบร้อยแล้ว","success"))}}catch(t){hr.A.log(t),this.showNotification("เกิดข้อผิดพลาดในการเพิ่มข้อสอบ","error")}},async addAnswerAuto(e,t,s){try{this.isLoading=!0;const a=await fetch("https://gateway.cloudrestfulapi.com/api/answer/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{questionID:t,detail:s,order:parseInt(("0"+(e+1)).slice(-2))},options:{}})});await a.json(),200===a.status&&hr.A.log(`Added answer ${e+1}: ${s}`)}catch(a){hr.A.log(a)}finally{this.isLoading=!1}},async addAnswer(e,t){try{this.isLoading=!0;const s=await fetch("https://gateway.cloudrestfulapi.com/api/answer/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{questionID:t,detail:`ตัวเลือกที่ ${e+1}`,order:parseInt(("0"+(e+1)).slice(-2))},options:{}})});await s.json(),200===s.status&&await this.getData(!0)}catch(s){hr.A.log(s)}finally{this.isLoading=!1}},changeFileTrigger(e){this.FileBrowserOpen=e},selectFileTrigger(e){void 0!=e&&(this.selectCourseCover=e,hr.A.log("selectFileReturnFunction",e),this.updataCover(e))},async deleteQuestion(e){if(n.A.get("session","login"))try{hr.A.log("question",e),this.$swal({title:"ต้องการลบข้อมูลนี้ ?",text:"หลังจากลบแล้วจะไม่สามารถกู้คืนข้อมูลนี้ได้อีก !",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ตกลง ลบเลย",cancelButtonText:"ยกเลิก",closeOnConfirm:!1,closeOnCancel:!1}).then((t=>{t.isConfirmed?(hr.A.log("Delete"),this.confirmDeleteQuestion(e)):hr.A.log("Cancel")}))}catch(t){hr.A.log(t)}},async confirmDeleteQuestion(e){try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/questions/"+e,{method:"DELETE",headers:{"Content-Type":"application/json","client-token-key":this.configs.key}});await t.json(),200===t.status&&await this.getData(!0)}catch(t){hr.A.log(t)}},async deleteQuestionAnswer(e){try{for(let t=0;t<e.answers.length;t++){const s=e.answers[t];hr.A.log("answer",s),await this.confirmDeleteAnswer(s._id)}await this.confirmDeleteQuestion(e._id),await this.getData(!0)}catch(t){console.error("Error updating answers:",t)}},async updateAnswer(e){try{this.isLoading=!0;for(let t=0;t<e.answers.length;t++){const s=e.answers[t];hr.A.log("answer",s),await this.updateAnswerData(s)}await this.updateQuestionData(e),await this.getData(!0),delete this.unsavedChanges[e._id],this.showNotification("บันทึกข้อมูลเรียบร้อยแล้ว","success")}catch(t){console.error("Error updating answers:",t),this.showNotification("เกิดข้อผิดพลาดในการบันทึกข้อมูล","error")}finally{this.isLoading=!1}},async updateAnswerData(e){try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/answer/"+e._id,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{detail:e.detail},options:{}})});await t.json()}catch(t){hr.A.log(t)}},async updateQuestionData(e){try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/questions/"+e._id,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{type:e.type,detail:e.detail,correct:e.correct},options:{}})});await t.json()}catch(t){hr.A.log(t)}},async deleteAnswer(e){try{this.$swal({title:"ต้องการลบข้อมูลนี้ ?",text:"หลังจากลบแล้วจะไม่สามารถกู้คืนข้อมูลนี้ได้อีก !",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ตกลง ลบเลย",cancelButtonText:"ยกเลิก",closeOnConfirm:!1,closeOnCancel:!1}).then((t=>{t.isConfirmed?(hr.A.log("Delete"),this.confirmDeleteAnswer(e)):hr.A.log("Cancel")}))}catch(t){hr.A.log(t)}},async confirmDeleteAnswer(e){try{this.isLoading=!0;const t=await fetch("https://gateway.cloudrestfulapi.com/api/answer/"+e,{method:"DELETE",headers:{"Content-Type":"application/json","client-token-key":this.configs.key}});await t.json(),200===t.status&&await this.getData(!0)}catch(t){hr.A.log(t)}finally{this.isLoading=!1}},OpenFileBrowser(){this.FileBrowserOpen=!0},updated(){ts().replace()},sort(e){return e.sort(((e,t)=>e.order-t.order))},hasUnsavedChanges(e){return this.unsavedChanges[e]&&Object.keys(this.unsavedChanges[e]).length>0},showNotification(e,t="success"){const s={id:++this.notificationId,message:e,type:t,show:!0};this.notifications.push(s),setTimeout((()=>{this.hideNotification(s.id)}),3e3)},hideNotification(e){const t=this.notifications.findIndex((t=>t.id===e));t>-1&&this.notifications.splice(t,1)},toggleQuestionSelection(e){const t=this.selectedQuestions.indexOf(e);t>-1?this.selectedQuestions.splice(t,1):this.selectedQuestions.push(e),this.showBulkActions=this.selectedQuestions.length>0},selectAllQuestions(){this.allSelected?this.selectedQuestions=[]:this.selectedQuestions=this.filteredQuestions.map((e=>e._id)),this.showBulkActions=this.selectedQuestions.length>0},async bulkDeleteQuestions(){if(0!==this.selectedQuestions.length)try{this.$swal({title:`ต้องการลบข้อสอบ ${this.selectedQuestions.length} ข้อ?`,text:"หลังจากลบแล้วจะไม่สามารถกู้คืนข้อมูลได้อีก!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ตกลง ลบเลย",cancelButtonText:"ยกเลิก"}).then((async e=>{if(e.isConfirmed){this.isLoading=!0;for(const e of this.selectedQuestions){const t=this.questionData.find((t=>t._id===e));t&&await this.deleteQuestionAnswer(t)}this.selectedQuestions=[],this.showBulkActions=!1,await this.getData(!0),this.showNotification(`ลบข้อสอบ ${this.selectedQuestions.length} ข้อเรียบร้อยแล้ว`,"success")}}))}catch(e){console.error("Bulk delete failed:",e),this.showNotification("เกิดข้อผิดพลาดในการลบข้อสอบ","error")}finally{this.isLoading=!1}},toggleExpandAll(){this.expandAll=!this.expandAll,this.expandAll||(this.selectedExamIndex=null)},exportQuestions(){const e=this.filteredQuestions.map(((e,t)=>({"ลำดับ":t+1,"โจทย์":e.detail.replace(/<[^>]*>/g,""),"ประเภท":e.type,"คำตอบ":e.answers.map(((e,t)=>`${String.fromCharCode(65+t)}. ${e.detail}`)).join(" | "),"คำตอบที่ถูก":e.answers.find((t=>t._id===e.correct))?.detail||"ไม่ระบุ"}))),t=this.convertToCSV(e);this.downloadCSV(t,`ข้อสอบ_${this.examData.name||"export"}.csv`),this.showNotification("ส่งออกข้อมูลเรียบร้อยแล้ว","success")},convertToCSV(e){if(!e.length)return"";const t=Object.keys(e[0]),s=[t.join(","),...e.map((e=>t.map((t=>`"${e[t]||""}"`)).join(",")))].join("\n");return s},downloadCSV(e,t){const s=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),o=URL.createObjectURL(s);a.setAttribute("href",o),a.setAttribute("download",t),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},handleKeyboardShortcuts(e){if(e.ctrlKey||e.metaKey)switch(e.key){case"f":e.preventDefault(),this.$refs.searchInput?.focus();break;case"s":if(e.preventDefault(),null!==this.selectedExamIndex){const e=this.filteredQuestions[this.selectedExamIndex];e&&this.updateAnswer(e)}break;case"a":e.preventDefault(),this.selectAllQuestions();break}"Escape"===e.key&&(this.selectedExamIndex=null,this.selectedQuestions=[],this.showBulkActions=!1)}},async mounted(){try{this.master?this.endpoint="mcourse":this.endpoint="course",await this.getData(),document.addEventListener("keydown",this.handleKeyboardShortcuts)}catch(e){hr.A.log(Error)}},beforeUnmount(){this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),document.removeEventListener("keydown",this.handleKeyboardShortcuts)},setup(){hr.A.log("Setup")}};const yd=(0,rr.A)(xd,[["render",bd],["__scopeId","data-v-6e965836"]]);var fd=yd,kd={props:{examCount:Number,courseData:Object,dataItem:String,examData:Array,examTypeProp:Array,tabs:Object,updateTabs:Object},data(){return{expandedExams:{}}},components:{ContestDetail:fd},computed:{examType(){return Yt.Ac},totalQuestions(){return this.examData.reduce(((e,t)=>e+(t.total||0)),0)},averageTime(){if(0===this.examData.length)return 0;const e=this.examData.reduce(((e,t)=>e+(t.timer||0)),0);return Math.round(e/this.examData.length)},uniqueTypes(){const e=new Set(this.examData.map((e=>e.type)));return e.size}},methods:{async activeFunction(){try{hr.A.log("Active")}catch(e){console.error(e)}},assignBadgeToTabs(){const e=this.tabs.map((e=>({...e,badge:0})));this.updateTabs(e)},objectFindByKey(e,t,s){for(var a=0;a<e.length;a++)if(e[a][t]===s)return e[a];return null},toggleExpand(e){this.expandedExams[e]=!this.expandedExams[e]},isExpanded(e){return this.expandedExams[e]},getExamTypeIcon(e){const t={pretest:"clipboard-question",posttest:"clipboard-check",quiz:"question-circle",assignment:"file-text",survey:"poll",final:"trophy",midterm:"graduation-cap",practice:"dumbbell"};return t[e]||"square-check"},async deleteExam(e,t){try{console.log("Delete exam:",e,t),this.$emit("delete-exam",e,t)}catch(s){console.error("Error deleting exam:",s)}}},async mounted(){}};const vd=(0,rr.A)(kd,[["render",Xl],["__scopeId","data-v-04930c24"]]);var wd=vd;const Ld={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Cd={class:"px-4 py-3 border-b border-gray-200"},Dd={class:"flex items-center justify-between"},Sd={class:"flex items-center space-x-3"},Fd={class:"w-8 h-8 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-lg flex items-center justify-center"},Id={class:"text-xs text-gray-500"},Ed={class:"flex items-center space-x-3"},$d={key:0,class:"flex items-center space-x-2 px-3 py-1 bg-blue-50 rounded-lg border border-blue-100"},_d={class:"text-xs text-blue-700 font-medium"},Pd={key:0,class:"px-4 py-3 bg-gray-50 border-b border-gray-200"},Td={class:"flex flex-col lg:flex-row gap-3"},Ad={class:"flex-1"},Xd={class:"relative"},jd={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},Ud={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center"},Bd={class:"flex gap-2"},Od={key:1,class:"px-4 py-3 bg-emerald-50 border-b border-gray-200"},Qd={class:"grid grid-cols-2 lg:grid-cols-4 gap-4"},Md={class:"text-center"},Vd={class:"text-lg font-bold text-emerald-600"},Rd={class:"text-center"},Wd={class:"text-lg font-bold text-blue-600"},Nd={class:"text-center"},qd={class:"text-lg font-bold text-purple-600"},Kd={class:"text-center"},Hd={class:"text-lg font-bold text-orange-600"},zd={class:"bg-blue-50 border-l-4 border-blue-400 p-3"},Gd={class:"flex"},Jd={class:"flex-shrink-0"},Yd={class:"flex-shrink-0 ml-4"},Zd={class:"relative group"},eu={class:"text-blue-400 hover:text-blue-600 p-1 rounded-lg hover:bg-blue-100 transition-colors"},tu={class:"p-4"},su={key:0,class:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg border border-gray-200"},au={class:"flex items-center cursor-pointer"},ou=["checked"],iu={class:"text-sm text-gray-500"},ru={key:1,class:"text-center py-8"},nu={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},lu={class:"text-sm text-gray-500 mb-4"},cu={key:2,class:"text-center py-8"},du={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},uu={key:3,class:"space-y-3"},mu={class:"p-4"},gu={class:"flex items-center justify-between mb-3"},pu={class:"flex items-center space-x-3"},hu=["value"],bu={class:"flex-shrink-0 relative"},xu={class:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center"},yu={class:"absolute inset-0"},fu={class:"w-12 h-12 transform -rotate-90",viewBox:"0 0 36 36"},ku=["stroke-dasharray"],vu={class:"flex-1 min-w-0"},wu={class:"flex items-center space-x-2 mb-1"},Lu={class:"text-base font-semibold text-gray-900"},Cu={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},Du={key:1,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Su={class:"flex items-center space-x-3 text-xs text-gray-500"},Fu={class:"flex items-center"},Iu={class:"font-medium text-gray-900 ml-1"},Eu={class:"flex items-center"},$u={class:"font-medium text-gray-900 ml-1"},_u={class:"flex items-center"},Pu={class:"font-medium text-gray-900 ml-1"},Tu={class:"flex items-center justify-between pt-3 border-t border-gray-200"},Au={class:"flex items-center space-x-2"},Xu=["onClick"],ju=["onClick"],Uu=["onClick"],Bu={class:"flex items-center space-x-1"},Ou=["onClick"],Qu=["onClick"],Mu=["onClick"],Vu={key:4,class:"flex items-center justify-between mt-6 px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg"},Ru={class:"flex items-center"},Wu={class:"text-sm text-gray-600"},Nu={class:"flex items-center space-x-2"},qu=["disabled"],Ku={class:"px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md"},Hu=["disabled"],zu={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200 mt-4 overflow-hidden"},Gu={class:"px-4 py-3 border-b border-gray-200 bg-gradient-to-r from-emerald-50 to-emerald-100"},Ju={class:"flex items-center justify-between"},Yu={class:"flex items-center space-x-3"},Zu={class:"w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center"},em={class:"text-xs text-gray-500"},tm={class:"p-4"},sm={class:"space-y-4 mb-5"},am={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},om={class:"md:col-span-2"},im={class:"flex items-center bg-gray-50 border border-gray-300 rounded-lg overflow-hidden"},rm=["disabled"],nm={class:"flex-1 text-center py-2 bg-white border-x border-gray-300"},lm={class:"text-lg font-semibold text-gray-800"},cm=["disabled"],dm={class:"grid grid-cols-5 gap-2"},um={class:"text-xs text-gray-500 mb-1 text-center"},mm=["onUpdate:modelValue","placeholder"],gm={class:"mb-5"},pm={class:"flex items-center justify-between mb-4"},hm={class:"flex items-center space-x-2"},bm={class:"w-6 h-6 bg-orange-500 rounded-lg flex items-center justify-center"},xm={class:"space-y-3"},ym={class:"px-4 py-3 bg-gray-50 border-b border-gray-200"},fm={class:"flex items-center space-x-3"},km=["onUpdate:modelValue"],vm=["onUpdate:modelValue"],wm={class:"flex items-center space-x-1"},Lm=["onClick","disabled"],Cm=["onClick","disabled"],Dm=["onClick"],Sm={class:"p-4"},Fm={class:"flex items-center justify-between mb-3"},Im={class:"text-sm font-medium text-gray-600"},Em={class:"text-gray-400"},$m={class:"flex items-center space-x-2"},_m=["onClick"],Pm=["onClick"],Tm={class:"space-y-2"},Am={class:"flex items-center space-x-2"},Xm=["onUpdate:modelValue"],jm=["onUpdate:modelValue"],Um={class:"flex items-center space-x-1"},Bm=["onClick","disabled"],Om=["onClick","disabled"],Qm=["onClick"],Mm={key:0,class:"text-center py-6 text-gray-400"},Vm={key:0,class:"text-center py-8 text-gray-400 border-2 border-dashed border-gray-300 rounded-lg"},Rm={key:0,class:"mb-5"},Wm={class:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4"},Nm={class:"flex items-center mb-3"},qm={class:"w-6 h-6 bg-blue-500 rounded-lg flex items-center justify-center mr-3"},Km={class:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200"},Hm={class:"bg-white rounded-lg shadow-sm border border-gray-200 mt-4"},zm={class:"px-4 py-3 border-b border-gray-200"},Gm={class:"flex items-center space-x-3"},Jm={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center"},Ym={class:"text-xs text-gray-500"},Zm={class:"p-4"},eg={class:"fixed top-4 right-4 z-50 space-y-2"},tg={class:"p-4"},sg={class:"flex items-start"},ag={class:"flex-shrink-0"},og={class:"ml-3 w-0 flex-1 pt-0.5"},ig={class:"text-sm font-medium text-gray-900"},rg={key:0,class:"mt-1 text-sm text-gray-500"},ng={class:"ml-4 flex-shrink-0 flex"},lg=["onClick"],cg={key:1,class:"fixed inset-0 z-50 overflow-y-auto"},dg={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ug={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},mg={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},gg={class:"flex items-center justify-between mb-4"},pg={class:"text-lg font-medium text-gray-900"},hg={key:0,class:"space-y-6"},bg={class:"bg-gray-50 p-4 rounded-lg"},xg={class:"text-gray-700"},yg={class:"font-medium text-gray-900 mb-3"},fg={class:"space-y-3"},kg={class:"text-sm text-gray-500 mt-1"},vg={class:"flex-1"},wg={class:"text-gray-900"},Lg={key:0,class:"text-xs text-red-500"},Cg={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"};function Dg(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon"),d=(0,a.g2)("SurveyResult"),u=(0,a.g2)("SurveySubmission");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",Ld,[(0,a.Lk)("div",Cd,[(0,a.Lk)("div",Dd,[(0,a.Lk)("div",Sd,[(0,a.Lk)("div",Fd,[(0,a.bF)(n,{icon:["fas","square-check"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[27]||(t[27]=(0,a.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"แบบสอบถาม",-1)),(0,a.Lk)("p",Id,"จัดการแบบสอบถามและการประเมินผล ("+(0,l.v_)(r.filteredSurveyList.length)+"/"+(0,l.v_)(i.surveyList.length)+" รายการ)",1)])]),(0,a.Lk)("div",Ed,[i.selectedSurveys.length>0?((0,a.uX)(),(0,a.CE)("div",$d,[(0,a.Lk)("span",_d,(0,l.v_)(i.selectedSurveys.length)+" รายการ",1),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.bulkDelete&&r.bulkDelete(...e)),class:"inline-flex items-center px-2 py-0.5 text-xs font-medium text-red-600 bg-white border border-red-200 rounded-md hover:bg-red-50 transition-colors"},[(0,a.bF)(n,{icon:["fas","trash"],class:"mr-1 text-xs"}),t[28]||(t[28]=(0,a.eW)(" ลบ "))]),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.clearSelection&&r.clearSelection(...e)),class:"inline-flex items-center px-2 py-0.5 text-xs font-medium text-gray-600 bg-white border border-gray-200 rounded-md hover:bg-gray-50 transition-colors"}," ยกเลิก ")])):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.exportSurveys&&r.exportSurveys(...e)),class:"inline-flex items-center rounded-lg border border-transparent bg-gray-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(n,{icon:["fas","download"],class:"mr-1.5"}),t[29]||(t[29]=(0,a.eW)(" ส่งออก "))]),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.saveSurveyConfig&&r.saveSurveyConfig(...e)),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-emerald-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-1.5"}),t[30]||(t[30]=(0,a.eW)(" เพิ่มแบบสอบถาม "))])])])]),i.surveyList.length>0?((0,a.uX)(),(0,a.CE)("div",Pd,[(0,a.Lk)("div",Td,[(0,a.Lk)("div",Ad,[(0,a.Lk)("div",Xd,[(0,a.Lk)("div",jd,[(0,a.bF)(n,{icon:["fas","search"],class:"text-gray-400 text-sm"})]),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>i.searchQuery=e),type:"text",placeholder:"ค้นหาแบบสอบถาม...",class:"block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"},null,512),[[c.Jo,i.searchQuery]]),i.searchQuery?((0,a.uX)(),(0,a.CE)("div",Ud,[(0,a.Lk)("button",{onClick:t[5]||(t[5]=e=>i.searchQuery=""),class:"text-gray-400 hover:text-gray-600 transition-colors"},[(0,a.bF)(n,{icon:["fas","times"],class:"text-sm"})])])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",Bd,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.filterStatus=e),class:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all bg-white"},t[31]||(t[31]=[(0,a.Lk)("option",{value:"all"},"ทั้งหมด",-1),(0,a.Lk)("option",{value:"default"},"Default",-1),(0,a.Lk)("option",{value:"assigned"},"Assigned",-1),(0,a.Lk)("option",{value:"unassigned"},"ไม่ได้ Assign",-1)]),512),[[c.u1,i.filterStatus]]),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.sortBy=e),class:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all bg-white"},t[32]||(t[32]=[(0,a.Lk)("option",{value:"name"},"เรียงตามชื่อ",-1),(0,a.Lk)("option",{value:"created"},"วันที่สร้าง",-1),(0,a.Lk)("option",{value:"questions"},"จำนวนคำถาม",-1),(0,a.Lk)("option",{value:"score"},"ระดับคะแนน",-1)]),512),[[c.u1,i.sortBy]]),(0,a.Lk)("button",{onClick:t[8]||(t[8]=e=>i.sortDirection="asc"===i.sortDirection?"desc":"asc"),class:"inline-flex items-center px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors"},[(0,a.bF)(n,{icon:["fas","asc"===i.sortDirection?"sort-amount-up":"sort-amount-down"],class:"text-sm"},null,8,["icon"])])])])])):(0,a.Q3)("",!0),i.surveyList.length>0?((0,a.uX)(),(0,a.CE)("div",Od,[(0,a.Lk)("div",Qd,[(0,a.Lk)("div",Md,[(0,a.Lk)("div",Vd,(0,l.v_)(i.surveyList.length),1),t[33]||(t[33]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"แบบสอบถามทั้งหมด",-1))]),(0,a.Lk)("div",Rd,[(0,a.Lk)("div",Wd,(0,l.v_)(i.totalQuestions),1),t[34]||(t[34]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"คำถามทั้งหมด",-1))]),(0,a.Lk)("div",Nd,[(0,a.Lk)("div",qd,(0,l.v_)(i.defaultSurveyCount),1),t[35]||(t[35]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"Default",-1))]),(0,a.Lk)("div",Kd,[(0,a.Lk)("div",Hd,(0,l.v_)(i.assignedSurveyCount),1),t[36]||(t[36]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"Assigned",-1))])])])):(0,a.Q3)("",!0),(0,a.Lk)("div",zd,[(0,a.Lk)("div",Gd,[(0,a.Lk)("div",Jd,[(0,a.bF)(n,{icon:["fas","info-circle"],class:"text-blue-400 text-sm"})]),t[38]||(t[38]=(0,a.Lk)("div",{class:"ml-2"},[(0,a.Lk)("p",{class:"text-xs text-blue-700"},[(0,a.Lk)("strong",null,"หมายเหตุ:"),(0,a.eW)(' หากไม่มีการ Assign แบบสอบถามให้กับหลักสูตรนี้ หากหลักสูตรนี้มีการตั้งค่าให้แสดงแบบสอบถาม ระบบจะดึงแบบสอบถามที่ถูกต้องค่าเป็น "Default" มาใช้แสดงผล ')])],-1)),(0,a.Lk)("div",Yd,[(0,a.Lk)("div",Zd,[(0,a.Lk)("button",eu,[(0,a.bF)(n,{icon:["fas","keyboard"],class:"text-sm"})]),t[37]||(t[37]=(0,a.Fv)('<div class="absolute right-0 top-8 w-64 bg-white border border-gray-200 rounded-lg shadow-lg p-3 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-20" data-v-443bba34><h4 class="text-xs font-semibold text-gray-800 mb-2" data-v-443bba34>Keyboard Shortcuts</h4><div class="space-y-1 text-xs text-gray-600" data-v-443bba34><div class="flex justify-between items-center" data-v-443bba34><span data-v-443bba34>สร้างแบบสอบถามใหม่</span><kbd class="px-1.5 py-0.5 bg-gray-100 rounded text-xs font-mono" data-v-443bba34>Ctrl+N</kbd></div><div class="flex justify-between items-center" data-v-443bba34><span data-v-443bba34>เลือกทั้งหมด</span><kbd class="px-1.5 py-0.5 bg-gray-100 rounded text-xs font-mono" data-v-443bba34>Ctrl+A</kbd></div><div class="flex justify-between items-center" data-v-443bba34><span data-v-443bba34>ลบที่เลือก</span><kbd class="px-1.5 py-0.5 bg-gray-100 rounded text-xs font-mono" data-v-443bba34>Delete</kbd></div><div class="flex justify-between items-center" data-v-443bba34><span data-v-443bba34>ส่งออกข้อมูล</span><kbd class="px-1.5 py-0.5 bg-gray-100 rounded text-xs font-mono" data-v-443bba34>Ctrl+E</kbd></div><div class="flex justify-between items-center" data-v-443bba34><span data-v-443bba34>ยกเลิก/ปิด</span><kbd class="px-1.5 py-0.5 bg-gray-100 rounded text-xs font-mono" data-v-443bba34>Esc</kbd></div></div></div>',1))])])])]),(0,a.Lk)("div",tu,[r.filteredSurveyList.length>0?((0,a.uX)(),(0,a.CE)("div",su,[(0,a.Lk)("label",au,[(0,a.Lk)("input",{type:"checkbox",checked:r.isAllSelected,onChange:t[9]||(t[9]=(...e)=>r.toggleSelectAll&&r.toggleSelectAll(...e)),class:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500 focus:ring-2"},null,40,ou),t[39]||(t[39]=(0,a.Lk)("span",{class:"ml-2 text-sm font-medium text-gray-700"},"เลือกทั้งหมด",-1))]),(0,a.Lk)("div",iu,(0,l.v_)(r.filteredSurveyList.length)+" รายการ ",1)])):(0,a.Q3)("",!0),0===r.filteredSurveyList.length&&i.searchQuery?((0,a.uX)(),(0,a.CE)("div",ru,[(0,a.Lk)("div",nu,[(0,a.bF)(n,{icon:["fas","search"],class:"text-gray-400 text-lg"})]),t[40]||(t[40]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ไม่พบแบบสอบถาม",-1)),(0,a.Lk)("p",lu,'ไม่พบแบบสอบถามที่ตรงกับคำค้นหา "'+(0,l.v_)(i.searchQuery)+'"',1),(0,a.Lk)("button",{onClick:t[10]||(t[10]=e=>i.searchQuery=""),class:"inline-flex items-center rounded-lg border border-transparent bg-emerald-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition-colors"}," ล้างการค้นหา ")])):0===i.surveyList.length?((0,a.uX)(),(0,a.CE)("div",cu,[(0,a.Lk)("div",du,[(0,a.bF)(n,{icon:["fas","square-check"],class:"text-gray-400 text-lg"})]),t[42]||(t[42]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ยังไม่มีแบบสอบถาม",-1)),t[43]||(t[43]=(0,a.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"เริ่มต้นสร้างแบบสอบถามสำหรับหลักสูตรนี้",-1)),(0,a.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>r.saveSurveyConfig&&r.saveSurveyConfig(...e)),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-emerald-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-1.5"}),t[41]||(t[41]=(0,a.eW)(" สร้างแบบสอบถามแรก "))])])):((0,a.uX)(),(0,a.CE)("div",uu,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.filteredSurveyList,((e,o)=>((0,a.uX)(),(0,a.CE)("div",{key:e._id,class:(0,l.C4)(["bg-white border border-gray-200 rounded-lg hover:shadow-md transition-shadow duration-200",{"ring-2 ring-emerald-500 border-emerald-300":i.selectedSurveys.includes(e._id)}])},[(0,a.Lk)("div",mu,[(0,a.Lk)("div",gu,[(0,a.Lk)("div",pu,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox",value:e._id,"onUpdate:modelValue":t[12]||(t[12]=e=>i.selectedSurveys=e),class:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500 focus:ring-2"},null,8,hu),[[c.lH,i.selectedSurveys]]),(0,a.Lk)("div",bu,[(0,a.Lk)("div",xu,[(0,a.bF)(n,{icon:["fas","square-check"],class:"text-emerald-600 text-base"})]),(0,a.Lk)("div",yu,[((0,a.uX)(),(0,a.CE)("svg",fu,[t[44]||(t[44]=(0,a.Lk)("path",{class:"text-gray-200",stroke:"currentColor","stroke-width":"2",fill:"none",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,-1)),(0,a.Lk)("path",{class:"text-emerald-500",stroke:"currentColor","stroke-width":"2",fill:"none","stroke-linecap":"round","stroke-dasharray":`${r.getCompletionPercentage(e)}, 100`,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"},null,8,ku)]))])]),(0,a.Lk)("div",vu,[(0,a.Lk)("div",wu,[(0,a.Lk)("h3",Lu,(0,l.v_)(r.getSurveyIndex(e))+". "+(0,l.v_)(e.name),1),e.default?((0,a.uX)(),(0,a.CE)("span",Cu,[(0,a.bF)(n,{icon:["fas","star"],class:"mr-1 text-xs"}),t[45]||(t[45]=(0,a.eW)(" Default "))])):(0,a.Q3)("",!0),s.courseData.surveyId===e._id?((0,a.uX)(),(0,a.CE)("span",Du,[(0,a.bF)(n,{icon:["fas","check-circle"],class:"mr-1 text-xs"}),t[46]||(t[46]=(0,a.eW)(" Assigned "))])):(0,a.Q3)("",!0),(0,a.Lk)("span",{class:(0,l.C4)(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",r.getCompletionBadgeClass(e)])},(0,l.v_)(r.getCompletionPercentage(e))+"% สมบูรณ์ ",3)]),(0,a.Lk)("div",Su,[(0,a.Lk)("span",Fu,[(0,a.bF)(n,{icon:["fas","star"],class:"mr-1 text-xs"}),t[47]||(t[47]=(0,a.eW)(" คะแนน: ")),(0,a.Lk)("span",Iu,(0,l.v_)(e.score||0),1)]),t[50]||(t[50]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",Eu,[(0,a.bF)(n,{icon:["fas","folder"],class:"mr-1 text-xs"}),t[48]||(t[48]=(0,a.eW)(" หัวข้อ: ")),(0,a.Lk)("span",$u,(0,l.v_)(e.choiceGroups?.length||0),1)]),t[51]||(t[51]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",_u,[(0,a.bF)(n,{icon:["fas","question-circle"],class:"mr-1 text-xs"}),t[49]||(t[49]=(0,a.eW)(" คำถาม: ")),(0,a.Lk)("span",Pu,(0,l.v_)(r.getSurveyQuestionCount(e)),1)]),t[52]||(t[52]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",{class:(0,l.C4)(["certificate-stat-badge",r.getSurveyQuestionCount(e)>0?"has-questions":"no-questions"])},[(0,a.bF)(n,{icon:["fas",r.getSurveyQuestionCount(e)>0?"check":"times"],class:"mr-1 text-xs"},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(r.getSurveyQuestionCount(e)>0?"มีคำถาม":"ไม่มีคำถาม"),1)],2)])])])]),(0,a.Lk)("div",Tu,[(0,a.Lk)("div",Au,[(0,a.Lk)("button",{onClick:t=>r.setDefaultSurvey(e._id),class:(0,l.C4)([{"text-green-600 bg-green-50 border-green-200":e.default,"text-gray-600 bg-gray-50 border-gray-200 hover:bg-gray-100":!e.default},"inline-flex items-center px-2.5 py-1 border rounded-md text-xs font-medium transition-colors"])},[(0,a.bF)(n,{icon:["fas","bookmark"],class:"mr-1 text-xs"}),(0,a.eW)(" "+(0,l.v_)(e.default?"Default":"ตั้งเป็น Default"),1)],10,Xu),(0,a.Lk)("button",{onClick:t=>r.toggleAssignSurvey(e._id,o),class:(0,l.C4)([{"text-blue-600 bg-blue-50 border-blue-200":s.courseData.surveyId===e._id,"text-gray-600 bg-gray-50 border-gray-200 hover:bg-gray-100":s.courseData.surveyId!==e._id},"inline-flex items-center px-2.5 py-1 border rounded-md text-xs font-medium transition-colors"])},[(0,a.bF)(n,{icon:["fas","link"],class:"mr-1 text-xs"}),(0,a.eW)(" "+(0,l.v_)(r.isSurveyAssigned(e._id)?"Unassign":"Assign"),1)],10,ju),(0,a.Lk)("button",{onClick:t=>r.duplicateSurvey(e),class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors"},[(0,a.bF)(n,{icon:["fas","copy"],class:"mr-1 text-xs"}),t[53]||(t[53]=(0,a.eW)(" คัดลอก "))],8,Uu)]),(0,a.Lk)("div",Bu,[(0,a.Lk)("button",{onClick:t=>r.previewSurvey(e),class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors"},[(0,a.bF)(n,{icon:["fas","eye"],class:"mr-1 text-xs"}),t[54]||(t[54]=(0,a.eW)(" ดูตัวอย่าง "))],8,Ou),(0,a.Lk)("button",{onClick:t=>r.toggleExpand(e),type:"button",class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors"},[(0,a.bF)(n,{icon:["fas","edit"],class:"mr-1 text-xs"}),t[55]||(t[55]=(0,a.eW)(" แก้ไข "))],8,Qu),(0,a.Lk)("button",{onClick:t=>r.deleteSurvey(e._id,o),type:"button",class:"inline-flex items-center px-2.5 py-1 border border-red-200 rounded-md text-xs font-medium text-red-600 bg-red-50 hover:bg-red-100 transition-colors"},[(0,a.bF)(n,{icon:["fas","trash"],class:"mr-1 text-xs"}),t[56]||(t[56]=(0,a.eW)(" ลบ "))],8,Mu)])])])],2)))),128))])),r.filteredSurveyList.length>i.itemsPerPage?((0,a.uX)(),(0,a.CE)("div",Vu,[(0,a.Lk)("div",Ru,[(0,a.Lk)("span",Wu," แสดง "+(0,l.v_)((i.currentPage-1)*i.itemsPerPage+1)+" ถึง "+(0,l.v_)(Math.min(i.currentPage*i.itemsPerPage,r.filteredSurveyList.length))+" จาก "+(0,l.v_)(r.filteredSurveyList.length)+" รายการ ",1)]),(0,a.Lk)("div",Nu,[(0,a.Lk)("button",{onClick:t[13]||(t[13]=e=>i.currentPage--),disabled:1===i.currentPage,class:"px-3 py-1.5 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," ก่อนหน้า ",8,qu),(0,a.Lk)("span",Ku,(0,l.v_)(i.currentPage)+" / "+(0,l.v_)(i.totalPages),1),(0,a.Lk)("button",{onClick:t[14]||(t[14]=e=>i.currentPage++),disabled:i.currentPage===i.totalPages,class:"px-3 py-1.5 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," ถัดไป ",8,Hu)])])):(0,a.Q3)("",!0)])]),i.showSurveyConfig?((0,a.uX)(),(0,a.CE)("div",zu,[(0,a.Lk)("div",Gu,[(0,a.Lk)("div",Ju,[(0,a.Lk)("div",Yu,[(0,a.Lk)("div",Zu,[(0,a.bF)(n,{icon:["fas","cog"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[57]||(t[57]=(0,a.Lk)("h3",{class:"text-base font-semibold text-gray-800"},"ตั้งค่าแบบสอบถาม",-1)),(0,a.Lk)("p",em,(0,l.v_)(i.selectedSurveyItem?.name||"แบบสอบถามใหม่"),1)])]),(0,a.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>r.closeConfigPanel&&r.closeConfigPanel(...e)),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-white/50 rounded-lg transition-colors"},[(0,a.bF)(n,{icon:["fas","times"],class:"text-sm"})])])]),(0,a.Lk)("div",tm,[(0,a.Lk)("div",sm,[(0,a.Lk)("div",null,[t[58]||(t[58]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ชื่อแบบสอบถาม",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[16]||(t[16]=e=>i.surveyData.name=e),class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all",placeholder:"กรอกชื่อแบบสอบถาม"},null,512),[[c.Jo,i.surveyData.name]])]),(0,a.Lk)("div",am,[(0,a.Lk)("div",om,[t[59]||(t[59]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"คำอธิบาย",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[17]||(t[17]=e=>i.surveyData.description=e),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all resize-none",placeholder:"คำอธิบายแบบสอบถาม"},null,512),[[c.Jo,i.surveyData.description]])]),(0,a.Lk)("div",null,[t[60]||(t[60]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ระดับคะแนน",-1)),(0,a.Lk)("div",im,[(0,a.Lk)("button",{onClick:t[18]||(t[18]=(...e)=>r.decrementscore&&r.decrementscore(...e)),disabled:i.surveyData.score<=1,class:"px-3 py-2 text-gray-600 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-sm"})],8,rm),(0,a.Lk)("div",nm,[(0,a.Lk)("span",lm,(0,l.v_)(i.surveyData.score),1)]),(0,a.Lk)("button",{onClick:t[19]||(t[19]=(...e)=>r.incrementscore&&r.incrementscore(...e)),disabled:i.surveyData.score>=5,class:"px-3 py-2 text-gray-600 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-sm"})],8,cm)])])]),(0,a.Lk)("div",null,[t[61]||(t[61]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ชื่อระดับคะแนน",-1)),(0,a.Lk)("div",dm,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.scoreItemLabels,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t},[(0,a.Lk)("div",um,"ระดับ "+(0,l.v_)(t+1),1),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":e=>i.scoreItemLabels[t]=e,class:"w-full px-2 py-2 border border-gray-300 rounded-lg text-sm text-center focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all",placeholder:`ระดับ ${t+1}`},null,8,mm),[[c.Jo,i.scoreItemLabels[t]]])])))),128))])])]),(0,a.Lk)("div",gm,[(0,a.Lk)("div",pm,[(0,a.Lk)("div",hm,[(0,a.Lk)("div",bm,[(0,a.bF)(n,{icon:["fas","folder"],class:"text-white text-xs"})]),t[62]||(t[62]=(0,a.Lk)("h4",{class:"text-sm font-semibold text-gray-700"},"หัวข้อคำถาม",-1))]),(0,a.Lk)("button",{onClick:t[20]||(t[20]=(...e)=>r.addChoiceGroup&&r.addChoiceGroup(...e)),class:"inline-flex items-center px-3 py-2 text-sm font-medium text-white bg-blue-500 rounded-lg hover:bg-blue-600 transition-colors shadow-sm"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-2 text-xs"}),t[63]||(t[63]=(0,a.eW)(" เพิ่มหัวข้อ "))])]),(0,a.Lk)("div",xm,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.surveyData.choiceGroups,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:s,class:"border border-gray-200 rounded-lg overflow-hidden"},[(0,a.Lk)("div",ym,[(0,a.Lk)("div",fm,[(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.groupName=t,class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all",placeholder:"ชื่อหัวข้อ"},null,8,km),[[c.Jo,e.groupName]]),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t=>e.groupType=t,class:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all bg-white"},t[64]||(t[64]=[(0,a.Lk)("option",{value:""},"เลือกประเภท",-1),(0,a.Lk)("option",{value:"custom"},"Custom",-1),(0,a.Lk)("option",{value:"score"},"Score",-1)]),8,vm),[[c.u1,e.groupType]]),(0,a.Lk)("div",wm,[(0,a.Lk)("button",{onClick:e=>r.moveGroupUp(s),disabled:0===s,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[(0,a.bF)(n,{icon:["fas","chevron-up"],class:"text-xs"})],8,Lm),(0,a.Lk)("button",{onClick:e=>r.moveGroupDown(s),disabled:s===i.surveyData.choiceGroups.length-1,class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[(0,a.bF)(n,{icon:["fas","chevron-down"],class:"text-xs"})],8,Cm),(0,a.Lk)("button",{onClick:e=>r.removeChoiceGroup(s),class:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"},[(0,a.bF)(n,{icon:["fas","trash"],class:"text-xs"})],8,Dm)])])]),(0,a.Lk)("div",Sm,[(0,a.Lk)("div",Fm,[(0,a.Lk)("span",Im,[t[65]||(t[65]=(0,a.eW)(" คำถาม ")),(0,a.Lk)("span",Em,(0,l.v_)(e.groupName||"ไม่มีชื่อ"),1)]),(0,a.Lk)("div",$m,[(0,a.Lk)("button",{onClick:e=>r.addChoice(s),class:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-1.5 text-xs"}),t[66]||(t[66]=(0,a.eW)(" คำถาม "))],8,_m),(0,a.Lk)("button",{onClick:e=>r.addTextareaChoice(s),class:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-purple-600 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 transition-colors"},[(0,a.bF)(n,{icon:["fas","comment"],class:"mr-1.5 text-xs"}),t[67]||(t[67]=(0,a.eW)(" ข้อความ "))],8,Pm)])]),(0,a.Lk)("div",Tm,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.choices,((o,i)=>((0,a.uX)(),(0,a.CE)("div",{key:i,class:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg"},[(0,a.Lk)("div",Am,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>o.isRequested=e,class:"rounded border-gray-300 text-red-500 focus:ring-red-500/20 focus:ring-2"},null,8,Xm),[[c.lH,o.isRequested]]),t[68]||(t[68]=(0,a.Lk)("label",{class:"text-xs text-red-500 font-medium"},"จำเป็น",-1))]),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":e=>o.choiceText=e,class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all",placeholder:"ข้อความคำถาม"},null,8,jm),[[c.Jo,o.choiceText]]),(0,a.Lk)("div",Um,[(0,a.Lk)("button",{onClick:e=>r.moveChoiceUp(s,i),disabled:0===i,class:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[(0,a.bF)(n,{icon:["fas","chevron-up"],class:"text-xs"})],8,Bm),(0,a.Lk)("button",{onClick:e=>r.moveChoiceDown(s,i),disabled:i===e.choices.length-1,class:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[(0,a.bF)(n,{icon:["fas","chevron-down"],class:"text-xs"})],8,Om),(0,a.Lk)("button",{onClick:e=>r.removeChoice(s,i),class:"p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors"},[(0,a.bF)(n,{icon:["fas","trash"],class:"text-xs"})],8,Qm)])])))),128)),0===e.choices.length?((0,a.uX)(),(0,a.CE)("div",Mm,[(0,a.bF)(n,{icon:["fas","question-circle"],class:"text-2xl mb-2"}),t[69]||(t[69]=(0,a.Lk)("p",{class:"text-sm"},"ยังไม่มีคำถามในหัวข้อนี้",-1)),t[70]||(t[70]=(0,a.Lk)("p",{class:"text-xs"},'คลิกปุ่ม "คำถาม" หรือ "ข้อความ" เพื่อเพิ่มคำถาม',-1))])):(0,a.Q3)("",!0)])])])))),128)),0===i.surveyData.choiceGroups.length?((0,a.uX)(),(0,a.CE)("div",Vm,[(0,a.bF)(n,{icon:["fas","folder-open"],class:"text-3xl mb-3"}),t[72]||(t[72]=(0,a.Lk)("h4",{class:"text-base font-medium text-gray-600 mb-2"},"ยังไม่มีหัวข้อคำถาม",-1)),t[73]||(t[73]=(0,a.Lk)("p",{class:"text-sm text-gray-400 mb-4"},"เริ่มต้นสร้างหัวข้อคำถามสำหรับแบบสอบถามนี้",-1)),(0,a.Lk)("button",{onClick:t[21]||(t[21]=(...e)=>r.addChoiceGroup&&r.addChoiceGroup(...e)),class:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-500 rounded-lg hover:bg-blue-600 transition-colors shadow-sm"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-2 text-xs"}),t[71]||(t[71]=(0,a.eW)(" เพิ่มหัวข้อแรก "))])])):(0,a.Q3)("",!0)])]),i.surveyData.choiceGroups.length>0?((0,a.uX)(),(0,a.CE)("div",Rm,[(0,a.Lk)("div",Wm,[(0,a.Lk)("div",Nm,[(0,a.Lk)("div",qm,[(0,a.bF)(n,{icon:["fas","eye"],class:"text-white text-xs"})]),t[74]||(t[74]=(0,a.Lk)("h4",{class:"text-sm font-semibold text-gray-700"},"ตัวอย่างแบบสอบถาม",-1))]),(0,a.bF)(d,{surveyData:i.surveyData,scoreItemLabels:i.scoreItemLabels,surveyResults:"[]"},null,8,["surveyData","scoreItemLabels"])])])):(0,a.Q3)("",!0),(0,a.Lk)("div",Km,[(0,a.Lk)("button",{onClick:t[22]||(t[22]=(...e)=>r.closeConfigPanel&&r.closeConfigPanel(...e)),class:"px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 transition-colors"}," ยกเลิก "),(0,a.Lk)("button",{onClick:t[23]||(t[23]=e=>r.updateSurvey(i.selectedSurveyItem)),class:"px-6 py-2 text-sm font-medium text-white bg-emerald-500 rounded-lg hover:bg-emerald-600 transition-colors shadow-sm"}," บันทึกแบบสอบถาม ")])])])):(0,a.Q3)("",!0),(0,a.Lk)("div",Hm,[(0,a.Lk)("div",zm,[(0,a.Lk)("div",Gm,[(0,a.Lk)("div",Jm,[(0,a.bF)(n,{icon:["fas","user-check"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[75]||(t[75]=(0,a.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"แบบสอบถามที่ตอบกลับ",-1)),(0,a.Lk)("p",Ym,"ผลการตอบแบบสอบถาม ("+(0,l.v_)(i.surveySubmission.length)+" รายการ)",1)])])]),(0,a.Lk)("div",Zm,[i.surveySubmission?((0,a.uX)(),(0,a.Wv)(u,{key:0,ref:"submissionTable",surveySubmission:i.surveySubmission,class:"mt-2"},null,8,["surveySubmission"])):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",eg,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.toasts,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:(0,l.C4)(["max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden transform transition-all duration-300 ease-in-out",{"translate-x-0":e.show,"translate-x-full":!e.show}])},[(0,a.Lk)("div",tg,[(0,a.Lk)("div",sg,[(0,a.Lk)("div",ag,[(0,a.Lk)("div",{class:(0,l.C4)(["w-6 h-6 rounded-full flex items-center justify-center",{"bg-green-100":"success"===e.type,"bg-red-100":"error"===e.type,"bg-blue-100":"info"===e.type,"bg-yellow-100":"warning"===e.type}])},[(0,a.bF)(n,{icon:r.getToastIcon(e.type),class:(0,l.C4)(["text-sm",{"text-green-600":"success"===e.type,"text-red-600":"error"===e.type,"text-blue-600":"info"===e.type,"text-yellow-600":"warning"===e.type}])},null,8,["icon","class"])],2)]),(0,a.Lk)("div",og,[(0,a.Lk)("p",ig,(0,l.v_)(e.title),1),e.message?((0,a.uX)(),(0,a.CE)("p",rg,(0,l.v_)(e.message),1)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",ng,[(0,a.Lk)("button",{onClick:e=>r.removeToast(t),class:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[(0,a.bF)(n,{icon:["fas","times"],class:"text-sm"})],8,lg)])])])],2)))),128))]),i.showPreviewModal?((0,a.uX)(),(0,a.CE)("div",cg,[(0,a.Lk)("div",dg,[(0,a.Lk)("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:t[24]||(t[24]=(...e)=>r.closePreviewModal&&r.closePreviewModal(...e))}),(0,a.Lk)("div",ug,[(0,a.Lk)("div",mg,[(0,a.Lk)("div",gg,[(0,a.Lk)("h3",pg,"ตัวอย่างแบบสอบถาม: "+(0,l.v_)(i.previewSurveyData?.name),1),(0,a.Lk)("button",{onClick:t[25]||(t[25]=(...e)=>r.closePreviewModal&&r.closePreviewModal(...e)),class:"text-gray-400 hover:text-gray-600"},[(0,a.bF)(n,{icon:["fas","times"],class:"text-xl"})])]),i.previewSurveyData?((0,a.uX)(),(0,a.CE)("div",hg,[(0,a.Lk)("div",bg,[t[76]||(t[76]=(0,a.Lk)("h4",{class:"font-medium text-gray-900 mb-2"},"คำอธิบาย",-1)),(0,a.Lk)("p",xg,(0,l.v_)(i.previewSurveyData.description||"ไม่มีคำอธิบาย"),1)]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.previewSurveyData.choiceGroups,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:"border border-gray-200 rounded-lg p-4"},[(0,a.Lk)("h4",yg,(0,l.v_)(e.groupName),1),(0,a.Lk)("div",fg,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.choices,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:"flex items-start space-x-3"},[(0,a.Lk)("span",kg,(0,l.v_)(t+1)+".",1),(0,a.Lk)("div",vg,[(0,a.Lk)("p",wg,(0,l.v_)(e.choiceText),1),e.isRequested?((0,a.uX)(),(0,a.CE)("span",Lg,"* จำเป็น")):(0,a.Q3)("",!0)])])))),128))])])))),128))])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",Cg,[(0,a.Lk)("button",{onClick:t[26]||(t[26]=(...e)=>r.closePreviewModal&&r.closePreviewModal(...e)),type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-gray-600 text-base font-medium text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 sm:ml-3 sm:w-auto sm:text-sm"}," ปิด ")])])])])):(0,a.Q3)("",!0)],64)}const Sg={class:"p-4 relative"},Fg={id:"notes-title",class:"text-lg font-normal text-gray-900"},Ig={class:"bg-red-600 text-white text-sm px-2 rounded-sm"},Eg={class:"absolute top-1 right-0"},$g={class:"w-full overflow-auto relative"},_g={class:"table-striped border-collapse border border-slate-300 min-w-max"},Pg=["colspan","rowspan"],Tg={key:0,class:"border border-slate-300 font-normal p-2",colspan:1},Ag={class:"border border-slate-300 text-center p-1"},Xg={class:"border border-slate-300 text-left p-1"},jg={key:0,class:"border border-slate-300 text-center p-1",colspan:1};function Ug(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",Sg,[(0,a.Lk)("h2",Fg,[(0,a.Lk)("span",Ig,(0,l.v_)(s.surveySubmission.length),1),t[1]||(t[1]=(0,a.eW)(" รายชื่อผู้ที่กรอกข้อมูล "))]),(0,a.Lk)("span",Eg,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.exportToCSV&&r.exportToCSV(...e)),type:"button",class:"ml-3 inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},[(0,a.bF)(n,{icon:["fas","download"],class:"text-gray-200 pr-3"}),t[2]||(t[2]=(0,a.eW)(" Export CSV "))])])]),(0,a.Lk)("div",$g,[(0,a.Lk)("table",_g,[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[t[3]||(t[3]=(0,a.Lk)("th",{class:"border border-slate-300 p-2",rowspan:"2"},"ลำดับ",-1)),t[4]||(t[4]=(0,a.Lk)("th",{class:"border border-slate-300 p-2",rowspan:"2"},"รายชื่อ",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.getUniqueGroups(),((e,t)=>((0,a.uX)(),(0,a.CE)("th",{class:"border border-slate-300 font-bold p-2",key:t,colspan:"score"===e.type?e.count:1,rowspan:"custom"===e.type?e.count:1},(0,l.v_)(e.text),9,Pg)))),128))]),(0,a.Lk)("tr",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.getUniqueChoices(),((e,t)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:t},["custom"!==e.type?((0,a.uX)(),(0,a.CE)("th",Tg,(0,l.v_)(e.text),1)):(0,a.Q3)("",!0)],64)))),128))])]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.surveySubmission,((e,t)=>((0,a.uX)(),(0,a.CE)("tr",{class:"border border-slate-300",key:t},[(0,a.Lk)("td",Ag,(0,l.v_)(t+1),1),(0,a.Lk)("td",Xg,(0,l.v_)(e._id)+" "+(0,l.v_)(e.user.firstname+" "+e.user.lastname),1),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.survey.choiceGroups,((e,t)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:t},["custom"===e.groupType?((0,a.uX)(),(0,a.CE)("td",jg,(0,l.v_)(e.selectedChoice||"-"),1)):(0,a.Q3)("",!0),"score"===e.groupType?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:1},(0,a.pI)(e.choices,((e,t)=>((0,a.uX)(),(0,a.CE)("td",{key:t,class:"border border-slate-300 text-center p-1"},(0,l.v_)(e.choiceValue||"-"),1)))),128)):(0,a.Q3)("",!0)],64)))),128))])))),128))])])])],64)}var Bg={props:{surveySubmission:Array},methods:{escapeCSV(e){if(null===e||void 0===e)return"-";let t=e.toString();return t=t.replace(/"/g,'""'),`"${t}"`},exportToCSV(){const e=[],t=["ลำดับ","รายชื่อ"];this.surveySubmission[0].survey.choiceGroups.forEach((e=>{"custom"===e.groupType?t.push(e.groupName):e.choices.forEach((e=>{t.push(e.choiceText)}))})),e.push(t.join(",")),this.surveySubmission.forEach(((t,s)=>{const a=[this.escapeCSV(s+1),this.escapeCSV(`${t.user.firstname} ${t.user.lastname}`)];t.survey.choiceGroups.forEach((e=>{"custom"===e.groupType?a.push(this.escapeCSV(e.selectedChoice)):e.choices.forEach((e=>{a.push(this.escapeCSV(e.choiceValue))}))})),e.push(a.join(","))}));const s=e.join("\n"),a=new Blob([s],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(a),o.setAttribute("download",`survey_submission_${(new Date).toISOString()}.csv`),document.body.appendChild(o),o.click(),document.body.removeChild(o)},getUniqueGroups(){const e=new Map;return this.surveySubmission[0]?.survey?.choiceGroups?.forEach((t=>{if(e.has(t.groupName)){const s=e.get(t.groupName),a=s.count+t.choices.length;e.set(t.groupName,{text:t.groupName,type:t.type,count:a<2?2:a})}else e.set(t.groupName,{text:t.groupName,type:t.groupType,count:t.choices.length<2?2:t.choices.length})})),Array.from(e.values())},getGroupColumnSpan(e){return this.surveySubmission[0]?.survey?.choiceGroups.reduce(((t,s)=>t+(s.groupName===e?s.choices.length:0)),0)||0},getUniqueChoices(){const e=new Map;return this.surveySubmission[0]?.survey?.choiceGroups.forEach((t=>{t.choices.forEach((s=>{const a=`${t.groupName}:${t.groupType}:${s.choiceText}`;e.set(a,{groupName:t.groupName,type:t.groupType,text:s.choiceText,count:t.choices.length})}))})),Array.from(e.values()).reduce(((e,t)=>{if("custom"===t.type){const s=e.find((e=>e.groupName===t.groupName&&"custom"===e.type));s||e.push(t)}else e.push(t);return e}),[])},getChoices(e,t){const s=Array.from(this.getUniqueGroups())[t],a=[];return e.survey?.choiceGroups.forEach((e=>{e.groupName===s&&e.choices.forEach((e=>{a.push(e)}))})),a}}};const Og=(0,rr.A)(Bg,[["render",Ug],["__scopeId","data-v-50203f41"]]);var Qg=Og,Mg=s(42043);const Vg=new mr.A(!1);var Rg={props:{courseData:Object,callParentFunctionProp:Function,tabs:Object,updateTabs:Object},data(){return{configs:n.A.get("configs"),session:n.A.get("session"),showSurveyConfig:!1,expandedExams:{},surveyData:{},surveyResults:[],scoreItemLabels:[],surveyList:[],surveySubmission:[],extractedUserIds:[],selectedSurveyItem:null,submissionTable:null,searchQuery:"",filterStatus:"all",sortBy:"name",sortDirection:"asc",currentPage:1,itemsPerPage:10,selectedSurveys:[],totalPages:1,totalQuestions:0,defaultSurveyCount:0,assignedSurveyCount:0,showPreviewModal:!1,previewSurveyData:null,toasts:[]}},components:{SurveySubmission:Qg,SurveyResult:Mg.A},watch:{surveyList:{handler(){this.updateStats()},deep:!0},filteredSurveyList(){this.updateStats(),this.currentPage=1},searchQuery(){this.currentPage=1},filterStatus(){this.currentPage=1}},computed:{examType(){return Yt.Ac},filteredSurveyList(){let e=this.surveyList.filter((e=>{const t=e.name.toLowerCase().includes(this.searchQuery.toLowerCase()),s="all"===this.filterStatus||"default"===this.filterStatus&&e.default||"assigned"===this.filterStatus&&this.courseData.surveyId===e._id||"unassigned"===this.filterStatus&&!this.courseData.surveyId;return t&&s}));return"name"===this.sortBy?e.sort(((e,t)=>e.name.localeCompare(t.name))):"created"===this.sortBy?e.sort(((e,t)=>new Date(e.createdAt)-new Date(t.createdAt))):"questions"===this.sortBy?e.sort(((e,t)=>e.choiceGroups.reduce(((e,t)=>e+t.choices.length),0)-t.choiceGroups.reduce(((e,t)=>e+t.choices.length),0))):"score"===this.sortBy&&e.sort(((e,t)=>e.score-t.score)),"desc"===this.sortDirection&&e.reverse(),e},isAllSelected(){return this.selectedSurveys.length===this.filteredSurveyList.length}},methods:{async callbackFunction(){try{console.log("callbackFunction"),await this.getQueryData()}catch(e){console.error(e)}},updateBadge(e){this.$emit("update-badge",{code:this.tabs.code,badge:e})},incrementscore(){this.surveyData.score<5&&(this.surveyData.score++,this.updateScoreItemLabels())},decrementscore(){this.surveyData.score>1&&(this.surveyData.score--,this.updateScoreItemLabels())},updateScoreItemLabels(){const e=parseInt(this.surveyData.score),t=this.scoreItemLabels||[];if(e>t.length){const s=Array.from({length:e-t.length},(()=>""));this.scoreItemLabels=[...t,...s]}else e<t.length&&(this.scoreItemLabels=t.slice(0,e))},callParentFunction(){"function"===typeof this.callParentFunctionProp&&this.callParentFunctionProp()},addChoiceGroup(){this.surveyData.choiceGroups.push({groupName:"",groupType:"",choices:[]})},addChoice(e){this.surveyData.choiceGroups[e].choices.push({choiceText:"",type:"radio",choiceValue:null,isRequested:!1})},addTextareaChoice(e){this.surveyData.choiceGroups[e].choices.push({choiceText:"",type:"textarea",choiceValue:null,isRequested:!1})},removeChoiceGroup(e){this.surveyData.choiceGroups.splice(e,1)},removeChoice(e,t){this.surveyData.choiceGroups[e].choices.splice(t,1)},moveGroupUp(e){if(e>0){const t=this.surveyData.choiceGroups[e];this.surveyData.choiceGroups.splice(e,1),this.surveyData.choiceGroups.splice(e-1,0,t)}},moveGroupDown(e){if(e<this.surveyData.choiceGroups.length-1){const t=this.surveyData.choiceGroups[e];this.surveyData.choiceGroups.splice(e,1),this.surveyData.choiceGroups.splice(e+1,0,t)}},moveChoiceUp(e,t){if(t>0){const s=this.surveyData.choiceGroups[e].choices[t];this.surveyData.choiceGroups[e].choices.splice(t,1),this.surveyData.choiceGroups[e].choices.splice(t-1,0,s)}},moveChoiceDown(e,t){if(t<this.surveyData.choiceGroups[e].choices.length-1){const s=this.surveyData.choiceGroups[e].choices[t];this.surveyData.choiceGroups[e].choices.splice(t,1),this.surveyData.choiceGroups[e].choices.splice(t+1,0,s)}},async saveSurveyConfig(){try{const e={name:"Survey Name",description:"Survey Description",choiceGroups:[],score:1,default:!1,unit:this.session.current._id},t={data:{...e,label:[""]}},s=await Vg.POST("survey",t,this.configs.key);200===s.status?(await this.getSurvey(),this.toggleExpand(s.data),this.showToast("success","สร้างแบบสอบถามสำเร็จ","แบบสอบถามใหม่ถูกสร้างเรียบร้อยแล้ว")):(console.error("Error saving survey configuration:",s.statusText),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถสร้างแบบสอบถามได้"))}catch(e){console.error("An error occurred while saving survey configuration:",e),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถสร้างแบบสอบถามได้")}},async getSurvey(){console.log("getSurvey");try{const e={method:"find",args:[{$and:[{unit:this.session.current._id}]}]},t=await Vg.POST("survey/query",e,this.configs.key);if(200!==t.status)throw new Error("Failed to fetch player data from API");console.log("resAPISurvey",t.data),this.surveyList=t.data,this.updateStats()}catch(e){throw console.error("An error occurred while fetching player data:",e),e}},async getSurveySubmission(){console.log("getSurveySubmission");const e=this.courseData;console.log("course",e);try{const t=[{$match:{$and:[{courseId:e._id}]}},{$set:{userId:{$toObjectId:"$userId"}}},{$lookup:{from:"user",localField:"userId",foreignField:"_id",as:"user"}},{$unwind:"$user"},{$facet:{survey:[{$skip:0},{$limit:1600}],totalCount:[{$count:"count"}]}}],s=await Vg.POST("survey_submission/aggregate",{pipeline:t},this.configs.key);if(200===s.status){const e=s.data;console.log("data",e),this.surveySubmission=e[0].survey,this.updateBadge(e[0].survey.length)}}catch(t){throw console.error("An error occurred while fetching progress data:",t),t}},async setDefaultSurvey(e){try{for(const t of this.surveyList){const s={...t};t._id===e?s.default=!0:s.default=!1;const a={...s};delete a._id;const o={data:a},i=await Vg.PUT(`survey/${t._id}`,o,this.configs.key);200!==i.status&&console.error("Error updating survey default status:",i.statusText)}await this.getSurvey(),this.showToast("success","ตั้งค่า Default สำเร็จ","แบบสอบถามถูกตั้งเป็น Default แล้ว")}catch(t){console.error("An error occurred while setting default survey:",t),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถตั้งค่า Default ได้")}},async updateSurvey(e){try{const t={...e};delete t._id;const s=this.selectedSurveyItem&&this.selectedSurveyItem._id===e._id;let a;a=s?{data:{...t,name:this.surveyData.name||e.name,description:this.surveyData.description||e.description,choiceGroups:this.surveyData.choiceGroups||e.choiceGroups,label:this.scoreItemLabels&&this.scoreItemLabels.length>0?this.scoreItemLabels:e.label,score:this.surveyData.score||e.score}}:{data:{...t}};const o=await Vg.PUT(`survey/${e._id}`,a,this.configs.key);200===o.status?(await this.getSurvey(),s&&(this.showSurveyConfig=!1,this.showToast("success","บันทึกแบบสอบถามสำเร็จ","ข้อมูลแบบสอบถามถูกอัพเดทแล้ว"))):(console.error("Error updating survey:",o.statusText),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถบันทึกแบบสอบถามได้"))}catch(t){throw console.error("An error occurred while updating survey:",t),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถบันทึกแบบสอบถามได้"),t}},toggleAssignSurvey(e,t){this.isSurveyAssigned(e)?this.assignSurvey(null,t):this.assignSurvey(e,t)},isSurveyAssigned(e){return this.courseData.surveyId===e},async assignSurvey(e,t){try{const s=this.surveyList[t];if(s.default||!this.courseData)return void console.error("Cannot assign the survey to the course.");const a={data:{surveyId:e}},o=await Vg.PUT(`course/${this.courseData._id}`,a,this.configs.key);200===o.status?(this.callParentFunction(),hr.A.log("Survey assigned to the course."),this.showToast("success","Assign แบบสอบถามสำเร็จ","แบบสอบถามถูก assign ให้กับหลักสูตรแล้ว")):(console.error("Error assigning survey to the course:",o.statusText),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถ assign แบบสอบถามได้"))}catch(s){throw console.error("An error occurred while assigning the survey to the course:",s),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถ assign แบบสอบถามได้"),s}},async deleteSurvey(e,t){try{const s=this.surveyList[t];if(s.default)return void console.error("Cannot delete the default survey.");const a=await Vg.DELETE(`survey/${e}`,this.configs.key);200===a.status?(this.surveyList.splice(t,1),this.showToast("success","ลบแบบสอบถามสำเร็จ","แบบสอบถามถูกลบออกจากระบบแล้ว")):(console.error("Error deleting survey item:",a.statusText),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถลบแบบสอบถามได้"))}catch(s){console.error("An error occurred while deleting survey item:",s),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถลบแบบสอบถามได้")}},closeConfigPanel(){this.showSurveyConfig=!1},saveSurveyResult(e){this.surveyResults=e,hr.A.log("Survey Result Saved:",e)},objectFindByKey(e,t,s){for(var a=0;a<e.length;a++)if(e[a][t]===s)return e[a];return null},toggleExpand(e){this.selectedSurveyItem&&this.selectedSurveyItem._id===e._id?this.showSurveyConfig=!this.showSurveyConfig:(this.selectedSurveyItem={...e},this.surveyData={name:e.name||"",description:e.description||"",choiceGroups:e.choiceGroups?JSON.parse(JSON.stringify(e.choiceGroups)):[],score:e.score||1,default:e.default||!1,unit:e.unit||this.session.current._id},e.label&&Array.isArray(e.label)?this.scoreItemLabels=[...e.label]:this.scoreItemLabels=Array.from({length:parseInt(e.score||1)},(()=>"")),this.showSurveyConfig=!0)},isExpanded(e){return this.expandedExams[e]},getCompletionPercentage(e){if(!e.choiceGroups||0===e.choiceGroups.length)return 0;let t=0,s=0;return e.name&&""!==e.name.trim()&&s++,t++,e.description&&""!==e.description.trim()&&s++,t++,e.choiceGroups.forEach((e=>{e.groupName&&""!==e.groupName.trim()&&s++,t++,e.choices&&e.choices.length>0&&e.choices.forEach((e=>{e.choiceText&&""!==e.choiceText.trim()&&s++,t++}))})),t>0?Math.round(s/t*100):0},getCompletionBadgeClass(e){const t=this.getCompletionPercentage(e);return t>=80?"bg-emerald-100 text-emerald-700 border-emerald-200":t>=50?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-red-100 text-red-700 border-red-200"},getSurveyIndex(e){return this.filteredSurveyList.findIndex((t=>t._id===e._id))+1},getSurveyQuestionCount(e){return e.choiceGroups?e.choiceGroups.reduce(((e,t)=>e+(t.choices?t.choices.length:0)),0):0},getTimeAgo(e){if(!e)return"ไม่ทราบ";const t=new Date,s=new Date(e),a=Math.floor((t-s)/1e3);return a<60?"เมื่อสักครู่":a<3600?`${Math.floor(a/60)} นาทีที่แล้ว`:a<86400?`${Math.floor(a/3600)} ชั่วโมงที่แล้ว`:a<2592e3?`${Math.floor(a/86400)} วันที่แล้ว`:`${Math.floor(a/2592e3)} เดือนที่แล้ว`},toggleSelectAll(){this.isAllSelected?this.selectedSurveys=[]:this.selectedSurveys=this.filteredSurveyList.map((e=>e._id))},async bulkDelete(){if(0===this.selectedSurveys.length)return;const e=this.selectedSurveys.length;if(confirm(`คุณต้องการลบแบบสอบถาม ${e} รายการที่เลือกหรือไม่?`))try{for(const e of this.selectedSurveys){const t=this.surveyList.find((t=>t._id===e));t&&!t.default&&await Vg.DELETE(`survey/${e}`,this.configs.key)}await this.getSurvey(),this.selectedSurveys=[],this.showToast("success","ลบแบบสอบถามสำเร็จ",`ลบแบบสอบถาม ${e} รายการเรียบร้อยแล้ว`)}catch(t){console.error("Error in bulk delete:",t),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถลบแบบสอบถามได้")}},clearSelection(){this.selectedSurveys=[]},async exportSurveys(){try{const e=this.filteredSurveyList.map((e=>({name:e.name,description:e.description,choiceGroups:e.choiceGroups?.length||0,questions:this.getSurveyQuestionCount(e),score:e.score,default:e.default,assigned:this.courseData.surveyId===e._id}))),t=this.convertToCSV(e),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),o=URL.createObjectURL(s);a.setAttribute("href",o),a.setAttribute("download",`surveys_${(new Date).toISOString().split("T")[0]}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),this.showToast("success","ส่งออกข้อมูลสำเร็จ","ไฟล์ CSV ถูกดาวน์โหลดเรียบร้อยแล้ว")}catch(e){console.error("Error exporting surveys:",e),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถส่งออกข้อมูลได้")}},convertToCSV(e){const t=["ชื่อ","คำอธิบาย","หัวข้อ","คำถาม","ระดับคะแนน","Default","Assigned"],s=[t.join(",")];return e.forEach((e=>{const t=[`"${e.name}"`,`"${e.description}"`,e.choiceGroups,e.questions,e.score,e.default?"ใช่":"ไม่",e.assigned?"ใช่":"ไม่"];s.push(t.join(","))})),s.join("\n")},previewSurvey(e){console.log("Preview survey:",e.name),this.previewSurveyData=e,this.showPreviewModal=!0},async duplicateSurvey(e){try{const t={name:`${e.name} (สำเนา)`,description:e.description,choiceGroups:e.choiceGroups?JSON.parse(JSON.stringify(e.choiceGroups)):[],score:e.score,label:e.label?[...e.label]:[],default:!1,unit:this.session.current._id},s={data:t},a=await Vg.POST("survey",s,this.configs.key);200===a.status&&(await this.getSurvey(),console.log("Survey duplicated successfully"),this.showToast("success","คัดลอกแบบสอบถามสำเร็จ","แบบสอบถามถูกคัดลอกเรียบร้อยแล้ว"))}catch(t){console.error("Error duplicating survey:",t),this.showToast("error","เกิดข้อผิดพลาด","ไม่สามารถคัดลอกแบบสอบถามได้")}},updateStats(){this.totalQuestions=this.surveyList.reduce(((e,t)=>e+this.getSurveyQuestionCount(t)),0),this.defaultSurveyCount=this.surveyList.filter((e=>e.default)).length,this.assignedSurveyCount=this.surveyList.filter((e=>this.courseData.surveyId===e._id)).length,this.totalPages=Math.ceil(this.filteredSurveyList.length/this.itemsPerPage)},closePreviewModal(){this.showPreviewModal=!1},removeToast(e){this.toasts.splice(e,1)},getToastIcon(e){switch(e){case"success":return"check-circle";case"error":return"times-circle";case"info":return"info-circle";case"warning":return"exclamation-circle";default:return"question-circle"}},showToast(e,t,s="",a=3e3){const o={type:e,title:t,message:s,show:!1};this.toasts.push(o),setTimeout((()=>{o.show=!0}),100),setTimeout((()=>{o.show=!1,setTimeout((()=>{const e=this.toasts.indexOf(o);e>-1&&this.toasts.splice(e,1)}),300)}),a)},handleKeyboardShortcuts(e){(e.ctrlKey||e.metaKey)&&"n"===e.key&&(e.preventDefault(),this.saveSurveyConfig()),(e.ctrlKey||e.metaKey)&&"a"===e.key&&this.filteredSurveyList.length>0&&(e.preventDefault(),this.toggleSelectAll()),"Delete"===e.key&&this.selectedSurveys.length>0&&(e.preventDefault(),this.bulkDelete()),"Escape"===e.key&&(this.showPreviewModal?this.closePreviewModal():this.showSurveyConfig?this.closeConfigPanel():this.selectedSurveys.length>0&&this.clearSelection()),(e.ctrlKey||e.metaKey)&&"e"===e.key&&(e.preventDefault(),this.exportSurveys())}},async mounted(){try{await this.getSurvey(),await this.getSurveySubmission(),document.addEventListener("keydown",this.handleKeyboardShortcuts)}catch(e){console.error(e)}},beforeUnmount(){document.removeEventListener("keydown",this.handleKeyboardShortcuts)}};const Wg=(0,rr.A)(Rg,[["render",Dg],["__scopeId","data-v-443bba34"]]);var Ng=Wg;const qg={key:0,class:"flex justify-center items-center py-10"},Kg={class:"flex space-x-4"},Hg={key:1},zg={class:"px-4 py-5 sm:px-6 relative"},Gg={id:"schedule-title",class:"text-lg font-bold text-gray-900"},Jg={class:"absolute top-4 right-4"},Yg={class:"border-t border-gray-200 px-4 py-3 sm:px-3 bg-blue-50"},Zg={class:"overflow-hidden"},ep={class:"table-auto w-full border-collapse border border-gray-200"},tp={class:"bg-gray-100"},sp=["onClick"],ap={key:0},op={key:1},ip={class:"border border-gray-300 px-4 py-2 w-48"},rp=["onClick"],np=["onClick"],lp=["onClick","disabled"],cp=["onClick","disabled"],dp=["onClick"],up=["onClick"],mp={key:2,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},gp={class:"bg-white rounded-lg shadow-lg p-6 w-96"},pp={class:"mb-4"},hp={class:"mb-4"},bp={class:"flex justify-end"};function xp(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)("div",null,[i.scheduleData.length?((0,a.uX)(),(0,a.CE)("div",Hg,[(0,a.Lk)("div",zg,[(0,a.Lk)("h2",Gg,[(0,a.bF)(n,{icon:["fas","calendar"],class:"text-black mr-2"}),t[8]||(t[8]=(0,a.eW)(" Training Schedule "))]),(0,a.Lk)("span",Jg,[(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.openHeaderModal&&r.openHeaderModal(...e)),type:"button",class:"ml-3 inline-flex items-center rounded-md border border-transparent bg-green-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"},[(0,a.bF)(n,{icon:["fas","plus-circle"],class:"text-gray-200 pr-3"}),t[9]||(t[9]=(0,a.eW)(" Add Header "))]),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.addItem&&r.addItem(...e)),type:"button",class:"ml-3 inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-gray-200 pr-3"}),t[10]||(t[10]=(0,a.eW)(" Add Item "))])])]),(0,a.Lk)("div",Yg,[(0,a.Lk)("div",Zg,[(0,a.Lk)("table",ep,[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",tp,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.tableHeaders,((e,t)=>((0,a.uX)(),(0,a.CE)("th",{key:t,class:"border border-gray-300 px-4 py-2"},[(0,a.eW)((0,l.v_)(e.name)+" ",1),(0,a.Lk)("button",{onClick:e=>r.removeHeader(t),type:"button",class:"ml-2 text-red-600 hover:text-red-800"},[(0,a.bF)(n,{icon:["fas","times"]})],8,sp)])))),128)),t[11]||(t[11]=(0,a.Lk)("th",{class:"border border-gray-300 px-4 py-2 w-48"},"Actions",-1))])]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.currentSchedule.item,((e,t)=>((0,a.uX)(),(0,a.CE)("tr",{key:t,class:"bg-white"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.tableHeaders,((t,s)=>((0,a.uX)(),(0,a.CE)("td",{key:s,class:"border border-gray-300 px-4 py-2"},[e.isEditing?((0,a.uX)(),(0,a.CE)("div",ap,[((0,a.uX)(),(0,a.Wv)((0,a.$y)("textarea"===t.type?"CustomTextarea":"CustomInput"),{modelValue:e[t.name.toLowerCase()],"onUpdate:modelValue":s=>e[t.name.toLowerCase()]=s},null,8,["modelValue","onUpdate:modelValue"]))])):((0,a.uX)(),(0,a.CE)("div",op,(0,l.v_)(e[t.name.toLowerCase()]||"-"),1))])))),128)),(0,a.Lk)("td",ip,[e.isEditing?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t=>r.saveItem(e),class:"text-blue-600 font-medium"},[(0,a.bF)(n,{icon:["fas","save"],class:"text-black"})],8,rp)):((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:t=>r.editItem(e),class:"text-indigo-600 font-medium"},[(0,a.bF)(n,{icon:["fas","pencil"],class:"text-black"})],8,np)),(0,a.Lk)("button",{onClick:e=>r.moveItemUp(t),class:"text-blue-500 font-medium",disabled:0===t},[(0,a.bF)(n,{icon:["fas","caret-up"],class:"text-black"})],8,lp),(0,a.Lk)("button",{onClick:e=>r.moveItemDown(t),class:"text-blue-500 font-medium",disabled:t===i.currentSchedule.item.length-1},[(0,a.bF)(n,{icon:["fas","caret-down"],class:"text-black"})],8,cp),(0,a.Lk)("button",{onClick:e=>r.cloneItem(t),class:"text-green-500 font-medium"},[(0,a.bF)(n,{icon:["fas","clone"],class:"text-black"})],8,dp),(0,a.Lk)("button",{onClick:e=>r.deleteItem(t),class:"text-red-600 font-medium"},[(0,a.bF)(n,{icon:["fas","trash"],class:"text-black"})],8,up)])])))),128))])])])])])):((0,a.uX)(),(0,a.CE)("div",qg,[(0,a.Lk)("div",Kg,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=e=>r.addScheduleType("table")),type:"button",class:"bg-blue-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-blue-700"}," Add Table Schedule "),(0,a.Lk)("button",{onClick:t[1]||(t[1]=e=>r.addScheduleType("image")),type:"button",class:"bg-green-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-green-700"}," Add Image Schedule ")])])),i.isHeaderModalOpen?((0,a.uX)(),(0,a.CE)("div",mp,[(0,a.Lk)("div",gp,[t[15]||(t[15]=(0,a.Lk)("h3",{class:"text-lg font-bold mb-4"},"Add New Header",-1)),(0,a.Lk)("div",pp,[t[12]||(t[12]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700"},"Header Name",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>i.newHeader.name=e),type:"text",class:"w-full border border-gray-300 rounded-md px-2 py-1"},null,512),[[c.Jo,i.newHeader.name]])]),(0,a.Lk)("div",hp,[t[14]||(t[14]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700"},"Header Type",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.newHeader.type=e),class:"w-full border border-gray-300 rounded-md px-2 py-1"},t[13]||(t[13]=[(0,a.Lk)("option",{value:"input"},"Input",-1),(0,a.Lk)("option",{value:"textarea"},"Textarea",-1)]),512),[[c.u1,i.newHeader.type]])]),(0,a.Lk)("div",bp,[(0,a.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>r.closeHeaderModal&&r.closeHeaderModal(...e)),class:"bg-gray-300 px-4 py-2 rounded-md mr-2"},"Cancel"),(0,a.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>r.addHeaderWithApi&&r.addHeaderWithApi(...e)),class:"bg-green-600 text-white px-4 py-2 rounded-md"},"Add")])])])):(0,a.Q3)("",!0)])}function yp(e,t,s,o,i,r){return(0,a.bo)(((0,a.uX)(),(0,a.CE)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),type:"text",class:"w-full border border-gray-300 rounded-md px-2 py-1"},null,512)),[[c.Jo,r.value]])}var fp={props:["modelValue"],emits:["update:modelValue"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}};const kp=(0,rr.A)(fp,[["render",yp]]);var vp=kp;function wp(e,t,s,o,i,r){return(0,a.bo)(((0,a.uX)(),(0,a.CE)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),class:"w-full border border-gray-300 rounded-md px-2 py-1 resize-none"},null,512)),[[c.Jo,r.value]])}var Lp={props:["modelValue"],emits:["update:modelValue"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}};const Cp=(0,rr.A)(Lp,[["render",wp]]);var Dp=Cp,Sp={components:{CustomInput:vp,CustomTextarea:Dp},data(){return{configs:n.A.get("configs"),session:n.A.get("session"),tableHeaders:[],scheduleData:[],isHeaderModalOpen:!1,dataItem:this.$route.params.id,newHeader:{name:"",type:"input"},currentSchedule:null}},async mounted(){try{this.scheduleData=await this.getData()||[],this.currentSchedule=this.scheduleData[0]||null,this.currentSchedule&&this.buildTableHeadersFromSchedule()}catch(e){console.error("Error fetching schedule data:",e)}},methods:{buildTableHeadersFromSchedule(){this.currentSchedule&&this.currentSchedule.head&&(this.tableHeaders=Object.keys(this.currentSchedule.head).map((e=>({name:e.charAt(0).toUpperCase()+e.slice(1),type:this.currentSchedule.head[e].type||"input"}))))},async getData(){try{const e=await this.$Request.POST("schedule/query",{method:"find",args:[{$and:[{parent:this.session.current._id,courseId:this.dataItem}]}]},this.configs.key);return e.data}catch(e){return console.error("Error fetching data:",e),null}},async addScheduleType(e){const t={type:e,courseId:this.dataItem,parent:this.session.current._id,head:{},item:[]};try{const{data:e,status:s}=await this.$Request.POST("schedule",{data:t},this.configs.key);200===s?(this.scheduleData.push(e),this.currentSchedule=e,console.log("New schedule added successfully:",e)):console.error("Failed to add new schedule")}catch(s){console.error("Error adding new schedule:",s)}},openHeaderModal(){this.isHeaderModalOpen=!0},async addHeaderWithApi(){const e=this.newHeader.name.trim();if(e&&!this.tableHeaders.find((t=>t.name===e)))try{const t={...this.currentSchedule.head,[e.toLowerCase()]:{type:this.newHeader.type,value:""}},s=await this.$Request.PUT(`schedule/${this.currentSchedule._id}`,{data:{head:t}},this.configs.key);200===s.status?(this.currentSchedule.head=t,this.tableHeaders.push({name:e,type:this.newHeader.type}),this.closeHeaderModal()):console.error("Failed to update header")}catch(t){console.error("Error updating header:",t)}else alert("Header already exists or name is invalid!")},async addItem(){const e={};this.tableHeaders.forEach((t=>{e[t.name.toLowerCase()]=""})),e.isEditing=!1;try{const t=[...this.currentSchedule.item,e],s=await this.$Request.PUT(`schedule/${this.currentSchedule._id}`,{data:{item:t}},this.configs.key);200===s.status?this.currentSchedule.item=t:console.error("Failed to add new item")}catch(t){console.error("Error adding new item:",t)}},async saveItem(e){try{e.isEditing=!1;const t=this.currentSchedule.item.map((t=>t===e?{...e}:t)),s=await this.$Request.PUT(`schedule/${this.currentSchedule._id}`,{data:{item:t}},this.configs.key);200===s.status?this.currentSchedule.item=t:console.error("Failed to save item")}catch(t){console.error("Error saving item:",t)}},async deleteItem(e){try{const t=this.currentSchedule.item.filter(((t,s)=>s!==e)),s=await this.$Request.PUT(`schedule/${this.currentSchedule._id}`,{data:{item:t}},this.configs.key);200===s.status?this.currentSchedule.item=t:console.error("Failed to delete item")}catch(t){console.error("Error deleting item:",t)}},async removeHeader(e){const t=this.tableHeaders[e];if(!t)return;const s={...this.currentSchedule.head};delete s[t.name.toLowerCase()];try{const t=await this.$Request.PUT(`schedule/${this.currentSchedule._id}`,{data:{head:s}},this.configs.key);200===t.status?(this.currentSchedule.head=s,this.tableHeaders.splice(e,1)):console.error("Failed to remove header")}catch(a){console.error("Error removing header:",a)}},async moveItemUp(e){if(e>0){const s=[...this.currentSchedule.item],a=s[e-1];s[e-1]=s[e],s[e]=a;try{const e=await this.$Request.PUT(`schedule/${this.currentSchedule._id}`,{data:{item:s}},this.configs.key);200===e.status?this.currentSchedule.item=s:console.error("Failed to move item up")}catch(t){console.error("Error moving item up:",t)}}},async moveItemDown(e){if(e<this.currentSchedule.item.length-1){const s=[...this.currentSchedule.item],a=s[e+1];s[e+1]=s[e],s[e]=a;try{const e=await this.$Request.PUT(`schedule/${this.currentSchedule._id}`,{data:{item:s}},this.configs.key);200===e.status?this.currentSchedule.item=s:console.error("Failed to move item down")}catch(t){console.error("Error moving item down:",t)}}},async cloneItem(e){const t={...this.currentSchedule.item[e]};t.isEditing=!1;const s=[...this.currentSchedule.item.slice(0,e+1),t,...this.currentSchedule.item.slice(e+1)];try{const e=await this.$Request.PUT(`schedule/${this.currentSchedule._id}`,{data:{item:s}},this.configs.key);200===e.status?this.currentSchedule.item=s:console.error("Failed to clone item")}catch(a){console.error("Error cloning item:",a)}},editItem(e){e.isEditing=!0},closeHeaderModal(){this.isHeaderModalOpen=!1,this.newHeader.name="",this.newHeader.type="input"}}};const Fp=(0,rr.A)(Sp,[["render",xp],["__scopeId","data-v-13ca50d9"]]);var Ip=Fp;const Ep={class:"fixed top-4 right-4 z-50 space-y-2"},$p={class:"max-w-sm w-full bg-white shadow-lg rounded-lg border border-gray-100 overflow-hidden"},_p={class:"p-3"},Pp={class:"flex items-start"},Tp={class:"flex-shrink-0"},Ap={key:0,class:"w-5 h-5 bg-green-100 rounded-full flex items-center justify-center"},Xp={key:1,class:"w-5 h-5 bg-red-100 rounded-full flex items-center justify-center"},jp={key:2,class:"w-5 h-5 bg-blue-100 rounded-full flex items-center justify-center"},Up={class:"ml-2 w-0 flex-1"},Bp={class:"text-sm font-medium text-gray-900"},Op={class:"ml-3 flex-shrink-0"},Qp=["onClick"],Mp={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Vp={class:"px-4 py-3 border-b border-gray-200"},Rp={class:"flex items-center justify-between"},Wp={class:"flex items-center space-x-3"},Np={class:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg flex items-center justify-center"},qp={class:"text-xs text-gray-500"},Kp={class:"flex items-center space-x-2"},Hp={class:"bg-blue-50 border-l-4 border-blue-400 p-3"},zp={class:"flex"},Gp={class:"flex-shrink-0"},Jp={class:"p-4"},Yp={class:"space-y-3 mb-6"},Zp={class:"flex flex-wrap items-center gap-3"},eh={class:"border-l border-gray-300 pl-3 ml-3 flex items-center space-x-2"},th={class:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-yellow-600 bg-yellow-100 hover:bg-yellow-200 rounded-lg transition-colors cursor-pointer"},sh={class:"grid grid-cols-4 gap-4 mb-6"},ah={class:"bg-indigo-50 rounded-lg p-3 border border-indigo-100"},oh={class:"text-lg font-semibold text-indigo-900"},ih={class:"bg-green-50 rounded-lg p-3 border border-green-100"},rh={class:"text-lg font-semibold text-green-900"},nh={class:"bg-purple-50 rounded-lg p-3 border border-purple-100"},lh={class:"text-lg font-semibold text-purple-900"},ch={class:"bg-blue-50 rounded-lg p-3 border border-blue-100"},dh={class:"text-lg font-semibold text-blue-900"},uh={class:"space-y-4"},mh={key:0,class:"text-center py-8"},gh={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},ph={key:1,class:"space-y-3"},hh={class:"p-4"},bh={class:"flex items-center justify-between"},xh={class:"flex items-center space-x-3 flex-1"},yh={class:"relative inline-flex items-center cursor-pointer"},fh=["onUpdate:modelValue","onChange"],kh={class:"flex items-center space-x-3 flex-1"},vh={class:"flex-shrink-0"},wh={class:"flex-1 min-w-0"},Lh={class:"flex items-center space-x-2 mb-1"},Ch={class:"text-base font-semibold text-gray-900"},Dh={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Sh={key:0,class:"flex items-center space-x-3 text-xs text-gray-500"},Fh={key:0,class:"flex items-center"},Ih={key:1,class:"flex items-center"},Eh={key:2,class:"flex items-center"},$h={key:1,class:"text-sm text-gray-500"},_h={class:"flex items-center space-x-1"},Ph=["onClick"],Th=["onClick"],Ah=["onClick"],Xh={key:0,class:"border-t border-gray-200 bg-gray-50"},jh={class:"p-4 space-y-4"},Uh={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Bh={class:"space-y-4"},Oh={class:"bg-white rounded-lg border border-gray-200 p-4"},Qh={class:"flex items-center text-sm font-medium text-gray-800 mb-3"},Mh=["onUpdate:modelValue","onChange"],Vh={class:"flex items-center"},Rh={key:0,class:"bg-gray-50 rounded-lg border border-gray-200 p-3"},Wh={key:1,class:"text-center py-6 text-gray-400"},Nh={class:"bg-white rounded-lg border border-gray-200 p-4"},qh={class:"flex items-center text-sm font-medium text-gray-800 mb-3"},Kh=["onUpdate:modelValue","onChange"],Hh={class:"flex items-center"},zh={key:0,class:"bg-gray-50 rounded-lg border border-gray-200 p-3"},Gh={key:1,class:"text-center py-6 text-gray-400"},Jh={class:"bg-white rounded-lg border border-gray-200 p-4"},Yh={class:"flex items-center text-sm font-medium text-gray-800 mb-3"},Zh=["onUpdate:modelValue","onChange"],eb={class:"flex items-center"},tb={key:0,class:"space-y-3"},sb={class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},ab={class:"text-sm font-medium text-gray-900 flex items-center"},ob={class:"text-sm text-gray-600 bg-white px-3 py-1 rounded-full border"},ib={class:"bg-gray-50 rounded-lg p-3 border border-gray-200"},rb={class:"flex space-x-2"},nb=["onUpdate:modelValue","onKeyup"],lb=["onClick","disabled"],cb={key:0,class:"space-y-2"},db={class:"flex items-center justify-between mb-3"},ub={class:"text-sm font-medium text-gray-900 flex items-center"},mb={class:"w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center mr-2"},gb=["onClick"],pb={class:"space-y-3"},hb={class:"bg-gray-50 rounded-lg p-3 border border-gray-200"},bb={class:"flex items-center text-xs font-medium text-gray-700 mb-2"},xb=["onUpdate:modelValue","onChange"],yb={key:0,class:"bg-white rounded-lg border border-gray-200 p-2"},fb={key:1,class:"text-center py-3 text-gray-400"},kb={class:"bg-gray-50 rounded-lg p-3 border border-gray-200"},vb={class:"flex items-center text-xs font-medium text-gray-700 mb-2"},wb=["onUpdate:modelValue","onChange"],Lb={key:0,class:"bg-white rounded-lg border border-gray-200 p-2"},Cb={key:1,class:"text-center py-3 text-gray-400"},Db={key:1,class:"text-center py-6 text-gray-500 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300"},Sb={key:1,class:"text-center py-6 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300"},Fb={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},Ib=["onClick"],Eb=["onClick"];function $b(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon"),d=(0,a.g2)("CustomDateTimePicker");return(0,a.uX)(),(0,a.CE)(a.FK,null,[((0,a.uX)(),(0,a.Wv)(a.Im,{to:"body"},[(0,a.Lk)("div",Ep,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.notifications,(e=>((0,a.uX)(),(0,a.Wv)(c.eB,{key:e.id,"enter-active-class":"transform ease-out duration-300 transition","enter-from-class":"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2","enter-to-class":"translate-y-0 opacity-100 sm:translate-x-0","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",$p,[(0,a.Lk)("div",_p,[(0,a.Lk)("div",Pp,[(0,a.Lk)("div",Tp,["success"===e.type?((0,a.uX)(),(0,a.CE)("div",Ap,t[6]||(t[6]=[(0,a.Lk)("svg",{class:"w-3 h-3 text-green-600",fill:"currentColor",viewBox:"0 0 20 20"},[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]))):"error"===e.type?((0,a.uX)(),(0,a.CE)("div",Xp,t[7]||(t[7]=[(0,a.Lk)("svg",{class:"w-3 h-3 text-red-600",fill:"currentColor",viewBox:"0 0 20 20"},[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]))):((0,a.uX)(),(0,a.CE)("div",jp,t[8]||(t[8]=[(0,a.Lk)("svg",{class:"w-3 h-3 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20"},[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)])))]),(0,a.Lk)("div",Up,[(0,a.Lk)("p",Bp,(0,l.v_)(e.message),1)]),(0,a.Lk)("div",Op,[(0,a.Lk)("button",{onClick:t=>r.hideNotification(e.id),class:"text-gray-400 hover:text-gray-500 transition-colors"},t[9]||(t[9]=[(0,a.Lk)("svg",{class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,Qp)])])])])])),_:2},1024)))),128))])])),(0,a.Lk)("div",Mp,[(0,a.Lk)("div",Vp,[(0,a.Lk)("div",Rp,[(0,a.Lk)("div",Wp,[(0,a.Lk)("div",Np,[(0,a.bF)(n,{icon:["fas","calendar-days"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[10]||(t[10]=(0,a.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"ตั้งค่าตารางเวลา",-1)),(0,a.Lk)("p",qp,"จัดการตารางเวลาและกิจกรรมการเรียน ("+(0,l.v_)(r.activeScheduleCount)+"/"+(0,l.v_)(i.schedule.length)+" กิจกรรม)",1)])]),(0,a.Lk)("div",Kp,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.enableAllSchedules&&r.enableAllSchedules(...e)),class:"inline-flex items-center rounded-lg border border-transparent bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors shadow-sm"},[(0,a.bF)(n,{icon:["fas","toggle-on"],class:"text-white mr-1.5"}),t[11]||(t[11]=(0,a.eW)(" เปิดทั้งหมด "))]),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.saveAllSchedules&&r.saveAllSchedules(...e)),class:"inline-flex items-center rounded-lg border border-transparent bg-green-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors shadow-sm"},[(0,a.bF)(n,{icon:["fas","save"],class:"text-white mr-1.5"}),t[12]||(t[12]=(0,a.eW)(" บันทึก "))])])])]),(0,a.Lk)("div",Hp,[(0,a.Lk)("div",zp,[(0,a.Lk)("div",Gp,[(0,a.bF)(n,{icon:["fas","info-circle"],class:"text-blue-400 text-sm"})]),t[13]||(t[13]=(0,a.Lk)("div",{class:"ml-2"},[(0,a.Lk)("p",{class:"text-xs text-blue-700"},[(0,a.Lk)("strong",null,"หมายเหตุ:"),(0,a.eW)(" ตั้งค่าตารางเวลาสำหรับกิจกรรมต่างๆ ในหลักสูตร เช่น การลงทะเบียน การเรียน การสอบ และการประกาศผล ")])],-1))])]),(0,a.Lk)("div",Jp,[(0,a.Lk)("div",Yp,[(0,a.Lk)("div",Zp,[(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.disableAllSchedules&&r.disableAllSchedules(...e)),class:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"},[(0,a.bF)(n,{icon:["fas","toggle-off"],class:"mr-1"}),t[14]||(t[14]=(0,a.eW)(" ปิดทั้งหมด "))]),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.resetAllSchedules&&r.resetAllSchedules(...e)),class:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-red-600 bg-red-100 hover:bg-red-200 rounded-lg transition-colors"},[(0,a.bF)(n,{icon:["fas","refresh"],class:"mr-1"}),t[15]||(t[15]=(0,a.eW)(" รีเซ็ต "))]),(0,a.Lk)("div",eh,[(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.exportScheduleConfig&&r.exportScheduleConfig(...e)),class:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-600 bg-blue-100 hover:bg-blue-200 rounded-lg transition-colors"},[(0,a.bF)(n,{icon:["fas","download"],class:"mr-1"}),t[16]||(t[16]=(0,a.eW)(" ส่งออก "))]),(0,a.Lk)("label",th,[(0,a.bF)(n,{icon:["fas","upload"],class:"mr-1"}),t[17]||(t[17]=(0,a.eW)(" นำเข้า ")),(0,a.Lk)("input",{type:"file",onChange:t[5]||(t[5]=(...e)=>r.importScheduleConfig&&r.importScheduleConfig(...e)),accept:".json",class:"hidden"},null,32)])])])]),(0,a.Lk)("div",sh,[(0,a.Lk)("div",ah,[t[18]||(t[18]=(0,a.Lk)("div",{class:"text-xs font-medium text-indigo-600"},"เปิดใช้งาน",-1)),(0,a.Lk)("div",oh,(0,l.v_)(r.activeScheduleCount),1)]),(0,a.Lk)("div",ih,[t[19]||(t[19]=(0,a.Lk)("div",{class:"text-xs font-medium text-green-600"},"มีเวลา",-1)),(0,a.Lk)("div",rh,(0,l.v_)(r.dateScheduleCount),1)]),(0,a.Lk)("div",nh,[t[20]||(t[20]=(0,a.Lk)("div",{class:"text-xs font-medium text-purple-600"},"รอบทั้งหมด",-1)),(0,a.Lk)("div",lh,(0,l.v_)(r.totalRoundsCount),1)]),(0,a.Lk)("div",ch,[t[21]||(t[21]=(0,a.Lk)("div",{class:"text-xs font-medium text-blue-600"},"ทั้งหมด",-1)),(0,a.Lk)("div",dh,(0,l.v_)(i.schedule.length),1)])]),(0,a.Lk)("div",uh,[0===i.schedule.length?((0,a.uX)(),(0,a.CE)("div",mh,[(0,a.Lk)("div",gh,[(0,a.bF)(n,{icon:["fas","calendar-xmark"],class:"text-gray-400 text-lg"})]),t[22]||(t[22]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ไม่มีตารางเวลา",-1)),t[23]||(t[23]=(0,a.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"เริ่มต้นสร้างตารางเวลาสำหรับหลักสูตรของคุณ",-1))])):((0,a.uX)(),(0,a.CE)("div",ph,[(0,a.bF)(c.F,{name:"schedule",tag:"div",class:"space-y-3"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.schedule,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:e.item,class:(0,l.C4)(["bg-white border border-gray-200 rounded-lg hover:border-gray-300 hover:shadow-md transition-all duration-200",{"border-indigo-300 bg-indigo-50":e.used}])},[(0,a.Lk)("div",hh,[(0,a.Lk)("div",bh,[(0,a.Lk)("div",xh,[(0,a.Lk)("label",yh,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.used=t,onChange:t=>r.updateScheduleConfig(e),class:"sr-only peer"},null,40,fh),[[c.lH,e.used]]),t[24]||(t[24]=(0,a.Lk)("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-5 peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"},null,-1))]),(0,a.Lk)("div",kh,[(0,a.Lk)("div",vh,[(0,a.Lk)("div",{class:(0,l.C4)(["w-12 h-12 rounded-lg flex items-center justify-center text-white",r.getScheduleIconColor(e.item)])},[(0,a.bF)(n,{icon:["fas",r.getScheduleIcon(e.item)],class:"text-base"},null,8,["icon"])],2)]),(0,a.Lk)("div",wh,[(0,a.Lk)("div",Lh,[(0,a.Lk)("h3",Ch,(0,l.v_)(s+1)+". "+(0,l.v_)(e.name),1),e.optional&&e.optional.length>0?((0,a.uX)(),(0,a.CE)("span",Dh,(0,l.v_)(e.optional.join(", ")),1)):(0,a.Q3)("",!0)]),e.used?((0,a.uX)(),(0,a.CE)("div",Sh,[e.startDateUsed&&e.startDate?((0,a.uX)(),(0,a.CE)("span",Fh,[(0,a.bF)(n,{icon:["fas","play"],class:"mr-1 text-green-500 text-xs"}),(0,a.eW)(" "+(0,l.v_)(r.formatDateTime(e.startDate)),1)])):(0,a.Q3)("",!0),e.endDateUsed&&e.endDate?((0,a.uX)(),(0,a.CE)("span",Ih,[(0,a.bF)(n,{icon:["fas","stop"],class:"mr-1 text-red-500 text-xs"}),(0,a.eW)(" "+(0,l.v_)(r.formatDateTime(e.endDate)),1)])):(0,a.Q3)("",!0),e.roundUsed&&e.rounds.length>0?((0,a.uX)(),(0,a.CE)("span",Eh,[(0,a.bF)(n,{icon:["fas","repeat"],class:"mr-1 text-purple-500 text-xs"}),(0,a.eW)(" "+(0,l.v_)(e.rounds.length)+" รอบ ",1)])):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.CE)("p",$h,(0,l.v_)(e.description),1))])])]),(0,a.Lk)("div",_h,[e.used?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t=>r.duplicateSchedule(e),class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors",title:"ทำสำเนา"},[(0,a.bF)(n,{icon:["fas","copy"],class:"mr-1 text-xs"}),t[25]||(t[25]=(0,a.eW)(" ทำสำเนา "))],8,Ph)):(0,a.Q3)("",!0),e.used?((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:t=>r.resetScheduleItem(e),class:"inline-flex items-center px-2.5 py-1 border border-red-200 rounded-md text-xs font-medium text-red-600 bg-red-50 hover:bg-red-100 transition-colors",title:"รีเซ็ต"},[(0,a.bF)(n,{icon:["fas","refresh"],class:"mr-1 text-xs"}),t[26]||(t[26]=(0,a.eW)(" รีเซ็ต "))],8,Th)):(0,a.Q3)("",!0),e.used?((0,a.uX)(),(0,a.CE)("button",{key:2,onClick:e=>r.toggleScheduleExpand(s),class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors",title:"ตั้งค่า"},[(0,a.bF)(n,{icon:["fas","edit"],class:"mr-1 text-xs"}),t[27]||(t[27]=(0,a.eW)(" แก้ไข "))],8,Ah)):(0,a.Q3)("",!0)])])]),(0,a.bF)(c.eB,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:(0,a.k6)((()=>[e.used&&i.expandedSchedules.includes(s)?((0,a.uX)(),(0,a.CE)("div",Xh,[(0,a.Lk)("div",jh,[(0,a.Lk)("div",Uh,[(0,a.Lk)("div",Bh,[(0,a.Lk)("div",Oh,[(0,a.Lk)("label",Qh,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.startDateUsed=t,onChange:t=>r.updateScheduleConfig(e),class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-3"},null,40,Mh),[[c.lH,e.startDateUsed]]),(0,a.Lk)("div",Vh,[(0,a.bF)(n,{icon:["fas","play"],class:"mr-2 text-green-500"}),t[28]||(t[28]=(0,a.Lk)("span",null,"วันเริ่มต้น",-1))])]),e.startDateUsed?((0,a.uX)(),(0,a.CE)("div",Rh,[(0,a.bF)(d,{modelValue:e.startDate,"onUpdate:modelValue":t=>e.startDate=t,value:e.startDate,onUpdate:t=>r.completeStartDate(e,t)},null,8,["modelValue","onUpdate:modelValue","value","onUpdate"])])):((0,a.uX)(),(0,a.CE)("div",Wh,[(0,a.bF)(n,{icon:["fas","calendar-xmark"],class:"text-2xl mb-2"}),t[29]||(t[29]=(0,a.Lk)("p",{class:"text-sm"},"ไม่ได้กำหนดวันเริ่มต้น",-1))]))]),(0,a.Lk)("div",Nh,[(0,a.Lk)("label",qh,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.endDateUsed=t,onChange:t=>r.updateScheduleConfig(e),class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-3"},null,40,Kh),[[c.lH,e.endDateUsed]]),(0,a.Lk)("div",Hh,[(0,a.bF)(n,{icon:["fas","stop"],class:"mr-2 text-red-500"}),t[30]||(t[30]=(0,a.Lk)("span",null,"วันสิ้นสุด",-1))])]),e.endDateUsed?((0,a.uX)(),(0,a.CE)("div",zh,[(0,a.bF)(d,{modelValue:e.endDate,"onUpdate:modelValue":t=>e.endDate=t,value:e.endDate,onUpdate:t=>r.completeEndDate(e,t)},null,8,["modelValue","onUpdate:modelValue","value","onUpdate"])])):((0,a.uX)(),(0,a.CE)("div",Gh,[(0,a.bF)(n,{icon:["fas","calendar-xmark"],class:"text-2xl mb-2"}),t[31]||(t[31]=(0,a.Lk)("p",{class:"text-sm"},"ไม่ได้กำหนดวันสิ้นสุด",-1))]))])]),(0,a.Lk)("div",Jh,[(0,a.Lk)("label",Yh,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.roundUsed=t,onChange:t=>r.updateScheduleConfig(e),class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-3"},null,40,Zh),[[c.lH,e.roundUsed]]),(0,a.Lk)("div",eb,[(0,a.bF)(n,{icon:["fas","repeat"],class:"mr-2 text-purple-500"}),t[32]||(t[32]=(0,a.Lk)("span",null,"จัดการรอบ",-1))])]),e.roundUsed?((0,a.uX)(),(0,a.CE)("div",tb,[(0,a.Lk)("div",sb,[(0,a.Lk)("h4",ab,[(0,a.bF)(n,{icon:["fas","list"],class:"mr-2 text-indigo-500"}),t[33]||(t[33]=(0,a.eW)(" รายการรอบ "))]),(0,a.Lk)("span",ob,(0,l.v_)(e.rounds.length)+" รอบ ",1)]),(0,a.Lk)("div",ib,[t[35]||(t[35]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"เพิ่มรอบใหม่",-1)),(0,a.Lk)("div",rb,[(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.customRound=t,placeholder:"ชื่อรอบใหม่...",class:"flex-1 text-sm border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",onKeyup:(0,c.jR)((t=>r.addCustomRound(e)),["enter"])},null,40,nb),[[c.Jo,e.customRound]]),(0,a.Lk)("button",{onClick:t=>r.addCustomRound(e),disabled:!e.customRound.trim(),class:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-1"}),t[34]||(t[34]=(0,a.eW)(" เพิ่ม "))],8,lb)])]),e.rounds.length>0?((0,a.uX)(),(0,a.CE)("div",cb,[(0,a.bF)(c.F,{name:"round",tag:"div",class:"grid grid-cols-1 md:grid-cols-2 gap-3"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.rounds,((s,o)=>((0,a.uX)(),(0,a.CE)("div",{key:s.name,class:"border border-gray-200 rounded-lg p-3 bg-white hover:shadow-sm transition-shadow"},[(0,a.Lk)("div",db,[(0,a.Lk)("h5",ub,[(0,a.Lk)("div",mb,[(0,a.bF)(n,{icon:["fas","circle"],class:"text-purple-600 text-xs"})]),(0,a.eW)(" "+(0,l.v_)(s.name),1)]),(0,a.Lk)("button",{onClick:t=>r.removeRound(e,o),class:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors"},[(0,a.bF)(n,{icon:["fas","trash"],class:"text-sm"})],8,gb)]),(0,a.Lk)("div",pb,[(0,a.Lk)("div",hb,[(0,a.Lk)("label",bb,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>s.StartDateUsed=e,onChange:t=>r.updateScheduleConfig(e),class:"h-3 w-3 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-2"},null,40,xb),[[c.lH,s.StartDateUsed]]),(0,a.bF)(n,{icon:["fas","play"],class:"mr-1 text-green-500 text-xs"}),t[36]||(t[36]=(0,a.eW)(" วันเริ่มรอบ "))]),s.StartDateUsed?((0,a.uX)(),(0,a.CE)("div",yb,[(0,a.bF)(d,{modelValue:s.StartDate,"onUpdate:modelValue":e=>s.StartDate=e,value:s.StartDate,onUpdate:e=>r.updateRoundStartDate(s,e)},null,8,["modelValue","onUpdate:modelValue","value","onUpdate"])])):((0,a.uX)(),(0,a.CE)("div",fb,[(0,a.bF)(n,{icon:["fas","calendar-xmark"],class:"text-lg mb-1"}),t[37]||(t[37]=(0,a.Lk)("p",{class:"text-xs"},"ไม่ได้กำหนดวันเริ่ม",-1))]))]),(0,a.Lk)("div",kb,[(0,a.Lk)("label",vb,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>s.EndDateUsed=e,onChange:t=>r.updateScheduleConfig(e),class:"h-3 w-3 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-2"},null,40,wb),[[c.lH,s.EndDateUsed]]),(0,a.bF)(n,{icon:["fas","stop"],class:"mr-1 text-red-500 text-xs"}),t[38]||(t[38]=(0,a.eW)(" วันสิ้นสุดรอบ "))]),s.EndDateUsed?((0,a.uX)(),(0,a.CE)("div",Lb,[(0,a.bF)(d,{modelValue:s.EndDate,"onUpdate:modelValue":e=>s.EndDate=e,value:s.EndDate,onUpdate:e=>r.updateRoundEndDate(s,e)},null,8,["modelValue","onUpdate:modelValue","value","onUpdate"])])):((0,a.uX)(),(0,a.CE)("div",Cb,[(0,a.bF)(n,{icon:["fas","calendar-xmark"],class:"text-lg mb-1"}),t[39]||(t[39]=(0,a.Lk)("p",{class:"text-xs"},"ไม่ได้กำหนดวันสิ้นสุด",-1))]))])])])))),128))])),_:2},1024)])):((0,a.uX)(),(0,a.CE)("div",Db,[(0,a.bF)(n,{icon:["fas","calendar-plus"],class:"text-2xl mb-2 text-gray-400"}),t[40]||(t[40]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-900 mb-1"},"ยังไม่มีรอบ",-1)),t[41]||(t[41]=(0,a.Lk)("p",{class:"text-xs text-gray-500"},"เพิ่มรอบใหม่เพื่อเริ่มต้นการจัดการ",-1))]))])):((0,a.uX)(),(0,a.CE)("div",Sb,[(0,a.bF)(n,{icon:["fas","repeat"],class:"text-2xl mb-2"}),t[42]||(t[42]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-600 mb-1"},"การจัดการรอบปิดใช้งาน",-1)),t[43]||(t[43]=(0,a.Lk)("p",{class:"text-xs text-gray-500"},"เปิดใช้งานเพื่อจัดการรอบต่างๆ",-1))]))])]),(0,a.Lk)("div",Fb,[(0,a.Lk)("button",{onClick:t=>r.resetScheduleItem(e),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"},[(0,a.bF)(n,{icon:["fas","refresh"],class:"mr-2"}),t[44]||(t[44]=(0,a.eW)(" รีเซ็ต "))],8,Ib),(0,a.Lk)("button",{onClick:t=>r.updateScheduleConfig(e),class:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors"},[(0,a.bF)(n,{icon:["fas","save"],class:"mr-2"}),t[45]||(t[45]=(0,a.eW)(" บันทึก "))],8,Eb)])])])):(0,a.Q3)("",!0)])),_:2},1024)],2)))),128))])),_:1})]))])])])],64)}const _b={class:"datetime-picker-compact"},Pb={class:"input-container-compact"},Tb=["value"],Ab={key:0,class:"panel-compact"},Xb={class:"panel-header"},jb={class:"selection-section"},Ub={class:"date-selection-compact"},Bb=["value"],Ob=["value"],Qb=["value"],Mb={class:"selection-section"},Vb={class:"time-selection-compact"},Rb=["value"],Wb=["value"],Nb={class:"button-row-compact"};function qb(e,t,s,o,i,r){return(0,a.uX)(),(0,a.CE)("div",_b,[(0,a.Lk)("div",Pb,[(0,a.Lk)("input",{type:"text",value:r.formattedDateTime,onFocus:t[0]||(t[0]=e=>i.showPanel=!0),readonly:"",class:"w-full px-3 py-2 text-xs border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 transition-all cursor-pointer",placeholder:"เลือกวันที่และเวลา"},null,40,Tb),t[10]||(t[10]=(0,a.Lk)("div",{class:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none"},[(0,a.Lk)("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1))]),(0,a.bF)(c.eB,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:(0,a.k6)((()=>[i.showPanel?((0,a.uX)(),(0,a.CE)("div",Ab,[(0,a.Lk)("div",Xb,[t[12]||(t[12]=(0,a.Lk)("h4",{class:"text-xs font-medium text-gray-900 flex items-center"},[(0,a.Lk)("svg",{class:"w-3 h-3 mr-1 text-indigo-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})]),(0,a.eW)(" เลือกวันที่และเวลา ")],-1)),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.closePanel&&r.closePanel(...e)),class:"p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors"},t[11]||(t[11]=[(0,a.Lk)("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),(0,a.Lk)("div",jb,[t[13]||(t[13]=(0,a.Lk)("label",{class:"section-label"},[(0,a.Lk)("svg",{class:"w-3 h-3 mr-1 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})]),(0,a.eW)(" วันที่ ")],-1)),(0,a.Lk)("div",Ub,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.selectedDay=e),class:"select-compact"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.days,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,l.v_)(e),9,Bb)))),128))],512),[[c.u1,i.selectedDay]]),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.selectedMonth=e),class:"select-compact"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.thaiMonths,((e,t)=>((0,a.uX)(),(0,a.CE)("option",{key:t,value:t+1},(0,l.v_)(e),9,Ob)))),128))],512),[[c.u1,i.selectedMonth]]),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>i.selectedYear=e),class:"select-compact"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.years,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,l.v_)(e+543),9,Qb)))),128))],512),[[c.u1,i.selectedYear]])])]),(0,a.Lk)("div",Mb,[t[15]||(t[15]=(0,a.Lk)("label",{class:"section-label"},[(0,a.Lk)("svg",{class:"w-3 h-3 mr-1 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),(0,a.eW)(" เวลา ")],-1)),(0,a.Lk)("div",Vb,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.selectedHour=e),class:"select-compact"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.hours,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,l.v_)(e),9,Rb)))),128))],512),[[c.u1,i.selectedHour]]),t[14]||(t[14]=(0,a.Lk)("span",{class:"time-separator"},":",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.selectedMinute=e),class:"select-compact"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.minutes,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,l.v_)(e),9,Wb)))),128))],512),[[c.u1,i.selectedMinute]])])]),(0,a.Lk)("div",Nb,[(0,a.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>r.closePanel&&r.closePanel(...e)),class:"btn-secondary-compact"},t[16]||(t[16]=[(0,a.Lk)("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),(0,a.eW)(" ยกเลิก ")])),(0,a.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>r.updateDateTime&&r.updateDateTime(...e)),class:"btn-primary-compact"},t[17]||(t[17]=[(0,a.Lk)("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),(0,a.eW)(" ตกลง ")]))])])):(0,a.Q3)("",!0)])),_:1}),i.showPanel?((0,a.uX)(),(0,a.CE)("div",{key:0,onClick:t[9]||(t[9]=(...e)=>r.closePanel&&r.closePanel(...e)),class:"panel-backdrop"})):(0,a.Q3)("",!0)])}var Kb={props:{value:{type:String,required:!1,default:""}},data(){return{showPanel:!1,selectedDay:(new Date).getDate(),selectedMonth:(new Date).getMonth()+1,selectedYear:(new Date).getFullYear(),selectedHour:(new Date).getHours(),selectedMinute:(new Date).getMinutes(),days:Array.from({length:31},((e,t)=>t+1)),thaiMonths:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],years:Array.from({length:101},((e,t)=>(new Date).getFullYear()-t)),hours:Array.from({length:24},((e,t)=>String(t).padStart(2,"0"))),minutes:Array.from({length:60},((e,t)=>String(t).padStart(2,"0")))}},computed:{formattedDateTime(){const e=String(this.selectedHour).padStart(2,"0"),t=String(this.selectedMinute).padStart(2,"0");return`${this.selectedDay} ${this.thaiMonths[this.selectedMonth-1]} ${this.selectedYear+543} ${e}:${t}`}},watch:{value:{immediate:!0,handler(e){if(e){const t=new Date(e);isNaN(t)||(this.selectedDay=t.getUTCDate(),this.selectedMonth=t.getUTCMonth()+1,this.selectedYear=t.getUTCFullYear(),this.selectedHour=String(t.getUTCHours()).padStart(2,"0"),this.selectedMinute=String(t.getUTCMinutes()).padStart(2,"0"))}}}},methods:{updateDateTime(){const e=new Date(Date.UTC(this.selectedYear,this.selectedMonth-1,this.selectedDay,parseInt(this.selectedHour,10),parseInt(this.selectedMinute,10)));this.$emit("update",e.toISOString()),this.$emit("complete",{dateTime:e.toISOString()}),this.showPanel=!1},closePanel(){this.showPanel=!1}}};const Hb=(0,rr.A)(Kb,[["render",qb],["__scopeId","data-v-5f0e22f4"]]);var zb=Hb,Gb={name:"Condition",components:{CustomDateTimePicker:zb},data(){const e=(0,r.lq)();return{dataItem:this.$route.params.id,configs:n.A.get("configs"),PageName:e.meta.title,PageIcon:e.meta.icon,PagePath:e.meta.path,ParentName:e.meta.parent,ParentPage:e.meta.page,expandedSchedules:[],isLoading:!1,notifications:[],notificationId:0,scheduleTemplates:[{name:"แบบมาตรฐาน",description:"ตารางเวลาพื้นฐานสำหรับหลักสูตรทั่วไป",config:["register","learn","posttest","result"]},{name:"แบบสมบูรณ์",description:"ตารางเวลาครบถ้วนสำหรับหลักสูตรที่มีการประเมินผล",config:["register","learn","pretest","posttest","retest","result","certification"]},{name:"แบบมีรอบ",description:"ตารางเวลาสำหรับหลักสูตรที่มีการจัดรอบ",config:["register","learn","posttest","result"],withRounds:!0}],schedule:[{item:"register",name:"ลงทะเบียน",description:"ช่วงเวลาที่ผู้เรียนสามารถลงทะเบียนเข้าเรียน",status:["open","close"],used:!1,startDate:"",endDate:"",startDateUsed:!1,endDateUsed:!1,optional:[],roundUsed:!1,customRound:"",rounds:[],priority:1},{item:"learn",name:"เปิดเรียน",description:"ช่วงเวลาที่ผู้เรียนสามารถเข้าถึงเนื้อหาการเรียน",status:["open","close"],used:!1,startDate:"",endDate:"",startDateUsed:!1,endDateUsed:!1,optional:[],roundUsed:!1,customRound:"",rounds:[],priority:2},{item:"pretest",name:"สอบก่อนเรียน",description:"การทดสอบความรู้ก่อนเริ่มเรียน",status:["open","close"],used:!1,startDate:"",endDate:"",startDateUsed:!1,endDateUsed:!1,optional:[],roundUsed:!1,customRound:"",rounds:[],priority:3},{item:"posttest",name:"สอบวัดผล",description:"การทดสอบความรู้หลังจากเรียนจบ",status:["open","close"],optional:["round?"],used:!1,startDate:"",endDate:"",startDateUsed:!1,endDateUsed:!1,roundUsed:!1,customRound:"",rounds:[],priority:4},{item:"retest",name:"สอบซ่อม",description:"การทดสอบซ่อมเสริมสำหรับผู้ที่สอบไม่ผ่าน",status:["open","close"],optional:["round?"],used:!1,startDate:"",endDate:"",startDateUsed:!1,endDateUsed:!1,roundUsed:!1,customRound:"",rounds:[],priority:5},{item:"result",name:"ประกาศผล",description:"การประกาศผลการเรียนและการสอบ",status:["open","close"],optional:["round?"],used:!1,startDate:"",endDate:"",startDateUsed:!1,endDateUsed:!1,roundUsed:!1,customRound:"",rounds:[],priority:6},{item:"certification",name:"ใบประกาศ",description:"การออกใบประกาศนียบัตรหรือใบรับรอง",status:["open","close"],optional:["round?"],used:!1,startDate:"",endDate:"",startDateUsed:!1,endDateUsed:!1,roundUsed:!1,customRound:"",rounds:[],priority:7}],scheduleConfig:[],searchQuery:"",filterStatus:"all",sortBy:"priority"}},computed:{activeScheduleCount(){return this.schedule.filter((e=>e.used)).length},roundScheduleCount(){return this.schedule.filter((e=>e.used&&e.roundUsed)).length},dateScheduleCount(){return this.schedule.filter((e=>e.used&&(e.startDateUsed||e.endDateUsed))).length},totalRoundsCount(){return this.schedule.reduce(((e,t)=>e+(t.rounds?.length||0)),0)},filteredSchedule(){let e=[...this.schedule];return this.searchQuery&&(e=e.filter((e=>e.name.toLowerCase().includes(this.searchQuery.toLowerCase())||e.description.toLowerCase().includes(this.searchQuery.toLowerCase())))),"active"===this.filterStatus?e=e.filter((e=>e.used)):"inactive"===this.filterStatus&&(e=e.filter((e=>!e.used))),e.sort(((e,t)=>{switch(this.sortBy){case"name":return e.name.localeCompare(t.name);case"date":{const s=e.startDate||e.endDate||"",a=t.startDate||t.endDate||"";return new Date(s)-new Date(a)}default:return e.priority-t.priority}})),e}},methods:{getScheduleIcon(e){const t={register:"user-plus",learn:"book-open",pretest:"clipboard-question",posttest:"clipboard-check",retest:"redo",result:"trophy",certification:"award"};return t[e]||"calendar"},getScheduleIconColor(e){const t={register:"bg-gradient-to-br from-blue-500 to-blue-600",learn:"bg-gradient-to-br from-green-500 to-green-600",pretest:"bg-gradient-to-br from-yellow-500 to-yellow-600",posttest:"bg-gradient-to-br from-purple-500 to-purple-600",retest:"bg-gradient-to-br from-orange-500 to-orange-600",result:"bg-gradient-to-br from-pink-500 to-pink-600",certification:"bg-gradient-to-br from-indigo-500 to-indigo-600"};return t[e]||"bg-gradient-to-br from-gray-500 to-gray-600"},formatDateTime(e){if(!e)return"";try{const t=new Date(e.dateTime||e);return t.toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e.toString()}},toggleScheduleExpand(e){const t=this.expandedSchedules.indexOf(e);t>-1?this.expandedSchedules.splice(t,1):this.expandedSchedules.push(e)},autoExpandSchedule(e,t=!1){const s=this.schedule.findIndex((t=>t.item===e.item));-1===s||this.expandedSchedules.includes(s)||(this.expandedSchedules.push(s),t&&this.showNotification(`ขยายการตั้งค่า ${e.name} โดยอัตโนมัติ`,"info"))},autoCollapseSchedule(e,t=!1){const s=this.schedule.findIndex((t=>t.item===e.item));if(-1!==s){const a=this.expandedSchedules.indexOf(s);a>-1&&(this.expandedSchedules.splice(a,1),t&&this.showNotification(`ย่อการตั้งค่า ${e.name} โดยอัตโนมัติ`,"info"))}},enableAllSchedules(){this.schedule.forEach((e=>{e.used=!0,this.autoExpandSchedule(e,!1),this.updateScheduleConfig(e)})),this.showNotification("เปิดใช้งานและขยายตารางเวลาทั้งหมดแล้ว","success")},disableAllSchedules(){this.schedule.forEach((e=>{e.used=!1,this.updateScheduleConfig(e)})),this.expandedSchedules=[],this.showNotification("ปิดใช้งานตารางเวลาทั้งหมดแล้ว","success")},saveAllSchedules(){this.schedule.forEach((e=>{e.used&&this.updateScheduleConfig(e)})),this.showNotification("บันทึกตารางเวลาทั้งหมดแล้ว","success")},resetAllSchedules(){confirm("คุณต้องการรีเซ็ตตารางเวลาทั้งหมดหรือไม่?")&&(this.schedule.forEach((e=>{this.resetScheduleItem(e,!1)})),this.expandedSchedules=[],this.showNotification("รีเซ็ตตารางเวลาทั้งหมดแล้ว","success"))},resetScheduleItem(e,t=!0){e.startDate="",e.endDate="",e.startDateUsed=!1,e.endDateUsed=!1,e.roundUsed=!1,e.rounds=[],e.customRound="",this.updateScheduleConfig(e),t&&this.showNotification(`รีเซ็ต ${e.name} แล้ว`,"success")},applyTemplate(e){confirm(`คุณต้องการใช้เทมเพลต "${e.name}" หรือไม่? การตั้งค่าปัจจุบันจะถูกเขียนทับ`)&&(this.schedule.forEach((e=>{e.used=!1,this.resetScheduleItem(e,!1)})),e.config.forEach((t=>{const s=this.schedule.find((e=>e.item===t));s&&(s.used=!0,e.withRounds&&(s.roundUsed=!0,s.rounds=[{name:"รอบที่ 1",StartDate:"",EndDate:"",StartDateUsed:!1,EndDateUsed:!1},{name:"รอบที่ 2",StartDate:"",EndDate:"",StartDateUsed:!1,EndDateUsed:!1}]),this.updateScheduleConfig(s))})),this.showNotification(`ใช้เทมเพลต "${e.name}" สำเร็จ`,"success"))},exportScheduleConfig(){const e={version:"1.0",timestamp:(new Date).toISOString(),scheduleConfig:this.scheduleConfig,metadata:{courseId:this.dataItem,activeCount:this.activeScheduleCount,roundCount:this.roundScheduleCount}},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`schedule-config-${this.dataItem}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),this.showNotification("ส่งออกการตั้งค่าสำเร็จ","success")},importScheduleConfig(e){const t=e.target.files[0];if(!t)return;const s=new FileReader;s.onload=e=>{try{const t=JSON.parse(e.target.result);if(!t.scheduleConfig)throw new Error("Invalid file format");this.scheduleConfig=t.scheduleConfig,this.updateScheduleFromConfig(),this.showNotification("นำเข้าการตั้งค่าสำเร็จ","success")}catch(t){this.showNotification("ไฟล์ไม่ถูกต้อง กรุณาตรวจสอบรูปแบบไฟล์","error")}},s.readAsText(t),e.target.value=""},duplicateSchedule(e){const t=JSON.parse(JSON.stringify(e));t.name=`${e.name} (สำเนา)`,t.item=`${e.item}_copy_${Date.now()}`,this.schedule.push(t),this.showNotification(`สำเนา ${e.name} แล้ว`,"success")},removeRound(e,t){confirm("คุณต้องการลบรอบนี้หรือไม่?")&&(e.rounds.splice(t,1),this.updateScheduleConfig(e),this.showNotification("ลบรอบแล้ว","success"))},addCustomRound(e){if(e.customRound&&e.customRound.trim()){const t={name:e.customRound.trim(),StartDate:"",EndDate:"",StartDateUsed:!1,EndDateUsed:!1};e.rounds.push(t),e.customRound="",this.updateScheduleConfig(e),this.showNotification(`เพิ่มรอบ "${t.name}" แล้ว`,"success")}},showNotification(e,t="success"){const s={id:++this.notificationId,message:e,type:t,show:!0};this.notifications.push(s),setTimeout((()=>{this.hideNotification(s.id)}),5e3)},hideNotification(e){const t=this.notifications.findIndex((t=>t.id===e));t>-1&&this.notifications.splice(t,1)},async loadScheduleConfig(){this.isLoading=!0;try{const{data:e,status:t}=await this.$Request.GET(`course/${this.dataItem}`,this.configs.key);200===t&&(this.scheduleConfig=e.scheduleConfig||[],this.updateScheduleFromConfig(),console.log("Schedule config loaded:",this.scheduleConfig),this.showNotification("โหลดข้อมูลตารางเวลาสำเร็จ","success"))}catch(e){console.error("Error loading schedule config:",e),this.showNotification("เกิดข้อผิดพลาดในการโหลดข้อมูล","error")}finally{this.isLoading=!1}},async updateScheduleConfig(e){try{console.log("Updating schedule config:",JSON.stringify(this.scheduleConfig,null,2)),e.used?this.autoExpandSchedule(e,!0):this.autoCollapseSchedule(e,!0);const t=this.scheduleConfig.findIndex((t=>t.item===e.item)),s={item:e.item,use:e.used,startDate:e.startDateUsed?e.startDate?.dateTime||e.startDate:null,endDate:e.endDateUsed?e.endDate?.dateTime||e.endDate:null,round:e.roundUsed,rounds:e.rounds.map((e=>({name:e.name,StartDate:e.StartDateUsed?e.StartDate?.dateTime||e.StartDate:null,EndDate:e.EndDateUsed?e.EndDate?.dateTime||e.EndDate:null})))};e.used?-1===t?this.scheduleConfig.push(s):this.scheduleConfig[t]=s:-1!==t&&this.scheduleConfig.splice(t,1);const a={data:{scheduleConfig:this.scheduleConfig}},{status:o}=await this.$Request.PUT(`course/${this.dataItem}`,a,this.configs.key);200===o&&console.log("Schedule config updated successfully")}catch(t){console.error("Error updating schedule config:",t),this.showNotification("เกิดข้อผิดพลาดในการบันทึก","error")}},completeStartDate(e,t){e.startDate=t,this.updateScheduleConfig({...e})},completeEndDate(e,t){e.endDate=t,this.updateScheduleConfig({...e})},updateRoundStartDate(e,t){console.log("Updating round start date:",e.name,"->",t);const s=this.schedule.find((t=>t.rounds.includes(e)));s&&(s.rounds=s.rounds.map((s=>s.name===e.name?{...s,StartDate:t,StartDateUsed:!0}:s)),this.updateScheduleConfig(s))},updateRoundEndDate(e,t){console.log("Updating round end date:",e.name,"->",t);const s=this.schedule.find((t=>t.rounds.includes(e)));s&&(s.rounds=s.rounds.map((s=>s.name===e.name?{...s,EndDate:t,EndDateUsed:!0}:s)),this.updateScheduleConfig(s))},updateScheduleFromConfig(){this.schedule.forEach(((e,t)=>{const s=this.scheduleConfig.find((t=>t.item===e.item));s&&(console.log(`Updating ${e.item} from scheduleConfig`,s),e.used=s.use,e.startDate=s.startDate||"",e.endDate=s.endDate||"",e.roundUsed=s.round,e.rounds=s.rounds||[],e.startDateUsed=!!s.startDate,e.endDateUsed=!!s.endDate,e.rounds.forEach((e=>{const t=s.rounds.find((t=>t.name===e.name));t&&(e.StartDate=t.StartDate||"",e.EndDate=t.EndDate||"",e.StartDateUsed=!!t.StartDate,e.EndDateUsed=!!t.EndDate)})),e.used&&!this.expandedSchedules.includes(t)&&this.expandedSchedules.push(t))}))},validateScheduleDates(e){if(e.startDateUsed&&e.endDateUsed&&e.startDate&&e.endDate){const t=new Date(e.startDate.dateTime||e.startDate),s=new Date(e.endDate.dateTime||e.endDate);if(t>=s)return this.showNotification("วันเริ่มต้นต้องมาก่อนวันสิ้นสุด","error"),!1}return!0},validateRoundDates(e){if(e.StartDateUsed&&e.EndDateUsed&&e.StartDate&&e.EndDate){const t=new Date(e.StartDate.dateTime||e.StartDate),s=new Date(e.EndDate.dateTime||e.EndDate);if(t>=s)return this.showNotification("วันเริ่มรอบต้องมาก่อนวันสิ้นสุดรอบ","error"),!1}return!0}},mounted(){this.loadScheduleConfig()}};const Jb=(0,rr.A)(Gb,[["render",$b],["__scopeId","data-v-9a81e6aa"]]);var Yb=Jb;const Zb={class:"max-w-full mx-auto"},ex={class:"space-y-0"},tx={class:"bg-white rounded-lg"},sx={class:"px-4 py-3 border-b border-gray-200"},ax={class:"flex items-center justify-between"},ox={class:"flex items-center space-x-3"},ix={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center"},rx={class:"text-base font-semibold text-gray-900"},nx={class:"text-xs text-gray-500"},lx={class:"flex items-center space-x-2"},cx={key:0,class:"bg-blue-50 border-l-4 border-blue-400 p-3"},dx={class:"bg-white rounded-lg shadow-sm border border-gray-200"},ux={class:"bg-gray-100 border-b border-gray-200 px-4 py-2"},mx={class:"flex items-center justify-between"},gx={class:"text-sm text-gray-600"},px={class:"flex items-center space-x-2"},hx={class:"divide-y divide-gray-200"},bx={class:"px-4 py-4 sm:px-6"},xx={class:"flex justify-between items-center"},yx={class:"flex items-center space-x-3"},fx=["onClick"],kx={class:"flex items-center space-x-3 text-sm"},vx=["onClick"],wx=["onClick"],Lx=["onClick"],Cx=["onClick"],Dx={key:0,class:"mt-4"},Sx={class:"bg-gray-50 rounded-lg border border-gray-200"},Fx={class:"bg-gray-100 border-b border-gray-200 p-3"},Ix={class:"flex items-center justify-between"},Ex={class:"flex items-center space-x-2"},$x={class:"text-xs text-gray-600 mt-1"},_x={class:"flex space-x-2"},Px=["onClick"],Tx={class:"p-3"},Ax={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Xx={class:"flex flex-col"},jx={class:"bg-[#dfe9ff] flex justify-between items-center p-2 border-b border-gray-200"},Ux={class:"flex-grow px-2"},Bx={class:"text-center font-bold text-sm"},Ox={class:"flex space-x-1"},Qx=["onClick","disabled"],Mx=["onClick","disabled"],Vx=["onClick"],Rx={class:"p-3 space-y-3"},Wx={class:"relative"},Nx=["onUpdate:modelValue"],qx={class:"relative"},Kx=["onUpdate:modelValue"],Hx={class:"relative"},zx=["onUpdate:modelValue"],Gx={class:"p-3 border-t border-gray-200"},Jx=["onClick"],Yx=["onUpdate:modelValue"],Zx=["onClick"],ey={key:0,class:"flex justify-center items-center py-4 mx-6"},ty={key:1,class:"flex justify-center items-center py-4 mx-6"},sy={class:"flex items-center gap-2 text-green-600"},ay={class:"text-xs font-medium"},oy={key:2,class:"flex justify-center items-center py-3 mx-6"},iy={class:"flex flex-col items-center gap-2"},ry={class:"flex items-center gap-2 text-gray-500 text-xs"},ny={class:"flex gap-2"},ly=["disabled"],cy={key:1,class:"bg-white"},dy={key:2,class:"bg-white"};function uy(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon"),d=(0,a.g2)("icon-picker"),u=(0,a.g2)("data-status"),m=(0,a.g2)("data-submit");return(0,a.uX)(),(0,a.CE)("div",Zb,[(0,a.Lk)("div",ex,[(0,a.Lk)("div",tx,[(0,a.Lk)("div",sx,[(0,a.Lk)("div",ax,[(0,a.Lk)("div",ox,[(0,a.Lk)("div",ix,[(0,a.bF)(n,{icon:["fas","square-check"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[(0,a.Lk)("h2",rx,"แบบฟอร์ม ("+(0,l.v_)(s.examCount)+")",1),(0,a.Lk)("p",nx,(0,l.v_)(s.courseData.formID)+" - "+(0,l.v_)(i.loadStatus),1)])]),(0,a.Lk)("div",lx,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=e=>r.toggleExpandForm()),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(n,{icon:i.expandedForm?["fas","caret-up"]:["fas","caret-down"],class:"mr-1.5"},null,8,["icon"]),t[5]||(t[5]=(0,a.eW)(" เลือกแบบฟอร์ม "))])])])]),i.expandedForm?((0,a.uX)(),(0,a.CE)("div",cx,[(0,a.Lk)("div",dx,[(0,a.Lk)("div",ux,[(0,a.Lk)("div",mx,[(0,a.Lk)("div",gx," แสดง "+(0,l.v_)(r.visibleForm.length)+" จาก "+(0,l.v_)(i.form.length)+" แบบฟอร์ม ",1),(0,a.Lk)("div",px,[(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.toggleLazyMode&&r.toggleLazyMode(...e)),class:(0,l.C4)(["px-3 py-1 text-white text-xs font-semibold rounded shadow transition-colors",[i.lazy?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"]])},[t[6]||(t[6]=(0,a.Lk)("i",{class:"fas fa-rocket mr-1"},null,-1)),(0,a.eW)(" "+(0,l.v_)(i.lazy?"Progressive (เปิด)":"แสดงทั้งหมด (ปิด)"),1)],2)])])]),(0,a.Lk)("div",hx,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.visibleForm,((o,u)=>((0,a.uX)(),(0,a.CE)("div",{key:o._id,class:"bg-white"},[(0,a.Lk)("div",bx,[(0,a.Lk)("div",xx,[(0,a.Lk)("div",yx,[(0,a.Lk)("a",{class:"font-bold text-gray-900 cursor-pointer hover:text-blue-600",onClick:e=>r.toggleExpand(o._id)},(0,l.v_)(u+1)+"."+(0,l.v_)(o.title),9,fx)]),(0,a.Lk)("div",kx,[(0,a.Lk)("button",{onClick:e=>r.setDefaultForm(o._id),class:(0,l.C4)([{"text-green-500":o.default,"text-gray-400":!o.default},"inline-flex items-center"])},[(0,a.bF)(n,{icon:["fas","bookmark"],class:(0,l.C4)([{"text-green-500":o.default,"text-gray-400":!o.default},"mr-1"])},null,8,["class"]),t[7]||(t[7]=(0,a.eW)(" Set Default "))],10,vx),t[10]||(t[10]=(0,a.Lk)("span",{class:"font-medium text-gray-300"},"·",-1)),(0,a.Lk)("button",{onClick:e=>r.toggleAssignForm(o._id,u),type:"button",class:(0,l.C4)([{"text-red-500":s.courseData.formID===o._id},"inline-flex items-center font-medium text-gray-900"])},[(0,a.bF)(n,{icon:["far","circle-check"],class:(0,l.C4)([{"text-gray-500":s.courseData.formID!==o._id},"mr-1"])},null,8,["class"]),(0,a.eW)(" "+(0,l.v_)(r.isFormAssigned(o._id)?"Unassign":"Assign"),1)],10,wx),t[11]||(t[11]=(0,a.Lk)("span",{class:"font-medium text-gray-300"},"·",-1)),(0,a.Lk)("button",{onClick:t=>e.$router.push("/lesson/exam/edit/"+o._id+"/"+s.dataItem),type:"button",class:"inline-flex items-center font-medium text-gray-900"},[(0,a.bF)(n,{icon:["fas","pencil"],class:"text-gray-500 mr-1"}),t[8]||(t[8]=(0,a.eW)(" แก้ไข "))],8,Lx),t[12]||(t[12]=(0,a.Lk)("span",{class:"font-medium text-gray-300"},"·",-1)),(0,a.Lk)("button",{onClick:t=>e.deleteExam(o._id,u),type:"button",class:"inline-flex items-center font-medium text-gray-900"},[(0,a.bF)(n,{icon:["fas","trash"],class:"text-gray-500 mr-1"}),t[9]||(t[9]=(0,a.eW)(" ลบ "))],8,Cx)])]),i.expandedStatus[o._id]?((0,a.uX)(),(0,a.CE)("div",Dx,[(0,a.Lk)("div",Sx,[(0,a.Lk)("div",Fx,[(0,a.Lk)("div",Ix,[(0,a.Lk)("div",null,[(0,a.Lk)("div",Ex,[(0,a.bF)(n,{icon:["fas","cogs"],class:"text-gray-600"}),t[13]||(t[13]=(0,a.Lk)("p",{class:"font-bold text-sm text-gray-900"},"จัดการสถานะการทำรายการ",-1))]),(0,a.Lk)("pre",$x,(0,l.v_)(i.statusArray),1)]),(0,a.Lk)("div",_x,[(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.addStatus&&r.addStatus(...e)),class:"inline-flex items-center px-3 py-1.5 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-1.5"}),t[14]||(t[14]=(0,a.eW)(" เพิ่มสถานะใหม่ "))]),(0,a.Lk)("button",{onClick:e=>r.saveFormStatus(o._id),class:"inline-flex items-center px-3 py-1.5 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(n,{icon:["fas","save"],class:"mr-1.5"}),t[15]||(t[15]=(0,a.eW)(" บันทึกข้อมูล "))],8,Px)])])]),(0,a.Lk)("div",Tx,[(0,a.Lk)("div",Ax,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.statusArray,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{class:"bg-white border border-gray-200 rounded-sm shadow-sm",key:s},[(0,a.Lk)("div",Xx,[(0,a.Lk)("div",jx,[(0,a.bF)(d,{modelValue:e.icon,"onUpdate:modelValue":t=>e.icon=t,statusIndex:s,icon:e.icon,onInput:r.updateIcon,class:"relative bg-white"},null,8,["modelValue","onUpdate:modelValue","statusIndex","icon","onInput"]),(0,a.Lk)("div",Ux,[(0,a.Lk)("div",Bx,(0,l.v_)(e.name),1)]),(0,a.Lk)("div",Ox,[(0,a.Lk)("button",{onClick:e=>r.moveStatusUp(s),disabled:0===s,class:"p-1 text-black text-sm hover:bg-blue-100 rounded"},[(0,a.bF)(n,{icon:["fas","chevron-left"]})],8,Qx),(0,a.Lk)("button",{onClick:e=>r.moveStatusDown(s),disabled:s===i.statusArray.length-1,class:"p-1 text-black text-sm hover:bg-blue-100 rounded"},[(0,a.bF)(n,{icon:["fas","chevron-right"]})],8,Mx),(0,a.Lk)("button",{onClick:e=>r.deleteStatus(s),class:"p-1 text-black text-sm hover:bg-red-100 rounded"},[(0,a.bF)(n,{icon:["fas","trash"]})],8,Vx)])]),(0,a.Lk)("div",Rx,[(0,a.Lk)("div",Wx,[t[16]||(t[16]=(0,a.Lk)("span",{class:"input-label"},[(0,a.eW)("ชื่อสถานะ "),(0,a.Lk)("small",{class:"text-red-400"},"(*จำเป็นต้องกรอก)")],-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t=>e.name=t,type:"text",placeholder:"ชื่อสถานะ",class:"w-full p-2 border border-gray-200 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,Nx),[[c.Jo,e.name]])]),(0,a.Lk)("div",qx,[t[17]||(t[17]=(0,a.Lk)("span",{class:"input-label"},"รหัสสถานะ",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t=>e.code=t,type:"text",placeholder:"รหัสสถานะ",class:"w-full p-2 border border-gray-200 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,Kx),[[c.Jo,e.code]])]),(0,a.Lk)("div",Hx,[t[18]||(t[18]=(0,a.Lk)("span",{class:"input-label"},"คำอธิบาย",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t=>e.description=t,type:"text",placeholder:"คำอธิบาย",class:"w-full p-2 border border-gray-200 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,8,zx),[[c.Jo,e.description]])])]),(0,a.Lk)("div",Gx,[(0,a.Lk)("button",{onClick:e=>r.addOption(s),class:"w-full px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors"}," ตั้งค่าเพิ่มเติม ",8,Jx),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.options,((t,o)=>((0,a.uX)(),(0,a.CE)("div",{key:o,class:"flex items-center mt-2 space-x-2"},[(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.options[o]=t,class:"flex-1 p-2 border border-gray-200 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Option"},null,8,Yx),[[c.Jo,e.options[o]]]),(0,a.Lk)("button",{onClick:e=>r.deleteOption(s,o),class:"px-3 py-2 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition-colors"}," Delete ",8,Zx)])))),128))])])])))),128))])])])])):(0,a.Q3)("",!0)])])))),128))])])])):(0,a.Q3)("",!0)]),i.lazy&&i.expandedForm?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[i.isLoadingMore?((0,a.uX)(),(0,a.CE)("div",ey,t[19]||(t[19]=[(0,a.Lk)("div",{class:"flex items-center gap-3 text-blue-600"},[(0,a.Lk)("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),(0,a.Lk)("span",{class:"text-xs font-medium"},"กำลังโหลดแบบฟอร์มเพิ่ม...")],-1)]))):!r.hasMoreItems&&i.form.length>i.initialDisplayCount?((0,a.uX)(),(0,a.CE)("div",ty,[(0,a.Lk)("div",sy,[t[20]||(t[20]=(0,a.Lk)("i",{class:"fas fa-check-circle text-sm"},null,-1)),(0,a.Lk)("span",ay,"แสดงครบทั้งหมด "+(0,l.v_)(i.form.length)+" แบบฟอร์มแล้ว",1)])])):r.hasMoreItems&&i.expandedForm?((0,a.uX)(),(0,a.CE)("div",oy,[(0,a.Lk)("div",iy,[(0,a.Lk)("div",ry,[t[21]||(t[21]=(0,a.Lk)("i",{class:"fas fa-mouse"},null,-1)),(0,a.Lk)("span",null,"เลื่อนลงเพื่อดูแบบฟอร์มเพิ่ม (เหลือ "+(0,l.v_)(i.form.length-i.currentDisplayCount)+" รายการ)",1)]),(0,a.Lk)("div",ny,[(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.loadMoreItems&&r.loadMoreItems(...e)),class:"px-2 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700 transition-colors",disabled:i.isLoadingMore},[t[22]||(t[22]=(0,a.Lk)("i",{class:"fas fa-plus mr-1"},null,-1)),(0,a.eW)(" โหลดเพิ่ม (+"+(0,l.v_)(i.loadMoreCount)+") ",1)],8,ly),(0,a.Lk)("button",{onClick:t[4]||(t[4]=e=>i.currentDisplayCount=i.form.length),class:"px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors",title:"กรณีที่ auto-scroll ไม่ทำงาน"},t[23]||(t[23]=[(0,a.Lk)("i",{class:"fas fa-eye mr-1"},null,-1),(0,a.eW)(" แสดงทั้งหมดเลย ")]))])])])):(0,a.Q3)("",!0)],64)):(0,a.Q3)("",!0),i.loadStatus?((0,a.uX)(),(0,a.CE)("div",cy,[(0,a.bF)(u,{"status-array":i.formStatus,"all-item-badge":i.allitemCount,"update-trigger":i.updateTrigger,"active-status":i.currentActiveStatus,onStatusSelected:r.handleStatusSelected,onUpdateStatus:r.handleStatusUpdate,debug:!1},null,8,["status-array","all-item-badge","update-trigger","active-status","onStatusSelected","onUpdateStatus"])])):(0,a.Q3)("",!0),i.loadStatus?((0,a.uX)(),(0,a.CE)("div",dy,[(0,a.bF)(m,{form:i.formAssign._id,course:s.courseData._id,parent:s.courseData,status:i.formAssign.status,"active-form-status":i.selectedStatusFromFirstChild,"return-form-status":i.returnStatusArray,onUpdateViewer:r.updateStatusViewer,debug:!1},null,8,["form","course","parent","status","active-form-status","return-form-status","onUpdateViewer"])])):(0,a.Q3)("",!0)])])}const my={key:0},gy={class:"tab-navigation"},py={class:"tab-header pt-5 pl-3 pr-2 bg-gray-100 border-t border-gray-300"},hy={class:"tab-area flex"},by={class:"tab-icon"},xy={class:"flex flex-col"},yy={class:"status-name"},fy={key:0,class:"tab-badge ml-1"},ky=["onClick"],vy={class:"tab-icon"},wy={class:"flex flex-col relative"},Ly={key:0,class:"tab-badge"},Cy={class:"status-description text-xs text-gray-400 single-line-ellipsis"},Dy={class:"mobile-navigation"},Sy={class:"dropdown-selected"},Fy={class:"flex justify-between"},Iy={class:"flex"},Ey={class:"tab-icon"},$y={class:"flex flex-col"},_y={class:"status-name active-tab font-bold"},Py={key:0,class:"tab-badge"},Ty={class:"status-description text-xs text-gray-400 single-line-ellipsis"},Ay={class:"tab-icon icon-line"},Xy={class:"dropdown-content"},jy={class:"flex items-center"},Uy={class:"flex flex-col"},By={class:"status-name"},Oy={key:0,class:"tab-badge ml-2"},Qy=["onClick"],My={class:"flex justify-between"},Vy={class:"flex"},Ry={class:"tab-icon"},Wy={class:"flex flex-col"},Ny={class:"status-description text-xs text-gray-400 single-line-ellipsis"},qy={class:"tab-icon icon-line"},Ky={key:0,class:"tab-badge"},Hy={key:0},zy={key:0},Gy={key:1},Jy={key:0},Yy={key:0},Zy={key:1};function ef(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon");return s.statusArray&&s.statusArray.length>0?((0,a.uX)(),(0,a.CE)("div",my,[(0,a.Lk)("div",gy,[(0,a.Lk)("div",py,[t[8]||(t[8]=(0,a.Lk)("div",{class:"tab-line"},null,-1)),(0,a.Lk)("div",hy,[(0,a.Lk)("div",{class:(0,l.C4)(["tab-item py-2 px-4 cursor-pointer mr-1 flex",{"bg-white text-gray-700 z-50 rounded-t-sm border-t border-gray-300 border-l border-gray-300 border-r border-gray-300 shadow-[rgba(0,0,15,0.5)_1px_-4px_13px_-11px] active-tab":i.isAllSelected,"bg-gray-200 text-gray-600 rounded-t-sm border-t border-gray-300 border-l border-gray-300 border-r border-gray-300 border-b border-gray-300":!i.isAllSelected}]),onClick:t[0]||(t[0]=e=>r.setCurrentStatusAll())},[(0,a.Lk)("div",by,[(0,a.bF)(n,{icon:["fas","icons"],class:"text-sm mr-2"})]),(0,a.Lk)("div",xy,[(0,a.Lk)("div",yy,[t[6]||(t[6]=(0,a.eW)((0,l.v_)("All")+" ")),s.allItemBadge?((0,a.uX)(),(0,a.CE)("span",fy,(0,l.v_)(s.allItemBadge),1)):(0,a.Q3)("",!0)]),t[7]||(t[7]=(0,a.Lk)("div",{class:"status-description text-xs text-gray-400"},"ทั้งหมด",-1))])],2),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.statusArray,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,onClick:t=>r.setCurrentStatus(e),class:(0,l.C4)({"tab-item":!0,"py-2 px-4 cursor-pointer mr-1 flex":!0,"bg-white text-gray-700 z-50 rounded-t-sm border-t border-gray-300 border-l border-gray-300 border-r border-gray-300 shadow-[rgba(0,0,15,0.5)_1px_-4px_13px_-11px]":e===r.currentStatus,"bg-gray-200 text-gray-600 rounded-t-sm border-t border-gray-300 border-l border-gray-300 border-r border-gray-300 border-b border-gray-300":e!==r.currentStatus,"active-tab":e===r.currentStatus}),style:{"max-width":"calc(70% - 5px)"}},[(0,a.Lk)("div",vy,[(0,a.bF)(n,{icon:["fas",e.icon],class:"text-sm mr-2"},null,8,["icon"])]),(0,a.Lk)("div",wy,[(0,a.Lk)("div",null,[(0,a.Lk)("div",{class:(0,l.C4)(["status-name",{"font-normal":e.code===r.currentStatus.code}])},[(0,a.eW)((0,l.v_)(e.name)+" ",1),null!==e.badge?((0,a.uX)(),(0,a.CE)("span",Ly,(0,l.v_)(e.badge),1)):(0,a.Q3)("",!0)],2)]),(0,a.Lk)("div",Cy,(0,l.v_)(e.description),1)])],10,ky)))),128))])])]),(0,a.Lk)("div",Dy,[(0,a.Lk)("div",{class:"dropdown",onClick:t[2]||(t[2]=e=>i.dropdownOpen=!i.dropdownOpen)},[(0,a.Lk)("div",Sy,[(0,a.Lk)("div",Fy,[(0,a.Lk)("div",Iy,[(0,a.Lk)("div",Ey,[(0,a.bF)(n,{icon:["fas",r.currentStatus.icon],class:"text-sm mr-2"},null,8,["icon"])]),(0,a.Lk)("div",$y,[(0,a.Lk)("div",null,[(0,a.Lk)("div",_y,[(0,a.eW)((0,l.v_)(r.currentStatus.name)+" ",1),null!==r.currentStatus.badge?((0,a.uX)(),(0,a.CE)("span",Py,(0,l.v_)(r.currentStatus.badge),1)):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",Ty,(0,l.v_)(r.currentStatus.description),1)])]),(0,a.Lk)("div",Ay,[(0,a.bF)(n,{icon:i.dropdownOpen?["fas","caret-up"]:["fas","caret-down"],class:"text-sm ml-2"},null,8,["icon"])])])]),(0,a.bo)((0,a.Lk)("div",Xy,[(0,a.Lk)("div",{class:"dropdown-item flex justify-between items-center",onClick:t[1]||(t[1]=e=>r.setCurrentStatusAll())},[(0,a.Lk)("div",jy,[(0,a.bF)(n,{icon:["fas","icons"],class:"text-sm mr-2"}),(0,a.Lk)("div",Uy,[(0,a.Lk)("div",By,[t[9]||(t[9]=(0,a.eW)((0,l.v_)("All")+" ")),e.badgeContent?((0,a.uX)(),(0,a.CE)("span",Oy,(0,l.v_)(e.badgeContent),1)):(0,a.Q3)("",!0)]),t[10]||(t[10]=(0,a.Lk)("div",{class:"status-description text-xs text-gray-400"},"ทั้งหมด",-1))])])]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.statusArray,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{class:"dropdown-item",key:t,onClick:t=>r.setCurrentStatus(e)},[(0,a.Lk)("div",My,[(0,a.Lk)("div",Vy,[(0,a.Lk)("div",Ry,[(0,a.bF)(n,{icon:["fas",e.icon],class:"text-sm mr-2"},null,8,["icon"])]),(0,a.Lk)("div",Wy,[(0,a.Lk)("div",{class:(0,l.C4)(["status-name",{"font-bold":e.code===r.currentStatus.code}])},(0,l.v_)(e.name),3),(0,a.Lk)("div",Ny,(0,l.v_)(e.description),1)])]),(0,a.Lk)("div",qy,[null!==e.badge?((0,a.uX)(),(0,a.CE)("span",Ky,(0,l.v_)(e.badge),1)):(0,a.Q3)("",!0)])])],8,Qy)))),128))],512),[[c.aG,i.dropdownOpen]])])]),s.debug?((0,a.uX)(),(0,a.CE)("div",Hy,[t[20]||(t[20]=(0,a.Lk)("h1",null,"Status Viewer",-1)),(0,a.Lk)("div",null,[t[11]||(t[11]=(0,a.Lk)("label",{for:"statusCode"},"Enter Status Code:",-1)),(0,a.bo)((0,a.Lk)("input",{id:"statusCode",type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>i.inputCode=e),onInput:t[4]||(t[4]=(...e)=>r.calculatePercentage&&r.calculatePercentage(...e))},null,544),[[c.Jo,i.inputCode]]),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>r.getStatusByCode&&r.getStatusByCode(...e))},"Get")]),t[21]||(t[21]=(0,a.eW)(" Status Item :: ")),t[22]||(t[22]=(0,a.Lk)("br",null,null,-1)),(0,a.Lk)("pre",null,(0,l.v_)(s.statusArray),1),(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.statusArray,((e,o)=>((0,a.uX)(),(0,a.CE)("li",{key:o},[t[13]||(t[13]=(0,a.Lk)("strong",null,"Status Name:",-1)),(0,a.eW)(" "+(0,l.v_)(e.name)+" ",1),(0,a.Lk)("p",null,[t[12]||(t[12]=(0,a.Lk)("strong",null,"Code:",-1)),(0,a.eW)(" "+(0,l.v_)(e.code),1)]),(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.options,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t},[(0,a.Lk)("strong",null,"Option "+(0,l.v_)(t+1)+":",1),(0,a.eW)(" "+(0,l.v_)(e),1)])))),128))]),null!==r.statusIndices[o].prev?((0,a.uX)(),(0,a.CE)("div",zy,"Previous Status Code: "+(0,l.v_)(s.statusArray[r.statusIndices[o].prev].code),1)):(0,a.Q3)("",!0),null!==r.statusIndices[o].next?((0,a.uX)(),(0,a.CE)("div",Gy,"Next Status Code: "+(0,l.v_)(s.statusArray[r.statusIndices[o].next].code),1)):(0,a.Q3)("",!0)])))),128))]),t[23]||(t[23]=(0,a.Lk)("br",null,null,-1)),t[24]||(t[24]=(0,a.Lk)("br",null,null,-1)),null!==r.currentStatus?((0,a.uX)(),(0,a.CE)("div",Jy,[t[16]||(t[16]=(0,a.Lk)("strong",null,"Status Name:",-1)),(0,a.eW)(" "+(0,l.v_)(r.currentStatus.name)+" ",1),(0,a.Lk)("p",null,[t[14]||(t[14]=(0,a.Lk)("strong",null,"Code:",-1)),(0,a.eW)(" "+(0,l.v_)(r.currentStatus.code),1)]),(0,a.Lk)("p",null,[t[15]||(t[15]=(0,a.Lk)("strong",null,"Percentage:",-1)),(0,a.eW)(" "+(0,l.v_)(i.percentage)+"%",1)]),(0,a.Lk)("ul",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.currentStatus.options,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t},[(0,a.Lk)("strong",null,"Option "+(0,l.v_)(t+1)+":",1),(0,a.eW)(" "+(0,l.v_)(e),1)])))),128))])])):(0,a.Q3)("",!0),(0,a.Lk)("div",null,[(0,a.Lk)("p",null,[t[17]||(t[17]=(0,a.Lk)("strong",null,"Total Statuses:",-1)),(0,a.eW)(" "+(0,l.v_)(s.statusArray.length),1)]),s.statusArray.length>0?((0,a.uX)(),(0,a.CE)("p",Yy,[t[18]||(t[18]=(0,a.Lk)("strong",null,"First Status Code:",-1)),(0,a.eW)(" "+(0,l.v_)(s.statusArray[0].code),1)])):(0,a.Q3)("",!0),s.statusArray.length>0?((0,a.uX)(),(0,a.CE)("p",Zy,[t[19]||(t[19]=(0,a.Lk)("strong",null,"Last Status Code:",-1)),(0,a.eW)(" "+(0,l.v_)(s.statusArray[s.statusArray.length-1].code),1)])):(0,a.Q3)("",!0)])])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)}var tf={props:{statusArray:Array,allItemBadge:Number,debug:Boolean,activeStatus:String},data(){return{dropdownOpen:!1,inputCode:"",percentage:0,selectedStatus:this.statusArray.length>0?this.statusArray[0]:null,isAllSelected:!0}},computed:{statusIndices(){return this.calculateStatusIndices()},currentStatus(){return this.isAllSelected?{name:"All",code:"all",icon:"icons",description:"ทั้งหมด",badge:this.allItemBadge}:this.selectedStatus}},created(){this.statusArray.length>0&&(this.$emit("status-selected",{all:!0,statuses:this.statusArray}),this.updateStatusObject())},watch:{activeStatus(e){this.setCurrentStatusByCode(e)}},methods:{setCurrentStatusByCode(e){if("all"===e)this.setCurrentStatusAll();else{const t=this.statusArray.find((t=>t.code===e));t&&this.setCurrentStatus(t)}},updateStatusObject(){const e=this.statusArray.length;if(this.isAllSelected){const t={first:this.statusArray[0]?this.statusArray[0].code:null,next:this.statusArray[0]?this.statusArray[0].code:null,prev:null,last:this.statusArray[e-1]?this.statusArray[e-1].code:null,total:e,current:"All"};this.$emit("update-status",t)}else{const t=this.statusArray.findIndex((e=>e.code===this.selectedStatus.code)),s={first:this.statusArray[0]?this.statusArray[0].code:null,next:t<e-1?this.statusArray[t+1].code:null,prev:t>0?this.statusArray[t-1].code:null,last:this.statusArray[e-1]?this.statusArray[e-1].code:null,total:e,current:this.selectedStatus?this.selectedStatus.code:null};this.$emit("update-status",s)}},setCurrentStatusAll(){this.isAllSelected=!0,this.selectedStatus=null,this.$emit("status-selected","all"),this.updateStatusObject()},setCurrentStatus(e){this.isAllSelected=!1,this.selectedStatus=e,this.calculatePercentage(e.code),this.getStatusByCode(e.code),console.log("status",e),this.$emit("status-selected",this.selectedStatus),this.updateStatusObject()},calculateStatusIndices(){const e=[],t=this.statusArray.length;for(let s=0;s<t;s++){const a=0===s?null:s-1,o=s===t-1?null:s+1;e.push({prev:a,next:o})}return e},calculatePercentage(e){if(Array.isArray(this.statusArray)){const t=this.statusArray.find((t=>t.code===e));if(t){const e=this.statusArray.indexOf(t);this.percentage=(e+1)/this.statusArray.length*100}else this.percentage=0}},getStatusByCode(e){this.selectedStatus=this.statusArray.find((t=>t.code===e))||null}}};const sf=(0,rr.A)(tf,[["render",ef],["__scopeId","data-v-5baf295c"]]);var af=sf;const of={class:"w-full bg-gradient-to-br from-gray-50 via-white to-gray-50 min-h-screen"},rf={key:0,class:"flex justify-center py-8"},nf={class:"flex flex-col items-center space-y-2"},lf={key:1,class:"space-y-3 p-3"},cf={class:"bg-white border border-gray-200/50 rounded-lg shadow-sm"},df={class:"px-4 py-2.5 border-b border-gray-100/50 bg-gradient-to-r from-slate-50 to-gray-50"},uf={class:"flex items-center justify-between"},mf={class:"flex items-center space-x-2"},gf={class:"w-7 h-7 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center shadow-sm"},pf={class:"text-lg font-medium text-gray-900"},hf={class:"flex items-center space-x-2"},bf=["disabled"],xf={key:0,class:"bg-gradient-to-r from-blue-50 to-indigo-50 px-4 py-2 border-l-2 border-indigo-400"},yf={class:"flex items-center justify-between"},ff={class:"flex items-center space-x-2"},kf={class:"w-5 h-5 bg-indigo-100 rounded-full flex items-center justify-center"},vf={class:"text-sm text-indigo-800"},wf={key:0,class:"font-medium"},Lf={key:1,class:"font-medium"},Cf={key:0,class:"w-32"},Df={class:"w-full bg-indigo-200 rounded-full h-1.5 shadow-inner"},Sf={key:0,class:"bg-white/70 backdrop-blur-sm border border-gray-200/50 rounded-lg shadow-sm"},Ff={class:"px-4 py-2 bg-gradient-to-r from-emerald-50 to-teal-50 border-b border-gray-100/50"},If={class:"flex items-center space-x-2"},Ef={class:"w-6 h-6 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center shadow-sm"},$f={class:"text-sm text-gray-600"},_f={class:"font-medium text-emerald-600"},Pf={class:"p-3 bg-gradient-to-br from-white to-gray-50"},Tf={class:"flex justify-center space-x-2"},Af=["disabled"],Xf=["disabled"],jf=["disabled"],Uf={class:"mt-2 text-center"},Bf={class:"inline-flex items-center px-2 py-1 bg-gray-100 rounded-full"},Of={class:"text-sm text-gray-700 font-medium"},Qf={class:"bg-white/70 backdrop-blur-sm border border-gray-200/50 rounded-lg shadow-sm"},Mf={class:"px-4 py-2 bg-gradient-to-r from-amber-50 to-orange-50 border-b border-gray-100/50"},Vf={class:"flex flex-col md:flex-row md:items-center justify-between space-y-2 md:space-y-0"},Rf={class:"flex-1 max-w-md"},Wf={class:"relative group"},Nf={class:"absolute inset-y-0 left-0 pl-2.5 flex items-center pointer-events-none"},qf={key:0,class:"mt-1 flex items-center space-x-1"},Kf={class:"text-sm text-gray-600"},Hf={class:"font-medium text-indigo-600"},zf={class:"flex items-center space-x-2"},Gf=["value"],Jf={class:"bg-white/80 backdrop-blur-sm rounded-lg shadow-sm border border-gray-200/50"},Yf={class:"bg-white/70 backdrop-blur-sm border border-gray-200/50 rounded-lg shadow-sm"},Zf={class:"px-4 py-2 bg-gradient-to-r from-amber-50 to-orange-50 border-b border-gray-100/50"},ek={class:"flex items-center justify-between"},tk={class:"flex items-center space-x-2"},sk={class:"w-6 h-6 bg-gradient-to-br from-slate-600 to-gray-700 rounded-lg flex items-center justify-center shadow-sm"},ak={class:"lg:hidden"},ok={class:"divide-y divide-gray-100"},ik=["onClick"],rk={class:"flex items-center space-x-2"},nk=["value"],lk={class:"font-medium text-gray-900 text-sm"},ck={class:"text-sm text-gray-500 flex items-center space-x-1"},dk={class:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors duration-200"},uk={key:0,class:"px-4 py-2 bg-gradient-to-br from-gray-50 to-white"},mk={class:"space-y-2"},gk={class:"font-medium text-gray-700 w-1/3 text-sm"},pk={class:"text-gray-600 w-2/3 text-right text-sm"},hk={key:0},bk={key:0,class:"mt-3"},xk={class:"text-sm font-medium bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-800 px-2 py-1.5"},yk={key:0,class:"divide-y divide-gray-100"},fk={class:"text-sm font-medium bg-gray-50 text-gray-700 px-2 py-1"},kk={class:"px-2 py-1.5 space-y-1"},vk={class:"text-gray-600"},wk={class:"text-gray-900 font-medium"},Lk={class:"hidden lg:block"},Ck={key:0,class:"border-b border-gray-100 bg-gradient-to-r from-indigo-50 to-purple-50 p-3"},Dk={class:"grid grid-cols-3 gap-3"},Sk={key:0,class:"flex items-center justify-between p-2 bg-white/80 backdrop-blur-sm rounded-md border border-gray-200/50 shadow-sm"},Fk={class:"flex items-center space-x-2"},Ik=["disabled","onUpdate:modelValue","checked","onChange"],Ek=["title"],$k={class:"flex space-x-0.5"},_k=["onClick","disabled"],Pk=["onClick","disabled"],Tk={class:"bg-gradient-to-r from-gray-50 to-slate-50 border-b border-gray-100"},Ak={class:"flex items-center"},Xk={class:"w-4/5"},jk={class:"flex"},Uk={class:"flex items-center space-x-2 px-4 py-2.5 text-sm font-medium text-gray-900"},Bk=["checked"],Ok=["title"],Qk={key:0,class:"absolute inset-0 bg-white/95 backdrop-blur-sm flex items-center justify-center z-10"},Mk={class:"w-4/5"},Vk={class:"flex"},Rk={class:"flex items-center space-x-2 px-4 py-2"},Wk=["value"],Nk={key:0,class:"flex-1 px-4 py-2"},qk={key:2,class:"flex items-center space-x-1"},Kk={key:4,class:"flex flex-wrap gap-0.5"},Hk={key:5,class:"inline-flex items-center px-2 py-0.5 rounded-full text-sm font-medium bg-emerald-100 text-emerald-800"},zk=["onClick"],Gk=["src"],Jk={class:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg flex items-center justify-center"},Yk={class:"w-1/5"},Zk={class:"flex"},ev={class:"flex-1 px-4 py-2 text-sm text-gray-500"},tv={class:"flex items-center space-x-1"},sv={class:"flex-1 px-4 py-2"},av={class:"flex space-x-1"},ov=["onClick"],iv=["onClick"],rv=["onClick"],nv={key:0,class:"flex justify-center items-center py-6 border-b border-gray-200"},lv={key:1,class:"flex justify-center items-center py-6 border-b border-gray-200"},cv={class:"flex items-center gap-2 text-green-600"},dv={class:"text-sm font-medium"},uv={key:2,class:"flex justify-center items-center py-4 border-b border-gray-200"},mv={class:"flex flex-col items-center gap-2"},gv={class:"flex items-center gap-2 text-gray-500 text-sm"},pv={class:"flex gap-2"},hv=["disabled"],bv={class:"px-4 py-2 border-t border-gray-100 bg-gradient-to-r from-gray-50 to-slate-50"},xv={class:"relative max-w-4xl max-h-full"},yv=["src"];function fv(e,t,s,o,i,r){const n=(0,a.g2)("Loader"),d=(0,a.g2)("font-awesome-icon"),u=(0,a.g2)("data-table"),m=(0,a.g2)("Pagination"),g=(0,a.g2)("ShortText"),p=(0,a.g2)("Address"),h=(0,a.g2)("data-set");return(0,a.uX)(),(0,a.CE)("div",of,[i.loading_sources?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",rf,[(0,a.Lk)("div",nf,[(0,a.bF)(n),t[17]||(t[17]=(0,a.Lk)("p",{class:"text-gray-600 text-sm"},"กำลังโหลดข้อมูล...",-1))])])),s.activeFormStatus?((0,a.uX)(),(0,a.CE)("div",lf,[(0,a.Lk)("div",cf,[(0,a.Lk)("div",df,[(0,a.Lk)("div",uf,[(0,a.Lk)("div",mf,[(0,a.Lk)("div",gf,[(0,a.bF)(d,{icon:["fas","file-alt"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[(0,a.Lk)("h2",pf,(0,l.v_)(s.activeFormStatus.name),1),t[18]||(t[18]=(0,a.Lk)("p",{class:"text-sm text-gray-600"},"จัดการข้อมูลการส่งแบบฟอร์ม",-1))])]),(0,a.Lk)("div",hf,[(0,a.bF)(u,{listItems:i.listItems,table:!1,export:!0,parent:s.parent,status:s.activeFormStatus.name,exportButtonText:"Export CSV"},null,8,["listItems","parent","status"]),i.totalItemsFetched>=i.totalItems&&!i.isLoading?((0,a.uX)(),(0,a.Wv)(u,{key:0,listItems:i.allListItems,table:!1,export:!0,parent:s.parent,status:s.activeFormStatus.name,exportButtonText:"Export All"},null,8,["listItems","parent","status"])):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.loadAllData&&r.loadAllData(...e)),disabled:i.isLoading||i.totalItemsFetched>=i.totalItems,class:"px-3 py-1.5 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white text-sm rounded-md transition-all duration-200 disabled:from-gray-400 disabled:to-gray-500 shadow-sm hover:shadow-md"},[(0,a.bF)(d,{icon:["fas","download"],class:"mr-1 text-sm"}),t[19]||(t[19]=(0,a.eW)(" Load All "))],8,bf)])])]),i.isLoading||i.totalItemsFetched>=i.totalItems&&!i.isLoading?((0,a.uX)(),(0,a.CE)("div",xf,[(0,a.Lk)("div",yf,[(0,a.Lk)("div",ff,[(0,a.Lk)("div",kf,[(0,a.bF)(d,{icon:["fas","info-circle"],class:"text-indigo-600 text-sm"})]),(0,a.Lk)("div",vf,[i.isLoading?((0,a.uX)(),(0,a.CE)("div",wf,[t[20]||(t[20]=(0,a.Lk)("strong",null,"กำลังโหลด:",-1)),(0,a.eW)(" "+(0,l.v_)(i.progress)+"% ("+(0,l.v_)(i.allListItems.length)+" รายการ) ",1)])):(0,a.Q3)("",!0),i.totalItemsFetched>=i.totalItems&&!i.isLoading?((0,a.uX)(),(0,a.CE)("div",Lf,[t[21]||(t[21]=(0,a.Lk)("strong",null,"เสร็จสิ้น:",-1)),(0,a.eW)(" "+(0,l.v_)(i.allListItems.length)+" รายการทั้งหมด ",1)])):(0,a.Q3)("",!0)])]),i.isLoading?((0,a.uX)(),(0,a.CE)("div",Cf,[(0,a.Lk)("div",Df,[(0,a.Lk)("div",{class:"bg-gradient-to-r from-indigo-500 to-purple-600 h-1.5 rounded-full transition-all duration-500 ease-out",style:(0,l.Tr)(`width: ${i.progress}%`)},null,4)])])):(0,a.Q3)("",!0)])])):(0,a.Q3)("",!0)]),i.selectedData.length>0?((0,a.uX)(),(0,a.CE)("div",Sf,[(0,a.Lk)("div",Ff,[(0,a.Lk)("div",If,[(0,a.Lk)("div",Ef,[(0,a.bF)(d,{icon:["fas","tasks"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[24]||(t[24]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900"},"การดำเนินการกับข้อมูลที่เลือก",-1)),(0,a.Lk)("p",$f,[t[22]||(t[22]=(0,a.eW)("เลือกแล้ว ")),(0,a.Lk)("span",_f,(0,l.v_)(i.selectedData.length),1),t[23]||(t[23]=(0,a.eW)(" รายการ"))])])])]),(0,a.Lk)("div",Pf,[(0,a.Lk)("div",Tf,[(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.prevItem&&r.prevItem(...e)),disabled:0===e.currentIndex,class:"px-3 py-1.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 disabled:from-gray-300 disabled:to-gray-400 text-white rounded-md transition-all duration-200 shadow-sm text-sm"},[(0,a.bF)(d,{icon:["fas","arrow-left"],class:"mr-1 text-sm"}),(0,a.eW)(" ย้ายไป "+(0,l.v_)(this.returnFormStatus?.prev),1)],8,Af),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.nextItem&&r.nextItem(...e)),disabled:e.currentIndex>=s.returnFormStatus?.length-1,class:"px-3 py-1.5 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 disabled:from-gray-300 disabled:to-gray-400 text-white rounded-md transition-all duration-200 shadow-sm text-sm"},[(0,a.bF)(d,{icon:["fas","arrow-right"],class:"mr-1 text-sm"}),(0,a.eW)(" เปลี่ยนเป็น "+(0,l.v_)(this.returnFormStatus?.next),1)],8,Xf),(0,a.Lk)("button",{onClick:t[3]||(t[3]=e=>r.assignItem("approve")),disabled:e.currentIndex>=s.returnFormStatus?.length-1,class:"px-3 py-1.5 bg-gradient-to-r from-purple-500 to-violet-600 hover:from-purple-600 hover:to-violet-700 disabled:from-gray-300 disabled:to-gray-400 text-white rounded-md transition-all duration-200 shadow-sm text-sm"},[(0,a.bF)(d,{icon:["fas","check-circle"],class:"mr-1 text-sm"}),t[25]||(t[25]=(0,a.eW)(" Enroll & Approve "))],8,jf),(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.deleteItem&&r.deleteItem(...e)),class:"px-3 py-1.5 bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white rounded-md transition-all duration-200 shadow-sm text-sm"},[(0,a.bF)(d,{icon:["fas","trash"],class:"mr-1 text-sm"}),t[26]||(t[26]=(0,a.eW)(" Delete "))])]),(0,a.Lk)("div",Uf,[(0,a.Lk)("div",Bf,[t[27]||(t[27]=(0,a.Lk)("div",{class:"w-2 h-2 bg-green-500 rounded-full mr-1 animate-pulse"},null,-1)),(0,a.Lk)("p",Of,"ประมวลผล: "+(0,l.v_)(i.successfullyProcessed)+"/"+(0,l.v_)(i.selectedData.length),1)])])])])):(0,a.Q3)("",!0),(0,a.Lk)("div",Qf,[(0,a.Lk)("div",Mf,[(0,a.Lk)("div",Vf,[(0,a.Lk)("div",Rf,[(0,a.Lk)("div",Wf,[(0,a.bo)((0,a.Lk)("input",{id:"search",type:"text",class:"w-full px-3 py-2 pl-8 pr-8 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 bg-white/80 backdrop-blur-sm shadow-sm text-sm",placeholder:"ค้นหาข้อมูล...","onUpdate:modelValue":t[5]||(t[5]=e=>i.searchQuery=e)},null,512),[[c.Jo,i.searchQuery]]),(0,a.Lk)("div",Nf,[(0,a.bF)(d,{icon:["fas","search"],class:"text-gray-400 text-sm group-hover:text-indigo-500 transition-colors duration-200"})]),i.searchQuery.length>0?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[6]||(t[6]=(...e)=>r.clearSearchQuery&&r.clearSearchQuery(...e)),class:"absolute inset-y-0 right-0 pr-2.5 flex items-center text-gray-400 hover:text-red-500 transition-colors duration-200"},[(0,a.bF)(d,{icon:["fas","times"],class:"text-sm"})])):(0,a.Q3)("",!0)]),i.searchQuery.length>0?((0,a.uX)(),(0,a.CE)("div",qf,[t[30]||(t[30]=(0,a.Lk)("div",{class:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"},null,-1)),(0,a.Lk)("p",Kf,[t[28]||(t[28]=(0,a.eW)(" ผลการค้นหา: ")),(0,a.Lk)("span",Hf,(0,l.v_)(i.totalItems),1),t[29]||(t[29]=(0,a.eW)(" รายการ "))])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",zf,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.limitItem=e),onChange:t[8]||(t[8]=(...e)=>r.handleLimitChange&&r.handleLimitChange(...e)),class:"px-2 py-1.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500 bg-white/80 backdrop-blur-sm shadow-sm"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.limitOptions,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,l.v_)(e)+" รายการ",9,Gf)))),128))],544),[[c.u1,i.limitItem]]),(0,a.Lk)("div",Jf,[(0,a.bF)(m,{"current-page":i.currentPage,"total-items":i.totalItems,"total-pages":i.totalPages,"limit-items":i.limitItem,"data-loading":i.loading,"display-mode":"nav",onPageChanged:r.handlePageChanged},null,8,["current-page","total-items","total-pages","limit-items","data-loading","onPageChanged"])])])])])]),(0,a.Lk)("div",Yf,[(0,a.Lk)("div",Zf,[(0,a.Lk)("div",ek,[(0,a.Lk)("div",tk,[(0,a.Lk)("div",sk,[(0,a.bF)(d,{icon:["fas","table"],class:"text-white text-sm"})]),t[31]||(t[31]=(0,a.Lk)("div",null,[(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900"},"ข้อมูลการส่งแบบฟอร์ม"),(0,a.Lk)("p",{class:"text-sm text-gray-600"},"แสดงข้อมูลแบบตาราง")],-1))]),(0,a.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>r.toggleHeaderPanel&&r.toggleHeaderPanel(...e)),class:"px-2 py-1.5 border border-gray-300 rounded-md text-sm text-gray-700 bg-white/80 backdrop-blur-sm hover:bg-gray-50 transition-all duration-200 shadow-sm flex items-center space-x-1"},[(0,a.bF)(d,{icon:["fas","cog"],class:"text-sm"}),t[32]||(t[32]=(0,a.Lk)("span",null,"ตั้งค่าคอลัมน์",-1))])])]),(0,a.Lk)("div",ak,[(0,a.Lk)("div",ok,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.visibleItems,((s,o)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:s._id},[(0,a.Lk)("div",{class:"px-4 py-2.5 flex justify-between items-center cursor-pointer hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 transition-all duration-200",onClick:e=>r.toggleDetail(o)},[(0,a.Lk)("div",rk,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=e=>i.selectedData=e),value:s._id,class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 w-3 h-3"},null,8,nk),[[c.lH,i.selectedData]]),(0,a.Lk)("div",null,[(0,a.Lk)("div",lk,(0,l.v_)(o+1)+". "+(0,l.v_)(r.getSummaryField(s.formData,0)),1),(0,a.Lk)("div",ck,[(0,a.bF)(d,{icon:["fas","calendar"],class:"text-gray-400 text-sm"}),(0,a.Lk)("span",null,(0,l.v_)(r.formatThaidate(s.createdAt)),1)])])]),(0,a.Lk)("div",dk,[(0,a.bF)(d,{icon:i.expandedItemIndex===o?"fas fa-chevron-up":"fas fa-chevron-down",class:"text-gray-500 text-sm"},null,8,["icon"])])],8,ik),i.expandedItemIndex===o?((0,a.uX)(),(0,a.CE)("div",uk,[(0,a.Lk)("div",mk,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.filteredFormData,((t,s)=>((0,a.uX)(),(0,a.CE)("div",{key:s,class:"flex justify-between items-start py-1.5 border-b border-gray-100 last:border-0"},[(0,a.Lk)("div",gk,(0,l.v_)(t.name),1),(0,a.Lk)("div",pk,["address"===t.type?((0,a.uX)(),(0,a.CE)("div",hk,(0,l.v_)(e.formatAddress(t.value)),1)):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.eW)((0,l.v_)(t.value),1)],64))])])))),128)),s.formData["setData"]?((0,a.uX)(),(0,a.CE)("div",bk,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.formData["setData"],((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:"border border-indigo-200 rounded-lg overflow-hidden shadow-sm"},[(0,a.Lk)("h4",xk,(0,l.v_)(t),1),Array.isArray(e)?((0,a.uX)(),(0,a.CE)("div",yk,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:`setDataKey-${t}`},[(0,a.Lk)("h5",fk,"ข้อมูลชุดที่ "+(0,l.v_)(t+1),1),(0,a.Lk)("div",kk,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.name,class:"flex justify-between items-center text-sm"},[(0,a.Lk)("span",vk,(0,l.v_)(e.name),1),(0,a.Lk)("span",wk,(0,l.v_)(e.value),1)])))),128))])])))),128))])):(0,a.Q3)("",!0)])))),128))])):(0,a.Q3)("",!0)])])):(0,a.Q3)("",!0)],64)))),128))])]),(0,a.Lk)("div",Lk,[i.showHeaderPanel?((0,a.uX)(),(0,a.CE)("div",Ck,[(0,a.Lk)("div",Dk,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.formDataArray,((e,t)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:t},[e?((0,a.uX)(),(0,a.CE)("div",Sk,[(0,a.Lk)("div",Fk,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox",disabled:r.shouldDisableCheckbox(t),"onUpdate:modelValue":e=>i.selectedItems[t]=e,checked:i.headerGroup.includes(e),onChange:e=>r.updateHeaderGroup(t),class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 w-3 h-3"},null,40,Ik),[[c.lH,i.selectedItems[t]]]),(0,a.Lk)("span",{class:"text-sm text-gray-700 font-medium truncate max-w-32",title:e},(0,l.v_)(e),9,Ek)]),(0,a.Lk)("div",$k,[(0,a.Lk)("button",{onClick:e=>r.moveItemLeft(t),disabled:0===t,class:"p-1 text-gray-400 hover:text-indigo-600 disabled:opacity-50 rounded hover:bg-indigo-50 transition-all duration-200"},[(0,a.bF)(d,{icon:["fas","chevron-left"],class:"text-sm"})],8,_k),(0,a.Lk)("button",{onClick:e=>r.moveItemRight(t),disabled:t===i.headerGroup.length-1,class:"p-1 text-gray-400 hover:text-indigo-600 disabled:opacity-50 rounded hover:bg-indigo-50 transition-all duration-200"},[(0,a.bF)(d,{icon:["fas","chevron-right"],class:"text-sm"})],8,Pk)])])):(0,a.Q3)("",!0)],64)))),128))])])):(0,a.Q3)("",!0),(0,a.Lk)("div",Tk,[(0,a.Lk)("div",Ak,[(0,a.Lk)("div",Xk,[(0,a.Lk)("div",jk,[(0,a.Lk)("div",Uk,[(0,a.Lk)("input",{type:"checkbox",onChange:t[11]||(t[11]=(...e)=>r.toggleSelectAll&&r.toggleSelectAll(...e)),checked:r.areAllSelected,class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 w-3 h-3"},null,40,Bk),t[33]||(t[33]=(0,a.Lk)("span",null,"#",-1))]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.headerGroup,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:(0,l.C4)("flex-1 px-4 py-2.5 text-sm font-medium text-gray-900")},[(0,a.Lk)("div",{class:"truncate min-w-0",title:e},(0,l.v_)(e),9,Ok)])))),128))])]),t[34]||(t[34]=(0,a.Lk)("div",{class:"w-1/5"},[(0,a.Lk)("div",{class:"flex"},[(0,a.Lk)("div",{class:"flex-1 px-4 py-2.5 text-sm font-medium text-gray-900 truncate",title:"วันที่"},"วันที่"),(0,a.Lk)("div",{class:"flex-1 px-4 py-2.5 text-sm font-medium text-gray-900 truncate",title:"จัดการ"},"จัดการ")])],-1))])]),(0,a.Lk)("div",{class:(0,l.C4)(["divide-y divide-gray-100",[i.activeBlock?"relative overflow-hidden":""]])},[i.activeBlock?((0,a.uX)(),(0,a.CE)("div",Qk,t[35]||(t[35]=[(0,a.Fv)('<div class="text-center p-4 bg-white rounded-lg shadow-md border border-gray-200"><div class="relative mb-2"><div class="animate-spin rounded-full h-8 w-8 border-2 border-indigo-200 border-t-indigo-600 mx-auto"></div><div class="absolute inset-0 rounded-full h-8 w-8 border border-purple-200 border-t-purple-500 mx-auto animate-ping"></div></div><p class="text-gray-700 font-medium text-sm">กำลังประมวลผล...</p><p class="text-sm text-gray-500 mt-0.5">กรุณารอสักครู่</p></div>',1)]))):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.visibleItems,((s,o)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:s._id},[(0,a.Lk)("div",{class:(0,l.C4)(["flex items-center hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 transition-all duration-200",{"bg-gradient-to-r from-amber-50 to-yellow-50":r.hasSetDataKey(s.formData)}])},[(0,a.Lk)("div",Mk,[(0,a.Lk)("div",Vk,[(0,a.Lk)("div",Rk,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=e=>i.selectedData=e),value:s._id,class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 w-3 h-3"},null,8,Wk),[[c.lH,i.selectedData]]),(0,a.Lk)("span",{class:(0,l.C4)(["text-sm text-gray-900",{"font-medium":r.hasSetDataKey(s.formData)}])},(0,l.v_)((i.currentPage-1)*i.limitItem+o+1),3)]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.headerGroup,((e,o)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:o},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.formData,((o,i)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:i},[o.name===e?((0,a.uX)(),(0,a.CE)("div",Nk,[(0,a.Lk)("div",{class:(0,l.C4)(["text-sm text-gray-900 truncate",{"font-medium":r.hasSetDataKey(s.formData)}])},["input"===o.type||"text"===o.type||"email"===o.type||"name"===o.type||"mobile"===o.type||"taxID"===o.type||"taxName"===o.type||"number"===o.type||"hidden"===o.type?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.eW)((0,l.v_)(o.value),1)],64)):"textarea"===o.type?((0,a.uX)(),(0,a.Wv)(g,{key:1,value:o.value},null,8,["value"])):"datetime"===o.type?((0,a.uX)(),(0,a.CE)("div",qk,[(0,a.bF)(d,{icon:["fas","calendar"],class:"text-gray-400 text-sm"}),(0,a.Lk)("span",null,(0,l.v_)(r.formatThaidate(o.value)),1)])):"address"===o.type?((0,a.uX)(),(0,a.Wv)(p,{key:3,value:o.value},null,8,["value"])):"checkbox"===o.type?((0,a.uX)(),(0,a.CE)("div",Kk,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.value,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e,class:"inline-flex items-center px-1.5 py-0.5 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800"},(0,l.v_)(e),1)))),128))])):"radiobox"===o.type?((0,a.uX)(),(0,a.CE)("span",Hk,[t[36]||(t[36]=(0,a.Lk)("div",{class:"w-1 h-1 bg-emerald-500 rounded-full mr-1"},null,-1)),(0,a.eW)(" "+(0,l.v_)(o.value.label),1)])):"upload"===o.type?((0,a.uX)(),(0,a.CE)("div",{key:6,class:"relative cursor-pointer group",onClick:e=>r.showLightbox(o.value[0])},[o.value&&o.value[0]?((0,a.uX)(),(0,a.CE)("img",{key:0,class:"w-10 h-10 object-cover rounded-lg border border-gray-200 shadow-sm group-hover:shadow-md transition-all duration-200",src:o.value[0],alt:"Uploaded Image"},null,8,Gk)):(0,a.Q3)("",!0),(0,a.Lk)("div",Jk,[(0,a.bF)(d,{icon:["fas","search-plus"],class:"text-white text-sm"})])],8,zk)):(0,a.Q3)("",!0)],2)])):(0,a.Q3)("",!0)],64)))),128))],64)))),128))])]),(0,a.Lk)("div",Yk,[(0,a.Lk)("div",Zk,[(0,a.Lk)("div",ev,[(0,a.Lk)("div",tv,[(0,a.bF)(d,{icon:["fas","clock"],class:"text-gray-400 text-sm"}),(0,a.Lk)("span",null,(0,l.v_)(r.formatThaidate(s.createdAt)),1)])]),(0,a.Lk)("div",sv,[(0,a.Lk)("div",av,[(0,a.Lk)("button",{onClick:e=>r.linkUser(s.userID),class:"p-1 text-gray-400 hover:text-indigo-600 rounded hover:bg-indigo-50 transition-all duration-200",title:"ดูข้อมูลผู้ใช้"},[(0,a.bF)(d,{icon:["fas","user"],class:"text-sm"})],8,ov),(0,a.Lk)("button",{onClick:t=>e.deleteData(s._id),class:"p-1 text-gray-400 hover:text-emerald-600 rounded hover:bg-emerald-50 transition-all duration-200",title:"แก้ไข"},[(0,a.bF)(d,{icon:["fas","square-pen"],class:"text-sm"})],8,iv),(0,a.Lk)("button",{onClick:t=>e.removeItem(s._id),class:"p-1 text-gray-400 hover:text-red-600 rounded hover:bg-red-50 transition-all duration-200",title:"ลบ"},[(0,a.bF)(d,{icon:["fas","trash-can"],class:"text-sm"})],8,rv)])])])])],2),s.formData&&s.formData.setData?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:0},(0,a.pI)(s.formData.setData,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:`contact_${t}`,class:"bg-gradient-to-r from-amber-50 to-yellow-50 border-l-2 border-amber-400"},[(0,a.bF)(h,{value:e},null,8,["value"])])))),128)):(0,a.Q3)("",!0)],64)))),128))],2)]),i.lazy?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[i.isLoadingMore?((0,a.uX)(),(0,a.CE)("div",nv,t[37]||(t[37]=[(0,a.Lk)("div",{class:"flex items-center gap-3 text-blue-600"},[(0,a.Lk)("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),(0,a.Lk)("span",{class:"text-sm font-medium"},"กำลังโหลดข้อมูลการส่งแบบฟอร์มเพิ่ม...")],-1)]))):!r.hasMoreItems&&i.listItems.length>i.initialDisplayCount?((0,a.uX)(),(0,a.CE)("div",lv,[(0,a.Lk)("div",cv,[t[38]||(t[38]=(0,a.Lk)("i",{class:"fas fa-check-circle"},null,-1)),(0,a.Lk)("span",dv,"แสดงครบทั้งหมด "+(0,l.v_)(i.listItems.length)+" รายการแล้ว",1)])])):r.hasMoreItems?((0,a.uX)(),(0,a.CE)("div",uv,[(0,a.Lk)("div",mv,[(0,a.Lk)("div",gv,[t[39]||(t[39]=(0,a.Lk)("i",{class:"fas fa-mouse"},null,-1)),(0,a.Lk)("span",null,"เลื่อนลงเพื่อดูเพิ่ม (เหลือ "+(0,l.v_)(i.listItems.length-i.currentDisplayCount)+" รายการ)",1)]),(0,a.Lk)("div",pv,[(0,a.Lk)("button",{onClick:t[13]||(t[13]=(...e)=>r.loadMoreItems&&r.loadMoreItems(...e)),class:"px-2 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700 transition-colors",disabled:i.isLoadingMore},[t[40]||(t[40]=(0,a.Lk)("i",{class:"fas fa-plus mr-1"},null,-1)),(0,a.eW)(" โหลดเพิ่ม (+"+(0,l.v_)(i.loadMoreCount)+") ",1)],8,hv),(0,a.Lk)("button",{onClick:t[14]||(t[14]=e=>i.currentDisplayCount=i.listItems.length),class:"px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors",title:"กรณีที่ auto-scroll ไม่ทำงาน"},t[41]||(t[41]=[(0,a.Lk)("i",{class:"fas fa-eye mr-1"},null,-1),(0,a.eW)(" แสดงทั้งหมดเลย ")]))])])])):(0,a.Q3)("",!0)],64)):(0,a.Q3)("",!0),(0,a.Lk)("div",bv,[(0,a.bF)(m,{"current-page":i.currentPage,"total-items":i.totalItems,"total-pages":i.totalPages,"limit-items":i.limitItem,"data-loading":i.loading,"display-mode":"summary",onPageChanged:r.handlePageChanged},null,8,["current-page","total-items","total-pages","limit-items","data-loading","onPageChanged"])])])])):(0,a.Q3)("",!0),i.lightboxVisible?((0,a.uX)(),(0,a.CE)("div",{key:2,class:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:t[16]||(t[16]=(0,c.D$)(((...e)=>r.closeLightbox&&r.closeLightbox(...e)),["self"]))},[(0,a.Lk)("div",xv,[(0,a.Lk)("img",{src:i.selectedImage,alt:"Lightbox Image",class:"max-w-full max-h-full object-contain rounded-lg shadow-2xl"},null,8,yv),(0,a.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>r.closeLightbox&&r.closeLightbox(...e)),class:"absolute top-2 right-2 w-8 h-8 bg-black/50 hover:bg-black/75 text-white rounded-full flex items-center justify-center transition-colors backdrop-blur-sm border border-white/20"},[(0,a.bF)(d,{icon:["fas","times"],class:"text-sm"})])])])):(0,a.Q3)("",!0)])}s(23215);var kv=s(38558),vv=s(22808),wv=s(34237);const Lv={class:"min-w-full bg-white border-collapse border-t border-b"};function Cv(e,t,s,o,i,r){return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.Lk)("table",Lv,[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.tableHeaders,((e,t)=>((0,a.uX)(),(0,a.CE)("th",{key:t,class:"px-6 py-3 text-left text-xs font-semibold text-gray-800 uppercase tracking-wider border-b"},(0,l.v_)(e),1)))),128))])]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.value,((e,t)=>((0,a.uX)(),(0,a.CE)("tr",{key:t},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e,((e,t)=>((0,a.uX)(),(0,a.CE)("td",{key:t,class:"px-6 py-4 whitespace-nowrap border-b text-xs text-gray-500"},["select"===e.type?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.eW)((0,l.v_)(e.value.label),1)],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.eW)((0,l.v_)(e.value),1)],64))])))),128))])))),128))])])])}var Dv={props:{value:{type:Array,required:!0}},computed:{tableHeaders(){const e=this.value[0];return e?e.map((e=>e.name)):[]}}};const Sv=(0,rr.A)(Dv,[["render",Cv]]);var Fv=Sv;const Iv={key:0,class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center z-50"},Ev={class:"popup-inner bg-white w-11/12 md:w-3/4 lg:w-2/3 xl:w-1/2 2xl:w-2/5 overflow-auto rounded-lg shadow-lg p-4"},$v={class:"overflow-x-auto max-h-[600px]"},_v={id:"previewTable",class:"min-w-full leading-normal"},Pv={class:"bg-gray-100 text-left text-gray-600 uppercase text-sm leading-normal"},Tv={style:{display:"flex","align-items":"center","white-space":"nowrap"}},Av=["onUpdate:modelValue"],Xv={key:0},jv=["onUpdate:modelValue","onKeyup"],Uv=["onClick"],Bv={class:"text-gray-600 text-sm font-light"},Ov={class:"py-2 px-3 whitespace-nowrap"},Qv={class:"flex justify-end space-x-2 mt-4"},Mv={key:0};function Vv(e,t,s,o,i,r){return(0,a.uX)(),(0,a.CE)(a.FK,null,[i.showPopup?((0,a.uX)(),(0,a.CE)("div",Iv,[(0,a.Lk)("div",Ev,[t[4]||(t[4]=(0,a.Lk)("h3",{class:"text-lg font-semibold mb-4"},"Preview Data",-1)),(0,a.Lk)("div",$v,[(0,a.Lk)("table",_v,[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",Pv,[t[3]||(t[3]=(0,a.Lk)("th",{class:"py-2 px-3"},"#",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.allTableHeaders,(e=>((0,a.uX)(),(0,a.CE)("th",{class:"py-2 px-3",key:e},[(0,a.Lk)("div",Tv,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>i.columnsVisibility[e]=t,style:{"margin-right":"8px"}},null,8,Av),[[c.lH,i.columnsVisibility[e]]]),i.headerEditing[e]?(0,a.bo)(((0,a.uX)(),(0,a.CE)("input",{key:1,"onUpdate:modelValue":t=>i.editableHeaders[e]=t,onKeyup:(0,c.jR)((t=>r.finalizeHeaderEdit(e)),["enter"]),type:"text",class:"form-input"},null,40,jv)),[[c.Jo,i.editableHeaders[e]]]):((0,a.uX)(),(0,a.CE)("span",Xv,(0,l.v_)(i.editableHeaders[e]),1)),(0,a.Lk)("button",{onClick:t=>r.editHeader(e),class:"ml-2"},"Edit",8,Uv)])])))),128))])]),(0,a.Lk)("tbody",Bv,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.dataArray,((e,t)=>((0,a.uX)(),(0,a.CE)("tr",{class:"border-b border-gray-200 hover:bg-gray-100",key:t},[(0,a.Lk)("td",Ov,(0,l.v_)(t+1),1),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.allTableHeaders,(s=>((0,a.uX)(),(0,a.CE)("td",{class:"py-2 px-3",key:s+"-"+t,style:(0,l.Tr)({opacity:i.columnsVisibility[s]?"1":"0.5"})},(0,l.v_)(e[s]?e[s]:"-"),5)))),128))])))),128))])])]),(0,a.Lk)("div",Qv,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.exportTableToCSV&&r.exportTableToCSV(...e)),class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"},"Export to CSV"),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.closePopup&&r.closePopup(...e)),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},"Close")])])])):(0,a.Q3)("",!0),(0,a.Lk)("div",null,[(0,a.Lk)("table",{id:"dataTable",class:(0,l.C4)({hidden:!i.showTable})},[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[t[5]||(t[5]=(0,a.Lk)("th",null,"#",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.allTableHeaders,(e=>((0,a.uX)(),(0,a.CE)("th",{key:e},[i.headerEditing[e]?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",Mv,(0,l.v_)(i.editableHeaders[e]),1))])))),128))])]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.dataArray,((e,t)=>((0,a.uX)(),(0,a.CE)("tr",{key:t},[(0,a.Lk)("td",null,(0,l.v_)(t+1),1),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.allTableHeaders,(s=>((0,a.uX)(),(0,a.CE)("td",{key:s+"-"+t,style:(0,l.Tr)({opacity:i.columnsVisibility[s]?"1":"0.5"})},(0,l.v_)(e[s]?e[s]:"-"),5)))),128))])))),128))])],2),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.exportToCSV&&r.exportToCSV(...e)),class:(0,l.C4)([{hidden:!i.showExport},"bg-blue-500 hover:bg-blue-700 text-white py-2 px-3 rounded text-sm mr-2"])},(0,l.v_)(s.exportButtonText),3)])],64)}s(30670);var Rv={props:{listItems:{type:Array,required:!0},table:{type:Boolean,default:!0},export:{type:Boolean,default:!0},parent:{type:Object},status:{type:String},exportButtonText:{type:String,default:"Export CSV"}},data(){return{loading:!0,showTable:this.table,showExport:this.export,dataArray:[],showPopup:!1,columnsVisibility:{},allTableHeaders:[],headerEditing:{},editableHeaders:{}}},watch:{listItems:{handler(e){this.formatListItems(e),this.initializeColumnVisibility()},immediate:!0,deep:!0}},computed:{tableHeaders(){if(0===this.dataArray.length)return[];const e=new Set;return this.dataArray.forEach((t=>{Object.keys(t).forEach((t=>e.add(t)))})),Array.from(e)}},methods:{editHeader(e){this.headerEditing[e]=!0},finalizeHeaderEdit(e){this.headerEditing[e]=!1},initializeColumnVisibility(){this.allTableHeaders=this.dataArray.length>0?Object.keys(this.dataArray[0]):[];const e=this.allTableHeaders.indexOf("undefined");-1!==e&&this.allTableHeaders.splice(e,1),this.allTableHeaders.forEach((e=>{this.columnsVisibility[e]=!0,this.headerEditing[e]=!1,this.editableHeaders[e]=e})),this.columnsVisibility["process"]=!0},formatListItems(){const e=this.listItems.flatMap((e=>{const t=e,s=Object.entries(e.formData).reduce(((e,[t,s])=>{if(console.log("key",t),!s||"object"!==typeof s)return e;switch(s.type){case"select":e[s.name]=s.value?.label||"";break;case"radiobox":e[s.name]=s.value?.label||"";break;case"text":case"email":case"number":e[s.name]=s.value||"";break;case"datetime":e[s.name]=s.value||"";break;case"upload":e[s.name]=Array.isArray(s.value)?s.value.join(", "):s.value||"";break;case"billing":case"delivery":case"tax":if(s.value&&"object"===typeof s.value){const t=(s.value["province"]||"").toString().trim().toLowerCase(),a="กรุงเทพ"===t||"กรุงเทพมหานคร"===t;let o=(s.value["district"]||"").toString().trim();a&&o.startsWith("อำเภอเขต")?o=o.replace("อำเภอเขต",""):a&&o.startsWith("เขต")&&(o=o.replace("เขต",""));const i={NO:"เลขที่ ",MOO:"ม.",SOI_TH:"ซ.",BUILDING_TH:"",ROAD_TH:"ถนน",subdistrict:a?"แขวง":"ตำบล",district:a?"เขต":"อำเภอ",province:a?"":"จังหวัด",zipcode:""};let r=[];Object.keys(i).forEach((t=>{let n=(s.value[t]||"").toString().trim();"district"===t&&a&&(n=o),n&&!["n/a","unset","-","ไม่มีข้อมูล"].includes(n.toLowerCase())?(r.push(`${i[t]}${n}`),e[`${s.name}-${t}`]=n):e[`${s.name}-${t}`]="-"})),e[`${s.name}-ที่อยู่แบบเต็ม`]=r.length>0?r.join(" ").trim():"-"}break}return e}),{});s["TAX_ID"]=e.order?.length>0?e.order[0]?.detailData?.tax_id:"",s["TRANSFER_DATE"]=e.order?.length>0?e.order[0]?.detailData?.transfered_date:"",s["TRANSFER_REF2"]=e.order?.length>0?e.order[0]?.detailData?.transfered_ref2:"",s["TRANSFER_REF1"]=e.order?.length>0?e.order[0]?.detailData?.transfered_ref1:"",s["SUB_SECTION_AMOUNT"]=e.order?.length>0?e.order[0]?.detailData?.transfered_amount:"",s["INV_NO"]=e.order?.length>0?e.order[0]?.detailData?.tranNo:"",s["สถานะ"]=t.process,s["ความคืบหน้า"]=t?.enroll?.analytics?.complete+"/"+t?.enroll?.analytics?.total??"0/0",s["สอบก่อนเรียน"]=t?.enroll?.analytics?.pre?.score??0,s["สอบหลังเรียน"]=t?.enroll?.analytics?.post?.score??0,s["สอบซ่อม"]=t?.enroll?.analytics?.retest?.score??0;const a=t?.enroll?.analytics;let o=parseInt(a?.post?.score??0),i=parseInt(a?.retest?.score??0),r=parseInt(a?.post?.measure??33);s["ผล"]=o>=r?"ผ่าน":i<r?"ไม่ผ่าน":"ผ่าน";const n=e.formData?.["radiobox-14-0-9"]?.value?.value;s["รอบสอบ"]="round-1"===n?"รอบ 1":"round-2"===n?"รอบ 2":n??"ไม่ได้เลือก";let l="",c="";const d=e.formData?.["radiobox-14-0-9"]?.value?.value;"round-1"===d?(l="4 เดือน กันยายน พ.ศ. 2567",c="3 เดือน กันยายน พ.ศ. 2572"):"round-2"===d&&(l="7 เดือน กันยายน พ.ศ. 2567",c="6 เดือน กันยายน พ.ศ. 2572");const u=e.courseID,m=e.userID;"ผ่าน"===s["ผล"]?(s["วันที่ออกใบรับรอง"]=l,s["วันหมดอายุ"]=c,s["URL"]="https://doa.fti.or.th/lesson/certification/"+u+"/"+m,s["Certification Code"]=m,s["Certification ID"]="68/1/"+e.formData?.["input-6-0-5"]?.value):(s["วันที่ออกใบรับรอง"]="",s["วันหมดอายุ"]="",s["URL"]="",s["Certification Code"]="",s["Certification ID"]="");const g=e.formData.setData||{},p=Object.keys(g).flatMap((e=>g[e].flatMap((t=>t.reduce(((t,s)=>{let a="";return a="select"===s.type?s.value.label:s.value,t[`${e}-${s.name}`]=a,t}),{})))));return 0===p.length?[s]:p.map((e=>({...e,...s})))}));this.dataArray=e,console.log("ListItems:",this.listItems),console.log("FormattedData:",e)},exportToCSV(){document.body.classList.add("body-scroll-lock"),this.showPopup=!0},closePopup(){document.body.classList.remove("body-scroll-lock"),this.showPopup=!1},exportTableToCSV(){let e="data:text/csv;charset=utf-8,";const t=this.allTableHeaders.filter((e=>this.columnsVisibility[e]));e+=t.join(",")+"\r\n",this.dataArray.forEach((s=>{let a=t.map((e=>{const t=s[e]?s[e].toString():"";return`"${t.replace(/"/g,'""')}"`})).join(",");e+=a+"\r\n"}));const s=encodeURI(e),a=document.createElement("a");a.setAttribute("href",s);const o=this.parent.name+" - ("+(this.status?this.status:"ทั้งหมด")+") - ข้อมูลการกรอกแบบฟอร์ม.csv";a.setAttribute("download",o),document.body.appendChild(a),a.click(),document.body.removeChild(a),this.showPopup=!1}},mounted(){this.loading=!1}};const Wv=(0,rr.A)(Rv,[["render",Vv],["__scopeId","data-v-ef24c5b8"]]);var Nv=Wv,qv={props:{form:String,course:String,activeFormStatus:Object,returnFormStatus:Object,parent:Object},data(){const e=n.A.get("session");return{dataItem:this.form,dataSub:this.course,dataStatus:this.$route.params.status,school:e.current.id,login:e.login,postData:[],listItems:[],categoryData:[],formDataArray:[],loading_sources:!0,endpoint:"",master:e.master,accessToken:n.A.get("session","token"),configs:n.A.get("configs"),session:n.A.get("session"),limitItem:50,limitOptions:[1,5,10,50,100,200,500,600,700,800,1e3,2e3,3e3],currentPage:1,totalPages:0,totalItems:0,allListItems:[],totalItemsFetched:0,isLoading:!1,chunkSize:100,progress:0,loading:!1,showingOverlay:!1,searchQuery:"",statusFilter:"all",isCreatingUser:!1,isShowingOverlay:!1,loadingMessage:"",processingCount:"",debounceTimer:null,activeBlock:!1,selectedStatus:"",lightboxVisible:!1,selectedImage:"",selectedItems:[],headerGroup:[],headLimit:10,showHeaderPanel:!1,selectedData:[],expandedItemIndex:null,statusArray:[],totalProcessed:0,successfullyProcessed:0,lazy:!0,initialDisplayCount:30,loadMoreCount:20,currentDisplayCount:30,isLoadingMore:!1,scrollCleanup:null}},components:{Loader:ss.A,Pagination:kv.A,ShortText:vv.A,Address:wv.A,DataSet:Fv,DataTable:Nv},created(){this.selectedItems=this.formDataArray.map((e=>this.headerGroup.includes(e)))},methods:{linkUser(e){this.$router.push("/student/detail/"+e)},async prevItem(){this.returnFormStatus&&this.returnFormStatus.prev?(await this.batchProcess(this.returnFormStatus.prev),console.log(this.returnFormStatus.prev)):console.log("No previous item to process.")},async nextItem(){this.returnFormStatus&&this.returnFormStatus.next?(await this.batchProcess(this.returnFormStatus.next),console.log(this.returnFormStatus.next)):console.log("No next item to process.")},async assignItem(e){await this.batchAssignProcess(e)},deleteItem(){},async batchProcess(e){if(this.selectedData.length>0){this.successfullyProcessed=0,this.totalProcessed=this.selectedData.length;for(const t of this.selectedData){const s={_id:t};await this.singleProcess(s,e)}this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"อัพเดตสถานะเรียบร้อยแล้ว",text:"อัพเดตสถานะของข้อมูลทั้งหมดสำเร็จแล้ว"}),this.$emit("update-viewer",{update:!0,status:e}),this.selectedData=[],this.getData()}else console.log("No data selected.")},async batchAssignProcess(e){if(this.selectedData.length>0){this.successfullyProcessed=0,this.totalProcessed=this.selectedData.length;for(const t of this.selectedData){const s={_id:t};await this.enrollCourse(s,e)}this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"อัพเดตสถานะเรียบร้อยแล้ว",text:"อัพเดตสถานะของข้อมูลทั้งหมดสำเร็จแล้ว"}),this.$emit("update-viewer",{update:!0,status:e}),this.selectedData=[],this.getData()}else console.log("No data selected.")},async singleProcess(e,t){try{this.activeBlock=!0;const s={data:{process:t},options:{}},{data:a,status:o}=await this.$Request.PUT(`${this.postData.destination}/${e._id}`,s,this.configs.key);console.log(a),200===o&&(this.activeBlock=!1,this.successfullyProcessed++)}catch(s){console.log(s)}},async enrollCourse(e,t){try{console.log(e);const{data:s,status:a}=await this.$Request.GET(`${this.postData.destination}/${e._id}`,this.configs.key);if(200===a){const a={method:"find",args:[{$and:[{userID:s.userID,courseID:s.courseID,unit:s.parent}]}]},{data:o,status:i}=await this.$Request.POST("enroll/query",a,this.configs.key);if(console.log("Check Enroll Data",o),200===i)if(o&&0!==Object.keys(o).length)console.log("Has Enroll Data");else{const a={data:{userID:s.userID,courseID:s.courseID,formID:s._id,unit:s.parent},options:{}},{data:o,status:i}=await this.$Request.POST("enroll",a,this.configs.key);console.log("enrollmentStatus",i),console.log("enrollmentData",o),console.log("selectedValue",t);const r={data:{process:t,enrollID:o._id,status:!0},options:{}},{data:n,status:l}=await this.$Request.PUT(`${this.postData.destination}/${e._id}`,r,this.configs.key);console.log(n,l)}}}catch(s){console.log(s)}},formatKeyToTitle(e){return e.replace(/_/g," ").replace(/^\w/,(e=>e.toUpperCase()))},getSummaryField(e,t){const s=Object.values(e);return s[t].name+" : "+s[t].value?s[t].name+" : "+s[t].value:""},toggleDetail(e){this.expandedItemIndex=this.expandedItemIndex===e?null:e},logSelectedData(){this.selectedData.length>0?console.log(this.selectedData):console.log("No data selected.")},toggleSelectAll(e){const t=e.target.checked;this.selectedData=t?this.listItems.map((e=>e._id)):[]},toggleHeaderPanel(){this.showHeaderPanel=!this.showHeaderPanel},moveItemLeft(e){if(e>0){const t=this.headerGroup.splice(e,1)[0];this.headerGroup.splice(e-1,0,t);const s=this.formDataArray.splice(e,1)[0];this.formDataArray.splice(e-1,0,s)}},moveItemRight(e){if(e<this.headerGroup.length-1){const t=this.headerGroup.splice(e,1)[0];this.headerGroup.splice(e+1,0,t);const s=this.formDataArray.splice(e,1)[0];this.formDataArray.splice(e+1,0,s)}},addToHeaderGroup(){this.headerGroup=[];let e=0;for(let t=0;t<this.selectedItems.length&&e<this.headLimit;t++)this.selectedItems[t]&&(this.headerGroup.push(this.formDataArray[t]),e++)},updateHeaderGroup(e){if(this.selectedItems[e])this.headerGroup.includes(this.formDataArray[e])||this.headerGroup.push(this.formDataArray[e]);else{const t=this.formDataArray[e],s=this.headerGroup.indexOf(t);-1!==s&&this.headerGroup.splice(s,1)}},shouldDisableCheckbox(e){return!this.selectedItems[e]&&this.headerGroup.length>=this.headLimit},hasSetDataKey(e){return"setData"in e},showLightbox(e){this.lightboxVisible=!0,this.selectedImage=e},closeLightbox(){this.lightboxVisible=!1,this.selectedImage=""},async updateData(e,t){try{this.activeBlock=!0;const s={data:{status:t},options:{}},{data:a,status:o}=await this.$Request.PUT(`${this.postData.destination}/${e._id}`,s,this.configs.key);console.log(a),200===o&&(this.activeBlock=!1,this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"อัพเดตสถานะเรียบร้อยแล้ว",text:"อัพเดตสถานะของข้อมูลนี้ สำเร็จแล้ว"}))}catch(s){console.log(s)}},exportToCSV(){const e=this.listItems.map(((e,t)=>{const s={"#":(this.currentPage-1)*this.limitItem+t+1,...e.formData,"หลักสูตร":e.course.name,"วันที่ส่งข้อมูล":this.formatThaidate(e.createdAt),"สถานะ":e.status,"สอบก่อนเรียน":e.enroll?.analytics?.pre?.score??"No Data","สอบหลังเรียน":e.enroll?.analytics?.post?.score??"No Data","สอบซ่อม":e.enroll?.analytics?.retest?.score??"No Data"};return Object.keys(s).forEach((e=>{if(Array.isArray(s[e]))if(1===s[e].length&&"address"===s[e][0].type){const t=s[e][0].value;s[e]=this.getAddressString(t)}else s[e]=s[e].map((e=>"object"===typeof e.value?JSON.stringify(e.value):e.value)).join(", ");else"object"===typeof s[e]&&"address"===s[e].type?s[e]=this.getAddressString(s[e].value):"object"===typeof s[e]&&(s[e]=JSON.stringify(s[e].value))})),s}));let t="";const s=Object.keys(e[0]);t+=s.join("\t")+"\n",e.forEach((e=>{const a=s.map((t=>t in e?e[t]:""));t+=a.join("\t")+"\n"}));const a=new Blob([t],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.setAttribute("href",URL.createObjectURL(a)),o.setAttribute("download",this.postData.title+"_exportdata_"+this.postData._id+".csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o)},getAddressString(e){const{MOO:t,NO:s,BUILDING_TH:a,ROAD_TH:o,subdistrict:i,district:r,province:n,zipcode:l}=e;return`หมู่ที่ ${t}, เลขที่ ${s}, อาคาร/หมู่บ้าน/สำนักงาน ${a}, ถนน ${o}, ตำบล ${i}, อำเภอ ${r}, จังหวัด ${n}, รหัสไปรษณีย์ ${l}`},navigateToItem(e){const t=`/application/apply/${this.postData._id}/${e.slug}`;this.$router.push(t)},formatThaidate(e){return ns.A.toThaiDatetime(e,"short")},handleLimitChange(){const e=n.A.get("session");e.limitItem=this.limitItem,n.A.set("session",e),this.currentPage=1,e.currentPage=this.currentPage,n.A.set("session",e);const t=new URLSearchParams(window.location.search);t.set("page",e.currentPage);const s=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",s),console.log("getdata","handleLimitChange"),this.getData()},handlePageChanged(e){if(e!==this.currentPage){window.scrollTo(0,0),this.currentPage=e;const t=n.A.get("session");t.currentPage=this.currentPage,n.A.set("session",t),console.log("getdata","handlePageChanged"),this.getData()}},clearSearchQuery(){this.searchQuery="";const e=n.A.get("session");e.searchQuery="",n.A.set("session",e),console.log("getdata","clearSearchQuery"),this.getData()},async getCourse(){try{const{data:e,status:t}=await this.$Request.GET(`post/${this.dataItem}`,this.configs.key);200===t&&(this.postData=e,console.log(e))}catch(e){console.error(e)}},resetData(){this.allListItems=[],this.totalItemsFetched=0,this.isLoading=!1,this.chunkSize=100,this.progress=0},async loadAllData(){try{this.isLoading=!0,this.allListItems=[];let e=0;while(e<this.totalItems||0===e){const t=[];this.activeFormStatus&&this.activeFormStatus.code&&t.push({formID:this.dataItem,process:this.activeFormStatus.code}),this.dataSub&&t.push({courseID:this.dataSub}),"all"!==this.statusFilter&&t.push({status:this.statusFilter});const s=[{$match:{$and:t}},{$set:{courseID:{$toObjectId:"$courseID"},enrollID:{$toObjectId:"$enrollID"},orderID:{$toObjectId:"$orderID"}}},{$lookup:{from:"course",localField:"courseID",foreignField:"_id",as:"course"}},{$lookup:{from:"order",localField:"orderID",foreignField:"_id",as:"order"}},{$unwind:"$course"},{$set:{certID:{$toObjectId:"$course.certificationId"}}},{$lookup:{from:"certification_template",localField:"certID",foreignField:"_id",as:"certification_template"}},{$unwind:{path:"$certification_template",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"enroll",let:{rootUserId:"$$ROOT.userID",rootCourseId:{$toString:"$$ROOT.courseID"}},pipeline:[{$match:{$expr:{$and:[{$eq:["$userID","$$rootUserId"]},{$eq:["$courseID","$$rootCourseId"]}]}}}],as:"enroll"}},{$unwind:{path:"$enroll",preserveNullAndEmptyArrays:!0}},{$facet:{post:[{$skip:e},{$limit:this.chunkSize}],totalCount:[{$count:"count"}]}}],a={pipeline:s},{data:o,status:i}=await this.$Request.POST(`${this.postData.destination}/aggregate`,a,this.configs.key);if(200!==i||!o){console.error("Error fetching data:",i);break}{const t=o[0]?.totalCount?.[0]?.count||0;this.totalItems=t;const s=o[0].post;if(this.allListItems.push(...s),e+=s.length,this.allListItems.length>0&&e===this.chunkSize){const e=Object.keys(this.allListItems[0].formData).map((e=>this.allListItems[0].formData[e].name)),t=this.allListItems[0].formData.setData;let s=[];t&&(s=Object.keys(t)),this.formDataArray=[...e,...s],0===this.headerGroup.length&&(this.headerGroup=this.formDataArray.slice(0,10))}if(this.totalItemsFetched=e,this.progress=Math.min(this.totalItemsFetched/this.totalItems*100,100).toFixed(2),e>=this.totalItems)break}}this.isLoading=!1}catch(e){console.error("Error in loadAllData:",e),this.isLoading=!1}},async getData(){const e=performance.now();console.log(`⏱️ FormSubmit getData started - Page: ${this.currentPage}, Limit: ${this.limitItem}`);try{if(this.login){this.loading=!0,this.activeBlock=!0;const t=[];if(this.activeFormStatus&&this.activeFormStatus.code&&t.push({formID:this.dataItem,process:this.activeFormStatus.code}),this.dataSub&&t.push({courseID:this.dataSub}),"all"!==this.statusFilter&&t.push({status:this.statusFilter}),this.searchQuery&&""!==this.searchQuery.trim()){const e=this.searchQuery.trim();console.log(`🔍 FormSubmit adding search condition for: "${e}"`);const s=[{userID:{$regex:e,$options:"i"}},{process:{$regex:e,$options:"i"}},{status:{$regex:e,$options:"i"}},{"formData.input-1-1-3.value":{$regex:e,$options:"i"}},{"formData.input-2-2-3.value":{$regex:e,$options:"i"}},{"formData.input-9-1-5.value":{$regex:e,$options:"i"}},{"formData.input-10-2-5.value":{$regex:e,$options:"i"}},{"formData.input-6-0-5.value":{$regex:e,$options:"i"}},{"formData.input-18-1-11.value":{$regex:e,$options:"i"}},{"formData.input-20-2-11.value":{$regex:e,$options:"i"}}];t.push({$or:s})}const s={$and:t};let a=0;if(1===this.currentPage){const e=performance.now();console.log("🔢 FormSubmit counting total items...");let t=[{$match:s}];if(this.searchQuery&&""!==this.searchQuery.trim()){const e=this.searchQuery.trim();console.log(`🔍 FormSubmit count includes search for: "${e}"`),t=[{$match:s},{$addFields:{courseID_obj:{$toObjectId:"$courseID"}}},{$lookup:{from:"course",localField:"courseID_obj",foreignField:"_id",as:"course",pipeline:[{$project:{name:1}}]}},{$unwind:{path:"$course",preserveNullAndEmptyArrays:!0}},{$match:{$or:[{"course.name":{$regex:e,$options:"i"}},{userID:{$regex:e,$options:"i"}},{process:{$regex:e,$options:"i"}},{"formData.input-1-1-3.value":{$regex:e,$options:"i"}},{"formData.input-2-2-3.value":{$regex:e,$options:"i"}},{"formData.input-9-1-5.value":{$regex:e,$options:"i"}},{"formData.input-10-2-5.value":{$regex:e,$options:"i"}},{"formData.input-6-0-5.value":{$regex:e,$options:"i"}},{"formData.input-18-1-11.value":{$regex:e,$options:"i"}},{"formData.input-20-2-11.value":{$regex:e,$options:"i"}}]}},{$count:"total"}]}else t.push({$count:"total"});const o=await this.$Request.POST(`${this.postData.destination}/aggregate`,{pipeline:t},this.configs.key);a=o.data?.[0]?.total||0;const i=(performance.now()-e).toFixed(2);console.log(`✅ FormSubmit count completed - Total: ${a} items in ${i}ms`)}else if(this.searchQuery&&""!==this.searchQuery.trim()){const e=performance.now();console.log("🔢 FormSubmit re-counting for search...");const t=this.searchQuery.trim(),o=[{$match:s},{$addFields:{courseID_obj:{$toObjectId:"$courseID"}}},{$lookup:{from:"course",localField:"courseID_obj",foreignField:"_id",as:"course",pipeline:[{$project:{name:1}}]}},{$unwind:{path:"$course",preserveNullAndEmptyArrays:!0}},{$match:{$or:[{"course.name":{$regex:t,$options:"i"}},{userID:{$regex:t,$options:"i"}},{process:{$regex:t,$options:"i"}},{"formData.input-1-1-3.value":{$regex:t,$options:"i"}},{"formData.input-2-2-3.value":{$regex:t,$options:"i"}},{"formData.input-9-1-5.value":{$regex:t,$options:"i"}},{"formData.input-10-2-5.value":{$regex:t,$options:"i"}},{"formData.input-6-0-5.value":{$regex:t,$options:"i"}},{"formData.input-18-1-11.value":{$regex:t,$options:"i"}},{"formData.input-20-2-11.value":{$regex:t,$options:"i"}}]}},{$count:"total"}],i=await this.$Request.POST(`${this.postData.destination}/aggregate`,{pipeline:o},this.configs.key);a=i.data?.[0]?.total||0;const r=(performance.now()-e).toFixed(2);console.log(`✅ FormSubmit search count completed - Total: ${a} items in ${r}ms`)}else a=this.totalItems;let o=[];const i=[{$match:s},{$addFields:{courseID_obj:{$toObjectId:"$courseID"},enrollID_obj:{$toObjectId:"$enrollID"},orderID_obj:{$toObjectId:"$orderID"}}},{$lookup:{from:"course",localField:"courseID_obj",foreignField:"_id",as:"course",pipeline:[{$project:{name:1,certificationId:1,_id:1}}]}},{$unwind:{path:"$course",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"enroll",localField:"enrollID_obj",foreignField:"_id",as:"enroll",pipeline:[{$project:{analytics:1,_id:1}}]}},{$unwind:{path:"$enroll",preserveNullAndEmptyArrays:!0}}];if(this.searchQuery&&""!==this.searchQuery.trim()){const e=this.searchQuery.trim();console.log(`🔍 FormSubmit applying post-lookup search for: "${e}"`),i.push({$match:{$or:[{"course.name":{$regex:e,$options:"i"}},{userID:{$regex:e,$options:"i"}},{process:{$regex:e,$options:"i"}},{"formData.input-1-1-3.value":{$regex:e,$options:"i"}},{"formData.input-2-2-3.value":{$regex:e,$options:"i"}},{"formData.input-9-1-5.value":{$regex:e,$options:"i"}},{"formData.input-10-2-5.value":{$regex:e,$options:"i"}},{"formData.input-6-0-5.value":{$regex:e,$options:"i"}},{"formData.input-18-1-11.value":{$regex:e,$options:"i"}},{"formData.input-20-2-11.value":{$regex:e,$options:"i"}}]}})}i.push({$skip:(this.currentPage-1)*this.limitItem},{$limit:this.limitItem},{$project:{formData:1,courseID:1,userID:1,status:1,createdAt:1,process:1,"course.name":1,"course.certificationId":1,"enroll.analytics":1,_id:1}}),o=i;const r=performance.now();console.log(`🔍 FormSubmit optimized MongoDB query started - Pipeline stages: ${o.length}`);const{data:n,status:l}=await this.$Request.POST(`${this.postData.destination}/aggregate`,{pipeline:o},this.configs.key),c=performance.now(),d=(c-r).toFixed(2);if(console.log(`📊 FormSubmit MongoDB query completed - Time: ${d}ms, Records: ${n?.length||0}`),200===l)if(n&&n.length>0){const t=performance.now();console.log("🔄 FormSubmit data transformation started");const s={data:n,total:a,paging:{page:this.currentPage,limit:this.limitItem,totalPages:Math.ceil(a/this.limitItem)}};if(this.listItems=s.data,this.totalItems=s.total,this.totalPages=s.paging.totalPages,console.log("📋 FormSubmit sample record:",s.data[0]),s.data[0]?.formData){console.log("🔧 FormSubmit extracting form structure...");const e=Object.keys(s.data[0].formData).map((e=>{const t=s.data[0].formData[e];return t?.name||t||e})).filter((e=>e&&"setData"!==e)),t=s.data[0].formData.setData;let a=[];t&&"object"===typeof t&&(a=Object.keys(t).filter((e=>e))),this.formDataArray=[...e,...a],console.log("🏷️ FormSubmit formDataArray created:",this.formDataArray),console.log("📋 FormSubmit sample formData structure:",Object.keys(s.data[0].formData)),0===this.headerGroup.length&&this.formDataArray.length>0&&(this.headerGroup=this.formDataArray.slice(0,Math.min(10,this.formDataArray.length)),console.log("🎯 FormSubmit initial headerGroup set:",this.headerGroup)),this.selectedItems.length!==this.formDataArray.length&&(this.selectedItems=this.formDataArray.map((e=>this.headerGroup.includes(e))),console.log("✅ FormSubmit selectedItems synchronized"))}else console.warn("⚠️ FormSubmit no formData found in first record"),this.formDataArray=[],this.headerGroup=[];const o=performance.now(),i=(o-t).toFixed(2);console.log(`✨ FormSubmit data transformation completed - Time: ${i}ms, Items processed: ${this.listItems.length}`),this.loading=!1,this.activeBlock=!1,this.resetData(),this.lazy&&this.resetDisplayCount();const r=performance.now(),l=(r-e).toFixed(2);console.log(`✅ FormSubmit getData completed - Total: ${l}ms`),console.log("📈 Performance breakdown:"),console.log(`  🗄️  MongoDB Processing: ${d}ms`),console.log(`  🔄 Data Transformation: ${i}ms`),console.log(`  📊 Items: ${this.listItems.length}, Total Records: ${this.totalItems}`),console.log("  ⚡ Performance improvement: Separated count query + reduced lookups + field projection")}else this.listItems=[],this.totalItems=0,this.totalPages=0,this.loading=!1,this.activeBlock=!1,console.log("📭 No FormSubmit data found");else{this.formDataArray=[],this.listItems=[],this.loading=!1,this.activeBlock=!1;const t=performance.now(),s=(t-e).toFixed(2);console.log(`❌ FormSubmit getData failed - Time: ${s}ms, Status: ${l}`)}}}catch(t){console.log(t),this.loading=!1,this.activeBlock=!1;const s=performance.now(),a=(s-e).toFixed(2);console.log(`❌ FormSubmit getData error - Time: ${a}ms, Error:`,t)}},toggleStatus(e){console.log("Toggle Status",e),this.statusFilter=e,this.getData()},setupScrollDetection(){this.lazy&&this.$nextTick((()=>{console.log("🔧 FormSubmit setting up scroll detection...");const e=[document.querySelector("body"),document.documentElement,window,this.$el?.closest(".overflow-y-auto"),this.$el?.closest("[data-simplebar]"),this.$el?.parentElement,document.querySelector(".main-content"),document.querySelector("#app")];console.log("🔍 FormSubmit testing scroll containers:",e.map((e=>e?.tagName||e?.constructor?.name||"null")));const t=()=>{if(!this.hasMoreItems||this.isLoadingMore)return void console.log(`⏸️ FormSubmit scroll ignored: hasMore=${this.hasMoreItems}, isLoading=${this.isLoadingMore}`);let e,t={};const s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,a=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight),o=window.innerHeight||document.documentElement.clientHeight;e=(s+o)/a,t={scrollTop:Math.round(s),scrollHeight:Math.round(a),clientHeight:Math.round(o),container:"window-improved"},console.log("🔍 FormSubmit scroll debug:",{percent:(100*e).toFixed(1)+"%",hasMore:this.hasMoreItems,isLoading:this.isLoadingMore,currentDisplay:this.currentDisplayCount,totalItems:this.listItems.length,...t}),(e>.4||s+o>=a-100)&&(console.log(`🚀 FormSubmit scroll TRIGGERED at ${(100*e).toFixed(1)}%`),this.loadMoreItems())},s={passive:!0,capture:!1};window.addEventListener("scroll",t,s),document.addEventListener("scroll",t,s),document.body.addEventListener("scroll",t,s),window.addEventListener("wheel",t,s),window.addEventListener("touchmove",t,s);const a=()=>{console.log("📏 FormSubmit window resized, checking scroll..."),setTimeout(t,100)};window.addEventListener("resize",a,s),console.log("✅ FormSubmit multiple scroll listeners installed");let o=0;const i=3,r=setInterval((()=>{this.hasMoreItems&&!this.isLoadingMore&&o<i?(console.log(`⏰ FormSubmit fallback timer triggered auto-load (attempt ${o+1}/${i})`),this.loadMoreItems(),o++):(!this.hasMoreItems||o>=i)&&(clearInterval(r),o>=i?console.log(`🛑 FormSubmit stopped auto-loading after ${i} attempts. Please scroll to load more.`):console.log("✅ All form submit items loaded, clearing fallback timer"))}),3e3);this.scrollCleanup=()=>{window.removeEventListener("scroll",t),document.removeEventListener("scroll",t),document.body.removeEventListener("scroll",t),window.removeEventListener("wheel",t),window.removeEventListener("touchmove",t),window.removeEventListener("resize",a),clearInterval(r),console.log("🧹 FormSubmit scroll listeners cleaned up")},console.log("✅ FormSubmit scroll detection setup complete with 40% trigger + multiple listeners"),setTimeout((()=>{console.log("🔍 FormSubmit initial scroll check..."),t()}),1e3)}))},loadMoreItems(){console.log(`🔘 FormSubmit loadMoreItems called manually - hasMore: ${this.hasMoreItems}, isLoading: ${this.isLoadingMore}`),this.lazy&&!this.isLoadingMore&&this.hasMoreItems?(this.isLoadingMore=!0,console.log(`📦 Auto-loading more form submit items: ${this.currentDisplayCount} + ${this.loadMoreCount}`),setTimeout((()=>{const e=Math.min(this.currentDisplayCount+this.loadMoreCount,this.listItems.length);this.currentDisplayCount=e,this.isLoadingMore=!1,console.log(`✅ Auto-loaded more form submit items. Showing: ${this.currentDisplayCount}/${this.listItems.length}`),this.hasMoreItems&&this.listItems.length-this.currentDisplayCount<=this.loadMoreCount&&(console.log("🚀 Near end, loading remaining form submit items..."),setTimeout((()=>{this.loadMoreItems()}),50))}),50)):console.log(`🚫 FormSubmit loadMoreItems blocked - lazy: ${this.lazy}, isLoading: ${this.isLoadingMore}, hasMore: ${this.hasMoreItems}`)},resetDisplayCount(){this.currentDisplayCount=this.initialDisplayCount,this.isLoadingMore=!1,this.listItems.length<=20?(console.log(`📊 Small form submit dataset (${this.listItems.length} items), showing all immediately`),this.currentDisplayCount=this.listItems.length):(console.log(`📊 Form submit dataset (${this.listItems.length} items), using progressive loading - Initial: ${this.initialDisplayCount}`),this.listItems.length<=100&&(console.log("🚀 Medium dataset detected, starting immediate chain loading..."),setTimeout((()=>{this.hasMoreItems&&!this.isLoadingMore&&this.loadMoreItems()}),300)))},toggleLazyMode(){this.lazy=!this.lazy,console.log("🔄 FormSubmit lazy rendering: "+(this.lazy?"Enabled":"Disabled")),this.lazy?(this.resetDisplayCount(),this.$nextTick((()=>{this.setupScrollDetection()}))):this.scrollCleanup&&this.scrollCleanup()}},async mounted(){try{const e=new URLSearchParams(window.location.search),t=e.get("page");if(t&&/^\d+$/.test(t))this.currentPage=parseInt(t);else{const e=n.A.get("session");if(e&&e.currentPage){this.currentPage=e.currentPage;const t=new URLSearchParams(window.location.search);t.set("page",e.currentPage);const s=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",s)}}const s=n.A.get("session");s&&s.searchQuery&&(this.searchQuery=s.searchQuery);const a=s.limitItem;a&&(this.limitItem=a),await this.getCourse(),await this.getData(),this.$nextTick((()=>{this.lazy&&this.hasMoreItems&&(console.log("🚀 Immediate post-mount loading check..."),setTimeout((()=>{this.hasMoreItems&&!this.isLoadingMore&&(console.log("🚀 Post-mount auto-load triggered"),this.loadMoreItems())}),500))})),this.lazy&&this.$nextTick((()=>{this.setupScrollDetection()}))}catch(e){console.log(Error)}},beforeUnmount(){this.scrollCleanup&&this.scrollCleanup()},setup(){},watch:{"activeFormStatus.code"(){this.selectedData=[],this.getData()},selectedItems:{handler(){this.addToHeaderGroup()},deep:!0},searchQuery(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((()=>{this.getData();const e=n.A.get("session");e.searchQuery=this.searchQuery,n.A.set("session",e),this.currentPage=1;const t=new URLSearchParams(window.location.search);t.set("page",e.currentPage);const s=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",s)}),500)},$route(e,t){e.params.status!==t.params.status&&(this.dataStatus=e.params.status,this.getData(e.params.status).then((()=>{console.log("Data fetched successfully.")})).catch((e=>{console.error(e)})))}},computed:{filteredFormData(){if(!this.item||!this.item.formData)return[];const e={...this.item.formData};return delete e["setData"],e},areAllSelected(){return this.listItems.length&&this.listItems.every((e=>this.selectedData.includes(e._id)))},sortedListItems(){const e=[...this.listItems];return e.sort(((e,t)=>{const s=e=>this.headerGroup.indexOf(e);return s(e.formItem.name)-s(t.formItem.name)})),e},filteredListItems(){return"All"===this.selectedStatus?this.listItems:this.listItems.filter((e=>e.status===this.selectedStatus))},activeStatus(){const e=this.$route.params.status;return this.postData.status.find((t=>t.slug===e))},visibleItems(){if(!this.lazy)return console.log(`👁️ Showing ALL form submit items (lazy disabled): ${this.listItems.length} items`),this.listItems;const e=this.listItems.slice(0,this.currentDisplayCount);return console.log(`👁️ Showing form submit items: ${e.length}/${this.listItems.length} (displayCount: ${this.currentDisplayCount})`),e},hasMoreItems(){const e=this.lazy&&this.currentDisplayCount<this.listItems.length;return this.lazy&&console.log(`❓ hasMoreItems: ${e} (displayCount: ${this.currentDisplayCount}, total: ${this.listItems.length})`),e},debugHeaderInfo(){const e={headerGroupLength:this.headerGroup.length,headerGroup:this.headerGroup,formDataArrayLength:this.formDataArray.length,formDataArray:this.formDataArray.slice(0,5),hasData:this.listItems.length>0,firstItemStructure:this.listItems[0]?Object.keys(this.listItems[0].formData||{}):[]};return console.log("🔍 FormSubmit header debug:",e),e},safeHeaderGroup(){if(0===this.headerGroup.length&&this.listItems.length>0){console.warn("⚠️ FormSubmit empty headerGroup, attempting auto-recovery...");const e=this.listItems[0];if(e?.formData){const t=Object.keys(e.formData).map((t=>{const s=e.formData[t];return s?.name||s||t})).filter((e=>e&&"setData"!==e)).slice(0,10);return console.log("🔧 FormSubmit auto-recovered headers:",t),t}return["ข้อมูล","รายละเอียด"]}return this.headerGroup}}};const Kv=(0,rr.A)(qv,[["render",fv]]);var Hv=Kv;const zv={class:"icon-picker relative"},Gv={key:1,class:"absolute top-12 left-0 bg-white rounded-lg shadow-lg border border-gray-200 z-50 w-80 max-h-96 overflow-hidden"},Jv={class:"px-4 py-3 border-b border-gray-200 bg-gray-50"},Yv={class:"flex items-center justify-between"},Zv={class:"max-h-80 overflow-y-auto"},ew={class:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-3"},tw={class:"grid grid-cols-8 gap-2"},sw=["onClick","onMouseenter","onMouseleave"],aw={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded whitespace-nowrap z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-200"},ow={class:"px-4 py-3 bg-gray-50 border-t border-gray-200"},iw={class:"flex items-center justify-between text-xs text-gray-500"},rw={key:0,class:"font-medium text-gray-700"};function nw(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)("div",zv,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.togglePanel&&r.togglePanel(...e)),class:(0,l.C4)(["w-10 h-10 bg-white border border-gray-300 rounded-lg flex items-center justify-center hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",{"border-blue-500 bg-blue-50":i.showPanel}])},[(0,a.bF)(n,{icon:["fas",i.selectedIcon||"home"],class:(0,l.C4)(["text-gray-600 text-sm",{"text-blue-600":i.showPanel}])},null,8,["icon","class"])],2),i.showPanel?((0,a.uX)(),(0,a.CE)("div",{key:0,onClick:t[1]||(t[1]=(...e)=>r.togglePanel&&r.togglePanel(...e)),class:"fixed inset-0 bg-black bg-opacity-20 z-40"})):(0,a.Q3)("",!0),i.showPanel?((0,a.uX)(),(0,a.CE)("div",Gv,[(0,a.Lk)("div",Jv,[(0,a.Lk)("div",Yv,[t[3]||(t[3]=(0,a.Lk)("h3",{class:"text-sm font-semibold text-gray-900"},"เลือกไอคอน",-1)),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.togglePanel&&r.togglePanel(...e)),class:"w-6 h-6 rounded-md flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-200 transition-colors"},[(0,a.bF)(n,{icon:["fas","times"],class:"text-xs"})])])]),(0,a.Lk)("div",Zv,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.validatedIconGroups,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:s,class:"p-4 border-b border-gray-100 last:border-b-0"},[(0,a.Lk)("h4",ew,(0,l.v_)(s),1),(0,a.Lk)("div",tw,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e,((e,o)=>((0,a.uX)(),(0,a.CE)("button",{key:o,onClick:t=>r.selectIcon(e),class:(0,l.C4)(["group relative w-8 h-8 rounded-md border border-gray-200 flex items-center justify-center hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",{"border-blue-500 bg-blue-100 text-blue-600":e===i.selectedIcon,"text-gray-600":e!==i.selectedIcon}]),onMouseenter:e=>r.showTooltip(s,o),onMouseleave:e=>r.hideTooltip(s,o)},[(0,a.bF)(n,{icon:["fas",e],class:"text-xs transition-colors"},null,8,["icon"]),r.isTooltipActive(s,o)?((0,a.uX)(),(0,a.CE)("div",aw,[(0,a.eW)((0,l.v_)(r.formattedIconName(e))+" ",1),t[4]||(t[4]=(0,a.Lk)("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-2 border-r-2 border-t-2 border-transparent border-t-gray-900"},null,-1))])):(0,a.Q3)("",!0)],42,sw)))),128))])])))),128))]),(0,a.Lk)("div",ow,[(0,a.Lk)("div",iw,[t[5]||(t[5]=(0,a.Lk)("span",null,"เลือกไอคอนที่ต้องการ",-1)),i.selectedIcon?((0,a.uX)(),(0,a.CE)("span",rw,(0,l.v_)(r.formattedIconName(i.selectedIcon)),1)):(0,a.Q3)("",!0)])])])):(0,a.Q3)("",!0)])}var lw={props:{value:String,statusIndex:Number,icon:String},data(){const e={"สำนักงาน":["home","briefcase","desktop","building","school","university","file","pen","calendar","clock","flag","trophy","book","archive"],"อารมณ์":["heart","thumbs-up","smile","laugh","grin","meh","frown","angry","surprise","kiss","star","fire"],"สถานะ":["cog","globe","bell","comments","music","rocket","check","times","check-circle","times-circle","exclamation-triangle","info-circle","question-circle","plus-circle","minus-circle"],"การเงิน":["credit-card","shopping-bag","shopping-cart","wallet","money-bill-wave","receipt","tag","gift","dollar-sign","coins","cash-register"],"เอกสาร":["file-alt","file-pdf","file-word","file-excel","file-powerpoint","file-image","file-video","folder","folder-open","copy","clipboard","download","upload"],"เทคโนโลยี":["laptop","mobile","tablet","keyboard","mouse","server","database","wifi","code","terminal","bug","cogs","microchip"]},t="home",s=this.value||this.icon||t;return{iconGroups:e,selectedIcon:s,showPanel:!1,tooltipIndexes:{}}},watch:{value(e){this.selectedIcon=e}},computed:{validatedIconGroups(){return Object.fromEntries(Object.entries(this.iconGroups).map((([e,t])=>[e,t.filter((e=>"string"===typeof e&&""!==e.trim()))])))}},methods:{selectIcon(e){this.selectedIcon=e||"home",this.$emit("input",{icon:this.selectedIcon,statusIndex:this.statusIndex}),this.showPanel=!1},togglePanel(){this.showPanel=!this.showPanel},formattedIconName(e){return e.replace(/-/g," ").replace(/\b\w/g,(e=>e.toUpperCase()))},showTooltip(e,t){this.tooltipIndexes[e]=t},hideTooltip(e){delete this.tooltipIndexes[e]},isTooltipActive(e,t){return this.tooltipIndexes[e]===t}},mounted(){document.addEventListener("click",(e=>{this.$el.contains(e.target)||(this.showPanel=!1)}))},beforeUnmount(){document.removeEventListener("click",this.closePanel)}};const cw=(0,rr.A)(lw,[["render",nw],["__scopeId","data-v-21f24788"]]);var dw=cw;const uw=new mr.A(!1);var mw={props:{examCount:Number,courseData:Object,dataItem:String,examData:Array,examTypeProp:Array,tabs:Object},data(){return{configs:n.A.get("configs"),session:n.A.get("session"),expandedStatus:{},form:[],formAssign:[],expandedForm:!1,loadStatus:!1,updateTrigger:!1,statusArray:[],formStatus:[],codeArray:[],returnStatusArray:[],newStatus:{name:"",description:"",code:"",icon:""},selectedStatusFromFirstChild:null,allitemCount:0,currentActiveStatus:"all",activeBlock:!1,lazy:!0,initialDisplayCount:20,loadMoreCount:10,currentDisplayCount:20,isLoadingMore:!1,scrollCleanup:null}},components:{dataStatus:af,dataSubmit:Hv,IconPicker:dw},async mounted(){try{await this.getForm(),this.lazy&&this.$nextTick((()=>{this.setupScrollDetection()}))}catch(e){console.error(e)}},beforeUnmount(){this.scrollCleanup&&this.scrollCleanup()},methods:{async updateStatusViewer(e){await this.getForm(!1),this.currentActiveStatus=e.status},handleStatusUpdate(e){this.returnStatusArray=e},updateStatusBadges(e,t){return e.map((e=>{const s=t[e.code]||0;return{...e,badge:s}}))},async countStatus(){try{const e={$group:{_id:null}};this.codeArray.forEach((t=>{e.$group[t]={$sum:{$cond:[{$eq:["$process",t]},1,0]}}}));const t=[{$match:{formID:this.formAssign._id,courseID:this.courseData._id}},e],s={pipeline:t},a=performance.now();console.log(`⏱️ countStatus started - FormID: ${this.formAssign._id}, CourseID: ${this.courseData._id}`);const{data:o,status:i}=await this.$Request.POST("form/aggregate",s,this.configs.key),r=performance.now(),n=(r-a).toFixed(2);if(200===i){const e=o[0];let t=0;this.codeArray.forEach((s=>{t+=e[s]||0})),this.formStatus=this.updateStatusBadges(this.formStatus,e),this.allitemCount=t,console.log(`✅ countStatus completed - Time: ${n}ms, Total items: ${t}`),this.lazy&&this.resetDisplayCount()}else this.loading=!1,this.activeBlock=!1,console.log(`❌ countStatus failed - Time: ${n}ms`)}catch(e){console.log(e),this.loading=!1,this.activeBlock=!1}},handleStatusSelected(e){this.selectedStatusFromFirstChild=e},toggleAssignForm(e,t){this.isFormAssigned(e)?this.assignForm(null,t):this.assignForm(e,t)},isFormAssigned(e){return this.courseData.formID===e},async assignForm(e,t){try{const s=this.form[t];!s.default&&this.courseData||console.error("Cannot assign the cerification to the course.");const a={data:{formID:e}},o=await uw.PUT(`course/${this.courseData._id}`,a,this.configs.key);200===o.status?await this.getForm():console.error("Error assigning cerification to the course:",o.statusText)}catch(s){throw console.error("An error occurred while assigning the cerification to the course:",s),s}},async setDefaultForm(e){this.form.forEach((async t=>{t._id===e?(this.selectedFormItem=t,t.default=!0,await this.updateForm(t,!0)):(this.selectedFormItem=t,t.default=!1,await this.updateForm(t,!1))}))},async updateForm(e,t){try{const e={data:{default:t}},s=await uw.PUT(`post/${this.selectedFormItem._id}`,e,this.configs.key);200===s.status?await this.getForm():console.error("Error updating cerification:",s.statusText)}catch(s){throw console.error("An error occurred while updating cerification:",s),s}},async saveFormStatus(e){try{const t={data:{status:this.statusArray}},s=await uw.PUT(`post/${e}`,t,this.configs.key);200===s.status?await this.getForm():console.error("Error updating cerification:",s.statusText)}catch(t){throw console.error("An error occurred while updating cerification:",t),t}},async getForm(){const e=performance.now();try{console.log(`⏱️ getForm started - Fetching forms for user: ${this.session.current._id}`);const t={method:"find",args:[{$and:[{owner:this.session.current._id,type:"form",action:"course"}]}]},s=performance.now(),a=await uw.POST("post/query",t,this.configs.key),o=performance.now(),i=(o-s).toFixed(2);if(200!==a.status)throw new Error("Failed to fetch form data from API");const r=performance.now();if(this.form=a.data,this.courseData.formID)await this.getAssignForm(this.courseData.formID);else{const e=this.form.filter((e=>!0===e.default));e.length>0&&this.setFormAssignData(e[0])}const n=performance.now(),l=(n-r).toFixed(2);this.lazy&&this.resetDisplayCount();const c=performance.now(),d=(c-e).toFixed(2);console.log(`✅ getForm completed - Total: ${d}ms`),console.log("📈 Performance breakdown:"),console.log(`  🗄️  MongoDB Processing: ${i}ms`),console.log(`  🔄 Data Transformation: ${l}ms`),console.log(`  📊 Forms loaded: ${this.form.length}`)}catch(t){const s=performance.now(),a=(s-e).toFixed(2);console.log(`❌ getForm error - Time: ${a}ms, Error:`,t),console.error("An error occurred while fetching form data:",t)}},async getAssignForm(e){try{const{status:t,data:s}=await this.$Request.GET(`post/${e}`,this.configs.key);200===t&&this.setFormAssignData(s)}catch(t){console.log(t)}},setFormAssignData(e){console.log("formItem",e.status),this.formAssign=e,this.formStatus=Array.isArray(e.status)?e.status.filter((e=>"object"===typeof e&&e.icon)):[],this.statusArray=[...this.formStatus],this.codeArray=this.formStatus.map((e=>e.code)),this.loadStatus=!0,this.countStatus()},toggleExpand(e){this.expandedStatus[e]=!this.expandedStatus[e]},toggleExpandForm(){this.expandedForm=!this.expandedForm},isExpanded(e){return this.expandedStatus[e]},updateIcon({icon:e,statusIndex:t}){this.statusArray[t].icon=e},isDuplicateCode(){const e=new Set;for(const t of this.statusArray){if(e.has(t.code))return!0;e.add(t.code)}return!1},addStatus(){const e=!1;e?(alert("Status with a duplicate code already exists!"),this.statusArray.length>0&&(this.statusArray[this.statusArray.length-1].code="")):(this.statusArray.push({name:this.newStatus.name,description:this.newStatus.description,code:this.newStatus.code,icon:this.newStatus.icon,options:[]}),this.newStatus.name="",this.newStatus.description="",this.newStatus.code="",this.newStatus.icon="")},deleteStatus(e){this.statusArray.splice(e,1)},addOption(e){this.statusArray[e].options.push("")},deleteOption(e,t){this.statusArray[e].options.splice(t,1)},moveStatusUp(e){if(e>0){const t=this.statusArray[e];this.statusArray[e]=this.statusArray[e-1],this.statusArray[e-1]=t}},moveStatusDown(e){if(e<this.statusArray.length-1){const t=this.statusArray[e];this.statusArray[e]=this.statusArray[e+1],this.statusArray[e+1]=t}},loadMoreItems(){this.lazy&&!this.isLoadingMore&&this.hasMoreItems&&(this.isLoadingMore=!0,console.log(`📦 Auto-loading more form items: ${this.currentDisplayCount} + ${this.loadMoreCount}`),setTimeout((()=>{const e=Math.min(this.currentDisplayCount+this.loadMoreCount,this.form.length);this.currentDisplayCount=e,this.isLoadingMore=!1,console.log(`✅ Auto-loaded more form items. Showing: ${this.currentDisplayCount}/${this.form.length}`),this.hasMoreItems&&this.form.length-this.currentDisplayCount<=this.loadMoreCount&&(console.log("🚀 Near end, loading remaining form items..."),setTimeout((()=>{this.loadMoreItems()}),100))}),150))},setupScrollDetection(){this.lazy&&this.$nextTick((()=>{const e=[this.$el?.querySelector(".overflow-y-auto"),this.$el?.querySelector(".bg-blue-50"),document.querySelector(".overflow-y-auto"),document.querySelector("[data-content]"),document.querySelector(".divide-y"),document.body,window];let t=null;for(const i of e)if(i&&i!==document.body){t=i;break}t||(console.warn("Form scroll container not found, using window"),t=window),console.log("📋 Form using scroll container:",t===window?"window":t);const s=()=>{if(!this.hasMoreItems||this.isLoadingMore)return;let e;if(t===window){const t=window.pageYOffset||document.documentElement.scrollTop,s=document.documentElement.scrollHeight,a=window.innerHeight;e=(t+a)/s}else{const{scrollTop:s,scrollHeight:a,clientHeight:o}=t;e=(s+o)/a}e>.8&&(console.log(`📊 Form scroll reached ${(100*e).toFixed(1)}%, auto-loading more items...`),this.loadMoreItems())},a=[t];t!==window&&(a.push(window),a.push(document.body)),a.forEach((e=>{e.addEventListener("scroll",s,{passive:!0}),e.addEventListener("wheel",s,{passive:!0})}));const o=setInterval((()=>{this.hasMoreItems&&!this.isLoadingMore?(console.log("⏰ Form fallback timer triggered auto-load"),this.loadMoreItems()):this.hasMoreItems||(clearInterval(o),console.log("✅ All form items loaded, clearing fallback timer"))}),5e3);this.scrollCleanup=()=>{a.forEach((e=>{e.removeEventListener("scroll",s),e.removeEventListener("wheel",s)})),clearInterval(o)},console.log("✅ Form scroll detection setup complete with 80% trigger + 5s fallback timer"),setTimeout((()=>{this.hasMoreItems&&!this.isLoadingMore&&(console.log("🚀 Form initial auto-load trigger (delayed)"),this.loadMoreItems())}),3e3)}))},resetDisplayCount(){this.currentDisplayCount=this.initialDisplayCount,this.isLoadingMore=!1,this.form.length<=10?(console.log(`📊 Very small form dataset (${this.form.length} items), showing all immediately`),this.currentDisplayCount=this.form.length):console.log(`📊 Form dataset (${this.form.length} items), using progressive loading - Initial: ${this.initialDisplayCount}`)},toggleLazyMode(){this.lazy=!this.lazy,console.log("🔄 Form lazy rendering: "+(this.lazy?"Enabled":"Disabled")),this.lazy?(this.resetDisplayCount(),this.$nextTick((()=>{this.setupScrollDetection()}))):this.scrollCleanup&&this.scrollCleanup()}},computed:{visibleForm(){if(!this.lazy)return console.log(`👁️ Showing ALL forms (lazy disabled): ${this.form.length} items`),this.form;const e=this.form.slice(0,this.currentDisplayCount);return console.log(`👁️ Showing forms: ${e.length}/${this.form.length} (displayCount: ${this.currentDisplayCount})`),e},hasMoreItems(){const e=this.lazy&&this.currentDisplayCount<this.form.length;return this.lazy&&console.log(`❓ hasMoreItems: ${e} (displayCount: ${this.currentDisplayCount}, total: ${this.form.length})`),e}}};const gw=(0,rr.A)(mw,[["render",uy],["__scopeId","data-v-12b4da78"]]);var pw=gw;const hw={class:"bg-white rounded-lg shadow-sm border border-gray-200"},bw={class:"px-4 py-3 border-b border-gray-200"},xw={class:"flex items-center justify-between"},yw={class:"flex items-center space-x-3"},fw={class:"w-8 h-8 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center"},kw={class:"text-xs text-gray-500"},vw={class:"bg-blue-50 border-l-4 border-blue-400 p-3"},ww={class:"flex"},Lw={class:"flex-shrink-0"},Cw={class:"p-4"},Dw={key:0,class:"text-center py-8"},Sw={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},Fw={key:1,class:"space-y-3"},Iw={class:"p-4"},Ew={class:"flex items-center justify-between mb-3"},$w={class:"flex items-center space-x-3"},_w={class:"flex-shrink-0"},Pw=["onClick","title"],Tw=["src","alt"],Aw={class:"certificate-thumbnail-overlay"},Xw=["onClick","title"],jw={class:"flex-1 min-w-0"},Uw={class:"flex items-center space-x-2 mb-1"},Bw={key:0,class:"flex items-center space-x-2 flex-1"},Ow={class:"text-base font-semibold text-gray-900"},Qw=["onBlur","onKeyup"],Mw=["onClick"],Vw={key:1,class:"flex items-center space-x-2 flex-1 group"},Rw={class:"text-base font-semibold text-gray-900"},Ww=["onClick"],Nw={key:2,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},qw={key:3,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Kw={class:"flex items-center space-x-3 text-xs text-gray-500"},Hw={class:"flex items-center"},zw={class:"font-medium text-gray-900 ml-1"},Gw={class:"flex items-center"},Jw={class:"font-medium text-gray-900 ml-1"},Yw={class:"flex items-center justify-between pt-3 border-t border-gray-200"},Zw={class:"flex items-center space-x-2"},eL=["onClick"],tL=["onClick"],sL={class:"flex items-center space-x-1"},aL=["onClick"],oL=["onClick"],iL={key:0,class:"fullscreen-modal"},rL={class:"fullscreen-modal-container"},nL={class:"fullscreen-modal-header"},lL={class:"flex items-center justify-between"},cL={class:"flex items-center space-x-3"},dL={class:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center"},uL={class:"text-sm text-gray-500"},mL={class:"flex items-center space-x-2"},gL={class:"hidden sm:flex items-center px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium"},pL={class:"fullscreen-modal-content"};function hL(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon"),d=(0,a.g2)("CertificationBuilder");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",hw,[(0,a.Lk)("div",bw,[(0,a.Lk)("div",xw,[(0,a.Lk)("div",yw,[(0,a.Lk)("div",fw,[(0,a.bF)(n,{icon:["fas","certificate"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[8]||(t[8]=(0,a.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"ใบรับรอง",-1)),(0,a.Lk)("p",kw,"จัดการใบรับรองของหลักสูตร ("+(0,l.v_)(i.certList.length)+" รายการ)",1)])]),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.saveCertConfig&&r.saveCertConfig(...e)),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-purple-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-1.5"}),t[9]||(t[9]=(0,a.eW)(" เพิ่มใบรับรอง "))])])]),(0,a.Lk)("div",vw,[(0,a.Lk)("div",ww,[(0,a.Lk)("div",Lw,[(0,a.bF)(n,{icon:["fas","info-circle"],class:"text-blue-400 text-sm"})]),t[10]||(t[10]=(0,a.Lk)("div",{class:"ml-2"},[(0,a.Lk)("p",{class:"text-xs text-blue-700"},[(0,a.Lk)("strong",null,"หมายเหตุ:"),(0,a.eW)(' หากไม่มีการ Assign ใบรับรองให้กับหลักสูตรนี้ หากหลักสูตรนี้มีการตั้งค่าให้แสดง ระบบจะดึงใบรับรองที่ถูกตั้งค่าเป็น "Default" มาใช้แสดงผล ')])],-1))])]),(0,a.Lk)("div",Cw,[0===i.certList.length?((0,a.uX)(),(0,a.CE)("div",Dw,[(0,a.Lk)("div",Sw,[(0,a.bF)(n,{icon:["fas","certificate"],class:"text-gray-400 text-lg"})]),t[12]||(t[12]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ยังไม่มีใบรับรอง",-1)),t[13]||(t[13]=(0,a.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"เริ่มต้นสร้างใบรับรองสำหรับหลักสูตรนี้",-1)),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.saveCertConfig&&r.saveCertConfig(...e)),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-purple-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-1.5"}),t[11]||(t[11]=(0,a.eW)(" สร้างใบรับรองแรก "))])])):((0,a.uX)(),(0,a.CE)("div",Fw,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.certList,((e,o)=>((0,a.uX)(),(0,a.CE)("div",{key:e._id,class:"bg-white border border-gray-200 rounded-lg hover:shadow-md transition-shadow duration-200"},[(0,a.Lk)("div",Iw,[(0,a.Lk)("div",Ew,[(0,a.Lk)("div",$w,[(0,a.Lk)("div",_w,[e.pages&&e.pages[0]&&e.pages[0].backgroundImage?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"certificate-thumbnail group cursor-pointer w-12 h-12",onClick:t=>r.toggleExpand(e),title:`ดูตัวอย่าง ${e.name}`},[(0,a.Lk)("img",{src:e.pages[0].backgroundImage,alt:e.name,class:"w-full h-full object-cover",onError:t[2]||(t[2]=(...e)=>r.handleImageError&&r.handleImageError(...e))},null,40,Tw),(0,a.Lk)("div",Aw,[(0,a.bF)(n,{icon:["fas","eye"],class:"thumbnail-icon text-sm"})])],8,Pw)):((0,a.uX)(),(0,a.CE)("div",{key:1,class:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center cursor-pointer hover:bg-purple-200 transition-colors",onClick:t=>r.toggleExpand(e),title:`แก้ไข ${e.name}`},[(0,a.bF)(n,{icon:["fas","certificate"],class:"text-purple-600 text-base"})],8,Xw))]),(0,a.Lk)("div",jw,[(0,a.Lk)("div",Uw,[i.editingCertId===e._id?((0,a.uX)(),(0,a.CE)("div",Bw,[(0,a.Lk)("span",Ow,(0,l.v_)(o+1)+".",1),(0,a.bo)((0,a.Lk)("input",{ref_for:!0,ref:`nameInput_${e._id}`,"onUpdate:modelValue":t[3]||(t[3]=e=>i.editingCertName=e),onBlur:t=>r.saveNameEdit(e),onKeyup:[(0,c.jR)((t=>r.saveNameEdit(e)),["enter"]),t[4]||(t[4]=(0,c.jR)(((...e)=>r.cancelNameEdit&&r.cancelNameEdit(...e)),["escape"]))],class:"flex-1 text-base font-semibold bg-white border border-blue-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"ชื่อใบรับรอง"},null,40,Qw),[[c.Jo,i.editingCertName]]),(0,a.Lk)("button",{onClick:t=>r.saveNameEdit(e),class:"p-1 text-green-600 hover:text-green-700 hover:bg-green-50 rounded transition-colors",title:"บันทึก"},[(0,a.bF)(n,{icon:["fas","check"],class:"text-sm"})],8,Mw),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>r.cancelNameEdit&&r.cancelNameEdit(...e)),class:"p-1 text-gray-600 hover:text-gray-700 hover:bg-gray-50 rounded transition-colors",title:"ยกเลิก"},[(0,a.bF)(n,{icon:["fas","times"],class:"text-sm"})])])):((0,a.uX)(),(0,a.CE)("div",Vw,[(0,a.Lk)("h3",Rw,(0,l.v_)(o+1)+". "+(0,l.v_)(e.name),1),(0,a.Lk)("button",{onClick:t=>r.startNameEdit(e),class:"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded transition-all",title:"แก้ไขชื่อ"},[(0,a.bF)(n,{icon:["fas","edit"],class:"text-xs"})],8,Ww)])),e.default?((0,a.uX)(),(0,a.CE)("span",Nw,[(0,a.bF)(n,{icon:["fas","star"],class:"mr-1 text-xs"}),t[14]||(t[14]=(0,a.eW)(" Default "))])):(0,a.Q3)("",!0),s.courseData.certificationId===e._id?((0,a.uX)(),(0,a.CE)("span",qw,[(0,a.bF)(n,{icon:["fas","check-circle"],class:"mr-1 text-xs"}),t[15]||(t[15]=(0,a.eW)(" Assigned "))])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",Kw,[(0,a.Lk)("span",Hw,[(0,a.bF)(n,{icon:["fas","star"],class:"mr-1 text-xs"}),t[16]||(t[16]=(0,a.eW)(" คะแนน: ")),(0,a.Lk)("span",zw,(0,l.v_)(e.score||"ไม่ระบุ"),1)]),t[18]||(t[18]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",Gw,[(0,a.bF)(n,{icon:["fas","file-alt"],class:"mr-1 text-xs"}),t[17]||(t[17]=(0,a.eW)(" หน้า: ")),(0,a.Lk)("span",Jw,(0,l.v_)(e.pages?e.pages.length:0),1)]),t[19]||(t[19]=(0,a.Lk)("span",{class:"text-gray-300"},"•",-1)),(0,a.Lk)("span",{class:(0,l.C4)(["certificate-stat-badge",e.pages&&e.pages[0]&&e.pages[0].backgroundImage?"has-background":"no-background"])},[(0,a.bF)(n,{icon:["fas",e.pages&&e.pages[0]&&e.pages[0].backgroundImage?"image":"image-slash"],class:"mr-1 text-xs"},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(e.pages&&e.pages[0]&&e.pages[0].backgroundImage?"มีพื้นหลัง":"ไม่มีพื้นหลัง"),1)],2)])])])]),(0,a.Lk)("div",Yw,[(0,a.Lk)("div",Zw,[(0,a.Lk)("button",{onClick:t=>r.setDefaultCert(e._id),class:(0,l.C4)([{"text-green-600 bg-green-50 border-green-200":e.default,"text-gray-600 bg-gray-50 border-gray-200 hover:bg-gray-100":!e.default},"inline-flex items-center px-2.5 py-1 border rounded-md text-xs font-medium transition-colors"])},[(0,a.bF)(n,{icon:["fas","bookmark"],class:"mr-1 text-xs"}),(0,a.eW)(" "+(0,l.v_)(e.default?"Default":"ตั้งเป็น Default"),1)],10,eL),(0,a.Lk)("button",{onClick:t=>r.toggleAssignCert(e._id,o),class:(0,l.C4)([{"text-blue-600 bg-blue-50 border-blue-200":s.courseData.certificationId===e._id,"text-gray-600 bg-gray-50 border-gray-200 hover:bg-gray-100":s.courseData.certificationId!==e._id},"inline-flex items-center px-2.5 py-1 border rounded-md text-xs font-medium transition-colors"])},[(0,a.bF)(n,{icon:["fas","link"],class:"mr-1 text-xs"}),(0,a.eW)(" "+(0,l.v_)(r.isCertAssigned(e._id)?"Unassign":"Assign"),1)],10,tL)]),(0,a.Lk)("div",sL,[(0,a.Lk)("button",{onClick:t=>r.toggleExpand(e),type:"button",class:"inline-flex items-center px-2.5 py-1 border border-gray-200 rounded-md text-xs font-medium text-gray-600 bg-white hover:bg-gray-50 transition-colors"},[(0,a.bF)(n,{icon:["fas","edit"],class:"mr-1 text-xs"}),t[20]||(t[20]=(0,a.eW)(" แก้ไข "))],8,aL),(0,a.Lk)("button",{onClick:t=>r.deleteCert(e._id,o),type:"button",class:"inline-flex items-center px-2.5 py-1 border border-red-200 rounded-md text-xs font-medium text-red-600 bg-red-50 hover:bg-red-100 transition-colors"},[(0,a.bF)(n,{icon:["fas","trash"],class:"mr-1 text-xs"}),t[21]||(t[21]=(0,a.eW)(" ลบ "))],8,oL)])])])])))),128))]))])]),(0,a.bF)(c.eB,{"enter-active-class":"fullscreen-modal-enter-active","leave-active-class":"fullscreen-modal-leave-active","enter-from-class":"fullscreen-modal-enter-from","leave-to-class":"fullscreen-modal-leave-to"},{default:(0,a.k6)((()=>[i.showModal?((0,a.uX)(),(0,a.CE)("div",iL,[(0,a.Lk)("div",{class:"fullscreen-modal-backdrop",onClick:t[6]||(t[6]=(...e)=>r.closeModal&&r.closeModal(...e))}),(0,a.Lk)("div",rL,[(0,a.Lk)("div",nL,[(0,a.Lk)("div",lL,[(0,a.Lk)("div",cL,[(0,a.Lk)("div",dL,[(0,a.bF)(n,{icon:["fas","certificate"],class:"text-purple-600"})]),(0,a.Lk)("div",null,[t[22]||(t[22]=(0,a.Lk)("h3",{class:"text-lg font-semibold text-gray-900"},"ออกแบบใบรับรอง",-1)),(0,a.Lk)("p",uL,(0,l.v_)(i.selectedCertItem?.name||"ใบรับรองใหม่"),1)])]),(0,a.Lk)("div",mL,[(0,a.Lk)("div",gL,[(0,a.bF)(n,{icon:["fas","expand"],class:"mr-1"}),t[23]||(t[23]=(0,a.eW)(" โหมดเต็มหน้าจอ "))]),(0,a.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>r.closeModal&&r.closeModal(...e)),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"ปิด (ESC)"},[(0,a.bF)(n,{icon:["fas","times"],class:"text-xl"})])])])]),(0,a.Lk)("div",pL,[(0,a.bF)(d,{certItem:i.selectedCertItem.pages,certName:i.selectedCertItem.name,onDataEmitted:r.handleDataFromChild,class:"certificate-builder-container"},null,8,["certItem","certName","onDataEmitted"])])])])):(0,a.Q3)("",!0)])),_:1})],64)}const bL={class:"flex bg-gradient-to-br from-gray-50 to-gray-100 overflow-hidden",style:{height:"calc(100vh - 81px)"}},xL={class:"w-64 bg-white border-r border-gray-200 flex flex-col shadow-lg"},yL={class:"px-4 py-3 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 flex-shrink-0"},fL={class:"flex items-center space-x-2 mb-2"},kL={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg"},vL={class:"bg-white rounded-lg border border-gray-200 p-2 shadow-sm"},wL={class:"text-center"},LL={class:"w-5 h-5 mx-auto mb-1 text-gray-400 group-hover:text-blue-500 transition-colors"},CL={class:"flex-1 overflow-y-auto p-3 min-h-0"},DL={class:"space-y-2"},SL=["onClick","disabled"],FL={class:"flex items-center space-x-2"},IL={class:"flex-1 text-left"},EL={class:"text-xs font-semibold text-gray-900"},$L={class:"text-xs text-gray-500 mt-0.5"},_L={class:"flex-shrink-0"},PL={class:"w-5 h-5 rounded-full bg-blue-100 flex items-center justify-center group-hover:bg-blue-200 transition-colors"},TL={class:"p-3 border-t border-gray-200 bg-gradient-to-r from-gray-50 to-slate-50 flex-shrink-0"},AL={class:"space-y-2"},XL={class:"flex items-center space-x-2"},jL={class:"text-xs text-gray-500 mt-1"},UL={class:"flex space-x-1"},BL={class:"flex-1 flex flex-col min-w-0"},OL={class:"bg-white border-b border-gray-200 px-4 py-3 shadow-sm flex-shrink-0"},QL={class:"flex items-center justify-between"},ML={class:"flex items-center space-x-3"},VL={class:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-lg"},RL={class:"text-base font-semibold text-gray-900"},WL={class:"text-xs text-gray-500"},NL={class:"flex items-center space-x-2"},qL={class:"flex-1 p-4 overflow-auto bg-gradient-to-br from-gray-50 to-gray-100 min-h-0"},KL={class:"flex justify-center items-center h-full"},HL={key:0,class:"absolute inset-0 flex items-center justify-center text-gray-400"},zL={class:"text-center p-6"},GL={class:"w-12 h-12 mx-auto mb-3 bg-gray-100 rounded-full flex items-center justify-center"},JL=["onClick"],YL={key:0},ZL={key:0,class:"watermark-text"},eC={key:1},tC=["src"],sC={key:1},aC=["src"],oC={key:1,class:"placeholder-content",style:{color:"#6b7280","font-size":"12px","text-align":"center",padding:"10px"}},iC=["src"],rC={key:2},nC={key:2},lC=["innerHTML"],cC={class:"w-72 bg-white border-l border-gray-200 flex flex-col shadow-lg"},dC={class:"px-4 py-3 border-b border-gray-200 bg-gradient-to-r from-green-50 to-emerald-50 flex-shrink-0"},uC={class:"flex items-center space-x-2"},mC={class:"w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center shadow-lg"},gC={class:"flex-1 overflow-y-auto p-3 min-h-0"},pC={key:0,class:"space-y-2"},hC={class:"flex items-center justify-between p-2 border-b border-gray-200 bg-white"},bC=["onClick"],xC={class:"font-semibold text-gray-900 text-xs"},yC={class:"text-xs text-gray-500"},fC={class:"flex items-center space-x-1"},kC=["onClick"],vC=["onClick"],wC=["onClick"],LC={key:0,class:"p-2 space-y-3"},CC={class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-2"},DC={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},SC={class:"grid grid-cols-2 gap-2"},FC={class:"flex items-center space-x-1"},IC=["onClick"],EC={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},$C=["onClick"],_C={class:"flex items-center space-x-1"},PC=["onClick"],TC={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},AC=["onClick"],XC={key:0,class:"space-y-2"},jC={key:0,class:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-2"},UC={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},BC=["onUpdate:modelValue"],OC={key:1,class:"bg-gradient-to-r from-indigo-50 to-blue-50 rounded-lg p-2"},QC={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},MC={class:"space-y-2"},VC={class:"flex items-center space-x-2"},RC=["onUpdate:modelValue"],WC={class:"text-xs text-gray-500 mt-1"},NC={key:0,class:"space-y-2 border-l-2 border-indigo-200 pl-3 ml-1 bg-white rounded-md p-2"},qC={class:"text-xs font-medium text-indigo-700 mb-1"},KC=["onUpdate:modelValue"],HC={class:"text-xs text-gray-500 mt-1"},zC=["onUpdate:modelValue"],GC={class:"text-xs text-gray-500 mt-1"},JC={class:"bg-gray-50 rounded-md p-2 border border-gray-200"},YC={class:"text-sm font-medium text-gray-900"},ZC={key:2,class:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-2"},eD={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},tD={class:"space-y-2"},sD={class:"space-y-2"},aD={class:"flex items-center space-x-2"},oD=["onUpdate:modelValue"],iD={class:"flex items-center space-x-2"},rD=["onUpdate:modelValue"],nD={key:0},lD={class:"flex items-center space-x-1"},cD=["onClick"],dD=["onUpdate:modelValue"],uD=["onClick"],mD={class:"text-xs text-gray-500 mt-1"},gD={key:1},pD=["onUpdate:modelValue"],hD={key:0,class:"mt-2"},bD=["onUpdate:modelValue"],xD={class:"flex items-center space-x-2"},yD=["onUpdate:modelValue"],fD={key:2,class:"space-y-2"},kD={class:"flex justify-between items-center"},vD=["onClick"],wD={class:"flex justify-between items-center mb-1"},LD=["onClick"],CD=["onClick"],DD={key:0,class:"space-y-1"},SD=["onUpdate:modelValue"],FD=["onUpdate:modelValue"],ID={key:3},ED={class:"bg-gradient-to-r from-indigo-50 to-blue-50 rounded-lg p-2"},$D={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},_D={class:"space-y-2"},PD={class:"flex items-center space-x-1"},TD=["onClick"],AD={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},XD=["onClick"],jD={class:"flex space-x-1"},UD=["onClick"],BD=["onClick"],OD=["onClick"],QD={class:"bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg p-2"},MD={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},VD={class:"space-y-2"},RD=["onUpdate:modelValue"],WD=["onUpdate:modelValue"],ND={key:1,class:"space-y-2"},qD={class:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-2"},KD={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},HD=["onUpdate:modelValue"],zD={class:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-2"},GD={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},JD={class:"grid grid-cols-2 gap-2"},YD={class:"flex items-center space-x-1"},ZD=["onClick"],eS={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},tS=["onClick"],sS={class:"flex items-center space-x-1"},aS=["onClick"],oS={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},iS=["onClick"],rS={class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-2"},nS={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},lS={class:"grid grid-cols-2 gap-2"},cS={class:"flex items-center space-x-1"},dS=["onClick"],uS={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},mS=["onClick"],gS={class:"flex items-center space-x-1"},pS=["onClick"],hS={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},bS=["onClick"],xS={class:"bg-gradient-to-r from-gray-50 to-slate-50 rounded-lg p-2"},yS={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},fS={class:"space-y-2"},kS={class:"flex items-center space-x-2"},vS=["onUpdate:modelValue"],wS={key:0},LS=["onUpdate:modelValue"],CS={key:0,class:"space-y-2"},DS={class:"bg-gradient-to-r from-emerald-50 to-green-50 rounded-lg p-2"},SS={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},FS=["onClick"],IS={class:"text-center"},ES={class:"w-6 h-6 mx-auto mb-1 text-emerald-400 group-hover:text-emerald-500 transition-colors"},$S={class:"text-xs font-medium text-emerald-600 group-hover:text-emerald-700"},_S={key:0,class:"text-xs text-gray-500 mt-1 truncate max-w-32"},PS={class:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-2"},TS={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},AS={class:"space-y-2"},XS={class:"flex items-center space-x-2"},jS=["onUpdate:modelValue"],US={key:0,class:"grid grid-cols-2 gap-2"},BS={class:"flex items-center space-x-1"},OS=["onClick"],QS={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},MS=["onClick"],VS={class:"flex items-center space-x-1"},RS=["onClick"],WS={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},NS=["onClick"],qS={key:1},KS={class:"flex items-center space-x-1"},HS=["onClick"],zS={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},GS=["onClick"],JS={class:"text-xs text-gray-500 mt-1"},YS={class:"bg-gradient-to-r from-purple-50 to-violet-50 rounded-lg p-2"},ZS={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},eF={class:"mb-2"},tF={class:"flex items-center space-x-2"},sF=["onUpdate:modelValue"],aF=["onUpdate:modelValue"],oF={class:"text-xs text-gray-500 mt-1"},iF={key:1,class:"space-y-2"},rF={class:"bg-gradient-to-r from-cyan-50 to-blue-50 rounded-lg p-2"},nF={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},lF={class:"space-y-2"},cF=["onUpdate:modelValue"],dF=["onUpdate:modelValue"],uF={key:0,class:"space-y-2"},mF=["onUpdate:modelValue"],gF={class:"flex items-center space-x-1"},pF=["onClick"],hF={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},bF=["onClick"],xF=["onUpdate:modelValue"],yF={class:"flex items-center space-x-1"},fF=["onClick"],kF={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},vF=["onClick"],wF={key:1,class:"space-y-2"},LF=["onClick"],CF={class:"text-center"},DF={class:"w-6 h-6 mx-auto mb-1 text-cyan-400 group-hover:text-cyan-500 transition-colors"},SF={key:0,class:"text-xs text-gray-500 mt-1 truncate max-w-32"},FF={class:"grid grid-cols-2 gap-2"},IF={class:"flex items-center space-x-1"},EF=["onClick"],$F={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},_F=["onClick"],PF={class:"flex items-center space-x-1"},TF=["onClick"],AF={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},XF=["onClick"],jF={class:"flex items-center space-x-1"},UF=["onClick"],BF={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},OF=["onClick"],QF={class:"flex items-center space-x-1"},MF=["onClick"],VF={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},RF=["onClick"],WF={key:2,class:"bg-gradient-to-r from-red-50 to-pink-50 rounded-lg p-2"},NF={class:"text-xs font-semibold text-gray-900 mb-2 flex items-center"},qF={class:"space-y-2"},KF=["onClick"],HF={class:"text-center"},zF={class:"w-6 h-6 mx-auto mb-1 text-red-400 group-hover:text-red-500 transition-colors"},GF={key:0,class:"text-xs text-gray-500 mt-1 truncate max-w-32"},JF={class:"flex items-center space-x-1"},YF=["onClick"],ZF={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},eI=["onClick"],tI={class:"flex items-center space-x-1"},sI=["onClick"],aI={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},oI=["onClick"],iI={class:"flex items-center space-x-1"},rI=["onClick"],nI={class:"flex-1 text-center text-xs font-medium bg-white border border-gray-300 rounded px-1 py-1"},lI=["onClick"],cI={key:1,class:"text-center py-6"},dI={class:"w-10 h-10 mx-auto mb-2 bg-gray-100 rounded-full flex items-center justify-center"},uI={key:0,class:"preview-modal"},mI={class:"preview-modal-container"},gI={class:"preview-modal-header"},pI={class:"flex items-center justify-between"},hI={class:"flex items-center space-x-3"},bI={class:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center"},xI={class:"text-sm text-gray-500"},yI={class:"flex items-center space-x-2"},fI={class:"hidden sm:flex items-center px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium"},kI={class:"preview-modal-content"},vI={class:"flex justify-center items-center h-full p-8 bg-gradient-to-br from-gray-50 to-gray-100"},wI={class:"bg-white rounded-xl shadow-2xl border border-gray-200 overflow-hidden max-h-full max-w-full"};function LI(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon"),d=(0,a.g2)("datepicker"),u=(0,a.g2)("result-component"),m=(0,a.g2)("FileBrowser");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",bL,[(0,a.Lk)("div",xL,[(0,a.Lk)("div",yL,[(0,a.Lk)("div",fL,[(0,a.Lk)("div",kL,[(0,a.bF)(n,{icon:["fas","puzzle-piece"],class:"text-white text-sm"})]),t[10]||(t[10]=(0,a.Lk)("div",null,[(0,a.Lk)("h3",{class:"text-base font-semibold text-gray-900"},"องค์ประกอบ"),(0,a.Lk)("p",{class:"text-xs text-gray-500"},"เลือกเพื่อเพิ่มลงในใบรับรอง")],-1))]),(0,a.Lk)("div",vL,[t[12]||(t[12]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"พื้นหลังใบรับรอง",-1)),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.OpenFileBrowser&&r.OpenFileBrowser(...e)),class:"w-full flex items-center justify-center px-2 py-1.5 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 group"},[(0,a.Lk)("div",wL,[(0,a.Lk)("div",LL,[(0,a.bF)(n,{icon:["fas","image"],class:"text-sm"})]),t[11]||(t[11]=(0,a.Lk)("div",{class:"text-xs font-medium text-gray-600 group-hover:text-blue-700"},"เลือกรูปพื้นหลัง",-1))])])])]),(0,a.Lk)("div",CL,[(0,a.Lk)("div",DL,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.disabledSidebarElements,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"group"},[(0,a.Lk)("button",{onClick:t=>r.addElementToPage(e),disabled:e.disabled,class:"w-full text-left p-2 rounded-lg border border-gray-200 transition-all duration-200 hover:shadow-md hover:border-blue-300 hover:bg-blue-50 hover:scale-105 disabled:opacity-50 disabled:hover:scale-100"},[(0,a.Lk)("div",FL,[(0,a.Lk)("div",{class:(0,l.C4)(["w-7 h-7 rounded-lg flex items-center justify-center text-white shadow-md",r.getElementIconBg(e.type,e.use)])},[(0,a.bF)(n,{icon:["fas",r.getElementIcon(e.type,e.use)],class:"text-xs"},null,8,["icon"])],2),(0,a.Lk)("div",IL,[(0,a.Lk)("div",EL,(0,l.v_)(e.text),1),(0,a.Lk)("div",$L,(0,l.v_)(r.getElementTypeLabel(e.type)),1)]),(0,a.Lk)("div",_L,[(0,a.Lk)("div",PL,[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs text-blue-600"})])])])],8,SL)])))),128))])]),(0,a.Lk)("div",TL,[t[17]||(t[17]=(0,a.Lk)("h4",{class:"text-xs font-semibold text-gray-900 mb-2"},"การตั้งค่าหน้า",-1)),(0,a.Lk)("div",AL,[(0,a.Lk)("div",null,[t[13]||(t[13]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ชื่อหน้า",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>i.pages[0].name=e),placeholder:"ชื่อหน้า",class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"},null,512),[[c.Jo,i.pages[0].name]])]),(0,a.Lk)("div",null,[t[14]||(t[14]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ระยะขอบ",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>i.pages[0].padding=e),placeholder:"เช่น 1cm",class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"},null,512),[[c.Jo,i.pages[0].padding]])]),(0,a.Lk)("div",null,[(0,a.Lk)("label",XL,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>i.pages[0].allowDownload=e),class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[c.lH,i.pages[0].allowDownload]]),t[15]||(t[15]=(0,a.Lk)("span",{class:"text-xs text-gray-700"},"อนุญาตให้ดาวน์โหลดใบรับรอง",-1))]),(0,a.Lk)("p",jL,(0,l.v_)(i.pages[0].allowDownload?"ผู้ใช้สามารถดาวน์โหลดใบรับรองได้":"ไม่อนุญาตให้ดาวน์โหลด"),1)]),(0,a.Lk)("div",UL,[(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.togglePreview&&r.togglePreview(...e)),class:"flex-1 px-2 py-1 text-xs font-medium text-blue-700 bg-blue-100 border border-blue-200 rounded-md hover:bg-blue-200 transition-colors"},[(0,a.bF)(n,{icon:["fas",i.showPreview?"edit":"eye"],class:"mr-1"},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(i.showPreview?"แก้ไข":"ตัวอย่าง"),1)]),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>r.sendDataToParent&&r.sendDataToParent(...e)),class:"flex-1 px-2 py-1 text-xs font-medium text-white bg-gradient-to-r from-green-500 to-green-600 rounded-md hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-sm"},[(0,a.bF)(n,{icon:["fas","save"],class:"mr-1"}),t[16]||(t[16]=(0,a.eW)(" บันทึก "))])])])])]),(0,a.Lk)("div",BL,[(0,a.Lk)("div",OL,[(0,a.Lk)("div",QL,[(0,a.Lk)("div",ML,[(0,a.Lk)("div",VL,[(0,a.bF)(n,{icon:["fas","certificate"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[(0,a.Lk)("h2",RL,(0,l.v_)(s.certName||"ตัวสร้างใบรับรอง"),1),(0,a.Lk)("p",WL,(0,l.v_)(i.pages[0].landscapeMode?"A4 แนวนอน":"A4 แนวตั้ง")+" • "+(0,l.v_)(i.pages[0].elements.length)+" องค์ประกอบ",1)])]),(0,a.Lk)("div",NL,[(0,a.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>r.togglePreview&&r.togglePreview(...e)),class:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-white bg-gradient-to-r from-green-500 to-green-600 rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-sm"},[(0,a.bF)(n,{icon:["fas",i.showPreview?"edit":"eye"],class:"mr-1"},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(i.showPreview?"แก้ไข":"ตัวอย่าง"),1)]),(0,a.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>r.toggleLayout&&r.toggleLayout(...e)),class:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors shadow-sm"},[(0,a.bF)(n,{icon:["fas",i.pages[0].landscapeMode?"mobile-alt":"tablet-alt"],class:"mr-1"},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(i.pages[0].landscapeMode?"แนวตั้ง":"แนวนอน"),1)])])])]),(0,a.Lk)("div",qL,[(0,a.Lk)("div",KL,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.pages,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:s,class:(0,l.C4)(["page relative bg-white border border-gray-300 shadow-2xl rounded-lg overflow-hidden",{landscape:e.landscapeMode,"page-with-grid":!i.showPreview}]),style:(0,l.Tr)({padding:e.padding,"background-image":"url("+e.backgroundImage+")","background-size":"cover","background-repeat":"no-repeat",transform:r.getPageScale(),"transform-origin":"center center"})},[i.showPreview||e.elements&&0!==e.elements.length?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",HL,[(0,a.Lk)("div",zL,[(0,a.Lk)("div",GL,[(0,a.bF)(n,{icon:["fas","plus-circle"],class:"text-2xl text-gray-400"})]),t[18]||(t[18]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-600 mb-2"},"เริ่มต้นออกแบบใบรับรอง",-1)),t[19]||(t[19]=(0,a.Lk)("p",{class:"text-sm text-gray-500"},"คลิกเพิ่มองค์ประกอบจากแผงด้านซ้าย",-1))])])),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.elements,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:(0,l.C4)(["element-preview",{"preview-mode":i.showPreview,"element-selected":e.showOptions&&!i.showPreview,"watermark-element":"watermark"===e.use,"stamp-element":"stamp"===e.use,"general-image-element":"general"===e.use}]),onClick:t=>!i.showPreview&&r.selectElement(e),style:(0,l.Tr)({"margin-top":e.marginTop+"cm","margin-bottom":e.marginBottom+"cm","font-size":"text"===e.type||"watermark"===e.type&&"text"===e.watermarkType?e.fontSize:"inherit","font-weight":"text"===e.type||"watermark"===e.type&&"text"===e.watermarkType?e.bold?"bold":"normal":"inherit","font-style":"text"===e.type||"watermark"===e.type&&"text"===e.watermarkType?e.italic?"italic":"normal":"inherit","text-decoration":"text"===e.type||"watermark"===e.type&&"text"===e.watermarkType?e.underline?"underline":"none":"inherit",color:"watermark"===e.type&&"text"===e.watermarkType?e.fontColor:"inherit",width:"image"===e.type||"watermark"===e.type&&"image"===e.watermarkType?e.width:"auto",height:"image"===e.type||"watermark"===e.type&&"image"===e.watermarkType?e.height:"auto",position:"image"===e.type||"watermark"===e.type?"absolute":"static",top:r.getElementPosition(e,"top"),bottom:r.getElementPosition(e,"bottom"),left:r.getElementPosition(e,"left"),right:r.getElementPosition(e,"right"),transform:r.getElementTransform(e),"margin-left":e.marginLeft+"cm","margin-right":e.marginRight+"cm",opacity:e.opacity||1,"z-index":e.zIndex||"auto",border:"general"===e.use?"none":"",background:"general"===e.use?"transparent":"",padding:"general"===e.use?"0":""})},["watermark"===e.type?((0,a.uX)(),(0,a.CE)("div",YL,["text"===e.watermarkType?((0,a.uX)(),(0,a.CE)("div",ZL,(0,l.v_)(e.value),1)):((0,a.uX)(),(0,a.CE)("div",eC,[(0,a.Lk)("img",{src:e.url,alt:"Watermark",style:(0,l.Tr)([{"max-width":"100%"},{transform:e.rotation?`rotate(${e.rotation}deg)`:"none","transform-origin":"center center"}]),class:"watermark-image"},null,12,tC)]))])):"image"===e.type?((0,a.uX)(),(0,a.CE)("div",sC,["general"===e.use?((0,a.uX)(),(0,a.CE)("div",{key:0,class:(0,l.C4)(["image-frame",{"frame-visible":!i.showPreview&&e.showOptions,"frame-hidden":i.showPreview||!e.showOptions}]),style:(0,l.Tr)({width:e.width,height:e.height})},[e.url?((0,a.uX)(),(0,a.CE)("img",{key:0,src:e.url,alt:"General Image",style:(0,l.Tr)({width:"100%",height:"100%","object-fit":e.objectFit||"cover",transform:e.rotation?`rotate(${e.rotation}deg)`:"none","transform-origin":"center center"})},null,12,aC)):((0,a.uX)(),(0,a.CE)("div",oC,[(0,a.bF)(n,{icon:["fas","image"],class:"text-2xl mb-2"}),t[20]||(t[20]=(0,a.Lk)("div",null,"คลิกเพื่อเลือกรูปภาพ",-1))]))],6)):((0,a.uX)(),(0,a.CE)("img",{key:1,src:e.url,alt:"Image",style:(0,l.Tr)([{"max-width":"100%"},{width:e.width||"auto",height:e.height||"auto",transform:e.rotation?`rotate(${e.rotation}deg)`:"none","transform-origin":"center center","object-fit":"contain"}]),class:(0,l.C4)({"stamp-image":"stamp"===e.use})},null,14,iC)),e.caption?((0,a.uX)(),(0,a.CE)("p",rC,(0,l.v_)(e.value),1)):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.CE)("div",nC,["text"===e.use?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.eW)((0,l.v_)(e.value),1)],64)):"date"===e.use?((0,a.uX)(),(0,a.CE)("div",{key:1,innerHTML:r.getDisplayDate(e).replace(/\n/g,"<br>")},null,8,lC)):"name"===e.use?((0,a.uX)(),(0,a.CE)(a.FK,{key:2},[(0,a.eW)((0,l.v_)(r.getDisplayName(e)),1)],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:3},[(0,a.eW)((0,l.v_)(e.start)+(0,l.v_)(e.text)+(0,l.v_)(e.end),1)],64))]))],14,JL)))),128))],6)))),128))])])]),(0,a.Lk)("div",cC,[(0,a.Lk)("div",dC,[(0,a.Lk)("div",uC,[(0,a.Lk)("div",mC,[(0,a.bF)(n,{icon:["fas","sliders-h"],class:"text-white text-sm"})]),t[21]||(t[21]=(0,a.Lk)("div",null,[(0,a.Lk)("h3",{class:"text-base font-semibold text-gray-900"},"คุณสมบัติ"),(0,a.Lk)("p",{class:"text-xs text-gray-500"},"จัดการองค์ประกอบในใบรับรอง")],-1))])]),(0,a.Lk)("div",gC,[i.pages[0].elements.length>0?((0,a.uX)(),(0,a.CE)("div",pC,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.pages[0].elements,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"bg-gradient-to-r from-white to-gray-50 border border-gray-200 rounded-lg shadow-sm overflow-hidden"},[(0,a.Lk)("div",hC,[(0,a.Lk)("button",{onClick:t=>r.toggleOptions(e),class:"flex items-center space-x-2 flex-1 text-left"},[(0,a.Lk)("div",{class:(0,l.C4)(["w-5 h-5 rounded-md flex items-center justify-center text-white text-xs",r.getElementIconBg(e.type,e.use)])},[(0,a.bF)(n,{icon:["fas",r.getElementIcon(e.type,e.use)]},null,8,["icon"])],2),(0,a.Lk)("div",null,[(0,a.Lk)("div",xC,(0,l.v_)(e.text),1),(0,a.Lk)("div",yC,(0,l.v_)(r.getElementTypeLabel(e.type)),1)])],8,bC),(0,a.Lk)("div",fC,[(0,a.Lk)("button",{onClick:e=>r.moveElementUp(0,s),class:"w-5 h-5 rounded-md bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","chevron-up"],class:"text-xs text-gray-600"})],8,kC),(0,a.Lk)("button",{onClick:e=>r.moveElementDown(0,s),class:"w-5 h-5 rounded-md bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","chevron-down"],class:"text-xs text-gray-600"})],8,vC),(0,a.Lk)("button",{onClick:t=>r.removeElement(0,e),class:"w-5 h-5 rounded-md bg-red-100 hover:bg-red-200 flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","trash"],class:"text-xs text-red-600"})],8,wC)])]),e.showOptions?((0,a.uX)(),(0,a.CE)("div",LC,[(0,a.Lk)("div",CC,[(0,a.Lk)("h5",DC,[(0,a.bF)(n,{icon:["fas","arrows-alt"],class:"mr-1 text-blue-600"}),t[22]||(t[22]=(0,a.eW)(" ระยะห่าง "))]),(0,a.Lk)("div",SC,[(0,a.Lk)("div",null,[t[23]||(t[23]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ด้านบน",-1)),(0,a.Lk)("div",FC,[(0,a.Lk)("button",{onClick:t=>r.decreaseTopMargin(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,IC),(0,a.Lk)("div",EC,(0,l.v_)(parseFloat(e.marginTop).toFixed(1)),1),(0,a.Lk)("button",{onClick:t=>r.increaseTopMargin(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,$C)])]),(0,a.Lk)("div",null,[t[24]||(t[24]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ด้านล่าง",-1)),(0,a.Lk)("div",_C,[(0,a.Lk)("button",{onClick:t=>r.decreaseBottomMargin(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,PC),(0,a.Lk)("div",TC,(0,l.v_)(parseFloat(e.marginBottom).toFixed(1)),1),(0,a.Lk)("button",{onClick:t=>r.increaseBottomMargin(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,AC)])])])]),"text"===e.type?((0,a.uX)(),(0,a.CE)("div",XC,["text"===e.use?((0,a.uX)(),(0,a.CE)("div",jC,[(0,a.Lk)("h5",UC,[(0,a.bF)(n,{icon:["fas","font"],class:"mr-1 text-purple-600"}),t[25]||(t[25]=(0,a.eW)(" ข้อความ "))]),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.value=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors",placeholder:"ใส่ข้อความ"},null,8,BC),[[c.Jo,e.value]])])):(0,a.Q3)("",!0),"name"===e.use?((0,a.uX)(),(0,a.CE)("div",OC,[(0,a.Lk)("h5",QC,[(0,a.bF)(n,{icon:["fas","id-card"],class:"mr-1 text-indigo-600"}),t[26]||(t[26]=(0,a.eW)(" การตั้งค่าชื่อ-นามสกุล "))]),(0,a.Lk)("div",MC,[(0,a.Lk)("div",null,[(0,a.Lk)("label",VC,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.showPrefix=t,class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,8,RC),[[c.lH,e.showPrefix]]),t[27]||(t[27]=(0,a.Lk)("span",{class:"text-xs text-gray-700"},"แสดงคำนำหน้าชื่อ",-1))]),(0,a.Lk)("p",WC,(0,l.v_)(e.showPrefix?"จะแสดงคำนำหน้าชื่อก่อนชื่อ-นามสกุล":"แสดงเฉพาะชื่อ-นามสกุล"),1)]),e.showPrefix?((0,a.uX)(),(0,a.CE)("div",NC,[(0,a.Lk)("div",qC,[(0,a.bF)(n,{icon:["fas","cog"],class:"mr-1"}),t[28]||(t[28]=(0,a.eW)(" การตั้งค่าคำนำหน้า "))]),(0,a.Lk)("div",null,[t[30]||(t[30]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Data Mapping สำหรับคำนำหน้า",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.prefixMapping=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"เช่น title, prefix, honorific"},null,8,KC),[[c.Jo,e.prefixMapping]]),(0,a.Lk)("p",HC,[(0,a.bF)(n,{icon:["fas","info-circle"],class:"mr-1"}),t[29]||(t[29]=(0,a.eW)(" กำหนดชื่อฟิลด์ในข้อมูลที่ต้องการนำมาแสดง "))])]),(0,a.Lk)("div",null,[t[32]||(t[32]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"คำนำหน้าสำรอง",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.fallbackPrefix=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"เช่น คุณ, นาย, นาง, ดร."},null,8,zC),[[c.Jo,e.fallbackPrefix]]),(0,a.Lk)("p",GC,[(0,a.bF)(n,{icon:["fas","shield-alt"],class:"mr-1"}),t[31]||(t[31]=(0,a.eW)(" ข้อความที่แสดงเมื่อไม่พบข้อมูลจาก mapping หรือข้อมูลว่าง "))])]),(0,a.Lk)("div",JC,[t[33]||(t[33]=(0,a.Lk)("div",{class:"text-xs text-gray-600 mb-1"},"ตัวอย่างการแสดงผล:",-1)),(0,a.Lk)("div",YC,(0,l.v_)(r.getDisplayName(e)),1)])])):(0,a.Q3)("",!0)])])):(0,a.Q3)("",!0),"date"===e.use?((0,a.uX)(),(0,a.CE)("div",ZC,[(0,a.Lk)("h5",eD,[(0,a.bF)(n,{icon:["fas","calendar"],class:"mr-1 text-green-600"}),t[34]||(t[34]=(0,a.eW)(" การตั้งค่าวันที่ "))]),(0,a.Lk)("div",tD,[(0,a.Lk)("div",null,[t[37]||(t[37]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-2"},"การแสดงวันที่",-1)),(0,a.Lk)("div",sD,[(0,a.Lk)("label",aD,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.showIssueDate=t,class:"rounded border-gray-300 text-green-600 focus:ring-green-500"},null,8,oD),[[c.lH,e.showIssueDate]]),t[35]||(t[35]=(0,a.Lk)("span",{class:"text-xs text-gray-700"},"แสดงวันที่ออกใบรับรอง",-1))]),(0,a.Lk)("label",iD,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.showExpiryDate=t,class:"rounded border-gray-300 text-green-600 focus:ring-green-500"},null,8,rD),[[c.lH,e.showExpiryDate]]),t[36]||(t[36]=(0,a.Lk)("span",{class:"text-xs text-gray-700"},"แสดงวันที่หมดอายุ",-1))])])]),e.showExpiryDate?((0,a.uX)(),(0,a.CE)("div",nD,[t[38]||(t[38]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"อายุใบรับรอง (ปี)",-1)),(0,a.Lk)("div",lD,[(0,a.Lk)("button",{onClick:t=>r.adjustCertificateValidity(e,!1),class:"w-5 h-5 bg-green-500 hover:bg-green-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,cD),(0,a.bo)((0,a.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.validityYears=t,min:"1",max:"10",class:"flex-1 text-center text-xs font-medium border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"ปี"},null,8,dD),[[c.Jo,e.validityYears,void 0,{number:!0}]]),(0,a.Lk)("button",{onClick:t=>r.adjustCertificateValidity(e,!0),class:"w-5 h-5 bg-green-500 hover:bg-green-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,uD)]),(0,a.Lk)("p",mD,"ใบรับรองจะหมดอายุหลังจากวันที่ออกใบรับรอง "+(0,l.v_)(e.validityYears||1)+" ปี",1)])):(0,a.Q3)("",!0),e.showIssueDate&&e.showExpiryDate?((0,a.uX)(),(0,a.CE)("div",gD,[t[41]||(t[41]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"เครื่องหมายคั่นระหว่างวันที่",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t=>e.dateSeparator=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors"},t[39]||(t[39]=[(0,a.Fv)('<option value=" | " data-v-66bafb8d>เส้นแนวตั้ง ( | )</option><option value=" - " data-v-66bafb8d>เส้นขีด ( - )</option><option value=", " data-v-66bafb8d>จุลภาค ( , )</option><option value=" / " data-v-66bafb8d>เส้นทับ ( / )</option><option value=" • " data-v-66bafb8d>จุดกลม ( • )</option><option value="\\n" data-v-66bafb8d>บรรทัดใหม่</option><option value="custom" data-v-66bafb8d>กำหนดเอง</option>',7)]),8,pD),[[c.u1,e.dateSeparator]]),"custom"===e.dateSeparator?((0,a.uX)(),(0,a.CE)("div",hD,[t[40]||(t[40]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"เครื่องหมายคั่นที่ต้องการ",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.customSeparator=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",placeholder:"เช่น :: หรือ ถึง"},null,8,bD),[[c.Jo,e.customSeparator]])])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),(0,a.Lk)("label",xD,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.useMultipleDates=t,class:"rounded border-gray-300 text-green-600 focus:ring-green-500"},null,8,yD),[[c.lH,e.useMultipleDates]]),t[42]||(t[42]=(0,a.Lk)("span",{class:"text-xs text-gray-700"},"วันออกใบรับรองแบบมีเงื่อนไข",-1))]),e.useMultipleDates?((0,a.uX)(),(0,a.CE)("div",fD,[(0,a.Lk)("div",kD,[t[43]||(t[43]=(0,a.Lk)("span",{class:"text-xs font-medium text-gray-700"},"วันที่ออกใบรับรอง",-1)),(0,a.Lk)("button",{onClick:t=>r.addDateItem(e),class:"px-2 py-1 text-xs bg-green-500 hover:bg-green-600 text-white rounded-md transition-colors"}," เพิ่มเงื่อนไข ",8,vD)]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.dateItems,((t,s)=>((0,a.uX)(),(0,a.CE)("div",{key:`date-${e.id}-${s}`,class:"border border-gray-200 rounded-md p-2 bg-white"},[(0,a.Lk)("div",wD,[(0,a.Lk)("button",{onClick:e=>t.isExpanded=!t.isExpanded,class:"text-xs text-green-600 hover:text-green-700 font-medium"},(0,l.v_)(r.formatThaidate(t.date)||"เลือกวันที่"),9,LD),(0,a.Lk)("button",{onClick:t=>r.removeDateItem(e,s),class:"text-red-500 hover:text-red-700"},[(0,a.bF)(n,{icon:["fas","trash"],class:"text-xs"})],8,CD)]),t.isExpanded?((0,a.uX)(),(0,a.CE)("div",DD,[(0,a.bF)(d,{modelValue:t.date,"onUpdate:modelValue":e=>t.date=e,clearable:!0,class:"text-xs"},null,8,["modelValue","onUpdate:modelValue"]),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":e=>t.mapping=e,placeholder:"Master mapping",class:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-green-500"},null,8,SD),[[c.Jo,t.mapping]]),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":e=>t.keyword=e,placeholder:"Keyword mapping",class:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-green-500"},null,8,FD),[[c.Jo,t.keyword]])])):(0,a.Q3)("",!0)])))),128))])):((0,a.uX)(),(0,a.CE)("div",ID,[t[44]||(t[44]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"วันที่ออกใบรับรอง",-1)),(0,a.bF)(d,{modelValue:e.singleDate,"onUpdate:modelValue":t=>e.singleDate=t,clearable:!0},null,8,["modelValue","onUpdate:modelValue"])]))])])):(0,a.Q3)("",!0),(0,a.Lk)("div",ED,[(0,a.Lk)("h5",$D,[(0,a.bF)(n,{icon:["fas","palette"],class:"mr-1 text-indigo-600"}),t[45]||(t[45]=(0,a.eW)(" รูปแบบตัวอักษร "))]),(0,a.Lk)("div",_D,[(0,a.Lk)("div",null,[t[46]||(t[46]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ขนาดตัวอักษร",-1)),(0,a.Lk)("div",PD,[(0,a.Lk)("button",{onClick:t=>r.changeFontSize(0,e,"decrease"),class:"w-5 h-5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,TD),(0,a.Lk)("div",AD,(0,l.v_)(parseFloat(e.fontSize).toFixed(0))+"px ",1),(0,a.Lk)("button",{onClick:t=>r.changeFontSize(0,e,"increase"),class:"w-5 h-5 bg-indigo-500 hover:bg-indigo-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,XD)])]),(0,a.Lk)("div",null,[t[47]||(t[47]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"รูปแบบ",-1)),(0,a.Lk)("div",jD,[(0,a.Lk)("button",{onClick:t=>r.toggleBold(0,e),class:(0,l.C4)([e.bold?"bg-indigo-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200","flex-1 px-2 py-1 text-xs font-bold rounded-md transition-colors"])}," B ",10,UD),(0,a.Lk)("button",{onClick:t=>r.toggleItalic(0,e),class:(0,l.C4)([e.italic?"bg-indigo-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200","flex-1 px-2 py-1 text-xs italic rounded-md transition-colors"])}," I ",10,BD),(0,a.Lk)("button",{onClick:t=>r.toggleUnderline(0,e),class:(0,l.C4)([e.underline?"bg-indigo-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200","flex-1 px-2 py-1 text-xs underline rounded-md transition-colors"])}," U ",10,OD)])])])]),(0,a.Lk)("div",QD,[(0,a.Lk)("h5",MD,[(0,a.bF)(n,{icon:["fas","quote-left"],class:"mr-1 text-yellow-600"}),t[48]||(t[48]=(0,a.eW)(" ข้อความเสริม "))]),(0,a.Lk)("div",VD,[(0,a.Lk)("div",null,[t[49]||(t[49]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ข้อความเริ่มต้น",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.start=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-colors",placeholder:"ข้อความที่แสดงก่อน"},null,8,RD),[[c.Jo,e.start]])]),(0,a.Lk)("div",null,[t[50]||(t[50]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ข้อความลงท้าย",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.end=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-colors",placeholder:"ข้อความที่แสดงหลัง"},null,8,WD),[[c.Jo,e.end]])])])])])):"image"===e.type?((0,a.uX)(),(0,a.CE)("div",ND,[(0,a.Lk)("div",qD,[(0,a.Lk)("h5",KD,[(0,a.bF)(n,{icon:["fas","crosshairs"],class:"mr-1 text-purple-600"}),t[51]||(t[51]=(0,a.eW)(" ตำแหน่ง "))]),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t=>e.cornerPosition=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors"},t[52]||(t[52]=[(0,a.Lk)("option",{value:"top left"},"ซ้ายบน",-1),(0,a.Lk)("option",{value:"top right"},"ขวาบน",-1),(0,a.Lk)("option",{value:"bottom left"},"ซ้ายล่าง",-1),(0,a.Lk)("option",{value:"bottom right"},"ขวาล่าง",-1)]),8,HD),[[c.u1,e.cornerPosition]])]),(0,a.Lk)("div",zD,[(0,a.Lk)("h5",GD,[(0,a.bF)(n,{icon:["fas","expand-arrows-alt"],class:"mr-1 text-green-600"}),t[53]||(t[53]=(0,a.eW)(" ระยะห่าง "))]),(0,a.Lk)("div",JD,[(0,a.Lk)("div",null,[t[54]||(t[54]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ด้านซ้าย",-1)),(0,a.Lk)("div",YD,[(0,a.Lk)("button",{onClick:t=>r.adjustMargin(0,e,"marginLeft",!1),class:"w-5 h-5 bg-green-500 hover:bg-green-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,ZD),(0,a.Lk)("div",eS,(0,l.v_)(parseFloat(e.marginLeft).toFixed(1)),1),(0,a.Lk)("button",{onClick:t=>r.adjustMargin(0,e,"marginLeft",!0),class:"w-5 h-5 bg-green-500 hover:bg-green-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,tS)])]),(0,a.Lk)("div",null,[t[55]||(t[55]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ด้านขวา",-1)),(0,a.Lk)("div",sS,[(0,a.Lk)("button",{onClick:t=>r.adjustMargin(0,e,"marginRight",!1),class:"w-5 h-5 bg-green-500 hover:bg-green-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,aS),(0,a.Lk)("div",oS,(0,l.v_)(parseFloat(e.marginRight).toFixed(1)),1),(0,a.Lk)("button",{onClick:t=>r.adjustMargin(0,e,"marginRight",!0),class:"w-5 h-5 bg-green-500 hover:bg-green-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,iS)])])])]),(0,a.Lk)("div",rS,[(0,a.Lk)("h5",nS,[(0,a.bF)(n,{icon:["fas","expand"],class:"mr-1 text-blue-600"}),t[56]||(t[56]=(0,a.eW)(" ขนาด "))]),(0,a.Lk)("div",lS,[(0,a.Lk)("div",null,[t[57]||(t[57]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ความกว้าง",-1)),(0,a.Lk)("div",cS,[(0,a.Lk)("button",{onClick:t=>r.decreaseWidth(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,dS),(0,a.Lk)("div",uS,(0,l.v_)(e.width),1),(0,a.Lk)("button",{onClick:t=>r.increaseWidth(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,mS)])]),(0,a.Lk)("div",null,[t[58]||(t[58]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ความสูง",-1)),(0,a.Lk)("div",gS,[(0,a.Lk)("button",{onClick:t=>r.decreaseHeight(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,pS),(0,a.Lk)("div",hS,(0,l.v_)(e.height),1),(0,a.Lk)("button",{onClick:t=>r.increaseHeight(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,bS)])])])]),(0,a.Lk)("div",xS,[(0,a.Lk)("h5",yS,[(0,a.bF)(n,{icon:["fas","comment"],class:"mr-1 text-gray-600"}),t[59]||(t[59]=(0,a.eW)(" คำอธิบาย "))]),(0,a.Lk)("div",fS,[(0,a.Lk)("label",kS,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.caption=t,class:"rounded border-gray-300 text-gray-600 focus:ring-gray-500"},null,8,vS),[[c.lH,e.caption]]),t[60]||(t[60]=(0,a.Lk)("span",{class:"text-xs text-gray-700"},"แสดงคำอธิบาย",-1))]),e.caption?((0,a.uX)(),(0,a.CE)("div",wS,[t[62]||(t[62]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"เลือกข้อความที่แสดง",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t=>e.value=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-gray-500 focus:border-gray-500 transition-colors"},t[61]||(t[61]=[(0,a.Lk)("option",{value:"code"},"Code",-1),(0,a.Lk)("option",{value:"id"},"ID",-1),(0,a.Lk)("option",{value:"slug"},"Slug",-1)]),8,LS),[[c.u1,e.value]])])):(0,a.Q3)("",!0)])]),"general"===e.use?((0,a.uX)(),(0,a.CE)("div",CS,[(0,a.Lk)("div",DS,[(0,a.Lk)("h5",SS,[(0,a.bF)(n,{icon:["fas","image"],class:"mr-1 text-emerald-600"}),t[63]||(t[63]=(0,a.eW)(" เลือกรูปภาพ "))]),(0,a.Lk)("button",{onClick:t=>r.openGeneralImageFileBrowser(e),class:"w-full flex items-center justify-center px-3 py-2 border-2 border-dashed border-emerald-300 rounded-lg hover:border-emerald-400 hover:bg-emerald-50 transition-all duration-200 group"},[(0,a.Lk)("div",IS,[(0,a.Lk)("div",ES,[(0,a.bF)(n,{icon:["fas","image"],class:"text-sm"})]),(0,a.Lk)("div",$S,(0,l.v_)(e.url?"เปลี่ยนรูปภาพ":"เลือกรูปภาพ"),1),e.url?((0,a.uX)(),(0,a.CE)("div",_S,(0,l.v_)(e.url.split("/").pop()),1)):(0,a.Q3)("",!0)])],8,FS)]),(0,a.Lk)("div",PS,[(0,a.Lk)("h5",TS,[(0,a.bF)(n,{icon:["fas","crop"],class:"mr-1 text-blue-600"}),t[64]||(t[64]=(0,a.eW)(" การจัดขนาด "))]),(0,a.Lk)("div",AS,[(0,a.Lk)("label",XS,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.maintainRatio=t,class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,jS),[[c.lH,e.maintainRatio]]),t[65]||(t[65]=(0,a.Lk)("span",{class:"text-xs text-gray-700"},"รักษาสัดส่วนรูปภาพ",-1))]),e.maintainRatio?((0,a.uX)(),(0,a.CE)("div",qS,[t[68]||(t[68]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ความกว้าง (ความสูงจะปรับตามสัดส่วน)",-1)),(0,a.Lk)("div",KS,[(0,a.Lk)("button",{onClick:t=>r.adjustImageWidth(e,!1),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,HS),(0,a.Lk)("div",zS,(0,l.v_)(parseInt(e.width))+"px ",1),(0,a.Lk)("button",{onClick:t=>r.adjustImageWidth(e,!0),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,GS)]),(0,a.Lk)("p",JS,"ความสูง: "+(0,l.v_)(Math.round(parseInt(e.width)/(e.aspectRatio||1)))+"px",1)])):((0,a.uX)(),(0,a.CE)("div",US,[(0,a.Lk)("div",null,[t[66]||(t[66]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ความกว้าง",-1)),(0,a.Lk)("div",BS,[(0,a.Lk)("button",{onClick:t=>r.decreaseWidth(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,OS),(0,a.Lk)("div",QS,(0,l.v_)(parseInt(e.width))+"px ",1),(0,a.Lk)("button",{onClick:t=>r.increaseWidth(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,MS)])]),(0,a.Lk)("div",null,[t[67]||(t[67]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ความสูง",-1)),(0,a.Lk)("div",VS,[(0,a.Lk)("button",{onClick:t=>r.decreaseHeight(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,RS),(0,a.Lk)("div",WS,(0,l.v_)(parseInt(e.height))+"px ",1),(0,a.Lk)("button",{onClick:t=>r.increaseHeight(0,e),class:"w-5 h-5 bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,NS)])])]))])]),(0,a.Lk)("div",YS,[(0,a.Lk)("h5",ZS,[(0,a.bF)(n,{icon:["fas","expand-alt"],class:"mr-1 text-purple-600"}),t[69]||(t[69]=(0,a.eW)(" การแสดงผลในกรอบ "))]),(0,a.Lk)("div",eF,[(0,a.Lk)("label",tF,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.showFrame=t,class:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"},null,8,sF),[[c.lH,e.showFrame]]),t[70]||(t[70]=(0,a.Lk)("span",{class:"text-xs text-gray-700"},"แสดงกรอบรูปภาพ (เฉพาะโหมดแก้ไข)",-1))])]),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t=>e.objectFit=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors"},t[71]||(t[71]=[(0,a.Lk)("option",{value:"cover"},"เต็มกรอบ (ครอบคลุม)",-1),(0,a.Lk)("option",{value:"contain"},"พอดีกรอบ (แสดงทั้งหมด)",-1),(0,a.Lk)("option",{value:"fill"},"ยืดเต็มกรอบ",-1)]),8,aF),[[c.u1,e.objectFit]]),(0,a.Lk)("p",oF,(0,l.v_)("cover"===e.objectFit?"รูปภาพจะเต็มกรอบ แต่อาจถูกตัดส่วนเกิน":"contain"===e.objectFit?"รูปภาพจะแสดงทั้งหมดภายในกรอบ":"รูปภาพจะยืดให้เต็มกรอบ"),1)])])):"watermark"===e.type?((0,a.uX)(),(0,a.CE)("div",iF,[(0,a.Lk)("div",rF,[(0,a.Lk)("h5",nF,[(0,a.bF)(n,{icon:["fas","water"],class:"mr-1 text-cyan-600"}),t[72]||(t[72]=(0,a.eW)(" การตั้งค่าลายน้ำ "))]),(0,a.Lk)("div",lF,[(0,a.Lk)("div",null,[t[74]||(t[74]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ประเภทลายน้ำ",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t=>e.watermarkType=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-colors"},t[73]||(t[73]=[(0,a.Lk)("option",{value:"image"},"รูปภาพ",-1),(0,a.Lk)("option",{value:"text"},"ข้อความ",-1)]),8,cF),[[c.u1,e.watermarkType]])]),(0,a.Lk)("div",null,[t[76]||(t[76]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ตำแหน่ง",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t=>e.cornerPosition=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-colors"},t[75]||(t[75]=[(0,a.Lk)("option",{value:"center"},"ตรงกลาง",-1),(0,a.Lk)("option",{value:"top"},"ติดด้านบน",-1),(0,a.Lk)("option",{value:"bottom"},"ชิดด้านล่าง",-1)]),8,dF),[[c.u1,e.cornerPosition]])]),"text"===e.watermarkType?((0,a.uX)(),(0,a.CE)("div",uF,[(0,a.Lk)("div",null,[t[77]||(t[77]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ข้อความลายน้ำ",-1)),(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.value=t,class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-colors",placeholder:"ใส่ข้อความลายน้ำ"},null,8,mF),[[c.Jo,e.value]])]),(0,a.Lk)("div",null,[t[78]||(t[78]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ขนาดตัวอักษร",-1)),(0,a.Lk)("div",gF,[(0,a.Lk)("button",{onClick:t=>r.changeWatermarkFontSize(e,"decrease"),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,pF),(0,a.Lk)("div",hF,(0,l.v_)(parseFloat(e.fontSize).toFixed(0))+"px ",1),(0,a.Lk)("button",{onClick:t=>r.changeWatermarkFontSize(e,"increase"),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,bF)])]),(0,a.Lk)("div",null,[t[79]||(t[79]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"สีตัวอักษร",-1)),(0,a.bo)((0,a.Lk)("input",{type:"color","onUpdate:modelValue":t=>e.fontColor=t,class:"w-full h-8 border border-gray-300 rounded-md cursor-pointer"},null,8,xF),[[c.Jo,e.fontColor]])]),(0,a.Lk)("div",null,[t[80]||(t[80]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"องศาการเอียง",-1)),(0,a.Lk)("div",yF,[(0,a.Lk)("button",{onClick:t=>r.adjustTextRotation(e,!1),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,fF),(0,a.Lk)("div",kF,(0,l.v_)(e.textRotation||-45)+"° ",1),(0,a.Lk)("button",{onClick:t=>r.adjustTextRotation(e,!0),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,vF)])])])):(0,a.Q3)("",!0),"image"===e.watermarkType?((0,a.uX)(),(0,a.CE)("div",wF,[(0,a.Lk)("div",null,[t[82]||(t[82]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"เลือกรูปภาพลายน้ำ",-1)),(0,a.Lk)("button",{onClick:t=>r.openWatermarkFileBrowser(e),class:"w-full flex items-center justify-center px-3 py-2 border-2 border-dashed border-cyan-300 rounded-lg hover:border-cyan-400 hover:bg-cyan-50 transition-all duration-200 group"},[(0,a.Lk)("div",CF,[(0,a.Lk)("div",DF,[(0,a.bF)(n,{icon:["fas","image"],class:"text-sm"})]),t[81]||(t[81]=(0,a.Lk)("div",{class:"text-xs font-medium text-cyan-600 group-hover:text-cyan-700"},"เลือกรูปลายน้ำ",-1)),e.url?((0,a.uX)(),(0,a.CE)("div",SF,(0,l.v_)(e.url.split("/").pop()),1)):(0,a.Q3)("",!0)])],8,LF)]),(0,a.Lk)("div",FF,[(0,a.Lk)("div",null,[t[83]||(t[83]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ความกว้าง",-1)),(0,a.Lk)("div",IF,[(0,a.Lk)("button",{onClick:t=>r.decreaseWidth(0,e),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,EF),(0,a.Lk)("div",$F,(0,l.v_)(e.width),1),(0,a.Lk)("button",{onClick:t=>r.increaseWidth(0,e),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,_F)])]),(0,a.Lk)("div",null,[t[84]||(t[84]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ความสูง",-1)),(0,a.Lk)("div",PF,[(0,a.Lk)("button",{onClick:t=>r.decreaseHeight(0,e),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,TF),(0,a.Lk)("div",AF,(0,l.v_)(e.height),1),(0,a.Lk)("button",{onClick:t=>r.increaseHeight(0,e),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,XF)])])])])):(0,a.Q3)("",!0),(0,a.Lk)("div",null,[t[85]||(t[85]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ความโปร่งใส",-1)),(0,a.Lk)("div",jF,[(0,a.Lk)("button",{onClick:t=>r.adjustOpacity(e,!1),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,UF),(0,a.Lk)("div",BF,(0,l.v_)(Math.round(100*(e.opacity||1)))+"% ",1),(0,a.Lk)("button",{onClick:t=>r.adjustOpacity(e,!0),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,OF)])]),(0,a.Lk)("div",null,[t[86]||(t[86]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ลำดับชั้น",-1)),(0,a.Lk)("div",QF,[(0,a.Lk)("button",{onClick:t=>r.adjustZIndex(e,!1),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,MF),(0,a.Lk)("div",VF,(0,l.v_)(e.zIndex||1),1),(0,a.Lk)("button",{onClick:t=>r.adjustZIndex(e,!0),class:"w-5 h-5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,RF)])])])])])):(0,a.Q3)("",!0),"stamp"===e.use?((0,a.uX)(),(0,a.CE)("div",WF,[(0,a.Lk)("h5",NF,[(0,a.bF)(n,{icon:["fas","stamp"],class:"mr-1 text-red-600"}),t[87]||(t[87]=(0,a.eW)(" การตั้งค่าตราประทับ "))]),(0,a.Lk)("div",qF,[(0,a.Lk)("div",null,[t[89]||(t[89]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"เลือกรูปภาพตราประทับ",-1)),(0,a.Lk)("button",{onClick:t=>r.openStampFileBrowser(e),class:"w-full flex items-center justify-center px-3 py-2 border-2 border-dashed border-red-300 rounded-lg hover:border-red-400 hover:bg-red-50 transition-all duration-200 group"},[(0,a.Lk)("div",HF,[(0,a.Lk)("div",zF,[(0,a.bF)(n,{icon:["fas","image"],class:"text-sm"})]),t[88]||(t[88]=(0,a.Lk)("div",{class:"text-xs font-medium text-red-600 group-hover:text-red-700"},"เลือกรูปตราประทับ",-1)),e.url?((0,a.uX)(),(0,a.CE)("div",GF,(0,l.v_)(e.url.split("/").pop()),1)):(0,a.Q3)("",!0)])],8,KF)]),(0,a.Lk)("div",null,[t[90]||(t[90]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ลำดับชั้น",-1)),(0,a.Lk)("div",JF,[(0,a.Lk)("button",{onClick:t=>r.adjustZIndex(e,!1),class:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,YF),(0,a.Lk)("div",ZF,(0,l.v_)(e.zIndex||10),1),(0,a.Lk)("button",{onClick:t=>r.adjustZIndex(e,!0),class:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,eI)])]),(0,a.Lk)("div",null,[t[91]||(t[91]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"ความโปร่งใส",-1)),(0,a.Lk)("div",tI,[(0,a.Lk)("button",{onClick:t=>r.adjustOpacity(e,!1),class:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,sI),(0,a.Lk)("div",aI,(0,l.v_)(Math.round(100*(e.opacity||1)))+"% ",1),(0,a.Lk)("button",{onClick:t=>r.adjustOpacity(e,!0),class:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,oI)])]),(0,a.Lk)("div",null,[t[92]||(t[92]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"การหมุน (องศา)",-1)),(0,a.Lk)("div",iI,[(0,a.Lk)("button",{onClick:t=>r.adjustRotation(e,!1),class:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","minus"],class:"text-xs"})],8,rI),(0,a.Lk)("div",nI,(0,l.v_)(e.rotation||0)+"° ",1),(0,a.Lk)("button",{onClick:t=>r.adjustRotation(e,!0),class:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-md flex items-center justify-center transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"text-xs"})],8,lI)])])])])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)])))),128))])):((0,a.uX)(),(0,a.CE)("div",cI,[(0,a.Lk)("div",dI,[(0,a.bF)(n,{icon:["fas","layer-group"],class:"text-lg text-gray-400"})]),t[93]||(t[93]=(0,a.Lk)("h3",{class:"text-sm font-medium text-gray-600 mb-1"},"ยังไม่มีองค์ประกอบ",-1)),t[94]||(t[94]=(0,a.Lk)("p",{class:"text-xs text-gray-500"},"เพิ่มองค์ประกอบจากแผงด้านซ้ายเพื่อเริ่มออกแบบ",-1))]))])])]),(0,a.bF)(c.eB,{"enter-active-class":"preview-modal-enter-active","leave-active-class":"preview-modal-leave-active","enter-from-class":"preview-modal-enter-from","leave-to-class":"preview-modal-leave-to"},{default:(0,a.k6)((()=>[i.showPreviewModal?((0,a.uX)(),(0,a.CE)("div",uI,[(0,a.Lk)("div",{class:"preview-modal-backdrop",onClick:t[8]||(t[8]=(...e)=>r.closePreviewModal&&r.closePreviewModal(...e))}),(0,a.Lk)("div",mI,[(0,a.Lk)("div",gI,[(0,a.Lk)("div",pI,[(0,a.Lk)("div",hI,[(0,a.Lk)("div",bI,[(0,a.bF)(n,{icon:["fas","eye"],class:"text-green-600"})]),(0,a.Lk)("div",null,[t[95]||(t[95]=(0,a.Lk)("h3",{class:"text-lg font-semibold text-gray-900"},"ตัวอย่างใบรับรอง",-1)),(0,a.Lk)("p",xI,(0,l.v_)(s.certName||"ใบรับรองใหม่"),1)])]),(0,a.Lk)("div",yI,[(0,a.Lk)("div",fI,[(0,a.bF)(n,{icon:["fas","expand"],class:"mr-1"}),t[96]||(t[96]=(0,a.eW)(" โหมดตัวอย่าง "))]),(0,a.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>r.closePreviewModal&&r.closePreviewModal(...e)),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"ปิด (ESC)"},[(0,a.bF)(n,{icon:["fas","times"],class:"text-xl"})])])])]),(0,a.Lk)("div",kI,[(0,a.Lk)("div",vI,[(0,a.Lk)("div",wI,[(0,a.bF)(u,{pages:i.pages,debug:!1},null,8,["pages"])])])])])])):(0,a.Q3)("",!0)])),_:1}),((0,a.uX)(),(0,a.Wv)(a.Im,{to:"body"},[i.FileBrowserOpen?((0,a.uX)(),(0,a.Wv)(m,{key:i.FileBrowserOpen,isWindowsOpen:i.FileBrowserOpen,callbackFunction:"cover",allowFileType:["jpg","gif","png","jpeg"],onFileBrowserTrigger:r.changeFileTrigger,onFileBrowserCallback:r.selectFileTrigger},null,8,["isWindowsOpen","onFileBrowserTrigger","onFileBrowserCallback"])):(0,a.Q3)("",!0),i.watermarkFileBrowserOpen?((0,a.uX)(),(0,a.Wv)(m,{key:"watermark-"+i.watermarkFileBrowserOpen,isWindowsOpen:i.watermarkFileBrowserOpen,callbackFunction:"watermark",allowFileType:["jpg","gif","png","jpeg"],onFileBrowserTrigger:r.changeWatermarkFileTrigger,onFileBrowserCallback:r.selectWatermarkFileTrigger},null,8,["isWindowsOpen","onFileBrowserTrigger","onFileBrowserCallback"])):(0,a.Q3)("",!0),i.stampFileBrowserOpen?((0,a.uX)(),(0,a.Wv)(m,{key:"stamp-"+i.stampFileBrowserOpen,isWindowsOpen:i.stampFileBrowserOpen,callbackFunction:"stamp",allowFileType:["jpg","gif","png","jpeg"],onFileBrowserTrigger:r.changeStampFileTrigger,onFileBrowserCallback:r.selectStampFileTrigger},null,8,["isWindowsOpen","onFileBrowserTrigger","onFileBrowserCallback"])):(0,a.Q3)("",!0),i.generalImageFileBrowserOpen?((0,a.uX)(),(0,a.Wv)(m,{key:"general-"+i.generalImageFileBrowserOpen,isWindowsOpen:i.generalImageFileBrowserOpen,callbackFunction:"general",allowFileType:["jpg","gif","png","jpeg"],onFileBrowserTrigger:r.changeGeneralImageFileTrigger,onFileBrowserCallback:r.selectGeneralImageFileTrigger},null,8,["isWindowsOpen","onFileBrowserTrigger","onFileBrowserCallback"])):(0,a.Q3)("",!0)]))],64)}var CI=s(35839),DI=s(57146),SI={components:{ResultComponent:CI.A,FileBrowser:os.A,Datepicker:or.A},props:{certItem:Object,certName:String},data(){const e=this.certItem,t=n.A.get("configs"),s=t,a=new DI.S3({forcePathStyle:!1,endpoint:s.s3EndpointDefault,region:s.s3Region,ResponseContentEncoding:"utf-8",credentials:{accessKeyId:s.s3Key,secretAccessKey:s.s3Secret}});return{S3:a,showPreview:!1,showPreviewModal:!1,FileBrowserOpen:!1,watermarkFileBrowserOpen:!1,stampFileBrowserOpen:!1,generalImageFileBrowserOpen:!1,currentEditingElement:null,sidebarElements:[{id:1,text:"ชื่อ-นามสกุล",use:"name",type:"text",start:"",end:"",showPrefix:!1,prefixMapping:"title",fallbackPrefix:"คุณ"},{id:2,text:"ชื่อหลักสูตร",use:"lesson",type:"text",start:"",end:""},{id:3,text:"ชื่อสถาบัน",use:"school",type:"text",start:"",end:""},{id:4,text:"วันที่ออกใบรับรอง",use:"date",type:"text",start:"",end:"",show_year:"",custom_cert_date:"",useMultipleDates:!1,singleDate:"",dateItems:[{date:"",mapping:"",keyword:"",isExpanded:!1}]},{id:5,text:"คิวอาร์โค๊ด",type:"image",use:"qrcode",cornerPosition:"bottom left",url:"https://vue-project.sgp1.digitaloceanspaces.com/2024/01/1704536394318.png",caption:!1,value:"code"},{id:6,text:"รูปประจำตัว",type:"image",use:"avatar",cornerPosition:"bottom right",url:"https://vue-project.sgp1.digitaloceanspaces.com/2024/01/1704536391861.png",caption:!1},{id:7,text:"ข้อความ",use:"text",type:"text",value:"ข้อความ",end:""},{id:8,text:"ลายน้ำ",type:"watermark",use:"watermark",watermarkType:"image",cornerPosition:"center",url:"https://vue-project.sgp1.digitaloceanspaces.com/2024/01/1704536394318.png",caption:!1,opacity:.3,zIndex:1,value:"ลายน้ำ",fontSize:"48px",fontColor:"#000000",rotation:0,textRotation:-45},{id:9,text:"ตราประทับ",type:"image",use:"stamp",cornerPosition:"bottom right",url:"https://vue-project.sgp1.digitaloceanspaces.com/2024/01/1704536391861.png",caption:!1,zIndex:10},{id:10,text:"รูปภาพ",type:"image",use:"general",cornerPosition:"top left",url:"",caption:!1,maintainRatio:!0,aspectRatio:1}],useMultipleDates:!1,singleDate:"",dateItems:[{date:"",keyword:""}],pages:e}},computed:{disabledSidebarElements(){return this.sidebarElements.map((e=>{const t="general"===e.use||"text"===e.use;let s=!1;return t||(s=this.pages[0].elements.some((t=>t.id===e.id))),{...e,disabled:s}}))}},methods:{getElementIcon(e,t){if("watermark"===t)return"water";if("stamp"===t)return"stamp";if("qrcode"===t)return"qrcode";if("avatar"===t)return"user-circle";if("name"===t)return"id-card";if("lesson"===t)return"graduation-cap";if("school"===t)return"university";if("date"===t)return"calendar";if("general"===t)return"image";const s={text:"font",image:"image",watermark:"water"};return s[e]||"puzzle-piece"},getElementIconBg(e,t){if("watermark"===t)return"bg-gradient-to-br from-cyan-500 to-blue-600";if("stamp"===t)return"bg-gradient-to-br from-red-500 to-red-600";if("qrcode"===t)return"bg-gradient-to-br from-gray-500 to-gray-600";if("avatar"===t)return"bg-gradient-to-br from-indigo-500 to-purple-600";if("name"===t)return"bg-gradient-to-br from-blue-500 to-blue-600";if("lesson"===t)return"bg-gradient-to-br from-green-500 to-green-600";if("school"===t)return"bg-gradient-to-br from-yellow-500 to-orange-600";if("date"===t)return"bg-gradient-to-br from-purple-500 to-purple-600";if("general"===t)return"bg-gradient-to-br from-emerald-500 to-emerald-600";const s={text:"bg-gradient-to-br from-blue-500 to-blue-600",image:"bg-gradient-to-br from-purple-500 to-purple-600"};return s[e]||"bg-gradient-to-br from-gray-500 to-gray-600"},getElementTypeLabel(e){const t={text:"ข้อความ",image:"รูปภาพ"};return t[e]||"องค์ประกอบ"},getPageScale(){const e=window.innerHeight,t=window.innerWidth,s=136,a=60,o=32,i=t-4*s-o,r=e-a-o,n=this.pages[0].landscapeMode?1123:794,l=this.pages[0].landscapeMode?794:1123,c=i/n,d=r/l,u=Math.min(c,d,1);return`scale(${Math.max(u,.3)})`},formatThaidate(e){return ns.A.toThaiDatetime(e,"datefull")},OpenFileBrowser(){console.log("OpenFileBrowser clicked!",this.FileBrowserOpen),this.FileBrowserOpen=!0,console.log("FileBrowserOpen set to:",this.FileBrowserOpen)},changeFileTrigger(e){console.log("changeFileTrigger called with:",e),this.FileBrowserOpen=e},addDateItem(e){Array.isArray(e.dateItems)||(e.dateItems=[]),e.dateItems.push({date:"",mapping:"",keyword:"",isExpanded:!1})},removeDateItem(e,t){Array.isArray(e.dateItems)&&e.dateItems.length>1&&e.dateItems.splice(t,1)},selectFileTrigger(e){console.log("selectFileTrigger called with:",e),hr.A.log("selectFileTrigger"),void 0!=e&&(this.selectCourseCover=e,this.pages[0].backgroundImage=e.file,console.log("Background image set to:",e.file))},openWatermarkFileBrowser(e){this.currentEditingElement=e,this.watermarkFileBrowserOpen=!0},changeWatermarkFileTrigger(e){this.watermarkFileBrowserOpen=e},selectWatermarkFileTrigger(e){console.log("selectWatermarkFileTrigger called with:",e),e&&this.currentEditingElement&&(this.currentEditingElement.url=e.file,console.log("Watermark image updated to:",e.file)),this.currentEditingElement=null},openStampFileBrowser(e){this.currentEditingElement=e,this.stampFileBrowserOpen=!0},changeStampFileTrigger(e){this.stampFileBrowserOpen=e},selectStampFileTrigger(e){console.log("selectStampFileTrigger called with:",e),e&&this.currentEditingElement&&(this.currentEditingElement.url=e.file,console.log("Stamp image updated to:",e.file)),this.currentEditingElement=null},openGeneralImageFileBrowser(e){this.currentEditingElement=e,this.generalImageFileBrowserOpen=!0},changeGeneralImageFileTrigger(e){this.generalImageFileBrowserOpen=e},selectGeneralImageFileTrigger(e){if(console.log("selectGeneralImageFileTrigger called with:",e),e&&this.currentEditingElement){const t=this.currentEditingElement;if(t.url=e.file,console.log("General image updated to:",e.file),t.maintainRatio){const s=new Image;s.onload=()=>{if(t&&"object"===typeof t){t.aspectRatio=s.width/s.height,t.originalWidth=s.width,t.originalHeight=s.height;const e=200;let a=s.width,o=s.height;if(a>e||o>e){const t=Math.min(e/a,e/o);a=Math.round(a*t),o=Math.round(o*t)}t.width=a+"px",t.height=o+"px",console.log("Frame size set to:",t.width,"x",t.height),console.log("Aspect ratio calculated:",t.aspectRatio)}},s.onerror=()=>{console.error("Failed to load image for ratio calculation")},s.src=e.file}}this.currentEditingElement=null},adjustImageWidth(e,t){const s=parseInt(e.width),a=10;let o;if(o=t?s+a:Math.max(s-a,10),e.width=o+"px",e.maintainRatio&&e.aspectRatio){const t=Math.round(o/e.aspectRatio);e.height=t+"px"}},togglePreview(){this.showPreview=!this.showPreview},openPreviewModal(){this.showPreviewModal=!0,document.body.classList.add("modal-open"),document.addEventListener("keydown",this.handlePreviewKeydown)},closePreviewModal(){this.showPreviewModal=!1,document.body.classList.remove("modal-open"),document.removeEventListener("keydown",this.handlePreviewKeydown)},handlePreviewKeydown(e){"Escape"===e.key&&this.showPreviewModal&&this.closePreviewModal()},sendDataToParent(){this.$emit("data-emitted",this.pages)},addElementToPage(e){e.marginTop=0,e.marginBottom=0,e.showOptions=!1,"text"===e.type&&(e.fontSize="12px",e.bold=!1,e.italic=!1,e.underline=!1,"name"===e.use&&(e.showPrefix=void 0!==e.showPrefix&&e.showPrefix,e.prefixMapping=e.prefixMapping||"title",e.fallbackPrefix=e.fallbackPrefix||"คุณ"),"date"===e.use&&(e.showIssueDate=void 0===e.showIssueDate||e.showIssueDate,e.showExpiryDate=void 0!==e.showExpiryDate&&e.showExpiryDate,e.validityYears=e.validityYears||"1",e.dateSeparator=e.dateSeparator||" | ",e.customSeparator=e.customSeparator||"")),"image"===e.type&&(e.width="100px",e.height="100px",e.marginLeft=0,e.marginRight=0,e.marginTop=0,e.marginBottom=0,"stamp"===e.use&&(e.opacity=e.opacity||1,e.zIndex=e.zIndex||10,e.rotation=e.rotation||0),"general"===e.use&&(e.maintainRatio=void 0===e.maintainRatio||e.maintainRatio,e.aspectRatio=e.aspectRatio||1,e.originalWidth=null,e.originalHeight=null,e.objectFit=e.objectFit||"cover",e.showFrame=void 0!==e.showFrame&&e.showFrame,e.width="150px",e.height="150px")),"watermark"===e.type&&("text"===e.watermarkType?(e.fontSize=e.fontSize||"48px",e.fontColor=e.fontColor||"#000000",e.textRotation=e.textRotation||-45,e.value=e.value||"ลายน้ำ"):(e.width="150px",e.height="150px",e.marginLeft=0,e.marginRight=0,e.marginTop=0,e.marginBottom=0),e.opacity=e.opacity||.3,e.zIndex=e.zIndex||1,e.cornerPosition=e.cornerPosition||"center");const t="general"===e.use||"text"===e.use;let s=!1;if(t||(s=this.pages[0].elements.some((t=>t.id===e.id))),!s){const s={...e};t&&(s.uniqueId=Date.now()+Math.random()),this.pages[0].elements.push(s)}},toggleOptions(e){this.pages[0].elements.forEach((e=>{e.showOptions=!1})),e.showOptions=!e.showOptions},moveElementUp(e,t){if(t>0){const s=this.pages[e].elements[t];this.pages[e].elements[t]=this.pages[e].elements[t-1],this.pages[e].elements[t-1]=s}},moveElementDown(e,t){if(t<this.pages[e].elements.length-1){const s=this.pages[e].elements[t];this.pages[e].elements[t]=this.pages[e].elements[t+1],this.pages[e].elements[t+1]=s}},removeElement(e,t){const s=this.pages[e].elements.indexOf(t);-1!==s&&this.pages[e].elements.splice(s,1)},adjustMargin(e,t,s,a){let o=parseFloat(t[s]);const i=.1;isNaN(o)&&(o=0),a?t[s]=(o+i).toFixed(1):o>0&&(t[s]=(o-i).toFixed(1))},increaseTopMargin(e,t){t.marginTop+=.1},decreaseTopMargin(e,t){t.marginTop>0&&(t.marginTop-=.1)},increaseBottomMargin(e,t){t.marginBottom+=.1},decreaseBottomMargin(e,t){t.marginBottom>0&&(t.marginBottom-=.1)},toggleLayout(){this.pages[0].landscapeMode=!this.pages[0].landscapeMode},changeFontSize(e,t,s){const a=parseInt(t.fontSize);isNaN(a)||("increase"===s?t.fontSize=`${a+2}px`:"decrease"===s&&a>=4&&(t.fontSize=a-2+"px"))},toggleBold(e,t){t.bold=!t.bold},toggleItalic(e,t){t.italic=!t.italic},toggleUnderline(e,t){t.underline=!t.underline},increaseWidth(e,t){const s=parseInt(t.width),a=s+10;if(t.width=a+"px","general"===t.use&&t.maintainRatio&&t.aspectRatio){const e=Math.round(a/t.aspectRatio);t.height=e+"px"}},decreaseWidth(e,t){const s=parseInt(t.width);if(s>=20){const e=s-10;if(t.width=e+"px","general"===t.use&&t.maintainRatio&&t.aspectRatio){const s=Math.round(e/t.aspectRatio);t.height=s+"px"}}},increaseHeight(e,t){const s=parseInt(t.height),a=s+10;if(t.height=a+"px","general"===t.use&&t.maintainRatio&&t.aspectRatio){const e=Math.round(a*t.aspectRatio);t.width=e+"px"}},decreaseHeight(e,t){const s=parseInt(t.height);if(s>=20){const e=s-10;if(t.height=e+"px","general"===t.use&&t.maintainRatio&&t.aspectRatio){const s=Math.round(e*t.aspectRatio);t.width=s+"px"}}},selectElement(e){this.pages[0].elements.forEach((e=>{e.showOptions=!1})),e.showOptions=!0,console.log("Selected element:",e),console.log("Element type:",e.type),console.log("Element use:",e.use),console.log("Show options:",e.showOptions)},adjustOpacity(e,t){let s=parseFloat(e.opacity);const a=.1;isNaN(s)&&(s=0),t?s=Math.min(s+a,1):s>0&&(s=Math.max(s-a,0)),e.opacity=s.toFixed(1)},adjustZIndex(e,t){let s=parseInt(e.zIndex);const a=1;isNaN(s)&&(s=1),t?s=Math.max(s+a,1):s>1&&(s=Math.max(s-a,1)),e.zIndex=s.toString()},adjustRotation(e,t){let s=parseInt(e.rotation);const a=1;isNaN(s)&&(s=0),t?s=(s+a)%360:s>0&&(s=(s-a+360)%360),e.rotation=s.toString()},getElementPosition(e,t){if("image"!==e.type&&"watermark"!==e.type)return"auto";const s=e.cornerPosition;if("watermark"===e.type)switch(s){case"center":return"top"===t||"left"===t?"50%":"auto";case"top":return"top"===t?"10%":"left"===t?"50%":"auto";case"bottom":return"bottom"===t?"10%":"left"===t?"50%":"auto";default:break}return"top"===t?s.includes("top")?"0":"auto":"bottom"===t?s.includes("bottom")?"0":"auto":"left"===t?s.includes("left")?"0":"auto":"right"===t&&s.includes("right")?"0":"auto"},getElementTransform(e){let t=[];return"watermark"===e.type&&"center"===e.cornerPosition?t.push("translate(-50%, -50%)"):"watermark"!==e.type||"top"!==e.cornerPosition&&"bottom"!==e.cornerPosition||t.push("translateX(-50%)"),"watermark"===e.type&&"text"===e.watermarkType&&e.textRotation&&t.push(`rotate(${e.textRotation}deg)`),("image"===e.type||"watermark"===e.type&&"image"===e.watermarkType)&&e.rotation&&t.push(`rotate(${e.rotation}deg)`),t.length>0?t.join(" "):"none"},changeWatermarkFontSize(e,t){const s=parseFloat(e.fontSize);isNaN(s)||("increase"===t?e.fontSize=`${s+2}px`:"decrease"===t&&s>=4&&(e.fontSize=s-2+"px"))},adjustTextRotation(e,t){const s=parseInt(e.textRotation);isNaN(s)||(t?e.textRotation=(s+15)%360:s>0&&(e.textRotation=(s-15+360)%360))},adjustCertificateValidity(e,t){let s=parseInt(e.validityYears);const a=1;isNaN(s)&&(s=1),t?s=Math.max(s+a,1):s>1&&(s=Math.max(s-a,1)),e.validityYears=s.toString()},getDisplayDate(e){void 0===e.showIssueDate&&(e.showIssueDate=!0),void 0===e.showExpiryDate&&(e.showExpiryDate=!1);let t,s=[];if(e.showIssueDate||e.showExpiryDate||(e.showIssueDate=!0),t=e.useMultipleDates&&e.dateItems&&e.dateItems.length>0?e.dateItems[0].date:e.singleDate,e.showIssueDate&&(t?s.push(this.formatThaidate(t)):s.push("กรุณาเลือกวันที่")),e.showExpiryDate)if(t){const a=new Date(t);if(isNaN(a.getTime()))s.push("กรุณาเลือกวันที่ออกใบรับรอง");else{const t=parseInt(e.validityYears)||1,o=new Date(a);o.setFullYear(o.getFullYear()+t),s.push(this.formatThaidate(o))}}else s.push("กรุณาเลือกวันที่ออกใบรับรอง");let a=e.dateSeparator||" | ";"custom"===e.dateSeparator&&e.customSeparator&&(a=e.customSeparator),"\n"===e.dateSeparator&&(a="\n");const o=s.join(a);return e.start+o+e.end},getDisplayName(e){if("name"!==e.use)return e.start+e.text+e.end;let t="";if(e.showPrefix){const s=e.fallbackPrefix||"คุณ";t+=s+" "}return t+=e.text,e.start+t+e.end}},mounted(){void 0===this.pages[0].allowDownload&&(this.pages[0].allowDownload=!1)},beforeUnmount(){this.showPreviewModal&&(document.body.classList.remove("modal-open"),document.removeEventListener("keydown",this.handlePreviewKeydown))}};const FI=(0,rr.A)(SI,[["render",LI],["__scopeId","data-v-66bafb8d"]]);var II=FI;const EI=new mr.A(!1);var $I={props:{courseData:Object,callParentFunctionProp:Function,tabs:Object,updateTabs:Object},data(){return{configs:n.A.get("configs"),session:n.A.get("session"),showCertConfig:!1,certData:{},certList:[],selectedCertItem:null,showModal:!1,editingCertId:null,editingCertName:""}},components:{CertificationBuilder:II},methods:{async callbackFunction(){try{console.log("callbackFunction"),await this.getSurvey(),await this.getSurveySubmission()}catch(e){console.error(e)}},updateBadge(e){this.$emit("update-badge",{code:this.tabs.code,badge:e})},openModal(e){this.modalContent=e,this.showModal=!0,document.body.classList.add("modal-open"),document.addEventListener("keydown",this.handleKeydown)},closeModal(){this.modalContent=null,this.showModal=!1,document.body.classList.remove("modal-open"),document.removeEventListener("keydown",this.handleKeydown)},handleKeydown(e){"Escape"===e.key&&this.showModal&&this.closeModal()},handleImageError(e){const t=e.target,s=t.parentElement;if(t.style.display="none",!s.querySelector(".certificate-thumbnail-fallback")){const e=document.createElement("div");e.className="certificate-thumbnail-fallback",e.innerHTML='<i class="fas fa-certificate text-purple-600 text-sm"></i>',s.appendChild(e)}},callParentFunction(){"function"===typeof this.callParentFunctionProp&&this.callParentFunctionProp()},async handleDataFromChild(e){hr.A.log("Data received from child component:",e),await this.updateCert(e,!0)},async saveCertConfig(){try{this.certData.name="Certification Name",this.certData.description="Certification Description",this.certData.default=!1;const e=[{landscapeMode:!0,padding:"1cm",name:"Page 1",backgroundImage:"",elements:[]}];this.certData.pages=e;const t={data:{...this.certData,unit:this.session.current._id}},s=await EI.POST("certification_template",t,this.configs.key);200===s.status?(await this.getCert(),this.toggleExpand(s.data)):console.error("Error saving certification configuration:",s.statusText)}catch(e){console.error("An error occurred while saving certification configuration:",e)}},async getCert(){try{const e={method:"find",args:[{$and:[{unit:this.session.current._id}]}]},t=await EI.POST("certification_template/query",e,this.configs.key);if(200!==t.status)throw new Error("Failed to fetch player data from API");hr.A.log("resAPICert",t.data),this.certList=t.data}catch(e){throw console.error("An error occurred while fetching player data:",e),e}},async setDefaultCert(e){this.certList.forEach((async t=>{t._id===e?(this.selectedCertItem=t,t.default=!0):(this.selectedCertItem=t,t.default=!1),await this.updateCert(t,!1)}))},async updateCert(e,t){try{if(!this.selectedCertItem)return void console.error("No certificate item selected");hr.A.log("selectedCertItem",this.selectedCertItem);const s={...this.selectedCertItem};let a;delete s._id,a=t?e:this.selectedCertItem.pages;const o={data:{...s,name:this.selectedCertItem.name,description:this.selectedCertItem.description,pages:a}},i=await EI.PUT(`certification_template/${this.selectedCertItem._id}`,o,this.configs.key);200===i.status?(await this.getCert(),t?(0,gr.A)({type:"success",message:"บันทึกใบรับรองสำเร็จ!",autohide:!0}):this.showModal=!1):(console.error("Error updating certification:",i.statusText),(0,gr.A)({type:"error",message:"เกิดข้อผิดพลาดในการบันทึก",autohide:!0}))}catch(s){throw console.error("An error occurred while updating certification:",s),s}},toggleAssignCert(e,t){this.isCertAssigned(e)?this.assignCert(null,t):this.assignCert(e,t)},isCertAssigned(e){return this.courseData.certificationId===e},toggleExpand(e){this.selectedCertItem=e,this.showModal=!0},async assignCert(e,t){try{const s=this.certList[t];if(s.default||!this.courseData)return void console.error("Cannot assign the cerification to the course.");const a={data:{certificationId:e}},o=await EI.PUT(`course/${this.courseData._id}`,a,this.configs.key);200===o.status?(this.callParentFunction(),hr.A.log("Certification assigned to the course.")):console.error("Error assigning cerification to the course:",o.statusText)}catch(s){throw console.error("An error occurred while assigning the cerification to the course:",s),s}},async deleteCert(e,t){try{const s=this.certList[t];if(s.default)return void console.error("Cannot delete the default cerification.");const a=await EI.DELETE(`certification_template/${e}`,this.configs.key);200===a.status?this.certList.splice(t,1):console.error("Error deleting cerification item:",a.statusText)}catch(s){throw console.error("An error occurred while deleting cerification item:",s),s}},startNameEdit(e){this.editingCertId=e._id,this.editingCertName=e.name,this.$nextTick((()=>{const t=this.$refs[`nameInput_${e._id}`],s=Array.isArray(t)?t[0]:t;s&&"function"===typeof s.focus&&(s.focus(),"function"===typeof s.select&&s.select())}))},saveNameEdit(e){e.name=this.editingCertName,this.editingCertId=null,this.editingCertName="",this.updateCertName(e)},async updateCertName(e){try{const t={...e};delete t._id;const s={data:{...t,name:e.name,description:e.description,pages:e.pages}},a=await EI.PUT(`certification_template/${e._id}`,s,this.configs.key);200===a.status?(await this.getCert(),this.selectedCertItem&&this.selectedCertItem._id===e._id&&(this.selectedCertItem.name=e.name)):console.error("Error updating certification name:",a.statusText)}catch(t){throw console.error("An error occurred while updating certification name:",t),t}},cancelNameEdit(){this.editingCertId=null,this.editingCertName=""}},async mounted(){try{await this.getCert()}catch(e){console.error(e)}},beforeUnmount(){this.showModal&&(document.body.classList.remove("modal-open"),document.removeEventListener("keydown",this.handleKeydown))}};const _I=(0,rr.A)($I,[["render",hL],["__scopeId","data-v-7a04a1c6"]]);var PI=_I;const TI={class:"bg-white rounded-lg shadow-sm border border-gray-200"},AI={class:"px-4 py-3 border-b border-gray-200"},XI={class:"flex items-center justify-between"},jI={class:"flex items-center space-x-3"},UI={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center"},BI={class:"text-sm text-gray-600"},OI={class:"flex items-center space-x-2"},QI={key:0,class:"mt-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200"},MI={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},VI={class:"text-center"},RI={class:"text-2xl font-bold text-blue-600"},WI={class:"text-center"},NI={class:"text-2xl font-bold text-green-600"},qI={class:"text-center"},KI={class:"text-2xl font-bold text-purple-600"},HI={class:"text-center"},zI={class:"text-2xl font-bold text-orange-600"},GI={key:0,class:"mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded-lg"},JI={class:"flex items-center text-xs text-yellow-800"},YI={class:"ml-1"},ZI={key:1,class:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg"},eE={class:"flex items-center justify-between"},tE={class:"flex items-center space-x-3"},sE={class:"text-sm font-medium text-blue-900"},aE={class:"flex items-center space-x-2"},oE=["disabled"],iE=["disabled"],rE={class:"px-4 py-4 border-b border-gray-200 bg-gray-50"},nE={class:"flex items-center justify-between"},lE={class:"flex items-center space-x-3"},cE={class:"w-6 h-6 bg-gradient-to-br from-green-500 to-green-600 rounded-md flex items-center justify-center"},dE={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-6 pt-4"},uE={class:"bg-white rounded-lg p-4 border border-gray-200 shadow-sm"},mE={class:"flex items-center space-x-2 mb-3"},gE={class:"space-y-2"},pE={class:"flex items-center space-x-2 cursor-pointer"},hE={class:"flex items-center space-x-2 cursor-pointer"},bE={class:"mt-2 text-xs text-gray-500"},xE={key:0},yE={key:1},fE={class:"bg-white rounded-lg p-4 border border-gray-200 shadow-sm"},kE={class:"flex items-center space-x-2 mb-3"},vE={class:"space-y-2"},wE={class:"flex items-center space-x-2 cursor-pointer"},LE={class:"flex items-center space-x-2 cursor-pointer"},CE={class:"mt-2 text-xs text-gray-500"},DE={key:0},SE={key:1},FE={class:"bg-white rounded-lg p-4 border border-gray-200 shadow-sm"},IE={class:"flex items-center space-x-2 mb-3"},EE={class:"space-y-2"},$E={class:"flex items-center space-x-2 cursor-pointer"},_E={class:"flex items-center space-x-2 cursor-pointer"},PE={key:0,class:"mt-3"},TE={class:"flex items-center space-x-2"},AE={class:"mt-2 text-xs text-gray-500"},XE={key:0},jE={key:1},UE={key:2},BE={key:1,class:"mt-4 flex justify-end"},OE=["disabled"],QE={class:"bg-blue-50 border-l-4 border-blue-400 p-3"},ME={class:"flex items-center justify-between"},VE={class:"flex"},RE={class:"flex-shrink-0"},WE={class:"flex items-center space-x-2"},NE={key:0,class:"mt-3 p-3 bg-white rounded border border-blue-200"},qE={class:"p-4 relative"},KE={key:0,class:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-20 rounded-lg"},HE={key:1,class:"text-center py-12"},zE={class:"w-16 h-16 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center mx-auto mb-4"},GE={key:2,class:"relative"},JE={class:"space-y-6 relative"},YE={class:"relative z-10 flex-shrink-0"},ZE={class:"text-white font-bold text-sm"},e$={class:"p-5"},t$={class:"flex items-center justify-between mb-3"},s$={class:"flex items-center space-x-4 flex-1"},a$={class:"flex-shrink-0"},o$=["checked","onChange","title"],i$={class:"flex-shrink-0"},r$=["title"],n$=["src","alt"],l$=["title"],c$={class:"flex-1 min-w-0"},d$=["title"],u$={class:"flex items-center space-x-4 text-sm text-gray-600"},m$={class:"flex items-center bg-blue-50 px-2 py-1 rounded-full"},g$={class:"font-medium"},p$={class:"flex items-center bg-green-50 px-2 py-1 rounded-full"},h$={class:"font-medium"},b$={class:"flex items-center space-x-2 ml-4"},x$=["onClick","disabled"],y$=["onClick","disabled"],f$=["onClick"],k$=["onClick","title"],v$=["onClick"],w$={key:0,class:"flex flex-wrap gap-2 mb-3"},L$={key:0,class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700 border border-gray-200"},C$={key:1,class:"mt-3 p-3 bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 rounded-xl"},D$={class:"flex items-center text-sm text-amber-800"},S$={class:"ml-2 font-bold truncate text-amber-900"},F$={class:"bg-gradient-to-r from-gray-50 to-gray-100 px-5 py-3 border-t border-gray-200"},I$={class:"flex items-center justify-between text-sm text-gray-600"},E$={class:"font-medium"},$$={class:"flex items-center"},_$={class:"w-20 bg-gray-300 rounded-full h-2 mr-3 overflow-hidden"},P$={class:"font-bold text-blue-600"},T$={class:"mt-8 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200"},A$={class:"flex items-center justify-between mb-4"},X$={class:"flex items-center space-x-3"},j$={class:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center"},U$={class:"text-sm text-gray-600"},B$=["aria-label"],O$={class:"mb-4 p-3 bg-white rounded-lg border border-blue-200"},Q$={class:"text-sm font-bold text-gray-800 mb-3 flex items-center"},M$={class:"grid grid-cols-1 md:grid-cols-3 gap-3 text-xs"},V$={class:"flex items-center space-x-2"},R$={class:"flex items-center space-x-2"},W$={class:"flex items-center space-x-2"},N$={class:"grid grid-cols-3 gap-4 text-center"},q$={class:"p-3 bg-white rounded-lg border border-blue-200"},K$={class:"text-lg font-bold text-blue-600"},H$={class:"p-3 bg-white rounded-lg border border-green-200"},z$={class:"text-lg font-bold text-green-600"},G$={class:"p-3 bg-white rounded-lg border border-purple-200"},J$={class:"text-lg font-bold text-purple-600"},Y$={class:"mt-4 p-4 bg-white rounded-lg border border-gray-200"},Z$={class:"flex flex-wrap items-center gap-3 pt-4"},e_={class:"absolute -top-3 left-1/2 transform -translate-x-1/2 w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-xs font-bold shadow-lg step-badge z-10"},t_={class:"ml-2"},s_=["title"],a_={class:"flex items-center justify-between text-xs text-gray-600 mb-2"},o_={class:"flex items-center bg-white px-1.5 py-0.5 rounded-full border border-blue-100"},i_={class:"font-medium"},r_={class:"flex items-center bg-white px-1.5 py-0.5 rounded-full border border-green-100"},n_={class:"font-medium"},l_={class:"flex justify-center"},c_={key:0,class:"mt-4 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200"},d_={class:"flex items-center justify-center text-sm text-green-800"},u_={class:"font-semibold"},m_={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},g_={class:"flex min-h-full items-center justify-center p-4"},p_={class:"relative transform overflow-hidden rounded-lg bg-white shadow-xl transition-all w-full max-w-4xl max-h-[80vh] overflow-x-hidden"},h_={class:"bg-white px-6 py-4 border-b border-gray-200"},b_={class:"flex items-center justify-between"},x_={class:"flex items-center space-x-3"},y_={class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},f_={class:"px-6 py-4 border-b border-gray-200"},k_={class:"flex items-center space-x-4 mb-4"},v_={class:"flex-1"},w_={key:0,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},L_={class:"flex items-center space-x-3"},C_=["checked","indeterminate"],D_={class:"text-sm text-gray-700"},S_={key:0,class:"text-sm text-blue-600 font-medium"},F_={class:"flex items-center space-x-2"},I_={class:"px-6 py-4 max-h-96 overflow-y-auto overflow-x-hidden"},E_={key:0,class:"text-center py-8"},$_={key:1,class:"text-center py-8"},__={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},P_={key:2,class:"grid gap-3"},T_={class:"flex items-center space-x-3"},A_={key:0,class:"flex-shrink-0"},X_=["checked","onChange"],j_={key:1,class:"flex-shrink-0 w-4 h-4"},U_=["onClick"],B_={class:"flex-shrink-0"},O_={key:0,class:"w-10 h-10"},Q_=["src","alt"],M_={class:"flex-1 min-w-0"},V_={class:"flex items-center space-x-2 mb-1"},R_=["title"],W_={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-200 text-gray-600 flex-shrink-0"},N_={class:"flex-shrink-0"},q_=["onClick"],K_={key:1,class:"p-1 text-gray-400"},H_={class:"bg-gray-50 px-6 py-3"},z_={class:"flex justify-end space-x-3"},G_={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},J_={class:"flex min-h-full items-center justify-center p-4"},Y_={class:"relative transform overflow-hidden rounded-lg bg-white shadow-xl transition-all w-full max-w-4xl max-h-[80vh] overflow-x-hidden"},Z_={class:"bg-white px-6 py-4 border-b border-gray-200"},eP={class:"flex items-center justify-between"},tP={class:"flex items-center space-x-3"},sP={class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},aP={class:"text-lg font-semibold text-gray-900"},oP={class:"text-sm text-gray-500"},iP={class:"px-6 py-4 border-b border-gray-200"},rP={class:"flex justify-end space-x-3"};function nP(e,t,s,o,i,r){const n=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",TI,[(0,a.Lk)("div",AI,[(0,a.Lk)("div",XI,[(0,a.Lk)("div",jI,[(0,a.Lk)("div",UI,[(0,a.bF)(n,{icon:["fas","sitemap"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[33]||(t[33]=(0,a.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"จัดการเส้นทางการเรียนรู้",-1)),(0,a.Lk)("p",BI,"กำหนดลำดับการเรียนรู้ของหลักสูตร ("+(0,l.v_)(i.learningPathItems.length)+" ขั้นตอน)",1)])]),(0,a.Lk)("div",OI,[i.learningPathItems.length>0?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[0]||(t[0]=e=>i.showlearningPathStats=!i.showlearningPathStats),type:"button",class:(0,l.C4)(["inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-lg border transition-colors",i.showlearningPathStats?"bg-blue-100 text-blue-700 border-blue-300":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"])},[(0,a.bF)(n,{icon:["fas","chart-bar"],class:"mr-1.5"}),t[34]||(t[34]=(0,a.eW)(" สถิติ "))],2)):(0,a.Q3)("",!0),i.learningPathItems.length>0?((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:t[1]||(t[1]=(...e)=>r.exportLearningPath&&r.exportLearningPath(...e)),type:"button",class:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 transition-colors"},[(0,a.bF)(n,{icon:["fas","download"],class:"mr-1.5"}),t[35]||(t[35]=(0,a.eW)(" Export "))])):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.openCourseSelector&&r.openCourseSelector(...e)),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-blue-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-1.5"}),t[36]||(t[36]=(0,a.eW)(" เพิ่มหลักสูตร "))])])]),i.showlearningPathStats&&r.learningPathStats?((0,a.uX)(),(0,a.CE)("div",QI,[(0,a.Lk)("div",MI,[(0,a.Lk)("div",VI,[(0,a.Lk)("div",RI,(0,l.v_)(r.learningPathStats.totalCourses),1),t[37]||(t[37]=(0,a.Lk)("div",{class:"text-xs text-gray-600"},"หลักสูตรทั้งหมด",-1))]),(0,a.Lk)("div",WI,[(0,a.Lk)("div",NI,(0,l.v_)(r.learningPathStats.totalHours),1),t[38]||(t[38]=(0,a.Lk)("div",{class:"text-xs text-gray-600"},"ชั่วโมงรวม",-1))]),(0,a.Lk)("div",qI,[(0,a.Lk)("div",KI,(0,l.v_)(r.learningPathStats.totalEnrollments),1),t[39]||(t[39]=(0,a.Lk)("div",{class:"text-xs text-gray-600"},"ผู้ลงทะเบียนรวม",-1))]),(0,a.Lk)("div",HI,[(0,a.Lk)("div",zI,(0,l.v_)(Math.round(r.learningPathStats.completionRate))+"%",1),t[40]||(t[40]=(0,a.Lk)("div",{class:"text-xs text-gray-600"},"อัตราเปิดใช้งาน",-1))])]),r.validateLearningPath().isValid?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",GI,[(0,a.Lk)("div",JI,[(0,a.bF)(n,{icon:["fas","exclamation-triangle"],class:"mr-2 text-yellow-600"}),t[41]||(t[41]=(0,a.Lk)("span",{class:"font-medium"},"คำเตือน:",-1)),(0,a.Lk)("span",YI,(0,l.v_)(r.validateLearningPath().issues.join(", ")),1)])]))])):(0,a.Q3)("",!0),r.hasSelectedItems?((0,a.uX)(),(0,a.CE)("div",ZI,[(0,a.Lk)("div",eE,[(0,a.Lk)("div",tE,[(0,a.Lk)("span",sE," เลือกแล้ว "+(0,l.v_)(r.selectedItemsCount)+" รายการ ",1),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.clearSelection&&r.clearSelection(...e)),type:"button",class:"text-xs text-blue-700 hover:text-blue-900 underline"}," ยกเลิกการเลือก ")]),(0,a.Lk)("div",aE,[(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.bulkMoveUp&&r.bulkMoveUp(...e)),disabled:!r.canMoveSelectedUp,type:"button",class:(0,l.C4)(["px-2 py-1 text-xs font-medium rounded border transition-colors",r.canMoveSelectedUp?"bg-white text-blue-700 border-blue-300 hover:bg-blue-50":"bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed"])},[(0,a.bF)(n,{icon:["fas","arrow-up"],class:"mr-1"}),t[42]||(t[42]=(0,a.eW)(" ย้ายขึ้น "))],10,oE),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>r.bulkMoveDown&&r.bulkMoveDown(...e)),disabled:!r.canMoveSelectedDown,type:"button",class:(0,l.C4)(["px-2 py-1 text-xs font-medium rounded border transition-colors",r.canMoveSelectedDown?"bg-white text-blue-700 border-blue-300 hover:bg-blue-50":"bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed"])},[(0,a.bF)(n,{icon:["fas","arrow-down"],class:"mr-1"}),t[43]||(t[43]=(0,a.eW)(" ย้ายลง "))],10,iE),(0,a.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>r.bulkRemove&&r.bulkRemove(...e)),type:"button",class:"px-2 py-1 text-xs font-medium text-red-700 bg-white border border-red-300 rounded hover:bg-red-50 transition-colors"},[(0,a.bF)(n,{icon:["fas","trash"],class:"mr-1"}),t[44]||(t[44]=(0,a.eW)(" ลบ "))])])])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",rE,[(0,a.Lk)("div",nE,[(0,a.Lk)("div",lE,[(0,a.Lk)("div",cE,[(0,a.bF)(n,{icon:["fas","cog"],class:"text-white text-xs"})]),t[45]||(t[45]=(0,a.Lk)("h3",{class:"text-lg font-bold text-gray-900"},"การตั้งค่าเส้นทางการเรียนรู้",-1))]),(0,a.Lk)("button",{onClick:t[7]||(t[7]=e=>i.showPipelineSettings=!i.showPipelineSettings),type:"button",class:(0,l.C4)(["inline-flex items-center px-2 py-1 text-xs font-medium rounded-md border transition-colors",i.showPipelineSettings?"bg-green-100 text-green-700 border-green-300":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"])},[(0,a.bF)(n,{icon:["fas",i.showPipelineSettings?"chevron-up":"chevron-down"],class:"mr-1"},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(i.showPipelineSettings?"ซ่อน":"แสดง"),1)],2)]),i.showPipelineSettings?((0,a.uX)(),(0,a.CE)("div",dE,[(0,a.Lk)("div",uE,[(0,a.Lk)("div",mE,[(0,a.bF)(n,{icon:["fas","list-ol"],class:"text-blue-500"}),t[46]||(t[46]=(0,a.Lk)("h4",{class:"text-base font-bold text-gray-900"},"ลำดับการเรียน",-1))]),(0,a.Lk)("div",gE,[(0,a.Lk)("label",pE,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>i.pipelineSettings.learningOrder=e),type:"radio",value:"sequential",class:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"},null,512),[[c.XL,i.pipelineSettings.learningOrder]]),t[47]||(t[47]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"เรียงตามลำดับ",-1))]),(0,a.Lk)("label",hE,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>i.pipelineSettings.learningOrder=e),type:"radio",value:"flexible",class:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"},null,512),[[c.XL,i.pipelineSettings.learningOrder]]),t[48]||(t[48]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"อิสระ",-1))])]),(0,a.Lk)("div",bE,["sequential"===i.pipelineSettings.learningOrder?((0,a.uX)(),(0,a.CE)("span",xE," ผู้เรียนต้องเรียนตามลำดับที่กำหนด ")):((0,a.uX)(),(0,a.CE)("span",yE," ผู้เรียนสามารถเรียนได้ในลำดับใดก็ได้ "))])]),(0,a.Lk)("div",fE,[(0,a.Lk)("div",kE,[(0,a.bF)(n,{icon:["fas","certificate"],class:"text-yellow-500"}),t[49]||(t[49]=(0,a.Lk)("h4",{class:"text-base font-bold text-gray-900"},"ใบรับรอง",-1))]),(0,a.Lk)("div",vE,[(0,a.Lk)("label",wE,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>i.pipelineSettings.certificate=e),type:"radio",value:"issue",class:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"},null,512),[[c.XL,i.pipelineSettings.certificate]]),t[50]||(t[50]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"แจกใบรับรอง",-1))]),(0,a.Lk)("label",LE,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>i.pipelineSettings.certificate=e),type:"radio",value:"no_issue",class:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"},null,512),[[c.XL,i.pipelineSettings.certificate]]),t[51]||(t[51]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"ไม่แจก",-1))])]),(0,a.Lk)("div",CE,["issue"===i.pipelineSettings.certificate?((0,a.uX)(),(0,a.CE)("span",DE," ออกใบรับรองเมื่อผ่าน Pipeline ครบ ")):((0,a.uX)(),(0,a.CE)("span",SE," ไม่ออกใบรับรองสำหรับ Pipeline นี้ "))])]),(0,a.Lk)("div",FE,[(0,a.Lk)("div",IE,[(0,a.bF)(n,{icon:["fas","clock"],class:"text-red-500"}),t[52]||(t[52]=(0,a.Lk)("h4",{class:"text-base font-bold text-gray-900"},"ระยะเวลาในการเรียน",-1))]),(0,a.Lk)("div",EE,[(0,a.Lk)("label",$E,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>i.pipelineSettings.timeLimit=e),type:"radio",value:"unlimited",class:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"},null,512),[[c.XL,i.pipelineSettings.timeLimit]]),t[53]||(t[53]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"ไม่จำกัด",-1))]),(0,a.Lk)("label",_E,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[13]||(t[13]=e=>i.pipelineSettings.timeLimit=e),type:"radio",value:"limited",class:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"},null,512),[[c.XL,i.pipelineSettings.timeLimit]]),t[54]||(t[54]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"จำกัด",-1))])]),"limited"===i.pipelineSettings.timeLimit?((0,a.uX)(),(0,a.CE)("div",PE,[t[56]||(t[56]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"}," จำนวนวันหลังลงทะเบียน ",-1)),(0,a.Lk)("div",TE,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>i.pipelineSettings.timeLimitDays=e),type:"number",min:"1",max:"365",class:"w-16 px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[c.Jo,i.pipelineSettings.timeLimitDays,void 0,{number:!0}]]),t[55]||(t[55]=(0,a.Lk)("span",{class:"text-xs text-gray-600"},"วัน",-1))])])):(0,a.Q3)("",!0),(0,a.Lk)("div",AE,["unlimited"===i.pipelineSettings.timeLimit?((0,a.uX)(),(0,a.CE)("span",XE," ผู้เรียนสามารถเรียนได้ไม่จำกัดเวลา ")):i.pipelineSettings.timeLimitDays?((0,a.uX)(),(0,a.CE)("span",jE," ผู้เรียนมีเวลา "+(0,l.v_)(i.pipelineSettings.timeLimitDays)+" วันในการเรียน Pipeline นี้ ",1)):((0,a.uX)(),(0,a.CE)("span",UE," กรุณาระบุจำนวนวัน "))])])])):(0,a.Q3)("",!0),i.showPipelineSettings?((0,a.uX)(),(0,a.CE)("div",BE,[(0,a.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>r.saveLearningPathSettings&&r.saveLearningPathSettings(...e)),type:"button",class:"inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors",disabled:i.isReordering},[(0,a.bF)(n,{icon:["fas","save"],class:"mr-2"}),t[57]||(t[57]=(0,a.eW)(" บันทึกการตั้งค่า "))],8,OE)])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",QE,[(0,a.Lk)("div",ME,[(0,a.Lk)("div",VE,[(0,a.Lk)("div",RE,[(0,a.bF)(n,{icon:["fas","info-circle"],class:"text-blue-400 text-sm"})]),t[58]||(t[58]=(0,a.Lk)("div",{class:"ml-2"},[(0,a.Lk)("p",{class:"text-xs text-blue-700"},[(0,a.Lk)("strong",null,"หมายเหตุ:"),(0,a.eW)(" กำหนดลำดับหลักสูตรที่ผู้เรียนต้องผ่านก่อนจึงจะสามารถเข้าเรียนหลักสูตรนี้ได้ ")])],-1))]),(0,a.Lk)("div",WE,[(0,a.Lk)("button",{onClick:t[16]||(t[16]=e=>i.showShortcutsHelp=!i.showShortcutsHelp),type:"button",class:"text-xs text-blue-600 hover:text-blue-800 underline"}," คีย์ลัด ")])]),i.showShortcutsHelp?((0,a.uX)(),(0,a.CE)("div",NE,t[59]||(t[59]=[(0,a.Fv)('<h4 class="text-xs font-semibold text-blue-900 mb-2" data-v-698bf346>🎯 คีย์บอร์ดลัด</h4><div class="grid grid-cols-2 gap-2 text-xs text-blue-800" data-v-698bf346><div data-v-698bf346><kbd class="px-1 py-0.5 bg-blue-100 rounded" data-v-698bf346>Ctrl+A</kbd> เลือกทั้งหมด</div><div data-v-698bf346><kbd class="px-1 py-0.5 bg-blue-100 rounded" data-v-698bf346>Delete</kbd> ลบรายการที่เลือก</div><div data-v-698bf346><kbd class="px-1 py-0.5 bg-blue-100 rounded" data-v-698bf346>Ctrl+↑</kbd> ย้ายขึ้น</div><div data-v-698bf346><kbd class="px-1 py-0.5 bg-blue-100 rounded" data-v-698bf346>Ctrl+↓</kbd> ย้ายลง</div><div data-v-698bf346><kbd class="px-1 py-0.5 bg-blue-100 rounded" data-v-698bf346>Esc</kbd> ยกเลิกการเลือก</div><div data-v-698bf346><kbd class="px-1 py-0.5 bg-blue-100 rounded" data-v-698bf346>?</kbd> แสดงความช่วยเหลือ</div></div>',2)]))):(0,a.Q3)("",!0)]),(0,a.Lk)("div",qE,[i.isReordering?((0,a.uX)(),(0,a.CE)("div",KE,t[60]||(t[60]=[(0,a.Lk)("div",{class:"flex flex-col items-center space-y-3"},[(0,a.Lk)("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.Lk)("span",{class:"text-sm font-medium text-blue-600"},"กำลังบันทึกเส้นทางการเรียนรู้...")],-1)]))):(0,a.Q3)("",!0),0===i.learningPathItems.length?((0,a.uX)(),(0,a.CE)("div",HE,[(0,a.Lk)("div",zE,[(0,a.bF)(n,{icon:["fas","sitemap"],class:"text-blue-500 text-2xl"})]),t[62]||(t[62]=(0,a.Lk)("h3",{class:"text-2xl font-bold text-gray-900 mb-3"},"ยังไม่มีเส้นทางการเรียนรู้",-1)),t[63]||(t[63]=(0,a.Lk)("p",{class:"text-base text-gray-600 mb-6 max-w-md mx-auto"},"เริ่มต้นสร้างเส้นทางการเรียนรู้สำหรับหลักสูตรนี้ เพื่อกำหนดลำดับการเรียนรู้ที่ผู้เรียนต้องผ่าน",-1)),(0,a.Lk)("button",{onClick:t[17]||(t[17]=(...e)=>r.openCourseSelector&&r.openCourseSelector(...e)),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-2 text-sm font-medium text-white shadow-sm hover:from-blue-700 hover:to-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-2"}),t[61]||(t[61]=(0,a.eW)(" สร้างเส้นทางการเรียนรู้แรก "))])])):((0,a.uX)(),(0,a.CE)("div",GE,[(0,a.Lk)("div",JE,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.learningPathItems,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:e._id,class:(0,l.C4)(["relative flex items-center",{"pipeline-step-inactive":!e.status}]),style:(0,l.Tr)({animationDelay:.15*s+"s"})},[(0,a.Lk)("div",YE,[(0,a.Lk)("div",{class:(0,l.C4)(["w-12 h-12 rounded-full shadow-lg flex items-center justify-center border-3 border-white pipeline-node ring-2 transition-all duration-300",e.status?"bg-gradient-to-br from-blue-500 to-blue-700 ring-blue-100":"bg-gradient-to-br from-gray-400 to-gray-600 ring-gray-100 opacity-60"])},[(0,a.Lk)("span",ZE,(0,l.v_)(s+1),1),(0,a.Lk)("div",{class:(0,l.C4)(["absolute -top-1 -right-1 w-4 h-4 rounded-full border-2 border-white flex items-center justify-center",e.status?"bg-green-500":"bg-red-500"])},[(0,a.bF)(n,{icon:["fas",e.status?"check":"times"],class:(0,l.C4)([(e.status,"text-white"),"text-xs"])},null,8,["icon","class"])],2)],2),s<i.learningPathItems.length-1?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"absolute left-1/2 transform -translate-x-1/2 w-0.5 bg-gradient-to-b from-blue-400 via-blue-500 to-blue-600 pipeline-flow-line",style:(0,l.Tr)({top:"48px",height:"230px",animationDelay:.15*s+.6+"s"})},null,4)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",{class:"w-6 h-0.5 bg-gradient-to-r from-blue-500 to-blue-400 flex-shrink-0 connecting-line rounded-full",style:(0,l.Tr)({animationDelay:.15*s+.3+"s"})},null,4),(0,a.Lk)("div",{class:(0,l.C4)(["flex-1 bg-white rounded-2xl border border-gray-200 shadow-md hover:shadow-lg transition-all duration-300 overflow-hidden course-card",{"ring-2 ring-blue-400 bg-blue-50 border-blue-300":i.selectedItems.includes(s),"pipeline-item-inactive":!e.status}])},[(0,a.Lk)("div",e$,[(0,a.Lk)("div",t$,[(0,a.Lk)("div",s$,[(0,a.Lk)("div",a$,[(0,a.Lk)("input",{type:"checkbox",checked:i.selectedItems.includes(s),onChange:e=>r.toggleItemSelection(s),class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 focus:ring-2",title:i.selectedItems.includes(s)?"ยกเลิกการเลือก":"เลือกรายการนี้"},null,40,o$)]),(0,a.Lk)("div",i$,[e.cover?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"w-14 h-14 rounded-xl overflow-hidden border-2 border-gray-200 shadow-sm",title:`ดูรายละเอียด ${e.name}`},[(0,a.Lk)("img",{src:e.cover,alt:e.name,class:"w-full h-full object-cover",onError:t[18]||(t[18]=(...e)=>r.handleImageError&&r.handleImageError(...e))},null,40,n$)],8,r$)):((0,a.uX)(),(0,a.CE)("div",{key:1,class:"w-14 h-14 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl flex items-center justify-center border-2 border-blue-300",title:`${e.name}`},[(0,a.bF)(n,{icon:["fas","book"],class:"text-blue-600 text-xl"})],8,l$))]),(0,a.Lk)("div",c$,[(0,a.Lk)("h3",{class:"text-xl font-bold text-gray-900 mb-2 truncate",title:e.name},(0,l.v_)(e.name),9,d$),(0,a.Lk)("div",u$,[(0,a.Lk)("div",m$,[(0,a.bF)(n,{icon:["fas","clock"],class:"mr-1.5 text-blue-500"}),(0,a.Lk)("span",g$,(0,l.v_)(e.hours||"ไม่ระบุ")+" ชม.",1)]),(0,a.Lk)("div",p$,[(0,a.bF)(n,{icon:["fas","users"],class:"mr-1.5 text-green-500"}),(0,a.Lk)("span",h$,(0,l.v_)(e.enrollUserCount||0),1)]),(0,a.Lk)("div",{class:(0,l.C4)(["flex items-center px-2 py-1 rounded-full",e.status?"bg-green-50":"bg-red-50"])},[(0,a.bF)(n,{icon:["fas",e.status?"check-circle":"times-circle"],class:(0,l.C4)([e.status?"text-green-500":"text-red-500","mr-1.5"])},null,8,["icon","class"]),(0,a.Lk)("span",{class:(0,l.C4)([e.status?"text-green-700 font-medium":"text-red-700 font-medium","text-sm"])},(0,l.v_)(e.status?"เปิดใช้งาน":"ปิดใช้งาน"),3)],2)])])]),(0,a.Lk)("div",b$,[(0,a.Lk)("button",{onClick:e=>r.moveUp(s),disabled:0===s,type:"button",class:(0,l.C4)(["p-2 rounded-xl border text-sm transition-all duration-200",0===s?"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed":"border-blue-200 text-blue-600 bg-blue-50 hover:bg-blue-100 hover:scale-105"]),title:"ย้ายขึ้น"},[(0,a.bF)(n,{icon:["fas","arrow-up"],class:"text-sm"})],10,x$),(0,a.Lk)("button",{onClick:e=>r.moveDown(s),disabled:s===i.learningPathItems.length-1,type:"button",class:(0,l.C4)(["p-2 rounded-xl border text-sm transition-all duration-200",s===i.learningPathItems.length-1?"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed":"border-blue-200 text-blue-600 bg-blue-50 hover:bg-blue-100 hover:scale-105"]),title:"ย้ายลง"},[(0,a.bF)(n,{icon:["fas","arrow-down"],class:"text-sm"})],10,y$),(0,a.Lk)("button",{onClick:t=>r.viewCourseDetail(e),type:"button",class:"p-2 rounded-xl border border-gray-200 text-gray-600 bg-white hover:bg-gray-50 hover:scale-105 transition-all duration-200 text-sm",title:"ดูรายละเอียด"},[(0,a.bF)(n,{icon:["fas","eye"],class:"text-sm"})],8,f$),(0,a.Lk)("button",{onClick:e=>r.toggleLearningPathItemStatus(s),type:"button",class:(0,l.C4)(["p-2 rounded-xl border text-sm transition-all duration-200",e.status?"border-green-200 text-green-600 bg-green-50 hover:bg-green-100 hover:scale-105":"border-red-200 text-red-600 bg-red-50 hover:bg-red-100 hover:scale-105"]),title:e.status?"ปิดใช้งานเส้นทางการเรียนรู้นี้":"เปิดใช้งานเส้นทางการเรียนรู้นี้"},[(0,a.bF)(n,{icon:["fas",e.status?"toggle-on":"toggle-off"],class:"text-sm"},null,8,["icon"])],10,k$),(0,a.Lk)("button",{onClick:e=>r.removeLearningPathItem(s),type:"button",class:"p-2 rounded-xl border border-red-200 text-red-600 bg-red-50 hover:bg-red-100 hover:scale-105 transition-all duration-200 text-sm",title:"ลบออกจากเส้นทางการเรียนรู้"},[(0,a.bF)(n,{icon:["fas","trash"],class:"text-sm"})],8,v$)])]),e.categoryData&&e.categoryData.length>0?((0,a.uX)(),(0,a.CE)("div",w$,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.categoryData.slice(0,3),(e=>((0,a.uX)(),(0,a.CE)("span",{key:e._id,class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-indigo-100 text-indigo-800 border border-indigo-200"},(0,l.v_)(e.name),1)))),128)),e.categoryData.length>3?((0,a.uX)(),(0,a.CE)("span",L$," +"+(0,l.v_)(e.categoryData.length-3)+" เพิ่มเติม ",1)):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),s>0?((0,a.uX)(),(0,a.CE)("div",C$,[(0,a.Lk)("div",D$,[(0,a.bF)(n,{icon:["fas","link"],class:"mr-2 text-amber-600"}),t[64]||(t[64]=(0,a.Lk)("span",{class:"font-semibold"},"ต้องผ่าน:",-1)),(0,a.Lk)("span",S$,(0,l.v_)(i.learningPathItems[s-1].name),1)])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",F$,[(0,a.Lk)("div",I$,[(0,a.Lk)("span",E$,"ขั้นตอนที่ "+(0,l.v_)(s+1)+" จาก "+(0,l.v_)(i.learningPathItems.length),1),(0,a.Lk)("div",$$,[(0,a.Lk)("div",_$,[(0,a.Lk)("div",{class:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-500 progress-bar",style:(0,l.Tr)({width:(s+1)/i.learningPathItems.length*100+"%"})},null,4)]),(0,a.Lk)("span",P$,(0,l.v_)(Math.round((s+1)/i.learningPathItems.length*100))+"%",1)])])])],2)],6)))),128))]),(0,a.Lk)("div",T$,[(0,a.Lk)("div",A$,[(0,a.Lk)("div",X$,[(0,a.Lk)("div",j$,[(0,a.bF)(n,{icon:["fas","flag-checkered"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[65]||(t[65]=(0,a.Lk)("h4",{class:"text-lg font-bold text-gray-900"},"เส้นทางการเรียนรู้สมบูรณ์",-1)),(0,a.Lk)("p",U$,"ผู้เรียนต้องผ่านทั้งหมด "+(0,l.v_)(i.learningPathItems.length)+" ขั้นตอน",1)])]),(0,a.Lk)("button",{onClick:t[19]||(t[19]=(...e)=>r.openCourseSelector&&r.openCourseSelector(...e)),type:"button",class:"inline-flex items-center px-3 py-1.5 bg-white border border-blue-300 rounded-lg text-xs font-medium text-blue-700 hover:bg-blue-50 transition-all","aria-label":`เพิ่มขั้นตอนใหม่ในเส้นทางการเรียนรู้ ปัจจุบันมี ${i.learningPathItems.length} ขั้นตอน`},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-1.5"}),t[66]||(t[66]=(0,a.eW)(" เพิ่มขั้นตอน "))],8,B$)]),(0,a.Lk)("div",O$,[(0,a.Lk)("h5",Q$,[(0,a.bF)(n,{icon:["fas","cog"],class:"mr-2 text-blue-500"}),t[67]||(t[67]=(0,a.eW)(" การตั้งค่าปัจจุบัน "))]),(0,a.Lk)("div",M$,[(0,a.Lk)("div",V$,[(0,a.bF)(n,{icon:["fas","list-ol"],class:"text-blue-500"}),t[68]||(t[68]=(0,a.Lk)("span",{class:"text-gray-600"},"ลำดับการเรียน:",-1)),(0,a.Lk)("span",{class:(0,l.C4)(["font-semibold","sequential"===i.pipelineSettings.learningOrder?"text-blue-700":"text-green-700"])},(0,l.v_)("sequential"===i.pipelineSettings.learningOrder?"เรียงตามลำดับ":"อิสระ"),3)]),(0,a.Lk)("div",R$,[(0,a.bF)(n,{icon:["fas","certificate"],class:"text-yellow-500"}),t[69]||(t[69]=(0,a.Lk)("span",{class:"text-gray-600"},"ใบรับรอง:",-1)),(0,a.Lk)("span",{class:(0,l.C4)(["font-semibold","issue"===i.pipelineSettings.certificate?"text-green-700":"text-red-700"])},(0,l.v_)("issue"===i.pipelineSettings.certificate?"แจก":"ไม่แจก"),3)]),(0,a.Lk)("div",W$,[(0,a.bF)(n,{icon:["fas","clock"],class:"text-red-500"}),t[70]||(t[70]=(0,a.Lk)("span",{class:"text-gray-600"},"ระยะเวลา:",-1)),(0,a.Lk)("span",{class:(0,l.C4)(["font-semibold","unlimited"===i.pipelineSettings.timeLimit?"text-green-700":"text-orange-700"])},(0,l.v_)("unlimited"===i.pipelineSettings.timeLimit?"ไม่จำกัด":`${i.pipelineSettings.timeLimitDays} วัน`),3)])])]),(0,a.Lk)("div",N$,[(0,a.Lk)("div",q$,[(0,a.Lk)("div",K$,(0,l.v_)(r.learningPathStats?.totalHours||0),1),t[71]||(t[71]=(0,a.Lk)("div",{class:"text-xs text-gray-600"},"ชั่วโมงรวม",-1))]),(0,a.Lk)("div",H$,[(0,a.Lk)("div",z$,(0,l.v_)(r.learningPathStats?.activeCount||0),1),t[72]||(t[72]=(0,a.Lk)("div",{class:"text-xs text-gray-600"},"หลักสูตรเปิดใช้งาน",-1))]),(0,a.Lk)("div",G$,[(0,a.Lk)("div",J$,(0,l.v_)(r.learningPathStats?.uniqueCategories||0),1),t[73]||(t[73]=(0,a.Lk)("div",{class:"text-xs text-gray-600"},"หมวดหมู่",-1))])]),(0,a.Lk)("div",Y$,[t[74]||(t[74]=(0,a.Lk)("h5",{class:"text-lg font-bold text-gray-800 mb-4 flex items-center"},[(0,a.Lk)("span",{class:"text-xl mr-3"},"🎯"),(0,a.eW)(" เส้นทางการเรียนรู้ ")],-1)),(0,a.Lk)("div",Z$,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.learningPathItems,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:e._id,class:"flex items-center gap-4 overflow-x-auto pb-2"},[(0,a.Lk)("div",{class:(0,l.C4)(["bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-3 border border-blue-200 shadow-sm hover:shadow-md transition-all duration-300 relative learning-path-card w-48 min-w-48 mt-4",{"opacity-60 grayscale":!e.status}])},[(0,a.Lk)("div",e_,(0,l.v_)(t+1),1),(0,a.Lk)("div",t_,[(0,a.Lk)("h6",{class:"text-base font-bold text-gray-900 mb-2 truncate w-full",title:e.name},(0,l.v_)(e.name),9,s_),(0,a.Lk)("div",a_,[(0,a.Lk)("div",o_,[(0,a.bF)(n,{icon:["fas","clock"],class:"mr-1 text-blue-500"}),(0,a.Lk)("span",i_,(0,l.v_)(e.hours||"ไม่ระบุ")+" ชม.",1)]),(0,a.Lk)("div",r_,[(0,a.bF)(n,{icon:["fas","users"],class:"mr-1 text-green-500"}),(0,a.Lk)("span",n_,(0,l.v_)(e.enrollUserCount||0),1)])]),(0,a.Lk)("div",l_,[(0,a.Lk)("span",{class:(0,l.C4)(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",e.status?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"])},[(0,a.bF)(n,{icon:["fas",e.status?"check-circle":"times-circle"],class:"mr-1"},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(e.status?"เปิดใช้งาน":"ปิดใช้งาน"),1)],2)])])],2),t<i.learningPathItems.length-1?((0,a.uX)(),(0,a.Wv)(n,{key:0,icon:["fas","arrow-right"],class:"mx-3 text-blue-400 text-lg flex-shrink-0"})):(0,a.Q3)("",!0)])))),128))]),i.learningPathItems.length>1?((0,a.uX)(),(0,a.CE)("div",c_,[(0,a.Lk)("div",d_,[(0,a.bF)(n,{icon:["fas","trophy"],class:"mr-2 text-green-600"}),(0,a.Lk)("span",u_," เมื่อผ่านครบ "+(0,l.v_)(i.learningPathItems.length)+" ขั้นตอน ผู้เรียนจะได้รับใบประกาศ ",1)])])):(0,a.Q3)("",!0)])])]))])]),(0,a.bF)(c.eB,{"enter-active-class":"modal-enter-active","leave-active-class":"modal-leave-active","enter-from-class":"modal-enter-from","leave-to-class":"modal-leave-to"},{default:(0,a.k6)((()=>[i.showCourseSelector?((0,a.uX)(),(0,a.CE)("div",m_,[(0,a.Lk)("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t[20]||(t[20]=(...e)=>r.closeCourseSelector&&r.closeCourseSelector(...e))}),(0,a.Lk)("div",g_,[(0,a.Lk)("div",p_,[(0,a.Lk)("div",h_,[(0,a.Lk)("div",b_,[(0,a.Lk)("div",x_,[(0,a.Lk)("div",y_,[(0,a.bF)(n,{icon:["fas","search"],class:"text-blue-600"})]),t[75]||(t[75]=(0,a.Lk)("div",null,[(0,a.Lk)("h3",{class:"text-xl font-bold text-gray-900"},"เลือกหลักสูตรเพิ่มในเส้นทางการเรียนรู้"),(0,a.Lk)("p",{class:"text-sm text-gray-600"},"เลือกหลักสูตรที่ต้องการเพิ่มเข้าเส้นทางการเรียนรู้")],-1))]),(0,a.Lk)("button",{onClick:t[21]||(t[21]=(...e)=>r.closeCourseSelector&&r.closeCourseSelector(...e)),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[(0,a.bF)(n,{icon:["fas","times"],class:"text-xl"})])])]),(0,a.Lk)("div",f_,[(0,a.Lk)("div",k_,[(0,a.Lk)("div",v_,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[22]||(t[22]=e=>i.searchQuery=e),type:"text",placeholder:"ค้นหาหลักสูตร...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[c.Jo,i.searchQuery]])]),(0,a.Lk)("button",{onClick:t[23]||(t[23]=(...e)=>r.loadAvailableCourses&&r.loadAvailableCourses(...e)),class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"},[(0,a.bF)(n,{icon:["fas","search"],class:"mr-2"}),t[76]||(t[76]=(0,a.eW)(" ค้นหา "))])]),r.selectableCoursesCount>0?((0,a.uX)(),(0,a.CE)("div",w_,[(0,a.Lk)("div",L_,[(0,a.Lk)("input",{type:"checkbox",checked:r.allSelectableCoursesSelected,indeterminate:r.hasSelectedCourses&&!r.allSelectableCoursesSelected,onChange:t[24]||(t[24]=(...e)=>r.toggleSelectAll&&r.toggleSelectAll(...e)),class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"},null,40,C_),(0,a.Lk)("span",D_," เลือกทั้งหมด ("+(0,l.v_)(r.selectableCoursesCount)+" รายการ) ",1),r.hasSelectedCourses?((0,a.uX)(),(0,a.CE)("span",S_," - เลือกแล้ว "+(0,l.v_)(r.selectedCoursesCount)+" รายการ ",1)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",F_,[r.hasSelectedCourses?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[25]||(t[25]=(...e)=>r.clearCourseSelection&&r.clearCourseSelection(...e)),type:"button",class:"px-3 py-1.5 text-xs text-gray-600 hover:text-gray-800 underline"}," ยกเลิกการเลือก ")):(0,a.Q3)("",!0),r.hasSelectedCourses?((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:t[26]||(t[26]=(...e)=>r.addSelectedCoursesToPipeline&&r.addSelectedCoursesToPipeline(...e)),type:"button",class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm font-medium"},[(0,a.bF)(n,{icon:["fas","plus"],class:"mr-2"}),(0,a.eW)(" เพิ่ม "+(0,l.v_)(r.selectedCoursesCount)+" หลักสูตร ",1)])):(0,a.Q3)("",!0)])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",I_,[i.loading?((0,a.uX)(),(0,a.CE)("div",E_,t[77]||(t[77]=[(0,a.Lk)("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1),(0,a.Lk)("p",{class:"text-gray-500 mt-2"},"กำลังโหลดหลักสูตร...",-1)]))):0===i.availableCourses.length?((0,a.uX)(),(0,a.CE)("div",$_,[(0,a.Lk)("div",__,[(0,a.bF)(n,{icon:["fas","search"],class:"text-gray-400 text-lg"})]),t[78]||(t[78]=(0,a.Lk)("p",{class:"text-gray-500"},"ไม่พบหลักสูตรที่ตรงกับการค้นหา",-1))])):((0,a.uX)(),(0,a.CE)("div",P_,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.filteredCourses,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e._id,class:(0,l.C4)(["p-3 border rounded-lg transition-colors w-full overflow-hidden",{"border-gray-200 hover:border-blue-300 hover:bg-blue-50":!r.isInLearningPath(e._id),"border-gray-300 bg-gray-50 cursor-not-allowed opacity-60":r.isInLearningPath(e._id),"border-blue-300 bg-blue-50 ring-2 ring-blue-200":i.selectedCourses.includes(e._id)&&!r.isInLearningPath(e._id)}])},[(0,a.Lk)("div",T_,[r.isInLearningPath(e._id)?((0,a.uX)(),(0,a.CE)("div",j_)):((0,a.uX)(),(0,a.CE)("div",A_,[(0,a.Lk)("input",{type:"checkbox",checked:i.selectedCourses.includes(e._id),onChange:t=>r.toggleCourseSelection(e._id),class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500",onClick:t[27]||(t[27]=(0,c.D$)((()=>{}),["stop"]))},null,40,X_)])),(0,a.Lk)("div",{onClick:t=>r.isInLearningPath(e._id)?null:r.toggleCourseSelection(e._id),class:(0,l.C4)(["flex items-center space-x-3 flex-1 min-w-0",{"cursor-pointer":!r.isInLearningPath(e._id)}])},[(0,a.Lk)("div",B_,[e.cover?((0,a.uX)(),(0,a.CE)("div",O_,[(0,a.Lk)("img",{src:e.cover,alt:e.name,class:(0,l.C4)(["w-full h-full object-cover rounded-lg border border-gray-200",{"filter grayscale opacity-60":r.isInLearningPath(e._id)}])},null,10,Q_)])):((0,a.uX)(),(0,a.CE)("div",{key:1,class:(0,l.C4)(["w-10 h-10 rounded-lg flex items-center justify-center",r.isInLearningPath(e._id)?"bg-gray-200":"bg-gray-100"])},[(0,a.bF)(n,{icon:["fas","book"],class:(0,l.C4)(r.isInLearningPath(e._id)?"text-gray-400":"text-gray-500")},null,8,["class"])],2))]),(0,a.Lk)("div",M_,[(0,a.Lk)("div",V_,[(0,a.Lk)("h4",{class:(0,l.C4)(["text-sm font-medium truncate flex-1 min-w-0",r.isInLearningPath(e._id)?"text-gray-500":"text-gray-900"]),title:e.name},(0,l.v_)(e.name),11,R_),r.isInLearningPath(e._id)?((0,a.uX)(),(0,a.CE)("span",W_,[(0,a.bF)(n,{icon:["fas","check"],class:"mr-1"}),t[79]||(t[79]=(0,a.eW)(" อยู่ในเส้นทางการเรียนรู้แล้ว "))])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",{class:(0,l.C4)(["flex items-center space-x-3 text-xs mt-1",r.isInLearningPath(e._id)?"text-gray-400":"text-gray-500"])},[(0,a.Lk)("span",null,(0,l.v_)(e.hours||"ไม่ระบุ")+" ชม.",1),t[80]||(t[80]=(0,a.Lk)("span",null,"•",-1)),(0,a.Lk)("span",null,(0,l.v_)(e.enrollUserCount||0)+" ผู้เรียน",1),t[81]||(t[81]=(0,a.Lk)("span",null,"•",-1)),(0,a.Lk)("span",{class:(0,l.C4)(e.status?r.isInLearningPath(e._id)?"text-green-500":"text-green-600":r.isInLearningPath(e._id)?"text-red-500":"text-red-600")},(0,l.v_)(e.status?"เปิดใช้งาน":"ปิดใช้งาน"),3)],2)])],10,U_),(0,a.Lk)("div",N_,[r.isInLearningPath(e._id)?((0,a.uX)(),(0,a.CE)("div",K_,[(0,a.bF)(n,{icon:["fas","check"]})])):((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t=>r.addToLearningPath(e),class:"p-1 text-blue-600 hover:bg-blue-100 rounded transition-colors",title:"เพิ่มทันที"},[(0,a.bF)(n,{icon:["fas","plus"]})],8,q_))])])],2)))),128))]))]),(0,a.Lk)("div",H_,[(0,a.Lk)("div",z_,[(0,a.Lk)("button",{onClick:t[28]||(t[28]=(...e)=>r.closeCourseSelector&&r.closeCourseSelector(...e)),type:"button",class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors"}," ยกเลิก ")])])])])])):(0,a.Q3)("",!0)])),_:1}),(0,a.bF)(c.eB,{"enter-active-class":"modal-enter-active","leave-active-class":"modal-leave-active","enter-from-class":"modal-enter-from","leave-to-class":"modal-leave-to"},{default:(0,a.k6)((()=>[i.showConfirmDialog?((0,a.uX)(),(0,a.CE)("div",G_,[(0,a.Lk)("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t[29]||(t[29]=(...e)=>r.closeConfirmDialog&&r.closeConfirmDialog(...e))}),(0,a.Lk)("div",J_,[(0,a.Lk)("div",Y_,[(0,a.Lk)("div",Z_,[(0,a.Lk)("div",eP,[(0,a.Lk)("div",tP,[(0,a.Lk)("div",sP,[(0,a.bF)(n,{icon:["fas","exclamation-circle"],class:"text-blue-600"})]),(0,a.Lk)("div",null,[(0,a.Lk)("h3",aP,(0,l.v_)(i.confirmTitle),1),(0,a.Lk)("p",oP,(0,l.v_)(i.confirmMessage),1)])]),(0,a.Lk)("button",{onClick:t[30]||(t[30]=(...e)=>r.closeConfirmDialog&&r.closeConfirmDialog(...e)),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[(0,a.bF)(n,{icon:["fas","times"],class:"text-xl"})])])]),(0,a.Lk)("div",iP,[(0,a.Lk)("div",rP,[(0,a.Lk)("button",{onClick:t[31]||(t[31]=(...e)=>r.executeConfirmAction&&r.executeConfirmAction(...e)),type:"button",class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"}," ยืนยัน "),(0,a.Lk)("button",{onClick:t[32]||(t[32]=(...e)=>r.closeConfirmDialog&&r.closeConfirmDialog(...e)),type:"button",class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors"}," ยกเลิก ")])])])])])):(0,a.Q3)("",!0)])),_:1})],64)}const lP=new mr.A(!1);var cP={props:{courseData:Object,callParentFunctionProp:Function,tabs:Object,updateTabs:Object},components:{},data(){return{configs:n.A.get("configs"),session:n.A.get("session"),learningPathItems:[],showCourseSelector:!1,availableCourses:[],searchQuery:"",loading:!1,showConfirmDialog:!1,confirmAction:null,confirmMessage:"",confirmTitle:"",selectedItems:[],showBulkActions:!1,isReordering:!1,draggedIndex:null,showlearningPathStats:!1,shortcutsEnabled:!0,showShortcutsHelp:!1,selectedCourses:[],showPipelineSettings:!1,pipelineSettings:{learningOrder:"sequential",certificate:"issue",timeLimit:"unlimited",timeLimitDays:30}}},computed:{filteredCourses(){if(!this.searchQuery)return this.availableCourses;const e=this.searchQuery.toLowerCase();return this.availableCourses.filter((t=>t.name.toLowerCase().includes(e)||t.categoryData&&t.categoryData.some((t=>t.name.toLowerCase().includes(e)))))},learningPathStats(){if(!this.learningPathItems.length)return null;const e=this.learningPathItems.filter((e=>e.status)),t=e.reduce(((e,t)=>e+(parseInt(t.hours)||0)),0),s=e.reduce(((e,t)=>e+(t.enrollUserCount||0)),0),a=e.length,o=[...new Set(e.flatMap((e=>e.categoryData?e.categoryData.map((e=>e.name)):[])))];return{totalCourses:a,totalHours:t,totalEnrollments:s,activeCount:a,inactiveCount:this.learningPathItems.length-a,uniqueCategories:o.length,categories:o,averageEnrollment:a>0?Math.round(s/a):0,completionRate:this.learningPathItems.length>0?a/this.learningPathItems.length*100:0}},hasSelectedItems(){return this.selectedItems.length>0},selectedItemsCount(){return this.selectedItems.length},canMoveSelectedUp(){if(!this.hasSelectedItems)return!1;const e=Math.min(...this.selectedItems);return e>0},canMoveSelectedDown(){if(!this.hasSelectedItems)return!1;const e=Math.max(...this.selectedItems);return e<this.learningPathItems.length-1},hasDuplicateCourses(){const e=this.learningPathItems.map((e=>e._id));return e.length!==new Set(e).size},hasInactiveCourses(){return this.learningPathItems.some((e=>!e.status))},hasSelectedCourses(){return this.selectedCourses.length>0},selectedCoursesCount(){return this.selectedCourses.length},selectableCoursesCount(){return this.filteredCourses.filter((e=>!this.isInLearningPath(e._id))).length},allSelectableCoursesSelected(){const e=this.filteredCourses.filter((e=>!this.isInLearningPath(e._id)));return e.length>0&&e.every((e=>this.selectedCourses.includes(e._id)))}},methods:{async loadLearningPath(){try{console.log("loadLearningPath called - courseData exists:",!!this.courseData),this.courseData&&this.courseData.pipeline?(console.log("Found pipeline data, length:",this.courseData.pipeline.length),this.learningPathItems=[...this.courseData.pipeline]):(console.log("No pipeline data found"),this.learningPathItems=[]),this.updateBadge(this.learningPathItems.length),await this.$nextTick(),this.$forceUpdate()}catch(e){console.error("Error loading pipeline:",e)}},async saveLearningPathOrder(){try{this.isReordering=!0;const e={data:{pipeline:this.learningPathItems}};console.log("Saving pipeline:",this.learningPathItems);const t=await lP.PUT(`course/${this.courseData._id}`,e,this.configs.key);if(200!==t.status)throw new Error(`HTTP ${t.status}: ${t.statusText}`);this.callParentFunction(),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:2e3,icon:"success",title:"สำเร็จ",text:"บันทึกลำดับเส้นทางการเรียนรู้เรียบร้อยแล้ว"})}catch(e){console.error("Error saving pipeline order:",e);let t="ไม่สามารถบันทึกลำดับเส้นทางการเรียนรู้ได้";e.message.includes("403")?t="ไม่มีสิทธิ์ในการแก้ไขเส้นทางการเรียนรู้":e.message.includes("404")?t="ไม่พบหลักสูตรที่ต้องการแก้ไข":e.message.includes("timeout")&&(t="การเชื่อมต่อหมดเวลา กรุณาลองใหม่อีกครั้ง"),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:4e3,icon:"error",title:"ข้อผิดพลาด",text:t}),await this.loadLearningPath()}finally{this.isReordering=!1}},async loadAvailableCourses(){try{this.loading=!0;let e=[{unit:this.session.current._id},{_id:{$ne:this.courseData._id}},{status:!0}];this.searchQuery&&e.push({name:{$regex:`.*${this.searchQuery}.*`,$options:"i"}});const t=[{$match:{$and:e}},{$lookup:{from:"category",localField:"category",foreignField:"code",as:"categoryData"}},{$lookup:{from:"enroll",let:{courseId:{$toString:"$_id"}},pipeline:[{$match:{$expr:{$eq:["$courseID","$$courseId"]}}},{$count:"userCount"}],as:"enrollInfo"}},{$addFields:{enrollUserCount:{$ifNull:[{$arrayElemAt:["$enrollInfo.userCount",0]},0]}}},{$sort:{name:1}},{$limit:50}],{data:s}=await lP.POST("course/aggregate",{pipeline:t},this.configs.key);this.availableCourses=s||[]}catch(e){console.error("Error loading available courses:",e)}finally{this.loading=!1}},openCourseSelector(){this.showCourseSelector=!0,this.loadAvailableCourses()},closeCourseSelector(){this.showCourseSelector=!1,this.searchQuery="",this.availableCourses=[],this.selectedCourses=[]},addToLearningPath(e){this.learningPathItems.push({...e,status:!0,pipelineOrder:this.learningPathItems.length}),this.saveLearningPathOrder(),this.closeCourseSelector(),this.updateBadge(this.learningPathItems.length),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"สำเร็จ",text:`เพิ่ม "${e.name}" เข้าเส้นทางการเรียนรู้แล้ว`})},removeLearningPathItem(e){this.confirmTitle="ยืนยันการลบ",this.confirmMessage=`คุณต้องการลบ "${this.learningPathItems[e].name}" ออกจากเส้นทางการเรียนรู้หรือไม่?`,this.confirmAction=()=>this.doremoveLearningPathItem(e),this.showConfirmDialog=!0},doremoveLearningPathItem(e){const t=this.learningPathItems.splice(e,1)[0];this.saveLearningPathOrder(),this.updateBadge(this.learningPathItems.length),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"สำเร็จ",text:`ลบ "${t.name}" ออกจากเส้นทางการเรียนรู้แล้ว`})},viewCourseDetail(e){const t=this.$router.resolve(`/lesson/detail/${e._id}`);window.open(t.href,"_blank")},handleImageError(e){const t=e.target,s=t.parentElement;if(t.style.display="none",!s.querySelector(".course-thumbnail-fallback")){const e=document.createElement("div");e.className="course-thumbnail-fallback w-full h-full bg-gray-100 rounded-lg flex items-center justify-center",e.innerHTML='<i class="fas fa-book text-gray-400"></i>',s.appendChild(e)}},updateBadge(e){this.$emit("update-badge",{code:this.tabs.code,badge:e})},callParentFunction(){"function"===typeof this.callParentFunctionProp&&this.callParentFunctionProp()},moveUp(e){if(e>0){const t=this.learningPathItems.splice(e,1)[0];this.learningPathItems.splice(e-1,0,t),this.saveLearningPathOrder()}},moveDown(e){if(e<this.learningPathItems.length-1){const t=this.learningPathItems.splice(e,1)[0];this.learningPathItems.splice(e+1,0,t),this.saveLearningPathOrder()}},executeConfirmAction(){this.confirmAction&&"function"===typeof this.confirmAction&&this.confirmAction(),this.closeConfirmDialog()},closeConfirmDialog(){this.showConfirmDialog=!1,this.confirmAction=null,this.confirmMessage="",this.confirmTitle=""},toggleItemSelection(e){const t=this.selectedItems.indexOf(e);t>-1?this.selectedItems.splice(t,1):this.selectedItems.push(e)},selectAllItems(){this.selectedItems=this.learningPathItems.map(((e,t)=>t))},clearSelection(){this.selectedItems=[]},bulkRemove(){if(!this.hasSelectedItems)return;const e=this.selectedItems.map((e=>this.learningPathItems[e])).filter(Boolean);this.confirmTitle="ยืนยันการลบหลายรายการ",this.confirmMessage=`คุณต้องการลบ ${e.length} รายการที่เลือกออกจากเส้นทางการเรียนรู้หรือไม่?`,this.confirmAction=this.doBulkRemove,this.showConfirmDialog=!0},doBulkRemove(){const e=[...this.selectedItems].sort(((e,t)=>t-e));e.forEach((e=>{this.learningPathItems.splice(e,1)})),this.learningPathItems.forEach(((e,t)=>{e.pipelineOrder=t})),this.clearSelection(),this.saveLearningPathOrder(),this.updateBadge(this.learningPathItems.length),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"สำเร็จ",text:`ลบ ${e.length} รายการออกจากเส้นทางการเรียนรู้แล้ว`})},bulkMoveUp(){if(!this.canMoveSelectedUp)return;const e=[...this.selectedItems].sort(((e,t)=>e-t));e.forEach((e=>{if(e>0){const t=this.learningPathItems.splice(e,1)[0];this.learningPathItems.splice(e-1,0,t)}})),this.selectedItems=this.selectedItems.map((e=>Math.max(0,e-1))),this.saveLearningPathOrder()},bulkMoveDown(){if(!this.canMoveSelectedDown)return;const e=[...this.selectedItems].sort(((e,t)=>t-e));e.forEach((e=>{if(e<this.learningPathItems.length-1){const t=this.learningPathItems.splice(e,1)[0];this.learningPathItems.splice(e+1,0,t)}})),this.selectedItems=this.selectedItems.map((e=>Math.min(this.learningPathItems.length-1,e+1))),this.saveLearningPathOrder()},handleKeydown(e){if(this.shortcutsEnabled){if(e.ctrlKey||e.metaKey)switch(e.key){case"a":e.preventDefault(),this.selectAllItems();break;case"Delete":case"Backspace":e.preventDefault(),this.hasSelectedItems&&this.bulkRemove();break;case"ArrowUp":e.preventDefault(),this.bulkMoveUp();break;case"ArrowDown":e.preventDefault(),this.bulkMoveDown();break}"Escape"===e.key&&(this.clearSelection(),this.showCourseSelector&&this.closeCourseSelector(),this.showConfirmDialog&&this.closeConfirmDialog())}},exportLearningPath(){const e={pipeline:this.learningPathItems.map((e=>({id:e._id,name:e.name,order:e.pipelineOrder}))),metadata:{exportedAt:(new Date).toISOString(),courseId:this.courseData._id,courseName:this.courseData.name,totalItems:this.learningPathItems.length}},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`learning-path-${this.courseData.slug||"export"}-${Date.now()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"สำเร็จ",text:"Export เส้นทางการเรียนรู้เรียบร้อยแล้ว"})},validateLearningPath(){const e=[];return this.hasDuplicateCourses&&e.push("มีหลักสูตรซ้ำในเส้นทางการเรียนรู้"),this.hasInactiveCourses&&e.push("มีหลักสูตรที่ไม่ได้เปิดใช้งาน"),0===this.learningPathItems.length&&e.push("เส้นทางการเรียนรู้ว่างเปล่า"),{isValid:0===e.length,issues:e}},async toggleLearningPathItemStatus(e){if(e<0||e>=this.learningPathItems.length)return;const t=this.learningPathItems[e],s=t.status,a=!s;try{this.learningPathItems[e].status=a,await this.saveLearningPathOrder(),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:2500,icon:"success",title:a?"เปิดใช้งานแล้ว":"ปิดใช้งานแล้ว",text:`"${t.name}" ${a?"เปิดใช้งาน":"ปิดใช้งาน"}ในเส้นทางการเรียนรู้แล้ว`})}catch(o){this.learningPathItems[e].status=s,console.error("Error toggling pipeline item status:",o),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"error",title:"ข้อผิดพลาด",text:"ไม่สามารถเปลี่ยนสถานะได้ กรุณาลองใหม่อีกครั้ง"})}},isInLearningPath(e){return this.learningPathItems.some((t=>t._id===e))},toggleSelectAll(){this.allSelectableCoursesSelected?this.selectedCourses=[]:this.selectedCourses=this.filteredCourses.filter((e=>!this.isInLearningPath(e._id))).map((e=>e._id))},clearCourseSelection(){this.selectedCourses=[]},addSelectedCoursesToPipeline(){const e=this.filteredCourses.filter((e=>this.selectedCourses.includes(e._id)&&!this.isInLearningPath(e._id)));0!==e.length&&(e.forEach((e=>{this.learningPathItems.push({...e,status:!0,pipelineOrder:this.learningPathItems.length})})),this.saveLearningPathOrder(),this.updateBadge(this.learningPathItems.length),this.closeCourseSelector(),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"สำเร็จ",text:`เพิ่ม ${e.length} หลักสูตรเข้าเส้นทางการเรียนรู้แล้ว`}))},toggleCourseSelection(e){if(this.isInLearningPath(e))return;const t=this.selectedCourses.indexOf(e);t>-1?this.selectedCourses.splice(t,1):this.selectedCourses.push(e)},loadLearningPathSettings(){this.courseData&&this.courseData.pipelineSettings&&(this.pipelineSettings={...this.pipelineSettings,...this.courseData.pipelineSettings})},async saveLearningPathSettings(){try{this.isReordering=!0;const e={data:{pipelineSettings:this.pipelineSettings}};console.log("Saving pipeline settings:",this.pipelineSettings);const t=await lP.PUT(`course/${this.courseData._id}`,e,this.configs.key);if(200!==t.status)throw new Error(`HTTP ${t.status}: ${t.statusText}`);this.callParentFunction(),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:2e3,icon:"success",title:"สำเร็จ",text:"บันทึกการตั้งค่าเส้นทางการเรียนรู้เรียบร้อยแล้ว"})}catch(e){console.error("Error saving pipeline settings:",e);let t="ไม่สามารถบันทึกการตั้งค่าได้";e.message.includes("403")?t="ไม่มีสิทธิ์ในการแก้ไขการตั้งค่า":e.message.includes("404")&&(t="ไม่พบหลักสูตรที่ต้องการแก้ไข"),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:4e3,icon:"error",title:"ข้อผิดพลาด",text:t})}finally{this.isReordering=!1}}},async mounted(){try{await this.loadLearningPath(),this.loadLearningPathSettings(),this.updateBadge(this.learningPathItems.length),this.shortcutsEnabled&&document.addEventListener("keydown",this.handleKeydown);const e=this.validateLearningPath();!e.isValid&&this.learningPathItems.length>0&&console.warn("Learning Path validation issues:",e.issues)}catch(e){console.error("Error mounting PipelineList:",e)}},beforeUnmount(){this.shortcutsEnabled&&document.removeEventListener("keydown",this.handleKeydown)},watch:{courseData:{handler(e){e&&(console.log("courseData updated, reloading pipeline"),this.loadLearningPath(),this.loadLearningPathSettings())},deep:!0,immediate:!0},"courseData.pipeline":{handler(e,t){e!==t&&(console.log("courseData.pipeline changed, reloading"),this.loadLearningPath())},deep:!0}}};const dP=(0,rr.A)(cP,[["render",nP],["__scopeId","data-v-698bf346"]]);var uP=dP;const mP={class:"bg-white rounded-lg shadow-sm border border-gray-200"},gP={class:"px-4 py-3 border-b border-gray-200"},pP={class:"flex items-center justify-between"},hP={class:"flex items-center space-x-3"},bP={class:"w-8 h-8 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center"},xP={class:"text-xs text-gray-500"},yP={class:"flex items-center space-x-4 mr-4"},fP={class:"text-center"},kP={class:"text-lg font-bold text-green-600"},vP={class:"text-center"},wP={class:"text-lg font-bold text-yellow-600"},LP={class:"text-center"},CP={class:"text-lg font-bold text-blue-600"},DP={class:"px-4 py-4 border-b border-gray-200 bg-gray-50"},SP={class:"flex items-center justify-between mb-3"},FP={class:"flex items-center space-x-3"},IP={class:"w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-md flex items-center justify-center"},EP={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-6 pt-4"},$P={class:"bg-white rounded-lg p-4 border border-gray-200 shadow-sm"},_P={class:"flex items-center space-x-2 mb-3"},PP={class:"space-y-2"},TP={class:"flex items-center space-x-2 cursor-pointer"},AP={class:"flex items-center space-x-2 cursor-pointer"},XP={class:"flex items-center space-x-2 cursor-pointer"},jP={class:"bg-white rounded-lg p-4 border border-gray-200 shadow-sm"},UP={class:"flex items-center space-x-2 mb-3"},BP={class:"space-y-2"},OP={class:"flex items-center space-x-2 cursor-pointer"},QP={class:"flex items-center space-x-2 cursor-pointer"},MP={class:"flex items-center space-x-2 cursor-pointer"},VP={key:0,class:"mt-3"},RP={class:"bg-white rounded-lg p-4 border border-gray-200 shadow-sm"},WP={class:"flex items-center space-x-2 mb-3"},NP={class:"space-y-2"},qP={class:"flex items-center space-x-2 cursor-pointer"},KP={key:0,class:"mt-3"},HP={class:"flex items-center space-x-2"},zP={key:1,class:"mt-4 flex justify-end"},GP={key:2,class:"mt-3 grid grid-cols-1 md:grid-cols-4 gap-4 text-sm"},JP={class:"bg-white rounded-lg p-3 border border-gray-200"},YP={class:"flex items-center space-x-2"},ZP={class:"font-medium text-gray-900"},eT={class:"bg-white rounded-lg p-3 border border-gray-200"},tT={class:"flex items-center space-x-2"},sT={class:"font-medium text-gray-900"},aT={class:"bg-white rounded-lg p-3 border border-gray-200"},oT={class:"flex items-center space-x-2"},iT={class:"font-medium text-gray-900"},rT={class:"bg-white rounded-lg p-3 border border-gray-200"},nT={class:"flex items-center space-x-2"},lT={class:"font-medium text-gray-900"},cT={class:"p-4"},dT={key:0,class:"text-center py-8"},uT={class:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3"},mT={key:1,class:"space-y-3"},gT=["onClick"],pT={class:"flex items-center justify-between"},hT={class:"flex items-center space-x-3 flex-1"},bT={class:"p-1 hover:bg-gray-100 rounded transition-colors"},xT={class:"flex-1 min-w-0"},yT={class:"text-base font-semibold text-gray-900"},fT={class:"flex items-center space-x-4 text-xs text-gray-500 mt-1"},kT={class:"flex items-center"},vT={class:"font-medium ml-1"},wT={class:"flex items-center"},LT={class:"flex items-center"},CT={class:"font-medium ml-1"},DT={class:"flex items-center space-x-2 ml-4"},ST=["onClick"],FT=["onClick"],IT=["onClick"],ET={key:0,class:"border-t border-gray-200 rounded-b-lg overflow-hidden"},$T={class:"p-4 bg-gray-50"},_T={class:"flex flex-col lg:flex-row gap-4 text-sm"},PT={class:"flex-1"},TT={class:"text-gray-600 mb-3"},AT={class:"mb-3"},XT={class:"flex items-center mt-1"},jT={class:"text-sm font-medium"},UT={class:"mt-2"},BT={class:"flex flex-wrap gap-1 mt-1"},OT={class:"w-full lg:w-80 flex-shrink-0"},QT={class:"grid grid-cols-2 gap-2"},MT={class:"bg-white p-2 rounded border border-gray-200"},VT={class:"flex items-center justify-between"},RT={class:"flex items-center"},WT={class:"text-sm font-bold text-green-600"},NT={class:"bg-white p-2 rounded border border-gray-200"},qT={class:"flex items-center justify-between"},KT={class:"flex items-center"},HT={class:"text-sm font-bold text-orange-600"},zT={class:"bg-white p-2 rounded border border-gray-200"},GT={class:"flex items-center justify-between"},JT={class:"flex items-center"},YT={class:"text-sm font-bold text-blue-600"},ZT={class:"bg-white p-2 rounded border border-gray-200"},eA={class:"mb-1"},tA={class:"flex items-center justify-between"},sA={class:"text-sm font-bold text-gray-900"},aA={class:"w-full bg-gray-200 rounded-full h-1.5"},oA={class:"p-4"},iA={class:"flex items-center justify-between mb-3"},rA={class:"font-semibold text-gray-700 flex items-center"},nA={class:"flex items-center space-x-4 text-xs"},lA={class:"flex items-center space-x-1"},cA={class:"text-gray-600"},dA={class:"flex items-center space-x-1"},uA={class:"text-gray-600"},mA={class:"flex items-center space-x-1"},gA={class:"text-gray-600"},pA={key:0,class:"text-center py-6 text-gray-500"},hA={key:1,class:"space-y-2"},bA={class:"flex items-center justify-between"},xA={class:"flex items-center space-x-3"},yA={class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"},fA={class:"text-sm font-medium text-gray-900"},kA={class:"flex items-center space-x-3 text-xs text-gray-500"},vA={key:0},wA={key:1},LA={key:2,class:"px-1.5 py-0.5 bg-red-100 text-red-700 rounded text-xs"},CA={key:3,class:"px-1.5 py-0.5 bg-yellow-100 text-yellow-700 rounded text-xs"},DA={key:4,class:"px-1.5 py-0.5 bg-green-100 text-green-700 rounded text-xs"},SA={class:"flex items-center space-x-2"},FA={key:0,class:"px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium"},IA={key:1,class:"px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs"},EA=["onClick"],$A=["onClick"],_A={key:0,class:"fixed inset-0 z-40 overflow-y-auto assignment-modal"},PA={class:"flex min-h-full items-center justify-center p-4"},TA={class:"relative transform overflow-hidden rounded-lg bg-white shadow-xl transition-all w-full max-w-2xl"},AA={class:"bg-white px-6 py-4 border-b border-gray-200"},XA={class:"flex items-center justify-between"},jA={class:"text-lg font-semibold text-gray-900"},UA={class:"px-6 py-4 max-h-[70vh] overflow-y-auto"},BA={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},OA={class:"flex items-center space-x-3"},QA={class:"flex items-center space-x-3"},MA={key:0},VA={key:1,class:"space-y-3"},RA={key:0,class:"p-3 border border-gray-200 rounded-lg bg-gray-50"},WA={class:"flex items-center justify-between"},NA={class:"flex items-center space-x-3"},qA={class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},KA={class:"font-medium text-gray-900 text-sm"},HA={class:"flex flex-col items-center space-y-2"},zA={class:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center"},GA={class:"font-medium text-gray-900 text-sm"},JA={class:"space-y-2"},YA={class:"flex items-center"},ZA={class:"flex items-center"},eX={key:0},tX={key:1},sX={class:"border-t pt-4"},aX={class:"mb-3"},oX={class:"grid grid-cols-4 gap-2"},iX=["value"],rX={class:"text-sm"},nX={class:"grid grid-cols-2 gap-4"},lX={class:"bg-gray-50 px-6 py-3 flex justify-end space-x-3"};function cX(e,t,s,o,i,r){const n=(0,a.g2)("FileBrowser"),d=(0,a.g2)("font-awesome-icon"),u=(0,a.g2)("editor");return(0,a.uX)(),(0,a.CE)(a.FK,null,[i.fileBrowserOpen?((0,a.uX)(),(0,a.Wv)(n,{key:0,isWindowsOpen:!0,callbackFunction:"assignment-file",allowFileType:["pdf","doc","docx","xls","xlsx","ppt","pptx","txt"],onFileBrowserTrigger:r.changeFileBrowserTrigger,onFileBrowserCallback:r.selectFileBrowserTrigger,style:{"z-index":"9999 !important"}},null,8,["onFileBrowserTrigger","onFileBrowserCallback"])):(0,a.Q3)("",!0),(0,a.Lk)("div",mP,[(0,a.Lk)("div",gP,[(0,a.Lk)("div",pP,[(0,a.Lk)("div",hP,[(0,a.Lk)("div",bP,[(0,a.bF)(d,{icon:["fas","tasks"],class:"text-white text-sm"})]),(0,a.Lk)("div",null,[t[33]||(t[33]=(0,a.Lk)("h2",{class:"text-base font-semibold text-gray-900"},"ระบบส่งงาน",-1)),(0,a.Lk)("p",xP,"จัดการกิจกรรมและการส่งงานของหลักสูตร ("+(0,l.v_)(i.assignments&&i.assignments.length?i.assignments.length:0)+" กิจกรรม)",1)])]),(0,a.Lk)("div",yP,[(0,a.Lk)("div",fP,[(0,a.Lk)("div",kP,(0,l.v_)(r.getTotalSubmissions()),1),t[34]||(t[34]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"งานที่ส่งมา",-1))]),(0,a.Lk)("div",vP,[(0,a.Lk)("div",wP,(0,l.v_)(r.getTotalScoredSubmissions()),1),t[35]||(t[35]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"ให้คะแนนแล้ว",-1))]),(0,a.Lk)("div",LP,[(0,a.Lk)("div",CP,(0,l.v_)(r.getAverageCompletionRate())+"%",1),t[36]||(t[36]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"อัตราการส่งเฉลี่ย",-1))])]),(0,a.Lk)("button",{onClick:t[0]||(t[0]=e=>i.showAddAssignmentModal=!0),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-orange-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(d,{icon:["fas","plus"],class:"mr-1.5"}),t[37]||(t[37]=(0,a.eW)(" เพิ่มกิจกรรม "))])])]),(0,a.Lk)("div",DP,[(0,a.Lk)("div",SP,[(0,a.Lk)("div",FP,[(0,a.Lk)("div",IP,[(0,a.bF)(d,{icon:["fas","cog"],class:"text-white text-xs"})]),t[38]||(t[38]=(0,a.Lk)("h3",{class:"text-lg font-bold text-gray-900"},"การตั้งค่าระบบส่งงาน",-1))]),(0,a.Lk)("button",{onClick:t[1]||(t[1]=e=>i.showSettings=!i.showSettings),type:"button",class:(0,l.C4)(["inline-flex items-center px-2 py-1 text-xs font-medium rounded-md border transition-colors",i.showSettings?"bg-blue-100 text-blue-700 border-blue-300":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"])},[(0,a.bF)(d,{icon:["fas",i.showSettings?"chevron-up":"chevron-down"],class:"mr-1"},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)(i.showSettings?"ซ่อน":"แสดง"),1)],2)]),i.showSettings?((0,a.uX)(),(0,a.CE)("div",EP,[(0,a.Lk)("div",$P,[(0,a.Lk)("div",_P,[(0,a.bF)(d,{icon:["fas","upload"],class:"text-orange-500"}),t[39]||(t[39]=(0,a.Lk)("h4",{class:"text-base font-bold text-gray-900"},"ประเภทการส่งงาน",-1))]),(0,a.Lk)("div",PP,[(0,a.Lk)("label",TP,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.globalSettings.submissionType=e),type:"radio",value:"file",class:"w-4 h-4 text-orange-600 border-gray-300 focus:ring-orange-500"},null,512),[[c.XL,i.globalSettings.submissionType]]),t[40]||(t[40]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"อัพโหลดไฟล์",-1))]),(0,a.Lk)("label",AP,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.globalSettings.submissionType=e),type:"radio",value:"text",class:"w-4 h-4 text-orange-600 border-gray-300 focus:ring-orange-500"},null,512),[[c.XL,i.globalSettings.submissionType]]),t[41]||(t[41]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"ข้อความ",-1))]),(0,a.Lk)("label",XP,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>i.globalSettings.submissionType=e),type:"radio",value:"both",class:"w-4 h-4 text-orange-600 border-gray-300 focus:ring-orange-500"},null,512),[[c.XL,i.globalSettings.submissionType]]),t[42]||(t[42]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"ทั้งสองอย่าง",-1))])])]),(0,a.Lk)("div",jP,[(0,a.Lk)("div",UP,[(0,a.bF)(d,{icon:["fas","bell"],class:"text-yellow-500"}),t[43]||(t[43]=(0,a.Lk)("h4",{class:"text-base font-bold text-gray-900"},"การแจ้งเตือน",-1))]),(0,a.Lk)("div",BP,[(0,a.Lk)("label",OP,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.globalSettings.notifications.email=e),type:"checkbox",class:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"},null,512),[[c.lH,i.globalSettings.notifications.email]]),t[44]||(t[44]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"อีเมล",-1))]),(0,a.Lk)("label",QP,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.globalSettings.notifications.system=e),type:"checkbox",class:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"},null,512),[[c.lH,i.globalSettings.notifications.system]]),t[45]||(t[45]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"แจ้งเตือนในระบบ",-1))]),(0,a.Lk)("label",MP,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.globalSettings.notifications.reminder=e),type:"checkbox",class:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"},null,512),[[c.lH,i.globalSettings.notifications.reminder]]),t[46]||(t[46]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"เตือนก่อนครบกำหนด",-1))])]),i.globalSettings.notifications.reminder?((0,a.uX)(),(0,a.CE)("div",VP,[t[47]||(t[47]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"}," เตือนก่อนกี่วัน ",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>i.globalSettings.notifications.reminderDays=e),type:"number",min:"1",max:"30",class:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},null,512),[[c.Jo,i.globalSettings.notifications.reminderDays,void 0,{number:!0}]])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",RP,[(0,a.Lk)("div",WP,[(0,a.bF)(d,{icon:["fas","star"],class:"text-green-500"}),t[48]||(t[48]=(0,a.Lk)("h4",{class:"text-base font-bold text-gray-900"},"การให้คะแนน",-1))]),(0,a.Lk)("div",NP,[(0,a.Lk)("label",qP,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>i.globalSettings.scoring.enabled=e),type:"checkbox",class:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"},null,512),[[c.lH,i.globalSettings.scoring.enabled]]),t[49]||(t[49]=(0,a.Lk)("span",{class:"text-sm text-gray-700"},"เปิดใช้งานการให้คะแนน",-1))]),i.globalSettings.scoring.enabled?((0,a.uX)(),(0,a.CE)("div",KP,[t[51]||(t[51]=(0,a.Lk)("label",{class:"block text-xs font-medium text-gray-700 mb-1"}," ช่วงคะแนน ",-1)),(0,a.Lk)("div",HP,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>i.globalSettings.scoring.minScore=e),type:"number",min:"0",placeholder:"0",class:"w-16 px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},null,512),[[c.Jo,i.globalSettings.scoring.minScore,void 0,{number:!0}]]),t[50]||(t[50]=(0,a.Lk)("span",{class:"text-gray-500"},"ถึง",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>i.globalSettings.scoring.maxScore=e),type:"number",min:"1",placeholder:"100",class:"w-16 px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},null,512),[[c.Jo,i.globalSettings.scoring.maxScore,void 0,{number:!0}]])])])):(0,a.Q3)("",!0)])])])):(0,a.Q3)("",!0),i.showSettings?((0,a.uX)(),(0,a.CE)("div",zP,[(0,a.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>r.saveGlobalSettings&&r.saveGlobalSettings(...e)),type:"button",class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(d,{icon:["fas","save"],class:"mr-2"}),t[52]||(t[52]=(0,a.eW)(" บันทึกการตั้งค่า "))])])):(0,a.Q3)("",!0),i.showSettings?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",GP,[(0,a.Lk)("div",JP,[(0,a.Lk)("div",YP,[(0,a.bF)(d,{icon:["fas","upload"],class:"text-orange-500"}),(0,a.Lk)("div",null,[t[53]||(t[53]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"ประเภทการส่งงาน",-1)),(0,a.Lk)("div",ZP,(0,l.v_)("file"===i.globalSettings.submissionType?"อัพโหลดไฟล์":"text"===i.globalSettings.submissionType?"ข้อความ":"ทั้งสองอย่าง"),1)])])]),(0,a.Lk)("div",eT,[(0,a.Lk)("div",tT,[(0,a.bF)(d,{icon:["fas","bell"],class:"text-yellow-500"}),(0,a.Lk)("div",null,[t[54]||(t[54]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"การแจ้งเตือน",-1)),(0,a.Lk)("div",sT,(0,l.v_)(r.getNotificationStatus()),1)])])]),(0,a.Lk)("div",aT,[(0,a.Lk)("div",oT,[(0,a.bF)(d,{icon:["fas","star"],class:"text-green-500"}),(0,a.Lk)("div",null,[t[55]||(t[55]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"การให้คะแนน",-1)),(0,a.Lk)("div",iT,(0,l.v_)(i.globalSettings.scoring.enabled?`${i.globalSettings.scoring.minScore}-${i.globalSettings.scoring.maxScore} คะแนน`:"ปิดใช้งาน"),1)])])]),(0,a.Lk)("div",rT,[(0,a.Lk)("div",nT,[(0,a.bF)(d,{icon:["fas","chart-bar"],class:"text-blue-500"}),(0,a.Lk)("div",null,[t[56]||(t[56]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"สถิติการใช้งาน",-1)),(0,a.Lk)("div",lT,(0,l.v_)(i.assignments.length)+" กิจกรรม ",1)])])])]))]),(0,a.Lk)("div",cT,[i.assignments&&0!==i.assignments.length?i.assignments&&i.assignments.length>0?((0,a.uX)(),(0,a.CE)("div",mT,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.assignments,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:e._id||e.id||s,class:(0,l.C4)(["bg-white border rounded-lg transition-all duration-200 assignment-item",{"border-orange-400 shadow-lg shadow-orange-100":i.expandedAssignments.includes(e._id||e.id),"border-gray-200 hover:shadow-md hover:border-gray-300":!i.expandedAssignments.includes(e._id||e.id)}])},[(0,a.Lk)("div",{onClick:t=>r.toggleAssignmentExpand(e._id||e.id),class:(0,l.C4)(["p-4 cursor-pointer hover:bg-gray-50 transition-colors rounded-t-lg",{"rounded-b-lg":!i.expandedAssignments.includes(e._id||e.id)}])},[(0,a.Lk)("div",pT,[(0,a.Lk)("div",hT,[(0,a.Lk)("button",bT,[(0,a.bF)(d,{icon:["fas",i.expandedAssignments.includes(e._id||e.id)?"chevron-down":"chevron-right"],class:"text-gray-400 transition-transform duration-200"},null,8,["icon"])]),(0,a.Lk)("div",{class:(0,l.C4)(["w-10 h-10 rounded-lg flex items-center justify-center","active"===e.status?"bg-green-100":"bg-gray-100"])},[(0,a.bF)(d,{icon:["fas","clipboard-check"],class:(0,l.C4)("active"===e.status?"text-green-600":"text-gray-500")},null,8,["class"])],2),(0,a.Lk)("div",xT,[(0,a.Lk)("h4",yT,(0,l.v_)(s+1)+". "+(0,l.v_)(e.title),1),(0,a.Lk)("div",fT,[(0,a.Lk)("span",kT,[(0,a.bF)(d,{icon:["fas","calendar"],class:"mr-1"}),t[60]||(t[60]=(0,a.eW)(" กำหนดส่ง: ")),(0,a.Lk)("span",vT,(0,l.v_)("fixed"===e.dueType?r.formatDate(e.dueDate):`${e.dueDays} วันหลังเรียนจบ`),1)]),(0,a.Lk)("span",wT,[(0,a.bF)(d,{icon:["fas","file"],class:"mr-1"}),(0,a.eW)(" ไฟล์: "+(0,l.v_)(e.fileSettings.maxFiles)+" ไฟล์ (สูงสุด "+(0,l.v_)(e.fileSettings.maxSizeMB)+"MB) ",1)]),(0,a.Lk)("span",LT,[(0,a.bF)(d,{icon:["fas","users"],class:"mr-1"}),t[61]||(t[61]=(0,a.eW)(" ส่งแล้ว: ")),(0,a.Lk)("span",CT,(0,l.v_)(r.getSubmissionCount(e._id||e.id))+" คน",1)])])])]),(0,a.Lk)("div",DT,[(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.toggleAssignmentStatus(e)),["stop"]),class:(0,l.C4)(["px-2 py-1 rounded-md text-xs font-medium transition-colors","active"===e.status?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},[(0,a.bF)(d,{icon:["fas","active"===e.status?"toggle-on":"toggle-off"],class:"mr-1"},null,8,["icon"]),(0,a.eW)(" "+(0,l.v_)("active"===e.status?"เปิดใช้งาน":"ปิดใช้งาน"),1)],10,ST),(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.editAssignment(e)),["stop"]),class:"p-1.5 text-gray-600 hover:bg-gray-100 rounded transition-colors",title:"แก้ไข"},[(0,a.bF)(d,{icon:["fas","edit"],class:"text-sm"})],8,FT),(0,a.Lk)("button",{onClick:(0,c.D$)((t=>r.deleteAssignment(e._id||e.id)),["stop"]),class:"p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors",title:"ลบ"},[(0,a.bF)(d,{icon:["fas","trash"],class:"text-sm"})],8,IT)])])],10,gT),i.expandedAssignments.includes(e._id||e.id)?((0,a.uX)(),(0,a.CE)("div",ET,[(0,a.Lk)("div",$T,[(0,a.Lk)("div",_T,[(0,a.Lk)("div",PT,[t[64]||(t[64]=(0,a.Lk)("h5",{class:"font-semibold text-gray-700 mb-2"},"รายละเอียดกิจกรรม",-1)),(0,a.Lk)("p",TT,(0,l.v_)(e.description||"ไม่มีคำอธิบาย"),1),(0,a.Lk)("div",AT,[t[62]||(t[62]=(0,a.Lk)("span",{class:"text-xs font-medium text-gray-500"},"ประเภทโจทย์:",-1)),(0,a.Lk)("div",XT,[(0,a.Lk)("div",{class:(0,l.C4)(["w-4 h-4 rounded-md flex items-center justify-center mr-2","file"===e.contentType?"bg-blue-100":"bg-green-100"])},[(0,a.bF)(d,{icon:["fas","file"===e.contentType?"file":"edit"],class:(0,l.C4)(["file"===e.contentType?"text-blue-600":"text-green-600","text-xs"])},null,8,["icon","class"])],2),(0,a.Lk)("span",jT,(0,l.v_)("file"===e.contentType?"ไฟล์เอกสาร":"text"===e.contentType?"ข้อความ (Text Editor)":"ไม่ระบุ"),1)])]),(0,a.Lk)("div",UT,[t[63]||(t[63]=(0,a.Lk)("span",{class:"text-xs font-medium text-gray-500"},"ประเภทไฟล์ที่อนุญาต:",-1)),(0,a.Lk)("div",BT,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.fileSettings.allowedTypes,(e=>((0,a.uX)(),(0,a.CE)("span",{key:e,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"}," ."+(0,l.v_)(e),1)))),128))])])]),(0,a.Lk)("div",OT,[t[69]||(t[69]=(0,a.Lk)("h5",{class:"font-semibold text-gray-700 mb-2"},"สถิติการส่งงาน",-1)),(0,a.Lk)("div",QT,[(0,a.Lk)("div",MT,[(0,a.Lk)("div",VT,[(0,a.Lk)("div",RT,[(0,a.bF)(d,{icon:["fas","check-circle"],class:"text-green-500 mr-1 text-xs"}),t[65]||(t[65]=(0,a.Lk)("span",{class:"text-xs text-gray-500"},"ส่งแล้ว",-1))]),(0,a.Lk)("span",WT,(0,l.v_)(r.getSubmittedCount(e._id||e.id)),1)])]),(0,a.Lk)("div",NT,[(0,a.Lk)("div",qT,[(0,a.Lk)("div",KT,[(0,a.bF)(d,{icon:["fas","clock"],class:"text-orange-500 mr-1 text-xs"}),t[66]||(t[66]=(0,a.Lk)("span",{class:"text-xs text-gray-500"},"รอส่ง",-1))]),(0,a.Lk)("span",HT,(0,l.v_)(r.getPendingCount(e._id||e.id)),1)])]),(0,a.Lk)("div",zT,[(0,a.Lk)("div",GT,[(0,a.Lk)("div",JT,[(0,a.bF)(d,{icon:["fas","users"],class:"text-blue-500 mr-1 text-xs"}),t[67]||(t[67]=(0,a.Lk)("span",{class:"text-xs text-gray-500"},"รวมทั้งหมด",-1))]),(0,a.Lk)("span",YT,(0,l.v_)(r.getTotalStudents()),1)])]),(0,a.Lk)("div",ZT,[(0,a.Lk)("div",eA,[(0,a.Lk)("div",tA,[t[68]||(t[68]=(0,a.Lk)("span",{class:"text-xs text-gray-500"},"อัตราส่งงาน",-1)),(0,a.Lk)("span",sA,(0,l.v_)(r.getCompletionRate(e._id||e.id))+"%",1)])]),(0,a.Lk)("div",aA,[(0,a.Lk)("div",{class:"bg-blue-600 h-1.5 rounded-full transition-all duration-300",style:(0,l.Tr)(`width: ${r.getCompletionRate(e._id||e.id)}%`)},null,4)])])])])])]),(0,a.Lk)("div",oA,[(0,a.Lk)("div",iA,[(0,a.Lk)("h5",rA,[(0,a.bF)(d,{icon:["fas","folder-open"],class:"mr-2 text-orange-500"}),(0,a.eW)(" งานที่ส่งมา ("+(0,l.v_)(r.getSubmissions(e._id||e.id).length)+" รายการ) ",1)]),(0,a.Lk)("div",nA,[(0,a.Lk)("div",lA,[t[70]||(t[70]=(0,a.Lk)("div",{class:"w-2 h-2 bg-green-500 rounded-full"},null,-1)),(0,a.Lk)("span",cA,"ส่งแล้ว: "+(0,l.v_)(r.getSubmittedCount(e._id||e.id)),1)]),(0,a.Lk)("div",dA,[t[71]||(t[71]=(0,a.Lk)("div",{class:"w-2 h-2 bg-yellow-500 rounded-full"},null,-1)),(0,a.Lk)("span",uA,"ให้คะแนนแล้ว: "+(0,l.v_)(r.getScoredCount(e._id||e.id)),1)]),(0,a.Lk)("div",mA,[t[72]||(t[72]=(0,a.Lk)("div",{class:"w-2 h-2 bg-red-500 rounded-full"},null,-1)),(0,a.Lk)("span",gA,"เลยกำหนด: "+(0,l.v_)(r.getOverdueCount(e._id||e.id)),1)])])]),0===r.getSubmissions(e._id||e.id).length?((0,a.uX)(),(0,a.CE)("div",pA,[(0,a.bF)(d,{icon:["fas","inbox"],class:"text-3xl mb-2"}),t[73]||(t[73]=(0,a.Lk)("p",null,"ยังไม่มีผู้ส่งงาน",-1)),t[74]||(t[74]=(0,a.Lk)("p",{class:"text-xs mt-1"},"กิจกรรมนี้ยังไม่มีผู้เรียนส่งงานเข้ามา",-1))])):((0,a.uX)(),(0,a.CE)("div",hA,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.getSubmissions(e._id||e.id),(s=>((0,a.uX)(),(0,a.CE)("div",{key:s._id,class:(0,l.C4)(["bg-white border border-gray-200 rounded-lg p-3 hover:shadow-sm transition-all duration-200",{"border-green-200 bg-green-50":null!==s.score,"border-red-200 bg-red-50":r.isOverdue(s,e),"border-yellow-200 bg-yellow-50":"late"===s.status}])},[(0,a.Lk)("div",bA,[(0,a.Lk)("div",xA,[(0,a.Lk)("div",yA,[(0,a.bF)(d,{icon:["fas","user"],class:"text-blue-600 text-sm"})]),(0,a.Lk)("div",null,[(0,a.Lk)("h6",fA,(0,l.v_)(s.userName),1),(0,a.Lk)("div",kA,[(0,a.Lk)("span",null,[(0,a.bF)(d,{icon:["fas","clock"],class:"mr-1"}),(0,a.eW)(" ส่งเมื่อ: "+(0,l.v_)(r.formatDateTime(s.submittedAt)),1)]),s.files&&s.files.length>0?((0,a.uX)(),(0,a.CE)("span",vA,[(0,a.bF)(d,{icon:["fas","paperclip"],class:"mr-1"}),(0,a.eW)(" "+(0,l.v_)(s.files.length)+" ไฟล์ ",1)])):(0,a.Q3)("",!0),s.textContent?((0,a.uX)(),(0,a.CE)("span",wA,[(0,a.bF)(d,{icon:["fas","align-left"],class:"mr-1"}),t[75]||(t[75]=(0,a.eW)(" มีข้อความ "))])):(0,a.Q3)("",!0),r.isOverdue(s,e)?((0,a.uX)(),(0,a.CE)("span",LA," เลยกำหนด ")):"late"===s.status?((0,a.uX)(),(0,a.CE)("span",CA," ส่งช้า ")):((0,a.uX)(),(0,a.CE)("span",DA," ตรงเวลา "))])])]),(0,a.Lk)("div",SA,[null!==s.score?((0,a.uX)(),(0,a.CE)("span",FA,[(0,a.bF)(d,{icon:["fas","star"],class:"mr-1"}),(0,a.eW)(" "+(0,l.v_)(s.score)+" คะแนน ",1)])):((0,a.uX)(),(0,a.CE)("span",IA," ยังไม่ให้คะแนน ")),(0,a.Lk)("button",{onClick:e=>r.viewSubmission(s),class:"px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700 transition-colors"},[(0,a.bF)(d,{icon:["fas","eye"],class:"mr-1"}),t[76]||(t[76]=(0,a.eW)(" ดูงาน "))],8,EA),i.globalSettings.scoring.enabled?((0,a.uX)(),(0,a.CE)("button",{key:2,onClick:e=>r.scoreSubmission(s),class:"px-3 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700 transition-colors"},[(0,a.bF)(d,{icon:["fas","star"],class:"mr-1"}),(0,a.eW)(" "+(0,l.v_)(null!==s.score?"แก้ไขคะแนน":"ให้คะแนน"),1)],8,$A)):(0,a.Q3)("",!0)])])],2)))),128))]))])])):(0,a.Q3)("",!0)],2)))),128))])):(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",dT,[(0,a.Lk)("div",uT,[(0,a.bF)(d,{icon:["fas","clipboard-list"],class:"text-gray-400 text-lg"})]),t[58]||(t[58]=(0,a.Lk)("h3",{class:"text-base font-medium text-gray-900 mb-2"},"ยังไม่มีกิจกรรม",-1)),t[59]||(t[59]=(0,a.Lk)("p",{class:"text-sm text-gray-500 mb-4"},"เริ่มต้นสร้างกิจกรรมสำหรับให้ผู้เรียนส่งงาน",-1)),(0,a.Lk)("button",{onClick:t[13]||(t[13]=e=>i.showAddAssignmentModal=!0),type:"button",class:"inline-flex items-center rounded-lg border border-transparent bg-orange-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors"},[(0,a.bF)(d,{icon:["fas","plus"],class:"mr-1.5"}),t[57]||(t[57]=(0,a.eW)(" สร้างกิจกรรมแรก "))])]))])]),(0,a.bF)(c.eB,{"enter-active-class":"modal-enter-active","leave-active-class":"modal-leave-active","enter-from-class":"modal-enter-from","leave-to-class":"modal-leave-to"},{default:(0,a.k6)((()=>[i.showAddAssignmentModal?((0,a.uX)(),(0,a.CE)("div",_A,[(0,a.Lk)("div",{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t[14]||(t[14]=(...e)=>r.closeAssignmentModal&&r.closeAssignmentModal(...e))}),(0,a.Lk)("div",PA,[(0,a.Lk)("div",TA,[(0,a.Lk)("div",AA,[(0,a.Lk)("div",XA,[(0,a.Lk)("h3",jA,(0,l.v_)(i.editingAssignment?"แก้ไขกิจกรรม":"เพิ่มกิจกรรมใหม่"),1),(0,a.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>r.closeAssignmentModal&&r.closeAssignmentModal(...e)),class:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"},[(0,a.bF)(d,{icon:["fas","times"],class:"text-xl"})])])]),(0,a.Lk)("div",UA,[(0,a.Lk)("form",{onSubmit:t[30]||(t[30]=(0,c.D$)(((...e)=>r.saveAssignment&&r.saveAssignment(...e)),["prevent"])),class:"space-y-4"},[(0,a.Lk)("div",null,[t[77]||(t[77]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[(0,a.eW)(" ชื่อกิจกรรม "),(0,a.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>i.assignmentForm.title=e),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"เช่น การบ้านครั้งที่ 1"},null,512),[[c.Jo,i.assignmentForm.title]])]),(0,a.Lk)("div",null,[t[78]||(t[78]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," คำอธิบาย ",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[17]||(t[17]=e=>i.assignmentForm.description=e),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"อธิบายรายละเอียดของกิจกรรม"},null,512),[[c.Jo,i.assignmentForm.description]])]),(0,a.Lk)("div",null,[t[81]||(t[81]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"ประเภทโจทย์",-1)),(0,a.Lk)("div",BA,[(0,a.Lk)("label",{class:(0,l.C4)(["relative flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-all","text"===i.assignmentForm.contentType?"border-orange-500 bg-orange-50":"border-gray-200"])},[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>i.assignmentForm.contentType=e),type:"radio",value:"text",class:"sr-only"},null,512),[[c.XL,i.assignmentForm.contentType]]),(0,a.Lk)("div",OA,[(0,a.Lk)("div",{class:(0,l.C4)(["w-6 h-6 rounded-full flex items-center justify-center","text"===i.assignmentForm.contentType?"bg-orange-500 text-white":"bg-gray-200 text-gray-500"])},[(0,a.bF)(d,{icon:["fas","edit"],class:"text-xs"})],2),t[79]||(t[79]=(0,a.Lk)("div",null,[(0,a.Lk)("div",{class:"font-medium text-gray-900 text-sm"},"ข้อความ (Text Editor)"),(0,a.Lk)("div",{class:"text-xs text-gray-500"},"เขียนโจทย์ด้วย Text Editor")],-1))])],2),(0,a.Lk)("label",{class:(0,l.C4)(["relative flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-all","file"===i.assignmentForm.contentType?"border-orange-500 bg-orange-50":"border-gray-200"])},[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[19]||(t[19]=e=>i.assignmentForm.contentType=e),type:"radio",value:"file",class:"sr-only"},null,512),[[c.XL,i.assignmentForm.contentType]]),(0,a.Lk)("div",QA,[(0,a.Lk)("div",{class:(0,l.C4)(["w-6 h-6 rounded-full flex items-center justify-center","file"===i.assignmentForm.contentType?"bg-orange-500 text-white":"bg-gray-200 text-gray-500"])},[(0,a.bF)(d,{icon:["fas","file"],class:"text-xs"})],2),t[80]||(t[80]=(0,a.Lk)("div",null,[(0,a.Lk)("div",{class:"font-medium text-gray-900 text-sm"},"ไฟล์เอกสาร"),(0,a.Lk)("div",{class:"text-xs text-gray-500"},"อัปโหลดไฟล์โจทย์")],-1))])],2)])]),(0,a.Lk)("div",null,[t[85]||(t[85]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"เนื้อหาโจทย์",-1)),"text"===i.assignmentForm.contentType?((0,a.uX)(),(0,a.CE)("div",MA,[(0,a.bF)(u,{content:i.assignmentForm.contentText,onUpdateContent:r.updateAssignmentContent,height:"300px",placeholder:"เขียนโจทย์และรายละเอียดของกิจกรรมที่นี่...",class:"border border-gray-300 rounded-md"},null,8,["content","onUpdateContent"])])):"file"===i.assignmentForm.contentType?((0,a.uX)(),(0,a.CE)("div",VA,[i.assignmentForm.contentFile?((0,a.uX)(),(0,a.CE)("div",RA,[(0,a.Lk)("div",WA,[(0,a.Lk)("div",NA,[(0,a.Lk)("div",qA,[(0,a.bF)(d,{icon:["fas",r.getFileIcon(i.assignmentForm.contentFile)],class:"text-blue-600 text-sm"},null,8,["icon"])]),(0,a.Lk)("div",null,[(0,a.Lk)("div",KA,(0,l.v_)(r.getFileName(i.assignmentForm.contentFile)),1),t[82]||(t[82]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"ไฟล์โจทย์",-1))])]),(0,a.Lk)("button",{onClick:t[20]||(t[20]=(...e)=>r.clearContentFile&&r.clearContentFile(...e)),type:"button",class:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",title:"ลบไฟล์"},[(0,a.bF)(d,{icon:["fas","trash"],class:"text-sm"})])])])):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:t[21]||(t[21]=(...e)=>r.openFileBrowser&&r.openFileBrowser(...e)),type:"button",class:"w-full p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-orange-400 hover:bg-orange-50 transition-all text-center"},[(0,a.Lk)("div",HA,[(0,a.Lk)("div",zA,[(0,a.bF)(d,{icon:["fas","cloud-upload"],class:"text-gray-500"})]),(0,a.Lk)("div",null,[(0,a.Lk)("div",GA,(0,l.v_)(i.assignmentForm.contentFile?"เปลี่ยนไฟล์โจทย์":"เลือกไฟล์โจทย์"),1),t[83]||(t[83]=(0,a.Lk)("div",{class:"text-xs text-gray-500"},"รองรับไฟล์ PDF, Word, Excel, PowerPoint, Text",-1))])])]),(0,a.Lk)("div",null,[t[84]||(t[84]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"คำแนะนำเพิ่มเติม (ไม่บังคับ)",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[22]||(t[22]=e=>i.assignmentForm.additionalInfo=e),rows:"2",placeholder:"คำแนะนำเพิ่มเติมสำหรับผู้เรียน...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},null,512),[[c.Jo,i.assignmentForm.additionalInfo]])])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",null,[t[88]||(t[88]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[(0,a.eW)(" กำหนดส่ง "),(0,a.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,a.Lk)("div",JA,[(0,a.Lk)("label",YA,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[23]||(t[23]=e=>i.assignmentForm.dueType=e),type:"radio",value:"fixed",class:"mr-2 text-orange-600 focus:ring-orange-500"},null,512),[[c.XL,i.assignmentForm.dueType]]),t[86]||(t[86]=(0,a.Lk)("span",{class:"text-sm"},"กำหนดวันที่แน่นอน",-1))]),(0,a.Lk)("label",ZA,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[24]||(t[24]=e=>i.assignmentForm.dueType=e),type:"radio",value:"relative",class:"mr-2 text-orange-600 focus:ring-orange-500"},null,512),[[c.XL,i.assignmentForm.dueType]]),t[87]||(t[87]=(0,a.Lk)("span",{class:"text-sm"},"กำหนดตามจำนวนวันหลังเรียนจบ",-1))])])]),"fixed"===i.assignmentForm.dueType?((0,a.uX)(),(0,a.CE)("div",eX,[t[89]||(t[89]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[(0,a.eW)(" วันที่กำหนดส่ง "),(0,a.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[25]||(t[25]=e=>i.assignmentForm.dueDate=e),type:"datetime-local",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},null,512),[[c.Jo,i.assignmentForm.dueDate]])])):"relative"===i.assignmentForm.dueType?((0,a.uX)(),(0,a.CE)("div",tX,[t[90]||(t[90]=(0,a.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[(0,a.eW)(" จำนวนวันหลังเรียนจบ "),(0,a.Lk)("span",{class:"text-red-500"},"*")],-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[26]||(t[26]=e=>i.assignmentForm.dueDays=e),type:"number",min:"1",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"เช่น 7"},null,512),[[c.Jo,i.assignmentForm.dueDays,void 0,{number:!0}]])])):(0,a.Q3)("",!0),(0,a.Lk)("div",sX,[t[94]||(t[94]=(0,a.Lk)("h4",{class:"text-sm font-medium text-gray-700 mb-3"},"การตั้งค่าไฟล์",-1)),(0,a.Lk)("div",aX,[t[91]||(t[91]=(0,a.Lk)("label",{class:"block text-sm text-gray-600 mb-2"},"ประเภทไฟล์ที่อนุญาต",-1)),(0,a.Lk)("div",oX,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.fileTypes,(e=>((0,a.uX)(),(0,a.CE)("label",{key:e,class:"flex items-center"},[(0,a.bo)((0,a.Lk)("input",{type:"checkbox",value:e,"onUpdate:modelValue":t[27]||(t[27]=e=>i.assignmentForm.fileSettings.allowedTypes=e),class:"mr-2 text-orange-600 focus:ring-orange-500"},null,8,iX),[[c.lH,i.assignmentForm.fileSettings.allowedTypes]]),(0,a.Lk)("span",rX,"."+(0,l.v_)(e),1)])))),128))])]),(0,a.Lk)("div",nX,[(0,a.Lk)("div",null,[t[92]||(t[92]=(0,a.Lk)("label",{class:"block text-sm text-gray-600 mb-1"},"จำนวนไฟล์สูงสุด",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[28]||(t[28]=e=>i.assignmentForm.fileSettings.maxFiles=e),type:"number",min:"1",max:"10",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},null,512),[[c.Jo,i.assignmentForm.fileSettings.maxFiles,void 0,{number:!0}]])]),(0,a.Lk)("div",null,[t[93]||(t[93]=(0,a.Lk)("label",{class:"block text-sm text-gray-600 mb-1"},"ขนาดไฟล์สูงสุด (MB)",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[29]||(t[29]=e=>i.assignmentForm.fileSettings.maxSizeMB=e),type:"number",min:"1",max:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},null,512),[[c.Jo,i.assignmentForm.fileSettings.maxSizeMB,void 0,{number:!0}]])])])])],32)]),(0,a.Lk)("div",lX,[(0,a.Lk)("button",{onClick:t[31]||(t[31]=(...e)=>r.closeAssignmentModal&&r.closeAssignmentModal(...e)),type:"button",class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors"}," ยกเลิก "),(0,a.Lk)("button",{onClick:t[32]||(t[32]=(...e)=>r.saveAssignment&&r.saveAssignment(...e)),type:"button",class:"px-4 py-2 bg-orange-600 text-white rounded-md text-sm font-medium hover:bg-orange-700 transition-colors"},[(0,a.bF)(d,{icon:["fas","save"],class:"mr-2"}),(0,a.eW)(" "+(0,l.v_)(i.editingAssignment?"บันทึกการแก้ไข":"สร้างกิจกรรม"),1)])])])])])):(0,a.Q3)("",!0)])),_:1})],64)}var dX=s(37137);const uX=new mr.A(!1);var mX={props:{courseData:Object,callParentFunctionProp:Function,tabs:Object,updateTabs:Object},components:{FileBrowser:os.A,editor:dX.A},data(){return{configs:n.A.get("configs"),session:n.A.get("session"),showSettings:!1,showAddAssignmentModal:!1,editingAssignment:null,expandedAssignments:[],globalSettings:{submissionType:"file",notifications:{email:!0,system:!0,reminder:!0,reminderDays:3},scoring:{enabled:!0,minScore:0,maxScore:100}},assignmentForm:{title:"",description:"",contentType:"text",contentText:"<p>เขียนโจทย์ของคุณที่นี่...</p>",contentFile:"",additionalInfo:"",dueType:"relative",dueDate:"",dueDays:7,fileSettings:{allowedTypes:["pdf","doc","docx","xls","xlsx","ppt","pptx","txt","jpg","jpeg","png"],maxFiles:1,maxSizeMB:10},status:"active"},fileTypes:["pdf","doc","docx","xls","xlsx","ppt","pptx","jpg","jpeg","png","zip","rar"],assignments:[],submissions:[],fileBrowserOpen:!1}},computed:{getSubmissionCount(){return e=>this.submissions&&Array.isArray(this.submissions)?this.submissions.filter((t=>t.assignmentId===e)).length:0},getSubmittedCount(){return e=>this.submissions&&Array.isArray(this.submissions)?this.submissions.filter((t=>t.assignmentId===e&&"submitted"===t.status)).length:0},getPendingCount(){return e=>0}},methods:{async loadAssignments(){try{if(console.log("loadAssignments called:",{courseDataExists:!!this.courseData,hasAssignments:!(!this.courseData||!this.courseData.assignments),assignmentsData:this.courseData&&this.courseData.assignments?this.courseData.assignments:null}),!this.courseData)return console.log("No courseData available yet, assignments will be empty"),this.assignments=[],void this.updateBadge(0);this.courseData.assignments&&Array.isArray(this.courseData.assignments)?(console.log("Loading assignments from courseData:",this.courseData.assignments.length),this.assignments=[...this.courseData.assignments]):(console.log("No assignments found in courseData or not an array"),this.assignments=[]),console.log("Final assignments loaded:",this.assignments.length),this.updateBadge(this.assignments.length),this.assignments.length>0&&await this.loadSubmissions(),await this.$nextTick(),this.$forceUpdate()}catch(e){console.error("Error loading assignments:",e),this.assignments=[],this.updateBadge(0)}},async loadSubmissions(){try{const e=this.assignments.map((e=>e.id||e._id)),t={method:"find",args:[{$and:[{courseId:this.courseData._id},{assignmentId:{$in:e}}]}]},s=await uX.POST("assignment/query",t,this.configs.key);200===s.status&&(this.submissions=s.data||[])}catch(e){console.error("Error loading submissions:",e)}},async saveGlobalSettings(){try{const e={data:{assignmentSettings:this.globalSettings}},t=await uX.PUT(`course/${this.courseData._id}`,e,this.configs.key);200===t.status&&(this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:2e3,icon:"success",title:"บันทึกการตั้งค่าเรียบร้อย"}),this.callParentFunction())}catch(e){console.error("Error saving settings:",e)}},toggleAssignmentExpand(e){if(console.log("toggleAssignmentExpand called with:",e),console.log("expandedAssignments before:",this.expandedAssignments),!e)return void console.warn("No assignmentId provided to toggleAssignmentExpand");const t=this.expandedAssignments.indexOf(e);t>-1?this.expandedAssignments.splice(t,1):this.expandedAssignments.push(e),console.log("expandedAssignments after:",this.expandedAssignments)},async toggleAssignmentStatus(e){e.status="active"===e.status?"inactive":"active",await this.updateAssignmentInCourse()},editAssignment(e){this.editingAssignment=e,this.assignmentForm={...e},this.showAddAssignmentModal=!0},async deleteAssignment(e){const t=await this.$swal({title:"ยืนยันการลบ",text:"คุณต้องการลบกิจกรรมนี้หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#DC2626",cancelButtonColor:"#6B7280",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก"});if(t.isConfirmed)try{const t=this.assignments.findIndex((t=>(t.id||t._id)===e));t>-1&&this.assignments.splice(t,1),await this.updateAssignmentInCourse(),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:2e3,icon:"success",title:"ลบกิจกรรมเรียบร้อย"})}catch(s){console.error("Error deleting assignment:",s)}},async saveAssignment(){try{if(this.editingAssignment?this.assignmentForm.updatedAt=(new Date).toISOString():(this.assignmentForm.id=this.generateUniqueId(),this.assignmentForm.createdAt=(new Date).toISOString()),this.editingAssignment){const e=this.assignments.findIndex((e=>(e.id||e._id)===(this.editingAssignment.id||this.editingAssignment._id)));e>-1&&(this.assignments[e]={...this.assignmentForm})}else this.assignments.push({...this.assignmentForm});await this.updateAssignmentInCourse(),this.closeAssignmentModal(),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:2e3,icon:"success",title:this.editingAssignment?"แก้ไขกิจกรรมเรียบร้อย":"สร้างกิจกรรมเรียบร้อย"})}catch(e){console.error("Error saving assignment:",e)}},async updateAssignmentInCourse(){try{const e={data:{assignments:this.assignments}},t=await uX.PUT(`course/${this.courseData._id}`,e,this.configs.key);200===t.status&&(this.updateBadge(this.assignments.length),this.callParentFunction())}catch(e){throw console.error("Error updating assignments in course:",e),e}},generateUniqueId(){return Date.now().toString(36)+Math.random().toString(36).substring(2)},closeAssignmentModal(){this.showAddAssignmentModal=!1,this.editingAssignment=null,this.resetAssignmentForm()},resetAssignmentForm(){this.assignmentForm={title:"",description:"",contentType:"text",contentText:"<p>เขียนโจทย์ของคุณที่นี่...</p>",contentFile:"",additionalInfo:"",dueType:"relative",dueDate:"",dueDays:7,fileSettings:{allowedTypes:["pdf","doc","docx","xls","xlsx","ppt","pptx","txt","jpg","jpeg","png"],maxFiles:1,maxSizeMB:10},status:"active"}},getSubmissions(e){return this.submissions&&Array.isArray(this.submissions)&&e?this.submissions.filter((t=>t.assignmentId===e)):[]},viewSubmission(e){console.log("View submission:",e)},formatDate(e){return new Date(e).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"})},formatDateTime(e){return new Date(e).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},updateBadge(e){this.$emit("update-badge",{code:this.tabs.code,badge:e})},callParentFunction(){"function"===typeof this.callParentFunctionProp&&this.callParentFunctionProp()},async callbackFunction(){try{console.log("callbackFunction called - Assignment Submission"),console.log("courseData in callback:",{exists:!!this.courseData,hasAssignments:!(!this.courseData||!this.courseData.assignments),assignmentsLength:this.courseData&&this.courseData.assignments?this.courseData.assignments.length:0}),await this.$nextTick(),await this.loadAssignments(),this.courseData&&this.courseData.assignmentSettings&&(this.globalSettings={...this.globalSettings,...this.courseData.assignmentSettings},console.log("Global settings updated:",this.globalSettings))}catch(e){console.error("Error in callbackFunction:",e)}},openFileBrowser(){this.fileBrowserOpen=!0},changeFileBrowserTrigger(e){this.fileBrowserOpen=e},selectFileBrowserTrigger(e){e&&e.file&&(this.assignmentForm.contentFile=e.file,this.fileBrowserOpen=!1)},clearContentFile(){this.assignmentForm.contentFile=""},updateAssignmentContent(e){this.assignmentForm.contentText=e},getFileIcon(e){if(!e)return"file";const t=e.split(".").pop().toLowerCase();switch(t){case"pdf":return"file-pdf";case"doc":case"docx":return"file-word";case"xls":case"xlsx":return"file-excel";case"ppt":case"pptx":return"file-powerpoint";case"txt":return"file-alt";case"jpg":case"jpeg":case"png":case"gif":return"file-image";default:return"file"}},getFileName(e){return e?e.split("/").pop():""},getNotificationStatus(){const{email:e,system:t,reminder:s}=this.globalSettings.notifications,a=[e,t,s].filter(Boolean).length;return 0===a?"ปิดทั้งหมด":3===a?"เปิดทั้งหมด":`เปิด ${a}/3 ประเภท`},getTotalStudents(){return this.courseData?.enrollment?.length||25},getTotalSubmissions(){return this.submissions&&Array.isArray(this.submissions)?this.submissions.length:0},getTotalScoredSubmissions(){return this.submissions&&Array.isArray(this.submissions)?this.submissions.filter((e=>null!==e.score&&void 0!==e.score)).length:0},getAverageCompletionRate(){if(!this.assignments||0===this.assignments.length)return 0;const e=this.assignments.reduce(((e,t)=>e+this.getCompletionRate(t._id||t.id)),0);return Math.round(e/this.assignments.length)},getCompletionRate(e){const t=this.getTotalStudents(),s=this.getSubmittedCount(e);return 0===t?0:Math.round(s/t*100)},getScoredCount(e){return this.submissions&&Array.isArray(this.submissions)?this.submissions.filter((t=>t.assignmentId===e&&null!==t.score&&void 0!==t.score)).length:0},getOverdueCount(e){if(!this.submissions||!Array.isArray(this.submissions))return 0;const t=this.assignments.find((t=>(t.id||t._id)===e));return t?this.submissions.filter((s=>s.assignmentId===e&&this.isOverdue(s,t))).length:0},isOverdue(e,t){if(!e.submittedAt||!t)return!1;let s;if("fixed"===t.dueType)s=new Date(t.dueDate);else{const e=new Date(this.courseData?.completedAt||Date.now());s=new Date(e.getTime()+24*t.dueDays*60*60*1e3)}const a=new Date(e.submittedAt);return a>s},scoreSubmission(e){this.$swal({title:"ให้คะแนนงาน",text:`ให้คะแนนงานของ ${e.userName}`,input:"number",inputLabel:`คะแนน (${this.globalSettings.scoring.minScore}-${this.globalSettings.scoring.maxScore})`,inputValue:e.score||"",inputAttributes:{min:this.globalSettings.scoring.minScore,max:this.globalSettings.scoring.maxScore,step:1},showCancelButton:!0,confirmButtonText:"บันทึกคะแนน",cancelButtonText:"ยกเลิก",inputValidator:e=>{const t=parseInt(e);return e?t<this.globalSettings.scoring.minScore||t>this.globalSettings.scoring.maxScore?`คะแนนต้องอยู่ระหว่าง ${this.globalSettings.scoring.minScore}-${this.globalSettings.scoring.maxScore}`:void 0:"กรุณาใส่คะแนน"}}).then((t=>{if(t.isConfirmed){const s=parseInt(t.value);this.updateSubmissionScore(e,s)}}))},async updateSubmissionScore(e,t){try{const s={data:{score:t,scoredAt:(new Date).toISOString()}},a=await uX.PUT(`assignment/${e._id}`,s,this.configs.key);200===a.status&&(e.score=t,e.scoredAt=(new Date).toISOString(),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:2e3,icon:"success",title:"บันทึกคะแนนเรียบร้อย"}))}catch(s){console.error("Error updating submission score:",s),this.$swal({icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถบันทึกคะแนนได้"})}}},async mounted(){try{console.log("AssignmentSubmission mounted - courseData:",this.courseData),await this.$nextTick(),await this.loadAssignments(),this.courseData&&this.courseData.assignmentSettings&&(this.globalSettings={...this.globalSettings,...this.courseData.assignmentSettings})}catch(e){console.error("Error in mounted:",e)}},watch:{courseData:{handler(e,t){console.log("courseData watch triggered:",{newVal:!!e,oldVal:!!t,hasAssignments:!(!e||!e.assignments),assignmentsLength:e&&e.assignments?e.assignments.length:0}),e&&e!==t&&this.$nextTick((()=>{this.loadAssignments(),e.assignmentSettings&&(this.globalSettings={...this.globalSettings,...e.assignmentSettings})}))},deep:!0,immediate:!0},"courseData.assignments":{handler(e,t){console.log("courseData.assignments watch triggered:",{newVal:e,oldVal:t,newLength:e?e.length:0,oldLength:t?t.length:0}),e!==t&&this.$nextTick((()=>{this.loadAssignments()}))},deep:!0,immediate:!0}}};const gX=(0,rr.A)(mX,[["render",cX],["__scopeId","data-v-3fe02f57"]]);var pX=gX,hX=s(30554);cs()().format();const bX=new mr.A(!1),xX=["vue.js 3.0","vue.draggable","draggable","component","for","based","on","Sortablejs"];var yX={data(){const e=n.A.get("session"),t=n.A.get("configs"),s=t,a=new DI.S3({forcePathStyle:!1,endpoint:s.s3EndpointDefault,region:s.s3Region,ResponseContentEncoding:"utf-8",credentials:{accessKeyId:s.s3Key,secretAccessKey:s.s3Secret}});return{dropdownOpen:!1,toast:null,configs:n.A.get("configs"),refreshKey:0,S3:a,schoolSession:s,masterDataRecord:[],contentType:[],courseData:[],courseCategory:[],playerData:[],playerCount:"0",examData:[],categoryData:[],documentData:[],documentCount:"0",playerParent:[],playerFolder:[],playerChild:[],selectPlayerItem:[],playerParentCount:"",playerChildCount:"",selectedPlayerIndex:null,selectedSubPlayerIndex:null,showPopupWindow:!1,activeBlock:!1,listItems:[],selectedItem:null,activeBlock_text:"กำลังติดต่อฐานข้อมูล กรุณารอสักครู่.....",examCount:"0",schoolAdmin:[],subArray:[],dataItem:this.$route.params.id,accessToken:e.token,login:e.login,session:e,selectCourseCover:"",loading_sources:!0,FileBrowserOpen:!1,readMoreActivated:!1,dragging:!1,cover:"",type:"",ref:"",display:"",mode:"",modeName:"",displayName:"",kindName:"",principles:"",objective:"",description:"",target:"",structure:"",enabled:!0,order:6,status:"",visibility:"",activeSubTab:"cover",thumbnail:"",ThumbnailBrowserOpen:!1,endpoint:"",valuePoint:"",playerRef:"",examRef:"",playerType:[],modeType:[],displayType:[],kindType:[],courseApiData:[],enrollCount:0,passCount:0,MasterText:e.MasterText,master:e.master,current:e.current,SetContentSourceModal:!1,setContentTriggerObj:"",list:xX.map(((e,t)=>({name:e,order:t+1}))),modalOpen:!1,filteredResults:[],filteredAdmin:[],searchQuery:"",limitItem:20,limitOptions:[10,20,50,100,200,500,1e3,2e3],currentPage:1,totalPages:0,totalItems:0,searchResults:[{id:1,name:"User 1",email:"user1@example.com"},{id:2,name:"User 2",email:"user2@example.com"},{id:3,name:"User 3",email:"user3@example.com"}],activeTab:"detail",tabs:[{code:"detail",icon:"home",shortname:"Detail",name:this.translate("lesson-description"),description:"Personal details and application.",badge:null},{code:"material",icon:"book",shortname:"Course",name:this.translate("lesson-topic"),description:"Asset details.",badge:0},{code:"schedule",icon:"calendar",shortname:"Schedule",name:"Schedule",description:"Schedule details.",badge:null},{code:"dashboard",icon:"dashboard",shortname:"Dashboard",name:this.translate("lesson-dashboard"),description:"Dashboard information.",badge:null},{code:"form",icon:"quote-left",shortname:"Form",name:this.translate("lesson-form"),description:"On-Site Form information.",badge:0},{code:"contest",icon:"square-check",shortname:"Quize",name:this.translate("lesson-exam"),description:"Asset details.",badge:null},{code:"document",icon:"file",shortname:"File",name:this.translate("lesson-document"),description:"Admin settings.",badge:null},{code:"enroll",icon:"user",shortname:"Enroll",name:this.translate("lesson-enroll"),description:"Storage information.",badge:0},{code:"survey",icon:"list-check",shortname:"Survey",name:this.translate("lesson-survey"),description:"Survey information.",badge:0},{code:"certification",icon:"address-card",shortname:"Certification",name:this.translate("lesson-certification"),description:"Certification information.",badge:null},{code:"condition",icon:"calendar-days",shortname:"กำหนดการณ์",name:"กำหนดการณ์",description:"Condition information.",badge:null},{code:"learning_path",icon:"sitemap",shortname:"Learning Path",name:"Learning Path",description:"จัดการลำดับการเรียนรู้ของหลักสูตร",badge:null},{code:"assignment",icon:"tasks",shortname:"Assignment",name:"ระบบส่งงาน",description:"จัดการกิจกรรมและการส่งงานของหลักสูตร",badge:0}]}},components:{Loader:ss.A,CourseIcon:ds.A,Toggle:as.A,Tooltip:is.m,FileBrowser:os.A,Subhead:rs.A,EnrollTable:vr.A,EnrollDashboard:wr.A,DocumentList:Rn,ContestList:wd,SurveyList:Ng,CertificateList:PI,FormList:pw,MaterialList:kr,Condition:Yb,Schedule:Ip,PipelineList:uP,AssignmentSubmission:pX},computed:{TabData(){return this.tabs.find((e=>e.code===this.activeTab))},defaultType(){return this.selectPlayerItem.length>0?this.selectPlayerItem.type:""},examType(){return hr.A.log("examType",Yt.Ac),Yt.Ac},draggingInfo(){return hr.A.log("Drag"),this.dragging?"under drag":""},dragOptions(){return{animation:1,group:"description",disabled:!1,ghostClass:"ghost"}},getIconForSubItem(){return e=>{switch(e){case"streaming":return["fas","film"];case"demand":return["fas","video"];case"youtube":return["fas","play-circle"];case"document":return["fas","file"];default:return["fas","question-circle"]}}},getClassForTypeAndData(){return(e,t)=>"demand"===e||"streaming"===e||"youtube"===e?void 0===t.video||""===t.video||null===t.video||0===Object.keys(t.video).length?"text-rose-600":"text-lime-600":"document"===e?void 0===t.content||""===t.content||null===t.content?"text-rose-600":"text-lime-600":"text-rose-600"}},methods:{translate:Jt.Tl,isTabVisible(e){const t={material:("e_learning"===this.courseData.type||"online_course"===this.courseData.type)&&"multiple"!=this.courseData.view,learning_path:("e_learning"===this.courseData.type||"online_course"===this.courseData.type)&&"multiple"===this.courseData.view,schedule:"onsite"===this.courseData.type,certification:"e_learning"===this.courseData.type&&"yes"===this.courseData.certification,survey:"yes"===this.courseData.survey,assignment:"e_learning"===this.courseData.type||"online_course"===this.courseData.type};return!(e.code in t)||t[e.code]},handleUpdateBadge(e){const t=this.tabs.find((t=>t.code===e.code));return t&&(t.badge=e.badge),t},async setActiveTab(e){try{this.activeTab=e,window.location.hash=`#${e}`;const t={form:this.$refs.form,material:this.$refs.material,survey:this.$refs.survey,enroll:this.$refs.enroll,document:this.$refs.document,schedule:this.$refs.schedule,contest:this.$refs.contest,certification:this.$refs.certification,learning_path:this.$refs.pipeline,assignment:this.$refs.assignment},s=t[e];s&&"function"===typeof s.callbackFunction?s.callbackFunction():console.warn(`Callback function not found for tab: ${e}`),await this.delay(1);const a=this.tabs.find((t=>t.code===e));a&&this.$setPageTitle(`${a.name} / ${this.courseData.name}`)}catch(t){console.error(`Error in setActiveTab for tabCode: ${e}`,t)}},delay(e){return new Promise((t=>setTimeout(t,e)))},openModal(){this.modalOpen=!0,this.filteredResults=[]},handleCheckboxClick(e){e.stopPropagation()},async closeModal(){this.modalOpen=!1,this.searchQuery=""},async getCourseAdmin(){try{const e=this.courseData.admin;if(!Array.isArray(e))return;const t=[];for(const s of e){const e=await bX.GET(`user/${s}`,this.configs.key),a=e.data;t.push(a)}this.filteredAdmin=t,hr.A.log(t)}catch(e){console.error(e)}},async autoSearch(){try{let e=[{parent:this.schoolSession.siteID,role:"manager"}];this.searchQuery&&e.push({$or:[{firstname:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{lastname:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{email:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{phone:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{username:{$regex:`.*${this.searchQuery}.*`,$options:"i"}}]});const t=[{$match:{$and:e}},{$sort:{createdAt:-1,status:-1,type:1}},{$facet:{paginatedData:[{$skip:(this.currentPage-1)*this.limitItem},{$limit:this.limitItem}],totalCount:[{$count:"count"}]}}],s=await bX.POST("user/aggregate",{pipeline:t},this.configs.key);if(200===s.status){const e=s.data;if(e.length>0&&e[0].paginatedData.length>0){const t=e[0].paginatedData,s=e[0].totalCount[0].count,a={data:t,total:s,paging:{page:this.currentPage,limit:this.limitItem,totalPages:Math.ceil(s/this.limitItem)}};this.filteredResults=a.data,this.filteredResults=this.filteredResults.filter((e=>!this.filteredAdmin.some((t=>t._id===e._id)))),this.totalItems=a.total,this.totalPages=a.paging.totalPages}else this.filteredResults=[],this.totalItems=0,this.totalPages=0}}catch(e){hr.A.log(e)}},async assignManager(e){try{const t=this.courseData.admin?[...this.courseData.admin]:[];t.push(e._id);const s={data:{admin:t},options:{}},{status:a}=await this.$Request.PUT(`course/${this.dataItem}`,s,this.configs.key);200===a&&(this.modalOpen=!1,this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"จัดการเจ้าหน้าที่",text:"เพิ่มเจ้าหน้าที่ สำเร็จแล้ว"}),this.resetData(),await this.getQueryData(),await this.getCourseAdmin())}catch(t){hr.A.log(t)}},async unassignManager(e){try{const t=this.courseData.admin?[...this.courseData.admin]:[],s=t.indexOf(e._id);-1!==s&&t.splice(s,1);const a={data:{admin:t},options:{}},{status:o}=await this.$Request.PUT(`course/${this.dataItem}`,a,this.configs.key);200===o&&(this.modalOpen=!1,this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"จัดการเจ้าหน้าที่",text:"เพิ่มเจ้าหน้าที่ สำเร็จแล้ว"}),this.resetData(),await this.getQueryData(),await this.getCourseAdmin())}catch(t){hr.A.log(t)}},performSearch(){this.searchResults=this.searchResults.filter((e=>e.name.toLowerCase().includes(this.searchQuery.toLowerCase())))},async reloadComponent(){this.refreshKey+=1,this.selectedPlayerIndex=null,this.selectedSubPlayerIndex=null,await this.getQueryData(!0)},formatDuration(e){const t=parseFloat(e);if(isNaN(t)||t<=0)return"00:00";const s=Math.floor(t/60),a=Math.floor(t%60),o=s.toString().padStart(2,"0"),i=a.toString().padStart(2,"0");return`${o}:${i}`},async addPlayer(e,t,s,a){try{this.toast=(0,gr.A)({type:"pending",message:"กำลังเพิ่ม..."});const o=a?"sub":a;let i=("0"+parseInt(t+1)).slice(-2);const r={data:{courseId:this.courseData.master,root:a,mode:o,type:e,name:"บทเรียนสำหรับ "+s+" - "+i,order:i,duration:"00:00:00"},options:{}},n=await this.$Request.POST("player",r,this.configs.key);200===n.status&&(this.toast.hide("เพิ่มเสร็จแล้ว.","success",300),await this.getQueryData())}catch(o){hr.A.log(o)}},async removeVideo(){try{const e={data:{video:{}}},{status:t}=await this.$Request.PUT(`player/${this.selectPlayerItem._id}`,e,this.configs.key);200===t&&(this.selectedPlayerIndex=null,this.playerParent=[],this.selectPlayerItem=[],await this.getQueryData())}catch(e){hr.A.log(e)}},async updataVideo(e){try{const t={data:{video:{desktop:e.file,mobile:e.file},duration:this.formatDuration(e.duration),thumbnail:e.thumbnail},options:{}},{status:s}=await this.$Request.PUT(`player/${e.id}`,t,this.configs.key);200===s&&await this.getQueryData()}catch(t){hr.A.log(t)}},async updataDocument(e){try{const t={data:{content:e.file},options:{}},{status:s}=await this.$Request.PUT(`player/${e.id}`,t,this.configs.key);200===s&&await this.getQueryData()}catch(t){hr.A.log(t)}},async updataPlayer(e){try{const t={data:{name:e.name,description:e.description,duration:e.duration,type:e.type,demo:e.demo}},{status:s}=await this.$Request.PUT(`player/${e.id}`,t,this.configs.key);200===s&&(hr.A.log("updataPlayer"),await this.getQueryData())}catch(t){hr.A.log(t)}},async SetContentSource(e){try{const t={data:{video:{}},options:{}};"streaming"===e.type?t.data.video.streaming=e.file:"youtube"===e.type&&(t.data.video.youtube=e.file);const{status:s}=await this.$Request.PUT(`player/${e.id}`,t,this.configs.key);200===s&&await this.getQueryData()}catch(t){hr.A.log(t)}},togglePanel(e){if(this.isOpenPanel(e))this.selectedPlayerIndex=null;else{this.selectedPlayerIndex=e;const t=document.getElementById(`panel-${this.selectedPlayerIndex}`);if(t){const e=t.getBoundingClientRect().top+window.scrollY-10;this.smoothScrollTo(e)}}},smoothScrollTo(e,t=500){const s=window.scrollY,a=e-s,o=performance.now();function i(){const n=performance.now(),l=n-o;l<t?(window.scrollTo(0,s+r(l/t)*a),requestAnimationFrame(i)):window.scrollTo(0,e)}function r(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}requestAnimationFrame(i)},isOpenPanel(e){return this.selectedPlayerIndex===e},toggleSubPanel(e,t){if(this.isOpenSubPanel(e,t))this.selectedSubPlayerIndex=null,this.selectedPlayerIndex=null;else{this.selectedSubPlayerIndex=[e,t],this.selectedPlayerIndex=e;const s=document.getElementById(`panel-${e}`);if(s){const e=s.getBoundingClientRect().top+window.scrollY-10;this.smoothScrollTo(e)}}},isOpenSubPanel(e,t){return!!Array.isArray(this.selectedSubPlayerIndex)&&(this.selectedSubPlayerIndex[0]===e&&this.selectedSubPlayerIndex[1]===t)},hideSubPanel(){this.selectedSubPlayerIndex=null,this.selectedPlayerIndex=null},hidePanel(){this.selectedPlayerIndex=null,this.selectedSubPlayerIndex=null},getPlayerItemVideoUrl(e){return"demand"===e.type?e.video.desktop:"streaming"===e.type?e.video.streaming:"youtube"===e.type?e.video.youtube:""},formatNumber(e){return ns.A.formatNumber(e,"short")},objectFindByKey(e,t,s){for(var a=0;a<e.length;a++)if(e[a][t]===s)return e[a];return null},getCategoryName(e){const t=this.objectFindByKey(this.categoryData,"code",e);return t?t.name:""},getPlayerTypeName(e){const t=this.objectFindByKey(this.playerType,"code",e);return t?t.name:""},log(e){for(var t of(hr.A.log(e),Object.keys(this.playerParent)))hr.A.log(t+" -> "+this.playerParent[t]._id),this.reOrderPlayer(this.playerParent[t]._id,("0"+t).slice(-2))},log_sub(e){for(var t of(hr.A.log(e),Object.keys(this.playerFolder[e])))hr.A.log(t+" -> "+this.playerFolder[e][t]._id),this.reOrderPlayer(this.playerFolder[e][t]._id,("0"+t).slice(-2))},sort(){this.list=this.list.sort(((e,t)=>e.order-t.order))},dateTime(e){return cs()(e).format("DD/MM/YYYY hh:mm:ss")},async fetchScoreCount(){try{const e={args:[{$and:[{courseID:this.dataItem}]}]},{data:t}=await this.$Request.POST("enroll/count",e,this.configs.key);this.enrollCount=t.count}catch(e){console.error("An error occurred while fetching score count:",e)}},async fetchScorePassCount(){try{const e={args:[{courseID:this.dataItem,"analytics.post.message":"ผ่านการรับรอง"}]},{data:t}=await this.$Request.POST("enroll/count",e,this.configs.key);this.passCount=t.count}catch(e){console.error("An error occurred while fetching score count:",e)}},async getQueryData(){try{let e=null;const t=[{$match:{$expr:{$eq:["$_id",{$toObjectId:this.dataItem}]}}},{$lookup:{from:"player",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT.master","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseId"]}}}],as:"players"}},{$addFields:{playersCount:{$size:"$players"}}},{$lookup:{from:"exam",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT.master","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseId"]}}}],as:"exams"}},{$addFields:{examsCount:{$size:"$exams"}}},{$lookup:{from:"document",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT.master","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseId"]}}}],as:"documents"}},{$addFields:{documentsCount:{$size:"$documents"}}},{$lookup:{from:"enroll",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT._id","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseID"]}}},{$group:{_id:null,count:{$sum:1}}},{$project:{_id:0,count:1}}],as:"enrollsCountArray"}},{$addFields:{enrollsCount:{$ifNull:[{$arrayElemAt:["$enrollsCountArray.count",0]},0]}}},{$lookup:{from:"form",let:{courseIdStr:{$toString:{$ifNull:["$$ROOT._id","$_id"]}}},pipeline:[{$match:{$expr:{$eq:["$$courseIdStr","$courseID"]}}},{$group:{_id:null,count:{$sum:1}}},{$project:{_id:0,count:1}}],as:"formsCountArray"}},{$addFields:{formsCount:{$ifNull:[{$arrayElemAt:["$formsCountArray.count",0]},0]}}},{$lookup:{from:"category",let:{categoryCodes:{$ifNull:["$$ROOT.category",[]]}},pipeline:[{$match:{$expr:{$in:["$code","$$categoryCodes"]}}}],as:"categories"}},{$group:{_id:"$_id",material:{$first:"$playersCount"},document:{$first:"$documentsCount"},contest:{$first:"$examsCount"},enroll:{$first:"$enrollsCount"},form:{$first:"$formsCount"},course:{$first:"$$ROOT"},category:{$first:"$categories"},exam:{$first:"$exams"}}}],s={pipeline:t},a=await bX.POST(`${this.endpoint}/aggregate`,s,this.configs.key);if(200===a.status&&(e=a.data,e&&e.length>0)){const t=this.processingData(e);this.masterDataRecord=t,this.resetData(),this.courseApiData=e,this.aggregateAndMapCountsToTabs(),this.playerData=t.formattedData.players??null,this.courseData=t.formattedData.course??null,this.courseData.categories=t.formattedData.categories??null,this.examData=t.formattedData.exam??null,console.log("documentData",t.formattedData.course.documents),this.documentData=t.formattedData.course.documents??null,this.playerParent=t.playerParentItems,this.playerChild=t.playerParentChild,this.playerFolder=t.playerParentFolder,this.masterDataRecord&&(this.playerData.sort((function(e,t){return e.order<t.order?-1:1})),this.playerParent.sort((function(e,t){return e.order<t.order?-1:1})),this.playerChild.sort((function(e,t){return e.order<t.order?-1:1}))),this.playerCount=this.playerData.length,this.playerParentCount=this.playerParent.length,this.playerChildCount=this.playerChild.length,this.courseCategory=this.courseData.categories,this.principles=this.courseData.principles,this.objective=this.courseData.objective,this.target=this.courseData.target,this.structure=this.courseData.structure,this.description=this.courseData.description,this.cover=this.courseData.cover,this.thumbnail=this.courseData.thumbnail,this.mode=this.courseData.mode,this.display=this.courseData.display,this.type=this.courseData.type,this.ref=this.courseData.master,this.playerRef=this.courseData.playerRef??this.courseData.master,this.examRef=this.courseData.examRef??this.courseData.master,this.status=this.courseData.status??!0,this.visibility=this.courseData.visibility??!0,this.examCount=this.examData.length??0,this.documentCount=this.documentData.length??0,this.$setPageTitle("รายละเอียด / "+this.courseData.name)}}catch(e){hr.A.log(e)}},aggregateAndMapCountsToTabs(){let e=this.tabs.reduce(((e,t)=>({...e,[t.code]:0})),{});this.courseApiData.forEach((t=>{for(let s in t)s in e&&(e[s]+=t[s])}));const t=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});this.tabs.forEach((s=>{s.code in e&&null!==s.badge&&(s.badge=t.format(e[s.code]))}))},processingData(e){const t={players:[],categories:[],document:[],exam:[],course:null},s=new Set,a=new Set,o=new Set,i=new Set,r=[],n=[],l=[];return e.forEach((e=>{Array.isArray(e.player)?e.player.forEach((e=>{i.has(e._id)||(t.players.push(e),i.add(e._id))})):e.player&&!i.has(e.player._id)&&(t.players.push(e.player),i.add(e.player._id)),Array.isArray(e.category)?e.category.forEach((e=>{s.has(e._id)||(t.categories.push(e),s.add(e._id))})):e.category&&!s.has(e.category._id)&&(t.categories.push(e.category),s.add(e.category._id)),Array.isArray(e.document)?e.document.forEach((e=>{a.has(e._id)||(t.document.push(e),a.add(e._id))})):e.document&&!a.has(e.document._id)&&(t.document.push(e.document),a.add(e.document._id)),Array.isArray(e.exam)?e.exam.forEach((e=>{o.has(e._id)||(t.exam.push(e),o.add(e._id))})):e.exam&&!o.has(e.exam._id)&&(t.exam.push(e.exam),o.add(e.exam._id)),t.course||(t.course=e.course)})),t.players.forEach((e=>{"folder"!==e.type&&"sub"===e.mode&&n.push(e)})),t.players.forEach((e=>{"sub"!=e.mode&&(0,Zt.KR)(r.push(e))})),r.forEach((e=>{let t=e._id;l[t]=[],n.forEach((s=>{s.root===e._id&&l[t].push(s)}))})),{formattedData:t,playerParentItems:r,playerParentChild:n,playerParentFolder:l}},resetData(){hr.A.log("resetData",this.courseData),this.searchQuery=null,this.playerData=null,this.courseData=null,this.examData=null,this.documentData=null,this.playerParent=[],this.playerChild=[],this.playerFolder=[],this.playerCount=0,this.playerParentCount=0,this.playerChildCount=0,this.principles=null,this.objective=null,this.target=null,this.structure=null,this.description=null,this.cover=null,this.mode=null,this.display=null,this.type=null,this.ref=null,this.playerRef=null,this.examRef=null,this.status=!0,this.sync=!1,this.examCount=0,this.documentCount=0},changeFileTrigger(e){this.FileBrowserOpen=e},selectFileTrigger(e){hr.A.log("selectFileTrigger"),void 0!=e&&(this.selectCourseCover=e,this.updataCover(e.file))},async updataCover(e){try{const t={data:{cover:e},options:{}},{status:s}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,t,this.configs.key);200===s&&(this.cover=e,this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"แก้ไขรูปหน้าปก",text:"แก้ไขรูปหน้าปก สำเร็จแล้ว"}))}catch(t){hr.A.log(t)}},async toggleStatus(){try{const e={data:{status:this.status},options:{}},{status:t}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,e,this.configs.key);200===t&&hr.A.log("Update Status")}catch(e){hr.A.log(e)}},async toggleVisibility(){try{const e={data:{visibility:this.visibility},options:{}},{status:t}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,e,this.configs.key);200===t&&hr.A.log("Update Sync")}catch(e){hr.A.log(e)}},async changePlayerRef(){try{hr.A.log(this.playerRef);const e={playerRef:this.playerRef},{data:t}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,e,this.accessToken);t.success&&(hr.A.log("Update playerRef"),location.reload())}catch(e){hr.A.log(e)}},async changeExamRef(){try{hr.A.log(this.examRef);const e={examRef:this.examRef},{data:t}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,e,this.accessToken);t.success&&(hr.A.log("Update examRef"),location.reload())}catch(e){hr.A.log(e)}},async unlinkMaster(){try{const e={master:"none",examRef:this.dataItem,playerRef:this.dataItem},{data:t}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,e,this.accessToken);t.success&&(hr.A.log("Update Unlink Master"),location.reload())}catch(e){hr.A.log(e)}},async deleteParentPlayer(e){pr.A.confirm({title:"ต้องการลบข้อมูลนี้?",message:"หลังจากลบแล้วจะไม่สามารถกู้คืนข้อมูลนี้ได้อีก !",confirm:async()=>{try{this.toast=(0,gr.A)({type:"pending",message:"กำลังลบ.."});const{status:t,data:s}=await this.$Request.DELETE(`player/${e}`,null,this.configs.key);200===t&&(this.toast.hide("ลบเสร็จแล้ว.","success",300),await this.getQueryData(),hr.A.log(s))}catch(t){hr.A.log(t)}},cancel:()=>{}})},async deletePlayer(e){try{hr.A.log("updatedItem",e),this.$swal({title:"ต้องการลบข้อมูลนี้ ?",text:"หลังจากลบแล้วจะไม่สามารถกู้คืนข้อมูลนี้ได้อีก !",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ตกลง ลบเลย",cancelButtonText:"ยกเลิก",closeOnConfirm:!1,closeOnCancel:!1}).then((t=>{t.isConfirmed?(hr.A.log("Delete"),this.confirmDeletePlayer(e.id)):hr.A.log("Cancel")}))}catch(t){hr.A.log(t)}},async deleteExam(e,t){if(this.login)try{hr.A.log("id",e),hr.A.log("index",t),this.$swal({title:"ต้องการลบข้อมูลนี้ ?",text:"หลังจากลบแล้วจะไม่สามารถกู้คืนข้อมูลนี้ได้อีก !",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ตกลง ลบเลย",cancelButtonText:"ยกเลิก",closeOnConfirm:!1,closeOnCancel:!1}).then((s=>{s.isConfirmed?(hr.A.log("Delete"),this.confirmDeleteExam(e,t)):hr.A.log("Cancel")}))}catch(s){hr.A.log(s)}},async confirmDeleteExam(e,t){if(this.login)try{const{status:s}=await this.$Request.DELETE(`exam/${e}`,null,this.configs.key);200===s&&(this.examData.splice(t,1),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"ลบข้อมูล",text:"ลบข้อมุลนี้ สำเร็จแล้ว"}))}catch(s){hr.A.log(s)}},async reOrderPlayer(e,t){if(this.login)try{const s={data:{order:t},options:{}},{data:a}=await this.$Request.PUT(`player/${e}`,s,this.configs.key);a.success&&hr.A.log("ReOrder")}catch(s){hr.A.log(s)}},OpenFileBrowser(){this.FileBrowserOpen=!0},OpenVideoBrowser(){this.VideoBrowserOpen=!0},changeVideoTrigger(e){this.VideoBrowserOpen=e},selectVideoTrigger(e){hr.A.log("selectVideoTrigger"),void 0!=e&&(this.selectCourseVideo=e,hr.A.log("selectVideoTriggerFunction",e),this.updataVideo(e.file))},checkMove:function(e){return"apple"!==e.draggedContext.element.name},updated(){ts().replace()},async getFormData(){try{const e={method:"find",args:[{$and:[{owner:this.session.current._id},{type:{$in:["form"]}},{action:{$in:["course"]}}]}],paging:{page:this.currentPage,limit:this.limitItem}},{data:t}=await this.$Request.POST("post/query",e,this.configs.key);this.listItems=t.data,hr.A.log(this.listItems),this.loading_sources=!0}catch(e){hr.A.log(e)}},async updataForm(e){if(this.login)try{const t={data:{form:e},options:{}},{status:s}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,t,this.configs.key);200===s&&(this.form=e,this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"Assign แบบฟอร์ม",text:"Assign แบบฟอร์ม สำเร็จแล้ว"}))}catch(t){hr.A.log(t)}},async updateForm(){this.selectedItem&&(hr.A.log("Selected Item:",this.selectedItem._id,this.dataItem),await this.updataForm(this.selectedItem),await this.getQueryData(),this.showPopupWindow=!1)},async showPopup(){await this.getFormData(),this.showPopupWindow=!0},closePopup(){this.showPopupWindow=!1},async checkUrl(e,t,s){const a=e.desktop.includes("https://content.fti.academy/");if(a)try{this.activeBlock=!0,this.activeBlock_text="กำลังดึงไฟล์จาก Academy Server...";const a=6e4,o=fetch(e.desktop),i=new Promise(((e,t)=>{setTimeout((()=>t(new Error("File loading timed out"))),a)})),r=await Promise.race([o,i]);if(r){const a=r.headers.get("Content-Length"),o=parseInt(a,10),i=o/1048576;let n=0;const l=r.body.getReader(),c=[];this.activeBlock_text=`กำลังดึงไฟล์จาก Academy Server... (0 MB / ${i.toFixed(2)} MB)`;let d=await l.read();while(!d.done){const e=d.value;c.push(e),n+=e.length,this.activeBlock_text=`กำลังดึงไฟล์จาก Academy Server... (${(n/1048576).toFixed(2)} MB / ${i.toFixed(2)} MB)`,d=await l.read()}const u=n,m=new Uint8Array(u);let g=0;for(const e of c)m.set(e,g),g+=e.length;this.activeBlock_text="กำลังตรวจสอบไฟล์...";const p=e.desktop.substring(e.desktop.lastIndexOf("/")+1),h=p.substring(0,p.lastIndexOf(".")),b=p.substring(p.lastIndexOf(".")+1);this.activeBlock_text="กำลังอัพโหลดไฟล์ขึ้น Server Cloud...";const x={Bucket:this.schoolSession.s3Bucket,Key:"video/"+h+"."+b,Body:m,ACL:"public-read"},y=await this.S3.send(new hX.w(x));hr.A.log("File uploaded successfully:",y);const f=this.schoolSession.s3Endpoint+"video/"+h+"."+b;hr.A.log("outputLink:",f);const k=await fetch("https://gateway.cloudrestfulapi.com/api/player/"+t,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{video:{desktop:f,mobile:f}},options:{}})});if(!k.ok)throw new Error("Failed to update video URL");hr.A.log("Update Status"),s.video.desktop=f,this.activeBlock_text="อัพโหลดไฟล์เสร็จสิ้น"}}catch(o){console.error("Error uploading file:",o)}finally{this.activeBlock=!1}},handleDeleteDocument(e,t){this.documentData.splice(t,1)},handleAddDocument(){this.getQueryData()},OpenThumbnailBrowser(){this.ThumbnailBrowserOpen=!0},changeThumbnailTrigger(e){this.ThumbnailBrowserOpen=e},async selectThumbnailTrigger(e){void 0!==e&&(this.thumbnail=e.file,await this.updataThumbnail(e.file))},async updataThumbnail(e){try{const t={data:{thumbnail:e},options:{}},{status:s}=await this.$Request.PUT(`${this.endpoint}/${this.dataItem}`,t,this.configs.key);200===s?this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"แก้ไขรูป Thumbnail",text:"แก้ไขรูป Thumbnail สำเร็จแล้ว"}):this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถแก้ไขรูป Thumbnail ได้"})}catch(t){hr.A.log(t),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"error",title:"เกิดข้อผิดพลาด",text:"การเชื่อมต่อล้มเหลว"})}}},created(){if(this.playerType=Yt.OC,window.location.hash){const e=window.location.hash.replace("#","");this.tabs.some((t=>t.code===e))&&(this.activeTab=e)}},async mounted(){try{this.master?this.endpoint="mcourse":this.endpoint="course",await this.getQueryData(),await this.fetchScoreCount(),await this.fetchScorePassCount(),await this.getCourseAdmin(),this.modeType=Yt.Mq,this.modeName=this.modeType&&this.objectFindByKey(this.modeType,"code",this.mode)?.name||"None",this.displayType=Yt.Vy,this.displayName=this.displayType&&this.objectFindByKey(this.displayType,"code",this.display)?.name||"None",this.kindType=Yt.fM,this.kindName=this.kindType&&this.objectFindByKey(this.kindType,"code",this.type)?.name||"None",this.playerType=Yt.OC}catch(e){console.error(Error)}},setup(){hr.A.log("Setup")}};const fX=(0,rr.A)(yX,[["render",Gt]]);var kX=fX,vX=s(22415),wX={name:"Lesson Detail",components:{Backend:kX,Frontend:vX.A},data(){return{session:n.A.get("session")}},setup(){const e=(0,r.lq)(),t=e.meta.title;(0,i.K7)(t)},computed:{componentName(){return"backend"===this.session.interface?"Backend":"frontend"===this.session.interface?"Frontend":"Backend"}}};const LX=(0,rr.A)(wX,[["render",o]]);var CX=LX},13955:function(e,t,s){s.d(t,{A:function(){return k}});var a=s(20641),o=s(50953),i=s(90033),r=s(53751),n=s(94232),l=s(10797);const c={class:"fixed inset-0 overflow-y-auto"},d={class:"flex min-h-full items-center justify-center p-4 text-center"},u={class:"text-gray-500"},m={class:"font-bold"},g={class:"mt-2 pb-4 border-b"},p=["value"],h=["value"],b={class:"mt-4"},x={data(){return{loading_sources:!0,activeBlock:!1,contentURL:"",contentType:"",contentOriginal:""}},components:{},methods:{setContentSource(){this.$emit("set-content-event",{contentURL:this.$refs.form.contentURL.value,contentOriginal:this.$refs.form.contentOriginal.value})},isLetterOrNumber(e){let t=String.fromCharCode(e.keyCode);if(/^[a-zA-Z0-9@#&().+_"-]*$/.test(t))return!0;e.preventDefault()}},async mounted(){},setup(){},watch:{contentURL(e){console.log(e);let t=e.replace(/[^\x20-\x7E]/g,"");console.log(t),this.contentURL=t}}};var y=Object.assign(x,{__name:"SetContentSource",props:{isWindowsOpen:Boolean,renameTriggerObj:String,contentType:String,contentOriginal:String},emits:["set-content-trigger","set-content-event"],setup(e,{emit:t}){const s=e,x=t,y=(0,o.KR)(s.isWindowsOpen),f=(0,o.KR)(s.renameTriggerObj),k=(0,o.KR)(s.contentType),v=(0,o.KR)(s.contentOriginal);function w(){y.value=!1,x("set-content-trigger",!1)}return x("set-content-trigger",!0),(e,t)=>{const s=(0,a.g2)("font-awesome-icon");return e.loading_sources?((0,a.uX)(),(0,a.Wv)((0,o.R1)(n.O),{key:0,appear:"",show:y.value,as:"template"},{default:(0,a.k6)((()=>[(0,a.bF)((0,o.R1)(l.lG),{as:"div",onClose:w,class:"relative z-10"},{default:(0,a.k6)((()=>[(0,a.bF)((0,o.R1)(n._),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:(0,a.k6)((()=>t[2]||(t[2]=[(0,a.Lk)("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)]))),_:1}),(0,a.Lk)("div",c,[(0,a.Lk)("div",d,[(0,a.bF)((0,o.R1)(n._),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:(0,a.k6)((()=>[(0,a.bF)((0,o.R1)(l.Lj),{class:(0,i.C4)(["w-[40rem] transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all blocking relative",[e.activeBlock?"isblock":"isunblock"]]),"data-content":"กำลังติดต่อฐานข้อมูล กรุณารอสักครู่....."},{default:(0,a.k6)((()=>[(0,a.bF)((0,o.R1)(l.L3),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900 pb-4 border-b"},{default:(0,a.k6)((()=>[t[4]||(t[4]=(0,a.eW)("แก้ไขต้นฉบับเนื้อหา ")),t[5]||(t[5]=(0,a.Lk)("br",null,null,-1)),(0,a.Lk)("small",u,[t[3]||(t[3]=(0,a.eW)("ประเภท ")),(0,a.Lk)("span",m,(0,i.v_)(k.value),1)])])),_:1}),(0,a.Lk)("div",g,[(0,a.Lk)("form",{onSubmit:t[0]||(t[0]=(0,r.D$)(((...t)=>e.setContentSource&&e.setContentSource(...t)),["prevent"])),ref:"form"},[(0,a.Lk)("input",{type:"text",name:"contentURL",id:"contentURL",autocomplete:"contentURL",class:"mt-1 block w-full rounded-md py-2 px-3 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-gray-900 sm:text-sm",value:v.value},null,8,p),(0,a.Lk)("input",{type:"hidden",name:"contentOriginal",id:"contentOriginal",autocomplete:"contentOriginal",class:"mt-1 block w-full rounded-md py-2 px-3 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-gray-900 sm:text-sm",value:f.value},null,8,h)],544)]),(0,a.Lk)("div",b,[(0,a.Lk)("button",{type:"button",class:"w-50 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-md font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-100",onClick:w},[(0,a.bF)(s,{icon:["fas","times"],class:"text-black text-[12px] mr-2"}),t[6]||(t[6]=(0,a.eW)(" ยกเลิก "))]),(0,a.Lk)("button",{type:"button",class:"w-50 float-right inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-md font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:t[1]||(t[1]=(...t)=>e.setContentSource&&e.setContentSource(...t))},[(0,a.bF)(s,{icon:["fas","check"],class:"text-white text-[12px] mr-2"}),t[7]||(t[7]=(0,a.eW)(" เพิ่มเนื้อหา "))])])])),_:1},8,["class"])])),_:1})])])])),_:1})])),_:1},8,["show"])):(0,a.Q3)("",!0)}}});const f=y;var k=f},48646:function(e,t,s){var a=s(69565),o=s(28551),i=s(1767),r=s(50851);e.exports=function(e,t){t&&"string"===typeof e||o(e);var s=r(e);return i(o(void 0!==s?a(s,e):e))}},81148:function(e,t,s){var a=s(46518),o=s(72652),i=s(79306),r=s(28551),n=s(1767);a({target:"Iterator",proto:!0,real:!0},{every:function(e){r(this),i(e);var t=n(this),s=0;return!o(t,(function(t,a){if(!e(t,s++))return a()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},30531:function(e,t,s){var a=s(46518),o=s(69565),i=s(79306),r=s(28551),n=s(1767),l=s(48646),c=s(19462),d=s(9539),u=s(96395),m=c((function(){var e,t,s=this.iterator,a=this.mapper;while(1){if(t=this.inner)try{if(e=r(o(t.next,t.iterator)),!e.done)return e.value;this.inner=null}catch(i){d(s,"throw",i)}if(e=r(o(this.next,s)),this.done=!!e.done)return;try{this.inner=l(a(e.value,this.counter++),!1)}catch(i){d(s,"throw",i)}}}));a({target:"Iterator",proto:!0,real:!0,forced:u},{flatMap:function(e){return r(this),i(e),new m(n(this),{mapper:e,inner:null})}})},23215:function(e,t,s){s(81148)},30670:function(e,t,s){s(30531)}}]);
//# sourceMappingURL=5183.1f5680a8.js.map