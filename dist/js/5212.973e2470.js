"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[5212],{5212:function(e,t,s){s.r(t),s.d(t,{default:function(){return fe}});var a=s(20641);function o(e,t,s,o,n,i){const r=(0,a.g2)("List");return this.login?((0,a.uX)(),(0,a.Wv)(r,{key:0})):(0,a.Q3)("",!0)}var n=s(52968),i=s(75220),r=(s(44114),s(90033)),l=s(53751);const d={key:0,class:"text-center"},c={key:0,class:"loading-overlay"},u={class:"loading-text"},g={class:"processing-count"},m={class:"flex-1 pb-8 bg-gray-100 pt-2 pb-5 border-t"},p={class:"mt-8"},h={class:"mx-auto max-w-7xl px-6 sm:px-6 lg:px-6"},y={class:"mt-8 flex flex-col"},f={class:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8"},b={class:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8"},x={class:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg"},k={class:"min-w-full divide-y divide-gray-300"},v={class:"bg-gray-100"},w={class:"hidden md:table-row p-0 m-0 bg-gray-50 border-b border-gray-200"},_={colspan:"4",class:"p-3 m-0"},C={class:"flex items-center"},L={key:0,class:""},P={key:0,class:"text-left ml-2 text-gray-500"},I={class:"text-black font-semibold"},S={key:1,class:"text-left mt-2"},T={colspan:"3",class:"p-3 m-0"},$={class:"flex items-center justify-end"},Q=["value"],E={class:"table-row md:hidden p-0 m-0 border-b border-gray-200"},O={colspan:"3",class:"p-3 m-0 text-center"},A={class:"mb-4 mx-auto max-w-full"},j={key:0,class:"mt-2 text-gray-500"},X={class:"text-black font-semibold"},F={key:1,class:"mt-2"},N={class:"flex justify-center"},D={class:"py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"},M={class:"px-3 py-4 text-md text-gray-700 font-semibold"},W=["innerHTML"],q=["innerHTML"],U={class:"hidden md:table-cell px-3 py-4 text-sm text-gray-500"},J=["innerHTML"],H={class:"hidden md:table-cell px-3 py-4 text-sm text-gray-500"},K=["innerHTML"],B=["innerHTML"],z={class:"hidden md:table-cell px-3 py-4 text-sm text-gray-500"},R={class:"font-semibold text-blue-500"},V={class:"hidden md:table-cell px-3 py-4 text-sm text-gray-500"},G={class:"relative py-4 pl-3 pr-4 text-right text-md font-medium sm:pr-6"},Y={class:"flex"},Z=["onClick"],ee=["onClick"],te=["onClick"],se={class:"p-0 m-0 bg-gray-50"},ae={colspan:"7",class:"p-3 m-0"},oe={class:"text-center"};function ne(e,t,s,o,n,i){const ne=(0,a.g2)("Loader"),ie=(0,a.g2)("Subhead"),re=(0,a.g2)("Pagination"),le=(0,a.g2)("router-link"),de=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)(a.FK,null,[n.loading_sources?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",d,[(0,a.bF)(ne)])),(0,a.Lk)("div",null,[(0,a.bF)(ie,{navigation:[{name:"ค้นหา",function:"showOverlay",style:"search",class:"icon-btn",type:"button"},{name:"Select Status",function:"toggleStatus",style:"pencil",type:"select",value:this.statusFilter,placeholder:"เลือกสถานะ",options:[{name:"ทั้งหมด",value:"all"},{name:"เผยแพร่",value:!0},{name:"ไม่เผยแพร่",value:!1}]},{name:"Import ข้อมูล",function:"callAPIWithAggregationPipeline",style:"upload",class:"primary-btn",type:"button"}],onToggleStatus:i.toggleStatus,onCallAPIWithAggregationPipeline:e.callAPIWithAggregationPipeline},null,8,["navigation","onToggleStatus","onCallAPIWithAggregationPipeline"]),(0,a.Lk)("div",null,[n.isShowingOverlay?((0,a.uX)(),(0,a.CE)("div",c,[(0,a.Lk)("div",u,(0,r.v_)(n.loadingMessage),1),(0,a.Lk)("div",g,(0,r.v_)(n.processingCount),1)])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",m,[(0,a.Lk)("div",p,[(0,a.Lk)("div",h,[(0,a.Lk)("div",y,[(0,a.Lk)("div",f,[(0,a.Lk)("div",b,[(0,a.Lk)("div",x,[(0,a.Lk)("table",k,[(0,a.Lk)("thead",v,[(0,a.Lk)("tr",w,[(0,a.Lk)("td",_,[(0,a.Lk)("div",C,[(0,a.bo)((0,a.Lk)("input",{id:"search",type:"text",class:"px-4 py-2 rounded-md border-gray-300 bg-white focus:outline-none",placeholder:"ค้นหา...","onUpdate:modelValue":t[0]||(t[0]=e=>n.searchQuery=e)},null,512),[[l.Jo,n.searchQuery]]),n.searchQuery.length>0?((0,a.uX)(),(0,a.CE)("div",L,[n.searchQuery.length>0?((0,a.uX)(),(0,a.CE)("div",P,[t[6]||(t[6]=(0,a.eW)(" ผลการค้นหา ")),(0,a.Lk)("span",I,(0,r.v_)(n.totalItems),1),t[7]||(t[7]=(0,a.eW)(" รายการ (s) "))])):((0,a.uX)(),(0,a.CE)("div",S," ไม่พบข้อมูล "))])):(0,a.Q3)("",!0),n.searchQuery.length>0?((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:t[1]||(t[1]=(...e)=>i.clearSearchQuery&&i.clearSearchQuery(...e)),type:"button",class:"ml-2 text-blue-500 hover:underline focus:outline-none"}," Clear ")):(0,a.Q3)("",!0)])]),(0,a.Lk)("td",T,[(0,a.Lk)("div",$,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.limitItem=e),onChange:t[3]||(t[3]=(...e)=>i.handleLimitChange&&i.handleLimitChange(...e)),class:"block w-24 py-2 px-2 text-sm font-medium bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.limitOptions,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,r.v_)(e),9,Q)))),128))],544),[[l.u1,n.limitItem]]),(0,a.bF)(re,{"current-page":n.currentPage,"total-items":n.totalItems,"total-pages":n.totalPages,"limit-items":n.limitItem,"data-loading":n.loading,"display-mode":"nav",onPageChanged:i.handlePageChanged,class:"ml-2"},null,8,["current-page","total-items","total-pages","limit-items","data-loading","onPageChanged"])])])]),(0,a.Lk)("tr",E,[(0,a.Lk)("td",O,[(0,a.Lk)("div",A,[(0,a.bo)((0,a.Lk)("input",{id:"search",type:"text",class:"w-full px-4 py-2 rounded-sm border-gray-300 bg-white focus:outline-none",placeholder:"ค้นหา...","onUpdate:modelValue":t[4]||(t[4]=e=>n.searchQuery=e)},null,512),[[l.Jo,n.searchQuery]]),n.searchQuery.length>0?((0,a.uX)(),(0,a.CE)("div",j,[t[8]||(t[8]=(0,a.eW)(" ผลการค้นหา ")),(0,a.Lk)("span",X,(0,r.v_)(n.totalItems),1),t[9]||(t[9]=(0,a.eW)(" รายการ (s) "))])):((0,a.uX)(),(0,a.CE)("div",F," ไม่พบข้อมูล ")),n.searchQuery.length>0?((0,a.uX)(),(0,a.CE)("button",{key:2,onClick:t[5]||(t[5]=(...e)=>i.clearSearchQuery&&i.clearSearchQuery(...e)),type:"button",class:"ml-2 text-blue-500 hover:underline focus:outline-none"}," Clear ")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",N,[(0,a.bF)(re,{"current-page":n.currentPage,"total-items":n.totalItems,"total-pages":n.totalPages,"limit-items":n.limitItem,"data-loading":n.loading,"display-mode":"nav",onPageChanged:i.handlePageChanged},null,8,["current-page","total-items","total-pages","limit-items","data-loading","onPageChanged"])])])]),t[10]||(t[10]=(0,a.Lk)("tr",null,[(0,a.Lk)("th",{scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"},"#"),(0,a.Lk)("th",{scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900"},"ชื่อ-นามสกุล"),(0,a.Lk)("th",{scope:"col",class:"hidden md:table-cell px-3 py-3.5 text-left text-sm font-semibold text-gray-900"},"Citizen ID"),(0,a.Lk)("th",{scope:"col",class:"hidden md:table-cell px-3 py-3.5 text-left text-sm font-semibold text-gray-900"},"การติดต่อ"),(0,a.Lk)("th",{scope:"col",class:"hidden md:table-cell px-3 py-3.5 text-left text-sm font-semibold text-gray-900"},"ลงทะเบียน"),(0,a.Lk)("th",{scope:"col",class:"hidden md:table-cell px-3 py-3.5 text-left text-sm font-semibold text-gray-900"},"วันที่ลงทะเบียน"),(0,a.Lk)("th",{scope:"col",class:"w-20 px-3 py-3.5 text-center text-sm font-semibold text-gray-900"},"เครื่องมือ")],-1))]),(0,a.Lk)("tbody",{class:(0,r.C4)(["divide-y divide-gray-200 bg-white relative",[n.activeBlock?"isblock":"isunblock"]]),"data-content":"กำลังติดต่อฐานข้อมูล กรุณารอสักครู่....."},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.filteredListItems,((s,o)=>((0,a.uX)(),(0,a.CE)("tr",{key:s._id},[(0,a.Lk)("td",D,(0,r.v_)((n.currentPage-1)*n.limitItem+o+1),1),(0,a.Lk)("td",M,[(0,a.bF)(le,{to:"/student/detail/"+s._id,class:"text-gray-700 hover:text-indigo-600"},{default:(0,a.k6)((()=>[(0,a.Lk)("span",{innerHTML:s.firstname+" "+s.lastname},null,8,W),t[11]||(t[11]=(0,a.Lk)("br",null,null,-1)),(0,a.Lk)("span",{class:"text-sm font-normal text-gray-500",innerHTML:s.token},null,8,q)])),_:2},1032,["to"])]),(0,a.Lk)("td",U,[(0,a.bF)(de,{icon:["fas","id-card"],class:"text-gray-500 mt-[3px] mr-1 text-md"}),t[12]||(t[12]=(0,a.eW)()),(0,a.Lk)("span",{innerHTML:s.citizen},null,8,J)]),(0,a.Lk)("td",H,[(0,a.bF)(de,{icon:["fas","phone"],class:"text-gray-500 mt-[3px] mr-2 text-md"}),(0,a.Lk)("span",{innerHTML:s.phone},null,8,K),t[13]||(t[13]=(0,a.Lk)("br",null,null,-1)),(0,a.bF)(de,{icon:["fas","envelope"],class:"text-gray-500 mt-[3px] mr-2 text-md"}),(0,a.Lk)("span",{innerHTML:s.email},null,8,B)]),(0,a.Lk)("td",z,[(0,a.Lk)("span",R,(0,r.v_)(s.enroll&&s.enroll.length>0?s.enroll.length:"0"),1),(0,a.bF)(de,{icon:["fas","book"],class:"text-gray-500 mt-[3px] ml-2 text-md"})]),(0,a.Lk)("td",V,(0,r.v_)(i.formatThaidate(s.info.regdate)),1),(0,a.Lk)("td",G,[(0,a.Lk)("div",Y,[(0,a.Lk)("button",{onClick:t=>e.$router.push("/lesson/edit/"+s._id),type:"button",class:"mr-2 inline-flex justify-center rounded-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2"},[(0,a.bF)(de,{icon:["fas","square-pen"],class:"text-black mt-[3px] mr-2 text-md"}),t[14]||(t[14]=(0,a.Lk)("span",null,"แก้ไข",-1))],8,Z),(0,a.Lk)("button",{onClick:t=>e.deleteData(s._id),type:"button",class:"mr-2 hidden md:inline-flex inline-flex justify-center rounded-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2"},[(0,a.bF)(de,{icon:["fas","trash-can"],class:"text-black mt-[3px] mr-2 text-md"}),t[15]||(t[15]=(0,a.Lk)("span",null,"ลบ",-1))],8,ee),(0,a.Lk)("button",{onClick:e=>i.createData(s.old_id),type:"button",class:"mr-2 inline-flex justify-center rounded-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2"},[(0,a.bF)(de,{icon:["fas","link"],class:"text-black mt-[3px] mr-2 text-md"}),t[16]||(t[16]=(0,a.Lk)("span",null,"Sync",-1))],8,te)])])])))),128)),(0,a.Lk)("tr",se,[(0,a.Lk)("td",ae,[(0,a.Lk)("div",oe,[(0,a.bF)(re,{"current-page":n.currentPage,"total-items":n.totalItems,"total-pages":n.totalPages,"limit-items":n.limitItem,"data-loading":n.loading,"display-mode":"summary",onPageChanged:i.handlePageChanged},null,8,["current-page","total-items","total-pages","limit-items","data-loading","onPageChanged"])])])])],2)])])])])])])])])])],64)}s(98992),s(54520),s(72577),s(3949),s(81454),s(14603),s(47566),s(98721);var ie=s(40475),re=s(75435),le=s(87814),de=s(38558),ce=s(9964),ue={data(){const e=ie.A.get("session");return{school:e.current.id,login:e.login,listItems:[],categoryData:[],loading_sources:!0,endpoint:"",master:e.master,accessToken:ie.A.get("session","token"),configs:ie.A.get("configs"),session:ie.A.get("session"),limitItem:100,limitOptions:[10,50,100,200,500,1e3,2e3],currentPage:1,totalPages:0,totalItems:0,loading:!1,showingOverlay:!1,searchQuery:"",statusFilter:"all",isCreatingUser:!1,isShowingOverlay:!1,loadingMessage:"",processingCount:"",activeBlock:!1,debounceTimer:null}},components:{Loader:re.A,Subhead:le.A,Pagination:de.A},methods:{async createData(e){try{this.isCreatingUser=!0,this.isShowingOverlay=!0;let s=this.listItems.length,a=0,o=[];if(e){const t=this.listItems.find((t=>t.old_id===e));t&&(o.push(t),s=1)}else o=this.listItems;for(const e of o){a++,this.loadingMessage="Creating users...",this.processingCount=`${a}/${s}`;try{const s=`https://faas-sgp1-18bc02ac.doserverless.co/api/v1/web/fn-3bf765c8-bb4f-4bac-ba41-9698000f7334/default/getstudentdata?id=${e.old_id}`,a=await fetch(s),o=await a.json(),n=o.enroll,i=[{lessonId:"195",value:"646399b1db2e5913d490fdc1",measure:"38",first:{create:"2022-03-21 00:00:00",expire:"2027-03-20 00:00:00"},second:{create:"2022-03-30 00:00:00",expire:"2027-03-29 00:00:00"}},{lessonId:"215",value:"646399b3db2e5913d490fdc2",measure:"38",first:{create:"2022-06-15 00:00:00",expire:"2027-06-14 00:00:00"},second:{create:"2022-05-31 00:00:00",expire:"2027-05-30 00:00:00"}},{lessonId:"219",value:"646399b5db2e5913d490fdc3",measure:"38",first:{create:"2022-08-15 00:00:00",expire:"2027-08-16 00:00:00"},second:{create:"2022-08-30 00:00:00",expire:"2022-08-30 00:00:00"}},{lessonId:"220",value:"646399b6db2e5913d490fdc4",measure:"33",first:{create:"2023-02-28 00:00:00",expire:"2028-02-27 00:00:00"},second:{create:"2023-03-17 00:00:00",expire:"2028-03-16 00:00:00"}},{lessonId:"223",value:"646399b8db2e5913d490fdc5",measure:"33",first:{create:"",expire:""},second:{create:"",expire:""}}],r=[{id:"1",value:"สั่งซื้อ",measure:"38"},{id:"2",value:"แจ้งโอน",measure:"38"},{id:"3",value:"อนุมัติ",measure:"38"},{id:"4",value:"ยกเลิก",measure:"33"},{id:"5",value:"รออนุมัติ",measure:"33"},{id:"6",value:"ส่งเอกสารแล้ว",measure:"33"},{id:"7",value:"ผ่านการพิจารณา",measure:"33"},{id:"8",value:"ลงทะเบียนคอร์ส",measure:"33"}];for(const l in n)if(Object.prototype.hasOwnProperty.call(n,l)){const s=n[l],a={data:{courseID:i.find((e=>e.lessonId===s.lesson_id))?.value,userID:e._id,price:s.order_price,payment:s.order_payment,ref:s.order_ref,ref1:s.order_ref1,ref2:s.order_ref2,ref3:s.order_ref3,ref_no:s.order_ref_no,token:s.order_token,type:s.order_type,code:s.order_code,approve:s.order_approve,adddate:s.order_adddate,approve_date:s.order_approve_date,confirmdate:s.order_confirmdate,status:r.find((e=>e.id===s.order_status))?.value,address:{delivery:{address:s.order_delivery_address,email:s.order_delivery_email,name:s.order_delivery_name,phone:s.order_delivery_phone,province:s.order_delivery_province_name,zipcode:s.order_delivery_zipcode},invoice:{address:s.order_invoice_address,email:s.order_invoice_email,name:s.order_invoice_name,phone:s.order_invoice_phone,province:s.order_invoice_province_name,zipcode:s.order_invoice_zipcode},tax:{address:s.order_tax_address,email:s.order_tax_email,name:s.order_tax_name,phone:s.order_tax_phone,province:s.order_tax_province_name,zipcode:s.order_tax_zipcode}}},options:{fieldType:[]}};try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/order/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{courseID:i.find((e=>e.lessonId===s.lesson_id))?.value,userID:e._id}]}]})}),o=await t.json();if(0===Object.keys(o).length){const t=await fetch("https://gateway.cloudrestfulapi.com/api/order/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify(a)}),s=await t.json();200===t.status?(await fetch("https://gateway.cloudrestfulapi.com/api/user/"+e._id+"/order",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({action:"add",element:s._id,type:"string"})}),console.log("Order created successfully")):console.log("Error creating order")}else console.log("มีออเดอร์แล้ว")}catch(t){console.log("Error creating user"),console.error(t)}await new Promise((e=>setTimeout(e,1e3)));const o=Number(s.additional.progress),d=s.additional.cert_area,c=s.additional.exam_round,u={data:{courseID:i.find((e=>e.lessonId===s.lesson_id))?.value,userID:e._id,analytics:{total:13,pending:0,processing:0,complete:o,status:13===o?"complete":o<13&&o>0?"processing":"pending",message:13===o?"เรียนจบแล้ว":o<13&&o>0?"กำลังเรียน":"ยังไม่ได้เรียน",post:{req:!0,has:!0,measure:i.find((e=>e.lessonId===s.lesson_id))?.measure,score:s.additional.posttest,result:s.additional.posttest>=i.find((e=>e.lessonId===s.lesson_id))?.measure,message:s.additional.posttest>=i.find((e=>e.lessonId===s.lesson_id))?.measure?"ผ่านการรับรอง":"ไม่ผ่านการรับรอง"},pre:{req:!0,has:!0,measure:i.find((e=>e.lessonId===s.lesson_id))?.measure,score:s.additional.pretest,result:s.additional.pretest>=i.find((e=>e.lessonId===s.lesson_id))?.measure,message:s.additional.pretest>=i.find((e=>e.lessonId===s.lesson_id))?.measure?"ผ่านการรับรอง":"ไม่ผ่านการรับรอง"},retest:{req:!0,has:!0,measure:i.find((e=>e.lessonId===s.lesson_id))?.measure,score:s.additional.retest,result:s.additional.retest>=i.find((e=>e.lessonId===s.lesson_id))?.measure,message:s.additional.retest>=i.find((e=>e.lessonId===s.lesson_id))?.measure?"ผ่านการรับรอง":"ไม่ผ่านการรับรอง"},option:{cert_age:s.additional.cert_age,cert_area:d||s.additional.option.cert_area,exam_round:c||s.additional.option.exam_round,get_receipt:s.additional.get_receipt}}},options:{fieldType:[]}};try{const a=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{courseID:i.find((e=>e.lessonId===s.lesson_id))?.value,userID:e._id}]}]})}),o=await a.json();if(0===Object.keys(o).length){const a=await fetch("https://gateway.cloudrestfulapi.com/api/enroll/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify(u)}),o=await a.json();if(console.log(o),200===a.status){await fetch("https://gateway.cloudrestfulapi.com/api/user/"+e._id+"/enroll",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({action:"add",element:o._id,type:"string"})});const a=s.additional.posttest>=i.find((e=>e.lessonId===s.lesson_id))?.measure,n=s.additional.retest>=i.find((e=>e.lessonId===s.lesson_id))?.measure;if(a||n){const a=c||s.additional.option.exam_round;console.log(a);const n={data:{courseID:i.find((e=>e.lessonId===s.lesson_id))?.value,userID:e._id,create:"first"===a?i.find((e=>e.lessonId===s.lesson_id))?.first?.create:i.find((e=>e.lessonId===s.lesson_id))?.second?.create,expire:"first"===a?i.find((e=>e.lessonId===s.lesson_id))?.first?.expire:i.find((e=>e.lessonId===s.lesson_id))?.second?.expire},options:{fieldType:[]}};try{const t=await fetch("https://gateway.cloudrestfulapi.com/api/certification/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{courseID:i.find((e=>e.lessonId===s.lesson_id))?.value,userID:e._id}]}]})}),a=await t.json();if(0===Object.keys(a).length){const t=await fetch("https://gateway.cloudrestfulapi.com/api/certification/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify(n)}),s=await t.json();console.log(s),200===t.status?(await fetch("https://gateway.cloudrestfulapi.com/api/user/"+e._id+"/certification",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({action:"add",element:s._id,type:"string"})}),await fetch("https://gateway.cloudrestfulapi.com/api/enroll/"+o._id+"/certification",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({action:"add",element:s._id,type:"string"})}),console.log("Certification created successfully")):console.log("Error creating Certification")}else console.log("มีใบรับรองแล้ว")}catch(t){console.log("Error creating user"),console.error(t)}await new Promise((e=>setTimeout(e,1e3)))}console.log("Enroll created successfully")}else console.log("Error creating Enroll")}else console.log("ลงทะเบียนหลักสูตรนี้แล้ว")}catch(t){console.log("Error creating user"),console.error(t)}await new Promise((e=>setTimeout(e,1e3)))}}catch(t){console.log(t)}}this.loadingMessage="Users created successfully!",this.processingCount=`${s}/${s}`,this.isCreatingUser=!1,setTimeout((()=>{this.isShowingOverlay=!1}),2e3)}catch(t){console.error(t)}},formatThaidate(e){return ce.A.toThaiDatetime(e,"short")},handleLimitChange(){const e=ie.A.get("session");e.limitItem=this.limitItem,ie.A.set("session",e),this.currentPage=1,e.currentPage=this.currentPage,ie.A.set("session",e);const t=new URLSearchParams(window.location.search);t.set("page",e.currentPage);const s=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",s),this.getData()},handlePageChanged(e){window.scrollTo(0,0),this.currentPage=e;const t=ie.A.get("session");t.currentPage=this.currentPage,ie.A.set("session",t),this.getData()},clearSearchQuery(){this.searchQuery="";const e=ie.A.get("session");e.searchQuery="",ie.A.set("session",e),this.getData()},async callAPI(e){try{const t=`https://faas-sgp1-18bc02ac.doserverless.co/api/v1/web/fn-3bf765c8-bb4f-4bac-ba41-9698000f7334/default/getstudentdata?id=${e}`,s=await fetch(t),a=await s.json();console.log(a)}catch(t){console.log(t)}},async getData(){if(console.log("getData",this.login),this.login)try{console.log("School",this.school),this.loading=!0,this.activeBlock=!0;let e=[{parent:this.session.current._id}];this.searchQuery&&e.push({$or:[{name:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{citizen:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{email:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{firstname:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{lastname:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{old_id:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{phone:{$regex:`.*${this.searchQuery}.*`,$options:"i"}},{token:{$regex:`.*${this.searchQuery}.*`,$options:"i"}}]}),"all"!==this.statusFilter&&e.push({status:this.statusFilter});const t={$and:e},s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({method:"find",args:[t],paging:{page:1,limit:this.limitItem}})};this.searchQuery||(s.body=JSON.stringify({method:"find",args:[t],paging:{page:this.currentPage,limit:this.limitItem}}));const a=await fetch("https://gateway.cloudrestfulapi.com/api/user/query",s),o=await a.json();console.log("Get School",o),o&&(this.currentPage=o.paging.page,this.totalPages=o.paging.totalPages,this.totalItems=o.total,this.listItems=o.data.map((e=>{const t={...e};return Object.keys(t).forEach((e=>{const s=t[e];if("string"===typeof s){const a=s.toLowerCase(),o=this.searchQuery.toLowerCase(),n=a.indexOf(o);if(-1!==n&&o.length>0){const a=n+o.length,i=s.substring(0,n)+'<span class="text-red-500 font-bold">'+s.substring(n,a)+"</span>"+s.substring(a);t[e]=i}}})),t})).filter((e=>{const t=Object.values(e).join("").toLowerCase(),s=this.searchQuery.toLowerCase();return t.includes(s)||0===s.length})),this.loading=!1,this.activeBlock=!1)}catch(e){console.log(e)}},toggleStatus(e){console.log("Toggle Status",e),this.statusFilter=e,this.getData()}},async mounted(){try{const e=new URLSearchParams(window.location.search),t=e.get("page");if(t&&/^\d+$/.test(t))this.currentPage=parseInt(t);else{const e=ie.A.get("session");if(e&&e.currentPage){this.currentPage=e.currentPage;const t=new URLSearchParams(window.location.search);t.set("page",e.currentPage);const s=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",s)}}const s=ie.A.get("session");s&&s.searchQuery&&(this.searchQuery=s.searchQuery);const a=s.limitItem;a&&(this.limitItem=a),await this.getData()}catch(e){console.log(Error)}},setup(){},watch:{searchQuery(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((()=>{this.getData();const e=ie.A.get("session");e.searchQuery=this.searchQuery,ie.A.set("session",e),this.currentPage=1;const t=new URLSearchParams(window.location.search);t.set("page",e.currentPage);const s=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",s)}),500)}},computed:{filteredListItems(){return"All"===this.selectedStatus?this.listItems:this.listItems.filter((e=>e.status===this.selectedStatus))}}},ge=s(64621);const me=(0,ge.A)(ue,[["render",ne]]);var pe=me,he={name:"Home",components:{List:pe},data(){return{login:ie.A.get("session","login")}},methods:{showAlert(){this.$swal("Hello Vue world!!!")}},setup(){const e=(0,i.lq)(),t=e.meta.title;(0,n.K7)(t)}};const ye=(0,ge.A)(he,[["render",o]]);var fe=ye},87814:function(e,t,s){s.d(t,{A:function(){return T}});var a=s(20641),o=s(90033),n=s(53751);const i={class:"py-2 bg-white border-l border-r border-b border-1 border-gray-200"},r={class:"mx-auto px-2 sm:px-6 lg:px-6 xl:flex xl:items-center xl:justify-between"},l={class:"min-w-0 flex-1"},d={class:"mt-1 text-[18px] font-semibold leading-8 text-gray-700"},c={key:0,class:"text-sm text-gray-500"},u={class:"mt-5 flex xl:mt-0 xl:ml-4"},g={class:"flex items-center space-x-2"},m={class:"text-sm text-gray-400"},p=["onUpdate:modelValue","placeholder","onChange"],h={value:"",disabled:""},y=["value"],f=["onClick"],b={class:"text-sm hidden sm:inline-block ml-1"},x=["onClick"],k={class:"text-sm hidden sm:inline-block ml-1"};function v(e,t,s,v,w,_){const C=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)("header",i,[(0,a.Lk)("div",r,[(0,a.Lk)("div",l,[(0,a.Lk)("h1",d,[(0,a.bF)(C,{icon:["fas",this.PageIcon],class:"text-gray-500 text-[18px]"},null,8,["icon"]),(0,a.eW)(" "+(0,o.v_)(s.pageTitle?s.pageTitle:this.PageName),1)]),s.subhead?((0,a.uX)(),(0,a.CE)("p",c,(0,o.v_)(s.subhead),1)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",u,[(0,a.Lk)("div",g,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.navigation,((t,s)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:s},["select"===t.type?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.Lk)("label",m,(0,o.v_)(t.placeholder),1),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":e=>t.value=e,class:"block w-36 py-2 px-3 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-md",placeholder:t.placeholder,onChange:s=>e.$emit("toggleStatus",t.value)},[(0,a.Lk)("option",h,"-- "+(0,o.v_)(t.placeholder)+" --",1),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.options,((e,t)=>((0,a.uX)(),(0,a.CE)("option",{key:t,value:e.value},(0,o.v_)(e.name),9,y)))),128))],40,p),[[n.u1,t.value]])],64)):"call-function"===t.type?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[!1!==t.visible?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:s=>e.$emit(t.function),type:"button",class:(0,o.C4)(_.getClasses(t.class))},[(0,a.bF)(C,{icon:["fas",`${t.style}`],class:(0,o.C4)({"text-gray-500 mr-2":"icon-btn"===t.class,"text-white":"primary-btn"===t.class})},null,8,["icon","class"]),(0,a.Lk)("span",b,(0,o.v_)(t.name),1)],10,f)):(0,a.Q3)("",!0)],64)):((0,a.uX)(),(0,a.CE)(a.FK,{key:2},[!1!==t.visible?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:e=>_.handleNavigationClick(t),type:"button",class:(0,o.C4)(_.getClasses(t.class))},[(0,a.bF)(C,{icon:["fas",`${t.style}`],class:(0,o.C4)({"text-gray-500 mr-2":"icon-btn"===t.class,"text-white":"primary-btn"===t.class})},null,8,["icon","class"]),(0,a.Lk)("span",k,(0,o.v_)(t.name),1)],10,x)):(0,a.Q3)("",!0)],64))],64)))),128))])])])])}s(44114);var w=s(75220),_=s(52968),C=s(23264),L=s(93426),P={props:{navigation:{type:Array,default:()=>[]},pageTitle:{type:String,default:()=>null},subhead:{type:String,default:()=>null}},data(){const e=(0,w.lq)();return console.log("Translate",(0,L.Tl)("router-"+e.meta.parent+"-"+e.meta.key)),{PageName:(0,L.iX)(),PageIcon:e.meta.icon,PagePath:e.meta.path,ParentName:e.meta.parent,ParentPage:e.meta.page}},setup(){(0,_.K7)((0,L.iX)())},methods:{getClasses(e){const t=(0,C.c)(e);return`${t}`},handleNavigationClick(e){e.function?this.$emit(e.eventName||e.function):this.$router.push(e.link)}}},I=s(64621);const S=(0,I.A)(P,[["render",v]]);var T=S},38558:function(e,t,s){s.d(t,{A:function(){return T}});var a=s(20641),o=s(90033);const n={class:"flex flex-col justify-center items-center h-full"},i={key:0,class:"flex flex-wrap justify-center"},r=["disabled"],l={key:0,class:"font-medium"},d=["disabled"],c=["onClick","disabled"],u={key:1,class:"font-medium"},g=["disabled"],m=["disabled"],p={key:1,class:"text-sm text-gray-400 text-center"},h={class:"font-medium"},y={class:"text-gray-600"},f={class:"font-medium"},b={class:"text-gray-600"},x={class:"font-medium"},k={class:"text-gray-600"},v={class:"font-medium"},w={class:"text-gray-600"};function _(e,t,s,_,C,L){const P=(0,a.g2)("font-awesome-icon");return(0,a.uX)(),(0,a.CE)("div",n,["nav"===s.displayMode||"full"===s.displayMode?((0,a.uX)(),(0,a.CE)("ul",i,[(0,a.Lk)("li",{class:(0,o.C4)({"opacity-50 cursor-not-allowed":1===C.activePage})},[(0,a.Lk)("button",{onClick:t[0]||(t[0]=e=>L.handleButtonClick(C.activePage-1)),disabled:s.dataLoading||C.buttonClicked,class:"block px-2 py-2 rounded-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"},[(0,a.bF)(P,{icon:["fas","chevron-left"],class:"text-gray-700 pl-1 pr-1 text-md"})],8,r)],2),C.activePage>2?((0,a.uX)(),(0,a.CE)("li",l,[(0,a.Lk)("button",{onClick:t[1]||(t[1]=e=>L.handleButtonClick(1)),disabled:s.dataLoading||C.buttonClicked,class:"block px-2 py-2 ml-1 mr-1 text-sm text-gray-700 rounded-md hover:bg-indigo-100"}," หน้าแรก ",8,d)])):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(L.pages,(e=>((0,a.uX)(),(0,a.CE)("li",{key:e,class:(0,o.C4)([{"bg-indigo-100 ml-1 mr-1 rounded-md border-indigo-500 text-indigo-600 font-semibold":C.activePage===e},"font-medium"])},[(0,a.Lk)("button",{onClick:t=>L.handleButtonClick(e),disabled:s.dataLoading||C.buttonClicked,class:"block px-2 py-2 ml-1 mr-1 text-sm text-gray-700 rounded-md hover:bg-indigo-100"},(0,o.v_)(e.toString().padStart(2,"0")),9,c)],2)))),128)),C.activePage<s.totalPages-1?((0,a.uX)(),(0,a.CE)("li",u,[(0,a.Lk)("button",{onClick:t[2]||(t[2]=e=>L.handleButtonClick(s.totalPages)),disabled:s.dataLoading||C.buttonClicked,class:"block px-2 py-2 ml-1 mr-1 text-sm text-gray-700 rounded-md hover:bg-indigo-100"}," หน้าสุดท้าย ",8,g)])):(0,a.Q3)("",!0),(0,a.Lk)("li",{class:(0,o.C4)({"opacity-50 cursor-not-allowed":C.activePage===s.totalPages})},[(0,a.Lk)("button",{onClick:t[3]||(t[3]=e=>L.handleButtonClick(C.activePage+1)),disabled:s.dataLoading||C.buttonClicked,class:"block px-2 py-2 rounded-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"},[(0,a.bF)(P,{icon:["fas","chevron-right"],class:"text-gray-700 pl-1 pr-1 text-md"})],8,m)],2)])):(0,a.Q3)("",!0),"summary"===s.displayMode||"full"===s.displayMode?((0,a.uX)(),(0,a.CE)("div",p,[(0,a.eW)((0,o.v_)(L.translate("paging-display"))+" ",1),(0,a.Lk)("span",h,[(0,a.Lk)("span",y,(0,o.v_)(L.startItem),1)]),(0,a.eW)(" "+(0,o.v_)(L.translate("paging-to"))+" ",1),(0,a.Lk)("span",f,[(0,a.Lk)("span",b,(0,o.v_)(L.endItem),1)]),t[4]||(t[4]=(0,a.eW)(" / ")),(0,a.Lk)("span",x,[(0,a.Lk)("span",k,(0,o.v_)(L.formatNumber(s.totalPages)),1)]),(0,a.eW)(" "+(0,o.v_)(L.translate("paging-page"))+" | "+(0,o.v_)(L.translate("paging-from"))+" ",1),(0,a.Lk)("span",v,[(0,a.Lk)("span",w,(0,o.v_)(L.formatNumber(s.totalItems)),1)]),(0,a.eW)(" "+(0,o.v_)(L.translate("paging-item")),1)])):(0,a.Q3)("",!0)])}s(44114),s(14603),s(47566),s(98721);var C=s(9964),L=s(93426),P={props:{currentPage:{type:Number,required:!0},dataLoading:{type:Boolean,required:!0},displayMode:{type:String,required:!0,default:"full"},totalPages:{type:Number,required:!0},totalItems:{type:Number,required:!0},limitItems:{type:Number,required:!0}},data(){return{activePage:this.currentPage,buttonClicked:!1}},computed:{pages(){if(window.innerWidth>=600){const e=Math.max(this.activePage-2,1),t=Math.min(this.activePage+2,this.totalPages);let s=[];for(let a=e;a<=t;a++)s.push(a);return s}{let e=Math.max(this.activePage-1,1),t=Math.min(e+2,this.totalPages);t-e<2&&(e=Math.max(t-2,1));let s=[];for(let a=e;a<=t;a++)s.push(a);return s}},startItem(){return(this.activePage-1)*this.limitItems+1},endItem(){return Math.min(this.activePage*this.limitItems,this.totalItems)}},methods:{translate:L.Tl,formatNumber(e){return C.A.formatNumber(e,"short")},goToPage(e){if(e<1||e>this.totalPages)return;const t=new URLSearchParams(window.location.search),s=t.get("searchQuery");let a="";e>1&&s?a=`?page=${e}&searchQuery=${s}`:e>1?a=`?page=${e}`:s&&(a=`?searchQuery=${s}`);const o=`${window.location.pathname}${a||""}`;window.history.pushState({path:o},"",o),this.activePage=e,this.$emit("page-changed",e)},handleButtonClick(e){this.buttonClicked||(this.buttonClicked=!0,this.goToPage(e),setTimeout((()=>{this.buttonClicked=!1}),1e3))}},watch:{currentPage(e){this.activePage=e},activePage(e){this.$emit("page-changed",e)},$route(){}},created(){const e=new URLSearchParams(window.location.search),t=e.get("page");if(t){const e=parseInt(t);isNaN(e)||this.goToPage(e)}}},I=s(64621);const S=(0,I.A)(P,[["render",_]]);var T=S},23264:function(e,t,s){function a(e){switch(e){case"input-plaintext":return"pl-0 focus:outline-none focus:ring-0 shadow-none border-0";case"primary-btn":return"px-4 py-2 text-white bg-blue-600 rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-50";case"icon-btn":return"px-4 py-2 text-gray-700 bg-transparent hover:bg-transparent hover:text-gray-800";case"default-btn":return"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 focus:ring-offset-gray-50";case"danger-btn":return"px-4 py-2 text-white bg-red-600 rounded-md shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-gray-50";case"success-btn":return"px-4 py-2 text-white bg-green-600 rounded-md shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-gray-50";default:return""}}s.d(t,{c:function(){return a}})}}]);
//# sourceMappingURL=5212.973e2470.js.map