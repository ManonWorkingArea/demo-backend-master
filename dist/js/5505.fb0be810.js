"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[5505],{5505:function(e,t,s){s.r(t),s.d(t,{default:function(){return H}});var o=s(20641);function i(e,t,s,i,n,a){return(0,o.uX)(),(0,o.Wv)((0,o.$y)(a.componentName))}var n=s(52968),a=s(75220),r=s(40475);function l(e,t){return(0,o.uX)(),(0,o.CE)("div")}var d=s(64621);const c={},u=(0,d.A)(c,[["render",l]]);var p=u,m=s(90033),h=s(53751);const f={class:"bg-gray-100"},g={class:"bg-gray-100 py-6"},y={class:"text-2xl text-center font-semibold text-gray-800 mb-6"},b={class:"border rounded-lg p-2 mb-6 flex items-center"},k=["src"],v={class:"text-gray-600 font-medium mb-1"},x={class:"text-gray-600 font-medium text-sm mb-1"},w={class:"mb-5"},L={class:"space-y-3 text-sm font-medium text-gray-500"},C={class:"flex justify-between"},D={class:"text-gray-900"},P={class:"flex justify-between border-t border-gray-200 pt-2 text-gray-900"},I={class:"text-base"},_={class:"flex items-center mb-4"},A={key:0},S={class:"mb-8"},T={class:"grid grid-cols-2 gap-2"},j={class:"col-span-2"},M={class:"space-y-2"},O=["onClick"],$=["id","value"],N=["for"],z={class:"text-gray-500 text-sm ml-auto"},J={class:"mt-8 text-center"};function V(e,t,s,i,n,a){const r=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",f,[(0,o.Lk)("div",g,[(0,o.Lk)("div",{class:(0,m.C4)(["mx-auto sm:w-2/6 w-full bg-white p-4 rounded-lg shadow-md relative",[n.activeBlock?"isblock":"isunblock"]]),"data-content":"กำลังติดต่อฐานข้อมูล กรุณารอสักครู่....."},[(0,o.Lk)("h2",y,[(0,o.bF)(r,{icon:["fas","shopping-bag"]}),t[11]||(t[11]=(0,o.eW)(" ชำระเงิน"))]),t[21]||(t[21]=(0,o.Lk)("h2",{class:"text-md p-1 pl-2 font-normal bg-indigo-800 text-white mb-4"},"รายละเอียดหลักสูตรที่สมัคร",-1)),(0,o.Lk)("div",b,[(0,o.Lk)("img",{src:n.lesson.cover||n.defaultCoverUrl,alt:"Product Image",class:"w-14 h-14 mr-4 rounded-md"},null,8,k),(0,o.Lk)("div",null,[(0,o.Lk)("p",v,(0,m.v_)(this.lesson.name),1),(0,o.Lk)("p",x,"ราคา: "+(0,m.v_)(this.finalPrice(this.lesson.regular_price,this.lesson.sale_price))+" ฿",1),t[12]||(t[12]=(0,o.Lk)("p",{class:"text-gray-600 font-medium text-sm mb-1"},"จำนวน: 1",-1))])]),(0,o.Lk)("div",w,[(0,o.Lk)("dl",L,[(0,o.Lk)("div",C,[t[13]||(t[13]=(0,o.Lk)("dt",null,"ราคา",-1)),(0,o.Lk)("dd",D,(0,m.v_)(this.finalPrice(this.lesson.regular_price,this.lesson.sale_price))+" ฿",1)]),t[15]||(t[15]=(0,o.Lk)("div",{class:"flex justify-between"},[(0,o.Lk)("dt",null,"ส่วนลด"),(0,o.Lk)("dd",{class:"text-gray-900"},"0")],-1)),(0,o.Lk)("div",P,[t[14]||(t[14]=(0,o.Lk)("dt",{class:"font-bold"},"ยอดชำระรวม",-1)),(0,o.Lk)("dd",I,(0,m.v_)(this.finalPrice(this.lesson.regular_price,this.lesson.sale_price))+" ฿",1)])])]),(0,o.Lk)("div",_,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>n.showCustomerData=e),class:"h-5 w-5 text-indigo-600 border-gray-300 focus:ring-indigo-200"},null,512),[[h.lH,n.showCustomerData]]),t[16]||(t[16]=(0,o.Lk)("label",{for:"show-customer-data",class:"ml-3 text-gray-800 font-semibold"},"ต้องการใบเสร็จรับเงินตัวจริง",-1))]),n.showCustomerData?((0,o.uX)(),(0,o.CE)("div",A,[t[17]||(t[17]=(0,o.Lk)("h2",{class:"text-md p-1 pl-2 font-normal bg-indigo-800 text-white mb-4"},"ข้อมูลผู้อบรม",-1)),(0,o.Lk)("form",S,[(0,o.Lk)("div",T,[(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.firstname=e),type:"text",id:"first-name",name:"first-name",placeholder:"ชื่อ",class:"w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring focus:border-indigo-600"},null,512),[[h.Jo,n.firstname]])]),(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.lastname=e),type:"text",id:"last-name",name:"last-name",placeholder:"นามสกุล",class:"w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring focus:border-indigo-600"},null,512),[[h.Jo,n.lastname]])]),(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>n.phone=e),type:"text",id:"phone",name:"phone",placeholder:"เบอร์โทรศัพท์",class:"w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring focus:border-indigo-600"},null,512),[[h.Jo,n.phone]])]),(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.email=e),type:"email",id:"email",name:"email",placeholder:"อีเมล",class:"w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring focus:border-indigo-600"},null,512),[[h.Jo,n.email]])]),(0,o.Lk)("div",j,[(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[5]||(t[5]=e=>n.address=e),id:"address",name:"address",placeholder:"ที่อยู่",class:"w-full h-32 border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring focus:border-indigo-600"},null,512),[[h.Jo,n.address]])]),(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>n.province=e),type:"text",id:"province",name:"province",placeholder:"จังหวัด",class:"w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring focus:border-indigo-600"},null,512),[[h.Jo,n.province]])]),(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>n.zipcode=e),type:"text",id:"zip-code",name:"zip-code",placeholder:"รหัสไปรษณีย์",class:"w-full border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring focus:border-indigo-600"},null,512),[[h.Jo,n.zipcode]])])])])])):(0,o.Q3)("",!0),(0,o.Lk)("div",null,[t[18]||(t[18]=(0,o.Lk)("h2",{class:"text-md p-1 pl-2 font-normal bg-indigo-800 text-white mb-4"},"ช่องทางการชำระเงิน",-1)),(0,o.Lk)("div",M,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.paymentMethods,((e,s)=>((0,o.uX)(),(0,o.CE)("div",{key:s,class:(0,m.C4)(["flex","items-center","p-4","border","rounded-lg","hover:border-indigo-600",{"border-indigo-600":n.selectedPaymentMethod===e.code}]),onClick:t=>a.selectPaymentMethod(e.code)},[(0,o.bo)((0,o.Lk)("input",{type:"radio",id:"payment-method-"+e.code,name:"payment-method",value:e.code,"onUpdate:modelValue":t[8]||(t[8]=e=>n.selectedPaymentMethod=e),class:"h-5 w-5 text-indigo-600 border-gray-300 focus:ring-indigo-200"},null,8,$),[[h.XL,n.selectedPaymentMethod]]),(0,o.Lk)("label",{for:"payment-method-"+e.code,class:"ml-3 text-gray-800 font-semibold"},(0,m.v_)(e.name),9,N),(0,o.Lk)("p",z,(0,m.v_)(e.description),1)],10,O)))),128))])]),(0,o.Lk)("div",J,[(0,o.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>a.subscribeCourse&&a.subscribeCourse(...e)),class:"bg-black hover:bg-gray-700 text-white py-3 px-6 rounded-md font-semibold focus:outline-none focus:ring focus:border-indigo-700"},[(0,o.bF)(r,{icon:["fas","check-circle"]}),t[19]||(t[19]=(0,o.eW)(" ยืนยันการลงทะเบียน "))]),(0,o.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>a.backCourse&&a.backCourse(...e)),class:"bg-white hover:bg-gray-100 text-black py-3 px-6 rounded-md focus:outline-none focus:ring focus:border-indigo-700 ml-2"},[(0,o.bF)(r,{icon:["fas","home"]}),t[20]||(t[20]=(0,o.eW)(" กลับหน้าหลักสูตร "))])])],2)])])}s(44114),s(98992),s(72577),s(81454),s(37550);var B=s(9964),U=s(57313);const E=[{name:"pending",label:"รอเรียน",styleClass:"bg-gray-300 text-gray-600",icon:"hourglass-start"},{name:"processing",label:"กำลังเรียน",styleClass:"bg-yellow-300 text-yellow-800",icon:"spinner"},{name:"complete",label:"เรียนจบแล้ว",styleClass:"bg-green-300 text-green-800",icon:"check"}];function q(e){const t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let s="";for(let o=0;o<e;o++){const e=Math.floor(Math.random()*t.length);s+=t.charAt(e)}return s}function X(e){const t=(new Date).getTime().toString(),s=e+t.substr(-6);return s}var F={name:"Lesson Detail",components:{},data(){return{defaultCoverUrl:"https://vue-project.sgp1.digitaloceanspaces.com/default-coverjpg.jpg",uniqueVisitors:null,pageViewsPerDay:null,pageViewsPerWeek:null,pageViewsPerMonth:null,activeBlock:!1,login:r.A.get("session","login"),configs:r.A.get("configs"),session:r.A.get("session"),dataItem:this.$route.params.id,enroll:r.A.get("session","enroll"),deviceType:U.A.deviceDetect(),playOption:"step",certification:[],exam:[],lesson:[],players:[],paymentMethods:[{code:"bill_payment",name:"Bill Payment",description:"ชำระผ่าน QR Code (อนุมัติ 1-2 วันทำการ)"},{code:"transfer",name:"Bank Transfer",description:"โอนเงินเข้าบัญชีธนาคาร (อนุมัติ 2-4 วันทำการ)"}],selectedPaymentMethod:"bill_payment",showCustomerData:!1,firstname:"",lastname:"",phone:"",email:"",address:"",province:"",zipcode:""}},methods:{backCourse(){this.$router.push("/lesson/detail/"+this.dataItem)},selectPaymentMethod(e){this.selectedPaymentMethod=this.paymentMethods[e].name},handleLoginSuccess(){console.log("Login Success")},getStatus(e){const t=E.find((t=>t.name===e));return t?`<p class="inline-flex rounded-full px-2 text-xs font-semibold leading-5 capitalize ${t.styleClass}">\n                <i class="fa fa-${t.icon} mr-1 mt-1"></i>${t.label}\n                </p>`:""},checkExam(e){return this.exam.some((t=>t.type===e))},formatSeconds(e){return B.A.secondsToTime(e)},formatThaidate(e){return B.A.toThaiDatetime(e)},formatPrice(e,t){return B.A.formatPrice(e,t)},finalPrice(e,t){const s=t||e;return s},async getData(){try{this.loading_sources=!1;const e=await fetch("https://gateway.cloudrestfulapi.com/api/course/"+this.dataItem,{method:"GET",headers:{"Content-Type":"application/json","client-token-key":this.configs.key}}),t=await e.json();if(200===e.status){this.lesson=t,this.playOption=t.display;const e=await fetch("https://gateway.cloudrestfulapi.com/api/certification/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{userID:this.session.userID,courseID:this.dataItem}]}]})}),s=await e.json();this.certification=s;const o=await fetch("https://gateway.cloudrestfulapi.com/api/exam/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{courseId:t.master}]}]})}),i=await o.json();if(200===o.status){const e=await Promise.all(i.map((async e=>{const t=await fetch("https://gateway.cloudrestfulapi.com/api/score/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{userID:this.session.userID,examID:e._id,courseID:this.dataItem}]}]})}),s=await t.json();return{...e,score:s[0]}})));this.login?this.exam=e:this.exam=i;const s=await fetch("https://gateway.cloudrestfulapi.com/api/player/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",hidden:["lecturer","updatedAt"],args:[{$and:[{courseId:t.master}]}]})}),o=await s.json();if(200===s.status)if(this.login){const{id:e}=this.$route.params,{userID:t}=this.session,s=await fetch("https://gateway.cloudrestfulapi.com/api/progress/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{$and:[{courseID:e,userID:t}]}]})}),i=await s.json();if(200===s.status){this.progressArray=i;const e=this.$route.params.pid,t=o.find((t=>t._id===e));this.players=o,this.player=t,this.players=this.players.map((e=>{const t=this.progressArray.find((t=>t.playerID===e._id));return t?{...e,progress:t}:e})),this.$setPageTitle("Subscribe หลักสูตร "+this.lesson.name)}}else this.players=o,this.$setPageTitle("Subscribe หลักสูตร "+this.lesson.name)}}}catch(e){console.log(e)}},async subscribeCourse(){if(this.activeBlock=!0,this.showCustomerData){const e=this.firstname,t=this.lastname,s=this.phone,o=this.email,i=this.address,n=this.province,a=this.zipcode;if(""===e.trim()||""===t.trim()||""===s.trim()||""===o.trim()||""===i.trim()||""===n.trim()||""===a.trim())return alert("Please fill in all required fields."),void(this.activeBlock=!1)}const e=q(20),t=X("88011"),s=q(32),o=q(10),i={unit:this.configs.siteID,courseID:this.lesson._id,userID:this.session.userID,price:this.finalPrice(this.lesson.regular_price,this.lesson.sale_price),payment:this.selectedPaymentMethod,ref:e,ref1:"103-97-017",ref2:"3670200432621",ref3:t,ref_no:s,token:o,type:"lesson",code:o,approve:"manual",adddate:(new Date).toISOString(),approve_date:null,confirmdate:null,status:"ลงทะเบียนคอร์ส",address:{delivery:{address:this.address,email:this.email,name:this.firstName+" "+this.lastName,phone:this.phone,province:this.province,zipcode:this.zipCode},invoice:{address:this.address,email:this.email,name:this.firstName+" "+this.lastName,phone:this.phone,province:this.province,zipcode:this.zipCode},tax:{address:this.address,email:this.email,name:this.firstName+" "+this.lastName,phone:this.phone,province:this.province,zipcode:this.zipCode}},createdAt:(new Date).toISOString()},n={data:i};try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/order/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify(n)}),t=await e.json();200===e.status?(this.activeBlock=!1,this.$router.push("/lesson/pay/"+t._id)):(this.activeBlock=!1,alert("Error: Course registration and payment failed."))}catch(a){this.activeBlock=!1,console.error("Error:",a),alert("An error occurred. Please try again later.")}}},async mounted(){try{await this.getData()}catch(e){console.log(Error)}},setup(){},computed:{loggedInComputed(){const e=r.A.get("session","login"),t=r.A.get("session","enroll");return e?{enrollAccess(e){if(!t||0===t.length)return!1;const s=t.find((t=>t.courseID===e));return!!s}}:{enrollAccess(){return!1}}}}};const W=(0,d.A)(F,[["render",V]]);var K=W,Q={name:"Lesson Detail",components:{Backend:p,Frontend:K},data(){return{session:r.A.get("session")}},setup(){const e=(0,a.lq)(),t=e.meta.title;(0,n.K7)(t)},computed:{componentName(){return"backend"===this.session.interface?"Backend":"frontend"===this.session.interface?"Frontend":(console.error("Invalid interface:",this.session.interface),null)}}};const G=(0,d.A)(Q,[["render",i]]);var H=G},57313:function(e,t){class s{isMobile(){return window.innerWidth<=768}deviceDetect(){return this.isMobile()?"mobile":"desktop"}}const o=new s;t.A=o}}]);
//# sourceMappingURL=5505.fb0be810.js.map