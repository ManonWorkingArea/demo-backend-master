"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[5525],{19895:function(e,o,t){t.d(o,{A:function(){return E}});var i=t(20641),s=t(90033);const r={class:"aspect-w-16 aspect-h-9"},a={class:"absolute inset-0 flex justify-center items-center"},d={class:"w-full h-full bg-gray-900"},n={ref:"videoElement",autoplay:"",playsinline:"",class:"w-full h-full object-cover"},c=["src"],l={class:"relative bottom-0 left-0 w-full p-4 bg-gray-900 bg-opacity-75 flex justify-center"},u=["disabled"],h=["disabled"],v={key:0},p={key:1},g={key:0,class:"absolute top-0 left-0 w-full p-2"},m={key:1,class:"absolute top-0 right-0 m-2 text-white font-bold code-overlay"},b={key:2,class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-4xl font-bold code-overlay"};function f(e,o,t,f,w,y){return(0,i.uX)(),(0,i.CE)("div",{class:(0,s.C4)(["relative",[w.activeBlock?"isblock":"isunblock"]]),"data-content":"กำลังอัพโหลดไฟล์วีดีโอ กรุณารอสักครู่....."},[(0,i.Lk)("div",r,[(0,i.Lk)("div",a,[(0,i.Lk)("div",d,[(0,i.Lk)("video",n,null,512),w.videoURL?((0,i.uX)(),(0,i.CE)("video",{key:0,src:w.videoURL,controls:"","webkit-playsinline":"",playsinline:"",class:"absolute top-0 left-0 w-full h-full object-cover"},null,8,c)):(0,i.Q3)("",!0)])])]),(0,i.Lk)("div",l,[(0,i.Lk)("button",{onClick:o[0]||(o[0]=(...e)=>y.activateCamera&&y.activateCamera(...e)),disabled:w.recording||w.cameraActive,class:"py-2 px-4 bg-blue-500 text-white rounded hover:bg-blue-600 mr-2"},"1.เปิดกล้อง",8,u),(0,i.Lk)("button",{onClick:o[1]||(o[1]=(...e)=>y.startRecording&&y.startRecording(...e)),disabled:w.recording||!w.cameraActive,class:"py-2 px-4 bg-red-500 text-white rounded hover:bg-red-600 mr-2"},[w.recording?((0,i.uX)(),(0,i.CE)("span",p," กำลังบันทึก... ")):((0,i.uX)(),(0,i.CE)("span",v,"2.บันทึกวีดีโอ"))],8,h),(0,i.Lk)("button",{onClick:o[2]||(o[2]=(...e)=>y.uploadRecordedVideo&&y.uploadRecordedVideo(...e)),class:"py-2 px-4 bg-green-500 text-white rounded hover:bg-green-600"},"3.ส่งวีดีโอ")]),w.recording?((0,i.uX)(),(0,i.CE)("div",g,o[3]||(o[3]=[(0,i.Lk)("div",{class:"bg-red-500 text-white text-sm font-bold px-4 py-2 rounded-full inline-flex items-center"},[(0,i.Lk)("i",{class:"fas fa-circle red-icon mr-1"}),(0,i.eW)(" Recording... ")],-1)]))):(0,i.Q3)("",!0),w.recording?((0,i.uX)(),(0,i.CE)("div",m,(0,s.v_)(w.currentDateTime),1)):(0,i.Q3)("",!0),w.showCode?((0,i.uX)(),(0,i.CE)("div",b,(0,s.v_)(w.code),1)):(0,i.Q3)("",!0)],2)}t(44114),t(14603),t(47566),t(98721);var w=t(57146),y=t(30554),k=t(40475),C={data(){const e=k.A.get("configs"),o=e,t=new w.S3({forcePathStyle:!1,endpoint:o.s3EndpointDefault,region:o.s3Region,ResponseContentEncoding:"utf-8",credentials:{accessKeyId:o.s3Key,secretAccessKey:o.s3Secret}});return{activeBlock:!1,uploadedFiles:[],S3:t,schoolSession:o,outputfile:[],errorText:"",successText:"",previewImages:[],uploadedFileUrl:"",videoElement:null,recording:!1,videoBase64:null,mediaRecorder:null,recordedChunks:[],cameraActive:!1,videoURL:null,mediaStream:null,currentDateTime:"",showCode:!1,code:null,preview:!1}},mounted(){this.videoElement=this.$refs.videoElement,setInterval(this.updateDateTime,1e3)},methods:{async captureImage(){const e=this.$refs.videoElement,o=document.createElement("canvas");o.width=e.videoWidth,o.height=e.videoHeight;const t=o.getContext("2d");t.drawImage(e,0,0,o.width,o.height),o.toBlob((async e=>{try{this.activeBlock=!0;const o=Date.now()+"-"+Math.floor(1e10*Math.random()),t="png",i=`verified_image/${o}.${t}`,s={Bucket:this.schoolSession.s3Bucket,Key:i,Body:e,ACL:"public-read"};await this.S3.send(new y.w(s));const r=`${this.schoolSession.s3Endpoint}${i}`;console.log("Image uploaded successfully:",r),this.$emit("imageUploaded",r),this.activeBlock=!1}catch(o){console.error("Error uploading image:",o),this.activeBlock=!1}}),"image/png")},async uploadRecordedVideo(){if(this.videoBlob&&0!==this.videoBlob.size)try{await this.uploadVideo(this.videoBlob),console.log("Upload successful"),this.successText="Video uploaded successfully"}catch(e){console.error("Upload failed:",e),this.errorText="Error uploading video"}else console.error("No video to upload or video is empty.")},async uploadVideo(e){try{this.activeBlock=!0;const o=Date.now()+"-"+Math.floor(1e10*Math.random()),t="mp4",i=`${o}.${t}`,s={Bucket:this.schoolSession.s3Bucket,Key:"verified/"+i,Body:e,ACL:"public-read"},r=await this.S3.send(new y.w(s));this.uploadedFileUrl=`${this.schoolSession.s3Endpoint}verified/${i}`,console.log("Video uploaded successfully:",r),this.successText="Video uploaded successfully",this.activeBlock=!1,this.$emit("webcam-recorder",this.uploadedFileUrl)}catch(o){console.error("Error uploading video:",o),this.errorText="Error uploading video"}},sendBase64(){this.convertToBase64()},async activateCamera(){try{const e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});this.videoElement.srcObject=e,this.mediaStream=e,this.cameraActive=!0,console.log("Camera activated")}catch(e){console.error("Error accessing webcam:",e)}},startRecording(){if(this.cameraActive){this.recordedChunks=[],this.videoURL=null;try{this.mediaRecorder=new MediaRecorder(this.mediaStream),this.mediaRecorder.ondataavailable=this.handleDataAvailable,this.mediaRecorder.start(),this.recording=!0,this.showCode=!0,this.preview=!1,this.generateRandomCode(),console.log("Recording started"),setTimeout(this.stopRecording,5e3)}catch(e){console.error("Error starting recording:",e)}}else console.error("Camera is not active.")},stopRecording(){this.mediaRecorder&&this.recording&&(this.mediaRecorder.stop(),this.recording=!1,this.showCode=!1,console.log("Recording stopped"),this.mediaRecorder.onstop=()=>{const e=new Blob(this.recordedChunks,{type:"video/mp4"});console.log("Blob size:",e.size),e.size>0?(this.videoBlob=e,this.previewRecording()):console.error("No video data available to upload.")})},handleDataAvailable(e){e.data.size>0&&(this.recordedChunks.push(e.data),this.previewRecording())},async previewRecording(){const e=new Blob(this.recordedChunks,{type:"video/mp4"});this.videoURL=URL.createObjectURL(e),console.log("Preview updated")},async convertToBase64(){if(0===this.recordedChunks.length)return void console.error("No video data available.");const e=new Blob(this.recordedChunks,{type:"video/mp4"}),o=await this.blobToBase64(e);this.videoBase64=o,this.$emit("webcam-recorder",this.videoBase64),console.log("Video converted to Base64")},blobToBase64(e){return new Promise(((o,t)=>{const i=new FileReader;i.readAsDataURL(e),i.onloadend=()=>o(i.result),i.onerror=e=>t(e)}))},updateDateTime(){const e=new Date;this.currentDateTime=e.toLocaleString()},generateRandomCode(){const e=Math.floor(1e3+9e3*Math.random());this.code=e.toString()}}},R=t(64621);const B=(0,R.A)(C,[["render",f]]);var E=B},25525:function(e,o,t){t.r(o),t.d(o,{default:function(){return h}});var i=t(20641);function s(e,o,t,s,r,a){const d=(0,i.g2)("Edit");return this.login?((0,i.uX)(),(0,i.Wv)(d,{key:0})):(0,i.Q3)("",!0)}var r=t(52968),a=t(75220),d=t(19895),n=t(40475),c={name:"Lesson Streaming",components:{Edit:d.A},data(){return{login:n.A.get("session","login")}},methods:{},setup(){const e=(0,a.lq)(),o=e.meta.title;(0,r.K7)(o)}},l=t(64621);const u=(0,l.A)(c,[["render",s]]);var h=u}}]);
//# sourceMappingURL=5525.74f67641.js.map