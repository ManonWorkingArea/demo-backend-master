"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[6078],{27085:function(e,t,s){s.r(t),s.d(t,{default:function(){return ke}});var i=s(20641);function a(e,t,s,a,n,r){return(0,i.uX)(),(0,i.Wv)((0,i.$y)(r.componentName))}var n=s(52968),r=s(75220),l=s(40475),o=s(90033);const c={class:"bg-gray-100"},d={class:"hidden sm:block mx-auto max-w-2xl px-4 pt-3 pb-4 sm:px-18 sm:pt-3 sm:pb-4 lg:grid lg:max-w-7xl lg:grid-cols-2 lg:gap-x-4"},p={class:"lg:flex lg:items-center lg:justify-between"},u={class:"min-w-0 flex-1"},m={class:"flex","aria-label":"Breadcrumb"},h={role:"list",class:"flex items-center space-x-4"},g={key:0},y={class:"flex items-center"},f={key:1},v={class:"flex items-center"},k={class:"flex items-center"},b={class:"flex items-center"},w={class:"ml-4 text-sm font-bold text-gray-600 hover:text-gray-700 max-w-xs truncate min-w-xs"},L={class:"bg-gray-800"},x={class:"mx-auto pt-8 pb-5 max-w-2xl sm:px-2 sm:pt-8 sm:pb-8 lg:max-w-7xl lg:px-8"},_={"aria-labelledby":"details-heading",class:"mb-5"},T={class:"flex flex-col items-center text-center"},P={id:"details-heading",class:"text-2xl font-bold tracking-tight text-white sm:text-2xl"},S={class:"mt-3 max-w-3xl text-lg text-white"},I={class:"relative flex items-center justify-center w-full"},C={class:"absolute text-white z-50 p-1 left-5 top-2"},E=["src"],A={class:"absolute text-white z-50 p-1",style:{"text-shadow":"rgba(0, 0, 0, 0.8) 1px 1px 3px",opacity:"0.6",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},$={ref:"videoStreaming",controls:"",crossorigin:"",playsinline:"",class:"w-full"},W=["src"],F={class:"bg-gray-100 py-6"},D={class:"mx-auto max-w-7xl sm:px-6 lg:px-8"},U={class:"overflow-hidden bg-white shadow sm:rounded-md"};function M(e,t,s,a,n,r){const l=(0,i.g2)("router-link"),M=(0,i.g2)("LiveStreaming"),X=(0,i.g2)("idle"),B=(0,i.g2)("Playlist");return(0,i.uX)(),(0,i.CE)("div",c,[(0,i.Lk)("div",d,[(0,i.Lk)("div",p,[(0,i.Lk)("div",u,[(0,i.Lk)("nav",m,[(0,i.Lk)("ol",h,[(0,i.Lk)("li",null,[(0,i.Lk)("div",null,[(0,i.bF)(l,{to:"/",class:"text-gray-400 hover:text-gray-500"},{default:(0,i.k6)((()=>t[0]||(t[0]=[(0,i.Lk)("svg",{class:"h-5 w-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[(0,i.Lk)("path",{"fill-rule":"evenodd",d:"M9.293 2.293a1 1 0 011.414 0l7 7A1 1 0 0117 11h-1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-3a1 1 0 00-1-1H9a1 1 0 00-1 1v3a1 1 0 01-1 1H5a1 1 0 01-1-1v-6H3a1 1 0 01-.707-1.707l7-7z","clip-rule":"evenodd"})],-1),(0,i.Lk)("span",{class:"sr-only"},"Home",-1)]))),_:1})])]),this.lesson.standalone?((0,i.uX)(),(0,i.CE)("li",g,[(0,i.Lk)("div",y,[t[2]||(t[2]=(0,i.Lk)("svg",{class:"h-5 w-5 flex-shrink-0 text-gray-300",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true"},[(0,i.Lk)("path",{d:"M5.555 17.776l8-16 .894.448-8 16-.894-.448z"})],-1)),(0,i.bF)(l,{to:"/user/profile",class:"ml-4 text-sm font-medium text-gray-500 hover:text-gray-700"},{default:(0,i.k6)((()=>t[1]||(t[1]=[(0,i.eW)("หน้าหลัก")]))),_:1})])])):((0,i.uX)(),(0,i.CE)("li",f,[(0,i.Lk)("div",v,[t[4]||(t[4]=(0,i.Lk)("svg",{class:"h-5 w-5 flex-shrink-0 text-gray-300",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true"},[(0,i.Lk)("path",{d:"M5.555 17.776l8-16 .894.448-8 16-.894-.448z"})],-1)),(0,i.bF)(l,{to:"bypass"===n.session.mode?"/user/employee":"/lesson/home",class:"ml-4 text-sm font-medium text-gray-500 hover:text-gray-700"},{default:(0,i.k6)((()=>t[3]||(t[3]=[(0,i.eW)("หลักสูตร")]))),_:1},8,["to"])])])),(0,i.Lk)("li",null,[(0,i.Lk)("div",k,[t[5]||(t[5]=(0,i.Lk)("svg",{class:"h-5 w-5 flex-shrink-0 text-gray-300",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true"},[(0,i.Lk)("path",{d:"M5.555 17.776l8-16 .894.448-8 16-.894-.448z"})],-1)),(0,i.bF)(l,{to:"/lesson/detail/"+n.lesson._id,class:"ml-4 text-sm font-medium text-gray-500 hover:text-gray-700 max-w-xs truncate min-w-xs"},{default:(0,i.k6)((()=>[(0,i.eW)((0,o.v_)(this.lesson.name),1)])),_:1},8,["to"])])]),(0,i.Lk)("li",null,[(0,i.Lk)("div",b,[t[6]||(t[6]=(0,i.Lk)("svg",{class:"h-5 w-5 flex-shrink-0 text-gray-300",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true"},[(0,i.Lk)("path",{d:"M5.555 17.776l8-16 .894.448-8 16-.894-.448z"})],-1)),(0,i.Lk)("span",w,(0,o.v_)(this.player.name),1)])])])])])])]),(0,i.Lk)("div",L,[(0,i.Lk)("div",x,[(0,i.Lk)("section",_,[(0,i.Lk)("div",T,[(0,i.bF)(l,{to:"/lesson/detail/"+n.lesson._id},{default:(0,i.k6)((()=>[(0,i.Lk)("h2",P,(0,o.v_)(this.lesson.name),1)])),_:1},8,["to"]),(0,i.Lk)("p",S,(0,o.v_)(this.player.name),1)])]),"live"===this.player.type?((0,i.uX)(),(0,i.Wv)(M,{key:0,email:n.session.user.email,nickname:`${n.session.user.firstname} ${n.session.user.lastname}`,licenseKey:n.playerSource,lesson:n.lesson._id,title:`${n.player.name}`},null,8,["email","nickname","licenseKey","lesson","title"])):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.Lk)("figure",{class:(0,o.C4)(["fullscreen-figure",{fullscreen:n.isFullscreen}]),style:{"user-select":"none"},draggable:"false"},[(0,i.Lk)("div",I,[(0,i.Lk)("div",C,[(0,i.Lk)("img",{src:n.playerLogo,alt:"",class:"w-24 lg:w-36 xs:w-10 sm:w-10"},null,8,E)]),(0,i.Lk)("div",A,[t[7]||(t[7]=(0,i.Lk)("span",{class:"font-bold"}," Licensed to : ",-1)),t[8]||(t[8]=(0,i.eW)()),t[9]||(t[9]=(0,i.Lk)("br",null,null,-1)),(0,i.eW)(" "+(0,o.v_)(n.session.user.firstname+" "+n.session.user.lastname)+" ("+(0,o.v_)(n.userIp)+") ",1),t[10]||(t[10]=(0,i.Lk)("br",null,null,-1)),(0,i.eW)(" "+(0,o.v_)(r.currentDateTime),1)]),(0,i.Lk)("video",$,[(0,i.Lk)("source",{src:e.videoSource},null,8,W)],512)])],2),n.lessonLoaded?((0,i.uX)(),(0,i.Wv)(X,{key:0,ref:"idleComponent",class:"mt-3",Popups:Number(this.lesson.idle_popup),timeout:Number(n.lesson.idle_timeout),debug:n.lesson.idle_debug,status:"yes"===n.lesson.idle,playingTime:r.computedTotalPlayingTime,onIdleAction:r.handleIdleFunction,onIdleEvent:r.handleEventAdded,onIdleStatus:r.handleProgressStatusUpdated},null,8,["Popups","timeout","debug","status","playingTime","onIdleAction","onIdleEvent","onIdleStatus"])):(0,i.Q3)("",!0)],64))])]),(0,i.Lk)("div",F,[(0,i.Lk)("div",D,[t[11]||(t[11]=(0,i.Lk)("section",{"aria-labelledby":"details-heading",class:"mb-5"},[(0,i.Lk)("div",{class:"flex flex-col items-center text-center"},[(0,i.Lk)("h2",{id:"details-heading",class:"text-2xl font-bold tracking-tight text-gray-900 sm:text-2xl"},"รายละเอียดเนื้อหา"),(0,i.Lk)("p",{class:"mt-3 max-w-3xl text-lg text-gray-600"},"รายละเอียดเนื้อหาของหลักสูตรนี้ คุณต้องทำการเข้าเรียนตามลำดับแต่ละบทเรียน")])],-1)),(0,i.Lk)("div",U,[(0,i.bF)(B,{ref:"childRef",dataItem:this.dataItem,courseData:this.lesson,playerItem:this.playerItem,playOption:this.lesson.display,debug:!1},null,8,["dataItem","courseData","playerItem","playOption"])])])])])}s(44114),s(98992),s(54520),s(3949),s(81454),s(37550);var X=s(9964),B=s(57313),j=s(64945),q=s(34330),N=s.n(q);const z={key:0,class:"progress-bar"},O={key:0,class:"popup"},H={class:"popup-content"},K={class:"pb-2"},R=["onClick"],V={key:1,class:"bg-white p-2 mt-3 text-gray-600 text-sm"},G=["disabled"],Q=["disabled"];function Z(e,t,s,a,n,r){return(0,i.uX)(),(0,i.CE)("div",null,[s.debug?((0,i.uX)(),(0,i.CE)("div",z,[(0,i.Lk)("div",{class:"progress",style:(0,o.Tr)({width:n.progressPlaying+"%"})},null,4),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.markers,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"marker",style:(0,o.Tr)({left:e.position+"%",backgroundColor:"unactive"===e.status?"gray":"active"===e.status?"red":"green"})},null,4)))),128))])):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(n.markers,((e,s)=>((0,i.uX)(),(0,i.CE)("div",{key:s},["active"===e.status?((0,i.uX)(),(0,i.CE)("div",O,[(0,i.Lk)("div",H,[t[6]||(t[6]=(0,i.Lk)("h1",{class:"font-bold pb-4"},"ระบบตรวจสอบการเรียน",-1)),(0,i.Lk)("p",K,[(0,i.eW)('คลิ๊ก "เรียนต่อ" ภายใน '+(0,o.v_)(e.countdown)+" วินาที ",1),t[4]||(t[4]=(0,i.Lk)("br",null,null,-1)),t[5]||(t[5]=(0,i.eW)("หากหมดเวลา วีดีโอนี้จะหยุดและนำผู้เรียนไปหน้าหลักโดยอัตโนมัติ"))]),(0,i.Lk)("button",{class:"font-bold",onClick:e=>r.closePopup(s)},"เรียนต่อ",8,R)])])):(0,i.Q3)("",!0)])))),128)),s.debug?((0,i.uX)(),(0,i.CE)("div",V,[(0,i.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>r.startPlaying&&r.startPlaying(...e)),disabled:n.playingStarted||n.timeIsUp},"Start | ",8,G),(0,i.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.pausePlaying&&r.pausePlaying(...e)),disabled:!n.playingStarted||n.timeIsUp},"Pause | ",8,Q),(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.resetComponent&&r.resetComponent(...e))},"Reset | "),(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.stopPlaying&&r.stopPlaying(...e))},"Stop "),t[20]||(t[20]=(0,i.Lk)("br",null,null,-1)),t[21]||(t[21]=(0,i.Lk)("br",null,null,-1)),(0,i.Lk)("p",null,[t[7]||(t[7]=(0,i.Lk)("span",{class:"font-bold"},"Total Time : ",-1)),(0,i.eW)((0,o.v_)(s.playingTime),1)]),(0,i.Lk)("p",null,[t[8]||(t[8]=(0,i.Lk)("span",{class:"font-bold"},"Timer: ",-1)),(0,i.eW)((0,o.v_)(n.timer.toFixed(0)),1)]),(0,i.Lk)("p",null,[t[9]||(t[9]=(0,i.Lk)("span",{class:"font-bold"},"Percent: ",-1)),(0,i.eW)((0,o.v_)(n.playerPercent)+"%",1)]),(0,i.Lk)("p",null,[t[10]||(t[10]=(0,i.Lk)("span",{class:"font-bold"},"Timeout: ",-1)),(0,i.eW)((0,o.v_)(s.timeout),1)]),(0,i.Lk)("p",null,[t[11]||(t[11]=(0,i.Lk)("span",{class:"font-bold"},"Popup: ",-1)),(0,i.eW)((0,o.v_)(s.Popups),1)]),(0,i.Lk)("p",null,[t[12]||(t[12]=(0,i.Lk)("span",{class:"font-bold"},"Status: ",-1)),(0,i.eW)((0,o.v_)(n.progressStatus),1)]),(0,i.Lk)("p",null,[t[13]||(t[13]=(0,i.Lk)("span",{class:"font-bold"},"Progress Plauing: ",-1)),(0,i.eW)((0,o.v_)(n.progressPlaying),1)]),(0,i.Lk)("p",null,[t[14]||(t[14]=(0,i.Lk)("span",{class:"font-bold"},"Playing Time: ",-1)),(0,i.eW)((0,o.v_)(n.playingStartTime),1)]),(0,i.Lk)("p",null,[t[15]||(t[15]=(0,i.Lk)("span",{class:"font-bold"},"Playing Started: ",-1)),(0,i.eW)((0,o.v_)(n.playingStarted),1)]),(0,i.Lk)("p",null,[t[16]||(t[16]=(0,i.Lk)("span",{class:"font-bold"},"Time is Up: ",-1)),(0,i.eW)((0,o.v_)(n.timeIsUp),1)]),(0,i.Lk)("p",null,[t[17]||(t[17]=(0,i.Lk)("span",{class:"font-bold"},"Timer Status: ",-1)),(0,i.eW)((0,o.v_)(n.timerStatus),1)]),(0,i.Lk)("p",null,[t[18]||(t[18]=(0,i.Lk)("span",{class:"font-bold"},"Timer: ",-1)),(0,i.eW)((0,o.v_)(n.timer),1)]),(0,i.Lk)("p",null,[t[19]||(t[19]=(0,i.Lk)("span",{class:"font-bold"},"Elapsed Time: ",-1)),(0,i.eW)((0,o.v_)(n.elapsedTime),1)]),t[22]||(t[22]=(0,i.Lk)("span",{class:"font-bold"},"Marker",-1)),(0,i.Lk)("pre",null,(0,o.v_)(n.markers),1),t[23]||(t[23]=(0,i.Lk)("br",null,null,-1)),t[24]||(t[24]=(0,i.Lk)("span",{class:"font-bold"},"Events",-1)),(0,i.Lk)("pre",null,(0,o.v_)(n.events),1)])):(0,i.Q3)("",!0)])}var J=s(63084),Y={props:{playingTime:Number,Popups:Number,timeout:Number,debug:Boolean,status:Boolean},data(){return{events:[],playerPercent:0,markers:[],progressPlaying:0,playingStartTime:null,playingStarted:!1,timeIsUp:!1,progressStatus:"not started",timerStatus:!0,timer:0,elapsedTime:0}},created(){J.A.log("Popups prop received:",this.Popups)},mounted(){this.playingStartTime=Date.now();for(let e=0;e<this.Popups;e++){const t=0===e?.05+.05*Math.random():e/this.Popups;this.markers.push({position:100*t,status:"unactive",timer:0,countdown:0,active:!1})}},methods:{pushEvent(e){this.events.push({message:e,date:new Date}),this.$emit("idle-event",this.events)},end(){this.stopPlaying()},startCountdownTimer(e){const t=this.markers[e],s=()=>{t.active&&t.countdown>0&&(t.countdown-=1,setTimeout(s,1e3))};t.timerId=setTimeout((()=>{J.A.log("Countdown Time Up!!"),this.triggerTimeout(e)}),1e3*t.countdown),s()},closePopup(e){const t=this.markers[e];t.active&&(t.status="closed",t.countdown=0,this.timerStatus=!0,this.pushEvent(`Popup ${e+1} is closed.`),this.$emit("idle-action","close"),clearTimeout(t.timerId))},triggerTimeout(){this.$emit("idle-action","timeout")},resetComponent(){this.events=[],this.progressPlaying=0,this.playingStarted=!1,this.timeIsUp=!1,this.progressStatus="not started",this.timerStatus=!0,this.timer=0,this.markers.forEach((e=>{e.status="unactive",e.countdown=0,e.active=!1}));for(let e=0;e<this.Popups;e++){const t=0===e?.1+.05*Math.random():e/this.Popups;this.markers[e].position=100*t}this.pushEvent("Component reset.")},startPlaying(){this.status&&(this.playingStarted||this.timeIsUp||("paused"===this.progressStatus?this.playingStartTime=this.timer-this.elapsedTime:(this.timer=0,this.playingStartTime=this.timer),this.playingStarted=!0,this.updatePlayingProgress(),this.pushEvent("Marker started."),this.progressStatus="started"))},pausePlaying(){this.status&&this.playingStarted&&(this.playingStarted=!1,this.elapsedTime=this.timer-this.playingStartTime,this.pushEvent("Marker paused."),this.progressStatus="paused")},stopPlaying(){this.playingStarted=!1,this.timeIsUp=!1,this.progressPlaying=0,this.progressStatus="not started",this.events=[],this.markers.forEach((e=>{e.status="unactive"})),this.markers.forEach((e=>{"active"===e.status&&(e.status="closed")})),this.pushEvent("Marker stopped.")},updatePlayingProgress(){if(this.$emit("idle-status",this.progressStatus),this.playerPercent=this.timer/(this.playingTime/1e3)*100,this.playingStarted&&!this.timeIsUp&&this.timerStatus){if(this.timer+=.27,this.timer<=this.playingTime/1e3&&!this.isAnyPopupActive()){this.progressPlaying=this.timer/(this.playingTime/1e3)*100;for(let e=0;e<this.markers.length;e++){const t=this.markers[e];this.progressPlaying>=t.position&&"unactive"===t.status&&(t.status="active",this.timerStatus=!1,t.timer=0,t.countdown=this.timeout,t.active=!0,this.startCountdownTimer(e),this.pushEvent("Marker active."),this.$emit("idle-action","open"))}this.progressPlaying>=99.995&&(this.progressStatus="completed")}this.timer>=this.playingTime/1e3&&(this.timeIsUp=!0,this.markers.forEach((e=>{e.status="unactive"})),this.pushEvent("Time is up."),this.progressStatus="completed")}},isAnyPopupActive(){return this.markers.some((e=>"active"===e.status))}}},ee=s(64621);const te=(0,ee.A)(Y,[["render",Z],["__scopeId","data-v-5ec7fa5e"]]);var se=te,ie=s(43263);const ae={id:"FullScreenContainer"},ne={id:"TopBar"},re={id:"Title"};function le(e,t,s,a,n,r){return(0,i.uX)(),(0,i.CE)("div",ae,[(0,i.Lk)("div",ne,[(0,i.Lk)("div",re,(0,o.v_)(s.title),1),(0,i.Lk)("button",{id:"CloseButton",onClick:t[0]||(t[0]=(...e)=>r.closeWidget&&r.closeWidget(...e))},"ปิดหน้าจอ")]),t[1]||(t[1]=(0,i.Lk)("div",{id:"WidgetContainer"},null,-1))])}var oe={props:{email:{type:String,required:!0},nickname:{type:String,required:!0},title:{type:String,required:!0},lesson:{type:String,required:!0},licenseKey:{type:String,required:!0}},methods:{closeWidget(){document.body.classList.remove("no-scroll"),this.$router.push(`/lesson/detail/${this.lesson}`)}},mounted(){document.body.classList.add("no-scroll");try{const e=document.createElement("script");e.type="text/javascript",e.async=!0,e.innerHTML=`\n          var _options = {\n            '_license_key': '${this.licenseKey}',\n            '_role_token': '',\n            '_registrant_token': '',\n            '_personal_token': '',\n            '_presenter_token': '',\n            '_password_token': '',\n            '_widget_containerID': 'WidgetContainer',\n            '_widget_width': '100%',\n            '_widget_height': '100%',\n            '_email': '${this.email}',\n            '_nickname': '${this.nickname}',\n            '_avatar_url': '',\n          };\n          (function() {\n            !function(i){\n              i.Widget=function(c){\n                'function'==typeof c&&i.Widget.__cbs.push(c),\n                i.Widget.initialized&&(i.Widget.__cbs.forEach(function(i){i()}),\n                i.Widget.__cbs=[])\n              },\n              i.Widget.__cbs=[]\n            }(window);\n            var ab = document.createElement('script');\n            ab.type = 'text/javascript';\n            ab.async = true;\n            ab.src = 'https://embed.livewebinar.com/em?t=' + _options['_license_key'] + '&' + Object.keys(_options).reduce(function(a, k) {\n              a.push(k + '=' + encodeURIComponent(_options[k]));\n              return a;\n            }, []).join('&');\n            var s = document.getElementsByTagName('script')[0];\n            s.parentNode.insertBefore(ab, s);\n          })();\n        `,document.getElementById("WidgetContainer").appendChild(e)}catch(e){console.error("Error loading script:",e)}},beforeUnmount(){document.body.classList.remove("no-scroll")}};const ce=(0,ee.A)(oe,[["render",le]]);var de=ce,pe=s(40471);const ue=new pe.A(!1),me=[{name:"pending",label:"รอเรียน",styleClass:"bg-gray-300 text-gray-600",icon:"hourglass-start"},{name:"processing",label:"กำลังเรียน",styleClass:"bg-yellow-300 text-yellow-800",icon:"spinner"},{name:"complete",label:"เรียนจบแล้ว",styleClass:"bg-green-300 text-green-800",icon:"check"}];var he={name:"Lesson Player",components:{idle:se,LiveStreaming:de,Playlist:ie.A},data(){return{receivedEvents:[],receivedProgressStatus:"",playOption:"step",login:l.A.get("session","login"),configs:l.A.get("configs"),session:l.A.get("session"),dataItem:this.$route.params.cid,playerItem:this.$route.params.pid,enroll:l.A.get("session","enroll"),deviceType:B.A.deviceDetect(),exam:[],lesson:[],stopTrigger:!1,lessonLoaded:!1,players:[],player:[],progress:[],progressArray:[],param_id:"",param_ep:"",loading_sources:!0,playerLogo:"",playerSource:"",playerPoster:"",isFullscreen:!1,userIp:"0.0.0.0",playerOptions:{controls:["play-large","current-time","play","mute","volume","progress","settings","fullscreen"],settings:["quality","speed","loop"],timer:null,realtime:[]},totalPopups:2}},methods:{startIdle(){this.$refs.idleComponent.startPlaying()},pauseIdle(){this.$refs.idleComponent.pausePlaying()},processIdle(){this.$refs.idleComponent.updatePlayingProgress()},resetIdle(){this.$refs.idleComponent.stopPlaying()},handleCustomMethodResult(e){J.A.slack("Result from custom method in idle.vue:",e)},handleIdleFunction(e){switch(e){case"open":this.pauseVideo(),J.A.log("Idle - Open");break;case"close":this.playVideo(),J.A.log("Idle - Close");break;case"timeout":J.A.log("Idle - Timeout"),this.$router.push("/lesson/detail/"+this.lesson._id);break;default:J.A.log("Idle - Unknown Action: ",e);break}},handleEventAdded(e){this.receivedEvents=e},handleProgressStatusUpdated(e){this.receivedProgressStatus=e},handlePopupStatusUpdated(e){this.receivedPopupStatus=e},convertToMilliseconds(e){const[t,s,i]=e.split(":").map(Number),a=1e3*(60*t*60+60*s+i);return a},toggleElementFullscreen(){J.A.log("Fullscreen"),this.isFullscreen=!this.isFullscreen},async getUserIP(){try{const e=await fetch("https://api.ipify.org?format=json");if(!e.ok)throw new Error("Failed to fetch IP address");const t=await e.json();this.userIp=t.ip,console.log("Fetched User IP Address:",this.userIp)}catch(e){console.error("Error fetching user IP:",e)}},updateCurrentDateTime(){const e=document.getElementById("currentDateTime");if(e){const t=new Date;e.textContent=t.toLocaleString("en-US",{timeZone:"GMT"})}},stripHtmlTags(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""},getStatus(e){const t=me.find((t=>t.name===e));return t?`<p class="inline-flex rounded-full px-2 text-xs font-semibold leading-5 capitalize ${t.styleClass}">\n          <i class="fa fa-${t.icon} mr-1 mt-1"></i>${t.label}\n          </p>`:""},checkExam(e){return this.exam.some((t=>t.type===e))},getFilteredExams(e){return this.exam&&this.exam.length?this.exam.filter((t=>t.type===e)):[]},formatSeconds(e){return X.A.secondsToTime(e)},formatThaidate(e){return X.A.toThaiDatetime(e)},detectDevice(){return B.A.deviceDetect()},pauseVideo(){const e=this.$refs.videoStreaming;e.paused||e.pause()},playVideo(){const e=this.$refs.videoStreaming;e.paused&&e.play()},callChildFunction(){const e=this.$refs.childRef;e&&(e.getData(),e.calculateAnalytics())},callChildAnalytics(){const e=this.$refs.childRef;e&&(e.getData(!0),e.calculateAnalytics())},videoStreaming(){const e=this,t=this.$refs.videoStreaming,s=this.lesson.skip;J.A.log(s);const i={controls:["play","fast-forward","progress","custom-button","current-time","duration","mute","volume","settings"],fullscreen:{enabled:!1},tooltips:!0,youtube:{noCookie:!0,rel:1,showinfo:0,modestbranding:1,iv_load_policy:3,enablejsapi:1}};let a;if(this.playerSource.includes("youtube.com")||this.playerSource.includes("youtu.be")){const n=this.playerSource.match(/(?:\?v=|\/embed\/)(.{11})/)[1],r=`https://www.youtube.com/embed/${n}?origin=${window.location.host}&amp;enablejsapi=1&amp;modestbranding=1&amp;iv_load_policy=3&amp;playsinline=1&amp;showinfo=0&amp;rel=0`,l=document.createElement("iframe");l.src=r,l.allowfullscreen=!0,l.allowtransparency=!0,l.allow="autoplay";const o=document.createElement("div");o.classList.add("plyr__video-wrapper"),o.appendChild(l);const c=document.createElement("div");c.classList.add("plyr__video-embed"),c.appendChild(o),t.parentNode.replaceChild(c,t),a=new(N())(c,{...i,youtube:{...i.youtube,iv_load_policy:3,modestbranding:1,rel:0,origin:window.location.host,enablejsapi:1}}),a.on("ready",(()=>{if(J.A.log("youtube ready",s),"no"===s){const e=document.querySelector(".plyr__progress");e.classList.add("pointer-events-none"),e.classList.add("opacity-30")}})),a.on("timeupdate",(()=>{const t=a.currentTime;J.A.log(t),e.updateTimer(t),e.getTimer(t)})),a.on("playing",(()=>{J.A.log("playing")})),a.on("pause",(()=>{J.A.log("pause"),e.showTimer()})),a.on("ended",(()=>{J.A.log("ended"),e.stopTimer(),e.callChildFunction()}))}else if(j.Ay.isSupported()&&this.playerSource.endsWith(".m3u8")){const s=new j.Ay;s.loadSource(this.playerSource),s.on(j.Ay.Events.MANIFEST_PARSED,(function(){const l=s.levels.map((e=>e.height));i.quality={default:l[0],options:l,forced:!0,onChange:e=>r(e)},a=new(N())(t,i),n(a,e)})),s.attachMedia(t),window.hls=s}else t.src=this.playerSource,t.type="video/mp4",a=new(N())(t,i),n(a,e);function n(e,t){const i=document.createElement("button");i.innerHTML='<i class="fas fa-expand"></i>',i.classList.add("custom-button-class"),i.addEventListener("click",(()=>{t.toggleElementFullscreen()}));const a=e.elements.controls;function n(){e&&"function"===typeof e.pause&&e.pause()}a.appendChild(i),e.on("ready",(()=>{const i=t.getLastplay();let a="";i.length>0&&(a=i[0].lastplay||0);let r=!0;if("no"===s){const e=document.querySelector(".plyr__progress");e.classList.add("pointer-events-none"),e.classList.add("opacity-30")}localStorage.setItem("realtime",0),e.on("play",(()=>{t.startIdle(),r&&(e.currentTime=a,r=!1)})),e.on("pause",(()=>{t.pauseIdle(),t.showTimer(),t.callChildFunction(),n()})),e.on("ended",(()=>{t.stopTimer(),t.resetIdle(),t.callChildFunction()})),e.on("progress",(()=>{const s=e.currentTime;t.updateTimer(s)})),e.on("timeupdate",(()=>{const s=e.currentTime/e.duration*100;s>95&&(t.stopTrigger||(t.stopTrigger=!0,t.stopTimer())),t.processIdle();const i=e.currentTime;t.getTimer(i)})),e.on("enterfullscreen",(()=>{J.A.log("enterfullscreen")})),e.on("exitfullscreen",(()=>{J.A.log("exitfullscreen")}))}))}function r(e){window.hls.levels.forEach(((t,s)=>{t.height===e&&(window.hls.currentLevel=s)}))}},getTimer:function(e){let t=localStorage.getItem("realtime")||0;t=parseInt(t)+1,localStorage.setItem("realtime",t),t%60===0&&(console.log("Update Progress"),localStorage.setItem("realtime",0),this.progressPlayer("seek",5,e))},updateTimer:function(){},stopTimer:function(){this.progressComplete()},getLastplay:function(){return this.progress},showTimer:()=>{},getVideoUrl(e){return this.player.video[e]},progressPlayer:async function(e,t=0,s=0){try{const{pid:e,cid:i}=this.$route.params,{userID:a}=this.session,n=await ue.POST("progress/query",{method:"find",args:[{$and:[{playerID:e,courseID:i,userID:a}]}]},this.configs.key);if(200!==n.status)throw new Error("Failed to fetch player data from API");const r=n.data;if(200===n.status)if(r.length>0){if(0!==s){let e={review:r[0].review,progress:r[0].progress};"complete"===r[0].status?e.review=r[0].review+t:"processing"!==r[0].status&&"pending"!==r[0].status||(e.progress=r[0].progress+t);const i="complete"===r[0].status?{review:e.review}:{progress:e.progress},a="complete"===r[0].status?"complete":"processing",n=await ue.PUT(`progress/${r[0]._id}`,{data:{...i,lastplay:s,status:a}},this.configs.key);if(200!==n.status)throw new Error("Failed to fetch player data from API");const l=n.data;200===n.status&&(this.progress=l)}this.progress=r}else{const t=await ue.POST("progress",{data:{userID:a,courseID:i,playerID:e,progress:0,lastplay:0,status:"pending"},options:{}},this.configs.key);if(200!==n.status)throw new Error("Failed to fetch player data from API");200===t.status&&(this.progress=t.data)}await this.getData()}catch(i){}},progressComplete:async function(){try{const{pid:e,cid:t}=this.$route.params,{userID:s}=this.session,i=await ue.POST("progress/query",{method:"find",args:[{$and:[{playerID:e,courseID:t,userID:s}]}]},this.configs.key);if(200!==i.status)throw new Error("Failed to fetch player data from API");const a=i.data;if(200===i.status&&a.length>0){const e=await ue.PUT(`progress/${a[0]._id}`,{data:{lastplay:0,status:"complete"}},this.configs.key);if(200!==e.status)throw new Error("Failed to fetch player data from API");const t=e.data;200===e.status&&(this.progress=t,await this.getData())}}catch(e){}},async getData(){try{this.loading_sources=!1;const e=await ue.GET(`course/${this.dataItem}`,this.configs.key);if(200===e.status){this.lesson=e.data,this.lessonLoaded=!0;const t=this.$route.params.pid,s=await ue.GET(`player/${t}`,this.configs.key);if(200===s.status){this.player=s.data;let e="";"demand"===this.player.type?e=this.player.video[this.deviceType]:"streaming"===this.player.type?e=this.player.video.streaming:"youtube"===this.player.type?e=this.player.video.youtube:"live"===this.player.type&&(e=this.player.video.live),this.playerSource=e,this.playerPoster="https://vz-28af3134-886.b-cdn.net/24b5e108-1c7f-438d-8fde-8c49fa43a9c0/thumbnail.jpg",this.playerLogo=this.configs.siteLogo,this.$setPageTitle(this.player.name+" / หลักสูตร "+this.lesson.name)}}}catch(e){}}},async mounted(){try{this.getUserIP(),await this.getData(),await this.progressPlayer("firstrun"),this.videoStreaming()}catch(e){}},setup(){},watch:{"$route.params.cid":{deep:!0,immediate:!0,handler(){}}},computed:{randomPopups(){return Math.floor(5*Math.random())+1},computedTotalPlayingTime(){return this.player&&this.player.duration?this.convertToMilliseconds(this.player.duration):0},currentDateTime(){const e=new Date;return e.toLocaleString("en-US",{timeZone:"GMT"})}}};const ge=(0,ee.A)(he,[["render",M]]);var ye=ge,fe={name:"Lesson Play",components:{Frontend:ye},data(){return{session:l.A.get("session")}},setup(){const e=(0,r.lq)(),t=e.meta.title;(0,n.K7)(t)},computed:{componentName(){return"Frontend"}}};const ve=(0,ee.A)(fe,[["render",a]]);var ke=ve}}]);
//# sourceMappingURL=6078.a907826e.js.map