"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[6138],{48783:function(e,t,s){s.d(t,{A:function(){return B}});var o=s(20641),i=s(53751),n=s(90033);const r={class:"bg-gray-50"},l={class:"flex min-h-full flex-col justify-center py-12 sm:px-6 lg:px-8"},a={class:"sm:mx-auto sm:w-full sm:max-w-lg"},d=["src"],c={class:"mt-2 text-center text-sm text-gray-600"},u={class:"mt-8 sm:mx-auto sm:w-full sm:max-w-md"},g={class:"bg-white px-4 py-8 shadow sm:rounded-lg sm:px-10"},m={class:"mt-2"},f={class:"mt-2"},h={class:"flex items-center justify-between"},p={class:"text-sm"},b={key:0,class:"col-span-2"},x={class:"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5"},w={class:"w-full"};function k(e,t,s,k,y,v){const L=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",r,[(0,o.Lk)("div",l,[(0,o.Lk)("div",a,[this.showModal?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("img",{key:0,class:"mx-auto h-24 w-auto",src:this.configs.siteLogo,alt:"Your Company"},null,8,d)),t[5]||(t[5]=(0,o.Lk)("h2",{class:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900"},"เข้าสู่ระบบสมาชิก -2",-1)),(0,o.Lk)("p",c,[t[4]||(t[4]=(0,o.eW)(" หรือ ")),(0,o.bF)(L,{to:"/user/register",class:"font-medium text-indigo-600 hover:text-indigo-500"},{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.eW)(" ลงทะเบียนสมาชิกใหม่ ")]))),_:1})])]),(0,o.Lk)("div",u,[(0,o.Lk)("div",g,[(0,o.Lk)("form",{class:"space-y-6",onSubmit:t[2]||(t[2]=(0,i.D$)(((...e)=>v.login&&v.login(...e)),["prevent"]))},[(0,o.Lk)("div",null,[t[6]||(t[6]=(0,o.Lk)("label",{for:"email",class:"block text-md font-semibold leading-6 text-gray-900"},"อีเมล์",-1)),(0,o.Lk)("div",m,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>y.email=e),id:"email",name:"email",type:"email",autocomplete:"email",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[i.Jo,y.email]])])]),(0,o.Lk)("div",null,[t[7]||(t[7]=(0,o.Lk)("label",{for:"password",class:"block text-md font-semibold leading-6 text-gray-900"},"รหัสผ่าน",-1)),(0,o.Lk)("div",f,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>y.password=e),id:"password",name:"password",type:"password",autocomplete:"current-password",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[i.Jo,y.password]])])]),(0,o.Lk)("div",h,[t[9]||(t[9]=(0,o.Lk)("div",{class:"flex items-center"},[(0,o.Lk)("input",{id:"remember-me",name:"remember-me",type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,o.Lk)("label",{for:"remember-me",class:"ml-2 block text-sm text-gray-900"},"จำฉันไว้")],-1)),(0,o.Lk)("div",p,[(0,o.bF)(L,{to:"/user/forgot",class:"font-medium text-indigo-600 hover:text-indigo-500"},{default:(0,o.k6)((()=>t[8]||(t[8]=[(0,o.eW)(" ลืมรหัสผ่าน ")]))),_:1})])]),(0,o.Lk)("div",null,[this.errorStage?((0,o.uX)(),(0,o.CE)("div",b,[(0,o.Lk)("div",x,[t[10]||(t[10]=(0,o.Lk)("div",{class:"font-semibold pt-3 pb-3"},"เกิดข้อผิดพลาด",-1)),(0,o.Lk)("div",w,(0,n.v_)(this.errorMessage),1)])])):(0,o.Q3)("",!0),t[11]||(t[11]=(0,o.Lk)("button",{type:"submit",class:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},"เข้าสู่ระบบ",-1))])],32)])])])])}s(64979);var y=s(40475),v=s(21396),L=s.n(v),M=s(63084),S=s(40471);const C=new S.A(!1);var A={name:"Login",components:{},props:{showModal:{type:Boolean,default:!1}},data(){return{configs:y.A.get("configs"),hostname:y.A.get("hostname"),email:"",password:"",errorStage:!1,errorMessage:""}},methods:{generateRandomString(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";const o=t.length;for(let i=0;i<e;i++)s+=t.charAt(Math.floor(Math.random()*o));return s},generateStateWithRedirect(e){const t={random:this.generateRandomString(12),redirect:e,siteID:this.configs.siteID};return btoa(JSON.stringify(t))},loginWithLine(){const e=this.configs.line?.client_id,t=encodeURIComponent(this.configs.line?.callback),s=this.generateStateWithRedirect("/user/profile"),o="profile openid",i="aggressive";window.location.href=`https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=${e}&redirect_uri=${t}&state=${s}&scope=${o}&bot_prompt=${i}`},async login(){try{this.activeBlock=!0;const e=await C.POST("user/query",{method:"find",args:[{$and:[{username:this.email}]}]},this.configs.key),t=e.data,s=t.length>0?t[0]:null;if(console.log("loginData",s),null===s||""===s||void 0===s)return this.errorStage=!0,this.errorMessage="ไม่พบข้อมูลบัญชีผู้ใช้นี้",void(this.activeBlock=!1);{const e=s.salt,t=L().SHA256(this.password+e).toString(),o=s.password;if(M.A.log(t,o),t===o)if("user"!=s.role)this.errorStage=!0,this.errorMessage="ไม่มีสิทธิ์เข้าใช้งานเว็บไซต์นี้";else{const e=await C.POST("enroll/query",{method:"find",hidden:["userID"],args:[{$and:[{userID:s._id}]}]},this.configs.key),t=e.data;if(200===e.status){let e=[],o="";const i={active:!0,token:s._id,refresh:"",login:!0,userID:s._id,user:s,loader:!1,role:s.role,nav:"normal-nav",layout:"frontend-layout",current:o,list:e,enroll:t,channel:"web"};y.A.update("session",i),M.A.log("session",i),this.showModal?window.location.reload():this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:500,icon:"success",title:"แจ้งเตือน",text:"เข้าสู่ระบบเรียบร้อยแล้ว"}).then((()=>{s.req_reset?window.location.href="/user/reset":window.location.href="/user/profile"}))}}else this.errorStage=!0,this.errorMessage="ชื่อผู้ใช้งานหรือรหัสผ่านไม่ถูกต้อง"}this.activeBlock=!1}catch(e){M.A.log(e)}}}},_=s(64621);const V=(0,_.A)(A,[["render",k]]);var B=V},97435:function(e,t,s){s.d(t,{A:function(){return M}});var o=s(20641),i=s(90033),n=s(53751);const r={class:"bg-gray-50"},l={class:"flex min-h-full flex-col justify-center py-12 sm:px-6 lg:px-8"},a={class:"sm:mx-auto sm:w-full sm:max-w-lg"},d=["src"],c={class:"mt-8 sm:mx-auto sm:w-full sm:max-w-md"},u={class:"mt-2"},g={class:"mt-2 relative"},m=["type"],f={class:"flex items-center justify-between"},h={class:"text-sm"},p={key:0,class:"col-span-2"},b={class:"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5"},x={class:"w-full"};function w(e,t,s,w,k,y){const v=(0,o.g2)("font-awesome-icon"),L=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",r,[(0,o.Lk)("div",l,[(0,o.Lk)("div",a,[this.showModal?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("img",{key:0,class:"mx-auto h-24 w-auto",src:this.config.siteLogo,alt:"Your Company"},null,8,d)),t[4]||(t[4]=(0,o.Lk)("h2",{class:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900"},"เข้าสู่ระบบฝึกอบรม (HR)",-1)),t[5]||(t[5]=(0,o.Lk)("p",{class:"mt-2 text-center text-base text-gray-600"}," ใช้บัญชีสำหรับ K2 ในการล็อคอิน ",-1))]),(0,o.Lk)("div",c,[(0,o.Lk)("div",{class:(0,i.C4)(["bg-white px-4 py-8 shadow sm:rounded-lg sm:px-10 relative",[k.activeBlock?"isblock":"isunblock"]]),"data-content":"กำลังติดต่อฐานข้อมูล กรุณารอสักครู่....."},[(0,o.Lk)("form",{class:"space-y-6",onSubmit:t[3]||(t[3]=(0,n.D$)(((...e)=>y.login&&y.login(...e)),["prevent"]))},[(0,o.Lk)("div",null,[t[6]||(t[6]=(0,o.Lk)("label",{for:"email",class:"block text-md font-semibold leading-6 text-gray-900"},"ชื่อผู้ใช้ในระบบ K2",-1)),(0,o.Lk)("div",u,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>k.username=e),id:"username",name:"username",type:"text",autocomplete:"username",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[n.Jo,k.username]])])]),(0,o.Lk)("div",null,[t[7]||(t[7]=(0,o.Lk)("label",{for:"password",class:"block text-md font-semibold leading-6 text-gray-900"},"รหัสผ่าน",-1)),(0,o.Lk)("div",g,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>k.password=e),id:"password",name:"password",type:k.passwordVisible?"text":"password",autocomplete:"current-password",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,8,m),[[n.hp,k.password]]),(0,o.Lk)("button",{type:"button",class:"absolute inset-y-0 right-0 flex items-center bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-2 border border-gray-400 rounded shadow m-1",onClick:t[2]||(t[2]=(...e)=>y.togglePasswordVisibility&&y.togglePasswordVisibility(...e))},[(0,o.bF)(v,{icon:k.passwordVisible?["fas","eye-slash"]:["fas","eye"],class:"text-black hover:text-gray-600 text-xs"},null,8,["icon"])])])]),(0,o.Lk)("div",f,[t[9]||(t[9]=(0,o.Lk)("div",{class:"flex items-center"},[(0,o.Lk)("input",{id:"remember-me",name:"remember-me",type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"}),(0,o.Lk)("label",{for:"remember-me",class:"ml-2 block text-sm text-gray-900"},"จำฉันไว้")],-1)),(0,o.Lk)("div",h,[(0,o.bF)(L,{to:"/user/forgot",class:"font-medium text-indigo-600 hover:text-indigo-500"},{default:(0,o.k6)((()=>t[8]||(t[8]=[(0,o.eW)(" ลืมรหัสผ่าน ")]))),_:1})])]),(0,o.Lk)("div",null,[this.errorStage?((0,o.uX)(),(0,o.CE)("div",p,[(0,o.Lk)("div",b,[t[10]||(t[10]=(0,o.Lk)("div",{class:"font-semibold pt-3 pb-3"},"เกิดข้อผิดพลาด",-1)),(0,o.Lk)("div",x,(0,i.v_)(this.errorMessage),1)])])):(0,o.Q3)("",!0),t[11]||(t[11]=(0,o.Lk)("button",{type:"submit",class:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},"เข้าสู่ระบบ",-1))])],32)],2)])])])}var k=s(40475),y={name:"Login",components:{},props:{showModal:{type:Boolean,default:!1}},data(){return{config:k.A.get("configs"),username:"",password:"",errorStage:!1,errorMessage:"",activeBlock:!1,passwordVisible:!1}},methods:{togglePasswordVisibility(){this.passwordVisible=!this.passwordVisible},async login(){try{this.activeBlock=!0,this.errorStage=!1;const e=await fetch("https://faas-sgp1-18bc02ac.doserverless.co/api/v1/web/fn-34d16f42-4718-42b0-814e-08d23fecd2ce/default/login-fti-employee",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password})}),t=await e.json();if(console.log("getLogin",t),200===t.status){let e=[],s="";const o={active:!0,token:t.user._id,refresh:"",login:!0,userID:t.user._id,user:t.user,loader:!1,role:t.user.role,nav:"normal-nav",layout:"frontend-layout",current:s,list:e,enroll:t.enroll,mode:t.mode};k.A.update("session",o),console.log("session",o),this.showModal?window.location.reload():this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:1e3,icon:"success",title:"แจ้งเตือน",text:"เข้าสู่ระบบเรียบร้อยแล้ว"}).then((()=>{window.location.href="/user/employee"}))}else this.errorStage=!0,this.errorMessage=t;this.activeBlock=!1}catch(e){console.log(e)}}}},v=s(64621);const L=(0,v.A)(y,[["render",w]]);var M=L},6138:function(e,t,s){s.d(t,{A:function(){return p}});var o=s(20641);const i={key:0,class:"fixed z-10 inset-0 overflow-y-auto"},n={class:"flex items-center justify-center min-h-screen"},r={class:"relative bg-white rounded-lg overflow-hidden w-full max-w-md"},l={class:"absolute top-0 right-0 mr-4 mt-4"},a={class:"p-0"};function d(e,t,s,d,c,u){const g=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("button",{class:"flex w-full items-center justify-center rounded-md border border-transparent bg-indigo-600 px-8 py-3 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-gray-50",onClick:t[0]||(t[0]=(...e)=>u.openModal&&u.openModal(...e))},[(0,o.bF)(g,{icon:["fas","key"],class:"h-4 w-4 mr-2 flex-shrink-0 text-white"}),t[2]||(t[2]=(0,o.eW)(" เข้าสู่ระบบ เพื่อดำเนินการต่อ "))]),c.showModal?((0,o.uX)(),(0,o.CE)("div",i,[(0,o.Lk)("div",n,[t[3]||(t[3]=(0,o.Lk)("div",{class:"fixed inset-0 bg-gray-500 opacity-75"},null,-1)),(0,o.Lk)("div",r,[(0,o.Lk)("div",l,[(0,o.Lk)("button",{class:"text-gray-400 hover:text-gray-600",onClick:t[1]||(t[1]=(...e)=>u.closeModal&&u.closeModal(...e))},[(0,o.bF)(g,{icon:["fas","times"],class:"h-5 w-5 flex-shrink-0 text-gray-400"})])]),(0,o.Lk)("div",a,[((0,o.uX)(),(0,o.Wv)((0,o.$y)(c.currentLoginComponent),{"show-modal":c.showModal,onLoginSuccess:e.handleLoginSuccess},null,40,["show-modal","onLoginSuccess"]))])])])])):(0,o.Q3)("",!0)])}var c=s(40475),u=s(48783),g=s(97435),m={data(){return{configs:c.A.get("configs"),showModal:!1,currentLoginComponent:null}},methods:{openModal(){this.showModal=!0,"user/AD"===this.configs.defaultLogin?this.currentLoginComponent=g.A:this.currentLoginComponent=u.A},closeModal(){this.showModal=!1}}},f=s(64621);const h=(0,f.A)(m,[["render",d]]);var p=h}}]);
//# sourceMappingURL=6138.97af0df6.js.map