"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[6666],{56666:function(t,a,e){e.r(a),e.d(a,{default:function(){return P}});var s=e(20641);function r(t,a,e,r,o,l){const n=(0,s.g2)("Edit");return this.login?((0,s.uX)(),(0,s.Wv)(n,{key:0})):(0,s.Q3)("",!0)}var o=e(52968),l=e(75220),n=e(90033);const i={class:"bg-white border-b border-gray-200"},d={class:"mx-auto max-w-3xl px-4 sm:px-6 lg:max-w-7xl lg:px-8"},c={class:"pt-3"},u={key:1},h={key:2,class:"table mt-3"},f={key:3};function p(t,a,e,r,o,l){return(0,s.uX)(),(0,s.CE)("div",i,[(0,s.Lk)("div",d,[(0,s.Lk)("div",c,[(0,s.Lk)("input",{type:"file",onChange:a[0]||(a[0]=(...t)=>l.handleFileUpload&&l.handleFileUpload(...t))},null,32),a[3]||(a[3]=(0,s.Lk)("br",null,null,-1)),o.parsedData.length>0?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:a[1]||(a[1]=(...t)=>l.callApiForAllItems&&l.callApiForAllItems(...t))},"Call API for All Items")):(0,s.Q3)("",!0),a[4]||(a[4]=(0,s.Lk)("br",null,null,-1)),o.apiProgress>0?((0,s.uX)(),(0,s.CE)("div",u," Progress: "+(0,n.v_)(o.apiProgress)+"/ "+(0,n.v_)(o.parsedData.length),1)):(0,s.Q3)("",!0),o.parsedData.length>0?((0,s.uX)(),(0,s.CE)("table",h,[a[2]||(a[2]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"#"),(0,s.Lk)("th",null,"Date"),(0,s.Lk)("th",null,"amount"),(0,s.Lk)("th",null,"Ref1"),(0,s.Lk)("th",null,"Ref2"),(0,s.Lk)("th",null,"hasData")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.parsedData,((t,a)=>((0,s.uX)(),(0,s.CE)("tr",{key:a},[(0,s.Lk)("td",null,(0,n.v_)(a+1),1),(0,s.Lk)("td",null,(0,n.v_)(t.date),1),(0,s.Lk)("td",null,(0,n.v_)(t.amount),1),(0,s.Lk)("td",null,(0,n.v_)(t.ref1),1),(0,s.Lk)("td",null,(0,n.v_)(t.ref2),1),(0,s.Lk)("td",null,(0,n.v_)(t.hasData),1)])))),128))])])):((0,s.uX)(),(0,s.CE)("div",f," No data available. Please upload a file. "))])])])}e(98992),e(54520),e(81454);var m=e(40475),g=e(40471);const k=new g.A(!1);var v={data(){return{session:m.A.get("session"),configs:m.A.get("configs"),parsedData:[],columnLabels:["Customer No / Ref.1","Ref.2","Amount"],apiProgress:0}},methods:{handleFileUpload(t){const a=t.target.files[0];a&&this.parseCsvFile(a)},parseCsvFile(t){const a=new FileReader;a.onload=t=>{const a=t.target.result,e=a.split(/\r?\n/);this.parsedData=e.slice(1).map((t=>{const a=t.split(","),e=a[4],s=a[5],r=a[9],o=a[2];return{ref1:e,ref2:s,amount:r,date:o}})).filter((t=>t.ref1&&t.ref2))},a.readAsText(t)},delay(t){return new Promise((a=>setTimeout(a,t)))},async callApiForAllItems(){this.apiProgress=0;for(let a=0;a<this.parsedData.length;a++){const e=this.parsedData[a];try{const t=await this.callYourApiFunction(e.ref1,e.ref2,e.date,e.formattedTime,a);console.log("API Response:",t),this.apiProgress++,await this.delay(1e3)}catch(t){console.error("API Error:",t),await this.delay(1e3)}}},markRowAsHavingData(t,a){this.parsedData[t]={...this.parsedData[t],hasData:a}},async callYourApiFunction(t,a,e,s,r){try{const e={method:"find",args:[{$and:[{ref1:t,ref2:a}]}]},s=await k.POST("order/query",e,this.configs.key);console.log("response",s),200===s.status&&s.data.length>0?this.markRowAsHavingData(r,!0):this.markRowAsHavingData(r,!1)}catch(o){throw console.error("API Error for item at index",r,":",o),this.markRowAsHavingData(r,!1),o}},async callYourApiFunction2(t,a,e,s){try{const r={method:"find",args:[{$and:[{ref1:t,ref2:a,process:"draft"}]}]},o=await k.POST("order/query",r,this.configs.key);if(console.log("Order",o.data),console.log(e,s),200!==o.status)throw new Error("Failed to fetch data from API");const l={method:"find",args:[{$and:[{"formData.input-13-6-6.value":a,"formData.hidden-15-6-6.value":t,process:"draft"}]}]},n=await k.POST("form/query",l,this.configs.key);if(console.log("Form",n.data),console.log(e,s),200!==n.status)throw new Error("Failed to fetch data from API");const i={data:{process:"pending",date:e,time:s,formID:n.data[0]._id}},{data:d,status:c}=await k.PUT(`order/${o.data[0]._id}`,i,this.configs.key);console.log(d,c);let u={...n.data[0].formData},h={name:"วันที่ชำระเงิน",value:e+" "+s,type:"datetime",mode:"datetime"};u["input-30-9-9"]=h;const f={data:{process:"pending",date:e,time:s,orderID:o.data[0]._id,formData:u}},{data2:p,status2:m}=await k.PUT(`form/${n.data[0]._id}`,f,this.configs.key);console.log(p,m)}catch(r){throw new Error("Failed to fetch data from API")}}}},A=e(64621);const w=(0,A.A)(v,[["render",p],["__scopeId","data-v-9cbb35bc"]]);var y=w,D={name:"Lesson Edit",components:{Edit:y},data(){return{login:m.A.get("session","login")}},methods:{},setup(){const t=(0,l.lq)(),a=t.meta.title;(0,o.K7)(a)}};const L=(0,A.A)(D,[["render",r]]);var P=L}}]);
//# sourceMappingURL=6666.68231418.js.map