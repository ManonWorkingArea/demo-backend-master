{"version":3,"file":"js/6666.68231418.js","mappings":"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","sources":["webpack://node-backend/./src/extensions/modules/elearning/lesson/view/course/SCBXLS.vue","webpack://node-backend/./src/extensions/modules/elearning/lesson/component/course/SCBXLS.vue","webpack://node-backend/./src/extensions/modules/elearning/lesson/component/course/SCBXLS.vue?b664","webpack://node-backend/./src/extensions/modules/elearning/lesson/view/course/SCBXLS.vue?4b03"],"sourcesContent":["<script>\nimport {useTitle} \tfrom 'vue-page-title';\nimport {useRoute} \tfrom 'vue-router'\n\nimport Edit \t\tfrom '../../component/course/SCBXLS';\nimport storageManager from '@/plugins/storage';\n\nexport default {\n\tname: 'Lesson Edit',\n\tcomponents: {\n\t\t\n\t\tEdit\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tlogin: storageManager.get('session','login'),\n\t\t}\n\t},\n\tmethods: {\n\t},\n\tsetup() {\n        const route     = useRoute();\n        const routeName = route.meta.title;\n        useTitle(routeName);\n    },\n};\n</script>\n\n<template>\n\n<Edit v-if=\"this.login\"/>\n</template>","<template>\n    <div class=\"bg-white border-b border-gray-200\">\n        <div class=\"mx-auto max-w-3xl px-4 sm:px-6 lg:max-w-7xl lg:px-8\">\n            <div class=\"pt-3\">\n                <input type=\"file\" @change=\"handleFileUpload\">\n                <br/>\n                <button @click=\"callApiForAllItems\" v-if=\"parsedData.length > 0\">Call API for All Items</button>\n                <br/>\n                <div v-if=\"apiProgress > 0\">\n                  Progress: {{ apiProgress }}/ {{ parsedData.length }}\n                </div>\n\n                <table v-if=\"parsedData.length > 0\" class=\"table mt-3\">\n                    <thead>\n                    <tr>\n                        <th>#</th>\n                        <th>Date</th>\n                        <th>amount</th>\n                        <th>Ref1</th>\n                        <th>Ref2</th>\n                        <th>hasData</th>\n                    </tr>\n                    </thead>\n                    <tbody>\n                    <tr v-for=\"(row, index) in parsedData\" :key=\"index\">\n                        <td>{{ index + 1 }}</td>\n                        <td>{{ row.date }}</td>\n                        <td>{{ row.amount }}</td>\n                        <td>{{ row.ref1 }}</td>\n                        <td>{{ row.ref2 }}</td>\n                        <td>{{ row.hasData }}</td>\n                    </tr>\n                    </tbody>\n                </table>\n                <div v-else>\n                    No data available. Please upload a file.\n                </div>\n            </div>\n        </div>\n    </div>\n  </template>\n  \n  <script>\n  import storageManager from '@/plugins/storage';\nimport requestClient from '@/plugins/requestClient';\nconst Request = new requestClient(false);\nexport default {\n  data() {\n    return {\n      session: storageManager.get('session'),\n      configs: storageManager.get('configs'),\n      parsedData: [],\n      columnLabels: ['Customer No / Ref.1', 'Ref.2', 'Amount'],\n      apiProgress: 0 // Track API call progress\n    };\n  },\n  methods: {\n    handleFileUpload(event) {\n      const file = event.target.files[0];\n      if (file) {\n        this.parseCsvFile(file);\n      }\n    },\n    parseCsvFile(file) {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const text = e.target.result;\n        const rows = text.split(/\\r?\\n/); // Split the file content by new line\n        this.parsedData = rows.slice(1) // Skip the header row\n        .map(row => {\n          const columns = row.split(','); // Split each row by the comma delimiter\n          // Extract and format the data as needed\n          const ref1 = columns[4]; // Assuming the 'Customer No / Ref.1' is in the 5th column\n          const ref2 = columns[5]; // Assuming 'Ref.2' is in the 6th column\n          const amount = columns[9]; // Assuming 'Amount' is in the 10th column\n          const date = columns[2]; // Assuming 'Amount' is in the 10th column\n          return { ref1, ref2, amount ,date };\n        }).filter(row => row.ref1 && row.ref2); // Filter out rows without necessary data\n      };\n      reader.readAsText(file);\n    },\n    delay(time) {\n        return new Promise(resolve => setTimeout(resolve, time));\n    },\n\n    async callApiForAllItems() {\n        this.apiProgress = 0;\n        // Use a regular for loop instead of forEach to ensure sequential execution\n        for (let index = 0; index < this.parsedData.length; index++) {\n            const item = this.parsedData[index];\n            try {\n                // Call your API with ref1, ref2, and index for each item\n                const response = await this.callYourApiFunction(item.ref1, item.ref2, item.date, item.formattedTime, index);\n                console.log('API Response:', response);\n                this.apiProgress++;\n                // Handle the API response as needed\n\n                // Wait for 1 second before proceeding to the next iteration\n                await this.delay(1000);\n            } catch (error) {\n                console.error('API Error:', error);\n                // Handle errors if any\n                // Optionally, continue to the next iteration even if there's an error\n                await this.delay(1000); // Delay also applied here to respect the rate limit after an error\n            }\n        }\n    },\n    markRowAsHavingData(index, hasData) {\n        this.parsedData[index] = { ...this.parsedData[index], hasData: hasData };\n    },\n    async callYourApiFunction(ref1, ref2, date, time, index) {\n    try {\n        // Example API request data\n        const requestData = {\n        method: 'find',\n        args: [{ $and: [{ ref1: ref1, ref2: ref2 }] }],\n        };\n        \n        // Perform the API call\n        const response = await Request.POST(`order/query`, requestData, this.configs.key);\n        console.log(\"response\",response);\n        // Check the response status and data length to determine if data exists\n        if (response.status === 200 && response.data.length > 0) {\n        // Data found, mark the row accordingly\n        this.markRowAsHavingData(index, true);\n        } else {\n        // Data not found, mark the row accordingly\n        this.markRowAsHavingData(index, false);\n        }\n    } catch (error) {\n        console.error('API Error for item at index', index, ':', error);\n        // Optionally, mark the row as not having data in case of error\n        this.markRowAsHavingData(index, false);\n        throw error; // Rethrow or handle the error as needed\n    }\n    },\n    async callYourApiFunction2(ref1, ref2, date, time) {\n      try {\n        const requestData = {\n          method: 'find',\n          args: [{ $and: [{ ref1: ref1,ref2: ref2, process:'draft'}] }],\n        };\n        \n        // Assuming you have axios imported as 'axios' and 'Request' is defined\n        const response = await Request.POST(`order/query`, requestData, this.configs.key);\n        console.log(\"Order\",response.data);\n\n        console.log(date,time);\n        if (response.status !== 200) {\n          throw new Error('Failed to fetch data from API');\n        }\n\n        const requestData2 = {\n          method: 'find',\n          args: [{ $and: [{ \"formData.input-13-6-6.value\": ref2,\"formData.hidden-15-6-6.value\": ref1, process:'draft'}] }],\n        };\n        \n        // Assuming you have axios imported as 'axios' and 'Request' is defined\n        const response2 = await Request.POST(`form/query`, requestData2, this.configs.key);\n\n        console.log(\"Form\",response2.data);\n\n        console.log(date,time);\n        if (response2.status !== 200) {\n          throw new Error('Failed to fetch data from API');\n        }\n\n        const requestBody = {\n          data: {\n            process: 'pending',\n            date: date,\n            time: time,\n            formID:response2.data[0]._id\n          }\n        };\n        const { data, status } = await Request.PUT(`order/${response.data[0]._id}`, requestBody, this.configs.key);\n        console.log(data,status);\n\n\n        // Copy the existing formData into a new object\n        let newFormData = { ...response2.data[0].formData };\n\n        // Define the new field\n        let newField = {\n          name: \"วันที่ชำระเงิน\",\n          value: date+\" \"+time, // You can set the initial value here or leave it empty\n          type: \"datetime\",\n          mode: \"datetime\"\n        };\n\n        // Add the new field to the new formData object\n        newFormData[\"input-30-9-9\"] = newField;\n\n        const requestBody2 = {\n          data: {\n            process: 'pending',\n            date: date,\n            time: time,\n            orderID:response.data[0]._id,\n            formData: newFormData\n          }\n        };\n        const { data2, status2 } = await Request.PUT(`form/${response2.data[0]._id}`, requestBody2, this.configs.key);\n        console.log(data2,status2);\n\n        //return response.data[0]; // Assuming your response contains the data you need\n      } catch (error) {\n        throw new Error('Failed to fetch data from API');\n      }\n    }\n\n  }\n};\n</script>\n\n<style scoped>\n  .table {\n    border-collapse: collapse;\n    width: 100%;\n  }\n  \n  .table th, .table td {\n    border: 1px solid #dddddd;\n    text-align: left;\n    padding: 8px;\n  }\n  \n  .table th {\n    background-color: #f2f2f2;\n  }\n  </style>","import { render } from \"./SCBXLS.vue?vue&type=template&id=9cbb35bc&scoped=true\"\nimport script from \"./SCBXLS.vue?vue&type=script&lang=js\"\nexport * from \"./SCBXLS.vue?vue&type=script&lang=js\"\n\nimport \"./SCBXLS.vue?vue&type=style&index=0&id=9cbb35bc&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-9cbb35bc\"]])\n\nexport default __exports__","import { render } from \"./SCBXLS.vue?vue&type=template&id=5bf2f3de\"\nimport script from \"./SCBXLS.vue?vue&type=script&lang=js\"\nexport * from \"./SCBXLS.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["login","_createBlock","_component_Edit","key","_createCommentVNode","class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","type","onChange","_cache","args","$options","handleFileUpload","$data","parsedData","length","onClick","callApiForAllItems","apiProgress","_hoisted_4","_toDisplayString","_hoisted_5","_Fragment","_renderList","row","index","date","amount","ref1","ref2","hasData","_hoisted_6","Request","requestClient","data","session","storageManager","get","configs","columnLabels","methods","event","file","target","files","this","parseCsvFile","reader","FileReader","onload","e","text","result","rows","split","slice","map","columns","filter","readAsText","delay","time","Promise","resolve","setTimeout","item","response","callYourApiFunction","formattedTime","console","log","error","markRowAsHavingData","requestData","method","$and","POST","status","callYourApiFunction2","process","Error","requestData2","response2","requestBody","formID","_id","PUT","newFormData","formData","newField","name","value","mode","requestBody2","orderID","data2","status2","__exports__","components","Edit","setup","route","useRoute","routeName","meta","title","useTitle","render"],"sourceRoot":""}