"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[7207],{39588:function(e,t,s){s.r(t),s.d(t,{default:function(){return ct}});var l=s(20641);function a(e,t,s,a,i,n){const c=(0,l.g2)("List");return this.login?((0,l.uX)(),(0,l.Wv)(c,{key:0,"header-height":i.manualHeaderHeight},null,8,["header-height"])):(0,l.Q3)("",!0)}var i=s(52968),n=s(75220),c=s(90033),o=s(53751);const r={class:"hidden lg:flex lg:w-64 lg:flex-col"},d={class:"flex flex-col flex-grow bg-white border-r border-gray-200 h-full"},u={class:"flex items-center justify-between px-4 py-4 border-b border-gray-200 flex-shrink-0"},g={class:"px-4 py-4 border-b border-gray-200"},k={class:"space-y-2"},b={class:"flex items-center justify-between p-2 bg-blue-50 rounded-lg stats-card"},p={class:"text-sm font-semibold text-blue-600"},m={class:"flex items-center justify-between p-2 bg-green-50 rounded-lg stats-card"},h={class:"text-sm font-semibold text-green-600"},x={class:"flex items-center justify-between p-2 bg-yellow-50 rounded-lg stats-card"},f={class:"text-sm font-semibold text-yellow-600"},y={class:"flex items-center justify-between p-2 bg-red-50 rounded-lg stats-card"},v={class:"text-sm font-semibold text-red-600"},L={class:"px-4 py-4 border-b border-gray-200"},w={class:"space-y-1"},T=["onClick"],C={class:"flex-1 text-left"},S={class:"px-4 py-4 border-b border-gray-200"},_={class:"space-y-2"},E={class:"mt-auto px-4 py-4 flex-shrink-0"},A={class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},H={class:"flex-1 min-w-0"},$={class:"text-sm font-medium text-gray-900 truncate"},j={class:"flex-1 flex flex-col min-w-0 h-full"},P={class:"lg:hidden bg-white border-b border-gray-200 px-4 py-3"},R={class:"flex items-center justify-between"},U={class:"bg-white border-b border-gray-200 px-4 py-3"},M={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-3"},X={class:"flex-1 max-w-md"},I={class:"relative"},Q={class:"lg:hidden bg-white border-b border-gray-200"},D={class:"px-4 py-2"},q=["value"],F={class:"flex-1 p-4"},N={key:0,class:"h-full"},O={class:"mb-4 flex items-center justify-between"},V={class:"flex items-center gap-2"},z={class:"text-lg font-semibold text-gray-900"},K={class:"px-2 py-1 bg-gray-100 text-gray-600 text-sm rounded-full"},W={class:"h-full space-y-3"},B=["onClick"],J={class:"flex items-start gap-3"},G=["onClick"],Y={class:"flex-1 min-w-0"},Z={class:"flex items-start justify-between gap-3"},ee={class:"flex-1 min-w-0"},te={class:"font-semibold text-gray-900 text-sm truncate"},se={class:"text-gray-600 text-xs mt-1 line-clamp-2"},le={class:"flex items-center gap-2 flex-shrink-0"},ae={class:"text-xs text-gray-500"},ie={class:"flex items-center justify-between mt-2"},ne={class:"flex items-center gap-3 text-xs text-gray-500"},ce={class:"flex items-center gap-1"},oe={key:0,class:"text-center py-12"},re={key:1,class:"h-full flex flex-col"},de={class:"bg-white border border-gray-200 rounded-lg flex-1 flex flex-col"},ue={class:"border-b border-gray-200 p-4 flex-shrink-0"},ge={class:"flex items-start justify-between gap-4"},ke={class:"flex items-start gap-3 flex-1 min-w-0"},be={class:"flex-1 min-w-0"},pe={class:"text-lg font-semibold text-gray-900"},me={class:"flex items-center gap-2 mt-2"},he={class:"text-xs text-gray-500"},xe={class:"flex items-center gap-2"},fe={class:"p-4 flex-shrink-0"},ye={class:"text-gray-700 text-sm leading-relaxed"},ve={class:"border-t border-gray-200 p-4 flex-1 flex flex-col"},Le={class:"flex-1 space-y-3 mb-4"},we={class:"flex-1 min-w-0"},Te={class:"bg-gray-50 rounded-lg p-3"},Ce={class:"flex items-center justify-between mb-1"},Se={class:"font-medium text-gray-900 text-sm"},_e={class:"text-gray-700 text-sm"},Ee={class:"border-t border-gray-200 pt-4 flex-shrink-0"},Ae={class:"flex justify-end mt-2"},He={class:"flex flex-col h-full"},$e={class:"flex items-center justify-between px-4 py-4 border-b border-gray-200"},je={class:"px-4 py-4 border-b border-gray-200"},Pe={class:"space-y-2"},Re={class:"flex items-center justify-between p-2 bg-blue-50 rounded-lg"},Ue={class:"text-sm font-semibold text-blue-600"},Me={class:"flex items-center justify-between p-2 bg-green-50 rounded-lg"},Xe={class:"text-sm font-semibold text-green-600"},Ie={class:"flex items-center justify-between p-2 bg-yellow-50 rounded-lg"},Qe={class:"text-sm font-semibold text-yellow-600"},De={class:"flex items-center justify-between p-2 bg-red-50 rounded-lg"},qe={class:"text-sm font-semibold text-red-600"},Fe={class:"px-4 py-4 border-b border-gray-200"},Ne={class:"space-y-1"},Oe=["onClick"],Ve={class:"flex-1 text-left"},ze={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Ke={class:"bg-white rounded-lg w-full max-w-md"},We={class:"p-4 space-y-4"},Be={class:"grid grid-cols-2 gap-4"},Je={class:"border-t border-gray-200 p-4 flex justify-end gap-2"};function Ge(e,t,s,a,i,n){return(0,l.uX)(),(0,l.CE)("div",{class:(0,c.C4)(["bg-gray-50 flex ticket-container",[s.headerType&&`with-${s.headerType}`,s.customClass]])},[(0,l.Lk)("div",r,[(0,l.Lk)("div",d,[(0,l.Lk)("div",u,[t[25]||(t[25]=(0,l.Lk)("h1",{class:"text-lg font-semibold text-gray-900"},"ระบบตั๋ว",-1)),(0,l.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.makeSupportRequest&&n.makeSupportRequest(...e)),class:"bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-lg transition-colors duration-200",title:"เพิ่มตั๋วใหม่"},t[24]||(t[24]=[(0,l.Lk)("i",{class:"fas fa-plus text-sm"},null,-1)]))]),(0,l.Lk)("div",g,[t[30]||(t[30]=(0,l.Lk)("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"สถิติรวม",-1)),(0,l.Lk)("div",k,[(0,l.Lk)("div",b,[t[26]||(t[26]=(0,l.Lk)("div",{class:"flex items-center gap-2"},[(0,l.Lk)("div",{class:"w-2 h-2 bg-blue-500 rounded-full"}),(0,l.Lk)("span",{class:"text-sm text-gray-700"},"ตั๋วทั้งหมด")],-1)),(0,l.Lk)("span",p,(0,c.v_)(i.tickets.length),1)]),(0,l.Lk)("div",m,[t[27]||(t[27]=(0,l.Lk)("div",{class:"flex items-center gap-2"},[(0,l.Lk)("div",{class:"w-2 h-2 bg-green-500 rounded-full"}),(0,l.Lk)("span",{class:"text-sm text-gray-700"},"ใหม่")],-1)),(0,l.Lk)("span",h,(0,c.v_)(n.ticketCounts.new),1)]),(0,l.Lk)("div",x,[t[28]||(t[28]=(0,l.Lk)("div",{class:"flex items-center gap-2"},[(0,l.Lk)("div",{class:"w-2 h-2 bg-yellow-500 rounded-full"}),(0,l.Lk)("span",{class:"text-sm text-gray-700"},"กำลังดำเนินการ")],-1)),(0,l.Lk)("span",f,(0,c.v_)(n.ticketCounts.process),1)]),(0,l.Lk)("div",y,[t[29]||(t[29]=(0,l.Lk)("div",{class:"flex items-center gap-2"},[(0,l.Lk)("div",{class:"w-2 h-2 bg-red-500 rounded-full"}),(0,l.Lk)("span",{class:"text-sm text-gray-700"},"ปิดแล้ว")],-1)),(0,l.Lk)("span",v,(0,c.v_)(n.ticketCounts.close),1)])])]),(0,l.Lk)("div",L,[t[31]||(t[31]=(0,l.Lk)("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"เมนู",-1)),(0,l.Lk)("nav",w,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.sidebarMenuItems,(e=>((0,l.uX)(),(0,l.CE)("button",{key:e.value,onClick:t=>n.selectTab(e.value),class:(0,c.C4)(["w-full flex items-center gap-3 px-3 py-2 text-sm rounded-lg transition-colors duration-200 sidebar-menu-item",{"bg-blue-100 text-blue-700 font-medium active":i.selectedTab===e.value,"text-gray-600 hover:bg-gray-100 hover:text-gray-900":i.selectedTab!==e.value}])},[(0,l.Lk)("i",{class:(0,c.C4)([e.icon,"text-sm w-4"])},null,2),(0,l.Lk)("span",C,(0,c.v_)(e.label),1),n.ticketCounts[e.value]>0?((0,l.uX)(),(0,l.CE)("span",{key:0,class:(0,c.C4)(["px-2 py-1 text-xs rounded-full status-badge",{"bg-blue-200 text-blue-800":i.selectedTab===e.value,"bg-gray-200 text-gray-600":i.selectedTab!==e.value}])},(0,c.v_)(n.ticketCounts[e.value]),3)):(0,l.Q3)("",!0)],10,T)))),128))])]),(0,l.Lk)("div",S,[t[34]||(t[34]=(0,l.Lk)("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"การดำเนินการ",-1)),(0,l.Lk)("div",_,[(0,l.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.makeSupportRequest&&n.makeSupportRequest(...e)),class:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors duration-200"},t[32]||(t[32]=[(0,l.Lk)("i",{class:"fas fa-plus text-sm w-4"},null,-1),(0,l.Lk)("span",null,"เพิ่มตั๋วใหม่",-1)])),(0,l.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>n.refreshTickets&&n.refreshTickets(...e)),class:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 hover:text-gray-900 rounded-lg transition-colors duration-200"},t[33]||(t[33]=[(0,l.Lk)("i",{class:"fas fa-sync-alt text-sm w-4"},null,-1),(0,l.Lk)("span",null,"รีเฟรช",-1)]))])]),(0,l.Lk)("div",E,[(0,l.Lk)("div",A,[t[36]||(t[36]=(0,l.Lk)("div",{class:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center"},[(0,l.Lk)("i",{class:"fas fa-user text-white text-sm"})],-1)),(0,l.Lk)("div",H,[(0,l.Lk)("p",$,(0,c.v_)(i.session?.current?.name||"ผู้ใช้"),1),t[35]||(t[35]=(0,l.Lk)("p",{class:"text-xs text-gray-500"},"ผู้ดูแลระบบ",-1))])])])])]),(0,l.Lk)("div",j,[(0,l.Lk)("div",P,[(0,l.Lk)("div",R,[t[38]||(t[38]=(0,l.Lk)("h1",{class:"text-lg font-semibold text-gray-900"},"ระบบตั๋ว",-1)),(0,l.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>n.toggleMobileSidebar&&n.toggleMobileSidebar(...e)),class:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},t[37]||(t[37]=[(0,l.Lk)("i",{class:"fas fa-bars"},null,-1)]))])]),(0,l.Lk)("div",U,[(0,l.Lk)("div",M,[(0,l.Lk)("div",X,[(0,l.Lk)("div",I,[t[39]||(t[39]=(0,l.Lk)("i",{class:"fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm"},null,-1)),(0,l.bo)((0,l.Lk)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>i.searchQuery=e),onInput:t[5]||(t[5]=(...e)=>n.filterTickets&&n.filterTickets(...e)),placeholder:"ค้นหาตั๋ว...",class:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"},null,544),[[o.Jo,i.searchQuery]])])]),(0,l.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>n.makeSupportRequest&&n.makeSupportRequest(...e)),class:"lg:hidden bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200 text-sm flex items-center gap-2"},t[40]||(t[40]=[(0,l.Lk)("i",{class:"fas fa-plus text-xs"},null,-1),(0,l.eW)(" เพิ่มตั๋ว ")]))])]),(0,l.Lk)("div",Q,[(0,l.Lk)("div",D,[(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.selectedTab=e),onChange:t[8]||(t[8]=e=>n.selectTab(i.selectedTab)),class:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)(["all","new","open","process","close"],(e=>(0,l.Lk)("option",{key:e,value:e},(0,c.v_)(n.getStatusLabel(e))+" ("+(0,c.v_)(n.ticketCounts[e]||0)+") ",9,q))),64))],544),[[o.u1,i.selectedTab]])])]),(0,l.Lk)("div",F,[i.selectedTicket?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",N,[(0,l.Lk)("div",O,[(0,l.Lk)("div",V,[(0,l.Lk)("h2",z,(0,c.v_)(n.getStatusLabel(i.selectedTab)),1),(0,l.Lk)("span",K,(0,c.v_)(i.filteredTickets.length)+" รายการ ",1)])]),(0,l.Lk)("div",W,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.filteredTickets,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e._id,class:"bg-white border border-gray-200 rounded-lg p-4 cursor-pointer ticket-card",onClick:t=>n.selectTicket(e)},[(0,l.Lk)("div",J,[(0,l.Lk)("button",{onClick:(0,o.D$)((t=>n.pinTicket(e)),["stop"]),class:"mt-1"},[(0,l.Lk)("i",{class:(0,c.C4)([e.pinned?"fas fa-thumbtack text-blue-600":"fas fa-thumbtack text-gray-300","text-sm"])},null,2)],8,G),(0,l.Lk)("div",Y,[(0,l.Lk)("div",Z,[(0,l.Lk)("div",ee,[(0,l.Lk)("h3",te,(0,c.v_)(e.title),1),(0,l.Lk)("p",se,(0,c.v_)(e.content),1)]),(0,l.Lk)("div",le,[(0,l.Lk)("span",ae,(0,c.v_)(e.date),1),(0,l.Lk)("span",{class:(0,c.C4)(["px-2 py-1 text-xs font-medium rounded-full status-badge",n.getStatusClass(e.status)])},(0,c.v_)(n.getStatusLabel(e.status)),3)])]),(0,l.Lk)("div",ie,[(0,l.Lk)("div",ne,[(0,l.Lk)("span",ce,[t[41]||(t[41]=(0,l.Lk)("i",{class:"fas fa-comments"},null,-1)),(0,l.eW)(" "+(0,c.v_)(e.comments?e.comments.length:0),1)]),(0,l.Lk)("span",{class:(0,c.C4)(["px-2 py-1 rounded-full text-xs status-badge",n.getLevelClass(e.level)])},(0,c.v_)(n.getLevelLabel(e.level)),3)])])])])],8,B)))),128)),0===i.filteredTickets.length?((0,l.uX)(),(0,l.CE)("div",oe,t[42]||(t[42]=[(0,l.Lk)("i",{class:"fas fa-ticket-alt text-gray-300 text-4xl mb-4"},null,-1),(0,l.Lk)("p",{class:"text-gray-500"},"ไม่พบตั๋วที่ตรงกับการค้นหา",-1)]))):(0,l.Q3)("",!0)])])),i.selectedTicket?((0,l.uX)(),(0,l.CE)("div",re,[(0,l.Lk)("div",de,[(0,l.Lk)("div",ue,[(0,l.Lk)("div",ge,[(0,l.Lk)("div",ke,[(0,l.Lk)("button",{onClick:t[9]||(t[9]=e=>n.pinTicket(i.selectedTicket)),class:"mt-1"},[(0,l.Lk)("i",{class:(0,c.C4)(i.selectedTicket.pinned?"fas fa-thumbtack text-blue-600":"fas fa-thumbtack text-gray-300")},null,2)]),(0,l.Lk)("div",be,[(0,l.Lk)("h1",pe,(0,c.v_)(i.selectedTicket.title),1),(0,l.Lk)("div",me,[(0,l.Lk)("span",{class:(0,c.C4)(["px-2 py-1 text-xs font-medium rounded-full status-badge",n.getStatusClass(i.selectedTicket.status)])},(0,c.v_)(n.getStatusLabel(i.selectedTicket.status)),3),(0,l.Lk)("span",{class:(0,c.C4)(["px-2 py-1 text-xs rounded-full status-badge",n.getLevelClass(i.selectedTicket.level)])},(0,c.v_)(n.getLevelLabel(i.selectedTicket.level)),3),(0,l.Lk)("span",he,(0,c.v_)(i.selectedTicket.date),1)])])]),(0,l.Lk)("div",xe,["close"!==i.selectedTicket.status?((0,l.uX)(),(0,l.CE)("button",{key:0,onClick:t[10]||(t[10]=e=>n.closeTicket(i.selectedTicket)),class:"bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded-lg text-xs transition-colors"}," ปิดเคส ")):(0,l.Q3)("",!0),(0,l.Lk)("button",{onClick:t[11]||(t[11]=e=>n.deleteTicket(i.selectedTicket._id)),class:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-xs transition-colors"},t[43]||(t[43]=[(0,l.Lk)("i",{class:"fas fa-trash"},null,-1)])),(0,l.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>n.closeDetail&&n.closeDetail(...e)),class:"bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded-lg text-xs transition-colors"}," กลับ ")])])]),(0,l.Lk)("div",fe,[(0,l.Lk)("p",ye,(0,c.v_)(i.selectedTicket.content),1)]),(0,l.Lk)("div",ve,[t[46]||(t[46]=(0,l.Lk)("h3",{class:"font-medium text-gray-900 mb-3"},"ความคิดเห็น",-1)),(0,l.Lk)("div",Le,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.selectedTicket.comments,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"flex gap-3"},[t[45]||(t[45]=(0,l.Lk)("div",{class:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0"},[(0,l.Lk)("i",{class:"fas fa-user text-gray-500 text-xs"})],-1)),(0,l.Lk)("div",we,[(0,l.Lk)("div",Te,[(0,l.Lk)("div",Ce,[(0,l.Lk)("span",Se,(0,c.v_)(e.user),1),t[44]||(t[44]=(0,l.Lk)("span",{class:"text-xs text-gray-500"},"3 ชั่วโมงที่แล้ว",-1))]),(0,l.Lk)("p",_e,(0,c.v_)(e.text),1)])])])))),128))]),(0,l.Lk)("div",Ee,[(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>i.newCommentText=e),placeholder:"เพิ่มความคิดเห็น...",class:"w-full border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:"3"},null,512),[[o.Jo,i.newCommentText]]),(0,l.Lk)("div",Ae,[(0,l.Lk)("button",{onClick:t[14]||(t[14]=(...e)=>n.addComment&&n.addComment(...e)),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors"}," ส่งความคิดเห็น ")])])])])])):(0,l.Q3)("",!0)])]),i.showMobileSidebar?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-50",onClick:t[17]||(t[17]=(...e)=>n.toggleMobileSidebar&&n.toggleMobileSidebar(...e))},[(0,l.Lk)("div",{class:"w-64 h-full bg-white transform transition-transform duration-300",onClick:t[16]||(t[16]=(0,o.D$)((()=>{}),["stop"]))},[(0,l.Lk)("div",He,[(0,l.Lk)("div",$e,[t[48]||(t[48]=(0,l.Lk)("h1",{class:"text-lg font-semibold text-gray-900"},"ระบบตั๋ว",-1)),(0,l.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>n.toggleMobileSidebar&&n.toggleMobileSidebar(...e)),class:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"},t[47]||(t[47]=[(0,l.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,l.Lk)("div",je,[t[53]||(t[53]=(0,l.Lk)("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"สถิติรวม",-1)),(0,l.Lk)("div",Pe,[(0,l.Lk)("div",Re,[t[49]||(t[49]=(0,l.Lk)("div",{class:"flex items-center gap-2"},[(0,l.Lk)("div",{class:"w-2 h-2 bg-blue-500 rounded-full"}),(0,l.Lk)("span",{class:"text-sm text-gray-700"},"ตั๋วทั้งหมด")],-1)),(0,l.Lk)("span",Ue,(0,c.v_)(i.tickets.length),1)]),(0,l.Lk)("div",Me,[t[50]||(t[50]=(0,l.Lk)("div",{class:"flex items-center gap-2"},[(0,l.Lk)("div",{class:"w-2 h-2 bg-green-500 rounded-full"}),(0,l.Lk)("span",{class:"text-sm text-gray-700"},"ใหม่")],-1)),(0,l.Lk)("span",Xe,(0,c.v_)(n.ticketCounts.new),1)]),(0,l.Lk)("div",Ie,[t[51]||(t[51]=(0,l.Lk)("div",{class:"flex items-center gap-2"},[(0,l.Lk)("div",{class:"w-2 h-2 bg-yellow-500 rounded-full"}),(0,l.Lk)("span",{class:"text-sm text-gray-700"},"กำลังดำเนินการ")],-1)),(0,l.Lk)("span",Qe,(0,c.v_)(n.ticketCounts.process),1)]),(0,l.Lk)("div",De,[t[52]||(t[52]=(0,l.Lk)("div",{class:"flex items-center gap-2"},[(0,l.Lk)("div",{class:"w-2 h-2 bg-red-500 rounded-full"}),(0,l.Lk)("span",{class:"text-sm text-gray-700"},"ปิดแล้ว")],-1)),(0,l.Lk)("span",qe,(0,c.v_)(n.ticketCounts.close),1)])])]),(0,l.Lk)("div",Fe,[t[54]||(t[54]=(0,l.Lk)("h3",{class:"text-sm font-medium text-gray-700 mb-3"},"เมนู",-1)),(0,l.Lk)("nav",Ne,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.sidebarMenuItems,(e=>((0,l.uX)(),(0,l.CE)("button",{key:e.value,onClick:t=>n.selectTabAndCloseMobile(e.value),class:(0,c.C4)(["w-full flex items-center gap-3 px-3 py-2 text-sm rounded-lg transition-colors duration-200",{"bg-blue-100 text-blue-700 font-medium":i.selectedTab===e.value,"text-gray-600 hover:bg-gray-100 hover:text-gray-900":i.selectedTab!==e.value}])},[(0,l.Lk)("i",{class:(0,c.C4)([e.icon,"text-sm w-4"])},null,2),(0,l.Lk)("span",Ve,(0,c.v_)(e.label),1),n.ticketCounts[e.value]>0?((0,l.uX)(),(0,l.CE)("span",{key:0,class:(0,c.C4)(["px-2 py-1 text-xs rounded-full",{"bg-blue-200 text-blue-800":i.selectedTab===e.value,"bg-gray-200 text-gray-600":i.selectedTab!==e.value}])},(0,c.v_)(n.ticketCounts[e.value]),3)):(0,l.Q3)("",!0)],10,Oe)))),128))])])])])])):(0,l.Q3)("",!0),i.showAddTicketPopup?((0,l.uX)(),(0,l.CE)("div",ze,[(0,l.Lk)("div",Ke,[t[61]||(t[61]=(0,l.Lk)("div",{class:"border-b border-gray-200 p-4"},[(0,l.Lk)("h2",{class:"text-lg font-semibold text-gray-900"},"เพิ่มตั๋วใหม่")],-1)),(0,l.Lk)("div",We,[(0,l.Lk)("div",null,[t[55]||(t[55]=(0,l.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"หัวข้อ",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>i.newTicket.subject=e),class:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"หัวข้อตั๋ว"},null,512),[[o.Jo,i.newTicket.subject]])]),(0,l.Lk)("div",null,[t[56]||(t[56]=(0,l.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"รายละเอียด",-1)),(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":t[19]||(t[19]=e=>i.newTicket.message=e),class:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:"4",placeholder:"รายละเอียดปัญหา"},null,512),[[o.Jo,i.newTicket.message]])]),(0,l.Lk)("div",Be,[(0,l.Lk)("div",null,[t[58]||(t[58]=(0,l.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"สถานะ",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[20]||(t[20]=e=>i.newTicket.status=e),class:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},t[57]||(t[57]=[(0,l.Lk)("option",{value:"new"},"ใหม่",-1),(0,l.Lk)("option",{value:"open"},"เปิด",-1),(0,l.Lk)("option",{value:"process"},"กำลังดำเนินการ",-1),(0,l.Lk)("option",{value:"close"},"ปิด",-1)]),512),[[o.u1,i.newTicket.status]])]),(0,l.Lk)("div",null,[t[60]||(t[60]=(0,l.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ระดับความสำคัญ",-1)),(0,l.bo)((0,l.Lk)("select",{"onUpdate:modelValue":t[21]||(t[21]=e=>i.newTicket.level=e),class:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},t[59]||(t[59]=[(0,l.Lk)("option",{value:"low"},"ต่ำ",-1),(0,l.Lk)("option",{value:"mid"},"กลาง",-1),(0,l.Lk)("option",{value:"hi"},"สูง",-1)]),512),[[o.u1,i.newTicket.level]])])])]),(0,l.Lk)("div",Je,[(0,l.Lk)("button",{onClick:t[22]||(t[22]=(...e)=>n.closeAddTicketPopup&&n.closeAddTicketPopup(...e)),class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors"}," ยกเลิก "),(0,l.Lk)("button",{onClick:t[23]||(t[23]=(...e)=>n.addNewTicket&&n.addNewTicket(...e)),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors"}," เพิ่มตั๋ว ")])])])):(0,l.Q3)("",!0)],2)}s(44114),s(98992),s(54520),s(72577),s(3949),s(14603),s(47566),s(98721);var Ye=s(40475),Ze=s(40471);const et=new Ze.A(!1);var tt={components:{},props:{headerType:{type:String,default:null,validator:e=>["topbar","breadcrumb","full-admin",null].includes(e)},headerHeight:{type:[Number,String],default:null},customHeight:{type:String,default:null},customClass:{type:String,default:""}},data(){return{loader:!1,title:"Ticket Management",navigationData:[{name:"Add Ticket",function:"callFunction",style:"plus",class:"primary-btn",visible:!0,type:"call-function"}],tickets:[],filteredTickets:[],selectedTicket:null,selectedStatus:"",editingTicket:null,showAddTicketPopup:!1,newTicket:{subject:"",message:"",status:"new",level:"low",image:null},newCommentText:"",configs:Ye.A.get("configs"),session:Ye.A.get("session"),tabs:[{codeName:"e_learning",name:"E-Learning",componentName:"Component4",icon:"list",subText:"หลักสูตร E-Learning"},{codeName:"onsite",name:"On-site",componentName:"Component1",icon:"file-alt",subText:"หลักสูตร On-site"},{codeName:"online_course",name:"On-line",componentName:"Component2",icon:"pencil-ruler",subText:"หลักสูตร On-line"}],selectedTab:"",searchQuery:"",showMobileSidebar:!1,sidebarMenuItems:[{value:"all",label:"ทั้งหมด",icon:"fas fa-list"},{value:"new",label:"ใหม่",icon:"fas fa-plus-circle"},{value:"open",label:"เปิด",icon:"fas fa-folder-open"},{value:"process",label:"กำลังดำเนินการ",icon:"fas fa-spinner"},{value:"close",label:"ปิด",icon:"fas fa-check-circle"}]}},computed:{ticketCounts(){return{all:this.tickets.length,new:this.tickets.filter((e=>"new"===e.status)).length,open:this.tickets.filter((e=>"open"===e.status)).length,process:this.tickets.filter((e=>"process"===e.status)).length,close:this.tickets.filter((e=>"close"===e.status)).length}}},methods:{selectTab(e){this.selectedTab=e,this.filterTickets(),this.selectedTicket=null,this.closeDetail()},async fetchTickets(){try{const e=await et.POST("tickets/query",{method:"find",args:[{$and:[{unit:this.session.current._id}]}]},this.configs.key);200===e.status&&(this.tickets=e.data,this.tickets=this.sortTickets(this.tickets),this.filterTickets())}catch(e){console.error("Error fetching tickets:",e)}},sortTickets(e){return e.sort(((e,t)=>{const s={new:1,open:2,process:3,close:4};return e.pinned===t.pinned?s[e.status]-s[t.status]:e.pinned?-1:1}))},selectTicket(e){this.selectedTicket=e,this.updateUrlItemParam(e._id),this.logAction(e,`Selected ticket: ${e.title}`)},closeDetail(){this.selectedTicket=null,this.removeUrlItemParam()},async updateTicketStatus(e){try{const t=await et.PUT(`tickets/${e._id}`,{data:{status:e.status,pinned:e.pinned}},this.configs.key);200===t.status&&(this.fetchTickets(),this.logAction(e,`Change status: ${e.status}, pinned: ${e.pinned}`))}catch(t){console.error("Error updating ticket status:",t)}},startAddingTicket(){this.showAddTicketPopup=!0,this.newTicket={subject:"",message:"",status:"new",level:"low",image:null}},closeAddTicketPopup(){this.showAddTicketPopup=!1},onImageSelected(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{this.newTicket.image=e.target.result},e.readAsDataURL(t)}},async addNewTicket(){try{const e=await et.POST("tickets/",{data:{title:this.newTicket.subject,content:this.newTicket.message,status:this.newTicket.status,level:this.newTicket.level,date:(new Date).toLocaleDateString(),unit:this.session.current._id,image:this.newTicket.image,logs:[]}},this.configs.key);200===e.status&&(this.tickets.push(e.data),this.closeAddTicketPopup(),this.filterTickets(),this.logAction(e.data,"Add Ticket"))}catch(e){console.error("Error adding new ticket:",e)}},async deleteTicket(e){try{const t=await et.DELETE(`tickets/${e}`,{},this.configs.key);200===t.status&&(this.tickets=this.tickets.filter((t=>t._id!==e)),this.selectedTicket=null,this.closeDetail(),this.fetchTickets())}catch(t){console.error("Error deleting ticket:",t)}},async addComment(){if(""===this.newCommentText.trim())return;const e={id:Date.now(),user:"User",text:this.newCommentText,replies:[]};this.selectedTicket.comments||(this.selectedTicket.comments=[]),this.selectedTicket.comments.push(e),this.newCommentText="",await this.updateTicketContent(this.selectedTicket),1===this.selectedTicket.comments.length&&(this.selectedTicket.status="process",await this.updateTicketStatus(this.selectedTicket),this.logAction(this.selectedTicket,"Add first comment")),this.logAction(this.selectedTicket,"Add comment")},toggleReply(e){e.showReply=!e.showReply,e.replyText||(e.replyText="")},async addReply(e){if(""===e.replyText.trim())return;const t={id:Date.now(),user:"User",text:e.replyText};e.replies||(e.replies=[]),e.replies.push(t),e.replyText="",e.showReply=!1,await this.updateTicketContent(this.selectedTicket)},checkUrlForItem(){const e=new URLSearchParams(window.location.search),t=e.get("item");if(t){const e=this.tickets.find((e=>e._id===t));e&&this.selectTicket(e)}},updateUrlItemParam(e=""){const t=new URL(window.location);e?t.searchParams.set("item",e):t.searchParams.set("item","new"),window.history.pushState({},"",t)},removeUrlItemParam(){const e=new URL(window.location);e.searchParams.delete("item"),window.history.pushState({},"",e),this.fetchTickets()},async pinTicket(e){e.pinned=!e.pinned,await this.updateTicketStatus(e),this.fetchTickets()},shareTicket(){},editTicket(e){this.startEditingTicket(e)},autoResizeTextarea(){const e=this.$refs.textarea;e.style.height="auto",e.style.height=`${e.scrollHeight}px`},filterTickets(){console.log("Filtering tickets for tab:",this.selectedTab),console.log("Search Query:",this.searchQuery),this.filteredTickets=this.tickets.filter((e=>{const t="all"===this.selectedTab||e.status===this.selectedTab,s=!this.searchQuery||(e.title.toLowerCase().includes(this.searchQuery.toLowerCase())||e.content.toLowerCase().includes(this.searchQuery.toLowerCase()));return t&&s})),console.log("Filtered tickets:",this.filteredTickets)},makeSupportRequest(){this.startAddingTicket()},async updateTicketContent(e){try{const t=await et.PUT(`tickets/${e._id}`,{data:{comments:e.comments,status:e.status,image:e.image,logs:e.logs}},this.configs.key);200===t.status&&this.fetchTickets()}catch(t){console.error("Error updating ticket content:",t)}},logAction(e,t){const s={timestamp:(new Date).toISOString(),action:t};e.logs||(e.logs=[]),e.logs.push(s),this.updateTicketContent(e)},closeTicket(e){e.status="close",this.updateTicketStatus(e),this.logAction(e,"Close ticket")},getStatusLabel(e){const t={new:"ใหม่",open:"เปิด",process:"กำลังดำเนินการ",close:"ปิด"};return t[e]||e},getStatusClass(e){const t={new:"bg-green-100 text-green-800",open:"bg-yellow-100 text-yellow-800",process:"bg-blue-100 text-blue-800",close:"bg-red-100 text-red-800"};return t[e]||""},getLevelLabel(e){const t={low:"ต่ำ",mid:"กลาง",hi:"สูง"};return t[e]||e},getLevelClass(e){const t={low:"bg-green-100 text-green-800",mid:"bg-yellow-100 text-yellow-800",hi:"bg-red-100 text-red-800"};return t[e]||""},toggleMobileSidebar(){this.showMobileSidebar=!this.showMobileSidebar},selectTabAndCloseMobile(e){this.selectTab(e),this.toggleMobileSidebar()},refreshTickets(){this.fetchTickets()},calculateHeaderHeight(){if(this.customHeight||this.headerHeight){if(this.headerHeight){const e="number"===typeof this.headerHeight?`${this.headerHeight}px`:this.headerHeight;document.documentElement.style.setProperty("--header-height",e)}return}if(!this.$el||"function"!==typeof this.$el.getBoundingClientRect){console.log("Ticket Component: Element not ready yet, using default height");const e=window.innerWidth<=768?56:80;return void document.documentElement.style.setProperty("--header-height",`${e}px`)}let e=0;const t=["header",".header",".navbar",".topbar",".breadcrumb",".access-bar",'[class*="header"]','[class*="navbar"]','[class*="topbar"]','[role="banner"]'];if(t.forEach((t=>{try{const s=document.querySelectorAll(t);s.forEach((t=>{t&&this.isElementAbove(t)&&(e+=t.offsetHeight)}))}catch(s){console.warn(`Error checking element with selector ${t}:`,s)}})),0===e)switch(this.headerType){case"topbar":e=120;break;case"breadcrumb":e=140;break;case"full-admin":e=160;break;default:e=window.innerWidth<=768?56:80}e+=8,document.documentElement.style.setProperty("--header-height",`${e}px`),console.log(`Ticket Component: Calculated header height = ${e}px`)},isElementAbove(e){if(!e||!this.$el||"function"!==typeof this.$el.getBoundingClientRect)return!1;try{const t=e.getBoundingClientRect(),s=this.$el.getBoundingClientRect();return t.bottom<=s.top}catch(t){return console.warn("Error in isElementAbove (Ticket):",t),!1}}},mounted(){this.fetchTickets(),this.$nextTick((()=>{setTimeout((()=>{if(this.$el&&"function"===typeof this.$el.getBoundingClientRect)this.calculateHeaderHeight(),window.addEventListener("resize",this.calculateHeaderHeight);else{console.warn("Ticket DOM element not ready, skipping header height calculation");const e=window.innerWidth<=768?56:80;document.documentElement.style.setProperty("--header-height",`${e}px`)}}),100)})),this.$nextTick((()=>{"#open"===window.location.hash?this.selectTab("open"):this.selectTab("all"),this.$refs.textarea}))},beforeUnmount(){window.removeEventListener("resize",this.calculateHeaderHeight)}},st=s(64621);const lt=(0,st.A)(tt,[["render",Ge],["__scopeId","data-v-1c58cc91"]]);var at=lt,it={name:"TicketList",components:{List:at},data(){return{login:Ye.A.get("session","login"),manualHeaderHeight:216}},computed:{dynamicHeaderHeight(){const e=null!==document.querySelector(".topbar"),t=null!==document.querySelector(".breadcrumb");let s=80;return e&&(s+=40),t&&(s+=40),s},customContainerHeight(){return`calc(100vh - ${this.manualHeaderHeight}px)`}},methods:{showAlert(){this.$swal("Hello Vue world!!!")},updateHeaderHeight(e){this.manualHeaderHeight=e}},setup(){const e=(0,n.lq)(),t=e.meta.title;(0,i.K7)(t)}};const nt=(0,st.A)(it,[["render",a]]);var ct=nt}}]);
//# sourceMappingURL=7207.43b8a020.js.map