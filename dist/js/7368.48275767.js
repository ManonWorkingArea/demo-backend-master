"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[7368],{41133:function(e,n,t){t.d(n,{A:function(){return z}});var s=t(20641),o=t(90033),i=t(53751);const l={class:"mx-auto"},c={class:"flex justify-between items-center mb-4 border-b pb-2 pt-2 pl-2 pr-2 border-gray-200"},r={key:0,class:"p-4"},a={class:"grid grid-cols-1 md:grid-cols-2 gap-2"},u={class:"flex items-center justify-between"},d=["onClick"],f={class:"text-xs text-gray-500 mt-1"},p={class:"text-sm text-gray-600 mt-1"},h={class:"mt-4 flex justify-between"},m={class:"space-x-2"},g=["onClick"],y=["onClick"],b={class:"space-x-2"},k=["onClick"],v=["onClick"],I={key:1,class:"p-4"},x={key:0,class:"fixed inset-0 flex items-center justify-center"},w={class:"bg-white rounded p-5 z-10"},L={class:"flex flex-col space-y-2"},C={class:"flex items-center space-x-2"},D={class:"flex justify-end mt-6 space-x-4"},A={key:1,class:"fixed inset-0 flex items-center justify-center z-50"},_={class:"bg-white rounded p-5 z-10"},R={class:"flex justify-end mt-6 space-x-4"};function M(e,n,t,M,E,P){const T=(0,s.g2)("font-awesome-icon"),j=(0,s.g2)("InfluencerDetail");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",l,[(0,s.Lk)("div",null,[(0,s.Lk)("div",c,[n[10]||(n[10]=(0,s.Lk)("h3",{class:"text-md font-bold"},"Influencers",-1)),(0,s.Lk)("button",{onClick:n[0]||(n[0]=e=>P.addInfluencer("main")),class:"primary-btn px-4 py-2 bg-blue-500 text-white rounded shadow-sm hover:bg-blue-600"}," เพิ่ม Influencer ")]),E.selectedInfluencerForDetails?((0,s.uX)(),(0,s.CE)("div",I,[(0,s.bF)(j,{influencer:E.selectedInfluencerForDetails,onBack:n[1]||(n[1]=e=>E.selectedInfluencerForDetails=null)},null,8,["influencer"])])):((0,s.uX)(),(0,s.CE)("div",r,[(0,s.Lk)("div",a,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(P.flattenedInfluencers,(e=>((0,s.uX)(),(0,s.CE)(s.FK,null,["main"===e.type?((0,s.uX)(),(0,s.CE)("div",{key:e._id,class:"bg-white p-5 rounded-sm shadow-sm"},[(0,s.Lk)("div",u,[(0,s.Lk)("h3",{onClick:n=>P.showInfluencerDetails(e),class:"text-md font-semibold cursor-pointer hover:text-blue-600"},(0,o.v_)(P.getMainInfluencerIndex(e))+"."+(0,o.v_)(e.name),9,d)]),(0,s.Lk)("p",f,(0,o.v_)(e.code),1),(0,s.Lk)("p",p,(0,o.v_)(e.description),1),(0,s.Lk)("div",h,[(0,s.Lk)("div",m,[(0,s.Lk)("button",{onClick:n=>P.moveMainInfluencerUp(e),class:"text-sm text-gray-500 hover:text-gray-700"},[(0,s.bF)(T,{icon:["fas","chevron-up"],class:"pr-2 pl-2"})],8,g),(0,s.Lk)("button",{onClick:n=>P.moveMainInfluencerDown(e),class:"text-sm text-gray-500 hover:text-gray-700"},[(0,s.bF)(T,{icon:["fas","chevron-down"],class:"pr-2 pl-2"})],8,y)]),(0,s.Lk)("div",b,[(0,s.Lk)("button",{onClick:n=>P.openRenameDialog(e),class:"text-sm text-gray-500 hover:text-gray-700"},[(0,s.bF)(T,{icon:["fas","edit"],class:"pl-2"}),n[11]||(n[11]=(0,s.eW)(" เปลี่ยนชื่อ "))],8,k),(0,s.Lk)("button",{onClick:n=>P.removeMainInfluencerConfirmation(e),class:"text-sm text-red-500 hover:text-red-700"},[(0,s.bF)(T,{icon:["fas","trash"],class:"pl-2"}),n[12]||(n[12]=(0,s.eW)(" ลบ "))],8,v)])])])):(0,s.Q3)("",!0)],64)))),256))])]))])]),E.showRenameDialog?((0,s.uX)(),(0,s.CE)("div",x,[n[18]||(n[18]=(0,s.Lk)("div",{class:"absolute inset-0 bg-black opacity-75",style:{"z-index":"10"}},null,-1)),(0,s.Lk)("div",w,[n[17]||(n[17]=(0,s.Lk)("h4",{class:"text-xl font-semibold mb-4"},"เปลี่ยนชื่อ Main Influencer",-1)),(0,s.Lk)("div",L,[n[14]||(n[14]=(0,s.Lk)("label",{for:"newName",class:"font-medium"},"ชื่อใหม่",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":n[2]||(n[2]=e=>E.selectedInfluencer.name=e),type:"text",id:"newName",placeholder:"Enter the new name",class:"px-4 py-2 border border-gray-300 rounded-sm focus:outline-none focus:ring focus:border-blue-500"},null,512),[[i.Jo,E.selectedInfluencer.name]]),n[15]||(n[15]=(0,s.Lk)("label",{for:"newCode",class:"font-medium"},"รหัสใหม่",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>E.selectedInfluencer.code=e),type:"text",id:"newCode",placeholder:"Enter the new code",class:"px-4 py-2 border border-gray-300 rounded-sm focus:outline-none focus:ring focus:border-blue-500"},null,512),[[i.Jo,E.selectedInfluencer.code]]),n[16]||(n[16]=(0,s.Lk)("label",{for:"newDescription",class:"font-medium"},"คำอธิบาย",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":n[4]||(n[4]=e=>E.selectedInfluencer.description=e),id:"newDescription",placeholder:"Enter the new description",class:"px-4 py-2 border border-gray-300 rounded-sm focus:outline-none focus:ring focus:border-blue-500"},null,512),[[i.Jo,E.selectedInfluencer.description]]),(0,s.Lk)("div",C,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":n[5]||(n[5]=e=>E.selectedInfluencer.visible=e),type:"checkbox",id:"checkbox"},null,512),[[i.lH,E.selectedInfluencer.visible]]),n[13]||(n[13]=(0,s.Lk)("label",{for:"checkbox",class:"font-medium"},"Visible",-1))])]),(0,s.Lk)("div",D,[(0,s.Lk)("button",{onClick:n[6]||(n[6]=e=>P.renameInfluencer(E.selectedInfluencer)),class:"px-6 py-2 text-sm font-medium text-white bg-blue-500 rounded-sm hover:bg-blue-600"},"Rename"),(0,s.Lk)("button",{onClick:n[7]||(n[7]=(...e)=>P.closeRenameDialog&&P.closeRenameDialog(...e)),class:"px-6 py-2 text-sm font-medium text-gray-500 hover:text-gray-700"},"Cancel")])])])):(0,s.Q3)("",!0),E.showConfirmationPopup?((0,s.uX)(),(0,s.CE)("div",A,[n[21]||(n[21]=(0,s.Lk)("div",{class:"absolute inset-0 bg-black opacity-75"},null,-1)),(0,s.Lk)("div",_,[n[19]||(n[19]=(0,s.Lk)("h4",{class:"text-xl font-semibold mb-4"},"Confirm Remove Main Influencer",-1)),n[20]||(n[20]=(0,s.Lk)("p",null,"Are you sure you want to remove the main influencer?",-1)),(0,s.Lk)("div",R,[(0,s.Lk)("button",{onClick:n[8]||(n[8]=(...e)=>P.confirmRemoveMainInfluencer&&P.confirmRemoveMainInfluencer(...e)),class:"px-6 py-2 text-sm font-medium text-white bg-red-500 rounded-sm"},"Remove"),(0,s.Lk)("button",{onClick:n[9]||(n[9]=(...n)=>e.cancelRemoveMainInfluencer&&e.cancelRemoveMainInfluencer(...n)),class:"px-6 py-2 text-sm font-medium text-gray-500 hover:text-gray-700"},"Cancel")])])])):(0,s.Q3)("",!0)],64)}t(44114),t(98992),t(54520),t(8872);var E=t(40475);const P={class:"p-5 bg-white rounded shadow-sm"},T={class:"text-xl font-bold"},j={class:"text-gray-500 mt-2"},F={class:"text-gray-600 mt-2"},N={class:"mt-4 space-x-2"};function X(e,n,t,i,l,c){return(0,s.uX)(),(0,s.CE)("div",P,[(0,s.Lk)("h3",T,(0,o.v_)(t.influencer.name),1),(0,s.Lk)("p",j,(0,o.v_)(t.influencer.code),1),(0,s.Lk)("p",F,(0,o.v_)(t.influencer.description),1),(0,s.Lk)("div",N,[(0,s.Lk)("button",{onClick:n[0]||(n[0]=n=>e.$emit("back")),class:"px-4 py-2 text-sm bg-blue-500 text-white rounded"},"Back")])])}var U={name:"InfluencerDetail",props:{influencer:{type:Object,required:!0}}},S=t(64621);const q=(0,S.A)(U,[["render",X],["__scopeId","data-v-d11bf076"]]);var O=q,J={name:"InfluencerList",components:{InfluencerDetail:O},props:{eventDetails:{type:Object,required:!0}},data(){return{session:E.A.get("session"),configs:E.A.get("configs"),influencers:[],uniqueIdCounter:5,showRenameDialog:!1,selectedInfluencer:null,showMoveDialog:!1,selectedInfluencerParent:null,showConfirmationPopup:!1,influencerToRemove:null,showSubInfluencerConfirmationPopup:!1,subInfluencerToRemove:null,selectedInfluencerForDetails:null}},computed:{flattenedInfluencers(){return this.flattenInfluencers(this.influencers)},getMainInfluencers(){return this.influencers.filter((e=>"main"===e.type))}},async mounted(){try{console.log("Event Details:",this.eventDetails),await this.getInfluencerData()}catch(e){console.log(e)}},methods:{showInfluencerDetails(e){this.selectedInfluencerForDetails=e},async getInfluencerData(){try{const e=await fetch("https://gateway.cloudrestfulapi.com/api/vote_influencer/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({method:"find",args:[{unit:this.session.current._id,eventID:this.eventDetails._id}],paging:{page:1,limit:200}})});if(e.ok){const n=await e.json();this.influencers=n.data}}catch(e){console.error(e)}},async addInfluencer(e,n){try{const t={unit:this.session.current._id,name:"New Influencer",code:"influencer-code",description:"Description for New Influencer",type:"main",eventID:this.eventDetails._id,visible:!0,order:0};"sub"===e&&(t.type="sub",t.parent=n._id);const s=await fetch("https://gateway.cloudrestfulapi.com/api/vote_influencer/",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:t,options:{}})});s.ok&&await this.getInfluencerData()}catch(t){console.error(t)}},async updateInfluencer(e){try{const n=await fetch("https://gateway.cloudrestfulapi.com/api/vote_influencer/"+e._id,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{name:e.name,code:e.code,description:e.description,order:e.order,visible:e.visible},options:{}})});n.ok&&await this.getInfluencerData()}catch(n){console.error(n)}},async deleteInfluencer(e){try{const n=await fetch("https://gateway.cloudrestfulapi.com/api/vote_influencer/"+e._id,{method:"DELETE",headers:{"Content-Type":"application/json","client-token-key":this.configs.key}});n.ok&&await this.getInfluencerData()}catch(n){console.error(n)}},getMainInfluencerIndex(e){const n=this.flattenedInfluencers.filter((e=>"main"===e.type));return n.findIndex((n=>n._id===e._id))+1},flattenInfluencers(e){return e.reduce(((e,n)=>{if(e.push(n),"main"===n.type){const t=this.influencers.filter((e=>"sub"===e.type&&e.parent===n._id));e.push(...t)}return e}),[])},moveMainInfluencerUp(e){const n=this.influencers.findIndex((n=>n._id===e._id&&"main"===n.type));if(n>0){const e=this.influencers.splice(n,1)[0];this.influencers.splice(n-1,0,e)}},moveMainInfluencerDown(e){const n=this.influencers.findIndex((n=>n._id===e._id&&"main"===n.type));if(n<this.influencers.length-1){const e=this.influencers.splice(n,1)[0];this.influencers.splice(n+1,0,e)}},async removeMainInfluencerConfirmation(e){this.influencerToRemove=e,this.showConfirmationPopup=!0},async confirmRemoveMainInfluencer(){try{const e=this.influencerToRemove,n=this.influencers.findIndex((n=>n._id===e._id&&"main"===n.type));if(-1!==n){const t=this.influencers.splice(n,1)[0],s=this.influencers.filter((e=>"sub"===e.type&&e.parent===t._id));this.influencers=this.influencers.filter((e=>"sub"!==e.type||e.parent!==t._id));for(const e of s)await this.deleteInfluencer(e);await this.deleteInfluencer(e)}this.influencerToRemove=null,this.showConfirmationPopup=!1}catch(e){console.error(e)}},openRenameDialog(e){this.selectedInfluencer=e,this.showRenameDialog=!0},async renameInfluencer(e){try{await this.updateInfluencer(e),this.selectedInfluencer=null,this.showRenameDialog=!1}catch(n){console.error(n)}},closeRenameDialog(){this.selectedInfluencer=null,this.showRenameDialog=!1},openMoveDialog(e){this.selectedInfluencer=e,this.selectedInfluencerParent=null,this.showMoveDialog=!0},async updateSelectedInfluencerParent(){try{const e=this.selectedInfluencer,n=this.selectedInfluencerParent;n&&(e.parent=n,await this.updateInfluencer(e)),this.selectedInfluencer=null,this.selectedInfluencerParent=null,this.showMoveDialog=!1}catch(e){console.error(e)}},closeMoveDialog(){this.selectedInfluencer=null,this.selectedInfluencerParent=null,this.showMoveDialog=!1}}};const V=(0,S.A)(J,[["render",M],["__scopeId","data-v-5af51a49"]]);var z=V},74284:function(e,n,t){t.d(n,{A:function(){return d}});var s=t(20641);function o(e,n,t,o,i,l){return(0,s.uX)(),(0,s.CE)("div")}var i=t(75220),l=t(63084),c=t(40475),r={name:"Authen",data(){return{configs:c.A.get("configs"),session:c.A.get("session")}},created(){l.A.option(this.$route)},computed:{},components:{},mounted(){this.checkAuth()},updated(){},methods:{async checkAuth(){const e=(0,i.lq)(),n=e.meta.auth,t=e.name,s=c.A.get("session");let o=s.token,r=s.login,a=s.current;l.A.log("hasLogin",r),l.A.log("Page -> Auth:",n),l.A.log("User -> Token:",o),l.A.log("User -> Login:",r),"frontend"===this.session.interface?l.A.log("Front-End"):"backend"===this.session.interface&&(l.A.log("Back-End"),r?("Login"==t||void 0==a?(l.A.log("Not Login Again"),this.$router.replace({path:"/"})):(l.A.log("Has School Active"),n?(l.A.log("This page is : Authen Request"),""===o||null===o||void 0==o?l.A.log("Your Cannot Access"):l.A.log("Your Can Access")):l.A.log("This page is : No Authen Request")),l.A.log("Login")):(l.A.log("Not Login"),"Login"!=t?(window.location.href="/member/login",l.A.log("Not Login Page",t)):l.A.log("Login Page",t)))}},setup(){}},a=t(64621);const u=(0,a.A)(r,[["render",o]]);var d=u}}]);
//# sourceMappingURL=7368.48275767.js.map