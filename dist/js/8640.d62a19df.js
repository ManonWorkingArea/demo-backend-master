"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[8640],{86259:function(e,t,n){n.r(t),n.d(t,{default:function(){return $}});var o=n(20641);function s(e,t,n,s,a,r){return(0,o.uX)(),(0,o.Wv)((0,o.$y)(r.componentName))}var a=n(52968),r=n(75220),i=n(40475),l=n(90033),c=n(53751);const d={class:"bg-gray-50"},u={class:"flex min-h-full flex-col justify-center py-12 sm:px-6 lg:px-8"},m={class:"sm:mx-auto sm:w-full sm:max-w-lg"},p=["src"],g={class:"mt-2 text-center text-sm text-gray-600"},f={class:"bg-white px-4 py-8 shadow sm:rounded-lg sm:px-10"},h={class:"mt-2"},b={class:"mt-2"},y={key:0,class:"col-span-2"},x={class:"items-center px-3 py-1 rounded-md bg-red-100 text-sm text-black pb-5 mb-5"},w={class:"w-full"},v=["disabled"];function k(e,t,n,s,a,r){const i=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",d,[(0,o.Lk)("div",u,[(0,o.Lk)("div",m,[this.showModal?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("img",{key:0,class:"mx-auto h-24 w-auto",src:this.config.siteLogo,alt:"Your Company"},null,8,p)),t[6]||(t[6]=(0,o.Lk)("h2",{class:"mt-6 text-center text-3xl font-bold tracking-tight text-gray-900"},"เปลี่ยนรหัสผ่าน FTI Academy",-1)),(0,o.Lk)("p",g,[t[5]||(t[5]=(0,o.eW)(" หรือ ")),(0,o.bF)(i,{to:"/student/register",class:"font-medium text-indigo-600 hover:text-indigo-500"},{default:(0,o.k6)((()=>t[4]||(t[4]=[(0,o.eW)(" ลงทะเบียนผู้อบรมใหม่ ")]))),_:1})])]),(0,o.Lk)("div",{class:(0,l.C4)(["mt-8 sm:mx-auto sm:w-full sm:max-w-md relative",[e.activeBlock?"isblock":"isunblock"]]),"data-content":"กำลังติดต่อฐานข้อมูล กรุณารอสักครู่....."},[(0,o.Lk)("div",f,[(0,o.Lk)("form",{class:"space-y-6",onSubmit:t[3]||(t[3]=(0,c.D$)(((...e)=>r.changePassword&&r.changePassword(...e)),["prevent"]))},[(0,o.Lk)("div",null,[t[7]||(t[7]=(0,o.Lk)("label",{for:"new-password",class:"block text-md font-semibold leading-6 text-gray-900"},"รหัสผ่านใหม่",-1)),(0,o.Lk)("div",h,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.password=e),id:"new-password",name:"new-password",type:"password",autocomplete:"new-password",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[c.Jo,a.password]])])]),(0,o.Lk)("div",null,[t[8]||(t[8]=(0,o.Lk)("label",{for:"confirm-password",class:"block text-md font-semibold leading-6 text-gray-900"},"ยืนยันรหัสผ่านใหม่",-1)),(0,o.Lk)("div",b,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.confirmPassword=e),id:"confirm-password",name:"confirm-password",type:"password",autocomplete:"new-password",required:"",class:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[c.Jo,a.confirmPassword]])])]),(0,o.Lk)("div",null,[a.errorStage?((0,o.uX)(),(0,o.CE)("div",y,[(0,o.Lk)("div",x,[t[9]||(t[9]=(0,o.Lk)("div",{class:"font-semibold pt-3 pb-3"},"เกิดข้อผิดพลาด",-1)),(0,o.Lk)("div",w,(0,l.v_)(a.errorMessage),1)])])):(0,o.Q3)("",!0),(0,o.Lk)("button",{type:"submit",disabled:e.buttonDisabled,class:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-4 text-md font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},(0,l.v_)(a.buttonText),9,v),(0,o.Lk)("button",{onClick:t[2]||(t[2]=e=>r.logout()),class:"flex w-full justify-center rounded-md bg-gray-300 text-md font-semibold text-gray-700 shadow-sm hover:bg-gray-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600 mt-4 py-2"}," ออกจากระบบ ")])],32)])],2)])])}n(44114);var L=n(25747),S=n(21396),j=n.n(S),A={name:"Login",components:{},props:{showModal:{type:Boolean,default:!1}},data(){return{config:i.A.get("configs"),session:i.A.get("session","user"),password:"",confirmPassword:"",errorStage:!1,errorMessage:"",buttonText:"เปลี่ยนรหัสผ่าน"}},created(){this.session&&this.session.req_reset||this.$router.push("/student/login")},methods:{logout(){this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:500,icon:"success",title:"แจ้งเตือน",text:"ออกจากระบบเรียบร้อยแล้ว"}).then((()=>{i.A.delete("session"),window.location.href="/"}))},async changePassword(){try{this.activeBlock=!0,this.errorStage=!1;const e=this.password,t=this.confirmPassword;if(e!==t)return this.activeBlock=!1,this.errorStage=!0,this.errorMessage="รหัสผ่านไม่ตรงกัน",void(this.buttonText="เปลี่ยนรหัสผ่าน");const n=j().lib.WordArray.random(16),o=j().SHA256(e+n).toString(),s=await fetch(`https://gateway.cloudrestfulapi.com/api/user/${this.session._id}`,{method:"PUT",headers:{"Content-Type":"application/json","client-token-key":this.configs.key},body:JSON.stringify({data:{password:o,salt:n.toString(),req_reset:!1}})}),a=await s.json();console.log(a);const r={email:this.session.email,name:this.session.firstname+""+this.session.lastname};await(0,L.Z)(r,"change-password"),this.$swal({icon:"success",title:"การเปลี่ยนรหัสผ่านใหม่เรียบร้อยแล้ว",text:"ระบบได้ทำการเปลี่ยนรหัสผ่านใหม่เรียบร้อยแล้ว กรุณาเข้าสู่ระบบด้วยรหัสผ่านใหม่อีกครั้ง",showCancelButton:!1,confirmButtonText:"ตกลง"}).then((()=>{i.A.delete("session"),this.$router.push("/student/login")})),this.activeBlock=!1}catch(e){console.log(e),this.buttonText="เปลี่ยนรหัสผ่าน",this.buttonDisabled=!1}}}},T=n(64621);const E=(0,T.A)(A,[["render",k]]);var B=E,C={name:"Lesson Detail",components:{Frontend:B},data(){return{session:i.A.get("session")}},setup(){const e=(0,r.lq)(),t=e.meta.title;(0,a.K7)(t)},computed:{componentName(){return"Frontend"}}};const P=(0,T.A)(C,[["render",s]]);var $=P},25747:function(e,t,n){n.d(t,{Z:function(){return m}});var o=n(40475);const s=`\n<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Email Template</title>\n  <style>\n    /* Add your custom CSS styles here */\n    /* For example: */\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n      text-align: center;\n    }\n    body {\n      font-family: Arial, sans-serif;\n      line-height: 1.5;\n      background-color: #f2f2f2;\n      color: #ffffff;\n    }\n    .container {\n      max-width: 600px;\n      margin: 0px auto;\n      padding: 20px;\n      background-color: #ffffff;\n      border-radius: 5px;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n    }\n    .header img {\n      max-width: 150px;\n      height: auto;\n    }\n    .content {\n      padding: 20px;\n      border-top: 1px solid #e6e6e6;\n      border-bottom: 1px solid #e6e6e6;\n    }\n    .heading {\n      font-size: 18px;\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: center;\n    }\n    .text {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .container p {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .text p {\n      margin-bottom: 20px;\n      color: #000000;\n      text-align: left;\n      font-size: 16px;\n    }\n    .footer {\n      text-align: center;\n      margin-top: 20px;\n      color: #888888;\n      font-size: 14px;\n    }\n    .footer a {\n      color: #888888;\n      text-decoration: none;\n      transition: color 0.3s ease;\n    }\n    .footer a:hover {\n      color: #ffffff;\n    }\n  </style>\n</head>\n<body>\n  <div class="container" style="margin-top:20px;">\n    <div class="header">\n      <img src="https://vue-project.sgp1.digitaloceanspaces.com/Logo/color-logopng.png" alt="Logo">\n    </div>\n    <div class="content">\n      <h2 class="heading">{{ subject }}</h2>\n      <p class="text">{{ content }}</p>\n    </div>\n    <div class="footer">\n      &copy; ${(new Date).getFullYear()} {{ provider }}. All rights reserved.</a>\n    </div>\n  </div>\n</body>\n</html>\n`;var a=n(21396),r=n.n(a),i=n(40471);const l=new i.A(!1),c="https://gateway.cloudrestfulapi.com/email/send",d=o.A.get("session"),u=o.A.get("configs");async function m(e,t=""){let n;"frontend"===d.interface?({email_provider:n}=u):({email_provider:n}=d.current);const{name:o,email:a,subject:r,body:i}=e;try{let d,m;"welcome"===t?({emailBody:d,emailSubject:m}=h(e)):"reset-password"===t?({emailBody:d,emailSubject:m}=await y(e)):"change-password"===t?({emailBody:d,emailSubject:m}=await b(e)):"new-template"===t?({emailBody:d,emailSubject:m}=f(e)):(d=i,m=r),d=s.replace("{{ content }}",d).replace("{{ subject }}",m).replace("{{ provider }}",n);const x=await p(o,a,m,d),w=await l.POST(c,{subject:m,text:d,html:d,fromEmail:"noreply@fti.academy",fromName:"Academy Customer Support",toEmail:a,toName:o},u.key);if(200===w.status){const e=w.data;return console.log(e.message),await g(x._id,"confirm"),e}{console.log("Failed to send email");const e="Failed to send email";return await g(x._id,"fail",e),e}}catch(m){return console.error("Error sending email:",m),m.message}}async function p(e,t,n,o){try{const s={data:{name:e,email:t,subject:n,body:o,status:"submit"},options:{fieldType:[],uniqueFields:[]}},{status:a,data:r}=await l.POST("message/",s,u.key);return 200===a?(console.log("Email data recorded successfully"),r):"Failed to record email data"}catch(s){return console.error("Error recording email data:",s),s.message}}async function g(e,t,n=""){try{const o={data:{status:t,error:n}},{status:s}=await l.PUT(`message/${e}`,o,u.key);if(200!==s)return"Failed to update email status";console.log("Email status updated successfully")}catch(n){return console.error("Error updating email status:",n),n.message}}function f(e){const t=`Hello ${e.name},\n\nThis is your custom email body.\n\nYour custom data: ${e.content}`,n="Custom Email";return{emailBody:t,emailSubject:n}}function h(){const e="Welcome to our website!",t="Welcome Email";return{emailBody:e,emailSubject:t}}function b(){const e="\n  <p>สวัสดีค่ะ,</p>\n  <p>ขอแจ้งให้ทราบว่าบัญชีของคุณได้รับการเปลี่ยนแปลงรหัสผ่านเรียบร้อยแล้วค่ะ</p>\n  <p>หากคุณไม่ได้ดำเนินการเปลี่ยนรหัสผ่านนี้ กรุณาติดต่อทีมงานเพื่อรายงานให้ทราบค่ะ</p></br></br>\n  <p>ขอบคุณค่ะ</p>\n  ",t="แจ้งเตือน: บัญชีของคุณได้รับการเปลี่ยนรหัสผ่าน";return{emailBody:e,emailSubject:t}}async function y(e){try{const n={method:"find",args:[{$and:[{email:e.email}]}]},{data:o}=await l.POST("user/query",n,u.key);if(o.length>0){const e=x(6),n=r().lib.WordArray.random(16),s=r().SHA256(e+n).toString();try{const e={data:{password:s,salt:n.toString(),req_reset:!0}},{status:t}=await l.PUT(`user/${o[0]._id}`,e,u.key);if(200!==t)return"Failed to update email status";console.log("Email status updated successfully")}catch(t){return console.error("Error updating email status:",t),t.message}const a="แจ้งเตือน: รีเซ็ตรหัสผ่าน",i=`\n        <p>สวัสดีค่ะ,</p>\n        <p>ขอแจ้งให้ทราบว่าบัญชีของคุณได้รับการเปลี่ยนแปลงรหัสผ่านเรียบร้อยแล้วค่ะ</p>\n        <p>รหัสผ่านใหม่ของคุณคือ: <strong>${e}</strong></p>\n        <p>โปรดจำรหัสผ่านใหม่นี้ไว้เพื่อเข้าสู่ระบบในครั้งถัดไปค่ะ</p>\n        <p>หากคุณไม่ได้ดำเนินการเปลี่ยนรหัสผ่านนี้ กรุณาติดต่อทีมงานเพื่อรายงานให้ทราบค่ะ</p></br></br>\n        <p>ขอบคุณค่ะ</p>\n      `;return{emailBody:i,emailSubject:a}}return console.log("No User"),"User not found"}catch(t){return console.error("Error retrieving user information:",t),t.message}}function x(e){const t="0123456789";let n="";for(let o=0;o<e;o++){const e=Math.floor(Math.random()*t.length);n+=t[e]}return n}}}]);
//# sourceMappingURL=8640.d62a19df.js.map