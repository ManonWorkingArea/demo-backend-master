{"version":3,"file":"js/9173.7134bca6.js","mappings":"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","sources":["webpack://node-backend/./src/extensions/modules/elearning/lesson/view/course/Cetification.vue","webpack://node-backend/./src/extensions/modules/elearning/lesson/component/course/frontend/Cetification.vue","webpack://node-backend/./src/extensions/modules/elearning/lesson/component/course/frontend/Cetification.vue?a4f4","webpack://node-backend/./src/extensions/modules/elearning/lesson/view/course/Cetification.vue?0b22"],"sourcesContent":["<template>\n    <component :is=\"componentName\" />\n    </template>\n    \n    <script>\n    import { useTitle } from 'vue-page-title';\n    import { useRoute } from 'vue-router';\n    import storageManager from '@/plugins/storage';\n    import Frontend from '../../component/course/frontend/Cetification.vue';\n    \n    export default {\n    name: 'Lesson Play',\n    components: {\n        Frontend,\n    },\n    data() {\n        return {\n            session: storageManager.get('session')\n        };\n    },\n    setup() {\n        const route = useRoute();\n        const routeName = route.meta.title;\n        useTitle(routeName);\n    },\n    computed: {\n        componentName() {\n            return 'Frontend';\n        }\n    }\n    };\n    </script>\n        ","<script>\nimport html2canvas from \"html2canvas\";\n//import jsPDF from \"jspdf\";\nimport QRCode from \"qrcode\";\nimport convertUtils from \"@/plugins/convertUtils\";\nimport storageManager from '@/plugins/storage';\n\nimport ResultComponent from '../resource/CertificationRender.vue';\n\nimport requestClient from '@/plugins/requestClient';\nconst Request = new requestClient(false);\n\nimport debug from '@/plugins/Logger.js';\n\nexport default {\n  components: {\n    ResultComponent,\n  },\n  name: \"Certification\",\n  props: {\n    dataItem: {\n      type: String,\n      default: null,\n    },\n    userId: {\n      type: String,\n      default: null,\n    },\n  },\n  data() {\n    return {\n      configs: storageManager.get('configs'),\n      session: storageManager.get('session'),\n      certification: [],\n      lesson: [],\n      user: [],\n      cert: {\n        image: \"\",\n      },\n      qrCodeUrl: null,\n      showImage: false,\n      certImageSrc: null,\n      certificationTemplate: [],\n      certMode:\"\",\n      backgroundImage: null,\n      courseIDs: ['646399b1db2e5913d490fdc1', '646399b3db2e5913d490fdc2', '646399b5db2e5913d490fdc3', '646399b6db2e5913d490fdc4', '646399b8db2e5913d490fdc5', '65c967c4e83775a8e0d42771', '64ba0f8e95b73060a5db8674'],\n    };\n  },\n  computed: {\n    resolvedDataItem() {\n      return this.dataItem || this.$route.params.cid;\n    },\n    resolvedUserId() {\n      return this.userId || this.$route.params.uid;\n    },\n  },\n  async mounted() {\n    try {\n      if (this.resolvedUserId) {\n        this.certMode = \"new\"\n        await this.getUserAndCertificationData();\n      } else {\n        this.certMode = \"old\"\n        await this.getData();\n      }\n    } catch (error) {\n      debug.log(error);\n    }\n  },\n  methods: {\n    handleBackgroundImage(imageUrl) {\n      this.backgroundImage = imageUrl;\n    },\n    getCustomStyle() {\n      debug.log(\"Theme\", this.cert.template);\n      if (this.cert.template === 'custom') {\n        return {\n          backgroundColor: 'red',\n          fontSize: '16px',\n          paddingTop: '400px',\n        };\n      } else {\n        return {};\n      }\n    },\n    formatDateWithAge(date, age) {\n      const newDate = new Date(date);\n      const ageNumber = parseInt(age, 10);\n      newDate.setFullYear(newDate.getFullYear() + ageNumber);\n      debug.log(\"date\", date);\n      debug.log(\"newDate\", newDate);\n      return this.formatThaidate(newDate, 'date');\n    },\n    formatThaidate(date) {\n      return convertUtils.toThaiDatetime(date, 'date');\n    },\n    async generateQRCode() {\n      try {\n        const url = \"https://fti.academy/lesson/certification/\" + this.resolvedDataItem + \"/\" + this.resolvedUserId;\n        const qrCodeUrl = await QRCode.toDataURL(url);\n        this.qrCodeUrl = qrCodeUrl;\n      } catch (error) {\n        console.error(error);\n      }\n    },\n    downloadPDF() {\n      this.$refs.resultComponentRef.captureDivAsCanvas();\n      /*\n      html2canvas(this.$refs.resultComponentRef.$el, {\n        useCORS: true,\n        allowTaint: true,\n        scale: 4, // Increase the scale for higher resolution (you can experiment with values 3, 4, or higher)\n        dpi: 600, // Add this to increase DPI (dots per inch)\n        imageSmoothingEnabled: true, // Smoothens the image\n      }).then((resultComponentCanvas) => {\n        const resultComponentImage = resultComponentCanvas.toDataURL(\"image/png\");\n\n        const pdf = new jsPDF(\"l\", \"mm\", [297, 210]);\n        pdf.addImage( \n          resultComponentImage,\n          \"JPEG\",\n          0,\n          0,\n          pdf.internal.pageSize.width,\n          pdf.internal.pageSize.height,\n          undefined,\n          \"NONE\"\n        );\n\n        pdf.save(\"fti_academy_certification_\" + this.dataItem + \".pdf\");\n      });\n      */\n    },\n    async generateImage() {\n      const element = this.$refs.certContainer;\n      const bgImage = this.backgroundImage;\n\n      try {\n        const canvas = await html2canvas(element, {\n          useCORS: true,\n          background: bgImage,\n          allowTaint: true,\n          scale: 4, // Increase scale for higher resolution rendering\n          dpi: 600, // Increase DPI for sharper images\n          imageSmoothingEnabled: true, // Smoothens the image\n\n        });\n        this.certImageSrc = canvas.toDataURL(\"image/jpeg\", 1.0);\n        this.showImage = true;\n      } catch (error) {\n        console.error(error);\n      }\n    },\n    async getData() {\n      try {\n        this.loading_sources = false;\n\n        const pipeline = [\n          {\n            $match: {\n              $expr: {\n                $eq: [\"$_id\", { $toObjectId: this.resolvedDataItem }],\n              },\n            },\n          },\n          {\n            $lookup: {\n              from: \"user\",\n              let: { userId: { $toObjectId: \"$userID\" } },\n              pipeline: [\n                {\n                  $match: {\n                    $expr: { $eq: [\"$_id\", \"$$userId\"] },\n                  },\n                },\n              ],\n              as: \"user\",\n            },\n          },\n          {\n            $unwind: \"$user\",\n          },\n          {\n            $lookup: {\n              from: \"course\",\n              let: { courseId: { $toObjectId: \"$courseID\" } },\n              pipeline: [\n                {\n                  $match: {\n                    $expr: { $eq: [\"$_id\", \"$$courseId\"] },\n                  },\n                },\n              ],\n              as: \"course\",\n            },\n          },\n          {\n            $unwind: \"$course\",\n          },\n          {\n            $lookup: {\n              from: \"form\",\n              let: { userId: \"$userID\", courseId: \"$courseID\" },\n              pipeline: [\n                {\n                  $match: {\n                    $expr: {\n                      $and: [\n                        { $eq: [\"$userID\", \"$$userId\"] },\n                        { $eq: [\"$courseID\", \"$$courseId\"] }\n                      ]\n                    }\n                  }\n                },\n                {\n                  $set: { formID: { $toObjectId: \"$formID\" } }\n                }\n              ],\n              as: \"forms\"\n            }\n          },\n        ];\n\n        const certresAPI = await fetch(`https://gateway.cloudrestfulapi.com/api/certification/aggregate`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json', 'client-token-key': this.configs.key\n          },\n          body: JSON.stringify({ pipeline })\n        });\n\n        const CertReturn = await certresAPI.json();\n        debug.log(\"CertReturn\", CertReturn[0]);\n\n        if (certresAPI.status === 200) {\n          this.certification = CertReturn[0];\n          this.lesson = CertReturn[0].course;\n          this.user = CertReturn[0].user;\n\n          if (CertReturn[0].course.certification_template === \"custom\") {\n            const responseHost = await Request.GET(`certification_template/${CertReturn[0].course.certificationId}`, this.configs.key);\n            if (responseHost.status === 200) {\n              this.certificationTemplate = responseHost.data;\n            }\n          } else {\n            const requestData = {\n              method: 'find',\n              args: [{ $and: [{ unit: this.session.current._id, default: true }] }],\n            };\n            const resAPICert = await Request.POST('certification_template/query', requestData, this.configs.key);\n            if (resAPICert.status !== 200) {\n              throw new Error(`Failed to fetch player data from API`);\n            }\n            debug.log(\"resAPICert\", resAPICert.data);\n            this.certificationTemplate = resAPICert.data[0];\n          }\n\n          this.generateQRCode().then(() => {\n            this.generateImage();\n          });\n        }\n      } catch (error) {\n        debug.log(error)\n      }\n    },\n    async getUserAndCertificationData() {\n      try {\n        this.loading_sources = false;\n\n        const pipeline = [\n          {\n            $match: {\n              $expr: {\n                $eq: [\"$_id\", { $toObjectId: this.resolvedDataItem }],\n              },\n            },\n          },\n          {\n            $lookup: {\n              from: \"user\",\n              let: { userId: { $toObjectId: this.resolvedUserId } },\n              pipeline: [\n                {\n                  $match: {\n                    $expr: { $eq: [\"$_id\", \"$$userId\"] },\n                  },\n                },\n              ],\n              as: \"user\",\n            },\n          },\n          {\n            $unwind: \"$user\",\n          },\n          {\n            $lookup: {\n              from: \"form\",\n              let: { userId: this.resolvedUserId, courseId: this.resolvedDataItem },\n              pipeline: [\n                {\n                  $match: {\n                    $expr: {\n                      $and: [\n                        { $eq: [\"$userID\", \"$$userId\"] },\n                        { $eq: [\"$courseID\", \"$$courseId\"] }\n                      ]\n                    }\n                  }\n                },\n                {\n                  $set: { formID: { $toObjectId: \"$formID\" } }\n                }\n              ],\n              as: \"forms\"\n            }\n          },\n          {\n            $lookup: {\n              from: \"enroll\",\n              let: { userId: this.resolvedUserId, courseId: this.resolvedDataItem },\n              pipeline: [\n                {\n                  $match: {\n                    $expr: {\n                      $and: [\n                        { $eq: [\"$userID\", \"$$userId\"] },\n                        { $eq: [\"$courseID\", \"$$courseId\"] }\n                      ]\n                    }\n                  }\n                },\n                {\n                  $set: { formID: { $toObjectId: \"$formID\" } }\n                }\n              ],\n              as: \"enrolls\"\n            }\n          },\n          {\n            $replaceRoot: {\n              newRoot: {\n                course: \"$$ROOT\",user: \"$user\",forms: \"$forms\",enrolls: \"$enrolls\"\n              }\n            }\n          }\n        ];\n\n        const certresAPI = await fetch(`https://gateway.cloudrestfulapi.com/api/course/aggregate`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json', 'client-token-key': this.configs.key\n          },\n          body: JSON.stringify({ pipeline })\n        });\n\n        const CertReturn = await certresAPI.json();\n        debug.slack(\"CertReturn\", CertReturn[0].course.certificationId);\n\n        if (certresAPI.status === 200) {\n          this.certification = CertReturn[0];\n          this.lesson = CertReturn[0].course;\n          this.user = CertReturn[0].user;\n          this.enroll = CertReturn[0].enrolls;\n\n          let post = CertReturn[0]?.enrolls[0]?.analytics?.post;\n          let retest = CertReturn[0]?.enrolls[0]?.analytics?.retest;\n\n          if (post?.score >= post?.measure) {\n            console.log(\"pass\");\n            // Case 1: Post score is greater than or equal to post measure\n            // Do nothing\n          } else if (post?.score < post?.measure && retest?.score >= retest?.measure) {\n            console.log(\"pass\");\n            // Case 2: Post score is less than post measure and Retest score is greater than or equal to retest measure\n            // Do nothing\n          } else if (post?.score < post?.measure && retest?.score < retest?.measure) {\n            console.log(\"no pass\");\n            // Case 3: Post score is less than post measure and Retest score is less than retest measure\n            //this.$router.push(\"/\");\n          } else {\n            console.log(\"no pass\");\n            // Case 4: Post score is less than post measure and no retest\n            //this.$router.push(\"/\");\n          }\n\n          if (CertReturn[0].course.certification_template === \"custom\") {\n            const responseHost = await Request.GET(`certification_template/${CertReturn[0].course.certificationId}`, this.configs.key);\n            if (responseHost.status === 200) {\n              this.certificationTemplate = responseHost.data;\n            }\n          } else {\n            const requestData = {\n              method: 'find',\n              args: [{ $and: [{ unit: this.session.current._id, default: true }] }],\n            };\n            const resAPICert = await Request.POST('certification_template/query', requestData, this.configs.key);\n            if (resAPICert.status !== 200) {\n              throw new Error(`Failed to fetch player data from API`);\n            }\n            debug.log(\"resAPICert\", resAPICert.data);\n            this.certificationTemplate = resAPICert.data[0];\n          }\n\n          this.generateQRCode().then(() => {\n            this.generateImage();\n          });\n        }\n      } catch (error) {\n        debug.log(error)\n      }\n    },\n  },\n};\n</script>\n\n<template>\n  <div>\n    <div class=\"mx-auto max-w-2xl px-3 pt-2 pb-2 sm:px-6 sm:pt-2 sm:pb-2 lg:max-w-7xl\">\n      <!-- Heading and button layout -->\n      <div class=\"flex items-center justify-between flex-wrap sm:flex-nowrap\">\n        <!-- Heading -->\n        <h1 class=\"text-md font-bold w-full sm:w-auto text-center mb-3 sm:mb-0\">{{ lesson.name }}</h1>\n      </div>\n    \n      <!-- Buttons layout (moves to new row in mobile) -->\n      <div class=\"flex flex-col sm:flex-row sm:justify-between mt-3 space-y-2 sm:space-y-0\">\n        <router-link :to=\"'/lesson/detail/' + lesson._id\" class=\"bg-gray-500 hover:bg-gray-600 text-white py-1 px-3 rounded text-sm w-full sm:w-auto text-center\">\n          กลับหน้าหลัก\n        </router-link>\n        <button @click=\"downloadPDF\" class=\"bg-green-500 hover:bg-green-600 text-white py-1 px-3 rounded text-sm w-full sm:w-auto text-center sm:ml-3\">\n          <font-awesome-icon :icon=\"['fas', 'download']\" class=\"mr-1.5 h-3 w-3 flex-shrink-0 text-white\" />\n          ดาวน์โหลดใบรับรอง\n        </button>\n      </div>\n    </div>\n    \n    \n\n    <div class=\"flex items-center justify-center pt-5 pb-5 bg-gray-600\">\n      <result-component\n        :certId=\"userId\"\n        :pages=\"certificationTemplate.pages\"\n        :certMode=\"certMode\"\n        :certData=\"certification\"\n        :debug=\"false\"\n        @backgroundImageChange=\"handleBackgroundImage\"\n        ref=\"resultComponentRef\"\n      />\n    </div>\n  </div>\n</template>\n\n<style scoped>\n@media print {\n  html,\n  body {\n    width: 297mm;\n    height: 210mm;\n    margin: 0;\n    padding: 0;\n  }\n\n  .certification-container {\n    width: 297mm;\n    height: 210mm;\n    position: relative;\n  }\n\n  .certification-img {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n  }\n}\n\n.certification-container {\n  width: 297mm;\n  height: 210mm;\n  position: relative;\n}\n\n.certification-img {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n}\n\n.certification-content {\n  z-index: 2;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  text-align: center;\n  padding-top: 375px;\n  padding-left: 50px;\n  padding-right: 50px;\n}\n\n.eco-cert {\n  padding-top: 275px;\n}\n.eco-cert .text-blue-800 {\n  color: #036214;\n}\n\n.certification-bg {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  z-index: 1;\n}\n\n.certification-bg img {\n  position: absolute;\n  z-index: 1;\n}\n\n.certification-qr {\n  position: absolute;\n  z-index: 9;\n  bottom: 50px;\n  left: 50px;\n  width: 110px;\n}\n</style>\n","import { render } from \"./Cetification.vue?vue&type=template&id=26fe055a&scoped=true\"\nimport script from \"./Cetification.vue?vue&type=script&lang=js\"\nexport * from \"./Cetification.vue?vue&type=script&lang=js\"\n\nimport \"./Cetification.vue?vue&type=style&index=0&id=26fe055a&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-26fe055a\"]])\n\nexport default __exports__","import { render } from \"./Cetification.vue?vue&type=template&id=02e8f3c6\"\nimport script from \"./Cetification.vue?vue&type=script&lang=js\"\nexport * from \"./Cetification.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createBlock","_resolveDynamicComponent","$options","componentName","class","_createElementBlock","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","_toDisplayString","$data","lesson","name","_hoisted_4","_createVNode","_component_router_link","to","_id","default","_withCtx","_cache","_createTextVNode","_","onClick","args","downloadPDF","_component_font_awesome_icon","icon","_hoisted_5","_component_result_component","certId","$props","userId","pages","certificationTemplate","certMode","certData","certification","debug","onBackgroundImageChange","handleBackgroundImage","ref","Request","requestClient","components","ResultComponent","props","dataItem","type","String","data","configs","storageManager","get","session","user","cert","image","qrCodeUrl","showImage","certImageSrc","backgroundImage","courseIDs","computed","resolvedDataItem","this","$route","params","cid","resolvedUserId","uid","mounted","getUserAndCertificationData","getData","error","log","methods","imageUrl","getCustomStyle","template","backgroundColor","fontSize","paddingTop","formatDateWithAge","date","age","newDate","Date","ageNumber","parseInt","setFullYear","getFullYear","formatThaidate","convertUtils","toThaiDatetime","generateQRCode","url","QRCode","console","$refs","resultComponentRef","captureDivAsCanvas","generateImage","element","certContainer","bgImage","canvas","html2canvas","useCORS","background","allowTaint","scale","dpi","imageSmoothingEnabled","toDataURL","loading_sources","pipeline","$match","$expr","$eq","$toObjectId","$lookup","from","let","as","$unwind","courseId","$and","$set","formID","certresAPI","fetch","method","headers","key","body","JSON","stringify","CertReturn","json","status","course","certification_template","responseHost","GET","certificationId","requestData","unit","current","resAPICert","POST","Error","then","$replaceRoot","newRoot","forms","enrolls","slack","enroll","post","analytics","retest","score","measure","__exports__","Frontend","setup","route","useRoute","routeName","meta","title","useTitle","render"],"sourceRoot":""}