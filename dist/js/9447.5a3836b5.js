"use strict";(self["webpackChunknode_backend"]=self["webpackChunknode_backend"]||[]).push([[9447],{50616:function(e,t,a){a.d(t,{A:function(){return d}});var o=a(20641);function s(e,t,a,s,l,n){const r=(0,o.g2)("UnderConstruction"),i=(0,o.g2)("Render");return(0,o.uX)(),(0,o.CE)("div",null,[l.page?((0,o.uX)(),(0,o.Wv)(i,{key:1,dataItem:l.page,mode:"slug"},null,8,["dataItem"])):((0,o.uX)(),(0,o.Wv)(r,{key:0}))])}var l=a(40475),n=a(21810),r=a(40368),i={data(){const e=l.A.get("configs"),t=l.A.get("session");return{configs:e,session:t,page:this.$route.params.page}},components:{Render:n.A,UnderConstruction:r.A},methods:{},setup(){},computed:{}},u=a(64621);const c=(0,u.A)(i,[["render",s]]);var d=c},29447:function(e,t,a){a.r(t),a.d(t,{default:function(){return L}});var o=a(20641);function s(e,t,a,s,l,n){return(0,o.uX)(),(0,o.Wv)((0,o.$y)(n.componentName))}var l=a(52968),n=a(75220),r=a(40475);function i(e,t,a,s,l,n){const r=(0,o.g2)("Builder",!0);return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.bF)(r,{onUpdateLayout:n.updateData,builderData:this.rows,getBuilder:n.getData,backUrl:"/cms/pages/"},null,8,["onUpdateLayout","builderData","getBuilder"])])}a(44114),a(14603),a(47566),a(98721);var u=a(90033),c=a(50953),d=a(62524),g=a(90367);const p={key:0,class:"bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-between text-xs"},v={class:"flex items-center gap-3 flex-wrap"},y={class:"font-semibold text-gray-900"},m={class:"bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full"},f={key:0,class:"flex items-center gap-1"},h=["href"],b=["href"],w={class:"text-gray-400 hidden sm:block"},S={key:2},_=50;var k={__name:"MainBuilderContainer",props:{recordId:{type:String,default:null},backUrl:{type:String,default:"/default-back-url"},builderData:{type:Object,default:null},getBuilder:{type:Function,default:null}},setup(e){const t=e,a=(0,o.nI)(),s=(0,c.KR)(null),l=(0,c.KR)(!1),i=(0,c.KR)(null),k=(0,c.KR)(r.A.get("configs")),C=(0,n.lq)(),T=(0,c.KR)([]),x=(0,c.KR)(!1),D=(0,c.KR)(""),R=(0,c.KR)([]),$=(0,c.KR)(!1),I=(0,c.KR)([]),U=(0,c.KR)(-1),O=(0,c.KR)(!1),L=(0,c.KR)(null);function P(){s.value?._id&&(L.value=`builder_history_${s.value._id}`,A())}function E(){if(L.value)try{const e={history:I.value,currentHistoryIndex:U.value,timestamp:Date.now()};localStorage.setItem(L.value,JSON.stringify(e)),console.log("History saved to localStorage. Total states:",I.value.length,"Current index:",U.value)}catch(e){console.error("Error saving history to localStorage:",e)}}function A(){if(L.value)try{const e=localStorage.getItem(L.value);if(e){const t=JSON.parse(e);I.value=t.history||[],U.value=t.currentHistoryIndex??-1,console.log("History loaded from localStorage. Total states:",I.value.length,"Current index:",U.value)}}catch(e){console.error("Error loading history from localStorage:",e),I.value=[],U.value=-1}}function N(){if(I.value=[],U.value=-1,L.value)try{localStorage.removeItem(L.value),console.log("History cleared from localStorage")}catch(e){console.error("Error clearing history from localStorage:",e)}}function J(){if(console.log("saveStateToHistory: Called. isUndoRedoOperation:",O.value),O.value)return void console.log("saveStateToHistory: Skipped - undo/redo operation in progress");if(!s.value)return void console.log("saveStateToHistory: Skipped - no builderData");const e={builder:JSON.parse(JSON.stringify(s.value.builder||[])),css:s.value.css||"",timestamp:Date.now()};if(U.value>=0&&U.value<I.value.length){const t=I.value[U.value],a=JSON.stringify(e.builder)+e.css,o=JSON.stringify(t.builder)+t.css;if(a===o)return void console.log("saveStateToHistory: Skipped - no changes detected")}U.value>=0&&(I.value=I.value.slice(0,U.value+1),console.log("saveStateToHistory: Removed future states after current index")),I.value.push(e),U.value=I.value.length-1,console.log("saveStateToHistory: Added new state. Total rows:",e.builder.length),I.value.length>_&&(I.value.shift(),U.value--,console.log("saveStateToHistory: Removed old state (exceeded max size)")),E(),console.log("saveStateToHistory: State saved. Total states:",I.value.length,"Current index:",U.value)}function B(){if(U.value<=0)return console.log("No more actions to undo"),!1;console.log("performUndo: Starting undo operation. Current index:",U.value,"Total states:",I.value.length),O.value=!0,U.value--;const e=I.value[U.value];return console.log("performUndo: Moving to index:",U.value),s.value.builder=JSON.parse(JSON.stringify(e.builder)),s.value.css=e.css,i.value?.state&&setTimeout((()=>{if(i.value?.state){const t=i.value.state.getState();t.rows=JSON.parse(JSON.stringify(e.builder)),i.value.state.setCssCode(e.css),console.log("performUndo: Controller state updated")}}),10),E(),console.log("performUndo: Completed. Current index:",U.value,"Total states:",I.value.length),setTimeout((()=>{O.value=!1,console.log("performUndo: Flag reset, operation complete")}),300),!0}function F(){if(U.value>=I.value.length-1)return console.log("No more actions to redo"),!1;console.log("performRedo: Starting redo operation. Current index:",U.value,"Total states:",I.value.length),O.value=!0,U.value++;const e=I.value[U.value];return console.log("performRedo: Moving to index:",U.value),s.value.builder=JSON.parse(JSON.stringify(e.builder)),s.value.css=e.css,i.value?.state&&setTimeout((()=>{if(i.value?.state){const t=i.value.state.getState();t.rows=JSON.parse(JSON.stringify(e.builder)),i.value.state.setCssCode(e.css),console.log("performRedo: Controller state updated")}}),10),E(),console.log("performRedo: Completed. Current index:",U.value,"Total states:",I.value.length),setTimeout((()=>{O.value=!1,console.log("performRedo: Flag reset, operation complete")}),300),!0}function j(){return U.value>0}function q(){return U.value<I.value.length-1}async function H(e){try{const{data:t}=await a.appContext.config.globalProperties.$Request.GET(`post/${e}`,k.value.key);if(t)return console.log("data",t),t;{const t={builder:[],css:"",_id:e,title:"Error: No data"};return t}}catch(t){const a={builder:[],css:"",_id:e,title:"Error: Fetch failed"};return a}}async function K(){l.value=!1;let e=null,a=null;try{C&&C.params&&C.params.id?(a=C.params.id,e=await H(a)):t.getBuilder&&"function"===typeof t.getBuilder?e=await t.getBuilder():t.recordId&&"null"!==t.recordId&&"undefined"!==t.recordId?(a=t.recordId,e=await H(a)):e={_id:`new_no_id_${Date.now()}`,title:"New Page (No Record ID)",builder:[],css:""};const o=a||(e?e._id:null)||(s.value?s.value._id:`new_empty_${Date.now()}`),n=(e?e.title:null)||(s.value?s.value.title:"Untitled Page"),r=(e?e.type:null)||"page";let i=[],u="";e&&(Array.isArray(e.builder)&&(i=e.builder),"string"===typeof e.css&&(u=e.css)),s.value={_id:o,title:n,type:r,builder:i,css:u},X(s.value),l.value=!0,P()}catch(o){s.value={_id:t.recordId||`new_error_${Date.now()}`,title:`Error: Fetch Failed for ${t.recordId||"New Page"}`,type:"page",builder:[],css:""}}}function X(e){const a={builderData:e,getBuilder:G,backUrl:t.backUrl};i.value?i.value.initialize(e):g.A.createInstance(a).then((e=>{i.value=e}))}async function G(){return await K(),s.value}async function W(e){if(console.log("handleLayoutUpdate: Called with isUndoRedoOperation:",O.value),console.log("handleLayoutUpdate: Received newLayout:",{hasBuilder:!!e?.builder,builderLength:e?.builder?e.builder.length:"undefined",hasCss:!!e?.css,cssLength:e?.css?e.css.length:"undefined",isUndoRedoOperation:O.value}),s.value&&e){let t=!1;O.value?console.log("handleLayoutUpdate: Skipping history save - undo/redo operation"):(console.log("handleLayoutUpdate: Saving state to history before changes"),J()),Array.isArray(e.builder)&&JSON.stringify(s.value.builder)!==JSON.stringify(e.builder)&&(console.log("handleLayoutUpdate: Builder data changed - OLD length:",s.value.builder?.length,"NEW length:",e.builder.length),s.value.builder=e.builder,t=!0),"string"===typeof e.css&&s.value.css!==e.css&&(console.log("handleLayoutUpdate: CSS data changed"),s.value.css=e.css,t=!0),t?(console.log("handleLayoutUpdate: Data updated in memory only (localStorage history saved)"),i.value?.state&&!O.value&&(i.value.state.getState().rows=e.builder||[],i.value.state.setCssCode(e.css||""),console.log("handleLayoutUpdate: Controller state updated"))):console.log("handleLayoutUpdate: No changes detected")}else console.log("handleLayoutUpdate: Skipped - no builderData or newLayout")}async function M(){await K();const e=a.appContext.config.globalProperties.$Toast({type:"success",message:"ข้อมูลถูกโหลดใหม่แล้ว"});setTimeout((()=>{e.hide()}),800)}function z(){if(console.log("=== DEBUG CURRENT STATE ==="),console.log("builderData.value:",s.value),console.log("controllerInstance.value exists?",!!i.value),i.value&&(console.log("controller.state exists?",!!i.value.state),i.value.state)){const e=i.value.state.getState();console.log("state.rows:",e.rows),console.log("state.rows is array?",Array.isArray(e.rows)),console.log("state.rows length:",e.rows?e.rows.length:"undefined")}console.log("=== END DEBUG ===")}async function Q(){if(z(),s.value&&s.value._id)try{let e=[],t="";if(i.value?.state?.getState){const a=i.value.state.getState();a.rows&&Array.isArray(a.rows)&&(e=[...a.rows],console.log("manualSaveData: Got data from controller state:",e.length,"rows"));const o=i.value.state.getCssCode();o&&(t=o,console.log("manualSaveData: Got CSS from controller state:",o.length,"characters"))}e&&0!==e.length||(s.value.builder&&Array.isArray(s.value.builder)?(e=[...s.value.builder],console.log("manualSaveData: Fallback to builderData.value.builder:",e.length,"rows")):(console.warn("manualSaveData: No builder data found anywhere!"),e=[])),!t&&s.value.css&&(t=s.value.css,console.log("manualSaveData: Fallback to builderData.value.css")),Array.isArray(e)||(console.warn("manualSaveData: latestBuilderData is not array, converting"),e=[]),"string"!==typeof t&&(t=String(t||"")),s.value.builder=e,s.value.css=t,console.log("manualSaveData: Final validation:",{builderIsArray:Array.isArray(e),builderRowsCount:e.length,cssIsString:"string"===typeof t,cssLength:t.length,title:s.value.title,id:s.value._id});const o={data:{builder:e,css:t,title:s.value.title},options:{}};console.log("manualSaveData: Sending request with builder rows:",o.data.builder.length);const{data:l,status:n}=await a.appContext.config.globalProperties.$Request.PUT(`post/${s.value._id}`,o,k.value.key);if(200===n){await V(e,t);const o=a.appContext.config.globalProperties.$Toast({type:"success",message:"ข้อมูลปัจจุบันถูกส่งไปบันทึกแล้ว (สร้าง revision เรียบร้อย)"});setTimeout((()=>{o.hide()}),1800),console.log("Manual save completed successfully, keeping current state")}else{const e=a.appContext.config.globalProperties.$Toast({type:"error",message:`ไม่สามารถบันทึกข้อมูลได้ (status: ${n})`});setTimeout((()=>{e.hide()}),1800)}}catch(e){console.error("manualSaveData: Error occurred:",e);const t=a.appContext.config.globalProperties.$Toast({type:"error",message:"การเชื่อมต่อมีปัญหา ไม่สามารถบันทึกข้อมูลได้"});setTimeout((()=>{t.hide()}),1800)}else{const e=a.appContext.config.globalProperties.$Toast({type:"error",message:"ยังไม่มีข้อมูลให้บันทึก หรือไม่มี ID ของข้อมูล"});setTimeout((()=>{e.hide()}),1800)}}async function V(e,t){try{const o={post_id:s.value._id,builder_data:e,css_data:t,title:s.value.title,description:D.value||`Auto-save at ${(new Date).toLocaleString()}`,created_at:(new Date).toISOString(),user_id:k.value.user?.id||"unknown",user_name:k.value.user?.name||"ไม่ระบุ",is_current:!1,version:Date.now()},l={data:o,options:{}},n=await a.appContext.config.globalProperties.$Request.POST("post_revision",l,k.value.key);200===n.status&&(console.log("Revision created successfully:",n.data),D.value="",await Y())}catch(o){console.error("Error creating revision:",o)}}async function Y(){if(s.value?._id)try{x.value=!0;const e={method:"find",args:[{$and:[{post_id:s.value._id}]}],sort:{created_at:-1},paging:{page:1,limit:500}},t=await fetch("https://gateway.cloudrestfulapi.com/api/post_revision/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":k.value.key},body:JSON.stringify(e)});if(t.ok){const e=await t.json();T.value=e.data||[],console.log("Loaded revisions:",T.value.length),console.log("Total revisions available:",e.total)}else console.error("Error response:",t.status,t.statusText),T.value=[]}catch(e){console.error("Error loading revisions:",e),T.value=[]}finally{x.value=!1}}async function Z(e){try{if(!e||!e._id)return console.error("Invalid revision data"),!1;s.value.builder=e.builder_data||[],s.value.css=e.css_data||"",i.value?.state&&(i.value.state.getState().rows=e.builder_data||[],i.value.state.setCssCode(e.css_data||""));const t=a.appContext.config.globalProperties.$Toast({type:"success",message:`กลับไปยัง revision: ${e.description}`});return setTimeout((()=>{t.hide()}),2e3),console.log("Rolled back to revision:",e._id),!0}catch(t){console.error("Error during rollback:",t);const e=a.appContext.config.globalProperties.$Toast({type:"error",message:"เกิดข้อผิดพลาดในการ rollback"});return setTimeout((()=>{e.hide()}),1800),!1}}async function ee(e,t){try{const o={title:`${s.value.title} (${t})`,builder:e.builder_data||[],css:e.css_data||"",type:s.value.type||"page",original_post_id:s.value._id,revision_id:e._id,branch_name:t,created_at:(new Date).toISOString(),status:"draft"},l={data:o,options:{}},n=await a.appContext.config.globalProperties.$Request.POST("post",l,k.value.key);if(200===n.status){const e=a.appContext.config.globalProperties.$Toast({type:"success",message:`สร้าง branch "${t}" สำเร็จแล้ว`});return setTimeout((()=>{e.hide()}),2e3),console.log("Branch created successfully:",n.data),t.value="",n.data}}catch(o){console.error("Error creating branch:",o);const e=a.appContext.config.globalProperties.$Toast({type:"error",message:"เกิดข้อผิดพลาดในการสร้าง branch"});setTimeout((()=>{e.hide()}),1800)}}async function te(e){try{if(!e)return console.error("Invalid revision ID"),!1;const t={method:"deleteOne",args:[{_id:e}]},o=await fetch("https://gateway.cloudrestfulapi.com/api/post_revision/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":k.value.key},body:JSON.stringify(t)});if(o.ok){const t=a.appContext.config.globalProperties.$Toast({type:"success",message:"ลบ revision สำเร็จแล้ว"});return setTimeout((()=>{t.hide()}),1800),await Y(),console.log("Revision deleted successfully:",e),!0}throw new Error(`Delete failed with status: ${o.status}`)}catch(t){console.error("Error deleting revision:",t);const e=a.appContext.config.globalProperties.$Toast({type:"error",message:"เกิดข้อผิดพลาดในการลบ revision"});return setTimeout((()=>{e.hide()}),1800),!1}}async function ae(e){try{const t={method:"findOne",args:[{_id:e}]},a=await fetch("https://gateway.cloudrestfulapi.com/api/post_revision/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":k.value.key},body:JSON.stringify(t)});if(a.ok){const e=await a.json();return e.data}return null}catch(t){return console.error("Error loading revision details:",t),null}}async function oe(e){try{const t=await ae(e._id);return t?{id:t._id,description:t.description,created:new Date(t.created_at).toLocaleString(),builderRows:t.builder_data?.length||0,cssLength:t.css_data?.length||0,user:t.user_name||"ไม่ระบุ",builderData:t.builder_data,cssData:t.css_data}:null}catch(t){return console.error("Error viewing revision details:",t),null}}async function se(){console.log("handleSaveFromBuilder: Called"),console.log("handleSaveFromBuilder: Current builderData.value:",{hasBuilder:!!s.value?.builder,builderLength:s.value?.builder?s.value.builder.length:"undefined",hasCss:!!s.value?.css}),await Q(),N(),console.log("History cleared after save, starting fresh")}async function le(){await M()}async function ne(){await Y()}async function re(e){return await Z(e)}async function ie(e){const{revision:t,branchName:a}=e;return await ee(t,a)}async function ue(e){return await te(e)}async function ce(e){return await oe(e)}async function de(e){return await ae(e)}async function ge(){try{const e={metadata:{title:s.value?.title||"Untitled",type:s.value?.type||"page",exportDate:(new Date).toISOString(),version:"1.0.0",exportedBy:"Builder System",originalId:s.value?._id},builder:[],css:"",settings:{responsive:!0}};if(i.value?.state?.getState){const t=i.value.state.getState();e.builder=t.rows||[],e.css=i.value.state.getCssCode()||""}else s.value&&(e.builder=s.value.builder||[],e.css=s.value.css||"");const t=`${(e.metadata.title||"builder").replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${(new Date).toISOString().split("T")[0]}.json`,o=JSON.stringify(e,null,2),l=new Blob([o],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(l),n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),console.log("JSON exported successfully:",t);const r=a.appContext.config.globalProperties.$Toast({type:"success",message:`ส่งออกข้อมูลสำเร็จ: ${t}`});setTimeout((()=>{r.hide()}),2e3)}catch(e){console.error("Error exporting JSON:",e);const t=a.appContext.config.globalProperties.$Toast({type:"error",message:"เกิดข้อผิดพลาดในการส่งออกข้อมูล"});setTimeout((()=>{t.hide()}),1800)}}async function pe(e){try{if(!e||!Array.isArray(e.builder))throw new Error("Invalid import data structure");const t=e.importMode||"replace";console.log("handleImportJson: Import mode:",t),console.log("handleImportJson: Current rows:",s.value.builder?.length||0),console.log("handleImportJson: Importing rows:",e.builder.length);let o=[],l="";if("append"===t){o=[...s.value.builder||[],...e.builder];const t=s.value.css||"",a=e.css||"";l=t&&a?t+"\n\n/* === Imported CSS === */\n"+a:t+a,console.log("handleImportJson: Append mode - Final rows:",o.length)}else o=e.builder,l=e.css||"",console.log("handleImportJson: Replace mode - Final rows:",o.length);s.value.builder=o,s.value.css=l,"replace"===t&&e.metadata&&e.metadata.title&&"Untitled"!==e.metadata.title&&console.log("handleImportJson: Imported title:",e.metadata.title),i.value?.state&&(i.value.state.getState().rows=o,i.value.state.setCssCode(l)),console.log("handleImportJson: JSON imported successfully");const n="append"===t?"เพิ่มต่อท้าย":"แทนที่",r=a.appContext.config.globalProperties.$Toast({type:"success",message:`นำเข้าข้อมูลสำเร็จ (${n}): ${e.builder.length} rows`});setTimeout((()=>{r.hide()}),2e3),await V(o,l)}catch(t){console.error("Error importing JSON:",t);const e=a.appContext.config.globalProperties.$Toast({type:"error",message:"เกิดข้อผิดพลาดในการนำเข้าข้อมูล"});setTimeout((()=>{e.hide()}),1800)}}async function ve(e){try{console.log("Saving row as template:",e);const t={data:{name:e.name,description:e.description,type:e.type,category:e.category,tags:e.tags,data:e.data,created_at:e.created_at,created_by:e.created_by,builder_version:"1.0.0",owner_id:k.value.user?.id||"unknown",owner_name:k.value.user?.name||"ไม่ระบุ",metadata:{columns_count:e.data.columns?.length||0,grid_columns:e.data.col||1,has_background:!(!e.data.bgColor&&!e.data.bgImage),responsive_settings:{mobile:e.data.mobile||!0,tablet:e.data.tablet||!0,laptop:e.data.laptop||!0,desktop:e.data.desktop||!0}},status:"active",is_public:!1,usage_count:0},options:{}};console.log("Template request body:",t);const o=await a.appContext.config.globalProperties.$Request.POST("post_block_template",t,k.value.key);if(200===o.status){console.log("Template saved successfully:",o.data);const t=a.appContext.config.globalProperties.$Toast({type:"success",message:`บันทึก Block Template "${e.name}" สำเร็จแล้ว`});return setTimeout((()=>{t.hide()}),2e3),await me(),o.data}throw new Error(`Save failed with status: ${o.status}`)}catch(t){console.error("Error saving row as template:",t);const e=a.appContext.config.globalProperties.$Toast({type:"error",message:"เกิดข้อผิดพลาดในการบันทึก Block Template"});throw setTimeout((()=>{e.hide()}),2e3),t}}async function ye(){await me()}async function me(){try{$.value=!0;const e={method:"find",args:[{$and:[{type:"row_template"},{status:"active"},{$or:[{owner_id:k.value.user?.id},{is_public:!0}]}]}],sort:{created_at:-1},paging:{page:1,limit:100}},t=await fetch("https://gateway.cloudrestfulapi.com/api/post_block_template/query",{method:"POST",headers:{"Content-Type":"application/json","client-token-key":k.value.key},body:JSON.stringify(e)});if(t.ok){const e=await t.json();R.value=e.data||[],console.log("Loaded block templates:",R.value.length),console.log("Total templates available:",e.total)}else console.error("Error response:",t.status,t.statusText),R.value=[]}catch(e){console.error("Error loading block templates:",e),R.value=[];const t=a.appContext.config.globalProperties.$Toast({type:"error",message:"เกิดข้อผิดพลาดในการโหลด Block Templates"});setTimeout((()=>{t.hide()}),2e3)}finally{$.value=!1}}async function fe(){console.log("handleUndo: Called. Current state:",{totalStates:I.value.length,currentIndex:U.value,canUndo:j(),canRedo:q(),isUndoRedoOperation:O.value});const e=B();if(e){const e=a.appContext.config.globalProperties.$Toast({type:"success",message:"ย้อนกลับการเปลี่ยนแปลงสำเร็จ"});setTimeout((()=>{e.hide()}),1500),console.log("handleUndo: Success. New state:",{totalStates:I.value.length,currentIndex:U.value,canUndo:j(),canRedo:q()})}else{const e=a.appContext.config.globalProperties.$Toast({type:"warning",message:"ไม่มีการเปลี่ยนแปลงให้ย้อนกลับ"});setTimeout((()=>{e.hide()}),1500),console.log("handleUndo: Failed - no history available")}}async function he(){console.log("handleRedo: Called. Current state:",{totalStates:I.value.length,currentIndex:U.value,canUndo:j(),canRedo:q(),isUndoRedoOperation:O.value});const e=F();if(e){const e=a.appContext.config.globalProperties.$Toast({type:"success",message:"ทำซ้ำการเปลี่ยนแปลงสำเร็จ"});setTimeout((()=>{e.hide()}),1500),console.log("handleRedo: Success. New state:",{totalStates:I.value.length,currentIndex:U.value,canUndo:j(),canRedo:q()})}else{const e=a.appContext.config.globalProperties.$Toast({type:"warning",message:"ไม่มีการเปลี่ยนแปลงให้ทำซ้ำ"});setTimeout((()=>{e.hide()}),1500),console.log("handleRedo: Failed - no redo available")}}return(0,o.Gt)("mainController",i),(0,o.Gt)("builderDataRef",s),(0,o.sV)((()=>{t.builderData&&Object.keys(t.builderData).length>0?(s.value=t.builderData,X(t.builderData),l.value=!0):K()})),(e,a)=>{const l=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",null,[s.value?((0,o.uX)(),(0,o.CE)("div",p,[(0,o.Lk)("div",v,[(0,o.bF)(l,{icon:["fas","file-alt"],class:"text-blue-500 text-base"}),(0,o.Lk)("span",y,(0,u.v_)(s.value.title||"Untitled Page"),1),(0,o.Lk)("span",m,(0,u.v_)(s.value.type||"page"),1),(0,o.Lk)("span",null,[a[0]||(a[0]=(0,o.eW)("แถว: ")),(0,o.Lk)("b",null,(0,u.v_)(s.value.builder?.length||0),1)]),s.value._id?((0,o.uX)(),(0,o.CE)("span",f,[a[2]||(a[2]=(0,o.Lk)("span",null,"ID:",-1)),(0,o.Lk)("a",{href:`/cms/edit/${s.value._id}`,class:"text-blue-600 underline hover:text-blue-800 transition-colors",target:"_blank",rel:"noopener"},(0,u.v_)(s.value._id),9,h),(0,o.Lk)("a",{href:`/cms/edit/${s.value._id}`,target:"_blank",rel:"noopener",class:"inline-flex items-center px-1.5 py-0.5 text-[11px] font-medium bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors ml-1",style:{height:"22px"}},[(0,o.bF)(l,{icon:["fas","edit"],class:"mr-1 text-xs"}),a[1]||(a[1]=(0,o.eW)(" แก้ไข "))],8,b)])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",w,[(0,o.Lk)("span",null,(0,u.v_)((new Date).toLocaleString()),1)])])):(0,o.Q3)("",!0),s.value?((0,o.uX)(),(0,o.Wv)(d.A,{key:1,"builder-data":s.value,"main-controller":i.value,"get-builder":G,"back-url":t.backUrl||"/default-back-url","revision-history":T.value,"loading-revisions":x.value,"block-templates":R.value,"loading-block-templates":$.value,"can-undo":j(),"can-redo":q(),onUpdateLayout:W,onSaveData:se,onReloadData:le,onLoadRevisions:ne,onRevisionRollback:re,onRevisionBranch:ie,onRevisionDelete:ue,onRevisionView:ce,onRevisionDetails:de,onExportJson:ge,onImportJson:pe,onSaveRowAsTemplate:ve,onLoadBlockTemplates:ye,onUndo:fe,onRedo:he},null,8,["builder-data","main-controller","back-url","revision-history","loading-revisions","block-templates","loading-block-templates","can-undo","can-redo"])):((0,o.uX)(),(0,o.CE)("div",S,"Loading builder data..."))])}}},C=a(64621);const T=(0,C.A)(k,[["__scopeId","data-v-1281f85e"]]);var x=T,D={data(){return{configs:r.A.get("configs"),session:r.A.get("session"),dataItem:this.$route.params.id,accessSession:[],selectSession:!1,rows:[]}},components:{Builder:x},methods:{changeSession(){this.selectSession=!0},async getData(){try{const{data:e}=await this.$Request.GET(`post/${this.dataItem}`,this.configs.key),t=e,a=e;this.$setPageTitle(e.title),a&&(this.rows=a,this.post=t)}catch(e){console.log(e)}},async updateData(e){return console.log("Debug updateData, layout:",e),this.$swal({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,icon:"info",title:"Debug Mode",text:"updateData ถูกเรียกใช้งาน (dummy function)"}),Promise.resolve({status:200,data:{message:"Debug update successful"}})}},async mounted(){try{this.accessSession=r.A.get("session","current"),await this.getData()}catch(e){console.log(Error)}},setup(){}};const R=(0,C.A)(D,[["render",i]]);var $=R,I=a(50616),U={name:"Page Item",components:{Backend:$,Frontend:I.A},data(){return{session:r.A.get("session")}},setup(){const e=(0,n.lq)(),t=e.meta.title;(0,l.K7)(t)},computed:{componentName(){return"backend"===this.session.interface?"Backend":"frontend"===this.session.interface?"Frontend":(console.error("Invalid interface:",this.session.interface),null)}}};const O=(0,C.A)(U,[["render",s]]);var L=O},40368:function(e,t,a){a.d(t,{A:function(){return u}});var o=a(20641);const s={class:"flex flex-col items-center justify-center min-h-screen bg-gray-100"};function l(e,t,a,l,n,r){return(0,o.uX)(),(0,o.CE)("div",s,t[0]||(t[0]=[(0,o.Lk)("h1",{class:"text-4xl font-bold mb-4 text-gray-800"},"Under Construction",-1),(0,o.Lk)("p",{class:"text-lg text-gray-700 mb-6"},"We're working on something awesome. Please check back later!",-1),(0,o.Lk)("div",{class:"flex flex-col items-center"},[(0,o.Lk)("p",{class:"text-gray-700"},"Estimated Completion: September 2023")],-1)]))}var n={name:"UnderConstruction",mounted(){this.$setPageTitle("Under Construction")}},r=a(64621);const i=(0,r.A)(n,[["render",l],["__scopeId","data-v-685445e4"]]);var u=i}}]);
//# sourceMappingURL=9447.5a3836b5.js.map