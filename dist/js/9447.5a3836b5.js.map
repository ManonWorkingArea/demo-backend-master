{"version":3,"file":"js/9447.5a3836b5.js","mappings":"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","sources":["webpack://node-backend/./src/extensions/modules/blog/cms/component/frontend/Page.vue","webpack://node-backend/./src/extensions/modules/blog/cms/component/frontend/Page.vue?72a8","webpack://node-backend/./src/extensions/modules/blog/cms/view/Builder.vue","webpack://node-backend/./src/extensions/modules/blog/cms/component/Builder.vue","webpack://node-backend/./src/interface/template/MainBuilderContainer.vue","webpack://node-backend/./src/interface/template/MainBuilderContainer.vue?fda9","webpack://node-backend/./src/extensions/modules/blog/cms/component/Builder.vue?84d5","webpack://node-backend/./src/extensions/modules/blog/cms/view/Builder.vue?65db","webpack://node-backend/./src/interface/template/UnderConstruction.vue","webpack://node-backend/./src/interface/template/UnderConstruction.vue?5a33"],"sourcesContent":["<template>\n<div>\n\t<UnderConstruction v-if=\"!page\" />\n\t<Render v-else :dataItem=\"page\" :mode=\"'slug'\" />\n</div>\n</template>\n\n<script>\nimport storageManager from '@/plugins/storage';\nimport Render from '@/interface/template/BuilderRender.vue';\nimport UnderConstruction from '@/interface/template/UnderConstruction.vue';\n\nexport default {\ndata() {\n\tconst configs = storageManager.get('configs');\n\tconst session = storageManager.get('session');\n\treturn {\n\tconfigs,\n\tsession,\n\tpage: this.$route.params.page,\n\t};\n},\ncomponents: { Render, UnderConstruction },\nmethods: {},\nsetup() {},\ncomputed: {},\n};\n</script>\n  ","import { render } from \"./Page.vue?vue&type=template&id=26e0598d\"\nimport script from \"./Page.vue?vue&type=script&lang=js\"\nexport * from \"./Page.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","<template>\n<component :is=\"componentName\" />\n</template>\n\n<script>\nimport { useTitle }   from 'vue-page-title';\nimport { useRoute }   from 'vue-router';\nimport storageManager from '@/plugins/storage';\nimport Backend \t\t  from '../component/Builder.vue';\nimport Frontend       from '../component/frontend/Page.vue';\n\nexport default {\nname: 'Page Item',\ncomponents: {\n    Backend,\n    Frontend,\n},\ndata() {\n    return {\n        session: storageManager.get('session')\n    };\n},\nsetup() {\n    const route = useRoute();\n    const routeName = route.meta.title;\n    useTitle(routeName);\n},\ncomputed: {\n    componentName() {\n        if (this.session.interface === 'backend') {\n            return 'Backend';\n        } else if (this.session.interface === 'frontend') {\n            return 'Frontend';\n        } else {\n            console.error('Invalid interface:', this.session.interface);\n            return null;\n        }\n    }\n}\n};\n</script>\n    ","<script>\nimport storageManager from '@/plugins/storage';\nimport Builder              from '@/interface/template/MainBuilderContainer.vue';\n\nexport default {\n    data() {\n      return {\n\t\tconfigs: storageManager.get('configs'),\n        session: storageManager.get('session'),\n\t\tdataItem: this.$route.params.id,\n        accessSession: [],\n        selectSession: false,\n        rows: [],\n      }\n    },\n    components: {\n\t\tBuilder\n    },\n    methods: {\n\t\tchangeSession() {\n\t\t\tthis.selectSession = true;\n\t\t},\n\t\tasync getData() {\n\t\t\ttry {\n\t\t\t\tconst { data } = await this.$Request.GET(`post/${this.dataItem}`, this.configs.key);\n\t\t\t\tconst pageLayout = data;\n\t\t\t\tconst savedLayout = data;\n\n\t\t\t\tthis.$setPageTitle(data.title);\n\t\t\t\tif (savedLayout) {\n\t\t\t\tthis.rows = savedLayout;\n\t\t\t\tthis.post = pageLayout;\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log(error);\n\t\t\t}\n\t\t},\n\t\t// async updateData(layout) {\n\t\t// \ttry {\n\t\t// \t\tconst requestBody = {\n\t\t// \t\tdata: {\n\t\t// \t\t\tbuilder: layout.builder,\n\t\t// \t\t},\n\t\t// \t\toptions: {}\n\t\t// \t\t};\n\n\t\t// \t\tconst { data, status } = await this.$Request.PUT(`post/${this.post._id}`, requestBody, this.configs.key);\n\t\t// \t\tconsole.log(data);\n\n\t\t// \t\tif(status === 200) {\n\t\t// \t\tthis.$swal({\n\t\t// \t\t\ttoast: true,\n\t\t// \t\t\tposition: 'bottom-end',\n\t\t// \t\t\tshowConfirmButton: false,\n\t\t// \t\t\ttimer: 3000,\n\t\t// \t\t\ticon: 'success',\n\t\t// \t\t\ttitle: 'บันทึกข้อมูลหน้าเว็บ',\n\t\t// \t\t\ttext: 'บันทึกข้อมูลสำหรับหน้าเว็บนี้ สำเร็จแล้ว',\n\t\t// \t\t});\n\t\t// \t\t}\n\t\t// \t} catch (error) {\n\t\t// \t\tconsole.error(error);\n\t\t// \t}\n\t\t// },\n\t\tasync updateData(layout) {\n\t\t\tconsole.log('Debug updateData, layout:', layout);\n\t\t\tthis.$swal({\n\t\t\t\ttoast: true,\n\t\t\t\tposition: 'bottom-end',\n\t\t\t\tshowConfirmButton: false,\n\t\t\t\ttimer: 3000,\n\t\t\t\ticon: 'info',\n\t\t\t\ttitle: 'Debug Mode',\n\t\t\t\ttext: 'updateData ถูกเรียกใช้งาน (dummy function)',\n\t\t\t});\n\t\t\t// Simulate successful update\n\t\t\treturn Promise.resolve({ status: 200, data: { message: 'Debug update successful' } });\n\t\t},\n\t},\n  async mounted () {\n    try {\n\t\tthis.accessSession  = storageManager.get('session','current');\n\t\tawait this.getData();\n    } catch (error) {\n      console.log(Error);\n    }\n  },\n  setup() {},\n};\n</script>\n\n<template>\n\t<div>\n\t\t<Builder \n\t\t@update-layout=\"updateData\" \n\t\t:builderData=\"this.rows\"\n\t\t:getBuilder=\"getData\"\n\t\t:backUrl=\"'/cms/pages/'\"\n\t\t/>\n\t</div>\n</template>","<template>\n  <div>\n    <!-- Top Page Info Section -->\n    <div v-if=\"builderData\" class=\"bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-between text-xs\">\n      <div class=\"flex items-center gap-3 flex-wrap\">\n        <font-awesome-icon :icon=\"['fas', 'file-alt']\" class=\"text-blue-500 text-base\" />\n        <span class=\"font-semibold text-gray-900\">{{ builderData.title || 'Untitled Page' }}</span>\n        <span class=\"bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full\">{{ builderData.type || 'page' }}</span>\n        <span>แถว: <b>{{ builderData.builder?.length || 0 }}</b></span>\n        <span v-if=\"builderData._id\" class=\"flex items-center gap-1\">\n          <span>ID:</span>\n          <a\n            :href=\"`/cms/edit/${builderData._id}`\"\n            class=\"text-blue-600 underline hover:text-blue-800 transition-colors\"\n            target=\"_blank\"\n            rel=\"noopener\"\n          >{{ builderData._id }}</a>\n          <a\n            :href=\"`/cms/edit/${builderData._id}`\"\n            target=\"_blank\"\n            rel=\"noopener\"\n            class=\"inline-flex items-center px-1.5 py-0.5 text-[11px] font-medium bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors ml-1\"\n            style=\"height:22px;\"\n          >\n            <font-awesome-icon :icon=\"['fas', 'edit']\" class=\"mr-1 text-xs\" />\n            แก้ไข\n          </a>\n        </span>\n      </div>\n      <div class=\"text-gray-400 hidden sm:block\">\n        <span>{{ new Date().toLocaleString() }}</span>\n      </div>\n    </div>\n    <!-- End Top Page Info Section -->\n    <Builder v-if=\"builderData\" \n      :builder-data=\"builderData\" \n      :main-controller=\"controllerInstance\"\n      :get-builder=\"triggerDataLoad\"\n      :back-url=\"props.backUrl || '/default-back-url'\"\n      :revision-history=\"revisions\"\n      :loading-revisions=\"loadingRevisions\"\n      :block-templates=\"blockTemplates\"\n      :loading-block-templates=\"loadingBlockTemplates\"\n      :can-undo=\"canUndo()\"\n      :can-redo=\"canRedo()\"\n      @update-layout=\"handleLayoutUpdate\"\n      @save-data=\"handleSaveFromBuilder\"\n      @reload-data=\"handleReloadFromBuilder\"\n      @load-revisions=\"handleLoadRevisions\"\n      @revision-rollback=\"handleRevisionRollback\"\n      @revision-branch=\"handleRevisionBranch\"\n      @revision-delete=\"handleRevisionDelete\"\n      @revision-view=\"handleRevisionView\"\n      @revision-details=\"handleRevisionDetails\"\n      @export-json=\"handleExportJson\"\n      @import-json=\"handleImportJson\"\n      @save-row-as-template=\"handleSaveRowAsTemplate\"\n      @load-block-templates=\"handleLoadBlockTemplates\"\n      @undo=\"handleUndo\"\n      @redo=\"handleRedo\"\n    />\n    <div v-else>Loading builder data...</div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, provide, defineProps, getCurrentInstance } from 'vue';\nimport { useRoute } from 'vue-router';\nimport Builder from './Builder.vue'; // Changed from BuilderInterface\nimport MainController from '@/interface/template/builder/plugin/MainController.js';\nimport storageManager from '@/plugins/storage';\n\nconst props = defineProps({\n  recordId: {\n    type: String,\n    default: null,\n  },\n  backUrl: { // Added backUrl prop\n    type: String,\n    default: '/default-back-url' // Provide a default or make it required\n  },\n  builderData: {\n    type: Object,\n    default: null,\n  },\n  getBuilder: {\n    type: Function,\n    default: null,\n  }\n});\n\nconst instance = getCurrentInstance();\nconst builderData = ref(null); // Will hold { _id, builder: [], css: \"\" }\nconst dataLoaded = ref(false);\nconst controllerInstance = ref(null);\nconst configs = ref(storageManager.get('configs'));\nconst route = useRoute();\n\n// Revision Management State - เหลือเฉพาะที่จำเป็นสำหรับ Builder\nconst revisions = ref([]);\nconst loadingRevisions = ref(false);\nconst revisionDescription = ref('');\n\n// Block Templates State\nconst blockTemplates = ref([]);\nconst loadingBlockTemplates = ref(false);\n\n// Local History State for Undo/Redo\nconst history = ref([]); // Single array เก็บ states ทั้งหมด\nconst currentHistoryIndex = ref(-1); // Index ปัจจุบันใน history array\nconst maxHistorySize = 50;\nconst isUndoRedoOperation = ref(false);\nconst storageKey = ref(null); // Will be set based on builder data ID\n\nprovide('mainController', controllerInstance);\nprovide('builderDataRef', builderData);\n\n// History Management Functions\n\n/**\n * Initialize history storage key based on builder data ID\n */\nfunction initializeHistoryStorage() {\n  if (builderData.value?._id) {\n    storageKey.value = `builder_history_${builderData.value._id}`;\n    loadHistoryFromStorage();\n  }\n}\n\n/**\n * Save history to localStorage\n */\nfunction saveHistoryToStorage() {\n  if (!storageKey.value) return;\n  \n  try {\n    const historyData = {\n      history: history.value,\n      currentHistoryIndex: currentHistoryIndex.value,\n      timestamp: Date.now()\n    };\n    localStorage.setItem(storageKey.value, JSON.stringify(historyData));\n    console.log('History saved to localStorage. Total states:', history.value.length, 'Current index:', currentHistoryIndex.value);\n  } catch (error) {\n    console.error('Error saving history to localStorage:', error);\n  }\n}\n\n/**\n * Load history from localStorage\n */\nfunction loadHistoryFromStorage() {\n  if (!storageKey.value) return;\n  \n  try {\n    const historyDataString = localStorage.getItem(storageKey.value);\n    if (historyDataString) {\n      const historyData = JSON.parse(historyDataString);\n      history.value = historyData.history || [];\n      currentHistoryIndex.value = historyData.currentHistoryIndex ?? -1;\n      console.log('History loaded from localStorage. Total states:', history.value.length, 'Current index:', currentHistoryIndex.value);\n    }\n  } catch (error) {\n    console.error('Error loading history from localStorage:', error);\n    history.value = [];\n    currentHistoryIndex.value = -1;\n  }\n}\n\n/**\n * Clear history from localStorage and memory\n */\nfunction clearHistory() {\n  history.value = [];\n  currentHistoryIndex.value = -1;\n  \n  if (storageKey.value) {\n    try {\n      localStorage.removeItem(storageKey.value);\n      console.log('History cleared from localStorage');\n    } catch (error) {\n      console.error('Error clearing history from localStorage:', error);\n    }\n  }\n}\n\n/**\n * Save current state to history before making changes\n */\nfunction saveStateToHistory() {\n  console.log('saveStateToHistory: Called. isUndoRedoOperation:', isUndoRedoOperation.value);\n  \n  if (isUndoRedoOperation.value) {\n    console.log('saveStateToHistory: Skipped - undo/redo operation in progress');\n    return; // Don't save during undo/redo operations\n  }\n  \n  if (!builderData.value) {\n    console.log('saveStateToHistory: Skipped - no builderData');\n    return;\n  }\n  \n  const currentState = {\n    builder: JSON.parse(JSON.stringify(builderData.value.builder || [])),\n    css: builderData.value.css || '',\n    timestamp: Date.now()\n  };\n  \n  // Check if current state is different from current position\n  if (currentHistoryIndex.value >= 0 && currentHistoryIndex.value < history.value.length) {\n    const currentPositionState = history.value[currentHistoryIndex.value];\n    const currentStateString = JSON.stringify(currentState.builder) + currentState.css;\n    const currentPositionString = JSON.stringify(currentPositionState.builder) + currentPositionState.css;\n    \n    if (currentStateString === currentPositionString) {\n      console.log('saveStateToHistory: Skipped - no changes detected');\n      return; // No changes to save\n    }\n  }\n  \n  // Remove any states after current index (for branching)\n  if (currentHistoryIndex.value >= 0) {\n    history.value = history.value.slice(0, currentHistoryIndex.value + 1);\n    console.log('saveStateToHistory: Removed future states after current index');\n  }\n  \n  // Add new state\n  history.value.push(currentState);\n  currentHistoryIndex.value = history.value.length - 1;\n  console.log('saveStateToHistory: Added new state. Total rows:', currentState.builder.length);\n  \n  // Remove old items if exceeding max size\n  if (history.value.length > maxHistorySize) {\n    history.value.shift();\n    currentHistoryIndex.value--;\n    console.log('saveStateToHistory: Removed old state (exceeded max size)');\n  }\n  \n  // Save to localStorage\n  saveHistoryToStorage();\n  \n  console.log('saveStateToHistory: State saved. Total states:', history.value.length, 'Current index:', currentHistoryIndex.value);\n}\n\n/**\n * Undo last change\n */\nfunction performUndo() {\n  if (currentHistoryIndex.value <= 0) {\n    console.log('No more actions to undo');\n    return false;\n  }\n  \n  console.log('performUndo: Starting undo operation. Current index:', currentHistoryIndex.value, 'Total states:', history.value.length);\n  \n  // Set flag to prevent adding to history during undo\n  isUndoRedoOperation.value = true;\n  \n  // Move to previous state\n  currentHistoryIndex.value--;\n  const previousState = history.value[currentHistoryIndex.value];\n  \n  console.log('performUndo: Moving to index:', currentHistoryIndex.value);\n  \n  // Update builderData directly (this will trigger Vue reactivity)\n  builderData.value.builder = JSON.parse(JSON.stringify(previousState.builder));\n  builderData.value.css = previousState.css;\n  \n  // Force update controller state after builderData is updated\n  if (controllerInstance.value?.state) {\n    // Use nextTick to ensure Vue reactivity completes first\n    setTimeout(() => {\n      if (controllerInstance.value?.state) {\n        const state = controllerInstance.value.state.getState();\n        state.rows = JSON.parse(JSON.stringify(previousState.builder));\n        controllerInstance.value.state.setCssCode(previousState.css);\n        console.log('performUndo: Controller state updated');\n      }\n    }, 10);\n  }\n  \n  // Save to localStorage\n  saveHistoryToStorage();\n  \n  console.log('performUndo: Completed. Current index:', currentHistoryIndex.value, 'Total states:', history.value.length);\n  \n  // Reset flag after sufficient delay\n  setTimeout(() => {\n    isUndoRedoOperation.value = false;\n    console.log('performUndo: Flag reset, operation complete');\n  }, 300);\n  \n  return true;\n}\n\n/**\n * Redo last undone change\n */\nfunction performRedo() {\n  if (currentHistoryIndex.value >= history.value.length - 1) {\n    console.log('No more actions to redo');\n    return false;\n  }\n  \n  console.log('performRedo: Starting redo operation. Current index:', currentHistoryIndex.value, 'Total states:', history.value.length);\n  \n  // Set flag to prevent adding to history during redo\n  isUndoRedoOperation.value = true;\n  \n  // Move to next state\n  currentHistoryIndex.value++;\n  const nextState = history.value[currentHistoryIndex.value];\n  \n  console.log('performRedo: Moving to index:', currentHistoryIndex.value);\n  \n  // Update builderData directly (this will trigger Vue reactivity)\n  builderData.value.builder = JSON.parse(JSON.stringify(nextState.builder));\n  builderData.value.css = nextState.css;\n  \n  // Force update controller state after builderData is updated\n  if (controllerInstance.value?.state) {\n    // Use nextTick to ensure Vue reactivity completes first\n    setTimeout(() => {\n      if (controllerInstance.value?.state) {\n        const state = controllerInstance.value.state.getState();\n        state.rows = JSON.parse(JSON.stringify(nextState.builder));\n        controllerInstance.value.state.setCssCode(nextState.css);\n        console.log('performRedo: Controller state updated');\n      }\n    }, 10);\n  }\n  \n  // Save to localStorage\n  saveHistoryToStorage();\n  \n  console.log('performRedo: Completed. Current index:', currentHistoryIndex.value, 'Total states:', history.value.length);\n  \n  // Reset flag after sufficient delay\n  setTimeout(() => {\n    isUndoRedoOperation.value = false;\n    console.log('performRedo: Flag reset, operation complete');\n  }, 300);\n  \n  return true;\n}\n\n/**\n * Check if undo is available\n */\nfunction canUndo() {\n  return currentHistoryIndex.value > 0;\n}\n\n/**\n * Check if redo is available  \n */\nfunction canRedo() {\n  return currentHistoryIndex.value < history.value.length - 1;\n}\n\n// ใช้ getData จริงจาก API แทน mock function\nasync function realGetData(dataItem) {\n  try {\n    const { data } = await instance.appContext.config.globalProperties.$Request.GET(`post/${dataItem}`, configs.value.key);\n\n    if (data) { // ตรวจสอบว่ามี data กลับมาหรือไม่\n      console.log('data', data);\n      return data; // data ที่ได้จาก API จะมี _id, title, builder, css\n    } else {\n      // กำหนดค่า default ให้ return โครงสร้างที่ InnerBuilder คาดหวัง\n      const defaultData = { \n        builder: [], \n        css: \"\", \n        _id: dataItem, \n        title: \"Error: No data\"\n      };\n      return defaultData; // return default data\n    }\n  } catch (error) {\n    // กรณี error ก็ควร return โครงสร้างข้อมูล default\n    const errorData = { \n      builder: [], \n      css: \"\", \n      _id: dataItem, \n      title: \"Error: Fetch failed\" \n    };\n    return errorData; // return statement ใน catch\n  }\n}\n\nasync function loadBuilderData() {\n  dataLoaded.value = false;\n  let responseData = null;\n  let recordIdToUse = null;\n\n  try {\n    // Always prioritize route.params.id\n    if (route && route.params && route.params.id) {\n      recordIdToUse = route.params.id;\n      responseData = await realGetData(recordIdToUse);\n    } else if (props.getBuilder && typeof props.getBuilder === 'function') {\n      // Fallback to getBuilder if route.params.id is not available\n      responseData = await props.getBuilder();\n      // Assuming getBuilder's response might contain _id, which will be used later\n    } else if (props.recordId && props.recordId !== \"null\" && props.recordId !== \"undefined\") {\n      // Fallback to props.recordId if route.params.id and getBuilder are not available/used\n      recordIdToUse = props.recordId;\n      responseData = await realGetData(recordIdToUse);\n    } else {\n      // No valid recordId from route, getBuilder, or props. Initializing with new data structure.\n      responseData = {\n        _id: `new_no_id_${Date.now()}`,\n        title: \"New Page (No Record ID)\",\n        builder: [],\n        css: \"\",\n      };\n    }\n\n    // Determine _id and title for builderData.value\n    // recordIdToUse would be from route.params.id or props.recordId\n    // responseData._id would be from realGetData or props.getBuilder\n    const finalId = recordIdToUse || \n                    (responseData ? responseData._id : null) || \n                    (builderData.value ? builderData.value._id : `new_empty_${Date.now()}`);\n\n    const finalTitle = (responseData ? responseData.title : null) || \n                       (builderData.value ? builderData.value.title : `Untitled Page`);\n\n    // พยายามดึง type จาก responseData, ถ้าไม่มีให้เป็น 'page' (หรือค่า default อื่นๆที่เหมาะสม)\n    const finalType = (responseData ? responseData.type : null) || 'page'; \n\n    let resolvedBuilder = [];\n    let resolvedCss = \"\";\n\n    if (responseData) {\n        // Builder data: use if it's an array, otherwise default to empty array\n        if (Array.isArray(responseData.builder)) {\n            resolvedBuilder = responseData.builder;\n        }\n        // CSS data: use if it's a string, otherwise default to empty string\n        if (typeof responseData.css === 'string') {\n            resolvedCss = responseData.css;\n        }\n        // If responseData exists but builder/css are not in the expected format,\n        // they remain as their defaults (empty array / empty string).\n    }\n    // If responseData was null/undefined, resolvedBuilder and resolvedCss also remain default.\n\n    builderData.value = {\n        _id: finalId,\n        title: finalTitle,\n        type: finalType,\n        builder: resolvedBuilder,\n        css: resolvedCss,\n    };\n\n    initializeController(builderData.value); \n    dataLoaded.value = true;\n    \n    // Initialize history storage after data is loaded\n    initializeHistoryStorage();\n  } catch (error) {\n    // console.error(\"Error in loadBuilderData:\", error); // Logging error is good practice\n    builderData.value = {\n      _id: props.recordId || `new_error_${Date.now()}`,\n      title: `Error: Fetch Failed for ${props.recordId || 'New Page'}`,\n      type: 'page', // หรือ 'error' หรือค่าที่เหมาะสมสำหรับกรณี error\n      builder: [],\n      css: \"\",\n    };\n  }\n}\n\nfunction initializeController(data) { // data is expected to be { _id, builder: [], css: \"\" }\n  const controllerConfig = {\n    builderData: data, // MainController's constructor or initialize should expect this structure\n    getBuilder: triggerDataLoad, // Pass the function for MainController if it still needs it\n    backUrl: props.backUrl \n  };\n\n  if (!controllerInstance.value) {\n    // เปลี่ยนเป็น async\n    MainController.createInstance(controllerConfig).then(instance => {\n      controllerInstance.value = instance;\n    });\n  } else {\n    controllerInstance.value.initialize(data); \n  }\n}\n\nasync function triggerDataLoad() {\n  await loadBuilderData(); \n  return builderData.value; // Return the updated data structure\n}\n\nasync function handleLayoutUpdate(newLayout) {\n  console.log('handleLayoutUpdate: Called with isUndoRedoOperation:', isUndoRedoOperation.value);\n  console.log('handleLayoutUpdate: Received newLayout:', {\n    hasBuilder: !!newLayout?.builder,\n    builderLength: newLayout?.builder ? newLayout.builder.length : 'undefined',\n    hasCss: !!newLayout?.css,\n    cssLength: newLayout?.css ? newLayout.css.length : 'undefined',\n    isUndoRedoOperation: isUndoRedoOperation.value\n  });\n\n  if (builderData.value && newLayout) {\n    let changed = false;\n    \n    // Save current state to history before making changes\n    if (!isUndoRedoOperation.value) {\n      console.log('handleLayoutUpdate: Saving state to history before changes');\n      saveStateToHistory();\n    } else {\n      console.log('handleLayoutUpdate: Skipping history save - undo/redo operation');\n    }\n    \n    if (Array.isArray(newLayout.builder) && JSON.stringify(builderData.value.builder) !== JSON.stringify(newLayout.builder)) {\n      console.log('handleLayoutUpdate: Builder data changed - OLD length:', builderData.value.builder?.length, 'NEW length:', newLayout.builder.length);\n      builderData.value.builder = newLayout.builder;\n      changed = true;\n    }\n    if (typeof newLayout.css === 'string' && builderData.value.css !== newLayout.css) {\n      console.log('handleLayoutUpdate: CSS data changed');\n      builderData.value.css = newLayout.css;\n      changed = true;\n    }\n\n    if (changed) {\n      console.log('handleLayoutUpdate: Data updated in memory only (localStorage history saved)');\n      \n      // Update controller state if needed\n      if (controllerInstance.value?.state && !isUndoRedoOperation.value) {\n        controllerInstance.value.state.getState().rows = newLayout.builder || [];\n        controllerInstance.value.state.setCssCode(newLayout.css || '');\n        console.log('handleLayoutUpdate: Controller state updated');\n      }\n    } else {\n      console.log('handleLayoutUpdate: No changes detected');\n    }\n  } else {\n    console.log('handleLayoutUpdate: Skipped - no builderData or newLayout');\n  }\n}\n\n// Function for Test Button: Reload Data\nasync function manualLoadData() {\n  await loadBuilderData();\n  const toastInfo = instance.appContext.config.globalProperties.$Toast({\n    type: 'success', // Mapping 'info' to 'success'\n    message: 'ข้อมูลถูกโหลดใหม่แล้ว'\n  });\n  setTimeout(() => {\n    toastInfo.hide();\n  }, 800); // 2000ms (swal) - 1200ms (Toast hide process) = 800ms delay\n}\n\n// Debug function to check current state\nfunction debugCurrentState() {\n  console.log('=== DEBUG CURRENT STATE ===');\n  console.log('builderData.value:', builderData.value);\n  console.log('controllerInstance.value exists?', !!controllerInstance.value);\n  \n  if (controllerInstance.value) {\n    console.log('controller.state exists?', !!controllerInstance.value.state);\n    if (controllerInstance.value.state) {\n      const state = controllerInstance.value.state.getState();\n      console.log('state.rows:', state.rows);\n      console.log('state.rows is array?', Array.isArray(state.rows));\n      console.log('state.rows length:', state.rows ? state.rows.length : 'undefined');\n    }\n  }\n  console.log('=== END DEBUG ===');\n}\n\n// Enhanced manualSaveData with revision system\nasync function manualSaveData() {\n  // Debug current state first\n  debugCurrentState();\n\n  if (builderData.value && builderData.value._id) {\n    try {\n      let latestBuilderData = [];\n      let latestCssData = \"\";\n      \n      // Try multiple sources for builder data\n      if (controllerInstance.value?.state?.getState) {\n        const state = controllerInstance.value.state.getState();\n        if (state.rows && Array.isArray(state.rows)) {\n          latestBuilderData = [...state.rows]; // Create copy\n          console.log('manualSaveData: Got data from controller state:', latestBuilderData.length, 'rows');\n        }\n        \n        const css = controllerInstance.value.state.getCssCode();\n        if (css) {\n          latestCssData = css;\n          console.log('manualSaveData: Got CSS from controller state:', css.length, 'characters');\n        }\n      }\n      \n      // Fallback to builderData.value\n      if (!latestBuilderData || latestBuilderData.length === 0) {\n        if (builderData.value.builder && Array.isArray(builderData.value.builder)) {\n          latestBuilderData = [...builderData.value.builder]; // Create copy\n          console.log('manualSaveData: Fallback to builderData.value.builder:', latestBuilderData.length, 'rows');\n        } else {\n          console.warn('manualSaveData: No builder data found anywhere!');\n          latestBuilderData = [];\n        }\n      }\n      \n      if (!latestCssData && builderData.value.css) {\n        latestCssData = builderData.value.css;\n        console.log('manualSaveData: Fallback to builderData.value.css');\n      }\n\n      // Ensure we have arrays/strings\n      if (!Array.isArray(latestBuilderData)) {\n        console.warn('manualSaveData: latestBuilderData is not array, converting');\n        latestBuilderData = [];\n      }\n      \n      if (typeof latestCssData !== 'string') {\n        latestCssData = String(latestCssData || '');\n      }\n\n      // Update builderData.value for consistency\n      builderData.value.builder = latestBuilderData;\n      builderData.value.css = latestCssData;\n\n      // Final validation\n      console.log('manualSaveData: Final validation:', {\n        builderIsArray: Array.isArray(latestBuilderData),\n        builderRowsCount: latestBuilderData.length,\n        cssIsString: typeof latestCssData === 'string',\n        cssLength: latestCssData.length,\n        title: builderData.value.title,\n        id: builderData.value._id\n      });\n\n      const requestBody = {\n        data: {\n          builder: latestBuilderData,\n          css: latestCssData,\n          title: builderData.value.title \n        },\n        options: {}\n      };\n\n      // Final check of request body\n      console.log('manualSaveData: Sending request with builder rows:', requestBody.data.builder.length);\n\n      // Save main data\n      // eslint-disable-next-line no-unused-vars\n      const { data, status } = await instance.appContext.config.globalProperties.$Request.PUT(`post/${builderData.value._id}`, requestBody, configs.value.key);\n\n      if (status === 200) {\n        // Create revision after successful save\n        await createRevision(latestBuilderData, latestCssData);\n        \n        const toastManualSuccess = instance.appContext.config.globalProperties.$Toast({\n          type: 'success',\n          message: 'ข้อมูลปัจจุบันถูกส่งไปบันทึกแล้ว (สร้าง revision เรียบร้อย)'\n        });\n        setTimeout(() => {\n          toastManualSuccess.hide();\n        }, 1800);\n        console.log('Manual save completed successfully, keeping current state');\n      } else {\n        const toastManualError = instance.appContext.config.globalProperties.$Toast({\n          type: 'error',\n          message: `ไม่สามารถบันทึกข้อมูลได้ (status: ${status})`\n        });\n        setTimeout(() => {\n          toastManualError.hide();\n        }, 1800);\n      }\n    } catch (error) {\n      console.error('manualSaveData: Error occurred:', error);\n      const toastManualCatchError = instance.appContext.config.globalProperties.$Toast({\n        type: 'error',\n        message: 'การเชื่อมต่อมีปัญหา ไม่สามารถบันทึกข้อมูลได้'\n      });\n      setTimeout(() => {\n        toastManualCatchError.hide();\n      }, 1800);\n    }\n  } else {\n    const toastWarning = instance.appContext.config.globalProperties.$Toast({\n      type: 'error',\n      message: 'ยังไม่มีข้อมูลให้บันทึก หรือไม่มี ID ของข้อมูล'\n    });\n    setTimeout(() => {\n      toastWarning.hide();\n    }, 1800);\n  }\n}\n\n// Revision Management Functions\nasync function createRevision(builderDataArray, cssData) {\n  try {\n    const revisionData = {\n      post_id: builderData.value._id,\n      builder_data: builderDataArray,\n      css_data: cssData,\n      title: builderData.value.title,\n      description: revisionDescription.value || `Auto-save at ${new Date().toLocaleString()}`,\n      created_at: new Date().toISOString(),\n      user_id: configs.value.user?.id || 'unknown',\n      user_name: configs.value.user?.name || 'ไม่ระบุ',\n      is_current: false,\n      version: Date.now()\n    };\n\n    const requestBody = {\n      data: revisionData,\n      options: {}\n    };\n\n    const response = await instance.appContext.config.globalProperties.$Request.POST(\n      'post_revision', \n      requestBody, \n      configs.value.key\n    );\n\n    if (response.status === 200) {\n      console.log('Revision created successfully:', response.data);\n      revisionDescription.value = ''; // Reset description\n      await loadRevisions(); // Refresh revision list\n    }\n  } catch (error) {\n    console.error('Error creating revision:', error);\n  }\n}\n\nasync function loadRevisions() {\n  if (!builderData.value?._id) return;\n  \n  try {\n    loadingRevisions.value = true;\n    \n    // ใช้ query endpoint แทน search\n    const queryBody = {\n      method: 'find',\n      args: [\n        {\n          $and: [\n            { post_id: builderData.value._id }\n          ]\n        }\n      ],\n      sort: { created_at: -1 }, // เรียงลำดับตามวันที่ล่าสุดก่อน\n      paging: { page: 1, limit: 500 }\n    };\n\n    const response = await fetch(\"https://gateway.cloudrestfulapi.com/api/post_revision/query\", {\n      method: 'POST',\n      headers: { \n        'Content-Type': 'application/json',\n        'client-token-key': configs.value.key \n      },\n      body: JSON.stringify(queryBody)\n    });\n\n    if (response.ok) {\n      const data = await response.json();\n      revisions.value = data.data || [];\n      console.log('Loaded revisions:', revisions.value.length);\n      console.log('Total revisions available:', data.total);\n    } else {\n      console.error('Error response:', response.status, response.statusText);\n      revisions.value = [];\n    }\n  } catch (error) {\n    console.error('Error loading revisions:', error);\n    revisions.value = [];\n  } finally {\n    loadingRevisions.value = false;\n  }\n}\n\nasync function rollbackToRevision(revision) {\n  try {\n    if (!revision || !revision._id) {\n      console.error('Invalid revision data');\n      return false;\n    }\n\n    // Update current data with revision data\n    builderData.value.builder = revision.builder_data || [];\n    builderData.value.css = revision.css_data || '';\n    \n    // Update controller state\n    if (controllerInstance.value?.state) {\n      controllerInstance.value.state.getState().rows = revision.builder_data || [];\n      controllerInstance.value.state.setCssCode(revision.css_data || '');\n    }\n\n    const toastRollback = instance.appContext.config.globalProperties.$Toast({\n      type: 'success',\n      message: `กลับไปยัง revision: ${revision.description}`\n    });\n    setTimeout(() => {\n      toastRollback.hide();\n    }, 2000);\n    \n    console.log('Rolled back to revision:', revision._id);\n    return true;\n  } catch (error) {\n    console.error('Error during rollback:', error);\n    const toastError = instance.appContext.config.globalProperties.$Toast({\n      type: 'error',\n      message: 'เกิดข้อผิดพลาดในการ rollback'\n    });\n    setTimeout(() => {\n      toastError.hide();\n    }, 1800);\n    return false;\n  }\n}\n\nasync function createBranchFromRevision(revision, branchName) {\n  try {\n    const branchData = {\n      title: `${builderData.value.title} (${branchName})`,\n      builder: revision.builder_data || [],\n      css: revision.css_data || '',\n      type: builderData.value.type || 'page',\n      original_post_id: builderData.value._id,\n      revision_id: revision._id,\n      branch_name: branchName,\n      created_at: new Date().toISOString(),\n      status: 'draft'\n    };\n\n    const requestBody = {\n      data: branchData,\n      options: {}\n    };\n\n    const response = await instance.appContext.config.globalProperties.$Request.POST(\n      'post', \n      requestBody, \n      configs.value.key\n    );\n\n    if (response.status === 200) {\n      const toastBranch = instance.appContext.config.globalProperties.$Toast({\n        type: 'success',\n        message: `สร้าง branch \"${branchName}\" สำเร็จแล้ว`\n      });\n      setTimeout(() => {\n        toastBranch.hide();\n      }, 2000);\n      \n      console.log('Branch created successfully:', response.data);\n      \n      // Reset branch name input\n      branchName.value = '';\n      \n      return response.data;\n    }\n  } catch (error) {\n    console.error('Error creating branch:', error);\n    const toastError = instance.appContext.config.globalProperties.$Toast({\n      type: 'error',\n      message: 'เกิดข้อผิดพลาดในการสร้าง branch'\n    });\n    setTimeout(() => {\n      toastError.hide();\n    }, 1800);\n  }\n}\n\nasync function deleteRevision(revisionId) {\n  try {\n    if (!revisionId) {\n      console.error('Invalid revision ID');\n      return false;\n    }\n\n    // ใช้ query endpoint สำหรับการลบ\n    const deleteBody = {\n      method: 'deleteOne',\n      args: [\n        { _id: revisionId }\n      ]\n    };\n\n    const response = await fetch(\"https://gateway.cloudrestfulapi.com/api/post_revision/query\", {\n      method: 'POST',\n      headers: { \n        'Content-Type': 'application/json',\n        'client-token-key': configs.value.key \n      },\n      body: JSON.stringify(deleteBody)\n    });\n\n    if (response.ok) {\n      const toastDelete = instance.appContext.config.globalProperties.$Toast({\n        type: 'success',\n        message: 'ลบ revision สำเร็จแล้ว'\n      });\n      setTimeout(() => {\n        toastDelete.hide();\n      }, 1800);\n      \n      await loadRevisions(); // Refresh revision list\n      console.log('Revision deleted successfully:', revisionId);\n      return true;\n    } else {\n      throw new Error(`Delete failed with status: ${response.status}`);\n    }\n  } catch (error) {\n    console.error('Error deleting revision:', error);\n    const toastError = instance.appContext.config.globalProperties.$Toast({\n      type: 'error',\n      message: 'เกิดข้อผิดพลาดในการลบ revision'\n    });\n    setTimeout(() => {\n      toastError.hide();\n    }, 1800);\n    return false;\n  }\n}\n\nasync function getRevisionDetails(revisionId) {\n  try {\n    // ใช้ query endpoint สำหรับการดึงข้อมูล revision รายการเดียว\n    const queryBody = {\n      method: 'findOne',\n      args: [\n        { _id: revisionId }\n      ]\n    };\n\n    const response = await fetch(\"https://gateway.cloudrestfulapi.com/api/post_revision/query\", {\n      method: 'POST',\n      headers: { \n        'Content-Type': 'application/json',\n        'client-token-key': configs.value.key \n      },\n      body: JSON.stringify(queryBody)\n    });\n    \n    if (response.ok) {\n      const data = await response.json();\n      return data.data;\n    }\n    return null;\n  } catch (error) {\n    console.error('Error loading revision details:', error);\n    return null;\n  }\n}\n\nasync function viewRevisionDetails(revision) {\n  try {\n    const details = await getRevisionDetails(revision._id);\n    if (details) {\n      // ส่งข้อมูลกลับไปให้ Builder จัดการการแสดงผล\n      return {\n        id: details._id,\n        description: details.description,\n        created: new Date(details.created_at).toLocaleString(),\n        builderRows: details.builder_data?.length || 0,\n        cssLength: details.css_data?.length || 0,\n        user: details.user_name || 'ไม่ระบุ',\n        builderData: details.builder_data,\n        cssData: details.css_data\n      };\n    }\n    return null;\n  } catch (error) {\n    console.error('Error viewing revision details:', error);\n    return null;\n  }\n}\n\n// Handler for save event from Builder\nasync function handleSaveFromBuilder() {\n  console.log('handleSaveFromBuilder: Called');\n  console.log('handleSaveFromBuilder: Current builderData.value:', {\n    hasBuilder: !!builderData.value?.builder,\n    builderLength: builderData.value?.builder ? builderData.value.builder.length : 'undefined',\n    hasCss: !!builderData.value?.css\n  });\n  await manualSaveData();\n  \n  // Clear history after successful save and start fresh\n  clearHistory();\n  console.log('History cleared after save, starting fresh');\n}\n\n// Handler for reload event from Builder  \nasync function handleReloadFromBuilder() {\n  await manualLoadData();\n}\n\n// Handler for load revisions event from Builder\nasync function handleLoadRevisions() {\n  await loadRevisions();\n}\n\n// Handler for revision rollback from Builder\nasync function handleRevisionRollback(revision) {\n  return await rollbackToRevision(revision);\n}\n\n// Handler for revision branch creation from Builder\nasync function handleRevisionBranch(data) {\n  const { revision, branchName } = data;\n  return await createBranchFromRevision(revision, branchName);\n}\n\n// Handler for revision deletion from Builder\nasync function handleRevisionDelete(revisionId) {\n  return await deleteRevision(revisionId);\n}\n\n// Handler for viewing revision details from Builder\nasync function handleRevisionView(revision) {\n  return await viewRevisionDetails(revision);\n}\n\n// Handler for getting revision details from Builder\nasync function handleRevisionDetails(revisionId) {\n  return await getRevisionDetails(revisionId);\n}\n\n// Handler for exporting JSON\nasync function handleExportJson() {\n  try {\n    // รวบรวมข้อมูลจาก builderData และ controller\n    const exportData = {\n      metadata: {\n        title: builderData.value?.title || 'Untitled',\n        type: builderData.value?.type || 'page',\n        exportDate: new Date().toISOString(),\n        version: '1.0.0',\n        exportedBy: 'Builder System',\n        originalId: builderData.value?._id\n      },\n      builder: [],\n      css: '',\n      settings: {\n        responsive: true\n      }\n    };\n\n    // ดึงข้อมูล builder จาก controller state หรือ builderData\n    if (controllerInstance.value?.state?.getState) {\n      const state = controllerInstance.value.state.getState();\n      exportData.builder = state.rows || [];\n      exportData.css = controllerInstance.value.state.getCssCode() || '';\n    } else if (builderData.value) {\n      exportData.builder = builderData.value.builder || [];\n      exportData.css = builderData.value.css || '';\n    }\n\n    // สร้างชื่อไฟล์\n    const fileName = `${(exportData.metadata.title || 'builder').replace(/[^a-z0-9]/gi, '_').toLowerCase()}_${new Date().toISOString().split('T')[0]}.json`;\n    \n    // สร้าง Blob และ download\n    const dataStr = JSON.stringify(exportData, null, 2);\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\n    \n    const downloadLink = document.createElement('a');\n    downloadLink.href = URL.createObjectURL(dataBlob);\n    downloadLink.download = fileName;\n    downloadLink.style.display = 'none';\n    \n    document.body.appendChild(downloadLink);\n    downloadLink.click();\n    document.body.removeChild(downloadLink);\n    \n    console.log('JSON exported successfully:', fileName);\n    \n    // แสดง toast notification\n    const toastSuccess = instance.appContext.config.globalProperties.$Toast({\n      type: 'success',\n      message: `ส่งออกข้อมูลสำเร็จ: ${fileName}`\n    });\n    setTimeout(() => {\n      toastSuccess.hide();\n    }, 2000);\n    \n  } catch (error) {\n    console.error('Error exporting JSON:', error);\n    const toastError = instance.appContext.config.globalProperties.$Toast({\n      type: 'error',\n      message: 'เกิดข้อผิดพลาดในการส่งออกข้อมูล'\n    });\n    setTimeout(() => {\n      toastError.hide();\n    }, 1800);\n  }\n}\n\n// Handler for importing JSON\nasync function handleImportJson(importedData) {\n  try {\n    if (!importedData || !Array.isArray(importedData.builder)) {\n      throw new Error('Invalid import data structure');\n    }\n\n    const importMode = importedData.importMode || 'replace'; // default เป็น replace\n    console.log('handleImportJson: Import mode:', importMode);\n    console.log('handleImportJson: Current rows:', builderData.value.builder?.length || 0);\n    console.log('handleImportJson: Importing rows:', importedData.builder.length);\n\n    let finalBuilderData = [];\n    let finalCssData = '';\n\n    if (importMode === 'append') {\n      // โหมดเพิ่มต่อท้าย\n      finalBuilderData = [\n        ...(builderData.value.builder || []), // ข้อมูลเดิม\n        ...importedData.builder                // ข้อมูลใหม่\n      ];\n      \n      // รวม CSS เดิมกับใหม่\n      const currentCss = builderData.value.css || '';\n      const importedCss = importedData.css || '';\n      \n      if (currentCss && importedCss) {\n        finalCssData = currentCss + '\\n\\n/* === Imported CSS === */\\n' + importedCss;\n      } else {\n        finalCssData = currentCss + importedCss;\n      }\n      \n      console.log('handleImportJson: Append mode - Final rows:', finalBuilderData.length);\n      \n    } else {\n      // โหมดแทนที่ทั้งหมด (default)\n      finalBuilderData = importedData.builder;\n      finalCssData = importedData.css || '';\n      \n      console.log('handleImportJson: Replace mode - Final rows:', finalBuilderData.length);\n    }\n\n    // อัปเดต builderData\n    builderData.value.builder = finalBuilderData;\n    builderData.value.css = finalCssData;\n    \n    // อัปเดต metadata หากมี (เฉพาะ replace mode)\n    if (importMode === 'replace' && importedData.metadata) {\n      if (importedData.metadata.title && importedData.metadata.title !== 'Untitled') {\n        console.log('handleImportJson: Imported title:', importedData.metadata.title);\n      }\n    }\n\n    // อัปเดต controller state\n    if (controllerInstance.value?.state) {\n      controllerInstance.value.state.getState().rows = finalBuilderData;\n      controllerInstance.value.state.setCssCode(finalCssData);\n    }\n\n    console.log('handleImportJson: JSON imported successfully');\n    \n    // แสดง toast notification ตาม mode\n    const modeText = importMode === 'append' ? 'เพิ่มต่อท้าย' : 'แทนที่';\n    const toastSuccess = instance.appContext.config.globalProperties.$Toast({\n      type: 'success',\n      message: `นำเข้าข้อมูลสำเร็จ (${modeText}): ${importedData.builder.length} rows`\n    });\n    setTimeout(() => {\n      toastSuccess.hide();\n    }, 2000);\n    \n    // บันทึกการเปลี่ยนแปลงหลังจาก import\n    await createRevision(finalBuilderData, finalCssData);\n    \n  } catch (error) {\n    console.error('Error importing JSON:', error);\n    const toastError = instance.appContext.config.globalProperties.$Toast({\n      type: 'error',\n      message: 'เกิดข้อผิดพลาดในการนำเข้าข้อมูล'\n    });\n    setTimeout(() => {\n      toastError.hide();\n    }, 1800);\n  }\n}\n\n// Handler for saving row as template\nasync function handleSaveRowAsTemplate(templateData) {\n  try {\n    console.log('Saving row as template:', templateData);\n    \n    // เตรียม request body\n    const requestBody = {\n      data: {\n        name: templateData.name,\n        description: templateData.description,\n        type: templateData.type,\n        category: templateData.category,\n        tags: templateData.tags,\n        data: templateData.data,\n        created_at: templateData.created_at,\n        created_by: templateData.created_by,\n        builder_version: '1.0.0',\n        // เพิ่มข้อมูลเจ้าของหรือผู้สร้าง\n        owner_id: configs.value.user?.id || 'unknown',\n        owner_name: configs.value.user?.name || 'ไม่ระบุ',\n        // เพิ่มข้อมูล metadata\n        metadata: {\n          columns_count: templateData.data.columns?.length || 0,\n          grid_columns: templateData.data.col || 1,\n          has_background: !!(templateData.data.bgColor || templateData.data.bgImage),\n          responsive_settings: {\n            mobile: templateData.data.mobile || true,\n            tablet: templateData.data.tablet || true,\n            laptop: templateData.data.laptop || true,\n            desktop: templateData.data.desktop || true\n          }\n        },\n        // เพิ่มสถานะ\n        status: 'active',\n        is_public: false, // เริ่มต้นเป็น private\n        usage_count: 0\n      },\n      options: {}\n    };\n\n    console.log('Template request body:', requestBody);\n\n    // บันทึกไปยัง post_block_template collection\n    const response = await instance.appContext.config.globalProperties.$Request.POST(\n      'post_block_template',\n      requestBody,\n      configs.value.key\n    );\n\n    if (response.status === 200) {\n      console.log('Template saved successfully:', response.data);\n      \n      // แสดง toast notification\n      const toastSuccess = instance.appContext.config.globalProperties.$Toast({\n        type: 'success',\n        message: `บันทึก Block Template \"${templateData.name}\" สำเร็จแล้ว`\n      });\n      setTimeout(() => {\n        toastSuccess.hide();\n      }, 2000);\n      \n      // รีเฟรช block templates list หลังจากบันทึกสำเร็จ\n      await loadBlockTemplates();\n      \n      // คืนค่า response data กลับไป (อาจจะมี _id ใหม่)\n      return response.data;\n      \n    } else {\n      throw new Error(`Save failed with status: ${response.status}`);\n    }\n    \n  } catch (error) {\n    console.error('Error saving row as template:', error);\n    \n    // แสดง error toast\n    const toastError = instance.appContext.config.globalProperties.$Toast({\n      type: 'error',\n      message: 'เกิดข้อผิดพลาดในการบันทึก Block Template'\n    });\n    setTimeout(() => {\n      toastError.hide();\n    }, 2000);\n    \n    throw error; // Re-throw เพื่อให้ caller จัดการต่อได้\n  }\n}\n\n// Handler for loading block templates\nasync function handleLoadBlockTemplates() {\n  await loadBlockTemplates();\n}\n\n// Function to load block templates from database\nasync function loadBlockTemplates() {\n  try {\n    loadingBlockTemplates.value = true;\n    \n    // ใช้ query endpoint เพื่อดึงข้อมูล block templates\n    const queryBody = {\n      method: 'find',\n      args: [\n        {\n          $and: [\n            { type: 'row_template' },\n            { status: 'active' },\n            { \n              $or: [\n                { owner_id: configs.value.user?.id },\n                { is_public: true }\n              ]\n            }\n          ]\n        }\n      ],\n      sort: { created_at: -1 }, // เรียงลำดับตามวันที่ล่าสุดก่อน\n      paging: { page: 1, limit: 100 }\n    };\n\n    const response = await fetch(\"https://gateway.cloudrestfulapi.com/api/post_block_template/query\", {\n      method: 'POST',\n      headers: { \n        'Content-Type': 'application/json',\n        'client-token-key': configs.value.key \n      },\n      body: JSON.stringify(queryBody)\n    });\n\n    if (response.ok) {\n      const data = await response.json();\n      blockTemplates.value = data.data || [];\n      console.log('Loaded block templates:', blockTemplates.value.length);\n      console.log('Total templates available:', data.total);\n    } else {\n      console.error('Error response:', response.status, response.statusText);\n      blockTemplates.value = [];\n    }\n  } catch (error) {\n    console.error('Error loading block templates:', error);\n    blockTemplates.value = [];\n    \n    // แสดง error toast\n    const toastError = instance.appContext.config.globalProperties.$Toast({\n      type: 'error',\n      message: 'เกิดข้อผิดพลาดในการโหลด Block Templates'\n    });\n    setTimeout(() => {\n      toastError.hide();\n    }, 2000);\n  } finally {\n    loadingBlockTemplates.value = false;\n  }\n}\n\n// Undo/Redo Handlers\nasync function handleUndo() {\n  console.log('handleUndo: Called. Current state:', {\n    totalStates: history.value.length,\n    currentIndex: currentHistoryIndex.value,\n    canUndo: canUndo(),\n    canRedo: canRedo(),\n    isUndoRedoOperation: isUndoRedoOperation.value\n  });\n  \n  const success = performUndo();\n  if (success) {\n    const toastUndo = instance.appContext.config.globalProperties.$Toast({\n      type: 'success',\n      message: 'ย้อนกลับการเปลี่ยนแปลงสำเร็จ'\n    });\n    setTimeout(() => {\n      toastUndo.hide();\n    }, 1500);\n    \n    console.log('handleUndo: Success. New state:', {\n      totalStates: history.value.length,\n      currentIndex: currentHistoryIndex.value,\n      canUndo: canUndo(),\n      canRedo: canRedo()\n    });\n  } else {\n    const toastNoUndo = instance.appContext.config.globalProperties.$Toast({\n      type: 'warning',\n      message: 'ไม่มีการเปลี่ยนแปลงให้ย้อนกลับ'\n    });\n    setTimeout(() => {\n      toastNoUndo.hide();\n    }, 1500);\n    \n    console.log('handleUndo: Failed - no history available');\n  }\n}\n\nasync function handleRedo() {\n  console.log('handleRedo: Called. Current state:', {\n    totalStates: history.value.length,\n    currentIndex: currentHistoryIndex.value,\n    canUndo: canUndo(),\n    canRedo: canRedo(),\n    isUndoRedoOperation: isUndoRedoOperation.value\n  });\n  \n  const success = performRedo();\n  if (success) {\n    const toastRedo = instance.appContext.config.globalProperties.$Toast({\n      type: 'success',\n      message: 'ทำซ้ำการเปลี่ยนแปลงสำเร็จ'\n    });\n    setTimeout(() => {\n      toastRedo.hide();\n    }, 1500);\n    \n    console.log('handleRedo: Success. New state:', {\n      totalStates: history.value.length,\n      currentIndex: currentHistoryIndex.value,\n      canUndo: canUndo(),\n      canRedo: canRedo()\n    });\n  } else {\n    const toastNoRedo = instance.appContext.config.globalProperties.$Toast({\n      type: 'warning',\n      message: 'ไม่มีการเปลี่ยนแปลงให้ทำซ้ำ'\n    });\n    setTimeout(() => {\n      toastNoRedo.hide();\n    }, 1500);\n    \n    console.log('handleRedo: Failed - no redo available');\n  }\n}\n\nonMounted(() => {\n  if (props.builderData && Object.keys(props.builderData).length > 0) {\n    builderData.value = props.builderData;\n    initializeController(props.builderData);\n    dataLoaded.value = true; // Ensure dataLoaded is also true here\n  } else {\n    loadBuilderData();\n  }\n});\n\n</script>\n\n<style scoped>\n/* Add any specific styles for the container if needed */\n</style> ","import script from \"./MainBuilderContainer.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./MainBuilderContainer.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./MainBuilderContainer.vue?vue&type=style&index=0&id=1281f85e&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-1281f85e\"]])\n\nexport default __exports__","import { render } from \"./Builder.vue?vue&type=template&id=bf477156\"\nimport script from \"./Builder.vue?vue&type=script&lang=js\"\nexport * from \"./Builder.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./Builder.vue?vue&type=template&id=6acf0be4\"\nimport script from \"./Builder.vue?vue&type=script&lang=js\"\nexport * from \"./Builder.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","<template>\n    <div class=\"flex flex-col items-center justify-center min-h-screen bg-gray-100\">\n      <h1 class=\"text-4xl font-bold mb-4 text-gray-800\">Under Construction</h1>\n      <p class=\"text-lg text-gray-700 mb-6\">We're working on something awesome. Please check back later!</p>\n      <div class=\"flex flex-col items-center\">\n        <p class=\"text-gray-700\">Estimated Completion: September 2023</p>\n      </div>\n    </div>\n  </template>\n  \n  <script>\n  export default {\n    name: 'UnderConstruction',\n    mounted() {\n      this.$setPageTitle('Under Construction');\n    },\n  };\n  </script>\n  \n  <style scoped>\n  .container {\n    max-width: 640px;\n    margin: 0 auto;\n    padding: 1rem;\n  }\n  </style>\n  ","import { render } from \"./UnderConstruction.vue?vue&type=template&id=685445e4&scoped=true\"\nimport script from \"./UnderConstruction.vue?vue&type=script&lang=js\"\nexport * from \"./UnderConstruction.vue?vue&type=script&lang=js\"\n\nimport \"./UnderConstruction.vue?vue&type=style&index=0&id=685445e4&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/@vue/cli-service/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-685445e4\"]])\n\nexport default __exports__"],"names":["_createElementBlock","$data","page","_createBlock","_component_Render","key","dataItem","mode","_component_UnderConstruction","data","configs","storageManager","get","session","this","$route","params","components","Render","UnderConstruction","methods","setup","computed","__exports__","render","_resolveDynamicComponent","$options","componentName","_createVNode","_component_Builder","onUpdateLayout","updateData","builderData","rows","getBuilder","getData","backUrl","maxHistorySize","props","__props","instance","getCurrentInstance","ref","dataLoaded","controllerInstance","route","useRoute","revisions","loadingRevisions","revisionDescription","blockTemplates","loadingBlockTemplates","history","currentHistoryIndex","isUndoRedoOperation","storageKey","initializeHistoryStorage","value","_id","loadHistoryFromStorage","saveHistoryToStorage","historyData","timestamp","Date","now","localStorage","setItem","JSON","stringify","console","log","length","error","historyDataString","getItem","parse","clearHistory","removeItem","saveStateToHistory","currentState","builder","css","currentPositionState","currentStateString","currentPositionString","slice","push","shift","performUndo","previousState","state","setTimeout","getState","setCssCode","performRedo","nextState","canUndo","canRedo","async","realGetData","appContext","config","globalProperties","$Request","GET","defaultData","title","errorData","loadBuilderData","responseData","recordIdToUse","id","recordId","finalId","finalTitle","finalType","type","resolvedBuilder","resolvedCss","Array","isArray","initializeController","controllerConfig","triggerDataLoad","initialize","MainController","createInstance","then","handleLayoutUpdate","newLayout","hasBuilder","builderLength","hasCss","cssLength","changed","manualLoadData","toastInfo","$Toast","message","hide","debugCurrentState","manualSaveData","latestBuilderData","latestCssData","getCssCode","warn","String","builderIsArray","builderRowsCount","cssIsString","requestBody","options","status","PUT","createRevision","toastManualSuccess","toastManualError","toastManualCatchError","toastWarning","builderDataArray","cssData","revisionData","post_id","builder_data","css_data","description","toLocaleString","created_at","toISOString","user_id","user","user_name","name","is_current","version","response","POST","loadRevisions","queryBody","method","args","$and","sort","paging","limit","fetch","headers","body","ok","json","total","statusText","rollbackToRevision","revision","toastRollback","toastError","createBranchFromRevision","branchName","branchData","original_post_id","revision_id","branch_name","toastBranch","deleteRevision","revisionId","deleteBody","toastDelete","Error","getRevisionDetails","viewRevisionDetails","details","created","builderRows","handleSaveFromBuilder","handleReloadFromBuilder","handleLoadRevisions","handleRevisionRollback","handleRevisionBranch","handleRevisionDelete","handleRevisionView","handleRevisionDetails","handleExportJson","exportData","metadata","exportDate","exportedBy","originalId","settings","responsive","fileName","replace","toLowerCase","split","dataStr","dataBlob","Blob","downloadLink","document","createElement","href","URL","createObjectURL","download","style","display","appendChild","click","removeChild","toastSuccess","handleImportJson","importedData","importMode","finalBuilderData","finalCssData","currentCss","importedCss","modeText","handleSaveRowAsTemplate","templateData","category","tags","created_by","builder_version","owner_id","owner_name","columns_count","columns","grid_columns","col","has_background","bgColor","bgImage","responsive_settings","mobile","tablet","laptop","desktop","is_public","usage_count","loadBlockTemplates","handleLoadBlockTemplates","$or","handleUndo","totalStates","currentIndex","success","toastUndo","toastNoUndo","handleRedo","toastRedo","toastNoRedo","provide","onMounted","Object","keys","accessSession","selectSession","Builder","changeSession","pageLayout","savedLayout","$setPageTitle","post","layout","$swal","toast","position","showConfirmButton","timer","icon","text","Promise","resolve","mounted","Backend","Frontend","routeName","meta","useTitle","interface","class","_hoisted_1","_cache","_createElementVNode"],"sourceRoot":""}